id,type,state,state_reason,title,body,author,created_at,assignees,updated_at,closed_at,url,labels,comments_list,comment_thread
2561783853,pull_request,closed,,fix(Dunning): logic for fetching text (backport #43160),"### Before

(a). If the `language` parameter is provided, return the text for this language. If this doesn't exist, return `None`.
(b.) If the `language` parameter is not provided, return the text marked as _Is Default Language_. If this doesn't exist, return `None`.

### After

1. If the `language` parameter is provided, return the text for this language.
2. If `doc.language` exists, return the text for this language.
3. If a text marked as _Is Default Language_ exists, return this one.
4. Return an empty dict (-> uniform return type)

### How to test

1. Create a **Dunning Type**
    - add texts for different languages, enable _Is Default Language_ for one of them
3. Create overdue **Sales Invoices** for customers with different languages
5. Click on ""Create"" -> ""Dunning"" in each **Sales Invoice**<hr>This is an automatic backport of pull request #43160 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-02 14:04:12+00:00,['barredterra'],2024-10-20 00:12:21+00:00,2024-10-03 19:28:59+00:00,https://github.com/frappe/erpnext/pull/43489,"[('released', None)]","[{'comment_id': 2392705862, 'issue_id': 2561783853, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.74.3 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 10, 4, 3, 4, 19, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-10-04 03:04:19 UTC): :tada: This PR is included in version 14.74.3 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2561568308,pull_request,closed,,fix: Hide print labels for Terms and Conditions,re: https://github.com/frappe/frappe/pull/27817,cogk,2024-10-02 12:55:09+00:00,['ruthra-kumar'],2024-10-31 00:11:32+00:00,2024-10-16 05:15:20+00:00,https://github.com/frappe/erpnext/pull/43488,[],[],
2561130014,pull_request,closed,,fix: set margin fields for purchase documents when updating items (backport #43475),"### Issue
Rate changes on save because both discount and margin are set.

### Solution
revert: https://github.com/frappe/erpnext/commit/81c217584a8d30361957abdda815118c5c00f71b
margin fields introduced in: https://github.com/frappe/erpnext/pull/24685<hr>This is an automatic backport of pull request #43475 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-02 09:52:34+00:00,['sagarvora'],2024-10-17 00:11:00+00:00,2024-10-02 09:54:08+00:00,https://github.com/frappe/erpnext/pull/43485,"[('accounts', ''), ('needs-tests', 'This PR needs automated unit-tests.')]",[],
2561128613,pull_request,closed,,fix: set margin fields for purchase documents when updating items (backport #43475),"### Issue
Rate changes on save because both discount and margin are set.

### Solution
revert: https://github.com/frappe/erpnext/commit/81c217584a8d30361957abdda815118c5c00f71b
margin fields introduced in: https://github.com/frappe/erpnext/pull/24685<hr>This is an automatic backport of pull request #43475 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-02 09:51:49+00:00,['sagarvora'],2024-10-20 00:12:20+00:00,2024-10-02 09:54:03+00:00,https://github.com/frappe/erpnext/pull/43484,"[('accounts', ''), ('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2392705895, 'issue_id': 2561128613, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.74.3 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 10, 4, 3, 4, 22, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-10-04 03:04:22 UTC): :tada: This PR is included in version 14.74.3 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2561107188,pull_request,closed,,fix: patch to update Currency Exchange Settings for `frankfurter.app` (backport #43481),Continues https://github.com/frappe/erpnext/pull/43476<hr>This is an automatic backport of pull request #43481 done by [Mergify](https://mergify.com).,mergify[bot],2024-10-02 09:43:19+00:00,['sagarvora'],2024-10-17 00:11:02+00:00,2024-10-02 09:45:48+00:00,https://github.com/frappe/erpnext/pull/43483,[],"[{'comment_id': 2388097622, 'issue_id': 2561107188, 'author': 'mergify[bot]', 'body': 'Cherry-pick of c5889c5d2ed0773dbc55173ddbcf8c817f654357 has failed:\n```\nOn branch mergify/bp/version-15-hotfix/pr-43481\nYour branch is up to date with \'origin/version-15-hotfix\'.\n\nYou are currently cherry-picking commit c5889c5d2e.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tnew file:   erpnext/patches/v14_0/update_currency_exchange_settings_for_frankfurter.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/patches.txt\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 10, 2, 9, 43, 22, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-10-02 09:43:22 UTC): Cherry-pick of c5889c5d2ed0773dbc55173ddbcf8c817f654357 has failed:
```
On branch mergify/bp/version-15-hotfix/pr-43481
Your branch is up to date with 'origin/version-15-hotfix'.

You are currently cherry-picking commit c5889c5d2e.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	new file:   erpnext/patches/v14_0/update_currency_exchange_settings_for_frankfurter.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/patches.txt

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2561106731,pull_request,closed,,fix: patch to update Currency Exchange Settings for `frankfurter.app` (backport #43481),Continues https://github.com/frappe/erpnext/pull/43476<hr>This is an automatic backport of pull request #43481 done by [Mergify](https://mergify.com).,mergify[bot],2024-10-02 09:43:16+00:00,['sagarvora'],2024-10-20 00:12:19+00:00,2024-10-02 09:44:46+00:00,https://github.com/frappe/erpnext/pull/43482,"[('released', None)]","[{'comment_id': 2388097460, 'issue_id': 2561106731, 'author': 'mergify[bot]', 'body': 'Cherry-pick of c5889c5d2ed0773dbc55173ddbcf8c817f654357 has failed:\n```\nOn branch mergify/bp/version-14-hotfix/pr-43481\nYour branch is up to date with \'origin/version-14-hotfix\'.\n\nYou are currently cherry-picking commit c5889c5d2e.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tnew file:   erpnext/patches/v14_0/update_currency_exchange_settings_for_frankfurter.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/patches.txt\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 10, 2, 9, 43, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2392705935, 'issue_id': 2561106731, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.74.3 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 10, 4, 3, 4, 25, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-10-02 09:43:18 UTC): Cherry-pick of c5889c5d2ed0773dbc55173ddbcf8c817f654357 has failed:
```
On branch mergify/bp/version-14-hotfix/pr-43481
Your branch is up to date with 'origin/version-14-hotfix'.

You are currently cherry-picking commit c5889c5d2e.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	new file:   erpnext/patches/v14_0/update_currency_exchange_settings_for_frankfurter.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/patches.txt

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

frappe-pr-bot on (2024-10-04 03:04:25 UTC): :tada: This PR is included in version 14.74.3 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2561097565,pull_request,closed,,fix: patch to update Currency Exchange Settings for `frankfurter.app`,Continues https://github.com/frappe/erpnext/pull/43476,sagarvora,2024-10-02 09:39:48+00:00,[],2024-10-17 00:11:03+00:00,2024-10-02 09:42:03+00:00,https://github.com/frappe/erpnext/pull/43481,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2561039946,pull_request,closed,,fix: Fix API endpoint for Frankfurter (backport #43476),"Frankfurter just passed a **breaking change** which breaks the ""frankfurter.app"" endpoint for API calls. The new endpoint is ""api.frankfurter.app"".

re: https://github.com/frappe/erpnext/pull/43472<hr>This is an automatic backport of pull request #43476 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-02 09:12:03+00:00,[],2024-10-17 00:11:04+00:00,2024-10-02 09:17:59+00:00,https://github.com/frappe/erpnext/pull/43479,"[('conflicts', None)]","[{'comment_id': 2387995368, 'issue_id': 2561039946, 'author': 'mergify[bot]', 'body': 'Cherry-pick of 33e72111c7d7f60dbe041282026f607230624f52 has failed:\n```\nOn branch mergify/bp/version-13-hotfix/pr-43476\nYour branch is up to date with \'origin/version-13-hotfix\'.\n\nYou are currently cherry-picking commit 33e72111c7.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use ""git add/rm <file>..."" as appropriate to mark resolution)\n\tdeleted by us:   erpnext/accounts/doctype/currency_exchange_settings/currency_exchange_settings.py\n\tboth modified:   erpnext/setup/install.py\n\nno changes added to commit (use ""git add"" and/or ""git commit -a"")\n```\n\n\nCherry-pick of c444de017aee1cfa6e4e214dbddbc2543dccd966 has failed:\n```\nOn branch mergify/bp/version-13-hotfix/pr-43476\nYour branch is ahead of \'origin/version-13-hotfix\' by 1 commit.\n  (use ""git push"" to publish your local commits)\n\nYou are currently cherry-picking commit c444de017a.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/setup/doctype/currency_exchange/test_currency_exchange.py\n\nno changes added to commit (use ""git add"" and/or ""git commit -a"")\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 10, 2, 9, 12, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2388006737, 'issue_id': 2561039946, 'author': 'sagarvora', 'body': 'nothing to merge, so closed.', 'created_at': datetime.datetime(2024, 10, 2, 9, 18, 10, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-10-02 09:12:05 UTC): Cherry-pick of 33e72111c7d7f60dbe041282026f607230624f52 has failed:
```
On branch mergify/bp/version-13-hotfix/pr-43476
Your branch is up to date with 'origin/version-13-hotfix'.

You are currently cherry-picking commit 33e72111c7.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Unmerged paths:
  (use ""git add/rm <file>..."" as appropriate to mark resolution)
	deleted by us:   erpnext/accounts/doctype/currency_exchange_settings/currency_exchange_settings.py
	both modified:   erpnext/setup/install.py

no changes added to commit (use ""git add"" and/or ""git commit -a"")
```


Cherry-pick of c444de017aee1cfa6e4e214dbddbc2543dccd966 has failed:
```
On branch mergify/bp/version-13-hotfix/pr-43476
Your branch is ahead of 'origin/version-13-hotfix' by 1 commit.
  (use ""git push"" to publish your local commits)

You are currently cherry-picking commit c444de017a.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/setup/doctype/currency_exchange/test_currency_exchange.py

no changes added to commit (use ""git add"" and/or ""git commit -a"")
```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

sagarvora on (2024-10-02 09:18:10 UTC): nothing to merge, so closed.

"
2561039885,pull_request,closed,,fix: Fix API endpoint for Frankfurter (backport #43476),"Frankfurter just passed a **breaking change** which breaks the ""frankfurter.app"" endpoint for API calls. The new endpoint is ""api.frankfurter.app"".

re: https://github.com/frappe/erpnext/pull/43472<hr>This is an automatic backport of pull request #43476 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-02 09:12:01+00:00,[],2024-10-17 00:11:05+00:00,2024-10-02 09:13:14+00:00,https://github.com/frappe/erpnext/pull/43478,[],[],
2561039801,pull_request,closed,,fix: Fix API endpoint for Frankfurter (backport #43476),"Frankfurter just passed a **breaking change** which breaks the ""frankfurter.app"" endpoint for API calls. The new endpoint is ""api.frankfurter.app"".

re: https://github.com/frappe/erpnext/pull/43472<hr>This is an automatic backport of pull request #43476 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-02 09:11:59+00:00,[],2024-10-20 00:12:18+00:00,2024-10-02 09:13:07+00:00,https://github.com/frappe/erpnext/pull/43477,"[('released', None)]","[{'comment_id': 2392705980, 'issue_id': 2561039801, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.74.3 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 10, 4, 3, 4, 28, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-10-04 03:04:28 UTC): :tada: This PR is included in version 14.74.3 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2560922440,pull_request,closed,,fix: Fix API endpoint for Frankfurter,"Frankfurter just passed a **breaking change** which breaks the ""frankfurter.app"" endpoint for API calls. The new endpoint is ""api.frankfurter.app"".

re: https://github.com/frappe/erpnext/pull/43472",cogk,2024-10-02 08:09:41+00:00,[],2024-10-17 00:10:59+00:00,2024-10-02 09:10:55+00:00,https://github.com/frappe/erpnext/pull/43476,"[('critical', None), ('backport version-13-hotfix', ''), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]","[{'comment_id': 2388411415, 'issue_id': 2560922440, 'author': 'blaggacao', 'body': '@cogk Thanks a lot!!', 'created_at': datetime.datetime(2024, 10, 2, 11, 25, 58, tzinfo=datetime.timezone.utc)}]","blaggacao on (2024-10-02 11:25:58 UTC): @cogk Thanks a lot!!

"
2560873621,pull_request,closed,,fix: set margin fields for purchase documents when updating items,"### Issue
Rate changes on ""update items"" because both discount and margin are set.

### Solution
revert: https://github.com/frappe/erpnext/commit/81c217584a8d30361957abdda815118c5c00f71b
margin fields introduced in: https://github.com/frappe/erpnext/pull/24685",sagarvora,2024-10-02 07:43:53+00:00,[],2024-10-17 00:11:01+00:00,2024-10-02 09:50:58+00:00,https://github.com/frappe/erpnext/pull/43475,"[('accounts', ''), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2560466361,pull_request,closed,,ci: use dynamic total job,"precedent: https://github.com/frappe/frappe/pull/27957
",blaggacao,2024-10-02 00:54:48+00:00,[],2024-10-17 00:10:58+00:00,2024-10-02 11:44:45+00:00,https://github.com/frappe/erpnext/pull/43474,[],"[{'comment_id': 2388146642, 'issue_id': 2560466361, 'author': 'blaggacao', 'body': '@ruthra-kumar `develop` appears to suffer a regression :cry:', 'created_at': datetime.datetime(2024, 10, 2, 9, 51, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2388399920, 'issue_id': 2560466361, 'author': 'ruthra-kumar', 'body': 'Possibly related to the exchange rate endpoint change(?) https://github.com/frappe/erpnext/pull/43476', 'created_at': datetime.datetime(2024, 10, 2, 11, 18, 40, tzinfo=datetime.timezone.utc)}]","blaggacao (Issue Creator) on (2024-10-02 09:51:25 UTC): @ruthra-kumar `develop` appears to suffer a regression :cry:

ruthra-kumar on (2024-10-02 11:18:40 UTC): Possibly related to the exchange rate endpoint change(?) https://github.com/frappe/erpnext/pull/43476

"
2560359512,pull_request,closed,,ci: preempt read-only-mapper merge in frappe,"##### Downstream of https://github.com/frappe/frappe/pull/27956
",blaggacao,2024-10-01 23:06:00+00:00,[],2024-11-20 00:11:27+00:00,2024-11-05 08:15:48+00:00,https://github.com/frappe/erpnext/pull/43473,"[('dont-merge', None), ('inactive', '')]","[{'comment_id': 2456122175, 'issue_id': 2560359512, 'author': 'stale[bot]', 'body': ""This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing."", 'created_at': datetime.datetime(2024, 11, 5, 2, 55, 32, tzinfo=datetime.timezone.utc)}]","stale[bot] on (2024-11-05 02:55:32 UTC): This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing.

"
2559396630,pull_request,closed,,"fix: new url for frankfurter.app, now use api.frankfurter.app","frankfurter.app dosent work anymore, now we need to use ""api.frankfurter.app"":


old access: 
https://frankfurter.dev/2024-10-01?base=USD&symbols=INR

now:
https://api.frankfurter.app/2024-10-01?base=USD&symbols=INR


this is used on setup a new site, and get a stack on try to use frankfurter.app",HarryPaulo,2024-10-01 14:20:13+00:00,[],2024-10-17 00:11:06+00:00,2024-10-02 09:12:07+00:00,https://github.com/frappe/erpnext/pull/43472,"[('needs-tests', 'This PR needs automated unit-tests.')]","[{'comment_id': 2387995460, 'issue_id': 2559396630, 'author': 'sagarvora', 'body': 'merged in another PR by @cogk', 'created_at': datetime.datetime(2024, 10, 2, 9, 12, 7, tzinfo=datetime.timezone.utc)}]","sagarvora on (2024-10-02 09:12:07 UTC): merged in another PR by @cogk

"
2559252311,pull_request,closed,,85 error while submitting old sales order,"<!--

Some key notes before you open a PR:

 1. Select which branch should this PR be merged in?
 2. PR name follows [convention](http://karma-runner.github.io/4.0/dev/git-commit-msg.html)
 3. All tests pass locally, UI and Unit tests
 4. All business logic and validations must be on the server-side
 5. Update necessary Documentation
 6. Put `closes #XXXX` in your comment to auto-close the issue that your PR fixes


Also, if you're new here

- Documentation Guidelines => https://github.com/frappe/erpnext/wiki/Updating-Documentation

- Contribution Guide => https://github.com/frappe/erpnext/blob/develop/.github/CONTRIBUTING.md

- Pull Request Checklist => https://github.com/frappe/erpnext/wiki/Pull-Request-Checklist

-->

> Please provide enough information so that others can review your pull request:

<!-- You can skip this if you're fixing a typo or updating existing documentation -->

> Explain the **details** for making this change. What existing problem does the pull request solve?

<!-- Example: When ""Adding a function to do X"", explain why it is necessary to have a way to do X. -->

> Screenshots/GIFs

<!-- Add images/recordings to better visualize the change: expected/current behviour -->
",hrishikesh8848,2024-10-01 13:30:19+00:00,[],2024-10-17 00:11:07+00:00,2024-10-01 16:58:15+00:00,https://github.com/frappe/erpnext/pull/43471,"[('accounts', ''), ('stock', None), ('CRM', None), ('selling', None), ('buying', None), ('assets', ''), ('projects', 'projects module related issue / PR')]",[],
2558996980,pull_request,closed,,refactor: use redis-py instead of redisearch (backport #31980),"closes https://github.com/frappe/erpnext/issues/31300 

depends on https://github.com/frappe/frappe/pull/17921 <hr>This is an automatic backport of pull request #31980 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-01 11:51:11+00:00,[],2024-10-22 00:12:34+00:00,2024-10-07 12:09:08+00:00,https://github.com/frappe/erpnext/pull/43469,"[('needs-tests', 'This PR needs automated unit-tests.'), ('ecommerce', '')]","[{'comment_id': 2385572453, 'issue_id': 2558996980, 'author': 'mergify[bot]', 'body': 'Cherry-pick of 4a38ce659d4da7400fd219060cbcdd77ce6ccf1b has failed:\n```\nOn branch mergify/bp/version-14-hotfix/pr-31980\nYour branch is up to date with \'origin/version-14-hotfix\'.\n\nYou are currently cherry-picking commit 4a38ce659d.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/e_commerce/redisearch_utils.py\n\tboth modified:   erpnext/templates/pages/product_search.py\n\tboth modified:   pyproject.toml\n\nno changes added to commit (use ""git add"" and/or ""git commit -a"")\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 10, 1, 11, 51, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2388412635, 'issue_id': 2558996980, 'author': 'akhilnarang', 'body': '@mergifyio rebase', 'created_at': datetime.datetime(2024, 10, 2, 11, 26, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2388413031, 'issue_id': 2558996980, 'author': 'mergify[bot]', 'body': '> rebase\n\n#### ❌ Base branch update has failed\n\n<details>\n\nGit reported the following error:\n```\nRebasing (1/4)\rRebasing (2/4)\rRebasing (3/4)\rRebasing (4/4)\rThe previous cherry-pick is now empty, possibly due to conflict resolution.\nIf you wish to commit it anyway, use:\n\n    git commit --allow-empty\n\nOtherwise, please use \'git rebase --skip\'\ninteractive rebase in progress; onto 3b550ca419\nLast commands done (4 commands done):\n   pick 13f5634570 chore: resolve conflicts\n   pick 9a3c8a3c11 fix: new url for frankfurter.app, now use api.frankfurter.app\n  (see more in file .git/rebase-merge/done)\nNo commands remaining.\nYou are currently rebasing branch \'mergify/bp/version-14-hotfix/pr-31980\' on \'3b550ca419\'.\n  (all conflicts fixed: run ""git rebase --continue"")\n\nnothing to commit, working tree clean\nCould not apply 9a3c8a3c11... fix: new url for frankfurter.app, now use api.frankfurter.app\n\n```\n\n\n</details>\n\n\n<!---\nDO NOT EDIT\n-*- Mergify Payload -*-\n{""command"": ""rebase"", ""conclusion"": ""failure"", ""action_is_running"": true}\n-*- Mergify Payload End -*-\n-->', 'created_at': datetime.datetime(2024, 10, 2, 11, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2396750454, 'issue_id': 2558996980, 'author': 'akhilnarang', 'body': '#28003', 'created_at': datetime.datetime(2024, 10, 7, 12, 9, 8, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-10-01 11:51:13 UTC): Cherry-pick of 4a38ce659d4da7400fd219060cbcdd77ce6ccf1b has failed:
```
On branch mergify/bp/version-14-hotfix/pr-31980
Your branch is up to date with 'origin/version-14-hotfix'.

You are currently cherry-picking commit 4a38ce659d.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/e_commerce/redisearch_utils.py
	both modified:   erpnext/templates/pages/product_search.py
	both modified:   pyproject.toml

no changes added to commit (use ""git add"" and/or ""git commit -a"")
```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

akhilnarang on (2024-10-02 11:26:45 UTC): @mergifyio rebase

mergify[bot] (Issue Creator) on (2024-10-02 11:27:00 UTC): #### ❌ Base branch update has failed

<details>

Git reported the following error:
```
Rebasing (1/4)
Rebasing (2/4)
Rebasing (3/4)
Rebasing (4/4)
The previous cherry-pick is now empty, possibly due to conflict resolution.
If you wish to commit it anyway, use:

    git commit --allow-empty

Otherwise, please use 'git rebase --skip'
interactive rebase in progress; onto 3b550ca419
Last commands done (4 commands done):
   pick 13f5634570 chore: resolve conflicts
   pick 9a3c8a3c11 fix: new url for frankfurter.app, now use api.frankfurter.app
  (see more in file .git/rebase-merge/done)
No commands remaining.
You are currently rebasing branch 'mergify/bp/version-14-hotfix/pr-31980' on '3b550ca419'.
  (all conflicts fixed: run ""git rebase --continue"")

nothing to commit, working tree clean
Could not apply 9a3c8a3c11... fix: new url for frankfurter.app, now use api.frankfurter.app

```


</details>


<!---
DO NOT EDIT
-*- Mergify Payload -*-
{""command"": ""rebase"", ""conclusion"": ""failure"", ""action_is_running"": true}
-*- Mergify Payload End -*-
-->

akhilnarang on (2024-10-07 12:09:08 UTC): #28003

"
2558697875,pull_request,closed,,chore: release v14,Automated weekly release.,frappe-pr-bot,2024-10-01 09:36:48+00:00,[],2024-10-20 00:12:22+00:00,2024-10-04 03:02:45+00:00,https://github.com/frappe/erpnext/pull/43468,"[('stock', None), ('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2392705830, 'issue_id': 2558697875, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.74.3 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 10, 4, 3, 4, 16, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot (Issue Creator) on (2024-10-04 03:04:16 UTC): :tada: This PR is included in version 14.74.3 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2558697871,pull_request,closed,,chore: release v15,Automated weekly release.,frappe-pr-bot,2024-10-01 09:36:48+00:00,[],2024-10-20 00:12:14+00:00,2024-10-04 03:05:54+00:00,https://github.com/frappe/erpnext/pull/43467,"[('stock', None), ('buying', None)]",[],
2558622077,pull_request,closed,,fix: status plant floor,,rohitwaghchaure,2024-10-01 09:03:47+00:00,[],2024-10-17 00:11:10+00:00,2024-10-01 09:07:57+00:00,https://github.com/frappe/erpnext/pull/43466,[],[],
2558612931,pull_request,closed,,fix: Stock UOM not fetched when Stock Entry create from Item Dashboard (backport #43457),"After Fix


https://github.com/user-attachments/assets/5d1aac67-1ec1-486a-ac0c-c92a9715e322

<hr>This is an automatic backport of pull request #43457 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-01 08:59:36+00:00,['rohitwaghchaure'],2024-10-17 00:10:57+00:00,2024-10-02 13:16:02+00:00,https://github.com/frappe/erpnext/pull/43465,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2558408685,pull_request,closed,,Serial no report (backport #43444),"
![371080072-a8d22a0d-7b9d-43cc-bdde-da984e76c9e8](https://github.com/user-attachments/assets/f193c033-29b4-4d1f-9f0e-d29d9db70bd1)

face this error in 3 report 
  1.serial no warranty expiry
  2.serial no status
  3.serial no service contract expiry
  
so solve  it 

###  **solution :**

remove the some field and filters that is not present in the serial no Doctype
<hr>This is an automatic backport of pull request #43444 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-01 07:27:39+00:00,[],2024-10-17 00:11:12+00:00,2024-10-01 08:57:27+00:00,https://github.com/frappe/erpnext/pull/43464,[],[],
2558403611,pull_request,closed,,fix: removed validation for materials return (backport #43461),<hr>This is an automatic backport of pull request #43461 done by [Mergify](https://mergify.com).,mergify[bot],2024-10-01 07:25:04+00:00,['rohitwaghchaure'],2024-10-17 00:11:13+00:00,2024-10-01 08:56:38+00:00,https://github.com/frappe/erpnext/pull/43463,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2558357302,pull_request,closed,,fix: get stock accounts from the doc in `validate_stock_accounts` in Journal Entry,"Issue: 
`get_stock_accounts` is getting the stock accounts from the database instead of the current updated doc for Journal Entry.",vishakhdesai,2024-10-01 06:59:22+00:00,[],2024-11-07 00:11:36+00:00,2024-10-22 14:04:32+00:00,https://github.com/frappe/erpnext/pull/43462,"[('accounts', ''), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2558346276,pull_request,closed,,fix: removed validation for materials return,,rohitwaghchaure,2024-10-01 06:52:48+00:00,[],2024-10-17 00:11:18+00:00,2024-10-01 07:23:34+00:00,https://github.com/frappe/erpnext/pull/43461,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]",[],
2558323824,pull_request,closed,,feat: multiple purchase invoice in asset repair doctype,"## Background/Context

1. In the “Asset Repair” doc type we can add only one single purchase invoice in a single record.
2. However, in real case repairs expenses incurred can be booked via multiple invoices.
3. Also, repairs services for an asset can be availed from more than one supplier. We are not able to select multiple invoices while making a repair entry.

## Solution Summary

1. Use child table to select multiple purchase invoices in the one asset repair (as shown in the below screenshot).
2. Auto calculate the repair cost on the basis of all the purchase invoice amount.
3. Remove the single purchase invoice standard field from the doctype.



![image](https://github.com/user-attachments/assets/7baf8b01-f47e-4256-a59f-fc3a13a9b9a7)

#no-docs",rahulgupta8848,2024-10-01 06:40:19+00:00,[],2024-10-17 00:11:15+00:00,2024-10-01 07:30:51+00:00,https://github.com/frappe/erpnext/pull/43460,[],[],
2558245680,pull_request,closed,,fix: add company filter in Warehouse wise Item Balance Age and Value (backport #43455),"Version 15

fixes: #43443

**Before:**

- Report is fetching and filtering company from session defaults and showing stock only for selected company, it's difficult for user.

https://github.com/user-attachments/assets/c6f7601b-6e68-4cf6-935f-ba97caeaa6a7


<br>

**After:**

- Adding the company filter, removing unnecessary conditions from the report, and displaying warehouse by company.

https://github.com/user-attachments/assets/92cdc47f-f449-4fca-955d-258256ffd69c

<hr>This is an automatic backport of pull request #43455 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-01 05:47:39+00:00,['Nihantra-Patel'],2024-10-17 00:11:20+00:00,2024-10-01 06:16:46+00:00,https://github.com/frappe/erpnext/pull/43459,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2558245639,pull_request,closed,,fix: add company filter in Warehouse wise Item Balance Age and Value (backport #43455),"Version 15

fixes: #43443

**Before:**

- Report is fetching and filtering company from session defaults and showing stock only for selected company, it's difficult for user.

https://github.com/user-attachments/assets/c6f7601b-6e68-4cf6-935f-ba97caeaa6a7


<br>

**After:**

- Adding the company filter, removing unnecessary conditions from the report, and displaying warehouse by company.

https://github.com/user-attachments/assets/92cdc47f-f449-4fca-955d-258256ffd69c

<hr>This is an automatic backport of pull request #43455 done by [Mergify](https://mergify.com).",mergify[bot],2024-10-01 05:47:37+00:00,['Nihantra-Patel'],2024-10-20 00:12:17+00:00,2024-10-01 06:16:54+00:00,https://github.com/frappe/erpnext/pull/43458,"[('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2392706029, 'issue_id': 2558245639, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.74.3 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 10, 4, 3, 4, 31, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-10-04 03:04:31 UTC): :tada: This PR is included in version 14.74.3 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2558233123,pull_request,closed,,fix: Stock UOM not fetched when Stock Entry create from Item Dashboard,"After Fix


https://github.com/user-attachments/assets/5d1aac67-1ec1-486a-ac0c-c92a9715e322

",rohitwaghchaure,2024-10-01 05:38:16+00:00,[],2024-10-17 00:11:11+00:00,2024-10-01 08:57:55+00:00,https://github.com/frappe/erpnext/pull/43457,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]",[],
2558217887,pull_request,closed,,fix: add company filter in Warehouse wise Item Balance Age and Value,"Version 15

fixes: #43443

**Before:**

- Report is fetching and filtering company from session defaults and showing stock only for selected company, it's difficult for user.

https://github.com/user-attachments/assets/c6f7601b-6e68-4cf6-935f-ba97caeaa6a7


<br>

**After:**

- Adding the company filter, removing unnecessary conditions from the report, and displaying warehouse by company.

https://github.com/user-attachments/assets/92cdc47f-f449-4fca-955d-258256ffd69c

",Nihantra-Patel,2024-10-01 05:27:22+00:00,[],2024-10-17 00:11:21+00:00,2024-10-01 05:46:13+00:00,https://github.com/frappe/erpnext/pull/43455,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2558051445,pull_request,closed,,fix: negative stock error for batch (backport #43450),If there is no changes in the quantity for the stock reco then do not throw negative stock error.<hr>This is an automatic backport of pull request #43450 done by [Mergify](https://mergify.com).,mergify[bot],2024-10-01 02:50:00+00:00,['rohitwaghchaure'],2024-10-17 00:11:24+00:00,2024-10-01 05:04:48+00:00,https://github.com/frappe/erpnext/pull/43454,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2557051186,pull_request,closed,,feat: added 'cost of new capitalized asset' column (backport #43399) (backport #43412),"Added a new column, `Cost of New Capitalized Asset`, to the asset depreciation and balances report. This column shows capitalized assets within the selected date range, fixing the issue where the report previously displayed incorrect data. The update ensures the report now provides accurate information.
`no-docs`
<hr>This is an automatic backport of pull request #43399 done by [Mergify](https://mergify.com).<hr>This is an automatic backport of pull request #43412 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-30 15:46:04+00:00,[],2024-10-17 00:11:27+00:00,2024-09-30 17:19:53+00:00,https://github.com/frappe/erpnext/pull/43453,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2556882519,pull_request,closed,,fix: last purchase rate for purchase invoice (backport #43448),"1. Create the Purchase Invoice with rate as 200, the last purchase rate in the item master set as 200
2. Create the Purchase Invoice with rate as 300, the last purchase rate in the item master set as 300
3. Cancel the second purchase invoice, the last purchase rate in the item master should be 200 but it's showing the rate as 300


<hr>This is an automatic backport of pull request #43448 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-30 14:36:27+00:00,['rohitwaghchaure'],2024-10-17 00:11:17+00:00,2024-10-01 07:24:27+00:00,https://github.com/frappe/erpnext/pull/43452,"[('buying', None)]","[{'comment_id': 2383392761, 'issue_id': 2556882519, 'author': 'mergify[bot]', 'body': 'Cherry-pick of fb9d10663388431644ac1798ba1f9363d9db2775 has failed:\n```\nOn branch mergify/bp/version-15-hotfix/pr-43448\nYour branch is up to date with \'origin/version-15-hotfix\'.\n\nYou are currently cherry-picking commit fb9d106633.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tmodified:   erpnext/controllers/buying_controller.py\n\tmodified:   erpnext/public/js/controllers/transaction.js\n\tmodified:   erpnext/stock/doctype/item/item.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/accounts/doctype/purchase_invoice/test_purchase_invoice.py\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 9, 30, 14, 36, 29, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-09-30 14:36:29 UTC): Cherry-pick of fb9d10663388431644ac1798ba1f9363d9db2775 has failed:
```
On branch mergify/bp/version-15-hotfix/pr-43448
Your branch is up to date with 'origin/version-15-hotfix'.

You are currently cherry-picking commit fb9d106633.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	modified:   erpnext/controllers/buying_controller.py
	modified:   erpnext/public/js/controllers/transaction.js
	modified:   erpnext/stock/doctype/item/item.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/accounts/doctype/purchase_invoice/test_purchase_invoice.py

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2556881711,pull_request,closed,,fix: last purchase rate for purchase invoice (backport #43448),"1. Create the Purchase Invoice with rate as 200, the last purchase rate in the item master set as 200
2. Create the Purchase Invoice with rate as 300, the last purchase rate in the item master set as 300
3. Cancel the second purchase invoice, the last purchase rate in the item master should be 200 but it's showing the rate as 300


<hr>This is an automatic backport of pull request #43448 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-30 14:36:07+00:00,['rohitwaghchaure'],2024-10-17 00:11:23+00:00,2024-10-01 05:19:01+00:00,https://github.com/frappe/erpnext/pull/43451,"[('buying', None), ('conflicts', None)]","[{'comment_id': 2383391904, 'issue_id': 2556881711, 'author': 'mergify[bot]', 'body': 'Cherry-pick of fb9d10663388431644ac1798ba1f9363d9db2775 has failed:\n```\nOn branch mergify/bp/version-14-hotfix/pr-43448\nYour branch is up to date with \'origin/version-14-hotfix\'.\n\nYou are currently cherry-picking commit fb9d106633.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tmodified:   erpnext/controllers/buying_controller.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/accounts/doctype/purchase_invoice/test_purchase_invoice.py\n\tboth modified:   erpnext/public/js/controllers/transaction.js\n\tboth modified:   erpnext/stock/doctype/item/item.py\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 9, 30, 14, 36, 9, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-09-30 14:36:09 UTC): Cherry-pick of fb9d10663388431644ac1798ba1f9363d9db2775 has failed:
```
On branch mergify/bp/version-14-hotfix/pr-43448
Your branch is up to date with 'origin/version-14-hotfix'.

You are currently cherry-picking commit fb9d106633.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	modified:   erpnext/controllers/buying_controller.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/accounts/doctype/purchase_invoice/test_purchase_invoice.py
	both modified:   erpnext/public/js/controllers/transaction.js
	both modified:   erpnext/stock/doctype/item/item.py

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2556875445,pull_request,closed,,fix: negative stock error for batch,If there is no changes in the quantity for the stock reco then do not throw negative stock error.,rohitwaghchaure,2024-09-30 14:33:38+00:00,[],2024-10-17 00:11:25+00:00,2024-10-01 02:49:05+00:00,https://github.com/frappe/erpnext/pull/43450,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]",[],
2556732536,pull_request,closed,,"fix: override indicator color for  ""Draft""","indicator colour was not overridden because `has_indicator_for_draft` was not set.

Before:
![image](https://github.com/user-attachments/assets/07b9aa08-55db-446e-aac4-feb154a849b7)

After:
![image](https://github.com/user-attachments/assets/97b3bc9b-fd5f-4b6a-9e4e-21123c1b1369)


Frappe Support Issue: https://support.frappe.io/app/hd-ticket/22685


",ljain112,2024-09-30 13:43:29+00:00,[],2024-12-03 00:13:33+00:00,2024-11-17 08:13:59+00:00,https://github.com/frappe/erpnext/pull/43449,"[('inactive', '')]","[{'comment_id': 2394425170, 'issue_id': 2556732536, 'author': 'dj12djdjs', 'body': ""shouldn't  `has_indicator_for_draft` be set for any submittable doctype? If so, it seems like this is a framework level issue."", 'created_at': datetime.datetime(2024, 10, 4, 19, 21, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2399689098, 'issue_id': 2556732536, 'author': 'sagarvora', 'body': '> shouldn\'t `has_indicator_for_draft` be set for any submittable doctype? If so, it seems like this is a framework level issue.\r\n\r\nSo this flag is there to specify: ""whether I should use `get_indicator` for Draft status or not""\r\nCode: https://github.com/frappe/frappe/blob/5324431fc013ef5f63102680e18bd934c71daa95/frappe/public/js/frappe/model/indicator.js#L72\r\n\r\nCurrent implementations of `get_indicator` may not all work correctly for Draft (for example if they have an `else` block), so changing this design would be a breaking change.', 'created_at': datetime.datetime(2024, 10, 8, 12, 19, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2442882514, 'issue_id': 2556732536, 'author': 'stale[bot]', 'body': ""This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing."", 'created_at': datetime.datetime(2024, 10, 28, 23, 47, 55, tzinfo=datetime.timezone.utc)}]","dj12djdjs on (2024-10-04 19:21:37 UTC): shouldn't  `has_indicator_for_draft` be set for any submittable doctype? If so, it seems like this is a framework level issue.

sagarvora on (2024-10-08 12:19:11 UTC): So this flag is there to specify: ""whether I should use `get_indicator` for Draft status or not""
Code: https://github.com/frappe/frappe/blob/5324431fc013ef5f63102680e18bd934c71daa95/frappe/public/js/frappe/model/indicator.js#L72

Current implementations of `get_indicator` may not all work correctly for Draft (for example if they have an `else` block), so changing this design would be a breaking change.

stale[bot] on (2024-10-28 23:47:55 UTC): This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing.

"
2556611286,pull_request,closed,,fix: last purchase rate for purchase invoice,"1. Create the Purchase Invoice with rate as 200, the last purchase rate in the item master set as 200
2. Create the Purchase Invoice with rate as 300, the last purchase rate in the item master set as 300
3. Cancel the second purchase invoice, the last purchase rate in the item master should be 200 but it's showing the rate as 300


",rohitwaghchaure,2024-09-30 13:01:17+00:00,['rohitwaghchaure'],2024-10-17 00:11:30+00:00,2024-09-30 14:35:00+00:00,https://github.com/frappe/erpnext/pull/43448,"[('buying', None), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2556505263,pull_request,closed,,fix(return): set default return warehouse (backport #43446),"This captures the case of manual modifications to the return and ensures
that by default, the correct return warehouse will be set
<hr>This is an automatic backport of pull request #43446 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-30 12:28:17+00:00,"['ruthra-kumar', 'blaggacao']",2024-11-19 00:11:50+00:00,2024-11-04 07:56:02+00:00,https://github.com/frappe/erpnext/pull/43447,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2556457756,pull_request,closed,,fix(return): set default return warehouse,"This captures the case of manual modifications to the return and ensures
that by default, the correct return warehouse will be set
",blaggacao,2024-09-30 12:08:19+00:00,[],2024-10-17 00:11:31+00:00,2024-09-30 12:27:00+00:00,https://github.com/frappe/erpnext/pull/43446,"[('backport version-15-hotfix', '')]",[],
2556432480,pull_request,closed,,Serial no report,"
![371080072-a8d22a0d-7b9d-43cc-bdde-da984e76c9e8](https://github.com/user-attachments/assets/f193c033-29b4-4d1f-9f0e-d29d9db70bd1)

face this error in 3 report 
  1.serial no warranty expiry
  2.serial no status
  3.serial no service contract expiry
  
so solve  it 

###  **solution :**

remove the some field and filters that is not present in the serial no Doctype
",Vishv-024,2024-09-30 11:57:42+00:00,['rohitwaghchaure'],2024-10-17 00:11:16+00:00,2024-10-01 06:57:05+00:00,https://github.com/frappe/erpnext/pull/43444,"[('backport version-15-hotfix', '')]",[],
2556304195,pull_request,closed,,97 asset after submission of asset maintenance showing error,,Prateek8848,2024-09-30 11:02:18+00:00,[],2024-10-17 00:11:33+00:00,2024-09-30 11:20:33+00:00,https://github.com/frappe/erpnext/pull/43442,"[('accounts', ''), ('stock', None), ('CRM', None), ('selling', None), ('buying', None), ('assets', ''), ('projects', 'projects module related issue / PR')]",[],
2556214144,pull_request,closed,,PROJECT ISSUE(55),"<!--

Some key notes before you open a PR:

 1. Select which branch should this PR be merged in?
 2. PR name follows [convention](http://karma-runner.github.io/4.0/dev/git-commit-msg.html)
 3. All tests pass locally, UI and Unit tests
 4. All business logic and validations must be on the server-side
 5. Update necessary Documentation
 6. Put `closes #XXXX` in your comment to auto-close the issue that your PR fixes


Also, if you're new here

- Documentation Guidelines => https://github.com/frappe/erpnext/wiki/Updating-Documentation

- Contribution Guide => https://github.com/frappe/erpnext/blob/develop/.github/CONTRIBUTING.md

- Pull Request Checklist => https://github.com/frappe/erpnext/wiki/Pull-Request-Checklist

-->

> Please provide enough information so that others can review your pull request:

<!-- You can skip this if you're fixing a typo or updating existing documentation -->

> Explain the **details** for making this change. What existing problem does the pull request solve?

<!-- Example: When ""Adding a function to do X"", explain why it is necessary to have a way to do X. -->

> Screenshots/GIFs

<!-- Add images/recordings to better visualize the change: expected/current behviour -->
",rajnish8848,2024-09-30 10:24:25+00:00,[],2024-10-20 00:12:13+00:00,2024-10-04 19:12:27+00:00,https://github.com/frappe/erpnext/pull/43441,"[('accounts', ''), ('stock', None), ('CRM', None), ('selling', None), ('buying', None), ('assets', ''), ('projects', 'projects module related issue / PR')]","[{'comment_id': 2394404557, 'issue_id': 2556214144, 'author': 'dj12djdjs', 'body': '@rajnish8848 2k commits this is a mistake. I think you need to rebase your branch from develop.', 'created_at': datetime.datetime(2024, 10, 4, 19, 12, 27, tzinfo=datetime.timezone.utc)}]","dj12djdjs on (2024-10-04 19:12:27 UTC): @rajnish8848 2k commits this is a mistake. I think you need to rebase your branch from develop.

"
2556008700,pull_request,closed,,fix: adjustment entry for stock reco (backport #43437),<hr>This is an automatic backport of pull request #43437 done by [Mergify](https://mergify.com).,mergify[bot],2024-09-30 08:58:11+00:00,['rohitwaghchaure'],2024-10-17 00:11:34+00:00,2024-09-30 10:08:00+00:00,https://github.com/frappe/erpnext/pull/43440,"[('stock', None), ('needs-tests', 'This PR needs automated unit-tests.')]",[],
2556008598,pull_request,closed,,fix: adjustment entry for stock reco (backport #43437),<hr>This is an automatic backport of pull request #43437 done by [Mergify](https://mergify.com).,mergify[bot],2024-09-30 08:58:09+00:00,['rohitwaghchaure'],2024-10-20 00:12:16+00:00,2024-09-30 10:08:09+00:00,https://github.com/frappe/erpnext/pull/43439,"[('stock', None), ('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2392706067, 'issue_id': 2556008598, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.74.3 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 10, 4, 3, 4, 34, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-10-04 03:04:34 UTC): :tada: This PR is included in version 14.74.3 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2555899171,pull_request,closed,,fix: 'NoneType' object has no attribute 'has_serial_no' (backport #43436),"**Issue**

Items not exists but still trying to upload through stock reco, system throwing below error

```
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1322, in composer
    return composed(self, method, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1304, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 959, in fn
    return method_object(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/erpnext/erpnext/stock/doctype/stock_reconciliation/stock_reconciliation.py"", line 71, in validate
    self.set_current_serial_and_batch_bundle()
  File ""apps/erpnext/erpnext/stock/doctype/stock_reconciliation/stock_reconciliation.py"", line 184, in set_current_serial_and_batch_bundle
    if not (item_details.has_serial_no or item_details.has_batch_no):
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'has_serial_no'
```<hr>This is an automatic backport of pull request #43436 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-30 08:11:26+00:00,['rohitwaghchaure'],2024-10-17 00:11:36+00:00,2024-09-30 08:56:17+00:00,https://github.com/frappe/erpnext/pull/43438,"[('stock', None), ('needs-tests', 'This PR needs automated unit-tests.')]",[],
2555894640,pull_request,closed,,fix: adjustment entry for stock reco,,rohitwaghchaure,2024-09-30 08:09:20+00:00,[],2024-10-17 00:11:35+00:00,2024-09-30 08:56:25+00:00,https://github.com/frappe/erpnext/pull/43437,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2555700055,pull_request,closed,,fix: 'NoneType' object has no attribute 'has_serial_no',"**Issue**

Items not exists but still trying to upload through stock reco, system throwing below error

```
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1322, in composer
    return composed(self, method, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1304, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 959, in fn
    return method_object(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/erpnext/erpnext/stock/doctype/stock_reconciliation/stock_reconciliation.py"", line 71, in validate
    self.set_current_serial_and_batch_bundle()
  File ""apps/erpnext/erpnext/stock/doctype/stock_reconciliation/stock_reconciliation.py"", line 184, in set_current_serial_and_batch_bundle
    if not (item_details.has_serial_no or item_details.has_batch_no):
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'has_serial_no'
```",rohitwaghchaure,2024-09-30 06:38:45+00:00,[],2024-10-17 00:11:37+00:00,2024-09-30 08:09:59+00:00,https://github.com/frappe/erpnext/pull/43436,"[('stock', None), ('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]",[],
2555680855,pull_request,closed,,perf: performance optimizations for accounting reports by refactoring account closing balance and period closing voucher,"### Problem:
- The Trial balance report was getting timed out after 30 mins
- AR/AP reports were taking 15-20 mins
- Account closing balance patch was taking too much time
- The processing period for closing the voucher was taking too much time.
- GL Entry form fields are not organized

### Solutions:
- Refactored account closing balance and period closing voucher code by processing GLE in chunk
- Rewritten the closing balance patch
- Optimized trial balance and AR/AP
- Added indexes in GLE based on (party_type, party) and (company, posting_date)
- Introduced ""period start date"" and ""period end date"" in PCV to handle monthly closing vouchers and written patches.
- Organized fields in GLE

### Result:
- Trial Balance is running in 2 mins
- AR/AP reports are running within a min
- Account closing balance patch is running much faster than before

#no-docs",nabinhait,2024-09-30 06:26:49+00:00,[],2024-11-07 00:11:12+00:00,2024-10-23 06:23:10+00:00,https://github.com/frappe/erpnext/pull/43435,"[('accounts', ''), ('backport version-15-hotfix', '')]",[],
2555483075,pull_request,closed,,refactor: use hooks to extend bulk_transaction (backport #43058),"Bulk Transaction is very useful feature, but now it is really difficult to add more methods.

When creating a new app, there is a chance that the the new kind of bulk transaction is required. 

This PR move the mapper function inside a Doctype so it can be extened by super() in other app (I can't find a proper doctype other than Bulk Transaction Detail Log to place the get_mapper()).

I.e., I have a new app, and so I can do something like this with override_doctype_class.

```
from erpnext.bulk_transaction.doctype.bulk_transaction_log_detail.bulk_transaction_log_detail import BulkTransactionLogDetail


class BulkTransactionLogDetailThaiPayroll(BulkTransactionLogDetail):
    
    def get_mapper(self):
        from thai_payroll.custom import salary_slip
        mapper = super().get_mapper()
        mapper.update({
            ""Salary Slip"": {
		    	""Withholding Tax Cert Employee"": salary_slip.make_withholding_tax_cert_employee,
		    },
        })
        return mapper
```

Note: IMHO, writing method within a class should be a preferred way to allow easier extension. Currently, in many case, I always need to do monkey patch and method overwrite (which is not good for upgrade).<hr>This is an automatic backport of pull request #43058 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-30 04:07:54+00:00,['ruthra-kumar'],2024-10-17 00:11:39+00:00,2024-09-30 04:28:44+00:00,https://github.com/frappe/erpnext/pull/43434,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2555030348,pull_request,closed,,fix: Stock Ledger Invariant Check report (backport #43420),"**Issue**

<img width=""635"" alt=""image"" src=""https://github.com/user-attachments/assets/0bceacc8-a2f2-4835-b383-02e2215d835b"">
<hr>This is an automatic backport of pull request #43420 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-29 17:07:38+00:00,['rohitwaghchaure'],2024-10-17 00:11:41+00:00,2024-09-29 17:25:58+00:00,https://github.com/frappe/erpnext/pull/43433,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2555030335,pull_request,closed,,fix: Stock Ledger Invariant Check report (backport #43420),"**Issue**

<img width=""635"" alt=""image"" src=""https://github.com/user-attachments/assets/0bceacc8-a2f2-4835-b383-02e2215d835b"">
<hr>This is an automatic backport of pull request #43420 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-29 17:07:36+00:00,['rohitwaghchaure'],2024-10-20 00:12:15+00:00,2024-09-30 08:09:47+00:00,https://github.com/frappe/erpnext/pull/43432,"[('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2392706102, 'issue_id': 2555030335, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.74.3 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 10, 4, 3, 4, 37, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-10-04 03:04:37 UTC): :tada: This PR is included in version 14.74.3 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.3)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2555001412,pull_request,closed,,"fix: Data missing in table: None, MandatoryError (backport #43422) (backport #43429)",This is an automatic backport of pull request #43422 done by [Mergify](https://mergify.com).<hr>This is an automatic backport of pull request #43429 done by [Mergify](https://mergify.com).,mergify[bot],2024-09-29 15:57:26+00:00,[],2024-10-17 00:11:44+00:00,2024-09-29 16:37:02+00:00,https://github.com/frappe/erpnext/pull/43431,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2555000598,pull_request,closed,,fix: tests for work order consumption (backport #41814),"Tests that reproduce the following issues:

https://github.com/frappe/erpnext/issues/41798
https://github.com/frappe/erpnext/issues/41800

These failing tests illustrate the above issues which appear to originate here when consuming materials:

https://github.com/frappe/erpnext/blob/699cfd85c64916163f6ef156d47297c5725028ac/erpnext/stock/doctype/stock_entry/stock_entry.py#L3036<hr>This is an automatic backport of pull request #41814 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-29 15:55:24+00:00,[],2024-10-20 00:12:28+00:00,2024-09-29 16:36:50+00:00,https://github.com/frappe/erpnext/pull/43430,[],[],
2554990996,pull_request,closed,,"fix: Data missing in table: None, MandatoryError (backport #43422)",This is an automatic backport of pull request #43422 done by [Mergify](https://mergify.com).,mergify[bot],2024-09-29 15:32:02+00:00,['rohitwaghchaure'],2024-10-20 00:12:29+00:00,2024-09-29 15:48:25+00:00,https://github.com/frappe/erpnext/pull/43429,"[('needs-tests', 'This PR needs automated unit-tests.')]","[{'comment_id': 2381407897, 'issue_id': 2554990996, 'author': 'rohitwaghchaure', 'body': '@Mergify backport version-15', 'created_at': datetime.datetime(2024, 9, 29, 15, 56, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2381407941, 'issue_id': 2554990996, 'author': 'mergify[bot]', 'body': '> backport version-15\n\n#### ✅ Backports have been created\n\n<details>\n\n* [#43431 fix: Data missing in table: None, MandatoryError (backport #43422) (backport #43429)](https://github.com/frappe/erpnext/pull/43431) has been created for branch `version-15`\n\n</details>\n\n\n<!---\nDO NOT EDIT\n-*- Mergify Payload -*-\n{""command"": ""backport version-15"", ""conclusion"": ""success"", ""action_is_running"": true}\n-*- Mergify Payload End -*-\n-->', 'created_at': datetime.datetime(2024, 9, 29, 15, 57, 10, tzinfo=datetime.timezone.utc)}]","rohitwaghchaure (Assginee) on (2024-09-29 15:56:58 UTC): @Mergify backport version-15

mergify[bot] (Issue Creator) on (2024-09-29 15:57:10 UTC): #### ✅ Backports have been created

<details>

* [#43431 fix: Data missing in table: None, MandatoryError (backport #43422) (backport #43429)](https://github.com/frappe/erpnext/pull/43431) has been created for branch `version-15`

</details>


<!---
DO NOT EDIT
-*- Mergify Payload -*-
{""command"": ""backport version-15"", ""conclusion"": ""success"", ""action_is_running"": true}
-*- Mergify Payload End -*-
-->

"
2554975490,pull_request,closed,,fix!: don't round unduly,"BREAKING: If you previously relied on the undue rounding of the tax
amount within the item wise tax detail, revise your code and config.
",blaggacao,2024-09-29 14:56:32+00:00,[],2024-10-17 00:11:29+00:00,2024-09-30 15:22:03+00:00,https://github.com/frappe/erpnext/pull/43428,"[('accounts', ''), ('needs-tests', 'This PR needs automated unit-tests.')]","[{'comment_id': 2383000491, 'issue_id': 2554975490, 'author': 'blaggacao', 'body': ""@ruthra-kumar can I move ahead with this one? &mdash; it's purpose takes effect in downstream PRs, but this seems important to revise independently."", 'created_at': datetime.datetime(2024, 9, 30, 12, 4, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2383013123, 'issue_id': 2554975490, 'author': 'ruthra-kumar', 'body': ""I'm not clear on what issue this change fixes."", 'created_at': datetime.datetime(2024, 9, 30, 12, 10, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2383035773, 'issue_id': 2554975490, 'author': 'blaggacao', 'body': '@ruthra-kumar It fails (for example) this XSL assertion as a summand of type `cbc:TaxableAmount` (on the `cac:InvoiceLine`) on rounding edge cases, even though one explicitly has disabled row-wise rounding in the relevant configuration.\r\n\r\n```xml\r\n\t\t    <!--ASSERT -->\r\n      <xsl:choose>\r\n         <xsl:when test=""if (../cac:TaxTotal/cac:TaxSubtotal/cac:TaxCategory/cac:TaxScheme/cbc:ID = \'01\') then (every $i in ../cac:TaxTotal[cac:TaxSubtotal/cac:TaxCategory/cac:TaxScheme/cbc:ID = \'01\']/cac:TaxSubtotal satisfies round($i/cbc:TaxAmount) = round((($i/cbc:TaxableAmount * $i/cac:TaxCategory/cbc:Percent) div 100))) else true()""/>\r\n         <xsl:otherwise>\r\n            <xsl:message xmlns:iso=""http://purl.oclc.org/dsdl/schematron"">\r\n               <xsl:text>Fatal:</xsl:text>\r\n               <xsl:text> </xsl:text>\r\n               <xsl:text/>\r\n               <xsl:value-of select=""if (boolean(/ubl:Invoice)) then \'[FAS07]\' else if (boolean(/cn:CreditNote)) then \'[CAS07]\' else if (boolean(/dn:DebitNote)) then \'[DAS07]\' else \'\'""/>\r\n               <xsl:text/>\r\n               <xsl:text>- (R) El valor del tributo correspondiente a una de las tarifas </xsl:text>\r\n               <xsl:text/>\r\n               <xsl:value-of select=""round(../cac:TaxTotal[cac:TaxSubtotal/cac:TaxCategory/cac:TaxScheme/cbc:ID = \'01\']/cbc:TaxAmount)""/>\r\n               <xsl:text/>\r\n               <xsl:text> es diferente del producto del porcentaje aplicado sobre la base imponible : </xsl:text>\r\n               <xsl:text/>\r\n               <xsl:value-of select=""round(((../cac:TaxTotal/cac:TaxSubtotal[cac:TaxCategory/cac:TaxScheme/cbc:ID = \'01\']/cbc:TaxableAmount * ../cac:TaxTotal/cac:TaxSubtotal[cac:TaxCategory/cac:TaxScheme/cbc:ID = \'01\']/cbc:Percent) div 100))""/>\r\n               <xsl:text/>\r\n               <xsl:text> </xsl:text>\r\n            </xsl:message>\r\n         </xsl:otherwise>\r\n      </xsl:choose>\r\n```', 'created_at': datetime.datetime(2024, 9, 30, 12, 21, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2383483381, 'issue_id': 2554975490, 'author': 'ruthra-kumar', 'body': 'I think we can go-ahead with this change solely from configuration point-of-view.', 'created_at': datetime.datetime(2024, 9, 30, 15, 10, 38, tzinfo=datetime.timezone.utc)}]","blaggacao (Issue Creator) on (2024-09-30 12:04:47 UTC): @ruthra-kumar can I move ahead with this one? &mdash; it's purpose takes effect in downstream PRs, but this seems important to revise independently.

ruthra-kumar on (2024-09-30 12:10:38 UTC): I'm not clear on what issue this change fixes.

blaggacao (Issue Creator) on (2024-09-30 12:21:22 UTC): @ruthra-kumar It fails (for example) this XSL assertion as a summand of type `cbc:TaxableAmount` (on the `cac:InvoiceLine`) on rounding edge cases, even though one explicitly has disabled row-wise rounding in the relevant configuration.

```xml
		    <!--ASSERT -->
      <xsl:choose>
         <xsl:when test=""if (../cac:TaxTotal/cac:TaxSubtotal/cac:TaxCategory/cac:TaxScheme/cbc:ID = '01') then (every $i in ../cac:TaxTotal[cac:TaxSubtotal/cac:TaxCategory/cac:TaxScheme/cbc:ID = '01']/cac:TaxSubtotal satisfies round($i/cbc:TaxAmount) = round((($i/cbc:TaxableAmount * $i/cac:TaxCategory/cbc:Percent) div 100))) else true()""/>
         <xsl:otherwise>
            <xsl:message xmlns:iso=""http://purl.oclc.org/dsdl/schematron"">
               <xsl:text>Fatal:</xsl:text>
               <xsl:text> </xsl:text>
               <xsl:text/>
               <xsl:value-of select=""if (boolean(/ubl:Invoice)) then '[FAS07]' else if (boolean(/cn:CreditNote)) then '[CAS07]' else if (boolean(/dn:DebitNote)) then '[DAS07]' else ''""/>
               <xsl:text/>
               <xsl:text>- (R) El valor del tributo correspondiente a una de las tarifas </xsl:text>
               <xsl:text/>
               <xsl:value-of select=""round(../cac:TaxTotal[cac:TaxSubtotal/cac:TaxCategory/cac:TaxScheme/cbc:ID = '01']/cbc:TaxAmount)""/>
               <xsl:text/>
               <xsl:text> es diferente del producto del porcentaje aplicado sobre la base imponible : </xsl:text>
               <xsl:text/>
               <xsl:value-of select=""round(((../cac:TaxTotal/cac:TaxSubtotal[cac:TaxCategory/cac:TaxScheme/cbc:ID = '01']/cbc:TaxableAmount * ../cac:TaxTotal/cac:TaxSubtotal[cac:TaxCategory/cac:TaxScheme/cbc:ID = '01']/cbc:Percent) div 100))""/>
               <xsl:text/>
               <xsl:text> </xsl:text>
            </xsl:message>
         </xsl:otherwise>
      </xsl:choose>
```

ruthra-kumar on (2024-09-30 15:10:38 UTC): I think we can go-ahead with this change solely from configuration point-of-view.

"
2554907598,pull_request,closed,,fix: show total amount on report summary,"Issue:
Balance sheet report summary showing incorrect amount
ref: [22662](https://support.frappe.io/helpdesk/tickets/22662)

![Issue](https://github.com/user-attachments/assets/2802eb8a-c0ab-4ea4-a7fb-3015c0d7c1fa)

![Fix](https://github.com/user-attachments/assets/37b3bb7e-90bf-4b19-8d8b-9f7b940fd689)

Backport needed: v15",venkat102,2024-09-29 12:24:34+00:00,['ruthra-kumar'],2024-11-01 00:12:18+00:00,2024-10-15 00:32:33+00:00,https://github.com/frappe/erpnext/pull/43426,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]","[{'comment_id': 2411527382, 'issue_id': 2554907598, 'author': 'ruthra-kumar', 'body': '@venkat102 Rebase this on latest develop', 'created_at': datetime.datetime(2024, 10, 14, 15, 0, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2411716408, 'issue_id': 2554907598, 'author': 'venkat102', 'body': '@ruthra-kumar rebased the branch', 'created_at': datetime.datetime(2024, 10, 14, 16, 22, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2412666123, 'issue_id': 2554907598, 'author': 'ruthra-kumar', 'body': '@mergify backport version-15-hotfix', 'created_at': datetime.datetime(2024, 10, 15, 2, 6, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2412666209, 'issue_id': 2554907598, 'author': 'mergify[bot]', 'body': '> backport version-15-hotfix\n\n#### ❌ No backport have been created\n\n<details>\n\n* Backport to branch `version-15-hotfix` failed\n\nGit reported the following error:\n```\nerror: commit 8751d09d69e51f2201996de366252f360d34302f is a merge but no -m option was given.\nfatal: cherry-pick failed\n\n```\n\n\n</details>\n\n\n<!---\nDO NOT EDIT\n-*- Mergify Payload -*-\n{""command"": ""backport version-15-hotfix"", ""conclusion"": ""failure"", ""action_is_running"": true}\n-*- Mergify Payload End -*-\n-->', 'created_at': datetime.datetime(2024, 10, 15, 2, 6, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2412671267, 'issue_id': 2554907598, 'author': 'ruthra-kumar', 'body': ""@venkat102 \r\nRather than a [merge](https://github.com/frappe/erpnext/pull/43426/commits/8751d09d69e51f2201996de366252f360d34302f) commit, would suggest you to do [rebase](https://git-scm.com/docs/git-rebase) on future PR's. PR's with merge commits cannot be auto-backported https://github.com/frappe/erpnext/pull/43426#issuecomment-2412666209\r\n\r\n\r\nCan you create a manual backport for v15"", 'created_at': datetime.datetime(2024, 10, 15, 2, 13, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2412997330, 'issue_id': 2554907598, 'author': 'venkat102', 'body': ""@ruthra-kumar sure will do rebase in the future PR's\r\nI'll create a manual backport for this"", 'created_at': datetime.datetime(2024, 10, 15, 6, 24, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2418669283, 'issue_id': 2554907598, 'author': 'venkat102', 'body': 'v15 backport: #43708', 'created_at': datetime.datetime(2024, 10, 17, 6, 49, 6, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Assginee) on (2024-10-14 15:00:11 UTC): @venkat102 Rebase this on latest develop

venkat102 (Issue Creator) on (2024-10-14 16:22:57 UTC): @ruthra-kumar rebased the branch

ruthra-kumar (Assginee) on (2024-10-15 02:06:47 UTC): @mergify backport version-15-hotfix

mergify[bot] on (2024-10-15 02:06:53 UTC): #### ❌ No backport have been created

<details>

* Backport to branch `version-15-hotfix` failed

Git reported the following error:
```
error: commit 8751d09d69e51f2201996de366252f360d34302f is a merge but no -m option was given.
fatal: cherry-pick failed

```


</details>


<!---
DO NOT EDIT
-*- Mergify Payload -*-
{""command"": ""backport version-15-hotfix"", ""conclusion"": ""failure"", ""action_is_running"": true}
-*- Mergify Payload End -*-
-->

ruthra-kumar (Assginee) on (2024-10-15 02:13:11 UTC): @venkat102 
Rather than a [merge](https://github.com/frappe/erpnext/pull/43426/commits/8751d09d69e51f2201996de366252f360d34302f) commit, would suggest you to do [rebase](https://git-scm.com/docs/git-rebase) on future PR's. PR's with merge commits cannot be auto-backported https://github.com/frappe/erpnext/pull/43426#issuecomment-2412666209


Can you create a manual backport for v15

venkat102 (Issue Creator) on (2024-10-15 06:24:11 UTC): @ruthra-kumar sure will do rebase in the future PR's
I'll create a manual backport for this

venkat102 (Issue Creator) on (2024-10-17 06:49:06 UTC): v15 backport: #43708

"
2554879432,pull_request,closed,,"feat: new DocTypes ""Code List"" and ""Common Code""","![code_list](https://github.com/user-attachments/assets/db57cf07-4b84-487c-9bc2-25d606054fdc)

![common_code_list](https://github.com/user-attachments/assets/2196d3c6-0280-4797-9303-377c54c9e6f4)

![common_code](https://github.com/user-attachments/assets/ad2b534d-ce11-4fb0-bc1a-628b3a45bf9d)

```python
In [1]: code_list = ""urn:xoev-de:kosit:codeliste:untdid.5305_3""

In [2]: get_codes_for(code_list, ""Account"", ""Tax Assets - WPL"")
Out[2]: ('A',)

In [3]: get_docnames_for(code_list, ""Account"", ""A"")
Out[3]: ('Tax Assets - WPL',)

In [4]: get_default_code(code_list)
Out[4]: 'S'
```

Screenshots based on https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.5305_3:technischerBestandteilGenericode:datei:UNTDID_5305-3.xml

After this is merged, check if we should revert https://github.com/frappe/erpnext/pull/40593 and https://github.com/frappe/erpnext/pull/40663

> no-docs (for now)",barredterra,2024-09-29 11:15:09+00:00,[],2024-12-03 00:13:15+00:00,2024-11-17 14:05:33+00:00,https://github.com/frappe/erpnext/pull/43425,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]","[{'comment_id': 2383222306, 'issue_id': 2554879432, 'author': 'barredterra', 'body': '- [x] It is not obvious (and was not intended by me) that the `CanonicalVersionUri` now has to be used as the name of the code list (for the import to work). E.g. I would not expect the `CanonicalVersionUri` of the code list linked above to be referenced in most eInvoices. So a more generic name would be useful for retrieving the necessary code list. In the screenshot above, I used the `Identification/ShortName`.\r\n- [x] ""Additional Data"" from the code list is not yet imported (e.g. descriptions, as available in the code list linked above).', 'created_at': datetime.datetime(2024, 9, 30, 13, 37, 55, tzinfo=datetime.timezone.utc)}, {'comment_id': 2383422845, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': 'More exploration from my side: https://github.com/barredterra/erpnext/pull/1 (Edi Template & Edi Log, squashed your naming fix \r\nthere, @barredterra )', 'created_at': datetime.datetime(2024, 9, 30, 14, 48, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2383458584, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': '> It is not obvious (and was not intended by me) that the CanonicalVersionUri now has to be used as the name of the code list (for the import to work). E.g. I would not expect the CanonicalVersionUri of the code list linked above to be referenced in most eInvoices.\r\n\r\n**Firstly**, most of the time, however, unlike the common codes, these lists are akin to real _constants_ in an e-invoice template. I would typically hard-code them for each distinct edi template. Here is an example:\r\n\r\n<details><summary>XML Example</summary>\r\n\r\n```xml\r\n        <cbc:IdentificationCode\r\n          listAgencyID=""6""\r\n          listAgencyName=""United Nations Economic Commission for Europe""\r\n          listSchemeURI=""urn:oasis:names:specification:ubl:codelist:gc:CountryIdentificationCode-2.1""\r\n        >CO</cbc:IdentificationCode>\r\n```\r\n\r\n</details>\r\n\r\n**Secondly**, the title is still user friendly, for display purposes.\r\n\r\n<details><summary>Screenshot</summary>\r\n\r\n![image](https://github.com/user-attachments/assets/2bcf0ba3-5c25-4fe3-9b25-b7abeec74664)\r\n\r\n</details>\r\n\r\n**Thirdly**, as per the Genericode XML Schema, `CanonicalVersionUri` is the primary key of a list, so we would have to go out of our way to work around that. https://docs.oasis-open.org/codelist/genericode/v1.0/os/xsd/genericode.xsd\r\n\r\n<details><summary>XML Reference</summary>\r\n\r\n```xml\r\n<xsd:complexType name=""Identification"">\r\n<xsd:annotation>\r\n<xsd:documentation>Identification and location information (metadata).</xsd:documentation>\r\n</xsd:annotation>\r\n<xsd:sequence>\r\n<xsd:group ref=""gc:NameSet"">\r\n...\r\n</xsd:group>\r\n<xsd:element name=""Version"" type=""xsd:token"">\r\n...\r\n</xsd:element>\r\n<xsd:element name=""CanonicalUri"" type=""xsd:anyURI"">\r\n<xsd:annotation>\r\n<xsd:documentation>Canonical URI which uniquely identifies all versions (collectively).</xsd:documentation>\r\n<xsd:documentation>\r\n<rule:text id=""R25"" category=""document"">Must be an absolute URI, must not be relative.</rule:text>\r\n</xsd:documentation>\r\n<xsd:documentation>\r\n<rule:text id=""R26"" category=""application"">Must not be used as a de facto location URI.</rule:text>\r\n</xsd:documentation>\r\n</xsd:annotation>\r\n</xsd:element>\r\n<xsd:group ref=""gc:VersionLocationUriSet"">\r\n...\r\n</xsd:group>\r\n<xsd:element name=""Agency"" minOccurs=""0"" type=""gc:Agency"">\r\n...\r\n</xsd:element>\r\n</xsd:sequence>\r\n</xsd:complexType>\r\n\r\n...\r\n\r\n<xsd:group name=""VersionLocationUriSet"">\r\n<xsd:annotation>\r\n<xsd:documentation>Identification and location URIs for a version.</xsd:documentation>\r\n</xsd:annotation>\r\n<xsd:sequence>\r\n<xsd:element name=""CanonicalVersionUri"" type=""xsd:anyURI"">\r\n...\r\n</xsd:element>\r\n<xsd:element name=""LocationUri"" minOccurs=""0"" maxOccurs=""unbounded"" type=""xsd:anyURI"">\r\n...\r\n</xsd:element>\r\n<xsd:element name=""AlternateFormatLocationUri"" minOccurs=""0"" maxOccurs=""unbounded"" type=""gc:MimeTypedUri"">\r\n...\r\n</xsd:element>\r\n</xsd:sequence>\r\n</xsd:group>\r\n```\r\n\r\nNote, that `CanonicalUri` _will_ be shared between lists, and within `VerstionLocationUriSet` (the unique identifying set), `CanoncialVersionUri` is the only mandatory one.\r\n\r\n</details>\r\n\r\n**Edit:**\r\n\r\nI think this is what you where looking for:\r\n\r\n![image](https://github.com/user-attachments/assets/dd4ac355-aaa2-4060-bc3a-7ec1421d864c)', 'created_at': datetime.datetime(2024, 9, 30, 15, 1, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2384107738, 'issue_id': 2554879432, 'author': 'barredterra', 'body': 'If we have to use this very technical name, we should at least offer the import from the list view (or from an unsaved form) instead of from the saved form view. It would be kind of weird if the user first needs to manually extract some values from the XML, in order to then import the rest of it.\r\n\r\nMy approach was originally targeted at, e.g., being able to tell the users to create a **Code List** called ""UNTDID.5305"" and make sure it contains the tax codes they care about. The alternative, equally good or even better, would be being able to tell them to just import [this code list](xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.5305_3:technischerBestandteilGenericode:datei:UNTDID_5305-3.xml). Telling them to extract the `CanonicalVersionUri` does not seem realistic, however.', 'created_at': datetime.datetime(2024, 9, 30, 20, 41, 20, tzinfo=datetime.timezone.utc)}, {'comment_id': 2385218471, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': '> [ ... ] we should at least offer the import from the list view (or from an unsaved form) instead of from the saved form view. It would be kind of weird if the user first needs to manually extract some values from the XML, in order to then import the rest of it.\r\n\r\n> Telling them to extract the CanonicalVersionUri does not seem realistic, however.\r\n\r\nIndeed! &mdash; I think this concern is already gracefully implemented?\r\n\r\n### General Scenario: Add more codes from the same list (e.g. different filters) &mdash; form import\r\n#### Specific Scenario: I accidentially selected the wrong code list for upload\r\n![image](https://github.com/user-attachments/assets/513d647a-7935-43bd-8bba-66d6564ffb01)\r\n\r\n---\r\n\r\n### General Scenario: Add a new code list and some codes &mdash; list import\r\nImplemented on the list views of _Code List_ and _Common Code_\r\n#### Specific Scenario: Step Two (immediately after upload); Selection of Import filters\r\n![image](https://github.com/user-attachments/assets/176017c5-5526-451e-9e05-130de1253c2f)\r\n<sup>Note: no extraction of `CanonicalVersionUri` by the user; filterable are fields with cardinality <= 5</sup>', 'created_at': datetime.datetime(2024, 10, 1, 9, 2, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2385386849, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': 'https://github.com/frappe/erpnext/pull/43425/commits/d540d03d8a5903764c311b8d19c3d7cb3188e6d9\r\n\r\n![image](https://github.com/user-attachments/assets/e6d5caca-de0b-4373-bbe5-ce5a76454bbd)', 'created_at': datetime.datetime(2024, 10, 1, 10, 14, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2385467354, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': 'We may need to relax the unique condition on `code` for _Common Code_. This is a valid Code List:\r\n```xml\r\n      <Row>\r\n         <Value ColumnRef=""code"">\r\n            <SimpleValue>1.50</SimpleValue>\r\n         </Value>\r\n         <Value ColumnRef=""name"">\r\n            <SimpleValue>ReteFuente</SimpleValue>\r\n         </Value>\r\n         <Value ColumnRef=""description"">\r\n            <SimpleValue>Compras con tarjeta débito o crédito</SimpleValue>\r\n         </Value>\r\n      </Row>\r\n      <Row>\r\n         <Value ColumnRef=""code"">\r\n            <SimpleValue>1.50</SimpleValue>\r\n         </Value>\r\n         <Value ColumnRef=""name"">\r\n            <SimpleValue>ReteFuente</SimpleValue>\r\n         </Value>\r\n         <Value ColumnRef=""description"">\r\n            <SimpleValue>Compras de bienes o productos agrícolas o pecuarios sin procesamiento industrial</SimpleValue>\r\n         </Value>\r\n      </Row>\r\n```', 'created_at': datetime.datetime(2024, 10, 1, 10, 56, 49, tzinfo=datetime.timezone.utc)}, {'comment_id': 2385512310, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': 'Problem addressed, also in the importer:\r\n\r\n![image](https://github.com/user-attachments/assets/fa931e15-b20a-4252-a34e-bd5de3712baf)\r\n\r\n![image](https://github.com/user-attachments/assets/e3f5e4f3-ea7c-4e35-89df-4f7b9b1bd99c)', 'created_at': datetime.datetime(2024, 10, 1, 11, 20, tzinfo=datetime.timezone.utc)}, {'comment_id': 2385539050, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': 'https://github.com/frappe/erpnext/pull/43425/commits/52dcb2bca220aa4def00e5a338fb11b60943fe02 addresses the usability concern even further:\r\n\r\n![image](https://github.com/user-attachments/assets/7aa2b042-fa1c-40cd-a734-bb74966add60)', 'created_at': datetime.datetime(2024, 10, 1, 11, 34, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2385558431, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': '## Testing Resume\r\n\r\n- [x] 23 Code Lists, 27 XML files\r\n- [x] Faulty XML: ok\r\n- [x] Undeclared Columns: ok\r\n- [x] Non unique `common_code`: ok (eg tax rates) -> added description\r\n- [x] Guard against accidential structured data manipulation\r\n- [x] Partial loading of a list\r\n- [x] Later completion of a list - USER ATTENTION! Duplicates are legal in the data structure, double loading must be avoided with care (no other way)\r\n- [x] Loading values from different files into the same code list \r\n\r\n<details><summary>Screenshot</summary>\r\n\r\n![image](https://github.com/user-attachments/assets/436e9bba-b7bf-405c-a7b4-370df7b86e8a)\r\n\r\n</details>', 'created_at': datetime.datetime(2024, 10, 1, 11, 44, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2385579023, 'issue_id': 2554879432, 'author': 'barredterra', 'body': '> Indeed! — I think this concern is already gracefully implemented?\r\n\r\nAh, my bad, I\'ve overlooked this.\r\n\r\n---\r\n\r\nI think, from a developer perspective, it would be perfect if we can:\r\n\r\n(1) Given a ref_doctype, ref_docname and code list, retrieve the applicable code.\r\n(2) Given a code and code list, retrieve the applicable ref_doctype and ref_docname.\r\n\r\nDo you think this unambiguous mapping is feasible?\r\n\r\nI\'m thinking of adding a util and validation for the second case.\r\n\r\n---\r\n\r\nSelecting ""URL"" on file upload fails. Would be nice if we can support this as well.\r\n\r\n---', 'created_at': datetime.datetime(2024, 10, 1, 11, 54, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2385616335, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': '> (2) Given a code and code list, retrieve the applicable ref_doctype and ref_docname.\r\n\r\n<details><summary>Given ...</summary>\r\n\r\n```python\r\n\r\n\tdef validate_distinct_references(self):\r\n\t\t""""""Ensure no two Common Codes of the same Code List are linked to the same document.""""""\r\n\t\tfor link in self.applies_to:\r\n\t\t\texisting_links = frappe.get_all(\r\n\t\t\t\t""Common Code"",\r\n\t\t\t\tfilters=[\r\n\t\t\t\t\t[""name"", ""!="", self.name],\r\n\t\t\t\t\t[""code_list"", ""="", self.code_list],\r\n\t\t\t\t\t[""Dynamic Link"", ""link_doctype"", ""="", link.link_doctype],\r\n\t\t\t\t\t[""Dynamic Link"", ""link_name"", ""="", link.link_name],\r\n\t\t\t\t],\r\n\t\t\t\tfields=[""name"", ""common_code""],\r\n\t\t\t)\r\n\r\n\t\t\tif existing_links:\r\n\t\t\t\texisting_link = existing_links[0]\r\n\t\t\t\tfrappe.throw(\r\n\t\t\t\t\t_(""{0} {1} is already linked to Common Code {2}."").format(\r\n\t\t\t\t\t\tlink.link_doctype,\r\n\t\t\t\t\t\tlink.link_name,\r\n\t\t\t\t\t\tget_link_to_form(""Common Code"", existing_link[""name""], existing_link[""common_code""]),\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n```\r\n\r\n</details>\r\n\r\nI think we can restrict certain Code Lists (optionally) to a certain doctype and thereby meet the full condition necessary to implement such a util for such code lists.\r\n\r\nBut you\'re absolutely right: on the parsing end of the flow, this would quite definitely improve DX.', 'created_at': datetime.datetime(2024, 10, 1, 12, 13, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2386072909, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': '> Selecting ""URL"" on file upload fails. Would be nice if we can support this as well.\r\n\r\nhttps://github.com/frappe/erpnext/pull/43425/commits/94bd74319ba8f5641c1ff5dc5e192fe296bd0113\r\n\r\nAlso library links (for example to post-load more codes from an already partially imported list)\r\n\r\nDepends on: https://github.com/frappe/frappe/pull/27954', 'created_at': datetime.datetime(2024, 10, 1, 14, 6, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2386141316, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': 'We probably should also return `additional_data` from the `get_code_for` because more often than not, this is actually relevant data when rendering a e-invoice template. I\'ll check this and confirm during dogfooding.\r\n\r\n---\r\n\r\nWile dogfooding I realise:\r\n\r\nAs user, I want an easy way to associate all Code List documents with my current document, which are configured to be associatable with that document type (by means of a Code List - Doctype association). Especially for documents which are still metadata, but fall within the life-cycle management of non-power users, such as Suppliers, Customers & Items.\r\n\r\n---\r\n\r\nWe also should probably implement a stringer (`__str__`) on `CommonCode` which automatically renders it\'s `common_code` into a jinja template without need for more verbosity.\r\n\r\n---\r\n\r\n`get_code_for` should probably throw a user facing error if no association is found but was expected, indicating that xyz association is missing and needs to be set up.\r\n\r\n```python\r\n    # should throw if tax_category_id was not set\r\n    tax_category_id = frappe.get_doc(""Code List"", TAX_CATEGORY_CODE_LIST).get_code_for(\r\n        party.doctype, party.name\r\n    )\r\n```\r\n\r\n---\r\n\r\n_Code List_ should have a default code, so that it is easier to fetch:\r\n\r\n```python\r\n    tax_id_type = frappe.get_doc(""Common Code"", party.tax_id_type or tax_type_codelist.default)\r\n```\r\n\r\n---\r\n\r\nWould be handy too (`.get_doc` proxy):\r\n```python\r\n    tax_id_type = codelist.get_doc(party.tax_id_type)  # raises\r\n    tax_id_type = codelist.get_doc(party.tax_id_type, None)\r\n    tax_id_type = codelist.get_doc(party.tax_id_type, codelist.default)\r\n```\r\n\r\n---\r\n\r\nUltimately, what I want is this, to keep my implementation at the leaf as clean as possible:\r\n```python\r\nfrom .code_list import substitute\r\n\r\n\r\ncustomer = frappe.get_doc(""Customer"", ""Foo"")\r\n\r\ncustomer_for_render = substitute(customer)\r\n# replaces all links to Common Code to the respective common code\r\n# and infers defaults based on the field\'s filter\r\n# {""code_list"": ""My List""} - take default of that list, if there is\r\n```\r\n\r\n<sup> If my edge case invalidates a default, I can still override it in sitiu </sup>', 'created_at': datetime.datetime(2024, 10, 1, 14, 32, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2388425993, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': '@barredterra I noted a couple of things, when dogfooding this yesterday.\r\n\r\n1. On ""intermediate"" metadata (like Customer, Supplier, which are metadata, but where the lifecycle is managed as part of daily transactions), I think we still want a ""nomarl"" link from a custom field to Common Code with the appropriate filter.\r\n2. On these cases it would be wonderful to have a summary `customer = code_list.substitute(customer)` to replace all these link fields with a Common Code object for use during rendering. (benefits: same mental model as the origin doctype, just augmented, avoids running into the trap of creating own `frappe._dict()` ad-hoc data structures)\r\n3. Because then, we get into Custom Field management already, I think it would be fair to add a (rudimentary) wizard of some sort to the Code List doctype which allows to setup such custom fields &mdash; this would be an alternative mechanism of association for the use case of those ""indermediate"" metadata in addition to the Common Code\'s `applies_to` for ""long lived"" metadata.\r\n\r\nThis doesn\'t mean the `applies_to` is useless, it\'s still extremely valid on quite an array of very stable metadata, but I think for the transaction-bound metadata (read: Customer), we need an in-transaction complement.\r\n\r\nYou may consider my previous list as ""dogfooding notes"", I haven\'t fully processed them myself, yet. But it seems that my refactoring would be stuck on what I describe here, for the ""true blessing of DX"".', 'created_at': datetime.datetime(2024, 10, 2, 11, 35, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2388602672, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': '> (2) Given a code and code list, retrieve the applicable ref_doctype and ref_docname.\r\n\r\nSince this happens in the context of parsing, and parsing is bound to a XML structure, the following binding may be relevant, as well:\r\n\r\n![image](https://github.com/user-attachments/assets/e4bc9697-77ea-4086-9fa7-17555e5e7dc7)\r\n\r\n**Meaning**\r\n- In the context of DIAN E-Invoice\r\n- With its binding to a Sales Invoice\r\n- And the associated code lists bound to python context variables `pais` & `to` (""given code list"")\r\n- Then infer the code\'s `refdoc_doctype` & `refdoc_name` by means of a triangulation with an additional Doctype Context binding in the `applies_to` table.\r\n\r\nOriginally, I had thought of an implementation with a direct Code List - Doctype binding, but I realize that the EDI Template is a better source for that contextual binding. Hence having such a context binding within the `applies_to` table might make more sense.\r\n\r\nIt would read in plain english:\r\n\r\n1. In the context of Sales Invoice EDI\r\n2. Apply the present code\r\n3. To the target document (e.g. an _Account_ / Tax) \r\n\r\nNow, instead of binding it to a Doctype, we probably could bind it to an EDI Template within `applies_to` to make true with the above plain english reading of the feature.', 'created_at': datetime.datetime(2024, 10, 2, 13, 8, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2388655169, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': '... which makes me wonder: probably we should bind all `applies_to` inside the EDI template (as in: ""Within the context of a particular EDI type"")? :thinking: \r\n\r\n---\r\n\r\n![image](https://github.com/user-attachments/assets/1b3b4a83-a18a-49f1-adf7-e2524b7bc19c)', 'created_at': datetime.datetime(2024, 10, 2, 13, 31, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2388692792, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': 'https://github.com/frappe/erpnext/pull/43425/commits/d68d80892db14b62e47f60a22b441fa62e5b77b6\r\n\r\nFix UX of Title-less common codes in link dropdowns:\r\n\r\n![image](https://github.com/user-attachments/assets/64fc084f-90d1-460a-8be8-e984e71514e2)', 'created_at': datetime.datetime(2024, 10, 2, 13, 48, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2388828415, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': 'Conclusion: We need to incubate a core feature ""LazyRecords"", which lazily traverse link values on on access but eagerly build the traversal tree 3-4 levels deep for best autocompletion. Inside, we then can replace standard Link bindings with our custom bindings. Whereby barren key renders the stringer of the target class in jinja (typically: name or title(?)). :rofl:', 'created_at': datetime.datetime(2024, 10, 2, 14, 40, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2424141507, 'issue_id': 2554879432, 'author': 'barredterra', 'body': 'https://github.com/frappe/erpnext/pull/43425#issuecomment-2385467354\r\n\r\nI broke this again, sorry.\r\n\r\nIs this really valid? What use is a code if it can have multiple meanings, even in the same list?', 'created_at': datetime.datetime(2024, 10, 19, 18, 56, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2424199580, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': ""> Is this really valid?\r\n\r\nYes.\r\n\r\n> What use is a code if it can have multiple meanings, even in the same list?\r\n\r\nNot sure if we productively can second-guess the spec &mdash; especially since I have a real codelist which exhibits this behaviour.\r\n\r\nRemember that `code` is not guaranteed to be a row prim key (there isn't even a guarantee that a row prim key is present), so we can't fake it and make it a requirement in our implementation."", 'created_at': datetime.datetime(2024, 10, 19, 20, 36, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2451908696, 'issue_id': 2554879432, 'author': 'barredterra', 'body': ""For testing, here's a list of code lists required for eInvoicing in Germany (XRechnung):\r\n\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:rec21_3:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:rec20_3:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:vatex_1:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:eas_5:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:icd_5:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.7161_3:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.7143_4:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.5305_3:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.5189_3:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:xrechnung:codeliste:untdid.4461_3:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.4451_4:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.2005_4:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.1153_3:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.1001_4:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:currency-codes_3:technischerBestandteilGenericode\r\n- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:country-codes_8:technischerBestandteilGenericode"", 'created_at': datetime.datetime(2024, 11, 1, 13, 52, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2462792870, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': 'Rebase done in order to prepare internal production backport which is hard to extract with a merge commit from develop.', 'created_at': datetime.datetime(2024, 11, 7, 17, 10, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2481284268, 'issue_id': 2554879432, 'author': 'blaggacao', 'body': '@barredterra This would need backports of https://github.com/frappe/frappe/pull/27954', 'created_at': datetime.datetime(2024, 11, 17, 14, 20, 27, tzinfo=datetime.timezone.utc)}]","barredterra (Issue Creator) on (2024-09-30 13:37:55 UTC): - [x] It is not obvious (and was not intended by me) that the `CanonicalVersionUri` now has to be used as the name of the code list (for the import to work). E.g. I would not expect the `CanonicalVersionUri` of the code list linked above to be referenced in most eInvoices. So a more generic name would be useful for retrieving the necessary code list. In the screenshot above, I used the `Identification/ShortName`.
- [x] ""Additional Data"" from the code list is not yet imported (e.g. descriptions, as available in the code list linked above).

blaggacao on (2024-09-30 14:48:21 UTC): More exploration from my side: https://github.com/barredterra/erpnext/pull/1 (Edi Template & Edi Log, squashed your naming fix 
there, @barredterra )

blaggacao on (2024-09-30 15:01:01 UTC): **Firstly**, most of the time, however, unlike the common codes, these lists are akin to real _constants_ in an e-invoice template. I would typically hard-code them for each distinct edi template. Here is an example:

<details><summary>XML Example</summary>

```xml
        <cbc:IdentificationCode
          listAgencyID=""6""
          listAgencyName=""United Nations Economic Commission for Europe""
          listSchemeURI=""urn:oasis:names:specification:ubl:codelist:gc:CountryIdentificationCode-2.1""
```

</details>

**Secondly**, the title is still user friendly, for display purposes.

<details><summary>Screenshot</summary>

![image](https://github.com/user-attachments/assets/2bcf0ba3-5c25-4fe3-9b25-b7abeec74664)

</details>

**Thirdly**, as per the Genericode XML Schema, `CanonicalVersionUri` is the primary key of a list, so we would have to go out of our way to work around that. https://docs.oasis-open.org/codelist/genericode/v1.0/os/xsd/genericode.xsd

<details><summary>XML Reference</summary>

```xml
<xsd:complexType name=""Identification"">
<xsd:annotation>
<xsd:documentation>Identification and location information (metadata).</xsd:documentation>
</xsd:annotation>
<xsd:sequence>
<xsd:group ref=""gc:NameSet"">
...
</xsd:group>
<xsd:element name=""Version"" type=""xsd:token"">
...
</xsd:element>
<xsd:element name=""CanonicalUri"" type=""xsd:anyURI"">
<xsd:annotation>
<xsd:documentation>Canonical URI which uniquely identifies all versions (collectively).</xsd:documentation>
<xsd:documentation>
<rule:text id=""R25"" category=""document"">Must be an absolute URI, must not be relative.</rule:text>
</xsd:documentation>
<xsd:documentation>
<rule:text id=""R26"" category=""application"">Must not be used as a de facto location URI.</rule:text>
</xsd:documentation>
</xsd:annotation>
</xsd:element>
<xsd:group ref=""gc:VersionLocationUriSet"">
...
</xsd:group>
<xsd:element name=""Agency"" minOccurs=""0"" type=""gc:Agency"">
...
</xsd:element>
</xsd:sequence>
</xsd:complexType>

...

<xsd:group name=""VersionLocationUriSet"">
<xsd:annotation>
<xsd:documentation>Identification and location URIs for a version.</xsd:documentation>
</xsd:annotation>
<xsd:sequence>
<xsd:element name=""CanonicalVersionUri"" type=""xsd:anyURI"">
...
</xsd:element>
<xsd:element name=""LocationUri"" minOccurs=""0"" maxOccurs=""unbounded"" type=""xsd:anyURI"">
...
</xsd:element>
<xsd:element name=""AlternateFormatLocationUri"" minOccurs=""0"" maxOccurs=""unbounded"" type=""gc:MimeTypedUri"">
...
</xsd:element>
</xsd:sequence>
</xsd:group>
```

Note, that `CanonicalUri` _will_ be shared between lists, and within `VerstionLocationUriSet` (the unique identifying set), `CanoncialVersionUri` is the only mandatory one.

</details>

**Edit:**

I think this is what you where looking for:

![image](https://github.com/user-attachments/assets/dd4ac355-aaa2-4060-bc3a-7ec1421d864c)

barredterra (Issue Creator) on (2024-09-30 20:41:20 UTC): If we have to use this very technical name, we should at least offer the import from the list view (or from an unsaved form) instead of from the saved form view. It would be kind of weird if the user first needs to manually extract some values from the XML, in order to then import the rest of it.

My approach was originally targeted at, e.g., being able to tell the users to create a **Code List** called ""UNTDID.5305"" and make sure it contains the tax codes they care about. The alternative, equally good or even better, would be being able to tell them to just import [this code list](xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.5305_3:technischerBestandteilGenericode:datei:UNTDID_5305-3.xml). Telling them to extract the `CanonicalVersionUri` does not seem realistic, however.

blaggacao on (2024-10-01 09:02:05 UTC): Indeed! &mdash; I think this concern is already gracefully implemented?

### General Scenario: Add more codes from the same list (e.g. different filters) &mdash; form import
#### Specific Scenario: I accidentially selected the wrong code list for upload
![image](https://github.com/user-attachments/assets/513d647a-7935-43bd-8bba-66d6564ffb01)

---

### General Scenario: Add a new code list and some codes &mdash; list import
Implemented on the list views of _Code List_ and _Common Code_
#### Specific Scenario: Step Two (immediately after upload); Selection of Import filters
![image](https://github.com/user-attachments/assets/176017c5-5526-451e-9e05-130de1253c2f)
<sup>Note: no extraction of `CanonicalVersionUri` by the user; filterable are fields with cardinality <= 5</sup>

blaggacao on (2024-10-01 10:14:30 UTC): https://github.com/frappe/erpnext/pull/43425/commits/d540d03d8a5903764c311b8d19c3d7cb3188e6d9

![image](https://github.com/user-attachments/assets/e6d5caca-de0b-4373-bbe5-ce5a76454bbd)

blaggacao on (2024-10-01 10:56:49 UTC): We may need to relax the unique condition on `code` for _Common Code_. This is a valid Code List:
```xml
      <Row>
         <Value ColumnRef=""code"">
            <SimpleValue>1.50</SimpleValue>
         </Value>
         <Value ColumnRef=""name"">
            <SimpleValue>ReteFuente</SimpleValue>
         </Value>
         <Value ColumnRef=""description"">
            <SimpleValue>Compras con tarjeta débito o crédito</SimpleValue>
         </Value>
      </Row>
      <Row>
         <Value ColumnRef=""code"">
            <SimpleValue>1.50</SimpleValue>
         </Value>
         <Value ColumnRef=""name"">
            <SimpleValue>ReteFuente</SimpleValue>
         </Value>
         <Value ColumnRef=""description"">
            <SimpleValue>Compras de bienes o productos agrícolas o pecuarios sin procesamiento industrial</SimpleValue>
         </Value>
      </Row>
```

blaggacao on (2024-10-01 11:20:00 UTC): Problem addressed, also in the importer:

![image](https://github.com/user-attachments/assets/fa931e15-b20a-4252-a34e-bd5de3712baf)

![image](https://github.com/user-attachments/assets/e3f5e4f3-ea7c-4e35-89df-4f7b9b1bd99c)

blaggacao on (2024-10-01 11:34:12 UTC): https://github.com/frappe/erpnext/pull/43425/commits/52dcb2bca220aa4def00e5a338fb11b60943fe02 addresses the usability concern even further:

![image](https://github.com/user-attachments/assets/7aa2b042-fa1c-40cd-a734-bb74966add60)

blaggacao on (2024-10-01 11:44:15 UTC): ## Testing Resume

- [x] 23 Code Lists, 27 XML files
- [x] Faulty XML: ok
- [x] Undeclared Columns: ok
- [x] Non unique `common_code`: ok (eg tax rates) -> added description
- [x] Guard against accidential structured data manipulation
- [x] Partial loading of a list
- [x] Later completion of a list - USER ATTENTION! Duplicates are legal in the data structure, double loading must be avoided with care (no other way)
- [x] Loading values from different files into the same code list 

<details><summary>Screenshot</summary>

![image](https://github.com/user-attachments/assets/436e9bba-b7bf-405c-a7b4-370df7b86e8a)

</details>

barredterra (Issue Creator) on (2024-10-01 11:54:52 UTC): Ah, my bad, I've overlooked this.

---

I think, from a developer perspective, it would be perfect if we can:

(1) Given a ref_doctype, ref_docname and code list, retrieve the applicable code.
(2) Given a code and code list, retrieve the applicable ref_doctype and ref_docname.

Do you think this unambiguous mapping is feasible?

I'm thinking of adding a util and validation for the second case.

---

Selecting ""URL"" on file upload fails. Would be nice if we can support this as well.

---

blaggacao on (2024-10-01 12:13:28 UTC): <details><summary>Given ...</summary>

```python

	def validate_distinct_references(self):
		""""""Ensure no two Common Codes of the same Code List are linked to the same document.""""""
		for link in self.applies_to:
			existing_links = frappe.get_all(
				""Common Code"",
				filters=[
					[""name"", ""!="", self.name],
					[""code_list"", ""="", self.code_list],
					[""Dynamic Link"", ""link_doctype"", ""="", link.link_doctype],
					[""Dynamic Link"", ""link_name"", ""="", link.link_name],
				],
				fields=[""name"", ""common_code""],
			)

			if existing_links:
				existing_link = existing_links[0]
				frappe.throw(
					_(""{0} {1} is already linked to Common Code {2}."").format(
						link.link_doctype,
						link.link_name,
						get_link_to_form(""Common Code"", existing_link[""name""], existing_link[""common_code""]),
					)
				)
```

</details>

I think we can restrict certain Code Lists (optionally) to a certain doctype and thereby meet the full condition necessary to implement such a util for such code lists.

But you're absolutely right: on the parsing end of the flow, this would quite definitely improve DX.

blaggacao on (2024-10-01 14:06:42 UTC): https://github.com/frappe/erpnext/pull/43425/commits/94bd74319ba8f5641c1ff5dc5e192fe296bd0113

Also library links (for example to post-load more codes from an already partially imported list)

Depends on: https://github.com/frappe/frappe/pull/27954

blaggacao on (2024-10-01 14:32:11 UTC): We probably should also return `additional_data` from the `get_code_for` because more often than not, this is actually relevant data when rendering a e-invoice template. I'll check this and confirm during dogfooding.

---

Wile dogfooding I realise:

As user, I want an easy way to associate all Code List documents with my current document, which are configured to be associatable with that document type (by means of a Code List - Doctype association). Especially for documents which are still metadata, but fall within the life-cycle management of non-power users, such as Suppliers, Customers & Items.

---

We also should probably implement a stringer (`__str__`) on `CommonCode` which automatically renders it's `common_code` into a jinja template without need for more verbosity.

---

`get_code_for` should probably throw a user facing error if no association is found but was expected, indicating that xyz association is missing and needs to be set up.

```python
    # should throw if tax_category_id was not set
    tax_category_id = frappe.get_doc(""Code List"", TAX_CATEGORY_CODE_LIST).get_code_for(
        party.doctype, party.name
    )
```

---

_Code List_ should have a default code, so that it is easier to fetch:

```python
    tax_id_type = frappe.get_doc(""Common Code"", party.tax_id_type or tax_type_codelist.default)
```

---

Would be handy too (`.get_doc` proxy):
```python
    tax_id_type = codelist.get_doc(party.tax_id_type)  # raises
    tax_id_type = codelist.get_doc(party.tax_id_type, None)
    tax_id_type = codelist.get_doc(party.tax_id_type, codelist.default)
```

---

Ultimately, what I want is this, to keep my implementation at the leaf as clean as possible:
```python
from .code_list import substitute


customer = frappe.get_doc(""Customer"", ""Foo"")

customer_for_render = substitute(customer)
# replaces all links to Common Code to the respective common code
# and infers defaults based on the field's filter
# {""code_list"": ""My List""} - take default of that list, if there is
```

<sup> If my edge case invalidates a default, I can still override it in sitiu </sup>

blaggacao on (2024-10-02 11:35:05 UTC): @barredterra I noted a couple of things, when dogfooding this yesterday.

1. On ""intermediate"" metadata (like Customer, Supplier, which are metadata, but where the lifecycle is managed as part of daily transactions), I think we still want a ""nomarl"" link from a custom field to Common Code with the appropriate filter.
2. On these cases it would be wonderful to have a summary `customer = code_list.substitute(customer)` to replace all these link fields with a Common Code object for use during rendering. (benefits: same mental model as the origin doctype, just augmented, avoids running into the trap of creating own `frappe._dict()` ad-hoc data structures)
3. Because then, we get into Custom Field management already, I think it would be fair to add a (rudimentary) wizard of some sort to the Code List doctype which allows to setup such custom fields &mdash; this would be an alternative mechanism of association for the use case of those ""indermediate"" metadata in addition to the Common Code's `applies_to` for ""long lived"" metadata.

This doesn't mean the `applies_to` is useless, it's still extremely valid on quite an array of very stable metadata, but I think for the transaction-bound metadata (read: Customer), we need an in-transaction complement.

You may consider my previous list as ""dogfooding notes"", I haven't fully processed them myself, yet. But it seems that my refactoring would be stuck on what I describe here, for the ""true blessing of DX"".

blaggacao on (2024-10-02 13:08:03 UTC): Since this happens in the context of parsing, and parsing is bound to a XML structure, the following binding may be relevant, as well:

![image](https://github.com/user-attachments/assets/e4bc9697-77ea-4086-9fa7-17555e5e7dc7)

**Meaning**
- In the context of DIAN E-Invoice
- With its binding to a Sales Invoice
- And the associated code lists bound to python context variables `pais` & `to` (""given code list"")
- Then infer the code's `refdoc_doctype` & `refdoc_name` by means of a triangulation with an additional Doctype Context binding in the `applies_to` table.

Originally, I had thought of an implementation with a direct Code List - Doctype binding, but I realize that the EDI Template is a better source for that contextual binding. Hence having such a context binding within the `applies_to` table might make more sense.

It would read in plain english:

1. In the context of Sales Invoice EDI
2. Apply the present code
3. To the target document (e.g. an _Account_ / Tax) 

Now, instead of binding it to a Doctype, we probably could bind it to an EDI Template within `applies_to` to make true with the above plain english reading of the feature.

blaggacao on (2024-10-02 13:31:51 UTC): ... which makes me wonder: probably we should bind all `applies_to` inside the EDI template (as in: ""Within the context of a particular EDI type"")? :thinking: 

---

![image](https://github.com/user-attachments/assets/1b3b4a83-a18a-49f1-adf7-e2524b7bc19c)

blaggacao on (2024-10-02 13:48:12 UTC): https://github.com/frappe/erpnext/pull/43425/commits/d68d80892db14b62e47f60a22b441fa62e5b77b6

Fix UX of Title-less common codes in link dropdowns:

![image](https://github.com/user-attachments/assets/64fc084f-90d1-460a-8be8-e984e71514e2)

blaggacao on (2024-10-02 14:40:40 UTC): Conclusion: We need to incubate a core feature ""LazyRecords"", which lazily traverse link values on on access but eagerly build the traversal tree 3-4 levels deep for best autocompletion. Inside, we then can replace standard Link bindings with our custom bindings. Whereby barren key renders the stringer of the target class in jinja (typically: name or title(?)). :rofl:

barredterra (Issue Creator) on (2024-10-19 18:56:08 UTC): https://github.com/frappe/erpnext/pull/43425#issuecomment-2385467354

I broke this again, sorry.

Is this really valid? What use is a code if it can have multiple meanings, even in the same list?

blaggacao on (2024-10-19 20:36:59 UTC): Yes.


Not sure if we productively can second-guess the spec &mdash; especially since I have a real codelist which exhibits this behaviour.

Remember that `code` is not guaranteed to be a row prim key (there isn't even a guarantee that a row prim key is present), so we can't fake it and make it a requirement in our implementation.

barredterra (Issue Creator) on (2024-11-01 13:52:14 UTC): For testing, here's a list of code lists required for eInvoicing in Germany (XRechnung):

- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:rec21_3:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:rec20_3:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:vatex_1:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:eas_5:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:icd_5:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.7161_3:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.7143_4:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.5305_3:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.5189_3:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:xrechnung:codeliste:untdid.4461_3:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.4451_4:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.2005_4:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.1153_3:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.1001_4:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:currency-codes_3:technischerBestandteilGenericode
- https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:country-codes_8:technischerBestandteilGenericode

blaggacao on (2024-11-07 17:10:48 UTC): Rebase done in order to prepare internal production backport which is hard to extract with a merge commit from develop.

blaggacao on (2024-11-17 14:20:27 UTC): @barredterra This would need backports of https://github.com/frappe/frappe/pull/27954

"
2554836770,pull_request,closed,,chore: update POT file,,frappe-pr-bot,2024-09-29 09:35:16+00:00,[],2024-10-26 00:11:33+00:00,2024-10-08 16:58:54+00:00,https://github.com/frappe/erpnext/pull/43424,[],[],
2554703021,pull_request,closed,,fix: use serial and batch fields (backport #43421),"On selection of item enable ""use serial and batch fields""<hr>This is an automatic backport of pull request #43421 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-29 04:43:15+00:00,['rohitwaghchaure'],2024-10-20 00:12:32+00:00,2024-09-29 05:39:32+00:00,https://github.com/frappe/erpnext/pull/43423,[],[],
2554700798,pull_request,closed,,"fix: Data missing in table: None, MandatoryError","Fixed https://github.com/frappe/erpnext/issues/41800
Fixed https://github.com/frappe/erpnext/issues/41798",rohitwaghchaure,2024-09-29 04:34:53+00:00,[],2024-10-20 00:12:30+00:00,2024-09-29 05:40:25+00:00,https://github.com/frappe/erpnext/pull/43422,"[('backport version-15-hotfix', '')]",[],
2554699273,pull_request,closed,,fix: use serial and batch fields,"On selection of item enable ""use serial and batch fields""",rohitwaghchaure,2024-09-29 04:29:20+00:00,[],2024-10-20 00:12:33+00:00,2024-09-29 04:42:19+00:00,https://github.com/frappe/erpnext/pull/43421,"[('backport version-15-hotfix', '')]",[],
2554688596,pull_request,closed,,fix: Stock Ledger Invariant Check report,"**Issue**

<img width=""635"" alt=""image"" src=""https://github.com/user-attachments/assets/0bceacc8-a2f2-4835-b383-02e2215d835b"">
",rohitwaghchaure,2024-09-29 03:50:18+00:00,[],2024-10-17 00:11:43+00:00,2024-09-29 17:05:50+00:00,https://github.com/frappe/erpnext/pull/43420,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2554437818,pull_request,closed,,fix: quality inspection creation (backport #43416),"**Issue**

- Create the quality inspection template with ""Formula Based Criteria"" and formula as ""(reading_1 + reading_2) > 3""
- Create the Purchase Receipt and after that click on Create > Quality Inspection 
- In the popup select the items and click on Create, you will get the below error

<img width=""795"" alt=""Screenshot 2024-09-28 at 8 26 30 PM"" src=""https://github.com/user-attachments/assets/3f119a95-0bcb-439a-b630-a13ecd0c2a28"">
<hr>This is an automatic backport of pull request #43416 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-28 18:25:06+00:00,['rohitwaghchaure'],2024-10-20 00:12:35+00:00,2024-09-29 04:16:00+00:00,https://github.com/frappe/erpnext/pull/43418,"[('needs-tests', 'This PR needs automated unit-tests.'), ('conflicts', None)]","[{'comment_id': 2380856930, 'issue_id': 2554437818, 'author': 'mergify[bot]', 'body': 'Cherry-pick of a594c05296cae58ea546933f834dd3f5b651fd09 has failed:\n```\nOn branch mergify/bp/version-14-hotfix/pr-43416\nYour branch is up to date with \'origin/version-14-hotfix\'.\n\nYou are currently cherry-picking commit a594c05296.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/stock/doctype/quality_inspection/quality_inspection.py\n\nno changes added to commit (use ""git add"" and/or ""git commit -a"")\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 9, 28, 18, 25, 8, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-09-28 18:25:08 UTC): Cherry-pick of a594c05296cae58ea546933f834dd3f5b651fd09 has failed:
```
On branch mergify/bp/version-14-hotfix/pr-43416
Your branch is up to date with 'origin/version-14-hotfix'.

You are currently cherry-picking commit a594c05296.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/stock/doctype/quality_inspection/quality_inspection.py

no changes added to commit (use ""git add"" and/or ""git commit -a"")
```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2554437796,pull_request,closed,,fix: quality inspection creation (backport #43416),"**Issue**

- Create the quality inspection template with ""Formula Based Criteria"" and formula as ""(reading_1 + reading_2) > 3""
- Create the Purchase Receipt and after that click on Create > Quality Inspection 
- In the popup select the items and click on Create, you will get the below error

<img width=""795"" alt=""Screenshot 2024-09-28 at 8 26 30 PM"" src=""https://github.com/user-attachments/assets/3f119a95-0bcb-439a-b630-a13ecd0c2a28"">
<hr>This is an automatic backport of pull request #43416 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-28 18:25:03+00:00,['rohitwaghchaure'],2024-10-20 00:12:34+00:00,2024-09-29 04:16:14+00:00,https://github.com/frappe/erpnext/pull/43417,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2554304323,pull_request,closed,,fix: quality inspection creation,"**Issue**

- Create the quality inspection template with ""Formula Based Criteria"" and formula as ""(reading_1 + reading_2) > 3""
- Create the Purchase Receipt and after that click on Create > Quality Inspection 
- In the popup select the items and click on Create, you will get the below error

<img width=""795"" alt=""Screenshot 2024-09-28 at 8 26 30 PM"" src=""https://github.com/user-attachments/assets/3f119a95-0bcb-439a-b630-a13ecd0c2a28"">
",rohitwaghchaure,2024-09-28 15:09:30+00:00,[],2024-10-13 00:13:02+00:00,2024-09-28 18:23:45+00:00,https://github.com/frappe/erpnext/pull/43416,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2554082339,pull_request,closed,,fix: Get Entries not showing accounts with no gain or loss in Exchange Rate Revaluation issue fixed,"### Issue:
`Get Entries`  in Exchange Rate Revaluation is not fetching those entries where gain/loss is zero. User may want to set a different exchange rate manually.

![image](https://github.com/user-attachments/assets/befe19ce-1fe6-4abf-ab50-bf04ae55c8d3)

### Fix: 
Remove the condition `if_gain_loss` from `calculate_new_account_balance` method and instead remove the rows with zero gain/loss in `before_submit`. 

![image](https://github.com/user-attachments/assets/bc225323-870d-4d9a-b4ae-c155fff32db2)

",vishakhdesai,2024-09-28 07:18:08+00:00,['ruthra-kumar'],2024-11-30 00:11:36+00:00,2024-11-15 07:17:31+00:00,https://github.com/frappe/erpnext/pull/43414,"[('squash', 'Meant to tell reviewers that this PR should be squashed into a single commit while merging.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]","[{'comment_id': 2415807312, 'issue_id': 2554082339, 'author': 'ruthra-kumar', 'body': 'Could you share replication steps?', 'created_at': datetime.datetime(2024, 10, 16, 6, 3, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2426073105, 'issue_id': 2554082339, 'author': 'sagarvora', 'body': ""> Could you share replication steps?\r\n\r\n@ruthra-kumar This condition is the root cause:\r\nhttps://github.com/frappe/erpnext/pull/43414/files#diff-89e8e1151809399344e7f71c7e3c52e94c7873c9c9d1a0d4413c007e61cd60d8L251\r\n\r\nHere's how you might replicate the issue:\r\n- create a transaction with exchange rate of ₹85/USD (dated 1st Oct).\r\n- create currency exchange record with the same rate for today.\r\n- try to fetch accounts in Exchange Rate Revaluation as of today.\r\n- gain/loss will be 0, so no accounts will get fetched.\r\n- user will not get the chance to manually set the exchange rate to something else."", 'created_at': datetime.datetime(2024, 10, 21, 9, 9, 13, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Assginee) on (2024-10-16 06:03:23 UTC): Could you share replication steps?

sagarvora on (2024-10-21 09:09:13 UTC): @ruthra-kumar This condition is the root cause:
https://github.com/frappe/erpnext/pull/43414/files#diff-89e8e1151809399344e7f71c7e3c52e94c7873c9c9d1a0d4413c007e61cd60d8L251

Here's how you might replicate the issue:
- create a transaction with exchange rate of ₹85/USD (dated 1st Oct).
- create currency exchange record with the same rate for today.
- try to fetch accounts in Exchange Rate Revaluation as of today.
- gain/loss will be 0, so no accounts will get fetched.
- user will not get the chance to manually set the exchange rate to something else.

"
2553498612,pull_request,closed,,fix: Ignore transaction deletion check on ledger entry insertion (backport #43410) (backport #43411),<hr>This is an automatic backport of pull request #43410 done by [Mergify](https://mergify.com).<hr>This is an automatic backport of pull request #43411 done by [Mergify](https://mergify.com).,mergify[bot],2024-09-27 18:25:51+00:00,[],2024-10-13 00:13:03+00:00,2024-09-27 18:28:17+00:00,https://github.com/frappe/erpnext/pull/43413,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2553495332,pull_request,closed,,feat: added 'cost of new capitalized asset' column (backport #43399),"Added a new column, `Cost of New Capitalized Asset`, to the asset depreciation and balances report. This column shows capitalized assets within the selected date range, fixing the issue where the report previously displayed incorrect data. The update ensures the report now provides accurate information.
`no-docs`
<hr>This is an automatic backport of pull request #43399 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-27 18:23:36+00:00,['khushi8112'],2024-10-17 00:11:28+00:00,2024-09-29 17:58:43+00:00,https://github.com/frappe/erpnext/pull/43412,"[('needs-tests', 'This PR needs automated unit-tests.')]","[{'comment_id': 2383563892, 'issue_id': 2553495332, 'author': 'rohitwaghchaure', 'body': '@Mergify backport version-15', 'created_at': datetime.datetime(2024, 9, 30, 15, 45, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2383564103, 'issue_id': 2553495332, 'author': 'mergify[bot]', 'body': '> backport version-15\n\n#### ✅ Backports have been created\n\n<details>\n\n* [#43453 feat: added \'cost of new capitalized asset\' column (backport #43399) (backport #43412)](https://github.com/frappe/erpnext/pull/43453) has been created for branch `version-15`\n\n</details>\n\n\n<!---\nDO NOT EDIT\n-*- Mergify Payload -*-\n{""command"": ""backport version-15"", ""conclusion"": ""success"", ""action_is_running"": true}\n-*- Mergify Payload End -*-\n-->', 'created_at': datetime.datetime(2024, 9, 30, 15, 45, 19, tzinfo=datetime.timezone.utc)}]","rohitwaghchaure on (2024-09-30 15:45:14 UTC): @Mergify backport version-15

mergify[bot] (Issue Creator) on (2024-09-30 15:45:19 UTC): #### ✅ Backports have been created

<details>

* [#43453 feat: added 'cost of new capitalized asset' column (backport #43399) (backport #43412)](https://github.com/frappe/erpnext/pull/43453) has been created for branch `version-15`

</details>


<!---
DO NOT EDIT
-*- Mergify Payload -*-
{""command"": ""backport version-15"", ""conclusion"": ""success"", ""action_is_running"": true}
-*- Mergify Payload End -*-
-->

"
2553494388,pull_request,closed,,fix: Ignore transaction deletion check on ledger entry insertion (backport #43410),<hr>This is an automatic backport of pull request #43410 done by [Mergify](https://mergify.com).,mergify[bot],2024-09-27 18:22:56+00:00,['deepeshgarg007'],2024-10-13 00:13:04+00:00,2024-09-27 18:24:55+00:00,https://github.com/frappe/erpnext/pull/43411,"[('needs-tests', 'This PR needs automated unit-tests.')]","[{'comment_id': 2379831848, 'issue_id': 2553494388, 'author': 'deepeshgarg007', 'body': '@Mergifyio backport version-15', 'created_at': datetime.datetime(2024, 9, 27, 18, 24, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2379831928, 'issue_id': 2553494388, 'author': 'mergify[bot]', 'body': '> backport version-15\n\n#### ✅ Backports have been created\n\n<details>\n\n* [#43413 fix: Ignore transaction deletion check on ledger entry insertion (backport #43410) (backport #43411)](https://github.com/frappe/erpnext/pull/43413) has been created for branch `version-15`\n\n</details>\n\n\n<!---\nDO NOT EDIT\n-*- Mergify Payload -*-\n{""command"": ""backport version-15"", ""conclusion"": ""success"", ""action_is_running"": true}\n-*- Mergify Payload End -*-\n-->', 'created_at': datetime.datetime(2024, 9, 27, 18, 24, 43, tzinfo=datetime.timezone.utc)}]","deepeshgarg007 (Assginee) on (2024-09-27 18:24:40 UTC): @Mergifyio backport version-15

mergify[bot] (Issue Creator) on (2024-09-27 18:24:43 UTC): #### ✅ Backports have been created

<details>

* [#43413 fix: Ignore transaction deletion check on ledger entry insertion (backport #43410) (backport #43411)](https://github.com/frappe/erpnext/pull/43413) has been created for branch `version-15`

</details>


<!---
DO NOT EDIT
-*- Mergify Payload -*-
{""command"": ""backport version-15"", ""conclusion"": ""success"", ""action_is_running"": true}
-*- Mergify Payload End -*-
-->

"
2553459585,pull_request,closed,,fix: Ignore transaction deletion check on ledger entry insertion,,deepeshgarg007,2024-09-27 18:00:38+00:00,[],2024-10-13 00:13:05+00:00,2024-09-27 18:21:39+00:00,https://github.com/frappe/erpnext/pull/43410,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]",[],
2553160270,pull_request,closed,,feat: search attribute value in multiple variant creation dialog,"Added an search field in Item Multiple Variant Creation dialog to search attribute values. It will be helpful in case if we have a large amount of attribute values


https://github.com/user-attachments/assets/5ce0791d-f86d-4206-8d63-ab828e954efb




`no-docs`
",Shankarv19bcr,2024-09-27 15:05:19+00:00,['rohitwaghchaure'],2024-10-17 00:11:08+00:00,2024-10-01 07:25:33+00:00,https://github.com/frappe/erpnext/pull/43408,[],[],
2553154160,pull_request,closed,,fix: multiple issues in Payment Request (#42427),"* fix: multiple issues in Payment Request

* chore: minor changes

* fix: remove  bug

* fix: replace `round` with `flt`

* fix: changes as per review

* refactor: replace sql query of `matched_payment_requests` to query builder

* fix: replace `locals` with `get_doc` in set_query

* fix: changes during review

* fix: minor review changes

* fix: remove unnecessary code for setting payment entry received amount

* fix: logic for set payment_request if PE made from transaction

* fix: Use rounded total to make Payment Request from `Sales Invoice` or `Purchase Invoice`

* refactor: enhance logic of `set_open_payment_requests_to_references`

* fix: added one optional arg `created_from_payment_request`

* fix: handle multiple allocation of PR at PE's reference

* fix: logic for PR if outstanding docs fetch

* fix: formatted Link field for `Payment Request` for PE's references

* fix: replace `get_all()` with `get_list()` for getting Payment Request for Link field

* chore: format `payment_entry.js` file

* style: Show preview popup of `Payment Request`

* fix: remove minor bug

* fix: add virtual field for Payment Term and Request `outstanding_amount` in PE's reference

* fix: get outstanding amount in PE's reference on realtime

* fix: move allocation of allocated_amount to server side (no change)

* fix: some minor changes to allocation

* fix: Split `Payment Request` if PE is created from PR and there are `Payment Terms`

* fix: minor logic changes

* fix: Allocation of allocated_amount if `paid_amount` is changes

* fix: improve logic of allocation

* fix: set matched payment request if unset

* fix: minor changes

* fix: Allocate single Payment Request if PE created from PR

* fix: improve code logic

* fix: Removed duplication code

* fix: proper message title

* refactor: Rename method of Allocation Amount to References

* refactor: Changing `grand_total` description based on `party_type`

* refactor: update Payment Request

* fix: Remove virtual property of payment_term_outstanding from references

* fix: fetch party account currency for creating payment request

* fix: use transaction currency as base in payment request

* fix: party amount for creating payment entry

* fix: allow for proportional amount paid by bank

* fix: Changed field order in Payment Request

* fix: Minor refactor in Payment Entry Reference table data

* test: Added test cases for allow Payment at `Partially Paid` status for PR

* test: Update partial paid status test case

* test: Update test case for same currency PR

* refactor: Wider the `msgprint` dialog for after save PE

* test: Update PR test cases

* chore: Remove dirty lines

* fix: formatting update

* fix: Use `flt` where doing subtraction

* test: PR test case with Payment Term for same currency

* fix: remove redundant `flt`

* test: Add test cases for PR",Abdeali099,2024-09-27 15:02:20+00:00,[],2024-12-02 05:57:23+00:00,2024-10-07 16:15:02+00:00,https://github.com/frappe/erpnext/pull/43407,"[('accounts', ''), ('backport version-14-hotfix', 'backport to version 14')]","[{'comment_id': 2381971674, 'issue_id': 2553154160, 'author': 'ruthra-kumar', 'body': '@Abdeali099 \r\nCould you update the description?\r\n\r\nAdvance Payment Status is not in v15, but the commit messages in the description could mislead developers.', 'created_at': datetime.datetime(2024, 9, 30, 4, 14, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2381978933, 'issue_id': 2553154160, 'author': 'Abdeali099', 'body': '> @Abdeali099 Could you update the description?\r\n> \r\n> Advance Payment Status is not in v15, but the commit messages in the description could mislead developers.\r\n\r\nUpdated..', 'created_at': datetime.datetime(2024, 9, 30, 4, 23, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2397810927, 'issue_id': 2553154160, 'author': 'blaggacao', 'body': ""https://github.com/frappe/erpnext/pull/43407/commits/3d9d56ab504ef2fd321fe4cbdd38414a1700ccfa I'd still have use for them in a pending refactoring recarding `frappe/payments`, just as an assertion. I can remove them later, but could we take them back here?\r\n\r\nEDIT: Nevermind, I can bring back the necessary tests on demand. Looks like I have to do some deep refactorings anyways. \r\n\r\nThis looks really like a great change, thank you!"", 'created_at': datetime.datetime(2024, 10, 7, 20, 17, 18, tzinfo=datetime.timezone.utc)}]","ruthra-kumar on (2024-09-30 04:14:58 UTC): @Abdeali099 
Could you update the description?

Advance Payment Status is not in v15, but the commit messages in the description could mislead developers.

Abdeali099 (Issue Creator) on (2024-09-30 04:23:14 UTC): Updated..

blaggacao on (2024-10-07 20:17:18 UTC): https://github.com/frappe/erpnext/pull/43407/commits/3d9d56ab504ef2fd321fe4cbdd38414a1700ccfa I'd still have use for them in a pending refactoring recarding `frappe/payments`, just as an assertion. I can remove them later, but could we take them back here?

EDIT: Nevermind, I can bring back the necessary tests on demand. Looks like I have to do some deep refactorings anyways. 

This looks really like a great change, thank you!

"
2552668296,pull_request,closed,,refactor(test): use fixture on Journal test suite,,ruthra-kumar,2024-09-27 11:15:43+00:00,[],2024-10-26 00:11:10+00:00,2024-10-10 08:22:25+00:00,https://github.com/frappe/erpnext/pull/43405,[],[],
2551710563,pull_request,closed,,"feat: new DocType ""Duty Tax Fee Type""","- Added a new DocType **Duty Tax Fee Type**.

    This represents a standardized Code specifying a type of duty, tax or fee, as [defined by UN/EDIFACT](https://service.unece.org/trade/untdid/d19b/tred/tred5153.htm). 
    This is useful for generating or importing electronic invoices.

- Create **Duty Tax Fee Types** after install, for new sites.
- Create **Duty Tax Fee Types** via patch, for existing sites.
- Added a _Duty Tax Fee Type_ Link field to **Sales Taxes and Charges**.
- Added a _Duty Tax Fee Type_ Link field to  **Purchase Taxes and Charges**.
- Added a _Duty Tax Fee Type_ Link field to  **Advance Taxes and Charges**.

I wish to backport this because it's non-breaking and useful for e-invoice support in prior versions.",barredterra,2024-09-26 23:55:14+00:00,[],2024-10-20 00:12:31+00:00,2024-09-29 11:43:27+00:00,https://github.com/frappe/erpnext/pull/43402,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]","[{'comment_id': 2381324205, 'issue_id': 2551710563, 'author': 'barredterra', 'body': 'See https://github.com/frappe/erpnext/pull/43425 for a more generic approach.', 'created_at': datetime.datetime(2024, 9, 29, 11, 43, 27, tzinfo=datetime.timezone.utc)}]","barredterra (Issue Creator) on (2024-09-29 11:43:27 UTC): See https://github.com/frappe/erpnext/pull/43425 for a more generic approach.

"
2551254895,pull_request,closed,,FIX: Production Plan -> Stock Qty from SO Item instead of Qty,"When building a production plan from a Sales Order, by default ERPNext take into account the `so_item.qty` field, this covers 90% of the good scenarios, but, if an Item have an different selling uom, it will raise an issue on manufacturing.

For instance, let's consider an Ice Cream factory!

For Ice Cream, the Stock Unit is Mililitre

![Sorvete-Sabor-Creme-Sorvete-Sabor-Creme-09-26-2024_03_09_PM](https://github.com/user-attachments/assets/1e0b4063-10f6-4e31-8664-1dad59f72aec)

The Standard Selling Unit is 1 Litre Package

![Sorvete-Sabor-Creme-Sorvete-Sabor-Creme-09-26-2024_03_10_PM](https://github.com/user-attachments/assets/324c3b36-2ea6-45ac-b34f-fe81f192a2da)

So, let's consider a Sales of 2000 Litres

![image](https://github.com/user-attachments/assets/88b68bc0-ae2b-424c-843c-a7763f42968c)

On the Sales Order Item, ERPNext calculate properly the expected Stock Qty **2.000.000 Mililitres**

But, when fetching the Sales Order on the Production Plan we have

![image](https://github.com/user-attachments/assets/b2938c16-d665-43c6-899d-2e63a5948121)

So all the Raw Materials get wrong

![image](https://github.com/user-attachments/assets/5fb9f349-9a83-47c5-9331-0656dff5d7fc)

But with a manual fix

![image](https://github.com/user-attachments/assets/94a46a17-5313-44fb-acce-5b31b5551bf7)

We get the right raw materials

![image](https://github.com/user-attachments/assets/9a394bbe-7519-4856-9835-d350e5dccb09)

Prooving that ERPNext is fetching the wrong value

",MaxMorais,2024-09-26 18:19:31+00:00,[],2024-10-20 00:12:27+00:00,2024-10-03 09:52:32+00:00,https://github.com/frappe/erpnext/pull/43400,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2551169874,pull_request,closed,,feat: added 'cost of new capitalized asset' column,"Added a new column, `Cost of New Capitalized Asset` to the asset depreciation and balances report. This column shows newly capitalized assets within the selected date range, fixing the issue where the report previously displayed incorrect data. The update ensures the report now provides accurate information.

<img width=""1440"" alt=""Screenshot 2024-11-26 at 4 20 31 PM"" src=""https://github.com/user-attachments/assets/dedb7c44-4079-4e9a-bb50-6ec3be933d88"">


`no-docs`
",khushi8112,2024-09-26 17:31:51+00:00,[],2024-11-26 10:51:20+00:00,2024-09-27 18:22:22+00:00,https://github.com/frappe/erpnext/pull/43399,"[('backport version-15-hotfix', '')]",[],
2550806268,pull_request,closed,,fix: do not include advances for tds vouchers,"Issue: TDS is getting deducted even though the threshold has not been breached.

Steps To Replicate:
- Create a Journal Entry for the supplier by debiting the supplier account and crediting tds account.
- Now create a purchase invoice with `apply_tds` enabled and tds_category.
- TDS will get deducted even though the threshold has not been breached.

Solution:
Only include vouchers with the same `tax_withholding_category` for checking if tds is deducted earlier.

Notes :
- Since we are already checking for payment entry separately advances will be checked automatically.
- Advances are still required for TCS(sales workflow) because `tax_withholding_category` field is not present in sales invoice.


Frappe Support Issue: https://support.frappe.io/helpdesk/tickets/17255",ljain112,2024-09-26 14:42:13+00:00,[],2024-10-27 00:12:20+00:00,2024-10-08 05:08:03+00:00,https://github.com/frappe/erpnext/pull/43397,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2550390740,pull_request,closed,,fix: reconciled advance payment shows up in reconciliation tool under invoices,"# Issue

1. Enable `Book Advance Payments in Separate Party Account`
2. Make Purchase Order
3. Make Payment against Purchase Order
4. Make Purchase Invoice for Purchase Order and reconcile advance against this invoice using Reconciliation tool

Advance Payment shows up under 'Invoices' section in Payment Reconciliation tool.

# Root cause

### GL entries for Advance payment
|Account| Debit|Credit|Voucher No| Against Voucher|
|-|-|-|-|-|
|Advance Paid|1000|0|ACC-PAY-2024-00012|PUR-ORD-2024-0001|
|Cash|0|1000|ACC-PAY-2024-00012||

`against_voucher` field is referring Purchase Order.

### Upon reconciliation
|Account| Debit|Credit|Voucher No| Against Voucher|-|
|-|-|-|-|-|-|
|Advance Paid|1000|0|ACC-PAY-2024-00012|PUR-ORD-2024-0001|<-|
|Cash|0|1000|ACC-PAY-2024-00012||
|Advance Paid|0|1000|ACC-PAY-2024-00012|ACC-PAY-2024-00012|<-|
|Creditors|1000|0|ACC-PAY-2024-00012|ACC-PINV-2024-00055|

For `Advance Paid` account, `Against Voucher` is still referencing Purchase Order. This cause it to be incorrectly identified as an Invoice.

For a normal Payment, since the amount stays within the same account, this wasn't an issue. But for Advance Payments (`Book Advance Payments in Separate Party Account`), amount moves from one account to another upon reconciliation. But, during this original two rows are untouched.


# Fix
For Payment Entries, don't post references to Sales / Purchase Order in Ledger, as they anyways have no impact on Ledger. 

## Todo
 - [x] Calculate `Advance Paid` for Sales / Purchase Order directly from Payment Entry References or Journal references
 - [x] Test Cases for Journal / Payment with references to multiple SO / PO
 - [x] Test Unreconciliation on [2]
 - [ ] Test Unreconciliation on [2] along with `Advance as a Liability` enabled.
",ruthra-kumar,2024-09-26 12:09:21+00:00,[],2024-10-28 00:11:53+00:00,2024-10-13 02:03:48+00:00,https://github.com/frappe/erpnext/pull/43396,"[('accounts', ''), ('needs-tests', 'This PR needs automated unit-tests.')]","[{'comment_id': 2408559960, 'issue_id': 2550390740, 'author': 'ruthra-kumar', 'body': 'Abandoning this in favor of https://github.com/frappe/erpnext/pull/43627', 'created_at': datetime.datetime(2024, 10, 12, 13, 9, 10, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Issue Creator) on (2024-10-12 13:09:10 UTC): Abandoning this in favor of https://github.com/frappe/erpnext/pull/43627

"
2550248695,pull_request,closed,,feat: link purchase invoice item with open purchase order,"**This PR adds functionality to automatically link open Purchase Orders to a Purchase Invoice on FIFO bases, similar to the existing link between a Material Request and a Purchase Order.**

![image](https://github.com/user-attachments/assets/29af0d67-5620-4e12-abef-7b5ba7b9798f)

**Purchase Order linked with Purchase Invoice Item**
![image](https://github.com/user-attachments/assets/f8d2a939-099e-44de-836d-22b1bc416631)
",Sanket322,2024-09-26 11:00:56+00:00,[],2024-11-24 00:12:42+00:00,2024-11-09 17:50:56+00:00,https://github.com/frappe/erpnext/pull/43395,"[('needs-tests', 'This PR needs automated unit-tests.'), ('inactive', '')]","[{'comment_id': 2403864354, 'issue_id': 2550248695, 'author': 'SvbZ3r0', 'body': 'It would be great if we could incorporate Purchase Receipt into this. This feature would be useful for Sales Invoice, Delivery Note, and Sales Order too.', 'created_at': datetime.datetime(2024, 10, 10, 3, 27, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2456122098, 'issue_id': 2550248695, 'author': 'stale[bot]', 'body': ""This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing."", 'created_at': datetime.datetime(2024, 11, 5, 2, 55, 27, tzinfo=datetime.timezone.utc)}]","SvbZ3r0 on (2024-10-10 03:27:52 UTC): It would be great if we could incorporate Purchase Receipt into this. This feature would be useful for Sales Invoice, Delivery Note, and Sales Order too.

stale[bot] on (2024-11-05 02:55:27 UTC): This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing.

"
2550072619,pull_request,closed,,Serial number report,"Changes is the serial number Report 

remove the some field and filters  that is not present in the serial no Doctype

i can change 3 report 
1) serial no warranty expiry
2) serial no status
3) serial no service contract expiry  

![368935817-42e3a753-c65d-4e19-8e36-e426bfa17a59](https://github.com/user-attachments/assets/a8d22a0d-7b9d-43cc-bdde-da984e76c9e8)

solved this error ",Vishv-024,2024-09-26 09:42:31+00:00,[],2024-10-17 00:11:19+00:00,2024-10-01 06:57:33+00:00,https://github.com/frappe/erpnext/pull/43394,[],"[{'comment_id': 2384948695, 'issue_id': 2550072619, 'author': 'rohitwaghchaure', 'body': 'Merged https://github.com/frappe/erpnext/pull/43444', 'created_at': datetime.datetime(2024, 10, 1, 6, 57, 33, tzinfo=datetime.timezone.utc)}]","rohitwaghchaure on (2024-10-01 06:57:33 UTC): Merged https://github.com/frappe/erpnext/pull/43444

"
2549858272,pull_request,closed,,fix: create Account Closing Balance even though there are no transaction in period,"Issue-: If there are no transactions in a period, Account Closing Balances are not created. This gives incorrect opening balance for the following period.

Fix: Allow creating closing entries even if there are no GL entries or period closing voucher entries.

![image](https://github.com/user-attachments/assets/3b7aaa9e-2026-4137-97a1-a528d42c4862)


Frappe Support Issue: https://support.frappe.io/app/hd-ticket/22654
",ljain112,2024-09-26 08:15:23+00:00,[],2024-10-22 00:12:28+00:00,2024-10-07 16:10:34+00:00,https://github.com/frappe/erpnext/pull/43391,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2549621128,pull_request,closed,,fix: serial and batch no selector (backport #43387),"**Issue**

<img width=""889"" alt=""Screenshot 2024-09-25 at 9 01 38 PM"" src=""https://github.com/user-attachments/assets/159e517b-e539-44be-a890-c3b5eb7935d5"">


Fixed https://github.com/frappe/erpnext/issues/42600<hr>This is an automatic backport of pull request #43387 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-26 06:19:11+00:00,['rohitwaghchaure'],2024-10-13 00:13:06+00:00,2024-09-26 06:36:27+00:00,https://github.com/frappe/erpnext/pull/43390,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2549027068,pull_request,closed,,fix: sync translations from crowdin,,frappe-pr-bot,2024-09-25 21:25:08+00:00,[],2024-10-26 00:11:34+00:00,2024-10-08 16:58:18+00:00,https://github.com/frappe/erpnext/pull/43389,"[('translation', None)]","[{'comment_id': 2376607889, 'issue_id': 2549027068, 'author': 'barredterra', 'body': 'Swedish translations are currently debated', 'created_at': datetime.datetime(2024, 9, 26, 10, 51, 50, tzinfo=datetime.timezone.utc)}]","barredterra on (2024-09-26 10:51:50 UTC): Swedish translations are currently debated

"
2548697860,pull_request,closed,,fix: SO link on PO and add in missing dashboard references on both,"The main fix is to the Purchase Order dashboard link back to the Sales Order which was incorrectly specified in the _dashboard.py file

Also adds in some missing links, mainly for Manufacturing for both documents.

no-docs
version-14-hotfix
version-15-hotfix
",casesolved-co-uk,2024-09-25 18:24:22+00:00,['ruthra-kumar'],2024-11-19 00:11:49+00:00,2024-11-04 08:31:05+00:00,https://github.com/frappe/erpnext/pull/43388,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2548380516,pull_request,closed,,fix: serial and batch no selector,"**Issue**

<img width=""889"" alt=""Screenshot 2024-09-25 at 9 01 38 PM"" src=""https://github.com/user-attachments/assets/159e517b-e539-44be-a890-c3b5eb7935d5"">


Fixed https://github.com/frappe/erpnext/issues/42600",rohitwaghchaure,2024-09-25 16:00:37+00:00,[],2024-10-13 00:13:07+00:00,2024-09-25 16:45:11+00:00,https://github.com/frappe/erpnext/pull/43387,"[('backport version-15-hotfix', '')]",[],
2547924268,pull_request,closed,,fix: include parent item group in query,"https://github.com/frappe/erpnext/pull/43257
include parent item group in query",ljain112,2024-09-25 12:57:06+00:00,[],2024-10-22 00:12:30+00:00,2024-10-07 15:46:25+00:00,https://github.com/frappe/erpnext/pull/43385,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]",[],
2547746021,pull_request,closed,,fix: add parenttype condition for item table in Purchase Register Report,"If a child table is used in some other table it can cause an issue with the data.

Frappe Support Issue: https://support.frappe.io/app/hd-ticket/21111
Purchase Invoice Item table was used in custom doctype which caused the issues for them.
",ljain112,2024-09-25 11:38:22+00:00,[],2024-10-22 00:12:29+00:00,2024-10-07 15:51:02+00:00,https://github.com/frappe/erpnext/pull/43384,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2547389408,pull_request,closed,,fix: plant floor design changes,,rohitwaghchaure,2024-09-25 08:56:35+00:00,[],2024-10-17 00:11:42+00:00,2024-09-29 17:06:33+00:00,https://github.com/frappe/erpnext/pull/43382,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2547152241,pull_request,closed,,feat!: advance payment status on advance payment doctypes - manual backport of #38560,Manual backport of https://github.com/frappe/erpnext/pull/38560,ruthra-kumar,2024-09-25 07:14:26+00:00,[],2024-10-17 00:11:40+00:00,2024-09-30 04:12:49+00:00,https://github.com/frappe/erpnext/pull/43380,"[('accounts', '')]","[{'comment_id': 2381969856, 'issue_id': 2547152241, 'author': 'ruthra-kumar', 'body': 'Dropping this PR as the Payment Request changes are being manually backported https://github.com/frappe/erpnext/pull/43407', 'created_at': datetime.datetime(2024, 9, 30, 4, 12, 47, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Issue Creator) on (2024-09-30 04:12:47 UTC): Dropping this PR as the Payment Request changes are being manually backported https://github.com/frappe/erpnext/pull/43407

"
2546248174,pull_request,closed,,feat: added task assignee email field in asset maintenance log,"closes https://github.com/frappe/erpnext/issues/43298
`no-docs`",khushi8112,2024-09-24 19:47:50+00:00,[],2024-11-05 00:11:06+00:00,2024-10-21 19:43:14+00:00,https://github.com/frappe/erpnext/pull/43378,"[('backport version-15-hotfix', '')]",[],
2546088455,pull_request,closed,,fix: Cannot read properties of undefined (reading 'price_list_rate') (backport #43376),"**Issue**

<img width=""834"" alt=""image"" src=""https://github.com/user-attachments/assets/64f9ff70-7f82-4ecf-8905-e85f48297752"">
<hr>This is an automatic backport of pull request #43376 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-24 18:34:23+00:00,['rohitwaghchaure'],2024-10-13 00:13:12+00:00,2024-09-25 04:39:17+00:00,https://github.com/frappe/erpnext/pull/43377,[],[],
2545878377,pull_request,closed,,fix: Cannot read properties of undefined (reading 'price_list_rate'),"**Issue**

<img width=""834"" alt=""image"" src=""https://github.com/user-attachments/assets/64f9ff70-7f82-4ecf-8905-e85f48297752"">
",rohitwaghchaure,2024-09-24 16:38:48+00:00,[],2024-10-13 00:13:24+00:00,2024-09-24 18:32:33+00:00,https://github.com/frappe/erpnext/pull/43376,"[('backport version-15-hotfix', '')]",[],
2545876209,pull_request,closed,,fix: not able to cancel Quality Inspection (backport #43374),"Getting below error while cancelling the Quality Inspection 

<img width=""850"" alt=""Screenshot 2024-09-24 at 9 35 08 PM"" src=""https://github.com/user-attachments/assets/5b43d34d-f40f-4c30-99b2-9dd1d1f308ac"">
<hr>This is an automatic backport of pull request #43374 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-24 16:37:27+00:00,['rohitwaghchaure'],2024-10-13 00:13:25+00:00,2024-09-24 18:32:24+00:00,https://github.com/frappe/erpnext/pull/43375,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2545820504,pull_request,closed,,fix: not able to cancel Quality Inspection,"Getting below error while cancelling the Quality Inspection 

<img width=""850"" alt=""Screenshot 2024-09-24 at 9 35 08 PM"" src=""https://github.com/user-attachments/assets/5b43d34d-f40f-4c30-99b2-9dd1d1f308ac"">
",rohitwaghchaure,2024-09-24 16:09:56+00:00,[],2024-10-13 00:13:26+00:00,2024-09-24 16:35:24+00:00,https://github.com/frappe/erpnext/pull/43374,"[('backport version-15-hotfix', '')]",[],
2545712563,pull_request,closed,,chore: update POT file,"This PR changes the source path for all translatable strings. Paths now start at the repository root, not at the python module root.",frappe-pr-bot,2024-09-24 15:20:34+00:00,[],2024-10-13 00:13:27+00:00,2024-09-24 15:38:04+00:00,https://github.com/frappe/erpnext/pull/43373,[],[],
2545518620,pull_request,closed,,fix: item wise tax details and net amounts,"###### Developer SLA: my promise is to keep a close eye on this for two weeks after this merge and resolve any issues within 3 working days from the time of duly documented identification and notification

Companions / Fixes: (backporting dependencies)
- https://github.com/frappe/erpnext/pull/44171
- https://github.com/frappe/erpnext/pull/44229
- https://github.com/frappe/erpnext/pull/44231
  - https://github.com/frappe/frappe/pull/28525 
  - https://github.com/frappe/frappe/pull/28526

## Net Amount Field Addition for Tax Doctype

This pull request introduces a new ""Net Amount"" field to various tax-related doctypes in ERPNext, enhancing the granularity of tax calculations and reporting.

### Changes Overview

1. Added ""Net Amount"" and ""Base Net Amount"" fields to:
   - _Advance Taxes and Charges_
   - _Purchase Taxes and Charges_
   - _Sales Taxes and Charges_
   - [x] PR to HRMS for _Expense Taxes and Charges_ &rarr; https://github.com/frappe/hrms/pull/2230

2. Updated the `calculate_taxes_and_totals` class to incorporate the new net amount fields in tax calculations.

3. Modified the `get_current_tax_amount` method to `get_current_tax_and_net_amount`, now returning both net and tax amounts.

4. Adjusted the item-wise tax calculation to include net amount information.

### Key Updates

- **New Fields**: ""Net Amount"" and ""Base Net Amount"" added to tax doctypes for more detailed financial tracking[1].
- **Calculation Logic**: Updated to handle net amounts separately from tax amounts, providing more accurate tax breakdowns[1].
- **Item-wise Tax Details**: Now includes net amount information, offering a more comprehensive view of tax application per item[1].

### Impact

This change will provide users with more detailed tax information, allowing for:
- Better tracking of net amounts before tax application
- More accurate reporting of tax breakdowns
- Enhanced visibility into tax calculations at the item level

### Testing Recommendations

- Verify that net amounts are correctly calculated and displayed in all relevant doctypes
- Ensure that existing tax calculations remain accurate with the introduction of the new fields
- Test various tax scenarios to confirm the correct interaction between net amounts and tax amounts

This update significantly improves the granularity and accuracy of tax-related information in ERPNext, providing users with more detailed financial insights. Additionally, it enhances compatibility with UBL2.1 (Universal Business Language) electronic documents, allowing for more precise representation of net amounts and tax calculations in standardized e-invoicing formats. This improvement facilitates better interoperability with various e-invoicing systems and ensures compliance with digital reporting requirements in jurisdictions that mandate UBL2.1 format for electronic invoices.

### Migration Recommendations

- ~~DO NOT migrate **while you have a POS Invoice Merge pending**: the change in json datastructure will be incompatible. Make sure to migrate after a completed merge to only merge invoices with compatible data structures.~~ Data is now migrated via migration script
 
cc/ @barredterra 


### Example interaction

**Prior**
```python
tax_data = json.loads(tax.item_wise_tax_detail)
rate, amount = tax_data
```

**Now**
```python
tax_data = json.loads(tax.item_wise_tax_detail)
rate, amount, net_amount = tax_data.values()
# or
rate = tax_data.get(""tax_rate"")
amount = tax_data.get(""tax_amount"")
net_amount = tax_data.get(""net_amount"") # not migrated, only new records
# or (preferred)
tax_data = ItemWiseTaxDetail(**tax_data) # helpful to clearly signal to future maintainers ""I'm using this here""
rate = tax_data.tax_rate
amount = tax_data.tax_amount
net_amount = tax_data.net_amount # not migrated, only new records

```",blaggacao,2024-09-24 14:06:30+00:00,['ruthra-kumar'],2024-12-05 00:12:49+00:00,2024-11-14 11:41:00+00:00,https://github.com/frappe/erpnext/pull/43372,"[('accounts', ''), ('do not backport', '')]","[{'comment_id': 2376545100, 'issue_id': 2545518620, 'author': 'blaggacao', 'body': 'In order for this to be merge-able with confidence for migration purposes, we first need a `calculate_taxes_and_totals` controller who is able to recalculate taxes with a guarantee to not create inconsistent data or data which violates prior (legally settled) state. We need a controller which enough flexibility to:\r\n\r\n- add the new amounts to existing data\r\n- provides a dry-run mode for validation before committing changes\r\n- offers detailed logging for audit and troubleshooting purposes\r\n\r\nThere is currently no reasonable way (I tried to find one for 2 hours, already) to recalculate item-wise net amounts into the `item_wise_tax_detail` with the current controller. However, any existing json datastructure is incompatible with `merge_tax`, which might be triggered on old data but post migration.', 'created_at': datetime.datetime(2024, 9, 26, 10, 20, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2381423715, 'issue_id': 2545518620, 'author': 'barredterra', 'body': 'This is also a requirement for the UN/CEFACT Cross Industry Invoice, not only UBL.\n\nBtw, the India Compliance app already calculates net amounts _per Item_ (in case that is helpful here).', 'created_at': datetime.datetime(2024, 9, 29, 16, 48, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2464146901, 'issue_id': 2545518620, 'author': 'barredterra', 'body': ""> DO NOT migrate while you have a POS Invoice Merge pending: the change in json datastructure will be incompatible. Make sure to migrate after a completed merge to only merge invoices with compatible data structures.\r\n\r\nThis restriction seems hard to enforce (or even communicate). We'll probably have to find a workaround."", 'created_at': datetime.datetime(2024, 11, 8, 8, 47, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2464610885, 'issue_id': 2545518620, 'author': 'blaggacao', 'body': ""Indeed, I added a migration script yesterday (wasn't yet able to test). It's not reconstructing the missing value, because that is very difficult to accurately infer in all cases, but it conforms the structure and removes that limitation."", 'created_at': datetime.datetime(2024, 11, 8, 12, 14, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2464644712, 'issue_id': 2545518620, 'author': 'ruthra-kumar', 'body': '@blaggacao \r\n\r\nCan you provide a simple example scenario with expected outcomes, along with\r\n1. How the current system handles it\r\n2. How the proposed change will help address it.', 'created_at': datetime.datetime(2024, 11, 8, 12, 30, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2464682414, 'issue_id': 2545518620, 'author': 'blaggacao', 'body': ""I've added a unit example of how the new datastructure can be worked with to the end of the PR description.\n\nThe key is the addition of `net_amount` so that UBL2.1 standard of representing item-wise tax breakup in edi documents can be implemented **without brittle inference and rather reliably using the source values from the time of first calculation**.\n\nSeveral localization apps, even in-tree ones, have used brittle inference in the past to determine `net_amount`, but this may not meet the quality requirements for other implementations.\n\nThe change from a `list` to a `_dict` was overloaded onto this PR in order to use this API change and the baseline necessity for migration and also sanitize and future-proof this datastructure at the occasion. In part, this aided with validating a correct implementation of the migration, because it is easier to audit the explicit datastructure across the repository than a very subtle list and index based logic that is easy to misread.\n\nSo to sum it up:\n- Higher quality localization code\n- Future Proofing the datastructure \n- Remove a long standing code bottleneck\n\nMaybe a word on brittleness:\n- Rounding logic has evolved over time\n- Localization apps didn't catch up (or didn't bother to soundly implement in the first place)\n- As a result, already today, certain rounding settings in certain localizations *will* produce inconsistent results (wether always consequential or not is an entirely different question)"", 'created_at': datetime.datetime(2024, 11, 8, 12, 51, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2465117427, 'issue_id': 2545518620, 'author': 'barredterra', 'body': '> Several localization apps, even in-tree ones, have used brittle inference in the past to determine net_amount\r\n\r\nCan confirm 😁 \r\n\r\nhttps://github.com/alyf-de/eu_einvoice/blob/a2fa848d20a55b920eb6c07fab87300543377edc/eu_einvoice/european_e_invoice/custom/sales_invoice.py#L180-L182', 'created_at': datetime.datetime(2024, 11, 8, 16, 1, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2475699668, 'issue_id': 2545518620, 'author': 'blaggacao', 'body': ""@ruthra-kumar even if we wouldn't be able to merge it right away, could we lock in an eventual agreement on the design principle, namely:\n\n- Extension of the datastructure by `net_amount`\n- Modification of the datastructure to better future proof the implementation, incl poor-mans typing via type alias\n\nThis would currently help a lot as ecosystem downstream work is conditioned (and currently halted) on these hypotheses."", 'created_at': datetime.datetime(2024, 11, 14, 8, 23, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2476125189, 'issue_id': 2545518620, 'author': 'ruthra-kumar', 'body': 'We can go ahead with this. \r\n\r\n\r\nAs with most complex logic, edge cases will only come out the more it gets used. Will have to tackle it as and when those arise.', 'created_at': datetime.datetime(2024, 11, 14, 11, 35, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2476137698, 'issue_id': 2545518620, 'author': 'blaggacao', 'body': ""Thanks @ruthra-kumar \n\nI've added a priority developer SLA pledge to the beginning of the PR description for the next two weeks."", 'created_at': datetime.datetime(2024, 11, 14, 11, 42, 43, tzinfo=datetime.timezone.utc)}]","blaggacao (Issue Creator) on (2024-09-26 10:20:54 UTC): In order for this to be merge-able with confidence for migration purposes, we first need a `calculate_taxes_and_totals` controller who is able to recalculate taxes with a guarantee to not create inconsistent data or data which violates prior (legally settled) state. We need a controller which enough flexibility to:

- add the new amounts to existing data
- provides a dry-run mode for validation before committing changes
- offers detailed logging for audit and troubleshooting purposes

There is currently no reasonable way (I tried to find one for 2 hours, already) to recalculate item-wise net amounts into the `item_wise_tax_detail` with the current controller. However, any existing json datastructure is incompatible with `merge_tax`, which might be triggered on old data but post migration.

barredterra on (2024-09-29 16:48:37 UTC): This is also a requirement for the UN/CEFACT Cross Industry Invoice, not only UBL.

Btw, the India Compliance app already calculates net amounts _per Item_ (in case that is helpful here).

barredterra on (2024-11-08 08:47:18 UTC): This restriction seems hard to enforce (or even communicate). We'll probably have to find a workaround.

blaggacao (Issue Creator) on (2024-11-08 12:14:38 UTC): Indeed, I added a migration script yesterday (wasn't yet able to test). It's not reconstructing the missing value, because that is very difficult to accurately infer in all cases, but it conforms the structure and removes that limitation.

ruthra-kumar (Assginee) on (2024-11-08 12:30:43 UTC): @blaggacao 

Can you provide a simple example scenario with expected outcomes, along with
1. How the current system handles it
2. How the proposed change will help address it.

blaggacao (Issue Creator) on (2024-11-08 12:51:14 UTC): I've added a unit example of how the new datastructure can be worked with to the end of the PR description.

The key is the addition of `net_amount` so that UBL2.1 standard of representing item-wise tax breakup in edi documents can be implemented **without brittle inference and rather reliably using the source values from the time of first calculation**.

Several localization apps, even in-tree ones, have used brittle inference in the past to determine `net_amount`, but this may not meet the quality requirements for other implementations.

The change from a `list` to a `_dict` was overloaded onto this PR in order to use this API change and the baseline necessity for migration and also sanitize and future-proof this datastructure at the occasion. In part, this aided with validating a correct implementation of the migration, because it is easier to audit the explicit datastructure across the repository than a very subtle list and index based logic that is easy to misread.

So to sum it up:
- Higher quality localization code
- Future Proofing the datastructure 
- Remove a long standing code bottleneck

Maybe a word on brittleness:
- Rounding logic has evolved over time
- Localization apps didn't catch up (or didn't bother to soundly implement in the first place)
- As a result, already today, certain rounding settings in certain localizations *will* produce inconsistent results (wether always consequential or not is an entirely different question)

barredterra on (2024-11-08 16:01:32 UTC): Can confirm 😁 

https://github.com/alyf-de/eu_einvoice/blob/a2fa848d20a55b920eb6c07fab87300543377edc/eu_einvoice/european_e_invoice/custom/sales_invoice.py#L180-L182

blaggacao (Issue Creator) on (2024-11-14 08:23:05 UTC): @ruthra-kumar even if we wouldn't be able to merge it right away, could we lock in an eventual agreement on the design principle, namely:

- Extension of the datastructure by `net_amount`
- Modification of the datastructure to better future proof the implementation, incl poor-mans typing via type alias

This would currently help a lot as ecosystem downstream work is conditioned (and currently halted) on these hypotheses.

ruthra-kumar (Assginee) on (2024-11-14 11:35:53 UTC): We can go ahead with this. 


As with most complex logic, edge cases will only come out the more it gets used. Will have to tackle it as and when those arise.

blaggacao (Issue Creator) on (2024-11-14 11:42:43 UTC): Thanks @ruthra-kumar 

I've added a priority developer SLA pledge to the beginning of the PR description for the next two weeks.

"
2545331950,pull_request,closed,,fix: Manual backport for asset depreciation and balances report fix,Manual backport for https://github.com/frappe/erpnext/pull/43348,khushi8112,2024-09-24 12:55:46+00:00,[],2024-10-13 00:13:30+00:00,2024-09-24 13:19:01+00:00,https://github.com/frappe/erpnext/pull/43370,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2545152565,pull_request,closed,,fix: closing amount reset to expected amount on save (backport #43358),"In ERPNext version 15, when entering and saving the POS closing amount in the POS Closing Entry Doctype, the closing amount is resetting to the expected amount. This results in the change amount not being saved correctly.

This fix ensures that the manually entered closing amount is saved properly without being overridden by the expected amount.

**Before:-** 
![POS Closing](https://github.com/user-attachments/assets/2e520ba1-3d5e-475a-9929-8478e94fe365)

**After:-**
![POS Closing fix](https://github.com/user-attachments/assets/1e0cda83-b527-4df1-b752-474afba6da9d)
<hr>This is an automatic backport of pull request #43358 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-24 11:38:21+00:00,[],2024-10-13 00:13:28+00:00,2024-09-24 15:19:42+00:00,https://github.com/frappe/erpnext/pull/43368,[],[],
2545150406,pull_request,closed,,fix(Bank Account): dashboard connections (backport #43365),"- Moved the dashboard links from a separate python file into the DocType definition
- Rearranged the dashboard links to distinguish between general transactions and accounting entries
- Added **Bank Transaction** to the dashboard links

### Before

![Bildschirmfoto 2024-09-24 um 12 47 19](https://github.com/user-attachments/assets/2834125a-af03-48ad-b4c4-37a6af2325c6)

### After

![Bildschirmfoto 2024-09-24 um 12 58 00](https://github.com/user-attachments/assets/57b6f131-146f-4840-b76d-015596bfff2d)

<hr>This is an automatic backport of pull request #43365 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-24 11:37:17+00:00,['barredterra'],2024-10-13 00:13:29+00:00,2024-09-24 14:20:50+00:00,https://github.com/frappe/erpnext/pull/43367,[],"[{'comment_id': 2371015794, 'issue_id': 2545150406, 'author': 'mergify[bot]', 'body': 'Cherry-pick of 5172629e067a3acb2a8d52442e4769b15cefe769 has failed:\n```\nOn branch mergify/bp/version-15-hotfix/pr-43365\nYour branch is up to date with \'origin/version-15-hotfix\'.\n\nYou are currently cherry-picking commit 5172629e06.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tdeleted:    erpnext/accounts/doctype/bank_account/bank_account_dashboard.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/accounts/doctype/bank_account/bank_account.json\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 9, 24, 11, 37, 19, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-09-24 11:37:19 UTC): Cherry-pick of 5172629e067a3acb2a8d52442e4769b15cefe769 has failed:
```
On branch mergify/bp/version-15-hotfix/pr-43365
Your branch is up to date with 'origin/version-15-hotfix'.

You are currently cherry-picking commit 5172629e06.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	deleted:    erpnext/accounts/doctype/bank_account/bank_account_dashboard.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/accounts/doctype/bank_account/bank_account.json

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2545150288,pull_request,closed,,fix(Bank Account): dashboard connections (backport #43365),"- Moved the dashboard links from a separate python file into the DocType definition
- Rearranged the dashboard links to distinguish between general transactions and accounting entries
- Added **Bank Transaction** to the dashboard links

### Before

![Bildschirmfoto 2024-09-24 um 12 47 19](https://github.com/user-attachments/assets/2834125a-af03-48ad-b4c4-37a6af2325c6)

### After

![Bildschirmfoto 2024-09-24 um 12 58 00](https://github.com/user-attachments/assets/57b6f131-146f-4840-b76d-015596bfff2d)

<hr>This is an automatic backport of pull request #43365 done by [Mergify](https://mergify.com).",mergify[bot],2024-09-24 11:37:13+00:00,['barredterra'],2024-10-13 00:13:20+00:00,2024-09-24 14:20:05+00:00,https://github.com/frappe/erpnext/pull/43366,"[('needs-tests', 'This PR needs automated unit-tests.'), ('conflicts', None), ('released', None)]","[{'comment_id': 2371015683, 'issue_id': 2545150288, 'author': 'mergify[bot]', 'body': 'Cherry-pick of 5172629e067a3acb2a8d52442e4769b15cefe769 has failed:\n```\nOn branch mergify/bp/version-14-hotfix/pr-43365\nYour branch is up to date with \'origin/version-14-hotfix\'.\n\nYou are currently cherry-picking commit 5172629e06.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tdeleted:    erpnext/accounts/doctype/bank_account/bank_account_dashboard.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/accounts/doctype/bank_account/bank_account.json\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 9, 24, 11, 37, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2372910342, 'issue_id': 2545150288, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.74.2 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.2)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 9, 25, 4, 38, 56, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-09-24 11:37:16 UTC): Cherry-pick of 5172629e067a3acb2a8d52442e4769b15cefe769 has failed:
```
On branch mergify/bp/version-14-hotfix/pr-43365
Your branch is up to date with 'origin/version-14-hotfix'.

You are currently cherry-picking commit 5172629e06.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	deleted:    erpnext/accounts/doctype/bank_account/bank_account_dashboard.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/accounts/doctype/bank_account/bank_account.json

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

frappe-pr-bot on (2024-09-25 04:38:56 UTC): :tada: This PR is included in version 14.74.2 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.74.2)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
