id,type,state,state_reason,title,body,author,created_at,assignees,updated_at,closed_at,url,labels,comments_list,comment_thread
2675481330,pull_request,closed,,fix: sync translations from crowdin,,frappe-pr-bot,2024-11-20 11:04:50+00:00,[],2024-12-05 00:12:18+00:00,2024-11-20 11:36:58+00:00,https://github.com/frappe/erpnext/pull/44249,"[('translation', None)]",[],
2674911016,pull_request,closed,,fix: Get submitted documents in validate_for_closed_fiscal_year,"Issue:

While updating a submitted ""Purchase invoice"" that is between the fiscal year of a cancelled ""Period Closing Voucher"" it was throwing the following popup:

![image](https://github.com/user-attachments/assets/008c894c-b9af-4a4e-ade3-aa1f70eb756b)

![image](https://github.com/user-attachments/assets/0673bcdc-7297-4a46-a88c-6795be31f60e)


Backport needed: Version 15",i-am-vimal,2024-11-20 08:19:30+00:00,['ruthra-kumar'],2024-12-07 00:12:04+00:00,2024-11-22 10:21:37+00:00,https://github.com/frappe/erpnext/pull/44246,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2674722597,pull_request,closed,,fix: payment reco for jv with negative dr or cr amount (backport #44197),"Currently, Payment Reconciliation for Journal Entries with negative debit or credit amounts is not supported.
Steps To Replicate:
- Create a Purchase Invoice.
- Create a Journal Entry with a negative credit balance for payment.
- Use the Payment Reconciliation tool for reconciling.(Entry will not be fetched.)

![image](https://github.com/user-attachments/assets/73434a28-9887-49d3-a370-4a43803b1def)



backport version-15<hr>This is an automatic backport of pull request #44197 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 07:18:30+00:00,[],2024-12-05 00:12:40+00:00,2024-11-20 07:42:44+00:00,https://github.com/frappe/erpnext/pull/44245,"[('accounts', '')]",[],
2674722382,pull_request,closed,,fix: payment reco for jv with negative dr or cr amount (backport #44197),"Currently, Payment Reconciliation for Journal Entries with negative debit or credit amounts is not supported.
Steps To Replicate:
- Create a Purchase Invoice.
- Create a Journal Entry with a negative credit balance for payment.
- Use the Payment Reconciliation tool for reconciling.(Entry will not be fetched.)

![image](https://github.com/user-attachments/assets/73434a28-9887-49d3-a370-4a43803b1def)



backport version-15<hr>This is an automatic backport of pull request #44197 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 07:18:22+00:00,[],2024-12-05 00:12:37+00:00,2024-11-20 07:42:55+00:00,https://github.com/frappe/erpnext/pull/44244,"[('accounts', ''), ('released', None)]","[{'comment_id': 2487894925, 'issue_id': 2674722382, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 37, 54, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:37:54 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2674608525,pull_request,closed,,fix: non group pos warehouse (backport #44240),"Issue: when the user changes the warehouse, then it shows the group warehouse.

<img width=""1354"" alt=""Screenshot 2024-11-20 at 12 02 28 PM"" src=""https://github.com/user-attachments/assets/9c81811b-2634-425e-a5ef-ee357a6deea8"">
<hr>This is an automatic backport of pull request #44240 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 06:41:57+00:00,['Nihantra-Patel'],2024-12-05 00:12:41+00:00,2024-11-20 06:48:02+00:00,https://github.com/frappe/erpnext/pull/44242,[],[],
2674608022,pull_request,closed,,fix: non group pos warehouse (backport #44240),"Issue: when the user changes the warehouse, then it shows the group warehouse.

<img width=""1354"" alt=""Screenshot 2024-11-20 at 12 02 28 PM"" src=""https://github.com/user-attachments/assets/9c81811b-2634-425e-a5ef-ee357a6deea8"">
<hr>This is an automatic backport of pull request #44240 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 06:41:36+00:00,['Nihantra-Patel'],2024-12-05 00:12:35+00:00,2024-11-20 06:47:33+00:00,https://github.com/frappe/erpnext/pull/44241,"[('released', None)]","[{'comment_id': 2487895031, 'issue_id': 2674608022, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 37, 57, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:37:57 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2674597399,pull_request,closed,,fix: non group pos warehouse,"Issue: when the user changes the warehouse, then it shows the group warehouse.

<img width=""1354"" alt=""Screenshot 2024-11-20 at 12 02 28 PM"" src=""https://github.com/user-attachments/assets/9c81811b-2634-425e-a5ef-ee357a6deea8"">
",Nihantra-Patel,2024-11-20 06:34:15+00:00,[],2024-12-05 00:12:43+00:00,2024-11-20 06:40:43+00:00,https://github.com/frappe/erpnext/pull/44240,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2674579474,pull_request,closed,,refactor: Update `Payment Request` search query in PE's reference (backport #44220),"
> [!IMPORTANT]
> Backport is require
<hr>This is an automatic backport of pull request #44220 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 06:22:19+00:00,[],2024-12-05 00:12:42+00:00,2024-11-20 06:46:07+00:00,https://github.com/frappe/erpnext/pull/44239,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2674578713,pull_request,closed,,refactor: Update `Payment Request` search query in PE's reference (backport #44220),"
> [!IMPORTANT]
> Backport is require
<hr>This is an automatic backport of pull request #44220 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 06:21:45+00:00,[],2024-12-05 00:12:36+00:00,2024-11-20 06:46:21+00:00,https://github.com/frappe/erpnext/pull/44238,"[('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2487895153, 'issue_id': 2674578713, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:00 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2674526555,pull_request,closed,,fix: added Stock UOM field for RM in work order (backport #44185),Fixed https://github.com/frappe/erpnext/issues/43050<hr>This is an automatic backport of pull request #44185 done by [Mergify](https://mergify.com).,mergify[bot],2024-11-20 05:52:20+00:00,['rohitwaghchaure'],2024-12-06 00:12:22+00:00,2024-11-21 09:22:37+00:00,https://github.com/frappe/erpnext/pull/44237,[],"[{'comment_id': 2487530619, 'issue_id': 2674526555, 'author': 'mergify[bot]', 'body': 'Cherry-pick of cc571aca8f56310b7f87244ebdbdb91fd6b57222 has failed:\n```\nOn branch mergify/bp/version-15-hotfix/pr-44185\nYour branch is up to date with \'origin/version-15-hotfix\'.\n\nYou are currently cherry-picking commit cc571aca8f.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tmodified:   erpnext/manufacturing/doctype/work_order_item/work_order_item.py\n\tnew file:   erpnext/patches/v14_0/update_stock_uom_in_work_order_item.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/manufacturing/doctype/work_order_item/work_order_item.json\n\tboth modified:   erpnext/patches.txt\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 11, 20, 5, 52, 22, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-11-20 05:52:22 UTC): Cherry-pick of cc571aca8f56310b7f87244ebdbdb91fd6b57222 has failed:
```
On branch mergify/bp/version-15-hotfix/pr-44185
Your branch is up to date with 'origin/version-15-hotfix'.

You are currently cherry-picking commit cc571aca8f.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	modified:   erpnext/manufacturing/doctype/work_order_item/work_order_item.py
	new file:   erpnext/patches/v14_0/update_stock_uom_in_work_order_item.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/manufacturing/doctype/work_order_item/work_order_item.json
	both modified:   erpnext/patches.txt

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2674526438,pull_request,closed,,fix: added Stock UOM field for RM in work order (backport #44185),Fixed https://github.com/frappe/erpnext/issues/43050<hr>This is an automatic backport of pull request #44185 done by [Mergify](https://mergify.com).,mergify[bot],2024-11-20 05:52:15+00:00,['rohitwaghchaure'],2024-12-12 00:12:21+00:00,2024-11-21 09:22:21+00:00,https://github.com/frappe/erpnext/pull/44236,"[('released', None)]","[{'comment_id': 2487530555, 'issue_id': 2674526438, 'author': 'mergify[bot]', 'body': 'Cherry-pick of cc571aca8f56310b7f87244ebdbdb91fd6b57222 has failed:\n```\nOn branch mergify/bp/version-14-hotfix/pr-44185\nYour branch is up to date with \'origin/version-14-hotfix\'.\n\nYou are currently cherry-picking commit cc571aca8f.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tnew file:   erpnext/patches/v14_0/update_stock_uom_in_work_order_item.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/manufacturing/doctype/work_order_item/work_order_item.json\n\tboth modified:   erpnext/manufacturing/doctype/work_order_item/work_order_item.py\n\tboth modified:   erpnext/patches.txt\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 11, 20, 5, 52, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2504157568, 'issue_id': 2674526438, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.3 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.3)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 27, 15, 25, 54, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-11-20 05:52:17 UTC): Cherry-pick of cc571aca8f56310b7f87244ebdbdb91fd6b57222 has failed:
```
On branch mergify/bp/version-14-hotfix/pr-44185
Your branch is up to date with 'origin/version-14-hotfix'.

You are currently cherry-picking commit cc571aca8f.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	new file:   erpnext/patches/v14_0/update_stock_uom_in_work_order_item.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/manufacturing/doctype/work_order_item/work_order_item.json
	both modified:   erpnext/manufacturing/doctype/work_order_item/work_order_item.py
	both modified:   erpnext/patches.txt

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

frappe-pr-bot on (2024-11-27 15:25:54 UTC): :tada: This PR is included in version 14.77.3 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.3)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2674426060,pull_request,closed,,fix: disable conversion to user tz for sales order calender (backport #44203),"There is inconsistencies between the Form View and Calendar View for date .because Form View shows the date as per the system timezone but the calendar view converts it to the user timezone.

Steps to Replicate:
- Change the User Timezone to something with more than 12 hours difference.
- Check the Sales Order Calender.

![image](https://github.com/user-attachments/assets/7da9f28e-83a2-4268-8d7e-3bcbb41eb435)
![image](https://github.com/user-attachments/assets/0d2644db-4805-4f9f-8054-93239ba4f7cf)

Before:
![image](https://github.com/user-attachments/assets/d8edd087-d089-481d-9bc3-5a28052364f3)



After:
![image](https://github.com/user-attachments/assets/5dd3ed89-5561-4c1e-9166-f173d025c92c)


Frappe Support Issue:https://support.frappe.io/helpdesk/tickets/25422
Fraape PR for reference: https://github.com/frappe/frappe/pull/20051

backport version-15 
backport version-14



<hr>This is an automatic backport of pull request #44203 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 05:17:58+00:00,[],2024-12-05 00:12:45+00:00,2024-11-20 06:21:09+00:00,https://github.com/frappe/erpnext/pull/44235,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2674425989,pull_request,closed,,fix: disable conversion to user tz for sales order calender (backport #44203),"There is inconsistencies between the Form View and Calendar View for date .because Form View shows the date as per the system timezone but the calendar view converts it to the user timezone.

Steps to Replicate:
- Change the User Timezone to something with more than 12 hours difference.
- Check the Sales Order Calender.

![image](https://github.com/user-attachments/assets/7da9f28e-83a2-4268-8d7e-3bcbb41eb435)
![image](https://github.com/user-attachments/assets/0d2644db-4805-4f9f-8054-93239ba4f7cf)

Before:
![image](https://github.com/user-attachments/assets/d8edd087-d089-481d-9bc3-5a28052364f3)



After:
![image](https://github.com/user-attachments/assets/5dd3ed89-5561-4c1e-9166-f173d025c92c)


Frappe Support Issue:https://support.frappe.io/helpdesk/tickets/25422
Fraape PR for reference: https://github.com/frappe/frappe/pull/20051

backport version-15 
backport version-14



<hr>This is an automatic backport of pull request #44203 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 05:17:54+00:00,[],2024-12-05 00:12:32+00:00,2024-11-20 06:21:22+00:00,https://github.com/frappe/erpnext/pull/44234,"[('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2487895391, 'issue_id': 2674425989, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 6, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:06 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2674418234,pull_request,closed,,fix: validate sales team to ensure all sales person are enabled (backport #44207),"The system is allowing us to submit the sales invoice document even if the sales person status as disabled.

After:
![image](https://github.com/user-attachments/assets/c85414fd-5b5f-4336-871e-02eca65770b7)


Frappe Support Issue: https://support.frappe.io/app/hd-ticket/25647<hr>This is an automatic backport of pull request #44207 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 05:11:43+00:00,[],2024-12-05 00:12:44+00:00,2024-11-20 06:21:33+00:00,https://github.com/frappe/erpnext/pull/44233,"[('selling', None), ('needs-tests', 'This PR needs automated unit-tests.')]",[],
2674418133,pull_request,closed,,fix: validate sales team to ensure all sales person are enabled (backport #44207),"The system is allowing us to submit the sales invoice document even if the sales person status as disabled.

After:
![image](https://github.com/user-attachments/assets/c85414fd-5b5f-4336-871e-02eca65770b7)


Frappe Support Issue: https://support.frappe.io/app/hd-ticket/25647<hr>This is an automatic backport of pull request #44207 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-20 05:11:37+00:00,[],2024-12-05 00:12:34+00:00,2024-11-20 06:21:56+00:00,https://github.com/frappe/erpnext/pull/44232,"[('selling', None), ('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2487895277, 'issue_id': 2674418133, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 3, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:03 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2674046441,pull_request,closed,,fix: net_amount calculation,"depends on: 
- https://github.com/frappe/frappe/pull/28525
- https://github.com/frappe/frappe/pull/28526

This PR ensures that `item_tax_rate` is populated from the doc-wide template, if available and if no item wise tax has been set.

This is necessary to match net_amounts to account heads in taxes and totals.

fixes: #44219

---
**Before NOK**
```
❯ tail -f erpnext.controllers.taxes_and_totals.log
2024-11-20 00:10:43,131 DEBUG erpnext.controllers.taxes_and_totals Sales Invoice (FUP00006) ...
2024-11-20 00:10:43,132 DEBUG erpnext.controllers.taxes_and_totals  Item 0: ALMBOT1050
2024-11-20 00:10:43,132 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 50420.17             tax_amount: 9579.83              - IVA @ 19
2024-11-20 00:10:43,132 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 50420.17             tax_amount: 0.0                  - 240805 - IVA Descontable
2024-11-20 00:10:43,132 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 50420.17             tax_amount: 26.82                - Gastos de personal (fijo)
2024-11-20 00:10:43,132 DEBUG erpnext.controllers.taxes_and_totals  Item 1: ARAN500 - {'240801 - IVA Generado - P': 0.0, '240805 - IVA Descontable - P': 0.0}
2024-11-20 00:10:43,133 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 100000.0             tax_amount: 0.0                  - IVA @ 19
2024-11-20 00:10:43,133 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 100000.0             tax_amount: 0.0                  - 240805 - IVA Descontable
2024-11-20 00:10:43,134 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 100000.0             tax_amount: 53.18                - Gastos de personal (fijo)
```

**Now OK** 
_compare `net_amount` of `ALMBOT1050` for `240805 - IVA Descontable` and also note the new item rate ` {'240801 - IVA Generado - P': 19.0}` addition_
```
❯ tail -f erpnext.controllers.taxes_and_totals.log
2024-11-20 02:48:38,133 DEBUG erpnext.controllers.taxes_and_totals Sales Invoice (FUP00006) ...
2024-11-20 02:48:38,135 DEBUG erpnext.controllers.taxes_and_totals  Item 0: ALMBOT1050 - {'240801 - IVA Generado - P': 19.0}
2024-11-20 02:48:38,135 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 50420.17             tax_amount: 9579.83              - IVA @ 19
2024-11-20 02:48:38,136 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 0.0                  tax_amount: 0.0                  - 240805 - IVA Descontable
2024-11-20 02:48:38,136 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 50420.17             tax_amount: 26.82                - Gastos de personal (fijo)
2024-11-20 02:48:38,136 DEBUG erpnext.controllers.taxes_and_totals  Item 1: ARAN500 - {'240801 - IVA Generado - P': 0.0, '240805 - IVA Descontable - P': 0.0}
2024-11-20 02:48:38,137 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 100000.0             tax_amount: 0.0                  - IVA @ 19
2024-11-20 02:48:38,137 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 100000.0             tax_amount: 0.0                  - 240805 - IVA Descontable
2024-11-20 02:48:38,138 DEBUG erpnext.controllers.taxes_and_totals   net_amount: 100000.0             tax_amount: 53.18                - Gastos de personal (fijo)
```
",blaggacao,2024-11-20 01:33:32+00:00,[],2024-12-08 00:13:09+00:00,2024-11-23 22:10:33+00:00,https://github.com/frappe/erpnext/pull/44231,"[('accounts', ''), ('stock', None), ('do not backport', '')]",[],
2673917221,pull_request,closed,,refactor: pass typed arguments to get_item_details methods,"This is a clarification in order to be able to investigate https://github.com/frappe/erpnext/issues/44219

This works by being able to reliably `grep` for `ItemDetailCtx` or use similar intellisense features.",blaggacao,2024-11-19 23:39:05+00:00,[],2024-12-05 00:12:50+00:00,2024-11-20 01:31:04+00:00,https://github.com/frappe/erpnext/pull/44230,[],[],
2673796178,pull_request,closed,,fix: partial fix for #44291,"This is only a partial fix and improves the situaton.

A proper fix will need to have items _always_ track their tax-related
account head, namely for item-wise tax templates as well as default
document taxes that are applied ""On Net Total"", in order to achive
proper assignment of the net_amount.

Currently there is no way to always identify the orignating account head per item.

cc @barredterra
",blaggacao,2024-11-19 22:49:47+00:00,[],2024-12-05 00:12:16+00:00,2024-11-19 23:15:23+00:00,https://github.com/frappe/erpnext/pull/44229,"[('accounts', ''), ('needs-tests', 'This PR needs automated unit-tests.'), ('do not backport', '')]",[],
2673724525,pull_request,closed,,refactor: make stem utility for normalizing ctx args from dict json-str or Document,"This PR creates a stem utility that can be used in refactoring like #44226 in order
to normalize a `ctx` parameter into the given type from these types:

 - Json String, e.g. coming from the frontend
 - dict coming from a pre-processed json payload or from a _dict or dict
 - Document instance passed as is

This can be used to cast the input into a local type to improve maintainability of the code.

It also ensures that a document instance is copied (via as_dict) to avoid mutations.

cc @ruthra-kumar
",blaggacao,2024-11-19 22:32:56+00:00,[],2024-12-05 00:12:15+00:00,2024-11-19 23:40:17+00:00,https://github.com/frappe/erpnext/pull/44228,[],"[{'comment_id': 2486896467, 'issue_id': 2673724525, 'author': 'blaggacao', 'body': ""@cogk I'd appreciate your pair of eyeballs on this one, as well. Maybe you got some input... :smile:"", 'created_at': datetime.datetime(2024, 11, 19, 22, 39, 46, tzinfo=datetime.timezone.utc)}, {'comment_id': 2486988850, 'issue_id': 2673724525, 'author': 'blaggacao', 'body': 'Since this blocks https://github.com/frappe/erpnext/pull/44230 and that is an informational dependency to address https://github.com/frappe/erpnext/issues/44219, I need to move ahead here, but still would be interested in feedback and will patch, accordingly.', 'created_at': datetime.datetime(2024, 11, 19, 23, 40, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2487498682, 'issue_id': 2673724525, 'author': 'ruthra-kumar', 'body': '@blaggacao \r\n\r\n### App Versions\r\n```\r\n{\r\n\t""erpnext"": ""16.0.0-dev"",\r\n\t""frappe"": ""16.0.0-dev"",\r\n\t""payments"": ""0.0.1""\r\n}\r\n```\r\n### Route\r\n```\r\nForm/Purchase Invoice/new-purchase-invoice-dqwxtgpbpy\r\n```\r\n### Traceback\r\n```\r\nTraceback (most recent call last):\r\n  File ""apps/frappe/frappe/app.py"", line 118, in application\r\n    response = frappe.api.handle(request)\r\n  File ""apps/frappe/frappe/api/__init__.py"", line 49, in handle\r\n    data = endpoint(**arguments)\r\n  File ""apps/frappe/frappe/api/v1.py"", line 36, in handle_rpc_call\r\n    return frappe.handler.handle()\r\n  File ""apps/frappe/frappe/handler.py"", line 49, in handle\r\n    data = execute_cmd(cmd)\r\n  File ""apps/frappe/frappe/handler.py"", line 85, in execute_cmd\r\n    return frappe.call(method, **frappe.form_dict)\r\n  File ""apps/frappe/frappe/__init__.py"", line 1807, in call\r\n    return fn(*args, **newargs)\r\n  File ""apps/frappe/frappe/utils/typing_validations.py"", line 32, in wrapper\r\n    return func(*args, **kwargs)\r\nTypeError: apply_price_list() missing 1 required positional argument: \'ctx\'\r\n\r\n```\r\n### Request Data\r\n```\r\n{\r\n\t""type"": ""POST"",\r\n\t""args"": {\r\n\t\t""args"": ""{\\""items\\"":[],\\""currency\\"":\\""INR\\"",\\""conversion_rate\\"":1,\\""price_list\\"":\\""Standard Buying\\"",\\""price_list_currency\\"":\\""INR\\"",\\""plc_conversion_rate\\"":\\""\\"",\\""company\\"":\\""Rustic Nation\\"",\\""transaction_date\\"":\\""2024-11-20\\"",\\""ignore_pricing_rule\\"":0,\\""doctype\\"":\\""Purchase Invoice\\"",\\""name\\"":\\""new-purchase-invoice-dqwxtgpbpy\\"",\\""is_return\\"":0,\\""update_stock\\"":0,\\""pos_profile\\"":\\""\\"",\\""is_internal_supplier\\"":0}"",\r\n\t\t""doc"": ""{\\""docstatus\\"":0,\\""doctype\\"":\\""Purchase Invoice\\"",\\""name\\"":\\""new-purchase-invoice-dqwxtgpbpy\\"",\\""__islocal\\"":1,\\""__unsaved\\"":1,\\""owner\\"":\\""Administrator\\"",\\""naming_series\\"":\\""ACC-PINV-.YYYY.-\\"",\\""company\\"":\\""Rustic Nation\\"",\\""posting_date\\"":\\""2024-11-20\\"",\\""set_posting_time\\"":0,\\""is_paid\\"":0,\\""is_return\\"":0,\\""update_outstanding_for_self\\"":1,\\""update_billed_amount_in_purchase_order\\"":0,\\""update_billed_amount_in_purchase_receipt\\"":1,\\""apply_tds\\"":0,\\""currency\\"":\\""INR\\"",\\""use_transaction_date_exchange_rate\\"":0,\\""buying_price_list\\"":\\""Standard Buying\\"",\\""price_list_currency\\"":\\""INR\\"",\\""ignore_pricing_rule\\"":0,\\""update_stock\\"":0,\\""is_subcontracted\\"":0,\\""items\\"":[{\\""docstatus\\"":0,\\""doctype\\"":\\""Purchase Invoice Item\\"",\\""name\\"":\\""new-purchase-invoice-item-cfrlgeqczb\\"",\\""__islocal\\"":1,\\""__unsaved\\"":1,\\""owner\\"":\\""Administrator\\"",\\""conversion_factor\\"":1,\\""stock_uom\\"":\\""Nos\\"",\\""margin_type\\"":\\""\\"",\\""is_free_item\\"":0,\\""apply_tds\\"":1,\\""use_serial_batch_fields\\"":1,\\""is_fixed_asset\\"":0,\\""enable_deferred_expense\\"":0,\\""allow_zero_valuation_rate\\"":0,\\""include_exploded_items\\"":0,\\""cost_center\\"":\\""Main - RN\\"",\\""page_break\\"":0,\\""parent\\"":\\""new-purchase-invoice-dqwxtgpbpy\\"",\\""parentfield\\"":\\""items\\"",\\""parenttype\\"":\\""Purchase Invoice\\"",\\""idx\\"":1}],\\""tax_withholding_net_total\\"":0,\\""taxes\\"":[],\\""use_company_roundoff_cost_center\\"":0,\\""disable_rounded_total\\"":0,\\""apply_discount_on\\"":\\""Grand Total\\"",\\""tax_withheld_vouchers\\"":[],\\""pricing_rules\\"":[],\\""supplied_items\\"":[],\\""allocate_advances_automatically\\"":0,\\""only_include_allocated_payments\\"":0,\\""advances\\"":[],\\""advance_tax\\"":[],\\""ignore_default_payment_terms_template\\"":0,\\""payment_schedule\\"":[],\\""status\\"":\\""Draft\\"",\\""party_account_currency\\"":\\""INR\\"",\\""is_opening\\"":\\""No\\"",\\""group_same_items\\"":0,\\""on_hold\\"":0,\\""is_internal_supplier\\"":0,\\""represents_company\\"":\\""Rustic Nation\\"",\\""is_old_subcontracting_flow\\"":0,\\""posting_time\\"":\\""11:08:55\\"",\\""conversion_rate\\"":1,\\""plc_conversion_rate\\"":\\""\\""}""\r\n\t},\r\n\t""headers"": {},\r\n\t""error_handlers"": {},\r\n\t""url"": ""/api/method/erpnext.stock.get_item_details.apply_price_list"",\r\n\t""request_id"": null\r\n}\r\n```\r\n### Response Data\r\n```\r\n{\r\n\t""exception"": ""TypeError: apply_price_list() missing 1 required positional argument: \'ctx\'"",\r\n\t""exc_type"": ""TypeError""\r\n}\r\n```', 'created_at': datetime.datetime(2024, 11, 20, 5, 40, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2488372668, 'issue_id': 2673724525, 'author': 'ruthra-kumar', 'body': 'Issue is prevalent in Sales Invoice as well.\r\n<img width=""1416"" alt=""Screenshot 2024-11-20 at 5 17 02\u202fPM"" src=""https://github.com/user-attachments/assets/a29f0a29-7441-4504-9733-f633fb1a8914"">', 'created_at': datetime.datetime(2024, 11, 20, 11, 47, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2489257231, 'issue_id': 2673724525, 'author': 'blaggacao', 'body': 'Thanks @barredterra for having my back with https://github.com/frappe/erpnext/pull/44253', 'created_at': datetime.datetime(2024, 11, 20, 18, 13, 23, tzinfo=datetime.timezone.utc)}]","blaggacao (Issue Creator) on (2024-11-19 22:39:46 UTC): @cogk I'd appreciate your pair of eyeballs on this one, as well. Maybe you got some input... :smile:

blaggacao (Issue Creator) on (2024-11-19 23:40:08 UTC): Since this blocks https://github.com/frappe/erpnext/pull/44230 and that is an informational dependency to address https://github.com/frappe/erpnext/issues/44219, I need to move ahead here, but still would be interested in feedback and will patch, accordingly.

ruthra-kumar on (2024-11-20 05:40:08 UTC): @blaggacao 

### App Versions
```
{
	""erpnext"": ""16.0.0-dev"",
	""frappe"": ""16.0.0-dev"",
	""payments"": ""0.0.1""
}
```
### Route
```
Form/Purchase Invoice/new-purchase-invoice-dqwxtgpbpy
```
### Traceback
```
Traceback (most recent call last):
  File ""apps/frappe/frappe/app.py"", line 118, in application
    response = frappe.api.handle(request)
  File ""apps/frappe/frappe/api/__init__.py"", line 49, in handle
    data = endpoint(**arguments)
  File ""apps/frappe/frappe/api/v1.py"", line 36, in handle_rpc_call
    return frappe.handler.handle()
  File ""apps/frappe/frappe/handler.py"", line 49, in handle
    data = execute_cmd(cmd)
  File ""apps/frappe/frappe/handler.py"", line 85, in execute_cmd
    return frappe.call(method, **frappe.form_dict)
  File ""apps/frappe/frappe/__init__.py"", line 1807, in call
    return fn(*args, **newargs)
  File ""apps/frappe/frappe/utils/typing_validations.py"", line 32, in wrapper
    return func(*args, **kwargs)
TypeError: apply_price_list() missing 1 required positional argument: 'ctx'

```
### Request Data
```
{
	""type"": ""POST"",
	""args"": {
		""args"": ""{\""items\"":[],\""currency\"":\""INR\"",\""conversion_rate\"":1,\""price_list\"":\""Standard Buying\"",\""price_list_currency\"":\""INR\"",\""plc_conversion_rate\"":\""\"",\""company\"":\""Rustic Nation\"",\""transaction_date\"":\""2024-11-20\"",\""ignore_pricing_rule\"":0,\""doctype\"":\""Purchase Invoice\"",\""name\"":\""new-purchase-invoice-dqwxtgpbpy\"",\""is_return\"":0,\""update_stock\"":0,\""pos_profile\"":\""\"",\""is_internal_supplier\"":0}"",
		""doc"": ""{\""docstatus\"":0,\""doctype\"":\""Purchase Invoice\"",\""name\"":\""new-purchase-invoice-dqwxtgpbpy\"",\""__islocal\"":1,\""__unsaved\"":1,\""owner\"":\""Administrator\"",\""naming_series\"":\""ACC-PINV-.YYYY.-\"",\""company\"":\""Rustic Nation\"",\""posting_date\"":\""2024-11-20\"",\""set_posting_time\"":0,\""is_paid\"":0,\""is_return\"":0,\""update_outstanding_for_self\"":1,\""update_billed_amount_in_purchase_order\"":0,\""update_billed_amount_in_purchase_receipt\"":1,\""apply_tds\"":0,\""currency\"":\""INR\"",\""use_transaction_date_exchange_rate\"":0,\""buying_price_list\"":\""Standard Buying\"",\""price_list_currency\"":\""INR\"",\""ignore_pricing_rule\"":0,\""update_stock\"":0,\""is_subcontracted\"":0,\""items\"":[{\""docstatus\"":0,\""doctype\"":\""Purchase Invoice Item\"",\""name\"":\""new-purchase-invoice-item-cfrlgeqczb\"",\""__islocal\"":1,\""__unsaved\"":1,\""owner\"":\""Administrator\"",\""conversion_factor\"":1,\""stock_uom\"":\""Nos\"",\""margin_type\"":\""\"",\""is_free_item\"":0,\""apply_tds\"":1,\""use_serial_batch_fields\"":1,\""is_fixed_asset\"":0,\""enable_deferred_expense\"":0,\""allow_zero_valuation_rate\"":0,\""include_exploded_items\"":0,\""cost_center\"":\""Main - RN\"",\""page_break\"":0,\""parent\"":\""new-purchase-invoice-dqwxtgpbpy\"",\""parentfield\"":\""items\"",\""parenttype\"":\""Purchase Invoice\"",\""idx\"":1}],\""tax_withholding_net_total\"":0,\""taxes\"":[],\""use_company_roundoff_cost_center\"":0,\""disable_rounded_total\"":0,\""apply_discount_on\"":\""Grand Total\"",\""tax_withheld_vouchers\"":[],\""pricing_rules\"":[],\""supplied_items\"":[],\""allocate_advances_automatically\"":0,\""only_include_allocated_payments\"":0,\""advances\"":[],\""advance_tax\"":[],\""ignore_default_payment_terms_template\"":0,\""payment_schedule\"":[],\""status\"":\""Draft\"",\""party_account_currency\"":\""INR\"",\""is_opening\"":\""No\"",\""group_same_items\"":0,\""on_hold\"":0,\""is_internal_supplier\"":0,\""represents_company\"":\""Rustic Nation\"",\""is_old_subcontracting_flow\"":0,\""posting_time\"":\""11:08:55\"",\""conversion_rate\"":1,\""plc_conversion_rate\"":\""\""}""
	},
	""headers"": {},
	""error_handlers"": {},
	""url"": ""/api/method/erpnext.stock.get_item_details.apply_price_list"",
	""request_id"": null
}
```
### Response Data
```
{
	""exception"": ""TypeError: apply_price_list() missing 1 required positional argument: 'ctx'"",
	""exc_type"": ""TypeError""
}
```

ruthra-kumar on (2024-11-20 11:47:15 UTC): Issue is prevalent in Sales Invoice as well.
<img width=""1416"" alt=""Screenshot 2024-11-20 at 5 17 02 PM"" src=""https://github.com/user-attachments/assets/a29f0a29-7441-4504-9733-f633fb1a8914"">

blaggacao (Issue Creator) on (2024-11-20 18:13:23 UTC): Thanks @barredterra for having my back with https://github.com/frappe/erpnext/pull/44253

"
2672940160,pull_request,closed,,refactor: cleanup args structure akin to some typing,"this clarification is a human precondition to being able to investigate and fix https://github.com/frappe/erpnext/issues/44219
",blaggacao,2024-11-19 17:26:18+00:00,[],2024-12-04 00:12:14+00:00,2024-11-19 22:27:57+00:00,https://github.com/frappe/erpnext/pull/44226,"[('stock', None)]","[{'comment_id': 2486667628, 'issue_id': 2672940160, 'author': 'blaggacao', 'body': 'https://github.com/frappe/erpnext/pull/44228 holds a generalization of the context normalizer pattern.', 'created_at': datetime.datetime(2024, 11, 19, 20, 18, 28, tzinfo=datetime.timezone.utc)}]","blaggacao (Issue Creator) on (2024-11-19 20:18:28 UTC): https://github.com/frappe/erpnext/pull/44228 holds a generalization of the context normalizer pattern.

"
2672885928,pull_request,closed,,Update accounts_payable_summary.js,"Normally, ageing is seen from the initial date of any entry. So, at most of the place default ageing is required on the basis of posting date.

<!--

Some key notes before you open a PR:

 1. Select which branch should this PR be merged in?
 2. PR name follows [convention](http://karma-runner.github.io/4.0/dev/git-commit-msg.html)
 3. All tests pass locally, UI and Unit tests
 4. All business logic and validations must be on the server-side
 5. Update necessary Documentation
 6. Put `closes #XXXX` in your comment to auto-close the issue that your PR fixes


Also, if you're new here

- Documentation Guidelines => https://github.com/frappe/erpnext/wiki/Updating-Documentation

- Contribution Guide => https://github.com/frappe/erpnext/blob/develop/.github/CONTRIBUTING.md

- Pull Request Checklist => https://github.com/frappe/erpnext/wiki/Pull-Request-Checklist

-->

> Please provide enough information so that others can review your pull request:

<!-- You can skip this if you're fixing a typo or updating existing documentation -->

> Explain the **details** for making this change. What existing problem does the pull request solve?

<!-- Example: When ""Adding a function to do X"", explain why it is necessary to have a way to do X. -->

> Screenshots/GIFs

<!-- Add images/recordings to better visualize the change: expected/current behviour -->
",akashdubey22,2024-11-19 17:00:34+00:00,[],2024-12-07 00:12:08+00:00,2024-11-22 10:13:33+00:00,https://github.com/frappe/erpnext/pull/44225,[],[],
2672883366,pull_request,closed,,Update accounts_payable.js,"Normally, ageing is seen from the initial date of any entry. So, at most of the place default ageing is required on the basis of posting date.

<!--

Some key notes before you open a PR:

 1. Select which branch should this PR be merged in?
 2. PR name follows [convention](http://karma-runner.github.io/4.0/dev/git-commit-msg.html)
 3. All tests pass locally, UI and Unit tests
 4. All business logic and validations must be on the server-side
 5. Update necessary Documentation
 6. Put `closes #XXXX` in your comment to auto-close the issue that your PR fixes


Also, if you're new here

- Documentation Guidelines => https://github.com/frappe/erpnext/wiki/Updating-Documentation

- Contribution Guide => https://github.com/frappe/erpnext/blob/develop/.github/CONTRIBUTING.md

- Pull Request Checklist => https://github.com/frappe/erpnext/wiki/Pull-Request-Checklist

-->

> Please provide enough information so that others can review your pull request:

<!-- You can skip this if you're fixing a typo or updating existing documentation -->

> Explain the **details** for making this change. What existing problem does the pull request solve?

<!-- Example: When ""Adding a function to do X"", explain why it is necessary to have a way to do X. -->

> Screenshots/GIFs

<!-- Add images/recordings to better visualize the change: expected/current behviour -->
",akashdubey22,2024-11-19 16:59:31+00:00,[],2024-12-07 00:12:09+00:00,2024-11-22 10:13:25+00:00,https://github.com/frappe/erpnext/pull/44224,[],[],
2672879794,pull_request,closed,,Update accounts_receivable_summary.js,"Normally, ageing is seen from the initial date of any entry. So, at most of the place default ageing is required on the basis of posting date.

<!--

Some key notes before you open a PR:

 1. Select which branch should this PR be merged in?
 2. PR name follows [convention](http://karma-runner.github.io/4.0/dev/git-commit-msg.html)
 3. All tests pass locally, UI and Unit tests
 4. All business logic and validations must be on the server-side
 5. Update necessary Documentation
 6. Put `closes #XXXX` in your comment to auto-close the issue that your PR fixes


Also, if you're new here

- Documentation Guidelines => https://github.com/frappe/erpnext/wiki/Updating-Documentation

- Contribution Guide => https://github.com/frappe/erpnext/blob/develop/.github/CONTRIBUTING.md

- Pull Request Checklist => https://github.com/frappe/erpnext/wiki/Pull-Request-Checklist

-->

> Please provide enough information so that others can review your pull request:

<!-- You can skip this if you're fixing a typo or updating existing documentation -->

> Explain the **details** for making this change. What existing problem does the pull request solve?

<!-- Example: When ""Adding a function to do X"", explain why it is necessary to have a way to do X. -->

> Screenshots/GIFs

<!-- Add images/recordings to better visualize the change: expected/current behviour -->
",akashdubey22,2024-11-19 16:58:06+00:00,[],2024-12-07 00:12:10+00:00,2024-11-22 10:13:15+00:00,https://github.com/frappe/erpnext/pull/44223,[],[],
2672872500,pull_request,closed,,refactor: default ageing changed to posting date in accounts_receivable.js,"…le.js

Normally, ageing is seen from the initial date of any entry. So, at most of the place ageing is required on the basis of posting date.

<!--

Some key notes before you open a PR:

 1. Select which branch should this PR be merged in?
 2. PR name follows [convention](http://karma-runner.github.io/4.0/dev/git-commit-msg.html)
 3. All tests pass locally, UI and Unit tests
 4. All business logic and validations must be on the server-side
 5. Update necessary Documentation
 6. Put `closes #XXXX` in your comment to auto-close the issue that your PR fixes


Also, if you're new here

- Documentation Guidelines => https://github.com/frappe/erpnext/wiki/Updating-Documentation

- Contribution Guide => https://github.com/frappe/erpnext/blob/develop/.github/CONTRIBUTING.md

- Pull Request Checklist => https://github.com/frappe/erpnext/wiki/Pull-Request-Checklist

-->

> Please provide enough information so that others can review your pull request:

<!-- You can skip this if you're fixing a typo or updating existing documentation -->

> Explain the **details** for making this change. What existing problem does the pull request solve?

<!-- Example: When ""Adding a function to do X"", explain why it is necessary to have a way to do X. -->

> Screenshots/GIFs

<!-- Add images/recordings to better visualize the change: expected/current behviour -->
",akashdubey22,2024-11-19 16:55:38+00:00,['ruthra-kumar'],2024-12-07 00:12:11+00:00,2024-11-22 10:13:01+00:00,https://github.com/frappe/erpnext/pull/44222,[],"[{'comment_id': 2487458291, 'issue_id': 2672872500, 'author': 'ruthra-kumar', 'body': ""@akashdubey22 \r\n\r\nThere hasn't been many requests to change the default. Furthermore you can always save the filters (with custom name) for later use.\r\n\r\nWill be closing this and the related PR's."", 'created_at': datetime.datetime(2024, 11, 20, 5, 3, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2489230652, 'issue_id': 2672872500, 'author': 'akashdubey22', 'body': '@ruthra-kumar \r\n\r\nA couple of version back it was correct, but somehow it got changed. Few departments like IncomeTax & ROC ask for ageing from the date of Billing, but due to default setting there can be mistake in calculating the correct age of entry.\r\n\r\n\r\n![image](https://github.com/user-attachments/assets/8fb02ffe-0702-4ad9-a0fb-22f314f72395)', 'created_at': datetime.datetime(2024, 11, 20, 17, 58, 38, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Assginee) on (2024-11-20 05:03:12 UTC): @akashdubey22 

There hasn't been many requests to change the default. Furthermore you can always save the filters (with custom name) for later use.

Will be closing this and the related PR's.

akashdubey22 (Issue Creator) on (2024-11-20 17:58:38 UTC): @ruthra-kumar 

A couple of version back it was correct, but somehow it got changed. Few departments like IncomeTax & ROC ask for ageing from the date of Billing, but due to default setting there can be mistake in calculating the correct age of entry.


![image](https://github.com/user-attachments/assets/8fb02ffe-0702-4ad9-a0fb-22f314f72395)

"
2672341467,pull_request,closed,,fix: remove validate_name_in_customer function (backport #41025),"**Problem:**
When we create a customer group the function ""validate_name_with_customer"" is called which checks whether the name of customer group exists in ""Customer"" DocType.
For e.g.
If we create a customer group called ""XYZ"",  in the on_update method in customer_group.py file, the code will check whether a customer with a name of ""XYZ"" is already created or not. If it is created it throws an error ""A customer with the same name already exists"".



**Solution:**
Remove validate_name_with_customer from ""customer_group.py"" file.<hr>This is an automatic backport of pull request #41025 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-19 14:22:39+00:00,['RitvikSardana'],2024-12-05 00:12:48+00:00,2024-11-20 04:49:29+00:00,https://github.com/frappe/erpnext/pull/44221,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2672025348,pull_request,closed,,refactor: Update `Payment Request` search query in PE's reference,"
> [!IMPORTANT]
> Backport is require
",Abdeali099,2024-11-19 12:33:08+00:00,['ruthra-kumar'],2024-12-17 00:12:10+00:00,2024-11-20 06:20:49+00:00,https://github.com/frappe/erpnext/pull/44220,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]","[{'comment_id': 2487470847, 'issue_id': 2672025348, 'author': 'ruthra-kumar', 'body': '@Abdeali099 \r\n\r\nIs this ready to merge? Also specify the versions for which backport is needed', 'created_at': datetime.datetime(2024, 11, 20, 5, 15, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2487593744, 'issue_id': 2672025348, 'author': 'Abdeali099', 'body': '> @Abdeali099\r\n> \r\n> Is this ready to merge? Also specify the versions for which backport is needed\r\n\r\nYes, it is ready.\r\n\r\nBoth 14 and 15.', 'created_at': datetime.datetime(2024, 11, 20, 6, 19, 38, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Assginee) on (2024-11-20 05:15:45 UTC): @Abdeali099 

Is this ready to merge? Also specify the versions for which backport is needed

Abdeali099 (Issue Creator) on (2024-11-20 06:19:38 UTC): Yes, it is ready.

Both 14 and 15.

"
2671985620,pull_request,closed,,fix(setup): Fix typo in COA setup (backport #44190),<hr>This is an automatic backport of pull request #44190 done by [Mergify](https://mergify.com).,mergify[bot],2024-11-19 12:15:17+00:00,[],2024-12-04 00:12:17+00:00,2024-11-19 14:21:41+00:00,https://github.com/frappe/erpnext/pull/44218,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2671904316,pull_request,closed,,fix: check if pricing rule matches with coupon code (backport #44104),"### Summary
There are two coupon codes, each with distinct pricing rules:

1. Karneval2024: Discounts a specific item (20%, Item Code 003).
2. Winter2024: Discounts items from a specific item group (50%, Item Group ""Accessoire"").

In a sales order, two items are added. The first item belongs to the item group eligible for a discount from Winter2024, while the second item is the specific item eligible for a discount through Karneval2024.

When I apply Karneval2024 in the sales order to discount only the specific item, Winter2024 pricing rule is also incorrectly applied, as it matches the second item (because it is in the item group).

### Changes
Update the check in `get_pricing_rule_for_item` and check whether the current pricing rule matches the specified voucher code.

### Backports
version-14
version-15

### Issue
closes #40013

### Images
Winter2024 Coupon Code and Pricing Rule:
![image](https://github.com/user-attachments/assets/a217cc1b-9a46-4fec-bb21-35f9364808cb)
![image](https://github.com/user-attachments/assets/255a9f87-426c-4366-a4fc-d580e8436308)

Karneval2024 Coupon Code and Pricing Rule:
![image](https://github.com/user-attachments/assets/46e34e2e-ca56-49e3-9991-e556b881dba8)
![image](https://github.com/user-attachments/assets/3ab17b37-30b6-454b-9ee0-28ffc9e9e3f9)

Added Karneval2024 Coupon Code to Sales Order, both Items discounted:
![image](https://github.com/user-attachments/assets/3f6e5ca3-6f2b-40a8-91aa-e4775661bf5b)
![image](https://github.com/user-attachments/assets/d37fd9ba-3684-451b-93b3-89af97007e3e)
<hr>This is an automatic backport of pull request #44104 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-19 11:42:08+00:00,[],2024-12-04 00:12:18+00:00,2024-11-19 12:07:55+00:00,https://github.com/frappe/erpnext/pull/44217,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2671903634,pull_request,closed,,fix: check if pricing rule matches with coupon code (backport #44104),"### Summary
There are two coupon codes, each with distinct pricing rules:

1. Karneval2024: Discounts a specific item (20%, Item Code 003).
2. Winter2024: Discounts items from a specific item group (50%, Item Group ""Accessoire"").

In a sales order, two items are added. The first item belongs to the item group eligible for a discount from Winter2024, while the second item is the specific item eligible for a discount through Karneval2024.

When I apply Karneval2024 in the sales order to discount only the specific item, Winter2024 pricing rule is also incorrectly applied, as it matches the second item (because it is in the item group).

### Changes
Update the check in `get_pricing_rule_for_item` and check whether the current pricing rule matches the specified voucher code.

### Backports
version-14
version-15

### Issue
closes #40013

### Images
Winter2024 Coupon Code and Pricing Rule:
![image](https://github.com/user-attachments/assets/a217cc1b-9a46-4fec-bb21-35f9364808cb)
![image](https://github.com/user-attachments/assets/255a9f87-426c-4366-a4fc-d580e8436308)

Karneval2024 Coupon Code and Pricing Rule:
![image](https://github.com/user-attachments/assets/46e34e2e-ca56-49e3-9991-e556b881dba8)
![image](https://github.com/user-attachments/assets/3ab17b37-30b6-454b-9ee0-28ffc9e9e3f9)

Added Karneval2024 Coupon Code to Sales Order, both Items discounted:
![image](https://github.com/user-attachments/assets/3f6e5ca3-6f2b-40a8-91aa-e4775661bf5b)
![image](https://github.com/user-attachments/assets/d37fd9ba-3684-451b-93b3-89af97007e3e)
<hr>This is an automatic backport of pull request #44104 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-19 11:41:52+00:00,[],2024-12-05 00:12:33+00:00,2024-11-19 12:07:34+00:00,https://github.com/frappe/erpnext/pull/44216,"[('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2487895497, 'issue_id': 2671903634, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 9, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:09 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2671874428,pull_request,closed,,fix: field read only property on taxes net_amount,"Spotted https://github.com/frappe/erpnext/pull/43372/files#r1847451232

cc @barredterra 
",blaggacao,2024-11-19 11:30:25+00:00,[],2024-12-05 00:12:51+00:00,2024-11-19 11:58:28+00:00,https://github.com/frappe/erpnext/pull/44215,[],[],
2671777912,pull_request,closed,,fix: incorrect eval expression,regression: https://github.com/frappe/erpnext/pull/42071,ruthra-kumar,2024-11-19 11:07:18+00:00,[],2024-12-04 00:12:21+00:00,2024-11-19 11:35:51+00:00,https://github.com/frappe/erpnext/pull/44214,[],[],
2671720649,pull_request,closed,,fix: sync translations from crowdin,,frappe-pr-bot,2024-11-19 10:47:21+00:00,[],2024-12-04 00:12:20+00:00,2024-11-19 11:41:39+00:00,https://github.com/frappe/erpnext/pull/44213,"[('translation', None)]",[],
2671681840,pull_request,closed,,fix: update project cost from timesheet (backport #44211),<hr>This is an automatic backport of pull request #44211 done by [Mergify](https://mergify.com).,mergify[bot],2024-11-19 10:43:36+00:00,['rohitwaghchaure'],2024-12-04 00:12:16+00:00,2024-11-19 17:29:18+00:00,https://github.com/frappe/erpnext/pull/44212,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2671592945,pull_request,closed,,fix: update project cost from timesheet,,rohitwaghchaure,2024-11-19 10:14:05+00:00,[],2024-12-04 00:12:22+00:00,2024-11-19 10:42:23+00:00,https://github.com/frappe/erpnext/pull/44211,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]",[],
2671490851,pull_request,closed,,chore: release v14,Automated weekly release.,frappe-pr-bot,2024-11-19 09:36:45+00:00,[],2024-12-05 00:12:38+00:00,2024-11-20 08:36:14+00:00,https://github.com/frappe/erpnext/pull/44210,"[('released', None)]","[{'comment_id': 2487894838, 'issue_id': 2671490851, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 37, 51, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot (Issue Creator) on (2024-11-20 08:37:51 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2671489243,pull_request,closed,,chore: release v15,Automated weekly release.,frappe-pr-bot,2024-11-19 09:36:35+00:00,[],2024-12-05 00:12:19+00:00,2024-11-20 08:39:56+00:00,https://github.com/frappe/erpnext/pull/44209,"[('accounts', ''), ('stock', None)]",[],
2671369089,pull_request,closed,,fix: validate sales team to ensure all sales person are enabled,"The system is allowing us to submit the sales invoice document even if the sales person status as disabled.

After:
![image](https://github.com/user-attachments/assets/c85414fd-5b5f-4336-871e-02eca65770b7)


Frappe Support Issue: https://support.frappe.io/app/hd-ticket/25647",ljain112,2024-11-19 09:02:24+00:00,[],2024-12-05 00:12:47+00:00,2024-11-20 05:10:35+00:00,https://github.com/frappe/erpnext/pull/44207,"[('selling', None), ('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2671352957,pull_request,closed,,"fix: updated label ""Is short year"" to ""Is Short/Long year"" for both short and long fiscal years (backport #44145)","Is short/long year.

FY can be short or long here in Nepal.

FY starts in July every year, but date can be 15/16/17 which varies every year.
Also FY end date can be different.

For ex. any of this is possible:
1. Start : 07-16 End: 07-15
2. Start : 07-16 End: 07-16
3. Start : 07-16 End: 07-14

Same goes for other dates. 

The `Is short year` check mark seems to work good for long years as well. So, decided to update the text label to avoid confusion.<hr>This is an automatic backport of pull request #44145 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-19 08:56:56+00:00,[],2024-12-04 00:12:25+00:00,2024-11-19 09:17:19+00:00,https://github.com/frappe/erpnext/pull/44206,[],[],
2671284960,pull_request,closed,,chore: update codeowners,,ruthra-kumar,2024-11-19 08:43:23+00:00,[],2024-12-04 00:12:26+00:00,2024-11-19 09:17:01+00:00,https://github.com/frappe/erpnext/pull/44204,[],[],
2671048745,pull_request,closed,,fix: disable conversion to user tz for sales order calender,"There is inconsistencies between the Form View and Calendar View for date .because Form View shows the date as per the system timezone but the calendar view converts it to the user timezone.

Steps to Replicate:
- Change the User Timezone to something with more than 12 hours difference.
- Check the Sales Order Calender.

![image](https://github.com/user-attachments/assets/7da9f28e-83a2-4268-8d7e-3bcbb41eb435)
![image](https://github.com/user-attachments/assets/0d2644db-4805-4f9f-8054-93239ba4f7cf)

Before:
![image](https://github.com/user-attachments/assets/d8edd087-d089-481d-9bc3-5a28052364f3)



After:
![image](https://github.com/user-attachments/assets/5dd3ed89-5561-4c1e-9166-f173d025c92c)


Frappe Support Issue:https://support.frappe.io/helpdesk/tickets/25422
Fraape PR for reference: https://github.com/frappe/frappe/pull/20051

backport version-15 
backport version-14



",ljain112,2024-11-19 07:18:19+00:00,['ruthra-kumar'],2024-12-07 00:12:13+00:00,2024-11-20 05:16:31+00:00,https://github.com/frappe/erpnext/pull/44203,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2670929408,pull_request,closed,,"chore: update oldest_items.json, change owner back to administrator (backport #44188)","

> Please provide enough information so that others can review your pull request:



> Explain the **details** for making this change. What existing problem does the pull request solve?



> Screenshots/GIFs


<hr>This is an automatic backport of pull request #44188 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-19 06:33:20+00:00,[],2024-12-04 00:12:28+00:00,2024-11-19 07:00:49+00:00,https://github.com/frappe/erpnext/pull/44202,[],[],
2670367254,pull_request,closed,,fix: Production Plan: load document defaults for plan items & remove name column from listview (backport #26584),fixes #26566 <hr>This is an automatic backport of pull request #26584 done by [Mergify](https://mergify.com).,mergify[bot],2024-11-19 00:13:45+00:00,[],2024-12-26 00:11:18+00:00,2024-12-04 07:39:17+00:00,https://github.com/frappe/erpnext/pull/44201,"[('needs-tests', 'This PR needs automated unit-tests.'), ('conflicts', None)]","[{'comment_id': 2484436305, 'issue_id': 2670367254, 'author': 'mergify[bot]', 'body': 'Cherry-pick of 69d88a921273c9e0ea29d7131232686a0be7bb78 has failed:\n```\nOn branch mergify/bp/develop/pr-26584\nYour branch is up to date with \'origin/develop\'.\n\nYou are currently cherry-picking commit 69d88a9212.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/manufacturing/doctype/production_plan/production_plan.py\n\tboth modified:   erpnext/manufacturing/doctype/production_plan/production_plan_list.js\n\nno changes added to commit (use ""git add"" and/or ""git commit -a"")\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 11, 19, 0, 13, 47, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-11-19 00:13:47 UTC): Cherry-pick of 69d88a921273c9e0ea29d7131232686a0be7bb78 has failed:
```
On branch mergify/bp/develop/pr-26584
Your branch is up to date with 'origin/develop'.

You are currently cherry-picking commit 69d88a9212.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/manufacturing/doctype/production_plan/production_plan.py
	both modified:   erpnext/manufacturing/doctype/production_plan/production_plan_list.js

no changes added to commit (use ""git add"" and/or ""git commit -a"")
```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2668755417,pull_request,closed,,fix: payment reco for jv with negative dr or cr amount,"Currently, Payment Reconciliation for Journal Entries with negative debit or credit amounts is not supported.
Steps To Replicate:
- Create a Purchase Invoice.
- Create a Journal Entry with a negative credit balance for payment.
- Use the Payment Reconciliation tool for reconciling.(Entry will not be fetched.)

![image](https://github.com/user-attachments/assets/73434a28-9887-49d3-a370-4a43803b1def)



backport version-15",ljain112,2024-11-18 14:38:41+00:00,['ruthra-kumar'],2024-12-06 00:12:19+00:00,2024-11-20 07:16:57+00:00,https://github.com/frappe/erpnext/pull/44197,"[('accounts', ''), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]","[{'comment_id': 2487772593, 'issue_id': 2668755417, 'author': 'jnoufaily', 'body': 'Hello,\r\n\r\nI am facing an issue with the payment reconciliation tool. Even after doing the payment reconciliation, we are still seeing due entries on the Accounts payable report. On another site, ""https://segcm.frappe.cloud/app,"" I was told that this was due to negative debit/credit amounts, which was the case. However, at this company, we don\'t have any negative debit/credit amounts.\r\n\r\nCheck the following video https://segleb-my.sharepoint.com/:v:/g/personal/jnoufaily_kenterprise_org/EZmdpfInDtVKgXLs4c9cxiUBTJJBa_UpOppjShm-XcjaIg?nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&e=cxbkPa for the full details.\r\n\r\nKindly note that this is a critical issue. We\'ve been raising concerns about it for three months, and now all our Accounts payable/receivable reports are wrong.\r\n\r\nRegards,\r\nJoseph', 'created_at': datetime.datetime(2024, 11, 20, 7, 48, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2488135417, 'issue_id': 2668755417, 'author': 'ruthra-kumar', 'body': ""@jnoufaily \r\n\r\nWe've addressed it."", 'created_at': datetime.datetime(2024, 11, 20, 10, 3, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2490734217, 'issue_id': 2668755417, 'author': 'vorasmit', 'body': ""I checked the GL Entry, and it looks inconsistent.\r\n\r\n![image](https://github.com/user-attachments/assets/0f579a55-56d4-4749-aaf0-ca10786b4fd5)\r\n\r\nIMO it's also important to make it consistent, where amount in transaction currency is also reversed like other amounts."", 'created_at': datetime.datetime(2024, 11, 21, 10, 29, tzinfo=datetime.timezone.utc)}]","jnoufaily on (2024-11-20 07:48:22 UTC): Hello,

I am facing an issue with the payment reconciliation tool. Even after doing the payment reconciliation, we are still seeing due entries on the Accounts payable report. On another site, ""https://segcm.frappe.cloud/app,"" I was told that this was due to negative debit/credit amounts, which was the case. However, at this company, we don't have any negative debit/credit amounts.

Check the following video https://segleb-my.sharepoint.com/:v:/g/personal/jnoufaily_kenterprise_org/EZmdpfInDtVKgXLs4c9cxiUBTJJBa_UpOppjShm-XcjaIg?nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&e=cxbkPa for the full details.

Kindly note that this is a critical issue. We've been raising concerns about it for three months, and now all our Accounts payable/receivable reports are wrong.

Regards,
Joseph

ruthra-kumar (Assginee) on (2024-11-20 10:03:18 UTC): @jnoufaily 

We've addressed it.

vorasmit on (2024-11-21 10:29:00 UTC): I checked the GL Entry, and it looks inconsistent.

![image](https://github.com/user-attachments/assets/0f579a55-56d4-4749-aaf0-ca10786b4fd5)

IMO it's also important to make it consistent, where amount in transaction currency is also reversed like other amounts.

"
2668753789,pull_request,closed,,"fix: Global Defaults Configuration ""Disable Rounded Total"" is ignored…","When creating a Sales Invoice from a POS Invoice Merge Log, the option ""Disable Rounded Total"" is ignored. This commit fixes it.

![image](https://github.com/user-attachments/assets/e9eafd79-8ad9-4748-a314-197dca703385)

",devdiogenes,2024-11-18 14:38:02+00:00,[],2024-12-12 00:12:48+00:00,2024-11-18 14:38:09+00:00,https://github.com/frappe/erpnext/pull/44196,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2668533227,pull_request,closed,,fix: Data Should be Computed in Backend to Maintain Consistent Behaviour,"- In `Profit and Loss Statement` and `Balance Sheet` Report the data for growth view and margin view is calculated in frontend.
- Due to which there is inconsistent behaviour while exporting the data. 

![image](https://github.com/user-attachments/assets/bcc729ed-ea43-450f-86cd-382a36ce4c8a)



![Screenshot 2024-11-18 at 6 40 16 PM](https://github.com/user-attachments/assets/8f346933-b323-49fb-be15-b3b6ceced5ec)


### Fixes

- Compute growth or margin in backend 
- Growth view should not be computed for totals column",Ninad1306,2024-11-18 13:20:40+00:00,[],2024-12-14 00:12:08+00:00,2024-11-28 10:29:52+00:00,https://github.com/frappe/erpnext/pull/44195,"[('needs-tests', 'This PR needs automated unit-tests.'), ('squash', 'Meant to tell reviewers that this PR should be squashed into a single commit while merging.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2668354505,pull_request,closed,,fix: include current invoice amount when tax_on_excess_amount is checked,"**Issue:**
TDS is not calculated when tax_on_excess_amount is ticked in the Tax Withholding Category

**ref:** [25643](https://support.frappe.io/helpdesk/tickets/25643)

**Before:**
https://github.com/user-attachments/assets/0c090c2f-9daf-48c4-b796-91216e8737ad

**After:**
https://github.com/user-attachments/assets/d8d30bda-4bc9-44e7-9554-51a279210552

**Backport needed:** v14 & v15
",venkat102,2024-11-18 12:12:15+00:00,['ruthra-kumar'],2024-12-07 00:12:19+00:00,2024-11-22 05:36:25+00:00,https://github.com/frappe/erpnext/pull/44194,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]","[{'comment_id': 2492911425, 'issue_id': 2668354505, 'author': 'ruthra-kumar', 'body': '@mergify backport version-14', 'created_at': datetime.datetime(2024, 11, 22, 5, 36, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2492911508, 'issue_id': 2668354505, 'author': 'ruthra-kumar', 'body': '@mergify backport version-15', 'created_at': datetime.datetime(2024, 11, 22, 5, 36, 50, tzinfo=datetime.timezone.utc)}, {'comment_id': 2492911577, 'issue_id': 2668354505, 'author': 'mergify[bot]', 'body': '> backport version-14\n\n#### ✅ Backports have been created\n\n<details>\n\n* [#44270 fix: include current invoice amount when tax_on_excess_amount is checked (backport #44194)](https://github.com/frappe/erpnext/pull/44270) has been created for branch `version-14`\n\n</details>\n\n\n<!---\nDO NOT EDIT\n-*- Mergify Payload -*-\n{""command"": ""backport version-14"", ""conclusion"": ""success"", ""action_is_running"": true}\n-*- Mergify Payload End -*-\n-->', 'created_at': datetime.datetime(2024, 11, 22, 5, 36, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2492911613, 'issue_id': 2668354505, 'author': 'mergify[bot]', 'body': '> backport version-15\n\n#### ✅ Backports have been created\n\n<details>\n\n* [#44273 fix: include current invoice amount when tax_on_excess_amount is checked (backport #44194)](https://github.com/frappe/erpnext/pull/44273) has been created for branch `version-15`\n\n</details>\n\n\n<!---\nDO NOT EDIT\n-*- Mergify Payload -*-\n{""command"": ""backport version-15"", ""conclusion"": ""success"", ""action_is_running"": true}\n-*- Mergify Payload End -*-\n-->', 'created_at': datetime.datetime(2024, 11, 22, 5, 36, 59, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Assginee) on (2024-11-22 05:36:44 UTC): @mergify backport version-14

ruthra-kumar (Assginee) on (2024-11-22 05:36:50 UTC): @mergify backport version-15

mergify[bot] on (2024-11-22 05:36:56 UTC): #### ✅ Backports have been created

<details>

* [#44270 fix: include current invoice amount when tax_on_excess_amount is checked (backport #44194)](https://github.com/frappe/erpnext/pull/44270) has been created for branch `version-14`

</details>


<!---
DO NOT EDIT
-*- Mergify Payload -*-
{""command"": ""backport version-14"", ""conclusion"": ""success"", ""action_is_running"": true}
-*- Mergify Payload End -*-
-->

mergify[bot] on (2024-11-22 05:36:59 UTC): #### ✅ Backports have been created

<details>

* [#44273 fix: include current invoice amount when tax_on_excess_amount is checked (backport #44194)](https://github.com/frappe/erpnext/pull/44273) has been created for branch `version-15`

</details>


<!---
DO NOT EDIT
-*- Mergify Payload -*-
{""command"": ""backport version-15"", ""conclusion"": ""success"", ""action_is_running"": true}
-*- Mergify Payload End -*-
-->

"
2668282591,pull_request,closed,,fix: set debit in transaction currency in GL Entry (backport #44134),"**Issue:**   When a multi-currency payment transaction is made, the debit value in the transaction currency is not being updated in the GL Entry posted against that payment.

**ref:** [25193](https://support.frappe.io/helpdesk/tickets/25193)

**Before:**
![gl_entry_before_fix](https://github.com/user-attachments/assets/5a61dcb6-895e-4fe7-b070-fce9b7097a3e)

**After:**
![gl_entry_after_fix](https://github.com/user-attachments/assets/b1575a5e-e547-415f-b268-01bfee3ba45d)


Backport needed: v15<hr>This is an automatic backport of pull request #44134 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-18 11:42:54+00:00,[],2024-12-04 00:12:30+00:00,2024-11-19 06:28:14+00:00,https://github.com/frappe/erpnext/pull/44193,[],[],
2668160333,pull_request,closed,,fix: patch,"Patch failing while migrating from v13 to v14

```
 File ""/home/frappe/frappe-bench/apps/erpnext/erpnext/patches/v13_0/item_reposting_for_incorrect_sl_and_gl.py"", line 61, in execute
    update_entries_after(
      doctypes_to_reload = [('setup', 'company'), ('stock', 'repost_item_valuation'), ('stock', 'stock_entry_detail'), ('stock', 'purchase_receipt_item'), ('stock', 'delivery_note_item'), ('stock', 'packed_item'), ('accounts', 'sales_invoice_item'), ('accounts', 'purchase_invoice_item'), ('buying', 'purchase_receipt_item_supplied'), ('subcontracting', 'subcontracting_receipt_item'), ('subcontracting', 'subcontracting_receipt_supplied_item')]
      module = 'subcontracting'
      doctype = 'subcontracting_receipt_supplied_item'
      reposting_project_deployed_on = datetime.datetime(2024, 11, 12, 9, 24, 36)
      posting_date = datetime.date(2024, 11, 12)
      posting_time = datetime.time(9, 24, 36)
      company_list = ['Arjuna']
      data = [{'name': 'MAT-SLE-2024-53213', 'item_code': 'Bird', 'warehouse': 'Bahan Baku - ARJ', 'voucher_type': 'Purchase Receipt', 'voucher_no': 'MAT-PRE-2024-00613', 'posting_date': datetime.date(2024, 11, 11), 'posting_time': datetime.timedelta(seconds=19246), 'company': 'Arjuna'}, {'name': 'MAT-SLE-2024-53223', 'item_code': 'BUMBU MARINASI GEPREKIN', 'warehouse': 'Bahan Penolong - ARJ', 'voucher_type': 'Stock Entry', 'voucher_no': 'MAT-STE-2024-02525', 'posting_date': datetime.date(2024, 11, 11), 'posting_time': datetime.timedelta(seconds=19625), 'company': 'Arjuna'}, {'name': 'MAT-SLE-2024-53221', 'item_code': 'Bird', 'warehouse': 'Bahan Baku - ARJ', 'voucher_type': 'Purchase Receipt', 'voucher_no': 'MAT-PRE-2024-00618', 'posting_date': datetime.date(2024, 11, 11), 'posting_time': datetime.timedelta(seconds=19797), 'company': 'Arjuna'}, {'name': 'MAT-SLE-2024-53228', 'item_code': 'Bird', 'warehouse': 'Bahan Baku - ARJ', 'voucher_type': 'Stock Entry', 'voucher_no': 'MAT-STE-2024-02527', 'pos...
      total_sle = 60
      i = 0
      d = {'name': 'MAT-SLE-2024-53213', 'item_code': 'Bird', 'warehouse': 'Bahan Baku - ARJ', 'voucher_type': 'Purchase Receipt', 'voucher_no': 'MAT-PRE-2024-00613', 'posting_date': datetime.date(2024, 11, 11), 'posting_time': datetime.timedelta(seconds=19246), 'company': 'Arjuna'}
  File ""/home/frappe/frappe-bench/apps/erpnext/erpnext/stock/stock_ledger.py"", line 359, in __init__
    self.build()
      self = <erpnext.stock.stock_ledger.update_entries_after object at 0x7fc6e0422890>
      args = {'item_code': 'Bird', 'warehouse': 'Bahan Baku - ARJ', 'posting_date': datetime.date(2024, 11, 11), 'posting_time': datetime.timedelta(seconds=19246), 'voucher_type': 'Purchase Receipt', 'voucher_no': 'MAT-PRE-2024-00613', 'sle_id': 'MAT-SLE-2024-53213'}
      allow_zero_rate = False
      allow_negative_stock = True
      via_landed_cost_voucher = False
      verbose = 1
  File ""/home/frappe/frappe-bench/apps/erpnext/erpnext/stock/stock_ledger.py"", line 407, in build
    self.process_sle_against_current_timestamp()
      self = <erpnext.stock.stock_ledger.update_entries_after object at 0x7fc6e0422890>
      future_sle_exists = <function future_sle_exists at 0x7fc6e00bbbe0>
  File ""/home/frappe/frappe-bench/apps/erpnext/erpnext/stock/stock_ledger.py"", line 428, in process_sle_against_current_timestamp
    sl_entries = self.get_sle_against_current_voucher()
      self = <erpnext.stock.stock_ledger.update_entries_after object at 0x7fc6e0422890>
  File ""/home/frappe/frappe-bench/apps/erpnext/erpnext/stock/stock_ledger.py"", line 435, in get_sle_against_current_voucher
    return frappe.db.sql(
      self = <erpnext.stock.stock_ledger.update_entries_after object at 0x7fc6e0422890>
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/database/database.py"", line 244, in sql
    self._cursor.execute(query, values)
      self = <frappe.database.mariadb.database.MariaDBDatabase object at 0x7fc6e1538070>
      query = 'select\n\t\t\t\t*, posting_datetime as ""timestamp""\n\t\t\tfrom\n\t\t\t\t`tabStock Ledger Entry`\n\t\t\twhere\n\t\t\t\titem_code = %(item_code)s\n\t\t\t\tand warehouse = %(warehouse)s\n\t\t\t\tand is_cancelled = 0\n\t\t\t\tand (\n\t\t\t\t\tposting_datetime = %(posting_datetime)s\n\t\t\t\t)\n\t\t\t\tand creation = %(creation)s\n\t\t\torder by\n\t\t\t\tcreation ASC\n\t\t\tfor update'
 
      conn = <pymysql.connections.Connection object at 0x7fc6e08df040>
builtins.KeyError: 'creation'
```",rohitwaghchaure,2024-11-18 11:07:38+00:00,[],2024-12-07 00:12:00+00:00,2024-11-18 12:29:55+00:00,https://github.com/frappe/erpnext/pull/44191,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2668149268,pull_request,closed,,fix(setup): Fix typo in COA setup,,cogk,2024-11-18 11:03:30+00:00,['ruthra-kumar'],2024-12-04 00:12:15+00:00,2024-11-19 12:14:01+00:00,https://github.com/frappe/erpnext/pull/44190,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]","[{'comment_id': 2485489823, 'issue_id': 2668149268, 'author': 'ruthra-kumar', 'body': 'regression: https://github.com/frappe/erpnext/pull/42755', 'created_at': datetime.datetime(2024, 11, 19, 11, 45, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2486694827, 'issue_id': 2668149268, 'author': 'FHenry', 'body': 'In my test environement, create_chart_of_accounts_based_on was empty in case of company create from exsting template. \r\nIt was a fresh develop install on develop branch where I test it several times, may be somthing change between creation date of the faulty PR (13 th August 2024 ) and now.', 'created_at': datetime.datetime(2024, 11, 19, 20, 33, 43, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Assginee) on (2024-11-19 11:45:22 UTC): regression: https://github.com/frappe/erpnext/pull/42755

FHenry on (2024-11-19 20:33:43 UTC): In my test environement, create_chart_of_accounts_based_on was empty in case of company create from exsting template. 
It was a fresh develop install on develop branch where I test it several times, may be somthing change between creation date of the faulty PR (13 th August 2024 ) and now.

"
2667957515,pull_request,closed,,fix: sync translations from crowdin,,frappe-pr-bot,2024-11-18 10:08:34+00:00,[],2024-12-04 00:12:27+00:00,2024-11-19 08:44:53+00:00,https://github.com/frappe/erpnext/pull/44189,"[('translation', None)]",[],
2667935084,pull_request,closed,,"chore: update oldest_items.json, change owner back to administrator","<!--

Some key notes before you open a PR:

 1. Select which branch should this PR be merged in?
 2. PR name follows [convention](http://karma-runner.github.io/4.0/dev/git-commit-msg.html)
 3. All tests pass locally, UI and Unit tests
 4. All business logic and validations must be on the server-side
 5. Update necessary Documentation
 6. Put `closes #XXXX` in your comment to auto-close the issue that your PR fixes


Also, if you're new here

- Documentation Guidelines => https://github.com/frappe/erpnext/wiki/Updating-Documentation

- Contribution Guide => https://github.com/frappe/erpnext/blob/develop/.github/CONTRIBUTING.md

- Pull Request Checklist => https://github.com/frappe/erpnext/wiki/Pull-Request-Checklist

-->

> Please provide enough information so that others can review your pull request:

<!-- You can skip this if you're fixing a typo or updating existing documentation -->

> Explain the **details** for making this change. What existing problem does the pull request solve?

<!-- Example: When ""Adding a function to do X"", explain why it is necessary to have a way to do X. -->

> Screenshots/GIFs

<!-- Add images/recordings to better visualize the change: expected/current behviour -->
",ismxilxrif,2024-11-18 10:01:44+00:00,['ruthra-kumar'],2024-12-04 00:12:29+00:00,2024-11-19 06:32:40+00:00,https://github.com/frappe/erpnext/pull/44188,"[('backport version-15-hotfix', '')]",[],
2667841674,pull_request,closed,,style: added progressive disclosure to assets,"Previous UI:

https://github.com/user-attachments/assets/8942b7ec-e0d7-494a-b14d-807379ab2b8a


Updated UI:

https://github.com/user-attachments/assets/6b73ca5d-aeed-45aa-bc1d-f1f06dfcf1a2



",khushi8112,2024-11-18 09:38:59+00:00,[],2024-12-12 00:12:17+00:00,2024-11-27 16:30:19+00:00,https://github.com/frappe/erpnext/pull/44187,[],"[{'comment_id': 2504318130, 'issue_id': 2667841674, 'author': 'barredterra', 'body': '@khushi8112 FYI, `style:` commits are usually used for code style, not for UI style. ;)\r\n\r\n> style: Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)\r\n\r\nhttps://github.com/angular/angular/blob/22b96b9/CONTRIBUTING.md#type', 'created_at': datetime.datetime(2024, 11, 27, 16, 34, 49, tzinfo=datetime.timezone.utc)}]","barredterra on (2024-11-27 16:34:49 UTC): @khushi8112 FYI, `style:` commits are usually used for code style, not for UI style. ;)


https://github.com/angular/angular/blob/22b96b9/CONTRIBUTING.md#type

"
2667816499,pull_request,closed,,fix: do not allow to make future stock transactions,,rohitwaghchaure,2024-11-18 09:34:46+00:00,[],2025-01-14 00:10:01+00:00,2024-12-30 16:12:44+00:00,https://github.com/frappe/erpnext/pull/44186,"[('stock', None), ('needs-tests', 'This PR needs automated unit-tests.'), ('inactive', '')]","[{'comment_id': 2537949548, 'issue_id': 2667816499, 'author': 'stale[bot]', 'body': ""This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing."", 'created_at': datetime.datetime(2024, 12, 12, 6, 46, 36, tzinfo=datetime.timezone.utc)}]","stale[bot] on (2024-12-12 06:46:36 UTC): This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing.

"
2667815973,pull_request,closed,,fix: added Stock UOM field for RM in work order,Fixed https://github.com/frappe/erpnext/issues/43050,rohitwaghchaure,2024-11-18 09:34:32+00:00,[],2024-12-05 00:12:46+00:00,2024-11-20 05:50:48+00:00,https://github.com/frappe/erpnext/pull/44185,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2667535261,pull_request,closed,,Update manufacturing_settings.json,"<!--

Some key notes before you open a PR:

 1. Select which branch should this PR be merged in?
 2. PR name follows [convention](http://karma-runner.github.io/4.0/dev/git-commit-msg.html)
 3. All tests pass locally, UI and Unit tests
 4. All business logic and validations must be on the server-side
 5. Update necessary Documentation
 6. Put `closes #XXXX` in your comment to auto-close the issue that your PR fixes


Also, if you're new here

- Documentation Guidelines => https://github.com/frappe/erpnext/wiki/Updating-Documentation

- Contribution Guide => https://github.com/frappe/erpnext/blob/develop/.github/CONTRIBUTING.md

- Pull Request Checklist => https://github.com/frappe/erpnext/wiki/Pull-Request-Checklist

-->

> Please provide enough information so that others can review your pull request:

<!-- You can skip this if you're fixing a typo or updating existing documentation -->

> Explain the **details** for making this change. What existing problem does the pull request solve?

<!-- Example: When ""Adding a function to do X"", explain why it is necessary to have a way to do X. -->

> Screenshots/GIFs

<!-- Add images/recordings to better visualize the change: expected/current behviour -->
",hyaray,2024-11-18 07:46:26+00:00,[],2024-12-04 00:12:24+00:00,2024-11-19 09:24:06+00:00,https://github.com/frappe/erpnext/pull/44184,[],[],
2667268498,pull_request,closed,,fix: `Disable Rounded Total` in Quotation DocType (backport #44025),"Issue:

- `disable_rounded_total` field is provided in other buying and selling doctypes, but it is missing in `Quotation` DocType.

![Screenshot 2024-11-08 at 11 13 31 AM](https://github.com/user-attachments/assets/0578180f-4b9e-4537-96f0-3d78a9d9ee14)
<hr>This is an automatic backport of pull request #44025 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-18 06:00:17+00:00,['ruthra-kumar'],2024-12-05 00:12:39+00:00,2024-11-20 07:44:16+00:00,https://github.com/frappe/erpnext/pull/44183,[],"[{'comment_id': 2482025317, 'issue_id': 2667268498, 'author': 'mergify[bot]', 'body': 'Cherry-pick of f8524d526b5922e8223e21409f2997f2e7cd2f5b has failed:\n```\nOn branch mergify/bp/version-15-hotfix/pr-44025\nYour branch is up to date with \'origin/version-15-hotfix\'.\n\nYou are currently cherry-picking commit f8524d526b.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tmodified:   erpnext/selling/doctype/quotation/quotation.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/selling/doctype/quotation/quotation.json\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 11, 18, 6, 0, 18, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-11-18 06:00:18 UTC): Cherry-pick of f8524d526b5922e8223e21409f2997f2e7cd2f5b has failed:
```
On branch mergify/bp/version-15-hotfix/pr-44025
Your branch is up to date with 'origin/version-15-hotfix'.

You are currently cherry-picking commit f8524d526b.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	modified:   erpnext/selling/doctype/quotation/quotation.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/selling/doctype/quotation/quotation.json

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2667120001,pull_request,closed,,fix: set default Party Type based on Payment Type in Payment Entry (backport #44127),"Set a dynamic default for Party Type based on Payment Type

Payment Type = **Receive** ==> Party Type = **Customer**
Payment Type = **Pay** ==> Party Type = **Supplier**<hr>This is an automatic backport of pull request #44127 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-18 04:45:01+00:00,[],2024-12-03 00:13:17+00:00,2024-11-18 05:19:24+00:00,https://github.com/frappe/erpnext/pull/44182,[],[],
2667119425,pull_request,closed,,fix: set default Party Type based on Payment Type in Payment Entry (backport #44127),"Set a dynamic default for Party Type based on Payment Type

Payment Type = **Receive** ==> Party Type = **Customer**
Payment Type = **Pay** ==> Party Type = **Supplier**<hr>This is an automatic backport of pull request #44127 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-18 04:44:56+00:00,[],2024-12-05 00:12:29+00:00,2024-11-18 05:19:16+00:00,https://github.com/frappe/erpnext/pull/44181,"[('released', None)]","[{'comment_id': 2481944230, 'issue_id': 2667119425, 'author': 'mergify[bot]', 'body': 'Cherry-pick of 19222690d31e486ccd634d7530f2c85eda7cf4c0 has failed:\n```\nOn branch mergify/bp/version-14-hotfix/pr-44127\nYour branch is up to date with \'origin/version-14-hotfix\'.\n\nYou are currently cherry-picking commit 19222690d3.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/accounts/doctype/payment_entry/payment_entry.js\n\nno changes added to commit (use ""git add"" and/or ""git commit -a"")\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 11, 18, 4, 44, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2487895680, 'issue_id': 2667119425, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 15, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-11-18 04:44:57 UTC): Cherry-pick of 19222690d31e486ccd634d7530f2c85eda7cf4c0 has failed:
```
On branch mergify/bp/version-14-hotfix/pr-44127
Your branch is up to date with 'origin/version-14-hotfix'.

You are currently cherry-picking commit 19222690d3.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/accounts/doctype/payment_entry/payment_entry.js

no changes added to commit (use ""git add"" and/or ""git commit -a"")
```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

frappe-pr-bot on (2024-11-20 08:38:15 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2667076801,pull_request,closed,,fix: set conversion factor before applying price list (backport #44147),"Issue: https://support.frappe.io/helpdesk/tickets/24358

Issue: The Rate is not updated when UOM is changed

https://github.com/user-attachments/assets/cfcc0abb-089c-43c5-97e7-54f3e07dbefc

After the fix:


https://github.com/user-attachments/assets/e5866641-bc1a-4011-8969-ac345d92ffee




<hr>This is an automatic backport of pull request #44147 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-18 04:38:40+00:00,[],2024-12-03 00:13:18+00:00,2024-11-18 04:44:45+00:00,https://github.com/frappe/erpnext/pull/44180,[],[],
2667076714,pull_request,closed,,fix: set conversion factor before applying price list (backport #44147),"Issue: https://support.frappe.io/helpdesk/tickets/24358

Issue: The Rate is not updated when UOM is changed

https://github.com/user-attachments/assets/cfcc0abb-089c-43c5-97e7-54f3e07dbefc

After the fix:


https://github.com/user-attachments/assets/e5866641-bc1a-4011-8969-ac345d92ffee




<hr>This is an automatic backport of pull request #44147 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-18 04:38:34+00:00,[],2024-12-05 00:12:30+00:00,2024-11-18 04:44:34+00:00,https://github.com/frappe/erpnext/pull/44179,"[('released', None)]","[{'comment_id': 2487895798, 'issue_id': 2667076714, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 18, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:18 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2667073901,pull_request,closed,,"fix: apply ""cannot_add_rows"" directly to table field for more efficient solution (backport #44157)","### Problem:
The initial fix in PR #44148 to disable the ""Add Row"" button was not the most efficient approach.

### Solution:
This update applies the `cannot_add_rows` property directly to the allocations table field, offering a cleaner and more efficient solution. It works the same as expected as in PR #44148 but with a more efficient code structure.
<hr>This is an automatic backport of pull request #44157 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-18 04:36:49+00:00,[],2024-12-03 00:13:19+00:00,2024-11-18 04:44:23+00:00,https://github.com/frappe/erpnext/pull/44178,[],[],
2667073298,pull_request,closed,,"fix: apply ""cannot_add_rows"" directly to table field for more efficient solution (backport #44157)","### Problem:
The initial fix in PR #44148 to disable the ""Add Row"" button was not the most efficient approach.

### Solution:
This update applies the `cannot_add_rows` property directly to the allocations table field, offering a cleaner and more efficient solution. It works the same as expected as in PR #44148 but with a more efficient code structure.
<hr>This is an automatic backport of pull request #44157 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-18 04:36:15+00:00,[],2024-12-05 00:12:28+00:00,2024-11-18 04:44:12+00:00,https://github.com/frappe/erpnext/pull/44177,"[('released', None)]","[{'comment_id': 2487895888, 'issue_id': 2667073298, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 21, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:21 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2665974104,pull_request,closed,,fix: transfer work order expected time to job cards,"Fixes this bug: https://github.com/frappe/erpnext/issues/44041

@rohitwaghchaure 
Revision of this PR: https://github.com/frappe/erpnext/pull/44042
Backport to version 15 necessary",SamuelHelbling,2024-11-17 14:44:31+00:00,[],2024-12-10 00:12:24+00:00,2024-11-25 14:14:52+00:00,https://github.com/frappe/erpnext/pull/44176,"[('needs-tests', 'This PR needs automated unit-tests.')]","[{'comment_id': 2498135597, 'issue_id': 2665974104, 'author': 'rohitwaghchaure', 'body': 'Fixed https://github.com/frappe/erpnext/pull/44324', 'created_at': datetime.datetime(2024, 11, 25, 14, 14, 52, tzinfo=datetime.timezone.utc)}]","rohitwaghchaure on (2024-11-25 14:14:52 UTC): Fixed https://github.com/frappe/erpnext/pull/44324

"
2665947464,pull_request,closed,,fix: improve timesheet and project handling in sales invoice,"This pull request fixes three bugs in Sales Invoice regarding timesheets and projects:
- When timesheets are fetched in a sales invoice and the correct project is not set in the sales invoice afterwards, the used timesheets are displayed as billed, even if not all hours in the timesheet have been charged
- In the “Fetch Timesheet” dialog, projects are displayed that do not belong to the customer defined in the sales invoice
- If a project is selected in the sales invoice before a customer is defined, any customer can be selected, even if it does not belong to the project

This pull request improves usability and minimizes errors.

fixing this bug: https://github.com/frappe/erpnext/issues/44167

Backport: Version-15",SamuelHelbling,2024-11-17 14:33:44+00:00,['ruthra-kumar'],2025-01-25 07:04:50+00:00,2025-01-25 07:04:50+00:00,https://github.com/frappe/erpnext/pull/44175,"[('inactive', '')]","[{'comment_id': 2503351321, 'issue_id': 2665947464, 'author': 'SamuelHelbling', 'body': '@ruthra-kumar \r\nThe erpnext.accounts.doctype.sales_invoice.test_sales_invoice.TestSalesInvoice.test_sales_invoice_with_project_link test runs without errors in my local development environment. On Github it fails because due_date is not set. However, my pull request does not change the due_date.\r\n\r\nDo you have any idea what the problem is?', 'created_at': datetime.datetime(2024, 11, 27, 9, 23, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2505566979, 'issue_id': 2665947464, 'author': 'ruthra-kumar', 'body': ""All of them fail for the same reason - Due Date mandatory. So we can't rule them out as flaky. \r\n\r\nThey don't fail on local as well, so I too am unclear on the cause."", 'created_at': datetime.datetime(2024, 11, 28, 8, 50, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2540661148, 'issue_id': 2665947464, 'author': 'ruthra-kumar', 'body': '<details>\r\n\r\n<summary> Broken tests </summary>\r\n\r\n```\r\n======================================================================\r\n ERROR  test_timesheet_billing_based_on_project (erpnext.projects.doctype.timesheet.test_timesheet.TestTimesheet.test_timesheet_billing_based_on_project)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/projects/doctype/timesheet/test_timesheet.py"", line 65, in test_timesheet_billing_based_on_project\r\n    sales_invoice.submit()\r\n    emp = \'EMP-00001\'\r\n    project = \'_T-Project-00001\'\r\n    sales_invoice = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n    self = <erpnext.projects.doctype.timesheet.test_timesheet.TestTimesheet testMethod=test_timesheet_billing_based_on_project>\r\n    timesheet = <Timesheet: doctype=Timesheet TS-2024-00004 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/utils/typing_validations.py"", line 32, in wrapper\r\n    return func(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^\r\n    apply_condition = <function whitelist.<locals>.innerfn.<locals>.<lambda> at 0x7f82a3ddff60>\r\n    args = (<SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>,)\r\n    func = <function Document.submit at 0x7f82a3ddfec0>\r\n    kwargs = {}\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document.submit at 0x7f82a3ddfe20>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1148, in submit\r\n    return self._submit()\r\n           ^^^^^^^^^^^^^^\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1130, in _submit\r\n    return self.save()\r\n           ^^^^^^^^^^^\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document.save at 0x7f82a3dde340>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 421, in save\r\n    return self._save(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document._save at 0x7f82a3dde480>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 444, in _save\r\n    return self.insert()\r\n           ^^^^^^^^^^^^^\r\n    ignore_permissions = None\r\n    ignore_version = None\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document.insert at 0x7f82a3dde160>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 373, in insert\r\n    self.run_before_save_methods()\r\n    ignore_if_duplicate = False\r\n    ignore_links = None\r\n    ignore_mandatory = None\r\n    ignore_permissions = None\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n    set_child_names = True\r\n    set_name = None\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1215, in run_before_save_methods\r\n    self.run_method(""validate"")\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1061, in run_method\r\n    out = Document.hook(fn)(self, *args, **kwargs)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    fn = <function Document.run_method.<locals>.fn at 0x7f829e90ca40>\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1448, in composer\r\n    return composed(self, method, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    compose = <function Document.hook.<locals>.compose at 0x7f829e96da80>\r\n    composed = <function Document.hook.<locals>.compose.<locals>.runner at 0x7f829e96c9a0>\r\n    doc_events = {\'*\': {\'on_update\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.core.doctype.file.utils.attach_files_to_document\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\', \'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date\', \'frappe.core.doctype.user_type.user_type.apply_permissions_for_non_standard_user_type\', \'frappe.core.doctype.permission_log.permission_log.make_perm_log\'], \'after_rename\': [\'frappe.desk.notifications.clear_doctype_notifications\'], \'on_cancel\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\'], \'on_trash\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\'], \'on_update_after_submit\': [\'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\', \'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date\', \'frappe.core.doctype.file.utils.attach_files_to_document\'], \'on_change\': [\'frappe.social.doctype.energy_point_rule.energy_point_rule.process_energy_points\', \'frappe.automation.doctype.milestone_tracker.milestone_tracker.evaluate_milestone\'], \'after_delete\': [\'frappe.core.doctype.permission_log.permission_log.make_perm_log\'], \'validate\': [\'erpnext.support.doctype.service_level_agreement.service_level_agreement.apply\', \'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job\']}, \'Event\': {\'after_insert\': [\'frappe.integrations.doctype.google_calendar.google_calendar.insert_event_in_google_calendar\', \'erpnext.crm.utils.link_events_with_prospect\'], \'on_update\': [\'frappe.integrations.doctype.google_calendar.google_calendar.update_event_in_google_calendar\'], \'on_trash\': [\'frappe.integrations.doctype.google_calendar.google_calendar.delete_event_from_google_calendar\']}, \'Contact\': {\'after_insert\': [\'frappe.integrations.doctype.google_contacts.google_contacts.insert_contacts_to_google_contacts\', \'erpnext.telephony.doctype.call_log.call_log.link_existing_conversations\'], \'on_update\': [\'frappe.integrations.doctype.google_contacts.google_contacts.update_contacts_to_google_contacts\'], \'on_trash\': [\'erpnext.support.doctype.issue.issue.update_issue\'], \'validate\': [\'erpnext.crm.utils.update_lead_phone_numbers\']}, \'DocType\': {\'on_update\': [\'frappe.cache_manager.build_domain_restricted_doctype_cache\']}, \'Page\': {\'on_update\': [\'frappe.cache_manager.build_domain_restricted_page_cache\']}, \'Sales Invoice\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\'], \'on_submit\': [\'erpnext.regional.create_transaction_log\', \'erpnext.regional.italy.utils.sales_invoice_on_submit\'], \'on_cancel\': [\'erpnext.regional.italy.utils.sales_invoice_on_cancel\'], \'on_trash\': [\'erpnext.regional.check_deletion_permission\']}, \'Purchase Invoice\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\', \'erpnext.regional.united_arab_emirates.utils.update_grand_total_for_rcm\', \'erpnext.regional.united_arab_emirates.utils.validate_returns\']}, \'Journal Entry\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Bank Clearance\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Stock Entry\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\'], \'on_submit\': [\'erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty\'], \'on_cancel\': [\'erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty\']}, \'Dunning\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Invoice Discounting\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Payment Entry\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\'], \'on_submit\': [\'erpnext.regional.create_transaction_log\', \'erpnext.accounts.doctype.dunning.dunning.resolve_dunning\'], \'on_cancel\': [\'erpnext.accounts.doctype.dunning.dunning.resolve_dunning\'], \'on_trash\': [\'erpnext.regional.check_deletion_permission\']}, \'Period Closing Voucher\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Process Deferred Accounting\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Asset\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Asset Capitalization\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Asset Repair\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Delivery Note\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Landed Cost Voucher\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Purchase Receipt\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Stock Reconciliation\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Subcontracting Receipt\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'User\': {\'after_insert\': [\'frappe.contacts.doctype.contact.contact.update_contact\'], \'validate\': [\'erpnext.setup.doctype.employee.employee.validate_employee_role\'], \'on_update\': [\'erpnext.setup.doctype.employee.employee.update_user_permissions\', \'erpnext.portal.utils.set_default_role\']}, \'Communication\': {\'on_update\': [\'erpnext.support.doctype.service_level_agreement.service_level_agreement.on_communication_update\', \'erpnext.support.doctype.issue.issue.set_first_response_time\'], \'after_insert\': [\'erpnext.crm.utils.link_communications_with_prospect\']}, \'Address\': {\'validate\': [\'erpnext.regional.italy.utils.set_state_code\']}, \'Email Unsubscribe\': {\'after_insert\': [\'erpnext.crm.doctype.email_campaign.email_campaign.unsubscribe_recipient\']}, \'Integration Request\': {\'validate\': [\'erpnext.accounts.doctype.payment_request.payment_request.validate_payment\']}}\r\n    f = <function Document.run_method.<locals>.fn at 0x7f829e90ca40>\r\n    handler = \'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job\'\r\n    hooks = [<function validate_accounting_period_on_doc_save at 0x7f82a0e905e0>, <function apply at 0x7f82a0a76e80>, <function check_for_running_deletion_job at 0x7f82a0a8cc20>]\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1426, in runner\r\n    add_to_return_value(self, fn(self, *args, **kwargs))\r\n                              ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    add_to_return_value = <function Document.hook.<locals>.add_to_return_value at 0x7f829e90dda0>\r\n    args = ()\r\n    fn = <function Document.run_method.<locals>.fn at 0x7f829e90ca40>\r\n    hooks = (<function validate_accounting_period_on_doc_save at 0x7f82a0e905e0>, <function apply at 0x7f82a0a76e80>, <function check_for_running_deletion_job at 0x7f82a0a8cc20>)\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1058, in fn\r\n    return method_object(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    method_object = <bound method SalesInvoice.validate of <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>>\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/doctype/sales_invoice/sales_invoice.py"", line 273, in validate\r\n    super().validate()\r\n    __class__ = <class \'erpnext.accounts.doctype.sales_invoice.sales_invoice.SalesInvoice\'>\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/selling_controller.py"", line 35, in validate\r\n    super().validate()\r\n    __class__ = <class \'erpnext.controllers.selling_controller.SellingController\'>\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/stock_controller.py"", line 52, in validate\r\n    super().validate()\r\n    __class__ = <class \'erpnext.controllers.stock_controller.StockController\'>\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 208, in validate\r\n    self.validate_all_documents_schedule()\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 490, in validate_all_documents_schedule\r\n    self.validate_invoice_documents_schedule()\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 480, in validate_invoice_documents_schedule\r\n    self.validate_due_date()\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 668, in validate_due_date\r\n    frappe.throw(_(""Due Date is mandatory""))\r\n    posting_date = \'2024-11-27\'\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>\r\n    validate_due_date = <function validate_due_date at 0x7f82a0d9dd00>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 672, in throw\r\n    msgprint(\r\n    as_list = False\r\n    exc = <class \'frappe.exceptions.ValidationError\'>\r\n    is_minimizable = False\r\n    msg = \'Due Date is mandatory\'\r\n    primary_action = None\r\n    title = None\r\n    wide = False\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 633, in msgprint\r\n    _raise_exception()\r\n    _raise_exception = <function msgprint.<locals>._raise_exception at 0x7f829e96d4e0>\r\n    alert = False\r\n    as_list = False\r\n    as_table = False\r\n    indicator = \'red\'\r\n    inspect = <module \'inspect\' from \'/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py\'>\r\n    is_minimizable = False\r\n    msg = \'Due Date is mandatory\'\r\n    out = {\'message\': \'Due Date is mandatory\', \'title\': \'Message\', \'indicator\': \'red\', \'raise_exception\': 1, \'__frappe_exc_id\': \'0035e2e0b5c1d0f0eb3256acd8f59c08c537231ece24623debd084cc\'}\r\n    primary_action = None\r\n    raise_exception = <class \'frappe.exceptions.ValidationError\'>\r\n    realtime = False\r\n    title = None\r\n    wide = False\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 584, in _raise_exception\r\n    raise exc\r\n    exc = ValidationError(\'Due Date is mandatory\')\r\n    inspect = <module \'inspect\' from \'/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py\'>\r\n    msg = \'Due Date is mandatory\'\r\n    out = {\'message\': \'Due Date is mandatory\', \'title\': \'Message\', \'indicator\': \'red\', \'raise_exception\': 1, \'__frappe_exc_id\': \'0035e2e0b5c1d0f0eb3256acd8f59c08c537231ece24623debd084cc\'}\r\n    raise_exception = <class \'frappe.exceptions.ValidationError\'>\r\nfrappe.exceptions.ValidationError: Due Date is mandatory\r\n\r\n======================================================================\r\n ERROR  test_update_qty (erpnext.selling.doctype.sales_order.test_sales_order.TestSalesOrder.test_update_qty)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/selling/doctype/sales_order/test_sales_order.py"", line 223, in test_update_qty\r\n    si2.submit()\r\n    self = <erpnext.selling.doctype.sales_order.test_sales_order.TestSalesOrder testMethod=test_update_qty>\r\n    si1 = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00001 docstatus=1>\r\n    si2 = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n    so = <SalesOrder: doctype=Sales Order SAL-ORD-2024-00006 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/utils/typing_validations.py"", line 32, in wrapper\r\n    return func(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^\r\n    apply_condition = <function whitelist.<locals>.innerfn.<locals>.<lambda> at 0x7f82a3ddff60>\r\n    args = (<SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>,)\r\n    func = <function Document.submit at 0x7f82a3ddfec0>\r\n    kwargs = {}\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document.submit at 0x7f82a3ddfe20>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1148, in submit\r\n    return self._submit()\r\n           ^^^^^^^^^^^^^^\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1130, in _submit\r\n    return self.save()\r\n           ^^^^^^^^^^^\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document.save at 0x7f82a3dde340>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 421, in save\r\n    return self._save(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document._save at 0x7f82a3dde480>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 458, in _save\r\n    self.run_before_save_methods()\r\n    ignore_permissions = None\r\n    ignore_version = None\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1215, in run_before_save_methods\r\n    self.run_method(""validate"")\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1061, in run_method\r\n    out = Document.hook(fn)(self, *args, **kwargs)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    fn = <function Document.run_method.<locals>.fn at 0x7f829e32c680>\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1448, in composer\r\n    return composed(self, method, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    compose = <function Document.hook.<locals>.compose at 0x7f829dd18680>\r\n    composed = <function Document.hook.<locals>.compose.<locals>.runner at 0x7f829dd1bec0>\r\n    doc_events = {\'*\': {\'on_update\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.core.doctype.file.utils.attach_files_to_document\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\', \'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date\', \'frappe.core.doctype.user_type.user_type.apply_permissions_for_non_standard_user_type\', \'frappe.core.doctype.permission_log.permission_log.make_perm_log\'], \'after_rename\': [\'frappe.desk.notifications.clear_doctype_notifications\'], \'on_cancel\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\'], \'on_trash\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\'], \'on_update_after_submit\': [\'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\', \'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date\', \'frappe.core.doctype.file.utils.attach_files_to_document\'], \'on_change\': [\'frappe.social.doctype.energy_point_rule.energy_point_rule.process_energy_points\', \'frappe.automation.doctype.milestone_tracker.milestone_tracker.evaluate_milestone\'], \'after_delete\': [\'frappe.core.doctype.permission_log.permission_log.make_perm_log\'], \'validate\': [\'erpnext.support.doctype.service_level_agreement.service_level_agreement.apply\', \'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job\']}, \'Event\': {\'after_insert\': [\'frappe.integrations.doctype.google_calendar.google_calendar.insert_event_in_google_calendar\', \'erpnext.crm.utils.link_events_with_prospect\'], \'on_update\': [\'frappe.integrations.doctype.google_calendar.google_calendar.update_event_in_google_calendar\'], \'on_trash\': [\'frappe.integrations.doctype.google_calendar.google_calendar.delete_event_from_google_calendar\']}, \'Contact\': {\'after_insert\': [\'frappe.integrations.doctype.google_contacts.google_contacts.insert_contacts_to_google_contacts\', \'erpnext.telephony.doctype.call_log.call_log.link_existing_conversations\'], \'on_update\': [\'frappe.integrations.doctype.google_contacts.google_contacts.update_contacts_to_google_contacts\'], \'on_trash\': [\'erpnext.support.doctype.issue.issue.update_issue\'], \'validate\': [\'erpnext.crm.utils.update_lead_phone_numbers\']}, \'DocType\': {\'on_update\': [\'frappe.cache_manager.build_domain_restricted_doctype_cache\']}, \'Page\': {\'on_update\': [\'frappe.cache_manager.build_domain_restricted_page_cache\']}, \'Sales Invoice\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\'], \'on_submit\': [\'erpnext.regional.create_transaction_log\', \'erpnext.regional.italy.utils.sales_invoice_on_submit\'], \'on_cancel\': [\'erpnext.regional.italy.utils.sales_invoice_on_cancel\'], \'on_trash\': [\'erpnext.regional.check_deletion_permission\']}, \'Purchase Invoice\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\', \'erpnext.regional.united_arab_emirates.utils.update_grand_total_for_rcm\', \'erpnext.regional.united_arab_emirates.utils.validate_returns\']}, \'Journal Entry\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Bank Clearance\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Stock Entry\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\'], \'on_submit\': [\'erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty\'], \'on_cancel\': [\'erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty\']}, \'Dunning\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Invoice Discounting\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Payment Entry\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\'], \'on_submit\': [\'erpnext.regional.create_transaction_log\', \'erpnext.accounts.doctype.dunning.dunning.resolve_dunning\'], \'on_cancel\': [\'erpnext.accounts.doctype.dunning.dunning.resolve_dunning\'], \'on_trash\': [\'erpnext.regional.check_deletion_permission\']}, \'Period Closing Voucher\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Process Deferred Accounting\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Asset\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Asset Capitalization\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Asset Repair\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Delivery Note\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Landed Cost Voucher\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Purchase Receipt\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Stock Reconciliation\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Subcontracting Receipt\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'User\': {\'after_insert\': [\'frappe.contacts.doctype.contact.contact.update_contact\'], \'validate\': [\'erpnext.setup.doctype.employee.employee.validate_employee_role\'], \'on_update\': [\'erpnext.setup.doctype.employee.employee.update_user_permissions\', \'erpnext.portal.utils.set_default_role\']}, \'Communication\': {\'on_update\': [\'erpnext.support.doctype.service_level_agreement.service_level_agreement.on_communication_update\', \'erpnext.support.doctype.issue.issue.set_first_response_time\'], \'after_insert\': [\'erpnext.crm.utils.link_communications_with_prospect\']}, \'Address\': {\'validate\': [\'erpnext.regional.italy.utils.set_state_code\']}, \'Email Unsubscribe\': {\'after_insert\': [\'erpnext.crm.doctype.email_campaign.email_campaign.unsubscribe_recipient\']}, \'Integration Request\': {\'validate\': [\'erpnext.accounts.doctype.payment_request.payment_request.validate_payment\']}}\r\n    f = <function Document.run_method.<locals>.fn at 0x7f829e32c680>\r\n    handler = \'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job\'\r\n    hooks = [<function validate_accounting_period_on_doc_save at 0x7f82a0e905e0>, <function apply at 0x7f82a0a76e80>, <function check_for_running_deletion_job at 0x7f82a0a8cc20>]\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1426, in runner\r\n    add_to_return_value(self, fn(self, *args, **kwargs))\r\n                              ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    add_to_return_value = <function Document.hook.<locals>.add_to_return_value at 0x7f829e32d760>\r\n    args = ()\r\n    fn = <function Document.run_method.<locals>.fn at 0x7f829e32c680>\r\n    hooks = (<function validate_accounting_period_on_doc_save at 0x7f82a0e905e0>, <function apply at 0x7f82a0a76e80>, <function check_for_running_deletion_job at 0x7f82a0a8cc20>)\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1058, in fn\r\n    return method_object(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    method_object = <bound method SalesInvoice.validate of <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>>\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/doctype/sales_invoice/sales_invoice.py"", line 273, in validate\r\n    super().validate()\r\n    __class__ = <class \'erpnext.accounts.doctype.sales_invoice.sales_invoice.SalesInvoice\'>\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/selling_controller.py"", line 35, in validate\r\n    super().validate()\r\n    __class__ = <class \'erpnext.controllers.selling_controller.SellingController\'>\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/stock_controller.py"", line 52, in validate\r\n    super().validate()\r\n    __class__ = <class \'erpnext.controllers.stock_controller.StockController\'>\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 208, in validate\r\n    self.validate_all_documents_schedule()\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 490, in validate_all_documents_schedule\r\n    self.validate_invoice_documents_schedule()\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 480, in validate_invoice_documents_schedule\r\n    self.validate_due_date()\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 670, in validate_due_date\r\n    validate_due_date(\r\n    posting_date = \'2024-11-28\'\r\n    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>\r\n    validate_due_date = <function validate_due_date at 0x7f82a0d9dd00>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/party.py"", line 620, in validate_due_date\r\n    frappe.throw(_(""Due Date cannot be before Posting / Supplier Invoice Date""))\r\n    bill_date = None\r\n    due_date = \'2024-11-27\'\r\n    posting_date = \'2024-11-28\'\r\n    template_name = None\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 672, in throw\r\n    msgprint(\r\n    as_list = False\r\n    exc = <class \'frappe.exceptions.ValidationError\'>\r\n    is_minimizable = False\r\n    msg = \'Due Date cannot be before Posting / Supplier Invoice Date\'\r\n    primary_action = None\r\n    title = None\r\n    wide = False\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 633, in msgprint\r\n    _raise_exception()\r\n    _raise_exception = <function msgprint.<locals>._raise_exception at 0x7f829dc76200>\r\n    alert = False\r\n    as_list = False\r\n    as_table = False\r\n    indicator = \'red\'\r\n    inspect = <module \'inspect\' from \'/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py\'>\r\n    is_minimizable = False\r\n    msg = \'Due Date cannot be before Posting / Supplier Invoice Date\'\r\n    out = {\'message\': \'Due Date cannot be before Posting / Supplier Invoice Date\', \'title\': \'Message\', \'indicator\': \'red\', \'raise_exception\': 1, \'__frappe_exc_id\': \'f32086696aa512144c61bea9bb5b3cdd7f85a51da99e0c9987828066\'}\r\n    primary_action = None\r\n    raise_exception = <class \'frappe.exceptions.ValidationError\'>\r\n    realtime = False\r\n    title = None\r\n    wide = False\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 584, in _raise_exception\r\n    raise exc\r\n    exc = ValidationError(\'Due Date cannot be before Posting / Supplier Invoice Date\')\r\n    inspect = <module \'inspect\' from \'/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py\'>\r\n    msg = \'Due Date cannot be before Posting / Supplier Invoice Date\'\r\n    out = {\'message\': \'Due Date cannot be before Posting / Supplier Invoice Date\', \'title\': \'Message\', \'indicator\': \'red\', \'raise_exception\': 1, \'__frappe_exc_id\': \'f32086696aa512144c61bea9bb5b3cdd7f85a51da99e0c9987828066\'}\r\n    raise_exception = <class \'frappe.exceptions.ValidationError\'>\r\nfrappe.exceptions.ValidationError: Due Date cannot be before Posting / Supplier Invoice Date\r\n\r\nTests: 465, Failing: 0, Errors: 2\r\n\r\n\r\n======================================================================\r\n ERROR  test_sales_invoice_with_project_link (erpnext.accounts.doctype.sales_invoice.test_sales_invoice.TestSalesInvoice.test_sales_invoice_with_project_link)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/doctype/sales_invoice/test_sales_invoice.py"", line 2438, in test_sales_invoice_with_project_link\r\n    sales_invoice.submit()\r\n    item_project = <Project: doctype=Project PROJ-0002>\r\n    make_project = <function make_project at 0x7fb7db721b20>\r\n    project = <Project: doctype=Project PROJ-0001>\r\n    sales_invoice = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n    self = <erpnext.accounts.doctype.sales_invoice.test_sales_invoice.TestSalesInvoice testMethod=test_sales_invoice_with_project_link>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/utils/typing_validations.py"", line 32, in wrapper\r\n    return func(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^\r\n    apply_condition = <function whitelist.<locals>.innerfn.<locals>.<lambda> at 0x7fb7e08abf60>\r\n    args = (<SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>,)\r\n    func = <function Document.submit at 0x7fb7e08abec0>\r\n    kwargs = {}\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document.submit at 0x7fb7e08abe20>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1148, in submit\r\n    return self._submit()\r\n           ^^^^^^^^^^^^^^\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1130, in _submit\r\n    return self.save()\r\n           ^^^^^^^^^^^\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document.save at 0x7fb7e08aa340>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 421, in save\r\n    return self._save(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document._save at 0x7fb7e08aa480>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 444, in _save\r\n    return self.insert()\r\n           ^^^^^^^^^^^^^\r\n    ignore_permissions = None\r\n    ignore_version = None\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper\r\n    return func(self, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    func = <function Document.insert at 0x7fb7e08aa160>\r\n    kwargs = {}\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 373, in insert\r\n    self.run_before_save_methods()\r\n    ignore_if_duplicate = False\r\n    ignore_links = None\r\n    ignore_mandatory = None\r\n    ignore_permissions = None\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n    set_child_names = True\r\n    set_name = None\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1215, in run_before_save_methods\r\n    self.run_method(""validate"")\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1061, in run_method\r\n    out = Document.hook(fn)(self, *args, **kwargs)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    fn = <function Document.run_method.<locals>.fn at 0x7fb7da10c9a0>\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1448, in composer\r\n    return composed(self, method, *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    compose = <function Document.hook.<locals>.compose at 0x7fb7da33c4a0>\r\n    composed = <function Document.hook.<locals>.compose.<locals>.runner at 0x7fb7da33d8a0>\r\n    doc_events = {\'*\': {\'on_update\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.core.doctype.file.utils.attach_files_to_document\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\', \'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date\', \'frappe.core.doctype.user_type.user_type.apply_permissions_for_non_standard_user_type\', \'frappe.core.doctype.permission_log.permission_log.make_perm_log\'], \'after_rename\': [\'frappe.desk.notifications.clear_doctype_notifications\'], \'on_cancel\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\'], \'on_trash\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\'], \'on_update_after_submit\': [\'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\', \'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date\', \'frappe.core.doctype.file.utils.attach_files_to_document\'], \'on_change\': [\'frappe.social.doctype.energy_point_rule.energy_point_rule.process_energy_points\', \'frappe.automation.doctype.milestone_tracker.milestone_tracker.evaluate_milestone\'], \'after_delete\': [\'frappe.core.doctype.permission_log.permission_log.make_perm_log\'], \'validate\': [\'erpnext.support.doctype.service_level_agreement.service_level_agreement.apply\', \'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job\']}, \'Event\': {\'after_insert\': [\'frappe.integrations.doctype.google_calendar.google_calendar.insert_event_in_google_calendar\', \'erpnext.crm.utils.link_events_with_prospect\'], \'on_update\': [\'frappe.integrations.doctype.google_calendar.google_calendar.update_event_in_google_calendar\'], \'on_trash\': [\'frappe.integrations.doctype.google_calendar.google_calendar.delete_event_from_google_calendar\']}, \'Contact\': {\'after_insert\': [\'frappe.integrations.doctype.google_contacts.google_contacts.insert_contacts_to_google_contacts\', \'erpnext.telephony.doctype.call_log.call_log.link_existing_conversations\'], \'on_update\': [\'frappe.integrations.doctype.google_contacts.google_contacts.update_contacts_to_google_contacts\'], \'on_trash\': [\'erpnext.support.doctype.issue.issue.update_issue\'], \'validate\': [\'erpnext.crm.utils.update_lead_phone_numbers\']}, \'DocType\': {\'on_update\': [\'frappe.cache_manager.build_domain_restricted_doctype_cache\']}, \'Page\': {\'on_update\': [\'frappe.cache_manager.build_domain_restricted_page_cache\']}, \'Sales Invoice\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\'], \'on_submit\': [\'erpnext.regional.create_transaction_log\', \'erpnext.regional.italy.utils.sales_invoice_on_submit\'], \'on_cancel\': [\'erpnext.regional.italy.utils.sales_invoice_on_cancel\'], \'on_trash\': [\'erpnext.regional.check_deletion_permission\']}, \'Purchase Invoice\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\', \'erpnext.regional.united_arab_emirates.utils.update_grand_total_for_rcm\', \'erpnext.regional.united_arab_emirates.utils.validate_returns\']}, \'Journal Entry\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Bank Clearance\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Stock Entry\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\'], \'on_submit\': [\'erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty\'], \'on_cancel\': [\'erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty\']}, \'Dunning\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Invoice Discounting\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Payment Entry\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\'], \'on_submit\': [\'erpnext.regional.create_transaction_log\', \'erpnext.accounts.doctype.dunning.dunning.resolve_dunning\'], \'on_cancel\': [\'erpnext.accounts.doctype.dunning.dunning.resolve_dunning\'], \'on_trash\': [\'erpnext.regional.check_deletion_permission\']}, \'Period Closing Voucher\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Process Deferred Accounting\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Asset\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Asset Capitalization\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Asset Repair\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Delivery Note\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Landed Cost Voucher\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Purchase Receipt\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Stock Reconciliation\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'Subcontracting Receipt\': {\'validate\': [\'erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save\']}, \'User\': {\'after_insert\': [\'frappe.contacts.doctype.contact.contact.update_contact\'], \'validate\': [\'erpnext.setup.doctype.employee.employee.validate_employee_role\'], \'on_update\': [\'erpnext.setup.doctype.employee.employee.update_user_permissions\', \'erpnext.portal.utils.set_default_role\']}, \'Communication\': {\'on_update\': [\'erpnext.support.doctype.service_level_agreement.service_level_agreement.on_communication_update\', \'erpnext.support.doctype.issue.issue.set_first_response_time\'], \'after_insert\': [\'erpnext.crm.utils.link_communications_with_prospect\']}, \'Address\': {\'validate\': [\'erpnext.regional.italy.utils.set_state_code\']}, \'Email Unsubscribe\': {\'after_insert\': [\'erpnext.crm.doctype.email_campaign.email_campaign.unsubscribe_recipient\']}, \'Integration Request\': {\'validate\': [\'erpnext.accounts.doctype.payment_request.payment_request.validate_payment\']}}\r\n    f = <function Document.run_method.<locals>.fn at 0x7fb7da10c9a0>\r\n    handler = \'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job\'\r\n    hooks = [<function validate_accounting_period_on_doc_save at 0x7fb7dd964400>, <function apply at 0x7fb7dd552ca0>, <function check_for_running_deletion_job at 0x7fb7dd564a40>]\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1426, in runner\r\n    add_to_return_value(self, fn(self, *args, **kwargs))\r\n                              ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    add_to_return_value = <function Document.hook.<locals>.add_to_return_value at 0x7fb7da33cd60>\r\n    args = ()\r\n    fn = <function Document.run_method.<locals>.fn at 0x7fb7da10c9a0>\r\n    hooks = (<function validate_accounting_period_on_doc_save at 0x7fb7dd964400>, <function apply at 0x7fb7dd552ca0>, <function check_for_running_deletion_job at 0x7fb7dd564a40>)\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1058, in fn\r\n    return method_object(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    args = ()\r\n    kwargs = {}\r\n    method = \'validate\'\r\n    method_object = <bound method SalesInvoice.validate of <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>>\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/doctype/sales_invoice/sales_invoice.py"", line 273, in validate\r\n    super().validate()\r\n    __class__ = <class \'erpnext.accounts.doctype.sales_invoice.sales_invoice.SalesInvoice\'>\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/selling_controller.py"", line 35, in validate\r\n    super().validate()\r\n    __class__ = <class \'erpnext.controllers.selling_controller.SellingController\'>\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/stock_controller.py"", line 52, in validate\r\n    super().validate()\r\n    __class__ = <class \'erpnext.controllers.stock_controller.StockController\'>\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 208, in validate\r\n    self.validate_all_documents_schedule()\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 490, in validate_all_documents_schedule\r\n    self.validate_invoice_documents_schedule()\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 480, in validate_invoice_documents_schedule\r\n    self.validate_due_date()\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 668, in validate_due_date\r\n    frappe.throw(_(""Due Date is mandatory""))\r\n    posting_date = \'2024-11-28\'\r\n    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>\r\n    validate_due_date = <function validate_due_date at 0x7fb7dd871b20>\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 672, in throw\r\n    msgprint(\r\n    as_list = False\r\n    exc = <class \'frappe.exceptions.ValidationError\'>\r\n    is_minimizable = False\r\n    msg = \'Due Date is mandatory\'\r\n    primary_action = None\r\n    title = None\r\n    wide = False\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 633, in msgprint\r\n    _raise_exception()\r\n    _raise_exception = <function msgprint.<locals>._raise_exception at 0x7fb7da11e660>\r\n    alert = False\r\n    as_list = False\r\n    as_table = False\r\n    indicator = \'red\'\r\n    inspect = <module \'inspect\' from \'/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py\'>\r\n    is_minimizable = False\r\n    msg = \'Due Date is mandatory\'\r\n    out = {\'message\': \'Due Date is mandatory\', \'title\': \'Message\', \'indicator\': \'red\', \'raise_exception\': 1, \'__frappe_exc_id\': \'da8a74fe45f2a7ddd2e4427cdfd6eccfb93a0dc4d24a85ae6783174a\'}\r\n    primary_action = None\r\n    raise_exception = <class \'frappe.exceptions.ValidationError\'>\r\n    realtime = False\r\n    title = None\r\n    wide = False\r\n  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 584, in _raise_exception\r\n    raise exc\r\n    exc = ValidationError(\'Due Date is mandatory\')\r\n    inspect = <module \'inspect\' from \'/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py\'>\r\n    msg = \'Due Date is mandatory\'\r\n    out = {\'message\': \'Due Date is mandatory\', \'title\': \'Message\', \'indicator\': \'red\', \'raise_exception\': 1, \'__frappe_exc_id\': \'da8a74fe45f2a7ddd2e4427cdfd6eccfb93a0dc4d24a85ae6783174a\'}\r\n    raise_exception = <class \'frappe.exceptions.ValidationError\'>\r\nfrappe.exceptions.ValidationError: Due Date is mandatory\r\n\r\nTests: 481, Failing: 0, Errors: 1\r\n```\r\n\r\n</details>', 'created_at': datetime.datetime(2024, 12, 13, 6, 40, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2568772448, 'issue_id': 2665947464, 'author': 'stale[bot]', 'body': ""This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing."", 'created_at': datetime.datetime(2025, 1, 3, 7, 2, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2600342742, 'issue_id': 2665947464, 'author': 'stale[bot]', 'body': ""This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing."", 'created_at': datetime.datetime(2025, 1, 19, 0, 27, 29, tzinfo=datetime.timezone.utc)}]","SamuelHelbling (Issue Creator) on (2024-11-27 09:23:58 UTC): @ruthra-kumar 
The erpnext.accounts.doctype.sales_invoice.test_sales_invoice.TestSalesInvoice.test_sales_invoice_with_project_link test runs without errors in my local development environment. On Github it fails because due_date is not set. However, my pull request does not change the due_date.

Do you have any idea what the problem is?

ruthra-kumar (Assginee) on (2024-11-28 08:50:22 UTC): All of them fail for the same reason - Due Date mandatory. So we can't rule them out as flaky. 

They don't fail on local as well, so I too am unclear on the cause.

ruthra-kumar (Assginee) on (2024-12-13 06:40:13 UTC): <details>

<summary> Broken tests </summary>

```
======================================================================
 ERROR  test_timesheet_billing_based_on_project (erpnext.projects.doctype.timesheet.test_timesheet.TestTimesheet.test_timesheet_billing_based_on_project)
----------------------------------------------------------------------
Traceback (most recent call last):
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/projects/doctype/timesheet/test_timesheet.py"", line 65, in test_timesheet_billing_based_on_project
    sales_invoice.submit()
    emp = 'EMP-00001'
    project = '_T-Project-00001'
    sales_invoice = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
    self = <erpnext.projects.doctype.timesheet.test_timesheet.TestTimesheet testMethod=test_timesheet_billing_based_on_project>
    timesheet = <Timesheet: doctype=Timesheet TS-2024-00004 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/utils/typing_validations.py"", line 32, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
    apply_condition = <function whitelist.<locals>.innerfn.<locals>.<lambda> at 0x7f82a3ddff60>
    args = (<SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>,)
    func = <function Document.submit at 0x7f82a3ddfec0>
    kwargs = {}
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document.submit at 0x7f82a3ddfe20>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1148, in submit
    return self._submit()
           ^^^^^^^^^^^^^^
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1130, in _submit
    return self.save()
           ^^^^^^^^^^^
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document.save at 0x7f82a3dde340>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 421, in save
    return self._save(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document._save at 0x7f82a3dde480>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 444, in _save
    return self.insert()
           ^^^^^^^^^^^^^
    ignore_permissions = None
    ignore_version = None
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document.insert at 0x7f82a3dde160>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 373, in insert
    self.run_before_save_methods()
    ignore_if_duplicate = False
    ignore_links = None
    ignore_mandatory = None
    ignore_permissions = None
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
    set_child_names = True
    set_name = None
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1215, in run_before_save_methods
    self.run_method(""validate"")
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1061, in run_method
    out = Document.hook(fn)(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    fn = <function Document.run_method.<locals>.fn at 0x7f829e90ca40>
    kwargs = {}
    method = 'validate'
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1448, in composer
    return composed(self, method, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    compose = <function Document.hook.<locals>.compose at 0x7f829e96da80>
    composed = <function Document.hook.<locals>.compose.<locals>.runner at 0x7f829e96c9a0>
    doc_events = {'*': {'on_update': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.core.doctype.file.utils.attach_files_to_document', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply', 'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date', 'frappe.core.doctype.user_type.user_type.apply_permissions_for_non_standard_user_type', 'frappe.core.doctype.permission_log.permission_log.make_perm_log'], 'after_rename': ['frappe.desk.notifications.clear_doctype_notifications'], 'on_cancel': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply'], 'on_trash': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions'], 'on_update_after_submit': ['frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply', 'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date', 'frappe.core.doctype.file.utils.attach_files_to_document'], 'on_change': ['frappe.social.doctype.energy_point_rule.energy_point_rule.process_energy_points', 'frappe.automation.doctype.milestone_tracker.milestone_tracker.evaluate_milestone'], 'after_delete': ['frappe.core.doctype.permission_log.permission_log.make_perm_log'], 'validate': ['erpnext.support.doctype.service_level_agreement.service_level_agreement.apply', 'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job']}, 'Event': {'after_insert': ['frappe.integrations.doctype.google_calendar.google_calendar.insert_event_in_google_calendar', 'erpnext.crm.utils.link_events_with_prospect'], 'on_update': ['frappe.integrations.doctype.google_calendar.google_calendar.update_event_in_google_calendar'], 'on_trash': ['frappe.integrations.doctype.google_calendar.google_calendar.delete_event_from_google_calendar']}, 'Contact': {'after_insert': ['frappe.integrations.doctype.google_contacts.google_contacts.insert_contacts_to_google_contacts', 'erpnext.telephony.doctype.call_log.call_log.link_existing_conversations'], 'on_update': ['frappe.integrations.doctype.google_contacts.google_contacts.update_contacts_to_google_contacts'], 'on_trash': ['erpnext.support.doctype.issue.issue.update_issue'], 'validate': ['erpnext.crm.utils.update_lead_phone_numbers']}, 'DocType': {'on_update': ['frappe.cache_manager.build_domain_restricted_doctype_cache']}, 'Page': {'on_update': ['frappe.cache_manager.build_domain_restricted_page_cache']}, 'Sales Invoice': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save'], 'on_submit': ['erpnext.regional.create_transaction_log', 'erpnext.regional.italy.utils.sales_invoice_on_submit'], 'on_cancel': ['erpnext.regional.italy.utils.sales_invoice_on_cancel'], 'on_trash': ['erpnext.regional.check_deletion_permission']}, 'Purchase Invoice': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save', 'erpnext.regional.united_arab_emirates.utils.update_grand_total_for_rcm', 'erpnext.regional.united_arab_emirates.utils.validate_returns']}, 'Journal Entry': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Bank Clearance': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Stock Entry': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save'], 'on_submit': ['erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty'], 'on_cancel': ['erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty']}, 'Dunning': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Invoice Discounting': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Payment Entry': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save'], 'on_submit': ['erpnext.regional.create_transaction_log', 'erpnext.accounts.doctype.dunning.dunning.resolve_dunning'], 'on_cancel': ['erpnext.accounts.doctype.dunning.dunning.resolve_dunning'], 'on_trash': ['erpnext.regional.check_deletion_permission']}, 'Period Closing Voucher': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Process Deferred Accounting': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Asset': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Asset Capitalization': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Asset Repair': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Delivery Note': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Landed Cost Voucher': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Purchase Receipt': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Stock Reconciliation': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Subcontracting Receipt': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'User': {'after_insert': ['frappe.contacts.doctype.contact.contact.update_contact'], 'validate': ['erpnext.setup.doctype.employee.employee.validate_employee_role'], 'on_update': ['erpnext.setup.doctype.employee.employee.update_user_permissions', 'erpnext.portal.utils.set_default_role']}, 'Communication': {'on_update': ['erpnext.support.doctype.service_level_agreement.service_level_agreement.on_communication_update', 'erpnext.support.doctype.issue.issue.set_first_response_time'], 'after_insert': ['erpnext.crm.utils.link_communications_with_prospect']}, 'Address': {'validate': ['erpnext.regional.italy.utils.set_state_code']}, 'Email Unsubscribe': {'after_insert': ['erpnext.crm.doctype.email_campaign.email_campaign.unsubscribe_recipient']}, 'Integration Request': {'validate': ['erpnext.accounts.doctype.payment_request.payment_request.validate_payment']}}
    f = <function Document.run_method.<locals>.fn at 0x7f829e90ca40>
    handler = 'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job'
    hooks = [<function validate_accounting_period_on_doc_save at 0x7f82a0e905e0>, <function apply at 0x7f82a0a76e80>, <function check_for_running_deletion_job at 0x7f82a0a8cc20>]
    kwargs = {}
    method = 'validate'
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1426, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
    add_to_return_value = <function Document.hook.<locals>.add_to_return_value at 0x7f829e90dda0>
    args = ()
    fn = <function Document.run_method.<locals>.fn at 0x7f829e90ca40>
    hooks = (<function validate_accounting_period_on_doc_save at 0x7f82a0e905e0>, <function apply at 0x7f82a0a76e80>, <function check_for_running_deletion_job at 0x7f82a0a8cc20>)
    kwargs = {}
    method = 'validate'
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1058, in fn
    return method_object(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    kwargs = {}
    method = 'validate'
    method_object = <bound method SalesInvoice.validate of <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>>
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/doctype/sales_invoice/sales_invoice.py"", line 273, in validate
    super().validate()
    __class__ = <class 'erpnext.accounts.doctype.sales_invoice.sales_invoice.SalesInvoice'>
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/selling_controller.py"", line 35, in validate
    super().validate()
    __class__ = <class 'erpnext.controllers.selling_controller.SellingController'>
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/stock_controller.py"", line 52, in validate
    super().validate()
    __class__ = <class 'erpnext.controllers.stock_controller.StockController'>
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 208, in validate
    self.validate_all_documents_schedule()
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 490, in validate_all_documents_schedule
    self.validate_invoice_documents_schedule()
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 480, in validate_invoice_documents_schedule
    self.validate_due_date()
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 668, in validate_due_date
    frappe.throw(_(""Due Date is mandatory""))
    posting_date = '2024-11-27'
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00005 docstatus=1>
    validate_due_date = <function validate_due_date at 0x7f82a0d9dd00>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 672, in throw
    msgprint(
    as_list = False
    exc = <class 'frappe.exceptions.ValidationError'>
    is_minimizable = False
    msg = 'Due Date is mandatory'
    primary_action = None
    title = None
    wide = False
  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 633, in msgprint
    _raise_exception()
    _raise_exception = <function msgprint.<locals>._raise_exception at 0x7f829e96d4e0>
    alert = False
    as_list = False
    as_table = False
    indicator = 'red'
    inspect = <module 'inspect' from '/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py'>
    is_minimizable = False
    msg = 'Due Date is mandatory'
    out = {'message': 'Due Date is mandatory', 'title': 'Message', 'indicator': 'red', 'raise_exception': 1, '__frappe_exc_id': '0035e2e0b5c1d0f0eb3256acd8f59c08c537231ece24623debd084cc'}
    primary_action = None
    raise_exception = <class 'frappe.exceptions.ValidationError'>
    realtime = False
    title = None
    wide = False
  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 584, in _raise_exception
    raise exc
    exc = ValidationError('Due Date is mandatory')
    inspect = <module 'inspect' from '/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py'>
    msg = 'Due Date is mandatory'
    out = {'message': 'Due Date is mandatory', 'title': 'Message', 'indicator': 'red', 'raise_exception': 1, '__frappe_exc_id': '0035e2e0b5c1d0f0eb3256acd8f59c08c537231ece24623debd084cc'}
    raise_exception = <class 'frappe.exceptions.ValidationError'>
frappe.exceptions.ValidationError: Due Date is mandatory

======================================================================
 ERROR  test_update_qty (erpnext.selling.doctype.sales_order.test_sales_order.TestSalesOrder.test_update_qty)
----------------------------------------------------------------------
Traceback (most recent call last):
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/selling/doctype/sales_order/test_sales_order.py"", line 223, in test_update_qty
    si2.submit()
    self = <erpnext.selling.doctype.sales_order.test_sales_order.TestSalesOrder testMethod=test_update_qty>
    si1 = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00001 docstatus=1>
    si2 = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
    so = <SalesOrder: doctype=Sales Order SAL-ORD-2024-00006 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/utils/typing_validations.py"", line 32, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
    apply_condition = <function whitelist.<locals>.innerfn.<locals>.<lambda> at 0x7f82a3ddff60>
    args = (<SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>,)
    func = <function Document.submit at 0x7f82a3ddfec0>
    kwargs = {}
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document.submit at 0x7f82a3ddfe20>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1148, in submit
    return self._submit()
           ^^^^^^^^^^^^^^
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1130, in _submit
    return self.save()
           ^^^^^^^^^^^
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document.save at 0x7f82a3dde340>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 421, in save
    return self._save(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document._save at 0x7f82a3dde480>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 458, in _save
    self.run_before_save_methods()
    ignore_permissions = None
    ignore_version = None
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1215, in run_before_save_methods
    self.run_method(""validate"")
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1061, in run_method
    out = Document.hook(fn)(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    fn = <function Document.run_method.<locals>.fn at 0x7f829e32c680>
    kwargs = {}
    method = 'validate'
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1448, in composer
    return composed(self, method, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    compose = <function Document.hook.<locals>.compose at 0x7f829dd18680>
    composed = <function Document.hook.<locals>.compose.<locals>.runner at 0x7f829dd1bec0>
    doc_events = {'*': {'on_update': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.core.doctype.file.utils.attach_files_to_document', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply', 'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date', 'frappe.core.doctype.user_type.user_type.apply_permissions_for_non_standard_user_type', 'frappe.core.doctype.permission_log.permission_log.make_perm_log'], 'after_rename': ['frappe.desk.notifications.clear_doctype_notifications'], 'on_cancel': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply'], 'on_trash': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions'], 'on_update_after_submit': ['frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply', 'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date', 'frappe.core.doctype.file.utils.attach_files_to_document'], 'on_change': ['frappe.social.doctype.energy_point_rule.energy_point_rule.process_energy_points', 'frappe.automation.doctype.milestone_tracker.milestone_tracker.evaluate_milestone'], 'after_delete': ['frappe.core.doctype.permission_log.permission_log.make_perm_log'], 'validate': ['erpnext.support.doctype.service_level_agreement.service_level_agreement.apply', 'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job']}, 'Event': {'after_insert': ['frappe.integrations.doctype.google_calendar.google_calendar.insert_event_in_google_calendar', 'erpnext.crm.utils.link_events_with_prospect'], 'on_update': ['frappe.integrations.doctype.google_calendar.google_calendar.update_event_in_google_calendar'], 'on_trash': ['frappe.integrations.doctype.google_calendar.google_calendar.delete_event_from_google_calendar']}, 'Contact': {'after_insert': ['frappe.integrations.doctype.google_contacts.google_contacts.insert_contacts_to_google_contacts', 'erpnext.telephony.doctype.call_log.call_log.link_existing_conversations'], 'on_update': ['frappe.integrations.doctype.google_contacts.google_contacts.update_contacts_to_google_contacts'], 'on_trash': ['erpnext.support.doctype.issue.issue.update_issue'], 'validate': ['erpnext.crm.utils.update_lead_phone_numbers']}, 'DocType': {'on_update': ['frappe.cache_manager.build_domain_restricted_doctype_cache']}, 'Page': {'on_update': ['frappe.cache_manager.build_domain_restricted_page_cache']}, 'Sales Invoice': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save'], 'on_submit': ['erpnext.regional.create_transaction_log', 'erpnext.regional.italy.utils.sales_invoice_on_submit'], 'on_cancel': ['erpnext.regional.italy.utils.sales_invoice_on_cancel'], 'on_trash': ['erpnext.regional.check_deletion_permission']}, 'Purchase Invoice': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save', 'erpnext.regional.united_arab_emirates.utils.update_grand_total_for_rcm', 'erpnext.regional.united_arab_emirates.utils.validate_returns']}, 'Journal Entry': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Bank Clearance': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Stock Entry': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save'], 'on_submit': ['erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty'], 'on_cancel': ['erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty']}, 'Dunning': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Invoice Discounting': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Payment Entry': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save'], 'on_submit': ['erpnext.regional.create_transaction_log', 'erpnext.accounts.doctype.dunning.dunning.resolve_dunning'], 'on_cancel': ['erpnext.accounts.doctype.dunning.dunning.resolve_dunning'], 'on_trash': ['erpnext.regional.check_deletion_permission']}, 'Period Closing Voucher': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Process Deferred Accounting': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Asset': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Asset Capitalization': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Asset Repair': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Delivery Note': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Landed Cost Voucher': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Purchase Receipt': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Stock Reconciliation': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Subcontracting Receipt': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'User': {'after_insert': ['frappe.contacts.doctype.contact.contact.update_contact'], 'validate': ['erpnext.setup.doctype.employee.employee.validate_employee_role'], 'on_update': ['erpnext.setup.doctype.employee.employee.update_user_permissions', 'erpnext.portal.utils.set_default_role']}, 'Communication': {'on_update': ['erpnext.support.doctype.service_level_agreement.service_level_agreement.on_communication_update', 'erpnext.support.doctype.issue.issue.set_first_response_time'], 'after_insert': ['erpnext.crm.utils.link_communications_with_prospect']}, 'Address': {'validate': ['erpnext.regional.italy.utils.set_state_code']}, 'Email Unsubscribe': {'after_insert': ['erpnext.crm.doctype.email_campaign.email_campaign.unsubscribe_recipient']}, 'Integration Request': {'validate': ['erpnext.accounts.doctype.payment_request.payment_request.validate_payment']}}
    f = <function Document.run_method.<locals>.fn at 0x7f829e32c680>
    handler = 'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job'
    hooks = [<function validate_accounting_period_on_doc_save at 0x7f82a0e905e0>, <function apply at 0x7f82a0a76e80>, <function check_for_running_deletion_job at 0x7f82a0a8cc20>]
    kwargs = {}
    method = 'validate'
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1426, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
    add_to_return_value = <function Document.hook.<locals>.add_to_return_value at 0x7f829e32d760>
    args = ()
    fn = <function Document.run_method.<locals>.fn at 0x7f829e32c680>
    hooks = (<function validate_accounting_period_on_doc_save at 0x7f82a0e905e0>, <function apply at 0x7f82a0a76e80>, <function check_for_running_deletion_job at 0x7f82a0a8cc20>)
    kwargs = {}
    method = 'validate'
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1058, in fn
    return method_object(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    kwargs = {}
    method = 'validate'
    method_object = <bound method SalesInvoice.validate of <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>>
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/doctype/sales_invoice/sales_invoice.py"", line 273, in validate
    super().validate()
    __class__ = <class 'erpnext.accounts.doctype.sales_invoice.sales_invoice.SalesInvoice'>
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/selling_controller.py"", line 35, in validate
    super().validate()
    __class__ = <class 'erpnext.controllers.selling_controller.SellingController'>
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/stock_controller.py"", line 52, in validate
    super().validate()
    __class__ = <class 'erpnext.controllers.stock_controller.StockController'>
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 208, in validate
    self.validate_all_documents_schedule()
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 490, in validate_all_documents_schedule
    self.validate_invoice_documents_schedule()
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 480, in validate_invoice_documents_schedule
    self.validate_due_date()
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 670, in validate_due_date
    validate_due_date(
    posting_date = '2024-11-28'
    self = <SalesInvoice: doctype=Sales Invoice ACC-SINV-2024-00002 docstatus=1>
    validate_due_date = <function validate_due_date at 0x7f82a0d9dd00>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/party.py"", line 620, in validate_due_date
    frappe.throw(_(""Due Date cannot be before Posting / Supplier Invoice Date""))
    bill_date = None
    due_date = '2024-11-27'
    posting_date = '2024-11-28'
    template_name = None
  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 672, in throw
    msgprint(
    as_list = False
    exc = <class 'frappe.exceptions.ValidationError'>
    is_minimizable = False
    msg = 'Due Date cannot be before Posting / Supplier Invoice Date'
    primary_action = None
    title = None
    wide = False
  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 633, in msgprint
    _raise_exception()
    _raise_exception = <function msgprint.<locals>._raise_exception at 0x7f829dc76200>
    alert = False
    as_list = False
    as_table = False
    indicator = 'red'
    inspect = <module 'inspect' from '/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py'>
    is_minimizable = False
    msg = 'Due Date cannot be before Posting / Supplier Invoice Date'
    out = {'message': 'Due Date cannot be before Posting / Supplier Invoice Date', 'title': 'Message', 'indicator': 'red', 'raise_exception': 1, '__frappe_exc_id': 'f32086696aa512144c61bea9bb5b3cdd7f85a51da99e0c9987828066'}
    primary_action = None
    raise_exception = <class 'frappe.exceptions.ValidationError'>
    realtime = False
    title = None
    wide = False
  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 584, in _raise_exception
    raise exc
    exc = ValidationError('Due Date cannot be before Posting / Supplier Invoice Date')
    inspect = <module 'inspect' from '/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py'>
    msg = 'Due Date cannot be before Posting / Supplier Invoice Date'
    out = {'message': 'Due Date cannot be before Posting / Supplier Invoice Date', 'title': 'Message', 'indicator': 'red', 'raise_exception': 1, '__frappe_exc_id': 'f32086696aa512144c61bea9bb5b3cdd7f85a51da99e0c9987828066'}
    raise_exception = <class 'frappe.exceptions.ValidationError'>
frappe.exceptions.ValidationError: Due Date cannot be before Posting / Supplier Invoice Date

Tests: 465, Failing: 0, Errors: 2


======================================================================
 ERROR  test_sales_invoice_with_project_link (erpnext.accounts.doctype.sales_invoice.test_sales_invoice.TestSalesInvoice.test_sales_invoice_with_project_link)
----------------------------------------------------------------------
Traceback (most recent call last):
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/doctype/sales_invoice/test_sales_invoice.py"", line 2438, in test_sales_invoice_with_project_link
    sales_invoice.submit()
    item_project = <Project: doctype=Project PROJ-0002>
    make_project = <function make_project at 0x7fb7db721b20>
    project = <Project: doctype=Project PROJ-0001>
    sales_invoice = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
    self = <erpnext.accounts.doctype.sales_invoice.test_sales_invoice.TestSalesInvoice testMethod=test_sales_invoice_with_project_link>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/utils/typing_validations.py"", line 32, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
    apply_condition = <function whitelist.<locals>.innerfn.<locals>.<lambda> at 0x7fb7e08abf60>
    args = (<SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>,)
    func = <function Document.submit at 0x7fb7e08abec0>
    kwargs = {}
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document.submit at 0x7fb7e08abe20>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1148, in submit
    return self._submit()
           ^^^^^^^^^^^^^^
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1130, in _submit
    return self.save()
           ^^^^^^^^^^^
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document.save at 0x7fb7e08aa340>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 421, in save
    return self._save(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document._save at 0x7fb7e08aa480>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 444, in _save
    return self.insert()
           ^^^^^^^^^^^^^
    ignore_permissions = None
    ignore_version = None
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 123, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    func = <function Document.insert at 0x7fb7e08aa160>
    kwargs = {}
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 373, in insert
    self.run_before_save_methods()
    ignore_if_duplicate = False
    ignore_links = None
    ignore_mandatory = None
    ignore_permissions = None
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
    set_child_names = True
    set_name = None
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1215, in run_before_save_methods
    self.run_method(""validate"")
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1061, in run_method
    out = Document.hook(fn)(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    fn = <function Document.run_method.<locals>.fn at 0x7fb7da10c9a0>
    kwargs = {}
    method = 'validate'
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1448, in composer
    return composed(self, method, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    compose = <function Document.hook.<locals>.compose at 0x7fb7da33c4a0>
    composed = <function Document.hook.<locals>.compose.<locals>.runner at 0x7fb7da33d8a0>
    doc_events = {'*': {'on_update': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.core.doctype.file.utils.attach_files_to_document', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply', 'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date', 'frappe.core.doctype.user_type.user_type.apply_permissions_for_non_standard_user_type', 'frappe.core.doctype.permission_log.permission_log.make_perm_log'], 'after_rename': ['frappe.desk.notifications.clear_doctype_notifications'], 'on_cancel': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply'], 'on_trash': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions'], 'on_update_after_submit': ['frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply', 'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date', 'frappe.core.doctype.file.utils.attach_files_to_document'], 'on_change': ['frappe.social.doctype.energy_point_rule.energy_point_rule.process_energy_points', 'frappe.automation.doctype.milestone_tracker.milestone_tracker.evaluate_milestone'], 'after_delete': ['frappe.core.doctype.permission_log.permission_log.make_perm_log'], 'validate': ['erpnext.support.doctype.service_level_agreement.service_level_agreement.apply', 'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job']}, 'Event': {'after_insert': ['frappe.integrations.doctype.google_calendar.google_calendar.insert_event_in_google_calendar', 'erpnext.crm.utils.link_events_with_prospect'], 'on_update': ['frappe.integrations.doctype.google_calendar.google_calendar.update_event_in_google_calendar'], 'on_trash': ['frappe.integrations.doctype.google_calendar.google_calendar.delete_event_from_google_calendar']}, 'Contact': {'after_insert': ['frappe.integrations.doctype.google_contacts.google_contacts.insert_contacts_to_google_contacts', 'erpnext.telephony.doctype.call_log.call_log.link_existing_conversations'], 'on_update': ['frappe.integrations.doctype.google_contacts.google_contacts.update_contacts_to_google_contacts'], 'on_trash': ['erpnext.support.doctype.issue.issue.update_issue'], 'validate': ['erpnext.crm.utils.update_lead_phone_numbers']}, 'DocType': {'on_update': ['frappe.cache_manager.build_domain_restricted_doctype_cache']}, 'Page': {'on_update': ['frappe.cache_manager.build_domain_restricted_page_cache']}, 'Sales Invoice': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save'], 'on_submit': ['erpnext.regional.create_transaction_log', 'erpnext.regional.italy.utils.sales_invoice_on_submit'], 'on_cancel': ['erpnext.regional.italy.utils.sales_invoice_on_cancel'], 'on_trash': ['erpnext.regional.check_deletion_permission']}, 'Purchase Invoice': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save', 'erpnext.regional.united_arab_emirates.utils.update_grand_total_for_rcm', 'erpnext.regional.united_arab_emirates.utils.validate_returns']}, 'Journal Entry': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Bank Clearance': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Stock Entry': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save'], 'on_submit': ['erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty'], 'on_cancel': ['erpnext.stock.doctype.material_request.material_request.update_completed_and_requested_qty']}, 'Dunning': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Invoice Discounting': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Payment Entry': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save'], 'on_submit': ['erpnext.regional.create_transaction_log', 'erpnext.accounts.doctype.dunning.dunning.resolve_dunning'], 'on_cancel': ['erpnext.accounts.doctype.dunning.dunning.resolve_dunning'], 'on_trash': ['erpnext.regional.check_deletion_permission']}, 'Period Closing Voucher': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Process Deferred Accounting': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Asset': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Asset Capitalization': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Asset Repair': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Delivery Note': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Landed Cost Voucher': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Purchase Receipt': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Stock Reconciliation': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'Subcontracting Receipt': {'validate': ['erpnext.accounts.doctype.accounting_period.accounting_period.validate_accounting_period_on_doc_save']}, 'User': {'after_insert': ['frappe.contacts.doctype.contact.contact.update_contact'], 'validate': ['erpnext.setup.doctype.employee.employee.validate_employee_role'], 'on_update': ['erpnext.setup.doctype.employee.employee.update_user_permissions', 'erpnext.portal.utils.set_default_role']}, 'Communication': {'on_update': ['erpnext.support.doctype.service_level_agreement.service_level_agreement.on_communication_update', 'erpnext.support.doctype.issue.issue.set_first_response_time'], 'after_insert': ['erpnext.crm.utils.link_communications_with_prospect']}, 'Address': {'validate': ['erpnext.regional.italy.utils.set_state_code']}, 'Email Unsubscribe': {'after_insert': ['erpnext.crm.doctype.email_campaign.email_campaign.unsubscribe_recipient']}, 'Integration Request': {'validate': ['erpnext.accounts.doctype.payment_request.payment_request.validate_payment']}}
    f = <function Document.run_method.<locals>.fn at 0x7fb7da10c9a0>
    handler = 'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job'
    hooks = [<function validate_accounting_period_on_doc_save at 0x7fb7dd964400>, <function apply at 0x7fb7dd552ca0>, <function check_for_running_deletion_job at 0x7fb7dd564a40>]
    kwargs = {}
    method = 'validate'
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1426, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
    add_to_return_value = <function Document.hook.<locals>.add_to_return_value at 0x7fb7da33cd60>
    args = ()
    fn = <function Document.run_method.<locals>.fn at 0x7fb7da10c9a0>
    hooks = (<function validate_accounting_period_on_doc_save at 0x7fb7dd964400>, <function apply at 0x7fb7dd552ca0>, <function check_for_running_deletion_job at 0x7fb7dd564a40>)
    kwargs = {}
    method = 'validate'
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/model/document.py"", line 1058, in fn
    return method_object(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    args = ()
    kwargs = {}
    method = 'validate'
    method_object = <bound method SalesInvoice.validate of <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>>
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/accounts/doctype/sales_invoice/sales_invoice.py"", line 273, in validate
    super().validate()
    __class__ = <class 'erpnext.accounts.doctype.sales_invoice.sales_invoice.SalesInvoice'>
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/selling_controller.py"", line 35, in validate
    super().validate()
    __class__ = <class 'erpnext.controllers.selling_controller.SellingController'>
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/stock_controller.py"", line 52, in validate
    super().validate()
    __class__ = <class 'erpnext.controllers.stock_controller.StockController'>
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 208, in validate
    self.validate_all_documents_schedule()
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 490, in validate_all_documents_schedule
    self.validate_invoice_documents_schedule()
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 480, in validate_invoice_documents_schedule
    self.validate_due_date()
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
  File ""/home/runner/frappe-bench/apps/erpnext/erpnext/controllers/accounts_controller.py"", line 668, in validate_due_date
    frappe.throw(_(""Due Date is mandatory""))
    posting_date = '2024-11-28'
    self = <SalesInvoice: doctype=Sales Invoice T-SINV-00015 docstatus=1>
    validate_due_date = <function validate_due_date at 0x7fb7dd871b20>
  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 672, in throw
    msgprint(
    as_list = False
    exc = <class 'frappe.exceptions.ValidationError'>
    is_minimizable = False
    msg = 'Due Date is mandatory'
    primary_action = None
    title = None
    wide = False
  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 633, in msgprint
    _raise_exception()
    _raise_exception = <function msgprint.<locals>._raise_exception at 0x7fb7da11e660>
    alert = False
    as_list = False
    as_table = False
    indicator = 'red'
    inspect = <module 'inspect' from '/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py'>
    is_minimizable = False
    msg = 'Due Date is mandatory'
    out = {'message': 'Due Date is mandatory', 'title': 'Message', 'indicator': 'red', 'raise_exception': 1, '__frappe_exc_id': 'da8a74fe45f2a7ddd2e4427cdfd6eccfb93a0dc4d24a85ae6783174a'}
    primary_action = None
    raise_exception = <class 'frappe.exceptions.ValidationError'>
    realtime = False
    title = None
    wide = False
  File ""/home/runner/frappe-bench/apps/frappe/frappe/__init__.py"", line 584, in _raise_exception
    raise exc
    exc = ValidationError('Due Date is mandatory')
    inspect = <module 'inspect' from '/opt/hostedtoolcache/Python/3.12.7/x64/lib/python3.12/inspect.py'>
    msg = 'Due Date is mandatory'
    out = {'message': 'Due Date is mandatory', 'title': 'Message', 'indicator': 'red', 'raise_exception': 1, '__frappe_exc_id': 'da8a74fe45f2a7ddd2e4427cdfd6eccfb93a0dc4d24a85ae6783174a'}
    raise_exception = <class 'frappe.exceptions.ValidationError'>
frappe.exceptions.ValidationError: Due Date is mandatory

Tests: 481, Failing: 0, Errors: 1
```

</details>

stale[bot] on (2025-01-03 07:02:12 UTC): This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing.

stale[bot] on (2025-01-19 00:27:29 UTC): This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing.

"
2665921071,pull_request,closed,,feat: edi template instrumentation,"This PR adds instrumentation to work with EDI Templates (such as E-Invoices and E-Payroll and similar).

It is designed to support a mixed development model consisting of:
- Quick prototyping via the Backend
- Detailed implementation of context and submit logic via code files in an editor

It sets up the EDI Template and auxiliar doctypes to anchor the templating logic for each desired transaction doctype.

---

This PR builds on top of 
**ERPNext**
- #43425 
- https://github.com/frappe/erpnext/pull/43372 & https://github.com/frappe/erpnext/pull/44171 (recommended)

**Frappe**
- https://github.com/frappe/frappe/pull/27963 (responsible for failing tests, atm)
  - https://github.com/frappe/frappe/pull/27973
- https://github.com/frappe/frappe/pull/28490
- https://github.com/frappe/frappe/pull/28479
- https://github.com/frappe/frappe/pull/28497

--- 

![image](https://github.com/user-attachments/assets/4bb97bb8-1db3-4098-b2c9-8bb4752438aa)

---
![image](https://github.com/user-attachments/assets/05f6423b-9d31-48d9-b27b-a7069ef93f03)

",blaggacao,2024-11-17 14:28:05+00:00,[],2025-02-04 19:09:08+00:00,2025-02-04 19:09:08+00:00,https://github.com/frappe/erpnext/pull/44174,"[('inactive', '')]","[{'comment_id': 2483572200, 'issue_id': 2665921071, 'author': 'barredterra', 'body': 'Removing myself as a reviewer, as long as this is not ready to merge.', 'created_at': datetime.datetime(2024, 11, 18, 16, 45, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2537949653, 'issue_id': 2665921071, 'author': 'stale[bot]', 'body': ""This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing."", 'created_at': datetime.datetime(2024, 12, 12, 6, 46, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2565605134, 'issue_id': 2665921071, 'author': 'stale[bot]', 'body': ""This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing."", 'created_at': datetime.datetime(2024, 12, 30, 15, 12, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2566288924, 'issue_id': 2665921071, 'author': 'blaggacao', 'body': 'Keep!', 'created_at': datetime.datetime(2024, 12, 31, 9, 39, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2594156269, 'issue_id': 2665921071, 'author': 'alexleach', 'body': ""Posting to be notified of updates 🙂\nEDI has been requested back since 2016 I'm the forum, glad to see some progress is being made! 🙂"", 'created_at': datetime.datetime(2025, 1, 15, 23, 40, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2627859091, 'issue_id': 2665921071, 'author': 'stale[bot]', 'body': ""This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing."", 'created_at': datetime.datetime(2025, 1, 31, 17, 25, 16, tzinfo=datetime.timezone.utc)}]","barredterra on (2024-11-18 16:45:48 UTC): Removing myself as a reviewer, as long as this is not ready to merge.

stale[bot] on (2024-12-12 06:46:41 UTC): This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing.

stale[bot] on (2024-12-30 15:12:11 UTC): This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing.

blaggacao (Issue Creator) on (2024-12-31 09:39:12 UTC): Keep!

alexleach on (2025-01-15 23:40:52 UTC): Posting to be notified of updates 🙂
EDI has been requested back since 2016 I'm the forum, glad to see some progress is being made! 🙂

stale[bot] on (2025-01-31 17:25:16 UTC): This pull request has been automatically marked as inactive because it has not had recent activity. It will be closed within 3 days if no further activity occurs, but it only takes a comment to keep a contribution alive :) Also, even if it is closed, you can always reopen the PR when you're ready. Thank you for contributing.

"
2665911250,pull_request,closed,,"feat: new DocTypes ""Code List"" and ""Common Code"" (backport #43425)","![code_list](https://github.com/user-attachments/assets/db57cf07-4b84-487c-9bc2-25d606054fdc)

![common_code_list](https://github.com/user-attachments/assets/2196d3c6-0280-4797-9303-377c54c9e6f4)

![common_code](https://github.com/user-attachments/assets/ad2b534d-ce11-4fb0-bc1a-628b3a45bf9d)

```python
In [1]: code_list = ""urn:xoev-de:kosit:codeliste:untdid.5305_3""

In [2]: get_codes_for(code_list, ""Account"", ""Tax Assets - WPL"")
Out[2]: ('A',)

In [3]: get_docnames_for(code_list, ""Account"", ""A"")
Out[3]: ('Tax Assets - WPL',)

In [4]: get_default_code(code_list)
Out[4]: 'S'
```

Screenshots based on https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.5305_3:technischerBestandteilGenericode:datei:UNTDID_5305-3.xml

After this is merged, check if we should revert https://github.com/frappe/erpnext/pull/40593 and https://github.com/frappe/erpnext/pull/40663

> no-docs (for now)<hr>This is an automatic backport of pull request #43425 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-17 14:06:44+00:00,['barredterra'],2024-12-03 00:13:14+00:00,2024-11-18 20:08:22+00:00,https://github.com/frappe/erpnext/pull/44173,[],"[{'comment_id': 2484005650, 'issue_id': 2665911250, 'author': 'barredterra', 'body': ""The URL-based import of Code Lists depends on the release of https://github.com/frappe/frappe/pull/28493. File-based import still works, so it's not a hard dependency."", 'created_at': datetime.datetime(2024, 11, 18, 20, 6, 9, tzinfo=datetime.timezone.utc)}]","barredterra (Assginee) on (2024-11-18 20:06:09 UTC): The URL-based import of Code Lists depends on the release of https://github.com/frappe/frappe/pull/28493. File-based import still works, so it's not a hard dependency.

"
2665911224,pull_request,closed,,"feat: new DocTypes ""Code List"" and ""Common Code"" (backport #43425)","![code_list](https://github.com/user-attachments/assets/db57cf07-4b84-487c-9bc2-25d606054fdc)

![common_code_list](https://github.com/user-attachments/assets/2196d3c6-0280-4797-9303-377c54c9e6f4)

![common_code](https://github.com/user-attachments/assets/ad2b534d-ce11-4fb0-bc1a-628b3a45bf9d)

```python
In [1]: code_list = ""urn:xoev-de:kosit:codeliste:untdid.5305_3""

In [2]: get_codes_for(code_list, ""Account"", ""Tax Assets - WPL"")
Out[2]: ('A',)

In [3]: get_docnames_for(code_list, ""Account"", ""A"")
Out[3]: ('Tax Assets - WPL',)

In [4]: get_default_code(code_list)
Out[4]: 'S'
```

Screenshots based on https://www.xrepository.de/api/xrepository/urn:xoev-de:kosit:codeliste:untdid.5305_3:technischerBestandteilGenericode:datei:UNTDID_5305-3.xml

After this is merged, check if we should revert https://github.com/frappe/erpnext/pull/40593 and https://github.com/frappe/erpnext/pull/40663

> no-docs (for now)

<hr>This is an automatic backport of pull request #43425 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-17 14:06:41+00:00,['barredterra'],2024-12-05 00:12:31+00:00,2024-11-18 19:59:42+00:00,https://github.com/frappe/erpnext/pull/44172,"[('released', None)]","[{'comment_id': 2481279645, 'issue_id': 2665911224, 'author': 'mergify[bot]', 'body': 'Cherry-pick of 2a8dbc5cd5c6443d7eaa107d13dc1ab173470433 has failed:\n```\nOn branch mergify/bp/version-14-hotfix/pr-43425\nYour branch is up to date with \'origin/version-14-hotfix\'.\n\nYou are currently cherry-picking commit 2a8dbc5cd5.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tnew file:   erpnext/edi/__init__.py\n\tnew file:   erpnext/edi/doctype/__init__.py\n\tnew file:   erpnext/edi/doctype/code_list/__init__.py\n\tnew file:   erpnext/edi/doctype/code_list/code_list.js\n\tnew file:   erpnext/edi/doctype/code_list/code_list.json\n\tnew file:   erpnext/edi/doctype/code_list/code_list.py\n\tnew file:   erpnext/edi/doctype/code_list/code_list_import.js\n\tnew file:   erpnext/edi/doctype/code_list/code_list_import.py\n\tnew file:   erpnext/edi/doctype/code_list/code_list_list.js\n\tnew file:   erpnext/edi/doctype/code_list/test_code_list.py\n\tnew file:   erpnext/edi/doctype/common_code/__init__.py\n\tnew file:   erpnext/edi/doctype/common_code/common_code.js\n\tnew file:   erpnext/edi/doctype/common_code/common_code.json\n\tnew file:   erpnext/edi/doctype/common_code/common_code.py\n\tnew file:   erpnext/edi/doctype/common_code/common_code_list.js\n\tnew file:   erpnext/edi/doctype/common_code/test_common_code.py\n\tmodified:   erpnext/hooks.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/modules.txt\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 11, 17, 14, 6, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2481415794, 'issue_id': 2665911224, 'author': 'barredterra', 'body': ""Tested import and utils with one code list.\r\n\r\nThe URL-based import of Code Lists depends on the release of https://github.com/frappe/frappe/pull/28492. File-based import still works, so it's not a hard dependency."", 'created_at': datetime.datetime(2024, 11, 17, 18, 19, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2487895590, 'issue_id': 2665911224, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 13, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-11-17 14:06:43 UTC): Cherry-pick of 2a8dbc5cd5c6443d7eaa107d13dc1ab173470433 has failed:
```
On branch mergify/bp/version-14-hotfix/pr-43425
Your branch is up to date with 'origin/version-14-hotfix'.

You are currently cherry-picking commit 2a8dbc5cd5.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	new file:   erpnext/edi/__init__.py
	new file:   erpnext/edi/doctype/__init__.py
	new file:   erpnext/edi/doctype/code_list/__init__.py
	new file:   erpnext/edi/doctype/code_list/code_list.js
	new file:   erpnext/edi/doctype/code_list/code_list.json
	new file:   erpnext/edi/doctype/code_list/code_list.py
	new file:   erpnext/edi/doctype/code_list/code_list_import.js
	new file:   erpnext/edi/doctype/code_list/code_list_import.py
	new file:   erpnext/edi/doctype/code_list/code_list_list.js
	new file:   erpnext/edi/doctype/code_list/test_code_list.py
	new file:   erpnext/edi/doctype/common_code/__init__.py
	new file:   erpnext/edi/doctype/common_code/common_code.js
	new file:   erpnext/edi/doctype/common_code/common_code.json
	new file:   erpnext/edi/doctype/common_code/common_code.py
	new file:   erpnext/edi/doctype/common_code/common_code_list.js
	new file:   erpnext/edi/doctype/common_code/test_common_code.py
	modified:   erpnext/hooks.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/modules.txt

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

barredterra (Assginee) on (2024-11-17 18:19:15 UTC): Tested import and utils with one code list.

The URL-based import of Code Lists depends on the release of https://github.com/frappe/frappe/pull/28492. File-based import still works, so it's not a hard dependency.

frappe-pr-bot on (2024-11-20 08:38:13 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2665717419,pull_request,closed,,fix(migration): to new item_wise_tax_detail,"fixup for #43372

- The original migration script was ineffectual due to a typo
- This works by fixing the typo, renaming the script and thus retriggering the migration
- Collateral improvement help with printout feedback and intermediate state (for my own purpose, only)
",blaggacao,2024-11-17 11:01:11+00:00,[],2024-12-06 15:42:13+00:00,2024-11-17 11:25:13+00:00,https://github.com/frappe/erpnext/pull/44171,[],"[{'comment_id': 2481185968, 'issue_id': 2665717419, 'author': 'blaggacao', 'body': 'cc @ruthra-kumar', 'created_at': datetime.datetime(2024, 11, 17, 11, 2, 49, tzinfo=datetime.timezone.utc)}, {'comment_id': 2523494551, 'issue_id': 2665717419, 'author': 'surajshetty3416', 'body': '@blaggacao, @ruthra-kumar the patch is failing with following error.\r\n\r\n```\r\nExecuting erpnext.patches.v15_0.migrate_old_item_wise_tax_detail_data_format in dummy.frappe.cloud (_93e07d6ba005db92)\r\n\r\n\r\n:: \'int\' object has no attribute \'items\' ::\r\n\r\nContext:\r\n File \'/home/frappe/frappe-bench/apps/erpnext/erpnext/patches/v15_0/migrate_old_item_wise_tax_detail_data_format.py\', line 29\r\n\r\n  24: \t\t\t\tcontinue\r\n  25: \r\n  26: \t\t\tupdated_tax_details = {}\r\n  27: \t\t\tneeds_update = False\r\n  28: \r\n  29> \t\t\tfor item, tax_data in json.loads(doc.item_wise_tax_detail).items():\r\n  30: \t\t\t\tif isinstance(tax_data, list) and len(tax_data) == 2:\r\n  31: \t\t\t\t\tupdated_tax_details[item] = ItemWiseTaxDetail(\r\n  32: \t\t\t\t\t\ttax_rate=tax_data[0],\r\n  33: \t\t\t\t\t\ttax_amount=tax_data[1],\r\n  34: \t\t\t\t\t\t# can\'t be reliably reconstructed since it depends on the tax type\r\n\r\nFull traceback:\r\nTraceback (most recent call last):\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/utils/bench_helper.py"", line 47, in invoke\r\n    return super().invoke(ctx)\r\n           ^^^^^^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/click/core.py"", line 1688, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/click/core.py"", line 1434, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/click/core.py"", line 783, in invoke\r\n    return __callback(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/click/decorators.py"", line 33, in new_func\r\n    return f(get_current_context(), *args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/commands/__init__.py"", line 28, in _func\r\n    ret = f(ctx.obj, *args, **kwargs)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/commands/site.py"", line 706, in migrate\r\n    ).run(site=site)\r\n      ^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/migrate.py"", line 205, in run\r\n    self.run_schema_updates()\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/migrate.py"", line 53, in wrapper\r\n    raise e\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/migrate.py"", line 45, in wrapper\r\n    ret = method(*args, **kwargs)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/migrate.py"", line 122, in run_schema_updates\r\n    frappe.modules.patch_handler.run_all(\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/modules/patch_handler.py"", line 76, in run_all\r\n    run_patch(patch)\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/modules/patch_handler.py"", line 62, in run_patch\r\n    if not run_single(patchmodule=patch):\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/modules/patch_handler.py"", line 152, in run_single\r\n    return execute_patch(patchmodule, method, methodargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File ""/home/frappe/frappe-bench/apps/frappe/frappe/modules/patch_handler.py"", line 188, in execute_patch\r\n    _patch()\r\n  File ""/home/frappe/frappe-bench/apps/erpnext/erpnext/patches/v15_0/migrate_old_item_wise_tax_detail_data_format.py"", line 29, in execute\r\n    for item, tax_data in json.loads(doc.item_wise_tax_detail).items():\r\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\nAttributeError: \'int\' object has no attribute \'items\'\r\n```', 'created_at': datetime.datetime(2024, 12, 6, 15, 27, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2523518730, 'issue_id': 2665717419, 'author': 'blaggacao', 'body': ""@surajshetty3416 Could you supply the value of `doc.item_wise_tax_detail` (and the doctype of `doc`)? &mdash; even by the previous implementation, I don't know of any reason why this would have legitimately been an integer. In all circumstances, a `dict` is and was expected."", 'created_at': datetime.datetime(2024, 12, 6, 15, 39, 9, tzinfo=datetime.timezone.utc)}]","blaggacao (Issue Creator) on (2024-11-17 11:02:49 UTC): cc @ruthra-kumar

surajshetty3416 on (2024-12-06 15:27:30 UTC): @blaggacao, @ruthra-kumar the patch is failing with following error.

```
Executing erpnext.patches.v15_0.migrate_old_item_wise_tax_detail_data_format in dummy.frappe.cloud (_93e07d6ba005db92)


:: 'int' object has no attribute 'items' ::

Context:
 File '/home/frappe/frappe-bench/apps/erpnext/erpnext/patches/v15_0/migrate_old_item_wise_tax_detail_data_format.py', line 29

  24: 				continue
  25: 
  26: 			updated_tax_details = {}
  27: 			needs_update = False
  28: 
  29> 			for item, tax_data in json.loads(doc.item_wise_tax_detail).items():
  30: 				if isinstance(tax_data, list) and len(tax_data) == 2:
  31: 					updated_tax_details[item] = ItemWiseTaxDetail(
  32: 						tax_rate=tax_data[0],
  33: 						tax_amount=tax_data[1],
  34: 						# can't be reliably reconstructed since it depends on the tax type

Full traceback:
Traceback (most recent call last):
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/utils/bench_helper.py"", line 47, in invoke
    return super().invoke(ctx)
           ^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/click/core.py"", line 1688, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/click/core.py"", line 1434, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/click/core.py"", line 783, in invoke
    return __callback(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/click/decorators.py"", line 33, in new_func
    return f(get_current_context(), *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/commands/__init__.py"", line 28, in _func
    ret = f(ctx.obj, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/commands/site.py"", line 706, in migrate
    ).run(site=site)
      ^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/migrate.py"", line 205, in run
    self.run_schema_updates()
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/migrate.py"", line 53, in wrapper
    raise e
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/migrate.py"", line 45, in wrapper
    ret = method(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/migrate.py"", line 122, in run_schema_updates
    frappe.modules.patch_handler.run_all(
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/modules/patch_handler.py"", line 76, in run_all
    run_patch(patch)
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/modules/patch_handler.py"", line 62, in run_patch
    if not run_single(patchmodule=patch):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/modules/patch_handler.py"", line 152, in run_single
    return execute_patch(patchmodule, method, methodargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/modules/patch_handler.py"", line 188, in execute_patch
    _patch()
  File ""/home/frappe/frappe-bench/apps/erpnext/erpnext/patches/v15_0/migrate_old_item_wise_tax_detail_data_format.py"", line 29, in execute
    for item, tax_data in json.loads(doc.item_wise_tax_detail).items():
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'int' object has no attribute 'items'
```

blaggacao (Issue Creator) on (2024-12-06 15:39:09 UTC): @surajshetty3416 Could you supply the value of `doc.item_wise_tax_detail` (and the doctype of `doc`)? &mdash; even by the previous implementation, I don't know of any reason why this would have legitimately been an integer. In all circumstances, a `dict` is and was expected.

"
2665642708,pull_request,closed,,fix: sync translations from crowdin,,frappe-pr-bot,2024-11-17 10:10:13+00:00,[],2024-12-03 00:13:23+00:00,2024-11-18 04:27:42+00:00,https://github.com/frappe/erpnext/pull/44170,"[('translation', None)]",[],
2665606792,pull_request,closed,,chore: update POT file,,frappe-pr-bot,2024-11-17 09:36:28+00:00,[],2024-12-03 00:13:25+00:00,2024-11-17 14:06:37+00:00,https://github.com/frappe/erpnext/pull/44169,[],[],
2661737256,pull_request,closed,,feat: inventory dimension for rejected materials (backport #44156),"Provision to Select the rejected rack (inventory dimension)

<img width=""942"" alt=""Screenshot 2024-11-15 at 10 33 01 AM"" src=""https://github.com/user-attachments/assets/67820687-002b-43b5-b905-7a750c98ad98"">

#No-docs
<hr>This is an automatic backport of pull request #44156 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 11:34:42+00:00,['rohitwaghchaure'],2024-11-30 00:11:31+00:00,2024-11-15 11:58:41+00:00,https://github.com/frappe/erpnext/pull/44165,"[('stock', None)]",[],
2661468554,pull_request,closed,,fix: sync translations from crowdin,,frappe-pr-bot,2024-11-15 09:54:35+00:00,[],2024-12-03 00:13:37+00:00,2024-11-16 11:24:02+00:00,https://github.com/frappe/erpnext/pull/44164,"[('translation', None)]",[],
2661131623,pull_request,closed,,feat: Show Aggregate Value from Subsidiary Companies,"Issue: Unable to see child company data in sales analytics.

Solution: Added a checkbox to show aggregate value from subsidiary companies.

Ref: [24250](https://support.frappe.io/helpdesk/tickets/24250)


![Screenshot from 2024-11-15 13-07-58](https://github.com/user-attachments/assets/cd0706a9-23da-4ba6-8d77-3e26dbef991d)

![Screenshot from 2024-11-15 13-15-22](https://github.com/user-attachments/assets/1f412904-5236-4d94-b42c-8d38b17917df)


Backport needed: Version-15
",l0gesh29,2024-11-15 07:46:47+00:00,['ruthra-kumar'],2024-12-10 00:12:33+00:00,2024-11-25 06:38:47+00:00,https://github.com/frappe/erpnext/pull/44163,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]","[{'comment_id': 2496155501, 'issue_id': 2661131623, 'author': 'Vigneshsekar', 'body': 'Resolves https://github.com/frappe/erpnext/issues/44096', 'created_at': datetime.datetime(2024, 11, 24, 18, 23, 36, tzinfo=datetime.timezone.utc)}]","Vigneshsekar on (2024-11-24 18:23:36 UTC): Resolves https://github.com/frappe/erpnext/issues/44096

"
2661051124,pull_request,closed,,fix: Get Entries not showing accounts with no gain or loss in Exchange Rate Revaluation issue fixed (backport #43414),"### Issue:
`Get Entries`  in Exchange Rate Revaluation is not fetching those entries where gain/loss is zero. User may want to set a different exchange rate manually.

![image](https://github.com/user-attachments/assets/befe19ce-1fe6-4abf-ab50-bf04ae55c8d3)

### Fix: 
Remove the condition `if_gain_loss` from `calculate_new_account_balance` method and instead remove the rows with zero gain/loss in `before_submit`. 

![image](https://github.com/user-attachments/assets/bc225323-870d-4d9a-b4ae-c155fff32db2)

<hr>This is an automatic backport of pull request #43414 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 07:19:25+00:00,[],2024-11-30 00:11:35+00:00,2024-11-15 07:39:45+00:00,https://github.com/frappe/erpnext/pull/44162,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2661050333,pull_request,closed,,fix: Get Entries not showing accounts with no gain or loss in Exchange Rate Revaluation issue fixed (backport #43414),"### Issue:
`Get Entries`  in Exchange Rate Revaluation is not fetching those entries where gain/loss is zero. User may want to set a different exchange rate manually.

![image](https://github.com/user-attachments/assets/befe19ce-1fe6-4abf-ab50-bf04ae55c8d3)

### Fix: 
Remove the condition `if_gain_loss` from `calculate_new_account_balance` method and instead remove the rows with zero gain/loss in `before_submit`. 

![image](https://github.com/user-attachments/assets/bc225323-870d-4d9a-b4ae-c155fff32db2)

<hr>This is an automatic backport of pull request #43414 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 07:18:51+00:00,[],2024-12-05 00:12:25+00:00,2024-11-15 07:39:35+00:00,https://github.com/frappe/erpnext/pull/44161,"[('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2487896154, 'issue_id': 2661050333, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 30, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:30 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2661006519,pull_request,closed,,fix: broken UI on currency exchange (backport #44158),"<img width=""1416"" alt=""Screenshot 2024-11-15 at 12 15 43 PM"" src=""https://github.com/user-attachments/assets/1f90b81a-f60a-4db8-8bbb-0a5ea6ba1ee3"">

- Remove use of cscript
- Make use of `frm.trigger()`
<hr>This is an automatic backport of pull request #44158 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 06:52:48+00:00,['ruthra-kumar'],2024-11-30 00:11:37+00:00,2024-11-15 06:59:32+00:00,https://github.com/frappe/erpnext/pull/44160,[],[],
2661006001,pull_request,closed,,fix: broken UI on currency exchange (backport #44158),"<img width=""1416"" alt=""Screenshot 2024-11-15 at 12 15 43 PM"" src=""https://github.com/user-attachments/assets/1f90b81a-f60a-4db8-8bbb-0a5ea6ba1ee3"">

- Remove use of cscript
- Make use of `frm.trigger()`
<hr>This is an automatic backport of pull request #44158 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 06:52:43+00:00,['ruthra-kumar'],2024-12-05 00:12:24+00:00,2024-11-15 06:58:18+00:00,https://github.com/frappe/erpnext/pull/44159,"[('released', None)]","[{'comment_id': 2487896260, 'issue_id': 2661006001, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 33, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:33 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2660970093,pull_request,closed,,fix: broken UI on currency exchange,"<img width=""1416"" alt=""Screenshot 2024-11-15 at 12 15 43 PM"" src=""https://github.com/user-attachments/assets/1f90b81a-f60a-4db8-8bbb-0a5ea6ba1ee3"">

- Remove use of cscript
- Make use of `frm.trigger()`
",ruthra-kumar,2024-11-15 06:47:04+00:00,[],2024-11-30 00:11:38+00:00,2024-11-15 06:51:12+00:00,https://github.com/frappe/erpnext/pull/44158,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2660879623,pull_request,closed,,"fix: apply ""cannot_add_rows"" directly to table field for more efficient solution","### Problem:
The initial fix in PR #44148 to disable the ""Add Row"" button was not the most efficient approach.

### Solution:
This update applies the `cannot_add_rows` property directly to the allocations table field, offering a cleaner and more efficient solution. It works the same as expected as in PR #44148 but with a more efficient code structure.
",UmakanthKaspa,2024-11-15 06:03:56+00:00,['ruthra-kumar'],2024-12-03 00:13:22+00:00,2024-11-18 04:34:38+00:00,https://github.com/frappe/erpnext/pull/44157,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]","[{'comment_id': 2478531382, 'issue_id': 2660879623, 'author': 'ruthra-kumar', 'body': ""@UmakanthKaspa \r\n\r\nCould've made this change directly on the original PR"", 'created_at': datetime.datetime(2024, 11, 15, 10, 42, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2480380541, 'issue_id': 2660879623, 'author': 'UmakanthKaspa', 'body': ""> @UmakanthKaspa\r\n> \r\n> Could've made this change directly on the original PR\r\n\r\nThe original PR was already merged, so I created this new one."", 'created_at': datetime.datetime(2024, 11, 16, 3, 56, 32, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Assginee) on (2024-11-15 10:42:15 UTC): @UmakanthKaspa 

Could've made this change directly on the original PR

UmakanthKaspa (Issue Creator) on (2024-11-16 03:56:32 UTC): The original PR was already merged, so I created this new one.

"
2660751283,pull_request,closed,,feat: inventory dimension for rejected materials,"Provision to Select the rejected rack (inventory dimension)

<img width=""942"" alt=""Screenshot 2024-11-15 at 10 33 01 AM"" src=""https://github.com/user-attachments/assets/67820687-002b-43b5-b905-7a750c98ad98"">

#No-docs
",rohitwaghchaure,2024-11-15 05:04:11+00:00,[],2024-11-30 00:11:32+00:00,2024-11-15 11:33:22+00:00,https://github.com/frappe/erpnext/pull/44156,"[('stock', None), ('backport version-15-hotfix', '')]",[],
2660747168,pull_request,closed,,fix: apply posting date sorting to invoices in Payment Reconciliation similar to payments (backport #44089),"### Summary
In the Payment Reconciliation tool, payment entries are ordered by their posting date, but the invoice entries were not. 
This update adds sorting for invoice entries by their posting date in the `get_invoice_entries` function. The sorting of invoices is now aligned with the sorting applied to payments, ensuring consistency and improving the reconciliation process.

### Changes
 Updated `get_invoice_entries` function to sort `non_reconciled_invoices` by `posting_date`, similar to the sorting applied in `get_nonreconciled_payment_entries` to sort payments.

### Screenshots
#### Before Sorting
![image](https://github.com/user-attachments/assets/ff40bad6-f2a1-4941-9abd-67be9a486fad)
#### After Sorting
![image](https://github.com/user-attachments/assets/98f00fb5-0588-479a-9886-3bcf588e8975)<hr>This is an automatic backport of pull request #44089 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 05:00:11+00:00,[],2024-11-30 00:11:39+00:00,2024-11-15 05:19:13+00:00,https://github.com/frappe/erpnext/pull/44155,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2660747091,pull_request,closed,,fix: apply posting date sorting to invoices in Payment Reconciliation similar to payments (backport #44089),"### Summary
In the Payment Reconciliation tool, payment entries are ordered by their posting date, but the invoice entries were not. 
This update adds sorting for invoice entries by their posting date in the `get_invoice_entries` function. The sorting of invoices is now aligned with the sorting applied to payments, ensuring consistency and improving the reconciliation process.

### Changes
 Updated `get_invoice_entries` function to sort `non_reconciled_invoices` by `posting_date`, similar to the sorting applied in `get_nonreconciled_payment_entries` to sort payments.

### Screenshots
#### Before Sorting
![image](https://github.com/user-attachments/assets/ff40bad6-f2a1-4941-9abd-67be9a486fad)
#### After Sorting
![image](https://github.com/user-attachments/assets/98f00fb5-0588-479a-9886-3bcf588e8975)<hr>This is an automatic backport of pull request #44089 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 05:00:07+00:00,[],2024-12-05 00:12:23+00:00,2024-11-15 05:24:40+00:00,https://github.com/frappe/erpnext/pull/44154,"[('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2487896392, 'issue_id': 2660747091, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 36, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:36 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2660732100,pull_request,closed,,"Fix: Disable ""Add Row"" button in allocations table during UnReconcile process (backport #44148)","### Problem:
In the UnReconcile Allocations dialog, the `cannot_add_rows` property was incorrectly applied to the dialog itself, which did not prevent users from adding rows to the allocations table.

### Solution:
The `cannot_add_rows` property has been moved and correctly applied to the allocations table field to disable the ""Add Row"" button, ensuring users cannot add new rows while reconciling
### Before:
![image](https://github.com/user-attachments/assets/c7147691-a21f-4929-9e5b-0ec67585e0c1)

### After:
![image](https://github.com/user-attachments/assets/6e19c536-90d2-4169-8abf-f6a97c37a9d8)<hr>This is an automatic backport of pull request #44148 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 04:47:55+00:00,[],2024-11-30 00:11:41+00:00,2024-11-15 04:54:16+00:00,https://github.com/frappe/erpnext/pull/44153,[],[],
2660731994,pull_request,closed,,"Fix: Disable ""Add Row"" button in allocations table during UnReconcile process (backport #44148)","### Problem:
In the UnReconcile Allocations dialog, the `cannot_add_rows` property was incorrectly applied to the dialog itself, which did not prevent users from adding rows to the allocations table.

### Solution:
The `cannot_add_rows` property has been moved and correctly applied to the allocations table field to disable the ""Add Row"" button, ensuring users cannot add new rows while reconciling
### Before:
![image](https://github.com/user-attachments/assets/c7147691-a21f-4929-9e5b-0ec67585e0c1)

### After:
![image](https://github.com/user-attachments/assets/6e19c536-90d2-4169-8abf-f6a97c37a9d8)<hr>This is an automatic backport of pull request #44148 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 04:47:48+00:00,[],2024-12-05 00:12:22+00:00,2024-11-15 04:52:43+00:00,https://github.com/frappe/erpnext/pull/44152,"[('released', None)]","[{'comment_id': 2487896513, 'issue_id': 2660731994, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 39, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:39 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2660687831,pull_request,closed,,fix: validation for serial no (backport #44133),<hr>This is an automatic backport of pull request #44133 done by [Mergify](https://mergify.com).,mergify[bot],2024-11-15 04:36:59+00:00,['rohitwaghchaure'],2024-11-30 00:11:33+00:00,2024-11-15 11:25:32+00:00,https://github.com/frappe/erpnext/pull/44151,[],"[{'comment_id': 2477945144, 'issue_id': 2660687831, 'author': 'mergify[bot]', 'body': 'Cherry-pick of 93c8b4c39af90f9b60da7476855281a22bca0ffc has failed:\n```\nOn branch mergify/bp/version-15-hotfix/pr-44133\nYour branch is up to date with \'origin/version-15-hotfix\'.\n\nYou are currently cherry-picking commit 93c8b4c39a.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tmodified:   erpnext/stock/doctype/serial_and_batch_bundle/serial_and_batch_bundle.py\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/stock/doctype/stock_entry/test_stock_entry.py\n\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 11, 15, 4, 37, 1, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-11-15 04:37:01 UTC): Cherry-pick of 93c8b4c39af90f9b60da7476855281a22bca0ffc has failed:
```
On branch mergify/bp/version-15-hotfix/pr-44133
Your branch is up to date with 'origin/version-15-hotfix'.

You are currently cherry-picking commit 93c8b4c39a.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	modified:   erpnext/stock/doctype/serial_and_batch_bundle/serial_and_batch_bundle.py

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/stock/doctype/stock_entry/test_stock_entry.py

```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2660686728,pull_request,closed,,fix: stock ledger variance report filter options (backport #44137),"- Better options name for the ""Difference In"" filter
- Do not consider the fifo_value_diff / fifo_qty_diff if stock queue is blank<hr>This is an automatic backport of pull request #44137 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 04:35:52+00:00,['rohitwaghchaure'],2024-11-30 00:11:34+00:00,2024-11-15 09:34:48+00:00,https://github.com/frappe/erpnext/pull/44150,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2660686529,pull_request,closed,,fix: stock ledger variance report filter options (backport #44137),"- Better options name for the ""Difference In"" filter
- Do not consider the fifo_value_diff / fifo_qty_diff if stock queue is blank<hr>This is an automatic backport of pull request #44137 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-15 04:35:40+00:00,['rohitwaghchaure'],2024-12-05 00:12:26+00:00,2024-11-15 09:35:03+00:00,https://github.com/frappe/erpnext/pull/44149,"[('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2487896051, 'issue_id': 2660686529, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 27, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:27 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2659083005,pull_request,closed,,"Fix: Disable ""Add Row"" button in allocations table during UnReconcile process","### Problem:
In the UnReconcile Allocations dialog, the `cannot_add_rows` property was incorrectly applied to the dialog itself, which did not prevent users from adding rows to the allocations table.

### Solution:
The `cannot_add_rows` property has been moved and correctly applied to the allocations table field to disable the ""Add Row"" button, ensuring users cannot add new rows while reconciling
### Before:
![image](https://github.com/user-attachments/assets/c7147691-a21f-4929-9e5b-0ec67585e0c1)

### After:
![image](https://github.com/user-attachments/assets/6e19c536-90d2-4169-8abf-f6a97c37a9d8)",UmakanthKaspa,2024-11-14 14:54:01+00:00,['ruthra-kumar'],2024-11-30 00:11:42+00:00,2024-11-15 04:46:37+00:00,https://github.com/frappe/erpnext/pull/44148,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2658615162,pull_request,closed,,fix: set conversion factor before applying price list,"Issue: https://support.frappe.io/helpdesk/tickets/24358

Issue: The Rate is not updated when UOM is changed

https://github.com/user-attachments/assets/cfcc0abb-089c-43c5-97e7-54f3e07dbefc

After the fix:


https://github.com/user-attachments/assets/e5866641-bc1a-4011-8969-ac345d92ffee




",vishakhdesai,2024-11-14 12:02:38+00:00,['ruthra-kumar'],2024-12-03 00:13:21+00:00,2024-11-18 04:37:52+00:00,https://github.com/frappe/erpnext/pull/44147,"[('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2658425419,pull_request,closed,,"fix: updated label ""Is short year"" to ""Is Short/Long year"" for both short and long fiscal years","Is short/long year.

FY can be short or long here in Nepal.

FY starts in July every year, but date can be 15/16/17 which varies every year.
Also FY end date can be different.

For ex. any of this is possible:
1. Start : 07-16 End: 07-15
2. Start : 07-16 End: 07-16 -> probably long year
3. Start : 07-16 End: 07-14
4. Start : 07-15 End: 07-16 -> long year

Same goes for other dates. 

The `Is short year` check mark seems to work good for long years as well. So, decided to update the text label to avoid confusion.",ajiragroup,2024-11-14 10:50:11+00:00,['ruthra-kumar'],2024-12-04 00:12:19+00:00,2024-11-19 08:55:37+00:00,https://github.com/frappe/erpnext/pull/44145,"[('backport version-15-hotfix', '')]",[],
2658109927,pull_request,closed,,fix: sync translations from crowdin,,frappe-pr-bot,2024-11-14 09:02:39+00:00,[],2024-11-30 00:11:45+00:00,2024-11-15 00:49:44+00:00,https://github.com/frappe/erpnext/pull/44142,"[('translation', None)]",[],
2657944582,pull_request,closed,,fix: broken apply on other item (backport #43189),"Fix below scenario from https://github.com/frappe/erpnext/issues/42195

|-|Apply On|Value|Apply Rule on Other | Value|
|-|-|-|-|-|
|1| Item Code| _Item 1_ | Item Code| _Item 2_|<hr>This is an automatic backport of pull request #43189 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-14 07:54:16+00:00,['ruthra-kumar'],2024-11-30 00:11:47+00:00,2024-11-14 08:15:30+00:00,https://github.com/frappe/erpnext/pull/44140,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2657944406,pull_request,closed,,fix: broken apply on other item (backport #43189),"Fix below scenario from https://github.com/frappe/erpnext/issues/42195

|-|Apply On|Value|Apply Rule on Other | Value|
|-|-|-|-|-|
|1| Item Code| _Item 1_ | Item Code| _Item 2_|<hr>This is an automatic backport of pull request #43189 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-14 07:54:11+00:00,['ruthra-kumar'],2024-12-05 00:12:21+00:00,2024-11-14 08:15:41+00:00,https://github.com/frappe/erpnext/pull/44139,"[('needs-tests', 'This PR needs automated unit-tests.'), ('released', None)]","[{'comment_id': 2487896618, 'issue_id': 2657944406, 'author': 'frappe-pr-bot', 'body': ':tada: This PR is included in version 14.77.0 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 11, 20, 8, 38, 42, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-11-20 08:38:42 UTC): :tada: This PR is included in version 14.77.0 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.77.0)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2657852179,pull_request,closed,,fix: bulk update invoice remarks during site upgrade (copy #43651),"Upgrade to v15.35 onwards fails in site migration step : Executing erpnext.patches.v15_0.update_invoice_remarks

Fixes issue https://github.com/frappe/erpnext/issues/43634<hr>This is an automatic copy of pull request #43651 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-14 07:19:20+00:00,[],2024-11-30 00:11:49+00:00,2024-11-14 07:45:10+00:00,https://github.com/frappe/erpnext/pull/44138,"[('needs-tests', 'This PR needs automated unit-tests.')]",[],
2657838798,pull_request,closed,,fix: stock ledger variance report filter options,"- Better options name for the ""Difference In"" filter
- Do not consider the fifo_value_diff / fifo_qty_diff if stock queue is blank",rohitwaghchaure,2024-11-14 07:10:42+00:00,[],2024-11-30 00:11:44+00:00,2024-11-15 04:34:37+00:00,https://github.com/frappe/erpnext/pull/44137,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-14-hotfix', 'backport to version 14'), ('backport version-15-hotfix', '')]",[],
2657824544,pull_request,closed,,refactor: separate round off account for opening (backport #42588),"## Issue:
Rounding Entries are unavoidable in high precision Sales / Purchase Invoices that post opening entries. As the default Round off account is of type Profit and Loss, such Invoices is currently not possible to be submitted.

## Solution
A separate Round Off account just for opening entries could help address this issue. This account will be under Liability.

<details>

<summary>Abandoned tasks</summary>

Tasks:
- [x] ~~patch to update existing companies~~
- [x] ~~add round off for all templates in verified and unverified directory~~

</details>

## Alternate approach
Abandoning above approach of updating templates and creating account automatically.

System will not auto-create any accounts. Instead,
- Company master will have new account provision `round_off_for_opening`, which is not mandatory
- New `account_type` - `Round Off for Opening` - is introduced
- User has to manually create an account of above type and set it in company master


ToDo:
- [x] Test cases for Sales Invoice, with and without inclusive tax
- [x] Test case for Purchase Invoice


Internal Ref: [18968](https://support.frappe.io/helpdesk/tickets/18968)
fixes: https://github.com/frappe/erpnext/issues/42376<hr>This is an automatic backport of pull request #42588 done by [Mergify](https://mergify.com).",mergify[bot],2024-11-14 07:01:56+00:00,['ruthra-kumar'],2024-11-30 00:11:50+00:00,2024-11-14 07:34:13+00:00,https://github.com/frappe/erpnext/pull/44136,"[('accounts', '')]","[{'comment_id': 2475563665, 'issue_id': 2657824544, 'author': 'mergify[bot]', 'body': 'Cherry-pick of 88e68168e36624d9ec31993c8f7a9b29add8c1ce has failed:\n```\nOn branch mergify/bp/version-15-hotfix/pr-42588\nYour branch is ahead of \'origin/version-15-hotfix\' by 1 commit.\n  (use ""git push"" to publish your local commits)\n\nYou are currently cherry-picking commit 88e68168e3.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\tmodified:   erpnext/accounts/doctype/account/account.json\n\tmodified:   erpnext/accounts/doctype/account/account.py\n\tmodified:   erpnext/accounts/doctype/purchase_invoice/purchase_invoice.py\n\tmodified:   erpnext/accounts/doctype/sales_invoice/sales_invoice.py\n\tmodified:   erpnext/controllers/accounts_controller.py\n\tmodified:   erpnext/setup/doctype/company/company.js\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/accounts/general_ledger.py\n\n```\n\n\nCherry-pick of 5021c7ca2c3bb5f758d00c65eab1dcfec692d2a4 has failed:\n```\nOn branch mergify/bp/version-15-hotfix/pr-42588\nYour branch is ahead of \'origin/version-15-hotfix\' by 4 commits.\n  (use ""git push"" to publish your local commits)\n\nYou are currently cherry-picking commit 5021c7ca2c.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/accounts/doctype/sales_invoice/test_sales_invoice.py\n\nno changes added to commit (use ""git add"" and/or ""git commit -a"")\n```\n\n\nCherry-pick of b7edc6dea908b887041998801a3d7724fc8777f1 has failed:\n```\nOn branch mergify/bp/version-15-hotfix/pr-42588\nYour branch is ahead of \'origin/version-15-hotfix\' by 8 commits.\n  (use ""git push"" to publish your local commits)\n\nYou are currently cherry-picking commit b7edc6dea9.\n  (fix conflicts and run ""git cherry-pick --continue"")\n  (use ""git cherry-pick --skip"" to skip this patch)\n  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use ""git add <file>..."" to mark resolution)\n\tboth modified:   erpnext/accounts/doctype/purchase_invoice/test_purchase_invoice.py\n\nno changes added to commit (use ""git add"" and/or ""git commit -a"")\n```\n\n\nTo fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally', 'created_at': datetime.datetime(2024, 11, 14, 7, 1, 58, tzinfo=datetime.timezone.utc)}]","mergify[bot] (Issue Creator) on (2024-11-14 07:01:58 UTC): Cherry-pick of 88e68168e36624d9ec31993c8f7a9b29add8c1ce has failed:
```
On branch mergify/bp/version-15-hotfix/pr-42588
Your branch is ahead of 'origin/version-15-hotfix' by 1 commit.
  (use ""git push"" to publish your local commits)

You are currently cherry-picking commit 88e68168e3.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Changes to be committed:
	modified:   erpnext/accounts/doctype/account/account.json
	modified:   erpnext/accounts/doctype/account/account.py
	modified:   erpnext/accounts/doctype/purchase_invoice/purchase_invoice.py
	modified:   erpnext/accounts/doctype/sales_invoice/sales_invoice.py
	modified:   erpnext/controllers/accounts_controller.py
	modified:   erpnext/setup/doctype/company/company.js

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/accounts/general_ledger.py

```


Cherry-pick of 5021c7ca2c3bb5f758d00c65eab1dcfec692d2a4 has failed:
```
On branch mergify/bp/version-15-hotfix/pr-42588
Your branch is ahead of 'origin/version-15-hotfix' by 4 commits.
  (use ""git push"" to publish your local commits)

You are currently cherry-picking commit 5021c7ca2c.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/accounts/doctype/sales_invoice/test_sales_invoice.py

no changes added to commit (use ""git add"" and/or ""git commit -a"")
```


Cherry-pick of b7edc6dea908b887041998801a3d7724fc8777f1 has failed:
```
On branch mergify/bp/version-15-hotfix/pr-42588
Your branch is ahead of 'origin/version-15-hotfix' by 8 commits.
  (use ""git push"" to publish your local commits)

You are currently cherry-picking commit b7edc6dea9.
  (fix conflicts and run ""git cherry-pick --continue"")
  (use ""git cherry-pick --skip"" to skip this patch)
  (use ""git cherry-pick --abort"" to cancel the cherry-pick operation)

Unmerged paths:
  (use ""git add <file>..."" to mark resolution)
	both modified:   erpnext/accounts/doctype/purchase_invoice/test_purchase_invoice.py

no changes added to commit (use ""git add"" and/or ""git commit -a"")
```


To fix up this pull request, you can check it out locally. See documentation: https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/checking-out-pull-requests-locally

"
2657694577,pull_request,closed,,fix: set debit in transaction currency in GL Entry,"**Issue:**   When a multi-currency payment transaction is made, the debit value in the transaction currency is not being updated in the GL Entry posted against that payment.

**ref:** [25193](https://support.frappe.io/helpdesk/tickets/25193)

**Before:**
![gl_entry_before_fix](https://github.com/user-attachments/assets/5a61dcb6-895e-4fe7-b070-fce9b7097a3e)

**After:**
![gl_entry_after_fix](https://github.com/user-attachments/assets/b1575a5e-e547-415f-b268-01bfee3ba45d)


Backport needed: v15",sudarsan2001,2024-11-14 05:56:19+00:00,['ruthra-kumar'],2024-12-04 00:12:31+00:00,2024-11-18 11:42:00+00:00,https://github.com/frappe/erpnext/pull/44134,"[('backport version-15-hotfix', '')]","[{'comment_id': 2482689983, 'issue_id': 2657694577, 'author': 'ruthra-kumar', 'body': 'This change updates the base currency debit and credit values on the transaction fields, which defeats the purpose of those fields. Especially on a foreign currency transaction.\r\n\r\nFor a similar situation in a multi-currency journal entry, where there are 2 different foreign currency accounts and a base currency account, the transaction fields will auto-assume currency of the first non-base currency account. https://github.com/frappe/erpnext/blob/2ada270e780bba3efafa074ab62f4239195a2455/erpnext/accounts/doctype/journal_entry/journal_entry.py#L1063-L1068\r\n\r\nEx: A Journal with account accounts will assume transaction currency as EUR\r\n\r\n|Account|Debit|Credit|Exchange Rate|\r\n|-|-|-|-|\r\n|EUR account|10|0|90|\r\n|USD account|10|0|80\r\n|Sales|0|1700|1|\r\n\r\n\r\nA similar approach can be used here as well.', 'created_at': datetime.datetime(2024, 11, 18, 10, 56, 58, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Assginee) on (2024-11-18 10:56:58 UTC): This change updates the base currency debit and credit values on the transaction fields, which defeats the purpose of those fields. Especially on a foreign currency transaction.

For a similar situation in a multi-currency journal entry, where there are 2 different foreign currency accounts and a base currency account, the transaction fields will auto-assume currency of the first non-base currency account. https://github.com/frappe/erpnext/blob/2ada270e780bba3efafa074ab62f4239195a2455/erpnext/accounts/doctype/journal_entry/journal_entry.py#L1063-L1068

Ex: A Journal with account accounts will assume transaction currency as EUR

|Account|Debit|Credit|Exchange Rate|
|-|-|-|-|
|EUR account|10|0|90|
|USD account|10|0|80
|Sales|0|1700|1|


A similar approach can be used here as well.

"
2657595279,pull_request,closed,,fix: validation for serial no,,rohitwaghchaure,2024-11-14 05:04:21+00:00,[],2024-11-30 00:11:43+00:00,2024-11-15 04:35:00+00:00,https://github.com/frappe/erpnext/pull/44133,"[('needs-tests', 'This PR needs automated unit-tests.'), ('backport version-15-hotfix', '')]",[],
2657263341,pull_request,closed,,chore: trigger ci,,ruthra-kumar,2024-11-14 01:39:08+00:00,['ruthra-kumar'],2025-01-28 09:25:04+00:00,2024-11-14 02:03:56+00:00,https://github.com/frappe/erpnext/pull/44132,"[('dont-merge', None)]",[],
2655347129,pull_request,closed,,fix: update per_billed value in Purchase Receipt while creating Debit Note,"v14 backport for #43977 

Added Partly Billed status in Purchase Receipt",Navin-S-R,2024-11-13 12:39:27+00:00,[],2024-11-30 00:12:11+00:00,2024-11-13 12:46:13+00:00,https://github.com/frappe/erpnext/pull/44129,[],"[{'comment_id': 2473520808, 'issue_id': 2655347129, 'author': 'Navin-S-R', 'body': '#44128 Solves this', 'created_at': datetime.datetime(2024, 11, 13, 12, 46, 13, tzinfo=datetime.timezone.utc)}]","Navin-S-R (Issue Creator) on (2024-11-13 12:46:13 UTC): #44128 Solves this

"
