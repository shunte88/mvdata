id,type,state,state_reason,title,body,author,created_at,assignees,updated_at,closed_at,url,labels,comments_list,comment_thread
2779913206,issue,open,, Margin is getting Updated on change of Currency Exchange Rate,"### Information about bug

When the user creates a sales invoice from a sales order, the item Rate of the Sales Invoice Item updates when the Currency Exchange Rate Changes, for items that had a Price List Rate on the Sales Order

To reproduce the issue follow the below steps:

1. Create items and add item prices to each item (either manually or through the Auto Insert Check box on the Stock Settings)

2. While creating a sales order, for example, if the item ""iPhone 15"" has an item price of 100 USD, but the user enters the price as 105 (Margin Amount = 5 USD, since Item Price is 100 USD), and for other items, the price remains the same, then user submits the sales order.

3. The user creates a Sales Invoice from a Sales Order by clicking on Create > Sales Invoice.

4. Before saving the sales invoice, the exchange rate does not update automatically (by default it takes the exchange rate from the sales order). To update the exchange rate, the user must first save the document and then either change the date or change the exchange rate manually on the Sales Invoice

5. The main issue arises when the appropriate exchange rate is fetched. At this point, the item rates are also updated (because the Margin Amount is being converted for Multi-Currency, please note the Document is in USD, and the Company currency is INR). 


However, the item rates need to remain the same as they were in the sales order and the Rates are finalized in USD with the customer at the time of Sales Order creation.



### Module

accounts

### Version

Frappe: Version-15
ERPNext: Version-15

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",venkat102,2025-01-10 11:04:30+00:00,[],2025-01-10 11:06:30+00:00,,https://github.com/frappe/erpnext/issues/45210,"[('bug', None)]",[],
2778503569,issue,open,,Exchange Rate Revaluation throws error for account Stock In Hand,"### Information about bug

I am trying to post an Exchange Rate Revaluation entry since there's a difference between the amounts in company currency and the account currency. 

![image](https://github.com/user-attachments/assets/5f37b22a-567b-4fd2-a624-458f8ad4eab8)

When I am trying to create a Journal Entry, it throws an error: ""Account: Stock In Hand - ATPL can only be updated via Stock Transactions""

![image](https://github.com/user-attachments/assets/570bf942-7ffe-4230-a0b0-2ed2f3bb81fe)

We don't use any Stock accounts/features in the system, so it's weird that this shows up.

The site is hosted on Frappe Cloud.

### Module

accounts

### Version

Frappe: v15.51.2
ERPNext: v15.48.1
India Compliance: v15.14.7
Frappe HR: v15.37.2

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

```shell
{
    ""exception"": ""erpnext.accounts.doctype.journal_entry.journal_entry.StockAccountInvalidTransaction: Account: Stock In Hand - ATPL can only be updated via Stock Transactions"",
    ""exc_type"": ""StockAccountInvalidTransaction"",
    ""_exc_source"": ""erpnext (app)"",
    ""exc"": ""[\""Traceback (most recent call last):\\n  File \\\""apps/frappe/frappe/app.py\\\"", line 114, in application\\n    response = frappe.api.handle(request)\\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/api/__init__.py\\\"", line 49, in handle\\n    data = endpoint(**arguments)\\n           ^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/api/v1.py\\\"", line 36, in handle_rpc_call\\n    return frappe.handler.handle()\\n           ^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/handler.py\\\"", line 50, in handle\\n    data = execute_cmd(cmd)\\n           ^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/handler.py\\\"", line 86, in execute_cmd\\n    return frappe.call(method, **frappe.form_dict)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/__init__.py\\\"", line 1726, in call\\n    return fn(*args, **newargs)\\n           ^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/handler.py\\\"", line 332, in run_doc_method\\n    response = doc.run_method(method)\\n               ^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 974, in run_method\\n    out = Document.hook(fn)(self, *args, **kwargs)\\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 1334, in composer\\n    return composed(self, method, *args, **kwargs)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 1316, in runner\\n    add_to_return_value(self, fn(self, *args, **kwargs))\\n                              ^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 971, in fn\\n    return method_object(*args, **kwargs)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/utils/typing_validations.py\\\"", line 31, in wrapper\\n    return func(*args, **kwargs)\\n           ^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/erpnext/erpnext/accounts/doctype/exchange_rate_revaluation/exchange_rate_revaluation.py\\\"", line 344, in make_jv_entries\\n    zero_balance_jv = self.make_jv_for_zero_balance()\\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/erpnext/erpnext/accounts/doctype/exchange_rate_revaluation/exchange_rate_revaluation.py\\\"", line 469, in make_jv_for_zero_balance\\n    journal_entry.save()\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 342, in save\\n    return self._save(*args, **kwargs)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 364, in _save\\n    return self.insert()\\n           ^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 295, in insert\\n    self.run_before_save_methods()\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 1103, in run_before_save_methods\\n    self.run_method(\\\""validate\\\"")\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 974, in run_method\\n    out = Document.hook(fn)(self, *args, **kwargs)\\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 1334, in composer\\n    return composed(self, method, *args, **kwargs)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 1316, in runner\\n    add_to_return_value(self, fn(self, *args, **kwargs))\\n                              ^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/frappe/frappe/model/document.py\\\"", line 971, in fn\\n    return method_object(*args, **kwargs)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\\""apps/erpnext/erpnext/accounts/doctype/journal_entry/journal_entry.py\\\"", line 133, in validate\\n    self.validate_stock_accounts()\\n  File \\\""apps/erpnext/erpnext/accounts/doctype/journal_entry/journal_entry.py\\\"", line 274, in validate_stock_accounts\\n    frappe.throw(\\n  File \\\""apps/frappe/frappe/__init__.py\\\"", line 603, in throw\\n    msgprint(\\n  File \\\""apps/frappe/frappe/__init__.py\\\"", line 568, in msgprint\\n    _raise_exception()\\n  File \\\""apps/frappe/frappe/__init__.py\\\"", line 519, in _raise_exception\\n    raise exc\\nerpnext.accounts.doctype.journal_entry.journal_entry.StockAccountInvalidTransaction: Account: Stock In Hand - ATPL can only be updated via Stock Transactions\\n\""]"",
    ""_server_messages"": ""[\""{\\\""message\\\"": \\\""Account: Stock In Hand - ATPL can only be updated via Stock Transactions\\\"", \\\""title\\\"": \\\""Message\\\"", \\\""indicator\\\"": \\\""red\\\"", \\\""raise_exception\\\"": 1, \\\""__frappe_exc_id\\\"": \\\""c24673ab5a18fe289a3e97caf70a658c8ad496d255452a1924ad2495\\\""}\""]""
}
```
",nikkothari22,2025-01-09 18:26:23+00:00,[],2025-01-09 19:00:44+00:00,,https://github.com/frappe/erpnext/issues/45201,"[('bug', None)]","[{'comment_id': 2581038738, 'issue_id': 2778503569, 'author': 'nikkothari22', 'body': 'Okay, so on further investigation, I found that the Journal Entry that\'s being created doesn\'t have any accounts at all.\r\n\r\n<details>\r\n<summary>\r\nJE trying to be created (used a server script to print this as an error):\r\n</summary>\r\n\r\n```json\r\n\r\n{""name"": ""ACC-JV-2025-00010"", ""owner"": ""nikhil.kothari@thecommit.company"", ""creation"": ""2025-01-10 00:08:41.796753"", ""modified"": ""2025-01-10 00:08:41.796753"", ""modified_by"": ""nikhil.kothari@thecommit.company"", ""docstatus"": 0, ""idx"": 0, ""is_system_generated"": 0, ""title"": null, ""voucher_type"": ""Exchange Gain Or Loss"", ""ineligibility_reason"": ""As per rules 42 & 43 of CGST Rules"", ""naming_series"": ""ACC-JV-.YYYY.-"", ""finance_book"": null, ""process_deferred_accounting"": null, ""reversal_of"": null, ""tax_withholding_category"": null, ""from_template"": null, ""company"": ""Algocode Technologies Private Limited"", ""company_gstin"": null, ""posting_date"": ""2024-04-01"", ""apply_tds"": 0, ""cheque_no"": null, ""cheque_date"": null, ""user_remark"": null, ""total_debit"": 0.0, ""total_credit"": 0.0, ""difference"": 0.0, ""multi_currency"": 1, ""total_amount_currency"": null, ""total_amount"": 0.0, ""total_amount_in_words"": null, ""clearance_date"": null, ""remark"": null, ""paid_loan"": null, ""inter_company_journal_entry_reference"": null, ""bill_no"": null, ""bill_date"": null, ""due_date"": null, ""write_off_based_on"": ""Accounts Receivable"", ""write_off_amount"": 0.0, ""pay_to_recd_from"": null, ""letter_head"": ""Default Letterhead"", ""select_print_heading"": null, ""mode_of_payment"": null, ""payment_order"": null, ""is_opening"": ""No"", ""stock_entry"": null, ""auto_repeat"": null, ""amended_from"": null, ""doctype"": ""Journal Entry"", ""accounts"": [], ""__islocal"": true, ""__unsaved"": 1}\r\n\r\n```\r\n\r\n</details>\r\n\r\nI looked at the code and it looks like the reason why that is is because in my Exchange Rate Revaluation:\r\n\r\n1. `balance_in_account_currency` and `new_balance_in_account_currency` are the same  - this is fine.\r\n2. `balance_in_base_currency` is different from `new_balance_in_base_currency` - but none of them are zero - and hence this [condition](https://github.com/frappe/erpnext/blob/6e01a9b84d2e0e8538b6dda5dbcadba65d9e65e4/erpnext/accounts/doctype/exchange_rate_revaluation/exchange_rate_revaluation.py#L435) fails.\r\n\r\nAm I using the Exchange Rate Revaluation voucher wrong? What I am trying to achieve is that on our system, the account ""Debtors-USD"" has zero balance in USD, but the Balance Sheet still shows a Debit of Rs. 4347.50 (in INR)\r\n\r\nI summed up the ""GL Entry"" table for this account and found the following:\r\n\r\nSum of Debit Amount in Account Currency (USD): 469500\r\nSum of Credit Amount in Account Currency (USD): 469500\r\n\r\nSum of Debit Amount in Company Currency: 39177247.5\r\nSum of Credit Amount in Company Currency: 39172900 \r\n\r\nHence the difference in USD is 0 (debits and credits match - which is correct since we do not have any receivable against this account), but in INR it\'s 4,347.50. I am not sure how we ended up here but this balance was brought over from the previous year\'s accounts which are now closed :/\r\n\r\nEdit: I decided to try creating a Revaluation voucher with the posting date set to today (hence the `new_balance_in_base_currency` variable would be 0) and it worked. In my earlier example, I was using a posting date in the past where there was a difference but none of the balances were 0. However, should it not also work even if none of the balances are zero?', 'created_at': datetime.datetime(2025, 1, 9, 18, 55, 55, tzinfo=datetime.timezone.utc)}]","nikkothari22 (Issue Creator) on (2025-01-09 18:55:55 UTC): Okay, so on further investigation, I found that the Journal Entry that's being created doesn't have any accounts at all.

<details>
<summary>
JE trying to be created (used a server script to print this as an error):
</summary>

```json

{""name"": ""ACC-JV-2025-00010"", ""owner"": ""nikhil.kothari@thecommit.company"", ""creation"": ""2025-01-10 00:08:41.796753"", ""modified"": ""2025-01-10 00:08:41.796753"", ""modified_by"": ""nikhil.kothari@thecommit.company"", ""docstatus"": 0, ""idx"": 0, ""is_system_generated"": 0, ""title"": null, ""voucher_type"": ""Exchange Gain Or Loss"", ""ineligibility_reason"": ""As per rules 42 & 43 of CGST Rules"", ""naming_series"": ""ACC-JV-.YYYY.-"", ""finance_book"": null, ""process_deferred_accounting"": null, ""reversal_of"": null, ""tax_withholding_category"": null, ""from_template"": null, ""company"": ""Algocode Technologies Private Limited"", ""company_gstin"": null, ""posting_date"": ""2024-04-01"", ""apply_tds"": 0, ""cheque_no"": null, ""cheque_date"": null, ""user_remark"": null, ""total_debit"": 0.0, ""total_credit"": 0.0, ""difference"": 0.0, ""multi_currency"": 1, ""total_amount_currency"": null, ""total_amount"": 0.0, ""total_amount_in_words"": null, ""clearance_date"": null, ""remark"": null, ""paid_loan"": null, ""inter_company_journal_entry_reference"": null, ""bill_no"": null, ""bill_date"": null, ""due_date"": null, ""write_off_based_on"": ""Accounts Receivable"", ""write_off_amount"": 0.0, ""pay_to_recd_from"": null, ""letter_head"": ""Default Letterhead"", ""select_print_heading"": null, ""mode_of_payment"": null, ""payment_order"": null, ""is_opening"": ""No"", ""stock_entry"": null, ""auto_repeat"": null, ""amended_from"": null, ""doctype"": ""Journal Entry"", ""accounts"": [], ""__islocal"": true, ""__unsaved"": 1}

```

</details>

I looked at the code and it looks like the reason why that is is because in my Exchange Rate Revaluation:

1. `balance_in_account_currency` and `new_balance_in_account_currency` are the same  - this is fine.
2. `balance_in_base_currency` is different from `new_balance_in_base_currency` - but none of them are zero - and hence this [condition](https://github.com/frappe/erpnext/blob/6e01a9b84d2e0e8538b6dda5dbcadba65d9e65e4/erpnext/accounts/doctype/exchange_rate_revaluation/exchange_rate_revaluation.py#L435) fails.

Am I using the Exchange Rate Revaluation voucher wrong? What I am trying to achieve is that on our system, the account ""Debtors-USD"" has zero balance in USD, but the Balance Sheet still shows a Debit of Rs. 4347.50 (in INR)

I summed up the ""GL Entry"" table for this account and found the following:

Sum of Debit Amount in Account Currency (USD): 469500
Sum of Credit Amount in Account Currency (USD): 469500

Sum of Debit Amount in Company Currency: 39177247.5
Sum of Credit Amount in Company Currency: 39172900 

Hence the difference in USD is 0 (debits and credits match - which is correct since we do not have any receivable against this account), but in INR it's 4,347.50. I am not sure how we ended up here but this balance was brought over from the previous year's accounts which are now closed :/

Edit: I decided to try creating a Revaluation voucher with the posting date set to today (hence the `new_balance_in_base_currency` variable would be 0) and it worked. In my earlier example, I was using a posting date in the past where there was a difference but none of the balances were 0. However, should it not also work even if none of the balances are zero?

"
2777981965,issue,open,,Cannot assign multiple Bank Accounts to a Company Account,"### Information about bug

Accounting only allows one Bank Account to be assigned to a Company Account. Even if the account is disabled, the system still asks the Company Account field to be empty and the relevant check box unchecked and this Bank Account to be Saved.
![20241206111456](https://github.com/user-attachments/assets/6a4c047d-2373-45ec-8915-5d0690b1bbfc)
![20241206113438](https://github.com/user-attachments/assets/0d087f14-b33d-4404-8a8e-92c8b9e56c07)


### Module

accounts

### Version

ERPNext: v15.35.1 (version-15)
Frappe Framework: v15.40.6 (version-15)

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",lcese,2025-01-09 14:24:45+00:00,[],2025-01-10 00:15:38+00:00,,https://github.com/frappe/erpnext/issues/45198,"[('bug', None), ('needs-screenshots', '')]","[{'comment_id': 2580659077, 'issue_id': 2777981965, 'author': 'mihir-kandoi', 'body': 'Please provide screenshots in English.', 'created_at': datetime.datetime(2025, 1, 9, 16, 3, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2581487935, 'issue_id': 2777981965, 'author': 'lcese', 'body': '![微信截图_20250110081520](https://github.com/user-attachments/assets/bb0e3f92-ac87-40a6-8012-fd197a0553cb)\r\n\r\nPlease use another subject', 'created_at': datetime.datetime(2025, 1, 10, 0, 14, 58, tzinfo=datetime.timezone.utc)}]","mihir-kandoi on (2025-01-09 16:03:56 UTC): Please provide screenshots in English.

lcese (Issue Creator) on (2025-01-10 00:14:58 UTC): ![微信截图_20250110081520](https://github.com/user-attachments/assets/bb0e3f92-ac87-40a6-8012-fd197a0553cb)

Please use another subject

"
2777500723,issue,closed,completed,"pymysql.err.OperationalError: (1052, ""Column 'sales_invoice_item' in field list is ambiguous"")..........Ambiguous column error while creating Sales Return ","### Information about bug

pymysql.err.OperationalError: (1052, ""Column 'sales_invoice_item' in field list is ambiguous"")
Possible source of error: erpnext (app)

### Module

selling

### Version

ERPNext Version-15

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

```shell
### App Versions

{
	""convergenix_app"": ""0.0.2"",
	""custom_login_15"": ""0.0.1"",
	""database_console"": ""0.0.1"",
	""erpnext"": ""15.48.0"",
	""frappe"": ""15.51.2"",
	""hrms"": ""15.37.2"",
	""nextapp"": ""0.0.1"",
	""spectrum"": ""0.0.1""
}
```
### Route
```
Form/Sales Invoice/new-sales-invoice-zrllrmeajp
```
### Traceback
```
Traceback (most recent call last):
  File ""apps/frappe/frappe/app.py"", line 114, in application
    response = frappe.api.handle(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/__init__.py"", line 49, in handle
    data = endpoint(**arguments)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/v1.py"", line 36, in handle_rpc_call
    return frappe.handler.handle()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 50, in handle
    data = execute_cmd(cmd)
           ^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 86, in execute_cmd
    return frappe.call(method, **frappe.form_dict)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/__init__.py"", line 1726, in call
    return fn(*args, **newargs)
           ^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/utils/typing_validations.py"", line 31, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/desk/form/save.py"", line 39, in savedocs
    doc.save()
  File ""apps/frappe/frappe/model/document.py"", line 342, in save
    return self._save(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 364, in _save
    return self.insert()
           ^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 295, in insert
    self.run_before_save_methods()
  File ""apps/frappe/frappe/model/document.py"", line 1103, in run_before_save_methods
    self.run_method(""validate"")
  File ""apps/frappe/frappe/model/document.py"", line 974, in run_method
    out = Document.hook(fn)(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1334, in composer
    return composed(self, method, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1316, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 971, in fn
    return method_object(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/erpnext/erpnext/accounts/doctype/sales_invoice/sales_invoice.py"", line 266, in validate
    super().validate()
  File ""apps/erpnext/erpnext/controllers/selling_controller.py"", line 35, in validate
    super().validate()
  File ""apps/erpnext/erpnext/controllers/stock_controller.py"", line 52, in validate
    super().validate()
  File ""apps/erpnext/erpnext/controllers/accounts_controller.py"", line 203, in validate
    validate_return(self)
  File ""apps/erpnext/erpnext/controllers/sales_and_purchase_return.py"", line 31, in validate_return
    validate_returned_items(doc)
  File ""apps/erpnext/erpnext/controllers/sales_and_purchase_return.py"", line 102, in validate_returned_items
    already_returned_items = get_already_returned_items(doc)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/erpnext/erpnext/controllers/sales_and_purchase_return.py"", line 260, in get_already_returned_items
    data = frappe.db.sql(
           ^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/database/database.py"", line 230, in sql
    self._cursor.execute(query, values)
  File ""env/lib/python3.11/site-packages/pymysql/cursors.py"", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File ""env/lib/python3.11/site-packages/pymysql/cursors.py"", line 322, in _query
    conn.query(q)
  File ""env/lib/python3.11/site-packages/pymysql/connections.py"", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""env/lib/python3.11/site-packages/pymysql/connections.py"", line 825, in _read_query_result
    result.read()
  File ""env/lib/python3.11/site-packages/pymysql/connections.py"", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""env/lib/python3.11/site-packages/pymysql/connections.py"", line 775, in _read_packet
    packet.raise_for_error()
  File ""env/lib/python3.11/site-packages/pymysql/protocol.py"", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File ""env/lib/python3.11/site-packages/pymysql/err.py"", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1052, ""Column 'sales_invoice_item' in field list is ambiguous"")

```
### Request Data
```
{
	""type"": ""POST"",
	""args"": {
		""doc"": ""{\""owner\"":\""support@convergenix.ng\"",\""docstatus\"":0,\""idx\"":8,\""naming_series\"":\""SBL-SINV-IBD-.YYYY.-\"",\""customer\"":\""ANGLICAN HIGH SCHOOL, ABEOKUTA\"",\""customer_name\"":\""ANGLICAN HIGH SCHOOL, ABEOKUTA\"",\""walk_in_customer_name\"":\""ANGLICAN HIGH SCHOOL, ABEOKUTA\"",\""company\"":\""Spectrum Books Limited\"",\""posting_date\"":\""2025-01-09\"",\""posting_time\"":\""11:48:38.116868\"",\""set_posting_time\"":0,\""is_pos\"":0,\""posa_is_printed\"":0,\""is_consolidated\"":0,\""is_return\"":1,\""return_against\"":\""SBL-SINV-IBD-2024-00355\"",\""update_outstanding_for_self\"":1,\""update_billed_amount_in_sales_order\"":0,\""update_billed_amount_in_delivery_note\"":1,\""is_debit_note\"":0,\""currency\"":\""NGN\"",\""conversion_rate\"":1,\""selling_price_list\"":\""Standard Selling\"",\""price_list_currency\"":\""NGN\"",\""plc_conversion_rate\"":1,\""ignore_pricing_rule\"":1,\""update_stock\"":1,\""set_warehouse\"":\""\"",\""total_qty\"":-20,\""total_net_weight\"":0,\""base_total\"":-90000,\""base_net_total\"":-90000,\""total\"":-90000,\""net_total\"":-90000,\""base_total_taxes_and_charges\"":0,\""total_taxes_and_charges\"":0,\""base_grand_total\"":-90000,\""base_rounding_adjustment\"":0,\""base_rounded_total\"":0,\""base_in_words\"":\""\"",\""grand_total\"":-90000,\""rounding_adjustment\"":0,\""use_company_roundoff_cost_center\"":0,\""rounded_total\"":0,\""in_words\"":\""\"",\""total_advance\"":0,\""outstanding_amount\"":0,\""disable_rounded_total\"":1,\""apply_discount_on\"":\""Grand Total\"",\""base_discount_amount\"":0,\""is_cash_or_non_trade_discount\"":0,\""additional_discount_percentage\"":0,\""discount_amount\"":0,\""total_billing_hours\"":0,\""total_billing_amount\"":0,\""base_paid_amount\"":0,\""paid_amount\"":0,\""base_change_amount\"":0,\""change_amount\"":0,\""allocate_advances_automatically\"":0,\""only_include_allocated_payments\"":0,\""write_off_amount\"":0,\""base_write_off_amount\"":0,\""write_off_outstanding_amount_automatically\"":0,\""redeem_loyalty_points\"":0,\""loyalty_points\"":0,\""loyalty_amount\"":0,\""customer_address\"":\""ANGLICAN HIGH SCHOOL, ABEOKUTA-Billing\"",\""address_display\"":\""Bishop's Court, Onikobo<br>Abeokuta<br>\\nNigeria<br>\\n\"",\""contact_person\"":\""Reverend banjo\"",\""contact_display\"":\""Reverend Banjo\"",\""territory\"":\""Ogun\"",\""ignore_default_payment_terms_template\"":1,\""tc_name\"":\""Lagos & Ondo & Ibadan Bank Account Details\"",\""terms\"":\""<div class=\\\""ql-editor read-mode\\\""><p>Payment <strong><u>ONLY</u></strong> by Cheque, Transfer or Cash Deposit to <strong>SPECTRUM BOOKS</strong> accounts as stated below; Always Call Customer Service for confirmation.</p><p><strong>Account Name: Spectrum Books Limited</strong></p><p><strong>Account Number and Bank: </strong></p><ul><li data-list=\\\""bullet\\\""><span class=\\\""ql-ui\\\"" contenteditable=\\\""false\\\""></span><strong>UBA - 1015252901</strong></li><li data-list=\\\""bullet\\\""><span class=\\\""ql-ui\\\"" contenteditable=\\\""false\\\""></span><strong>GTB - 0173168012</strong></li><li data-list=\\\""bullet\\\""><span class=\\\""ql-ui\\\"" contenteditable=\\\""false\\\""></span><strong>Access - 0005317236</strong></li></ul><h3><strong>NOTE: </strong><em>Payment to an Individual or another account(s) is at the <u>RISK</u> of the Customer</em></h3></div>\"",\""debit_to\"":\""100105 - Trade Debtors - SBL\"",\""is_opening\"":\""No\"",\""sales_order\"":\""SBL-SORD-IBD-2024-00082\"",\""amount_eligible_for_commission\"":-90000,\""commission_rate\"":0,\""total_commission\"":0,\""letter_head\"":\""Default\"",\""group_same_items\"":0,\""select_print_heading\"":\""Credit Note\"",\""language\"":\""en\"",\""note\"":\""Discount Applicable ONLY on Payment.\"",\""status\"":\""Draft\"",\""customer_group\"":\""Commercial\"",\""is_internal_customer\"":0,\""is_discounted\"":0,\""posa_delivery_charges_rate\"":0,\""doctype\"":\""Sales Invoice\"",\""timesheets\"":[],\""pricing_rules\"":[],\""advances\"":[],\""sales_team\"":[{\""owner\"":\""support@convergenix.ng\"",\""docstatus\"":0,\""idx\"":1,\""sales_person\"":\""Ayobami Adewunmi\"",\""allocated_percentage\"":100,\""allocated_amount\"":-552000,\""incentives\"":0,\""parentfield\"":\""sales_team\"",\""parenttype\"":\""Sales Invoice\"",\""doctype\"":\""Sales Team\"",\""__islocal\"":1,\""__unsaved\"":1,\""parent\"":\""new-sales-invoice-zrllrmeajp\"",\""name\"":\""new-sales-team-esbqlnlire\""}],\""payments\"":[],\""items\"":[{\""owner\"":\""support@convergenix.ng\"",\""docstatus\"":0,\""idx\"":1,\""has_item_scanned\"":0,\""item_code\"":\""9789789260683\"",\""item_name\"":\""S.H.S English For JSS1 Textbook\"",\""description\"":\""S.H.S English For JSS1 Textbook\"",\""item_group\"":\""Regular Publications\"",\""qty\"":-20,\""stock_uom\"":\""Copies\"",\""uom\"":\""Copies\"",\""conversion_factor\"":1,\""stock_qty\"":-20,\""price_list_rate\"":4500,\""base_price_list_rate\"":4500,\""margin_type\"":\""\"",\""margin_rate_or_amount\"":0,\""rate_with_margin\"":0,\""discount_percentage\"":0,\""discount_amount\"":0,\""base_rate_with_margin\"":0,\""rate\"":4500,\""amount\"":-90000,\""base_rate\"":4500,\""base_amount\"":-90000,\""posa_offer_applied\"":0,\""posa_is_offer\"":0,\""stock_uom_rate\"":0,\""is_free_item\"":0,\""grant_commission\"":1,\""net_rate\"":4500,\""net_amount\"":-90000,\""base_net_rate\"":4500,\""base_net_amount\"":-90000,\""delivered_by_supplier\"":0,\""income_account\"":\""495615 - Reps Sales - SBL\"",\""is_fixed_asset\"":0,\""expense_account\"":\""501000 - Cost_of_Sales_Regular Publications - SBL\"",\""enable_deferred_revenue\"":0,\""weight_per_unit\"":0,\""total_weight\"":0,\""warehouse\"":\""Ibadan Depot - SBL\"",\""use_serial_batch_fields\"":0,\""allow_zero_valuation_rate\"":0,\""incoming_rate\"":0,\""item_tax_rate\"":\""{}\"",\""actual_batch_qty\"":0,\""actual_qty\"":0,\""company_total_stock\"":0,\""sales_order\"":\""SBL-SORD-IBD-2024-00082\"",\""so_detail\"":\""8n4749subr\"",\""sales_invoice_item\"":\""10bn4r7ohr\"",\""delivered_qty\"":0,\""cost_center\"":\""Main - SBL\"",\""page_break\"":0,\""parentfield\"":\""items\"",\""parenttype\"":\""Sales Invoice\"",\""doctype\"":\""Sales Invoice Item\"",\""__islocal\"":1,\""__unsaved\"":1,\""parent\"":\""new-sales-invoice-zrllrmeajp\"",\""name\"":\""new-sales-invoice-item-tpjdtyoxbd\""}],\""royalties_detail\"":[{\""owner\"":\""support@convergenix.ng\"",\""docstatus\"":0,\""idx\"":1,\""supplier_royalties\"":\""MR. AYO  AKANO\"",\""royalties\"":12144,\""parentfield\"":\""royalties_detail\"",\""parenttype\"":\""Sales Invoice\"",\""doctype\"":\""Sales Invoice Royalties\"",\""__islocal\"":1,\""__unsaved\"":1,\""parent\"":\""new-sales-invoice-zrllrmeajp\"",\""name\"":\""new-sales-invoice-royalties-baofshnbbg\""},{\""owner\"":\""support@convergenix.ng\"",\""docstatus\"":0,\""idx\"":2,\""supplier_royalties\"":\""MRS KOLAPO ARINLADE\"",\""royalties\"":9936,\""parentfield\"":\""royalties_detail\"",\""parenttype\"":\""Sales Invoice\"",\""doctype\"":\""Sales Invoice Royalties\"",\""__islocal\"":1,\""__unsaved\"":1,\""parent\"":\""new-sales-invoice-zrllrmeajp\"",\""name\"":\""new-sales-invoice-royalties-bwcsoymrai\""},{\""owner\"":\""support@convergenix.ng\"",\""docstatus\"":0,\""idx\"":3,\""supplier_royalties\"":\""DR.NGOZI ODINKO\"",\""royalties\"":9936,\""parentfield\"":\""royalties_detail\"",\""parenttype\"":\""Sales Invoice\"",\""doctype\"":\""Sales Invoice Royalties\"",\""__islocal\"":1,\""__unsaved\"":1,\""parent\"":\""new-sales-invoice-zrllrmeajp\"",\""name\"":\""new-sales-invoice-royalties-xvarscfein\""},{\""owner\"":\""support@convergenix.ng\"",\""docstatus\"":0,\""idx\"":4,\""supplier_royalties\"":\""MR. MOKONJU OLUMI\"",\""royalties\"":12144,\""parentfield\"":\""royalties_detail\"",\""parenttype\"":\""Sales Invoice\"",\""doctype\"":\""Sales Invoice Royalties\"",\""__islocal\"":1,\""__unsaved\"":1,\""parent\"":\""new-sales-invoice-zrllrmeajp\"",\""name\"":\""new-sales-invoice-royalties-urtymvuexd\""},{\""owner\"":\""support@convergenix.ng\"",\""docstatus\"":0,\""idx\"":5,\""supplier_royalties\"":\""DR. UZOMA I. NWACHUKWU\"",\""royalties\"":11040,\""parentfield\"":\""royalties_detail\"",\""parenttype\"":\""Sales Invoice\"",\""doctype\"":\""Sales Invoice Royalties\"",\""__islocal\"":1,\""__unsaved\"":1,\""parent\"":\""new-sales-invoice-zrllrmeajp\"",\""name\"":\""new-sales-invoice-royalties-sjrsjtdjyd\""}],\""payment_schedule\"":[{\""owner\"":\""support@convergenix.ng\"",\""docstatus\"":0,\""idx\"":1,\""payment_term\"":\""30 Days\"",\""due_date\"":\""2024-08-31\"",\""invoice_portion\"":100,\""discount_type\"":\""Percentage\"",\""discount\"":0,\""payment_amount\"":-552000,\""outstanding\"":81120,\""paid_amount\"":470880,\""discounted_amount\"":0,\""base_payment_amount\"":552000,\""parentfield\"":\""payment_schedule\"",\""parenttype\"":\""Sales Invoice\"",\""doctype\"":\""Payment Schedule\"",\""__islocal\"":1,\""__unsaved\"":1,\""parent\"":\""new-sales-invoice-zrllrmeajp\"",\""name\"":\""new-payment-schedule-qcmuskehqh\""}],\""taxes\"":[],\""packed_items\"":[],\""__islocal\"":1,\""__onload\"":{\""load_after_mapping\"":true},\""__unsaved\"":1,\""name\"":\""new-sales-invoice-zrllrmeajp\"",\""__last_sync_on\"":\""2025-01-09T10:48:38.521Z\"",\""company_address\"":\""\"",\""company_address_display\"":\""\"",\""delivery_note\"":\""\""}"",
		""action"": ""Save""
	},
	""btn"": {
		""jQuery3700262749637577330831"": {
			""events"": {
				""click"": [
					{
						""type"": ""click"",
						""origType"": ""click"",
						""guid"": 5246,
						""namespace"": """"
					}
				]
			}
		}
	},
	""freeze"": true,
	""headers"": {},
	""error_handlers"": {},
	""url"": ""/api/method/frappe.desk.form.save.savedocs"",
	""request_id"": null
}
```
### Response Data
```
{
	""exception"": ""pymysql.err.OperationalError: (1052, \""Column 'sales_invoice_item' in field list is ambiguous\"")"",
	""exc_type"": ""OperationalError"",
	""_exc_source"": ""erpnext (app)""
}
```
```
",Montego-arch,2025-01-09 10:58:12+00:00,[],2025-02-01 00:11:14+00:00,2025-01-15 10:02:14+00:00,https://github.com/frappe/erpnext/issues/45194,"[('bug', None), ('need-more-info', 'Provide additional context, steps to reproduce this issue.')]","[{'comment_id': 2579963659, 'issue_id': 2777500723, 'author': 'mihir-kandoi', 'body': 'Please provide replication steps.', 'created_at': datetime.datetime(2025, 1, 9, 11, 51, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2586505082, 'issue_id': 2777500723, 'author': 'Montego-arch', 'body': 'When trying to create sales returns, I get this error message \r\n**""pymysql.err.OperationalError: (1052, ""Column \'sales_invoice_item\' in field list is ambiguous"")\r\nPossible source of error: erpnext (app)""**', 'created_at': datetime.datetime(2025, 1, 13, 8, 43, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2586507157, 'issue_id': 2777500723, 'author': 'Montego-arch', 'body': '![image](https://github.com/user-attachments/assets/6755bb4a-6ef7-4df8-9fb8-a15a453c86da)', 'created_at': datetime.datetime(2025, 1, 13, 8, 44, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2592188465, 'issue_id': 2777500723, 'author': 'nabinhait', 'body': 'Seems like you have added a custom field ""sales_invoice_item"" in the parent form as well, which is causing the error. Anyway, I have sent a fix to handle it.', 'created_at': datetime.datetime(2025, 1, 15, 10, 2, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2598350107, 'issue_id': 2777500723, 'author': 'Montego-arch', 'body': ""I checked the Sales Invoice fields but there's no field name sales_invoice_item, so I don't know where that came from\nAnyways,  Thank you so much"", 'created_at': datetime.datetime(2025, 1, 17, 13, 17, 13, tzinfo=datetime.timezone.utc)}]","mihir-kandoi on (2025-01-09 11:51:12 UTC): Please provide replication steps.

Montego-arch (Issue Creator) on (2025-01-13 08:43:26 UTC): When trying to create sales returns, I get this error message 
**""pymysql.err.OperationalError: (1052, ""Column 'sales_invoice_item' in field list is ambiguous"")
Possible source of error: erpnext (app)""**

Montego-arch (Issue Creator) on (2025-01-13 08:44:33 UTC): ![image](https://github.com/user-attachments/assets/6755bb4a-6ef7-4df8-9fb8-a15a453c86da)

nabinhait on (2025-01-15 10:02:14 UTC): Seems like you have added a custom field ""sales_invoice_item"" in the parent form as well, which is causing the error. Anyway, I have sent a fix to handle it.

Montego-arch (Issue Creator) on (2025-01-17 13:17:13 UTC): I checked the Sales Invoice fields but there's no field name sales_invoice_item, so I don't know where that came from
Anyways,  Thank you so much

"
2777472524,issue,closed,not_planned,Qty difference between Stock Balance and Stock Ledger Reports,"### Information about bug

We are seeing differences in Qty for multiple items between the stock balance and ledger reports

I have made sure that all the repost item valuation jobs have been completed, still facing the issue.

Using the latest v15 version.

I am feeling mostly this is happening with Batch items. This is a production environment and affecting us really badly.

Example for one of the items.
![image](https://github.com/user-attachments/assets/70bc35a3-b312-4dab-9c1e-6f153e2392a3)

![image](https://github.com/user-attachments/assets/cb1650ef-539c-4fa0-8f4b-4f767cb857ec)


One more issue we see is, if we click on the segragate checkmark on the Stock ledger for batches, the numbers are again displaying something else entirely.
![image](https://github.com/user-attachments/assets/aa718555-f2a8-46ed-9a00-0d25cbb4cda4)



### Module

stock, buying

### Version

ERPNext: v15.47.5 (version-15)
Frappe Framework: v15.51.1 (version-15)

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",moizsami,2025-01-09 10:47:23+00:00,['mihir-kandoi'],2025-02-03 00:10:36+00:00,2025-01-19 10:17:55+00:00,https://github.com/frappe/erpnext/issues/45191,"[('bug', None)]","[{'comment_id': 2579967272, 'issue_id': 2777472524, 'author': 'mihir-kandoi', 'body': 'Can you try setting the `to` and `from` date filters to the same value for both the reports and try again?', 'created_at': datetime.datetime(2025, 1, 9, 11, 53, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2579989167, 'issue_id': 2777472524, 'author': 'moizsami', 'body': '![image](https://github.com/user-attachments/assets/cee95a35-787d-4d33-896a-d433ab92e4d8)\r\n@mihir-kandoi  I have shared the stock ledger screenshot same as stock balance now\r\n\r\nand the segragated enabled option also\r\n![image](https://github.com/user-attachments/assets/ae923d85-f6c3-484e-8885-51467d5cffe1)', 'created_at': datetime.datetime(2025, 1, 9, 12, 3, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2580092348, 'issue_id': 2777472524, 'author': 'mihir-kandoi', 'body': ""I'll have a word with more experienced folks regarding this issue but I have to say, this is a very rare bug.\n\nI am pretty sure without access to your site through Frappe Cloud, we probably won't be able to assist you as it is next to impossible to replicate this issue on our machines.\n\nIf you are a Frappe Cloud customer, I'd highly recommend opening a support ticket."", 'created_at': datetime.datetime(2025, 1, 9, 12, 57, 49, tzinfo=datetime.timezone.utc)}, {'comment_id': 2580096375, 'issue_id': 2777472524, 'author': 'moizsami', 'body': 'Unfortunately I am not on the frappe cloud, this is a self hosted environment. But I am willing to share any details or credentials if required.', 'created_at': datetime.datetime(2025, 1, 9, 12, 59, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2580122414, 'issue_id': 2777472524, 'author': 'mihir-kandoi', 'body': ""Since ERPs contain sensitive business data, I am not permitted to access user sites outside of Frappe Cloud.\n\nMaybe with the relevant permission and some free time I might be able to help you but I can't make any guarantee or give you a time frame whatsoever.\n\nOn a different note: it seems like we're missing something here. Stock Balance is a crucial report. We have lots of users/customers using ERPNext for a long time. If there was something wrong with it we would have come to know very quickly."", 'created_at': datetime.datetime(2025, 1, 9, 13, 12, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2580134201, 'issue_id': 2777472524, 'author': 'moizsami', 'body': 'I understand, thanks for your input. if we reach to no solution I will see if we could shift temporarily to frappe cloud just for this issue resolution.\r\n\r\nWe are using ERPNext since v12, I am also seeing this issue for the first time. Some things which I think might be causing this:\r\n- New way of Serial and batch handling: our users still have not completely understood how it works as many of times different types of error comes espceially while using it in Subcontracting module\r\n- Subcontracting: this also has been updated and has been made a bit more complicated than before\r\n- Creating past dated entries: its a common practice in this site to do past dated entries, Although there are no pending reposting valuation entries but this might be affecting the report.\r\n\r\n Note; we have done some minor tweaking in Subcontracting module to make it easier for the users..thats it.', 'created_at': datetime.datetime(2025, 1, 9, 13, 18, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2580148523, 'issue_id': 2777472524, 'author': 'mihir-kandoi', 'body': 'Thank you for understanding.\n\nAs someone who primarily works on the Subcontracting module, I implore you to open GitHub issues regarding them. We will try to solve it.', 'created_at': datetime.datetime(2025, 1, 9, 13, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2585113281, 'issue_id': 2777472524, 'author': 'saivineeth100', 'body': 'I just calculated what is shown in stock ledger and balance is calculated wrongly at 13 and 16 dec\r\n\r\n![image](https://github.com/user-attachments/assets/3ec893f7-81ea-4c86-9a4d-c94dd6282039)\r\n\r\n| In Qty   | Out Qty    | Balance (manual) | Balance … | Diff      |\r\n|----------|------------|------------------|-----------|-----------|\r\n| 0        | 0          | 0                | 0         | 0         |\r\n| 7,184.00 | 0          | 7,184.00         | 7,184.00  | 0         |\r\n| 0        | -3,916.00  | 3,268.00        | 3,268.00  | 0         |\r\n| 0        | -3,268.00  | 0.00             | 304         | -304      |\r\n| 4,977.00 | 0          | 4,977.00         | 5,281.00  | -304      |\r\n| 4,016.00 | 0          | 8,993.00         | 9,297.00  | -304      |\r\n| 0        | -4,977.00  | 4,016.00        | 4,320.00  | -304      |\r\n| 0        | -4,017.00  | -1.00           | 652.913  | -653.913   |', 'created_at': datetime.datetime(2025, 1, 11, 6, 12, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2585142153, 'issue_id': 2777472524, 'author': 'moizsami', 'body': 'Thanks for the input @saivineeth100 \r\n\r\n@mihir-kandoi I digged down a bit more and I think i can see what is happening.\r\n\r\nFor some reason, while creating Subcontracting Receipt, when I update the consumed qty in Supplied raw material table, it does not update the Serial and Batch qty. I am sharing screenshots below\r\n\r\nConsumed Qty is FG+Waste: 2964+304 = 3268\r\n\r\n![image](https://github.com/user-attachments/assets/11ae0e2f-c8ab-4f90-9918-9e73bbc5fe08)\r\n\r\nThe detailed Serial and batch record\r\n![image](https://github.com/user-attachments/assets/0b7941ff-1f4c-48fb-84ce-9f33479e694a)\r\n\r\n![image](https://github.com/user-attachments/assets/701a3f7b-f85c-4ab0-8839-1217d3f7f92a)', 'created_at': datetime.datetime(2025, 1, 11, 8, 13, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2592066771, 'issue_id': 2777472524, 'author': 'mihir-kandoi', 'body': '@moizsami are you manually updating the Consumed Qty for the Raw Materials while creating the Subcontracting Receipt?', 'created_at': datetime.datetime(2025, 1, 15, 9, 16, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2592083266, 'issue_id': 2777472524, 'author': 'moizsami', 'body': '> [@moizsami](https://github.com/moizsami) are you manually updating the Consumed Qty for the Raw Materials while creating the Subcontracting Receipt?\n\nYes, because system doesnt add up the Waste qty. As you can see we receive waste + FG, so we want the consumed to be total of waste + FG, thats why we manually write it and here we had done some scripting that it auto calculates and update the qty.\n\nI need your input also if possible, isnt this how it is suppose to be ? my raw material was fully consumed but some of it was returned as waste. so shouldnt the consumed be total of FG+Waste ?', 'created_at': datetime.datetime(2025, 1, 15, 9, 19, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2595055339, 'issue_id': 2777472524, 'author': 'mihir-kandoi', 'body': ""Have you done some customisation that would interfere with this process?\n\nPlease check the Stock Ledger Variance report if it shows something. If it does, try reposting those entries.\n\nOther than that I think we are out of options here as we are not able to replicate this.\n\nAs for your question, it is not necessary that raw materials should be FG + Waste as in some manufacturing processes the ratio between raw material and FG is not always fixed. You can set the consumed qty to anything you like given that it is lesser or equal to available qty.\n\nHowever it is worth mentioning that when we change the consumed qty of raw material and if that RM has batch/serial bundle, user should manually change the batch qty. If they don't, the system will modify the quantity of those batches on its own to match the total consumed qty which is not always correct.\n\nIn your case the serial/batch bundle is not being updated on its own."", 'created_at': datetime.datetime(2025, 1, 16, 9, 53, 7, tzinfo=datetime.timezone.utc)}, {'comment_id': 2595092183, 'issue_id': 2777472524, 'author': 'moizsami', 'body': ""> Have you done some customisation that would interfere with this process?\n> \nFrom my side I have only added the option before save to auto calculate the number and insert in consumed qty\n> Please check the Stock Ledger Variance report if it shows something. If it does, try reposting those entries.\n> \n> However it is worth mentioning that when we change the consumed qty of raw material and if that RM has batch/serial bundle, user should manually change the batch qty. If they don't, the system will modify the quantity of those batches on its own to match the total consumed qty which is not always correct.\n> \n> In your case the serial/batch bundle is not being updated on its own.\nYes exactly that's what I found that the serial and batch is not getting updated always as required.\n\nit is very difficult to ask the users to update these things (batch qty) manually as they were not doing it in older versions..\n\n\n\n\nIs there any way to disable the batch and convert the item to non batch item. I know ERP doesnt allow it, but I have no other option left here. I cannot create new item as 100s of BOM are dependant on these items."", 'created_at': datetime.datetime(2025, 1, 16, 10, 5, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2595284170, 'issue_id': 2777472524, 'author': 'mihir-kandoi', 'body': ""> From my side I have only added the option before save to auto calculate the number and insert in consumed qty\n\nThen this can be the root cause. As said before, when you change Consumed Qty it is also mandatory to change Batch Qty of each batch item. There is no way the system can know by itself how to distribute the quantity between the batches.\n\nYou cannot convert Items with batches to Non-Batch Item. The amount of reposting required would be insane and time consuming.\n\nWhat I can suggest however is to create new versions of both BOMs and Items (non-batch this time if you don't require batches for that item) and work with that.\n\nWithout knowing the exact in and outs of your masters, it's nearly impossible to help you with this as we cannot possibly replicate this."", 'created_at': datetime.datetime(2025, 1, 16, 11, 34, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2595694825, 'issue_id': 2777472524, 'author': 'moizsami', 'body': ""> Then this can be the root cause. As said before, when you change Consumed Qty it is also mandatory to change Batch Qty of each batch item. There is no way the system can know by itself how to distribute the quantity between the batches.\n> \n> You cannot convert Items with batches to Non-Batch Item. The amount of reposting required would be insane and time consuming.\n> \n> What I can suggest however is to create new versions of both BOMs and Items (non-batch this time if you don't require batches for that item) and work with that.\n> \n> Without knowing the exact in and outs of your masters, it's nearly impossible to help you with this as we cannot possibly replicate this.\n\nThank you for all the feedback, one last question, if I have an item which has only one batch (one master batch) will it then auto update the values while doing the consumption entry ?\n\nI am thinking to disable all batches of each item and keep one only active, if it will help with the process"", 'created_at': datetime.datetime(2025, 1, 16, 13, 30, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2595753619, 'issue_id': 2777472524, 'author': 'moizsami', 'body': '@mihir-kandoi \n\nCan you help me understanding what does the below highlighted option does to an entry, I tried understanding it from the documentation but still not getting it.\n\n![Image](https://github.com/user-attachments/assets/0df1adbe-ab11-4950-8d85-5f47598b7cd0)', 'created_at': datetime.datetime(2025, 1, 16, 13, 53, 9, tzinfo=datetime.timezone.utc)}, {'comment_id': 2600795854, 'issue_id': 2777472524, 'author': 'mihir-kandoi', 'body': '@moizsami \n\n1. If item has only one batch, it will still get auto updated. Same as more than one. Logically speaking, this should not cause the issue you\'re facing as distribution of quantity in this case becomes irrelevant.\n2. The option in your screenshot will update the Serial Nos and Batch value in the line item if disabled. Take a Subcontracting Receipt for example, if this option is disabled the Serial Nos and Batch No fields get updated along with the Bundle value. If not, only the Bundle value gets updated. Here is the code for it for your reference.\n\n```\nif not frappe.db.get_single_value(""Stock Settings"", ""do_not_update_serial_batch_on_creation_of_auto_bundle""):\n\tif sn_doc.has_serial_no:\n\t\tvalues_to_update[""serial_no""] = "","".join(cstr(d.serial_no) for d in sn_doc.entries)\n\telif sn_doc.has_batch_no and len(sn_doc.entries) == 1:\n\t\tvalues_to_update[""batch_no""] = sn_doc.entries[0].batch_no\n\n\tfrappe.db.set_value(self.child_doctype, self.sle.voucher_detail_no, values_to_update)\n```', 'created_at': datetime.datetime(2025, 1, 19, 10, 16, 43, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-09 11:53:05 UTC): Can you try setting the `to` and `from` date filters to the same value for both the reports and try again?

moizsami (Issue Creator) on (2025-01-09 12:03:30 UTC): ![image](https://github.com/user-attachments/assets/cee95a35-787d-4d33-896a-d433ab92e4d8)
@mihir-kandoi  I have shared the stock ledger screenshot same as stock balance now

and the segragated enabled option also
![image](https://github.com/user-attachments/assets/ae923d85-f6c3-484e-8885-51467d5cffe1)

mihir-kandoi (Assginee) on (2025-01-09 12:57:49 UTC): I'll have a word with more experienced folks regarding this issue but I have to say, this is a very rare bug.

I am pretty sure without access to your site through Frappe Cloud, we probably won't be able to assist you as it is next to impossible to replicate this issue on our machines.

If you are a Frappe Cloud customer, I'd highly recommend opening a support ticket.

moizsami (Issue Creator) on (2025-01-09 12:59:51 UTC): Unfortunately I am not on the frappe cloud, this is a self hosted environment. But I am willing to share any details or credentials if required.

mihir-kandoi (Assginee) on (2025-01-09 13:12:11 UTC): Since ERPs contain sensitive business data, I am not permitted to access user sites outside of Frappe Cloud.

Maybe with the relevant permission and some free time I might be able to help you but I can't make any guarantee or give you a time frame whatsoever.

On a different note: it seems like we're missing something here. Stock Balance is a crucial report. We have lots of users/customers using ERPNext for a long time. If there was something wrong with it we would have come to know very quickly.

moizsami (Issue Creator) on (2025-01-09 13:18:01 UTC): I understand, thanks for your input. if we reach to no solution I will see if we could shift temporarily to frappe cloud just for this issue resolution.

We are using ERPNext since v12, I am also seeing this issue for the first time. Some things which I think might be causing this:
- New way of Serial and batch handling: our users still have not completely understood how it works as many of times different types of error comes espceially while using it in Subcontracting module
- Subcontracting: this also has been updated and has been made a bit more complicated than before
- Creating past dated entries: its a common practice in this site to do past dated entries, Although there are no pending reposting valuation entries but this might be affecting the report.

 Note; we have done some minor tweaking in Subcontracting module to make it easier for the users..thats it.

mihir-kandoi (Assginee) on (2025-01-09 13:25:00 UTC): Thank you for understanding.

As someone who primarily works on the Subcontracting module, I implore you to open GitHub issues regarding them. We will try to solve it.

saivineeth100 on (2025-01-11 06:12:23 UTC): I just calculated what is shown in stock ledger and balance is calculated wrongly at 13 and 16 dec

![image](https://github.com/user-attachments/assets/3ec893f7-81ea-4c86-9a4d-c94dd6282039)

| In Qty   | Out Qty    | Balance (manual) | Balance … | Diff      |
|----------|------------|------------------|-----------|-----------|
| 0        | 0          | 0                | 0         | 0         |
| 7,184.00 | 0          | 7,184.00         | 7,184.00  | 0         |
| 0        | -3,916.00  | 3,268.00        | 3,268.00  | 0         |
| 0        | -3,268.00  | 0.00             | 304         | -304      |
| 4,977.00 | 0          | 4,977.00         | 5,281.00  | -304      |
| 4,016.00 | 0          | 8,993.00         | 9,297.00  | -304      |
| 0        | -4,977.00  | 4,016.00        | 4,320.00  | -304      |
| 0        | -4,017.00  | -1.00           | 652.913  | -653.913   |

moizsami (Issue Creator) on (2025-01-11 08:13:45 UTC): Thanks for the input @saivineeth100 

@mihir-kandoi I digged down a bit more and I think i can see what is happening.

For some reason, while creating Subcontracting Receipt, when I update the consumed qty in Supplied raw material table, it does not update the Serial and Batch qty. I am sharing screenshots below

Consumed Qty is FG+Waste: 2964+304 = 3268

![image](https://github.com/user-attachments/assets/11ae0e2f-c8ab-4f90-9918-9e73bbc5fe08)

The detailed Serial and batch record
![image](https://github.com/user-attachments/assets/0b7941ff-1f4c-48fb-84ce-9f33479e694a)

![image](https://github.com/user-attachments/assets/701a3f7b-f85c-4ab0-8839-1217d3f7f92a)

mihir-kandoi (Assginee) on (2025-01-15 09:16:51 UTC): @moizsami are you manually updating the Consumed Qty for the Raw Materials while creating the Subcontracting Receipt?

moizsami (Issue Creator) on (2025-01-15 09:19:47 UTC): Yes, because system doesnt add up the Waste qty. As you can see we receive waste + FG, so we want the consumed to be total of waste + FG, thats why we manually write it and here we had done some scripting that it auto calculates and update the qty.

I need your input also if possible, isnt this how it is suppose to be ? my raw material was fully consumed but some of it was returned as waste. so shouldnt the consumed be total of FG+Waste ?

mihir-kandoi (Assginee) on (2025-01-16 09:53:07 UTC): Have you done some customisation that would interfere with this process?

Please check the Stock Ledger Variance report if it shows something. If it does, try reposting those entries.

Other than that I think we are out of options here as we are not able to replicate this.

As for your question, it is not necessary that raw materials should be FG + Waste as in some manufacturing processes the ratio between raw material and FG is not always fixed. You can set the consumed qty to anything you like given that it is lesser or equal to available qty.

However it is worth mentioning that when we change the consumed qty of raw material and if that RM has batch/serial bundle, user should manually change the batch qty. If they don't, the system will modify the quantity of those batches on its own to match the total consumed qty which is not always correct.

In your case the serial/batch bundle is not being updated on its own.

moizsami (Issue Creator) on (2025-01-16 10:05:10 UTC): From my side I have only added the option before save to auto calculate the number and insert in consumed qty
Yes exactly that's what I found that the serial and batch is not getting updated always as required.

it is very difficult to ask the users to update these things (batch qty) manually as they were not doing it in older versions..




Is there any way to disable the batch and convert the item to non batch item. I know ERP doesnt allow it, but I have no other option left here. I cannot create new item as 100s of BOM are dependant on these items.

mihir-kandoi (Assginee) on (2025-01-16 11:34:44 UTC): Then this can be the root cause. As said before, when you change Consumed Qty it is also mandatory to change Batch Qty of each batch item. There is no way the system can know by itself how to distribute the quantity between the batches.

You cannot convert Items with batches to Non-Batch Item. The amount of reposting required would be insane and time consuming.

What I can suggest however is to create new versions of both BOMs and Items (non-batch this time if you don't require batches for that item) and work with that.

Without knowing the exact in and outs of your masters, it's nearly impossible to help you with this as we cannot possibly replicate this.

moizsami (Issue Creator) on (2025-01-16 13:30:35 UTC): Thank you for all the feedback, one last question, if I have an item which has only one batch (one master batch) will it then auto update the values while doing the consumption entry ?

I am thinking to disable all batches of each item and keep one only active, if it will help with the process

moizsami (Issue Creator) on (2025-01-16 13:53:09 UTC): @mihir-kandoi 

Can you help me understanding what does the below highlighted option does to an entry, I tried understanding it from the documentation but still not getting it.

![Image](https://github.com/user-attachments/assets/0df1adbe-ab11-4950-8d85-5f47598b7cd0)

mihir-kandoi (Assginee) on (2025-01-19 10:16:43 UTC): @moizsami 

1. If item has only one batch, it will still get auto updated. Same as more than one. Logically speaking, this should not cause the issue you're facing as distribution of quantity in this case becomes irrelevant.
2. The option in your screenshot will update the Serial Nos and Batch value in the line item if disabled. Take a Subcontracting Receipt for example, if this option is disabled the Serial Nos and Batch No fields get updated along with the Bundle value. If not, only the Bundle value gets updated. Here is the code for it for your reference.

```
if not frappe.db.get_single_value(""Stock Settings"", ""do_not_update_serial_batch_on_creation_of_auto_bundle""):
	if sn_doc.has_serial_no:
		values_to_update[""serial_no""] = "","".join(cstr(d.serial_no) for d in sn_doc.entries)
	elif sn_doc.has_batch_no and len(sn_doc.entries) == 1:
		values_to_update[""batch_no""] = sn_doc.entries[0].batch_no

	frappe.db.set_value(self.child_doctype, self.sle.voucher_detail_no, values_to_update)
```

"
2777184769,issue,open,,ClouldExtel : Issue in Asset Doctype: Incorrect Account Handling for Scrap As,"Dear Team,

Please find below the issue in the Asset doctype:

While making the entry of a scrap asset system passes a system-generated JV and in that JV system hits two accounts: one is Accumulated Depreciation - NSPL and the other is Gain/Loss on Asset Disposal - NSPL which is incorrect.

According to the rules system should only hit one account which is the Accumulated Depreciation - NSPL account and Gain/Loss on Asset Disposal - NSPL should not be included in the transaction.

The whole amount should be debited only to Accumulated Depreciation - NSPL.

You can verify the issue by passing the entry.


![image](https://github.com/user-attachments/assets/290f9b55-efdc-4366-bf02-2d26c92b9392)
![image](https://github.com/user-attachments/assets/513876fc-fed7-4350-9f0b-b71a68309284)



Regards,
Deepak Singh",Deepakjs5665,2025-01-09 08:42:53+00:00,"['nabinhait', 'khushi8112']",2025-01-31 10:13:34+00:00,,https://github.com/frappe/erpnext/issues/45181,"[('feature-request', None)]","[{'comment_id': 2621449605, 'issue_id': 2777184769, 'author': 'Deepakjs5665', 'body': 'Dear Team,\n\nAny update on this? By what date can we expect these changes to be implemented in the instance?\n\n\n\n\n**Regards,\nDeepak Singh**', 'created_at': datetime.datetime(2025, 1, 29, 12, 0, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2626837488, 'issue_id': 2777184769, 'author': 'nabinhait', 'body': 'If we don\'t post an entry against ""Gain/Loss on Asset Disposal - NSPL"", how the pending depreciation amount will be booked as expenses? Even we scrap an item, the entire purchase amount is an expense for the company.', 'created_at': datetime.datetime(2025, 1, 31, 10, 13, 16, tzinfo=datetime.timezone.utc)}]","Deepakjs5665 (Issue Creator) on (2025-01-29 12:00:36 UTC): Dear Team,

Any update on this? By what date can we expect these changes to be implemented in the instance?




**Regards,
Deepak Singh**

nabinhait (Assginee) on (2025-01-31 10:13:16 UTC): If we don't post an entry against ""Gain/Loss on Asset Disposal - NSPL"", how the pending depreciation amount will be booked as expenses? Even we scrap an item, the entire purchase amount is an expense for the company.

"
2775348128,issue,open,,How to Set Combined Pricing Rules in ERPNext?,"In the Pricing Rule Doctype, the applied_on field has options: Item Group, Brand, Item Code and Transactions. These options appear to be mutually exclusive.

For example, I want to set a pricing rule that applies to:

**Item Group ABC**
**Brand XYZ**
This would mean the rule applies only to items that belong to **Item Group ABC** and are of **Brand XYZ**.

Currently, I am unable to set this combination because the applied_on field restricts me to select only one option at a time.

Is there a way to achieve this combination?
If not, what would be the best approach to handle such a scenario?

Looking forward to your suggestions!",evolkavi,2025-01-08 13:04:05+00:00,[],2025-01-09 12:15:22+00:00,,https://github.com/frappe/erpnext/issues/45172,"[('feature-request', None)]","[{'comment_id': 2579224129, 'issue_id': 2775348128, 'author': 'mihir-kandoi', 'body': '@nabinhait @rohitwaghchaure please advise if this feature should be worked upon', 'created_at': datetime.datetime(2025, 1, 9, 5, 42, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2579238523, 'issue_id': 2775348128, 'author': 'singhranbir', 'body': ""Write a custom condition in the Dynamic Condition field, such as:\r\nitem_group == 'ABC' and brand == 'XYZ'\r\n\r\nyou can apply the rule for an Item or Item Group and then Apply the Dynamic Condition.\r\n\r\nIt is Working Fine for me."", 'created_at': datetime.datetime(2025, 1, 9, 5, 57, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2580012322, 'issue_id': 2775348128, 'author': 'evolkavi', 'body': ""The field item_group you mentioned seems to be from the quotation_item child table, correct? If so, this dynamic condition will not work because it evaluates the condition against the parent document, not the child table.\r\n\r\nWhen using fields from a child table like item_group in quotation_item, the system doesn't have the context to evaluate those fields directly unless the condition explicitly references the child table and its structure.\r\n\r\nHowever, when you use a field from the parent document (e.g., quotation), the condition works because it directly evaluates the parent field values. This limitation exists because the condition logic doesn't iterate over child table rows to match specific values."", 'created_at': datetime.datetime(2025, 1, 9, 12, 15, 20, tzinfo=datetime.timezone.utc)}]","mihir-kandoi on (2025-01-09 05:42:47 UTC): @nabinhait @rohitwaghchaure please advise if this feature should be worked upon

singhranbir on (2025-01-09 05:57:52 UTC): Write a custom condition in the Dynamic Condition field, such as:
item_group == 'ABC' and brand == 'XYZ'

you can apply the rule for an Item or Item Group and then Apply the Dynamic Condition.

It is Working Fine for me.

evolkavi (Issue Creator) on (2025-01-09 12:15:20 UTC): The field item_group you mentioned seems to be from the quotation_item child table, correct? If so, this dynamic condition will not work because it evaluates the condition against the parent document, not the child table.

When using fields from a child table like item_group in quotation_item, the system doesn't have the context to evaluate those fields directly unless the condition explicitly references the child table and its structure.

However, when you use a field from the parent document (e.g., quotation), the condition works because it directly evaluates the parent field values. This limitation exists because the condition logic doesn't iterate over child table rows to match specific values.

"
2775188959,issue,open,,Wrong EAN naming,"### Information about bug

The EAN (International Article Number) barcode standard defines several barcode types. The most common type for retail products is EAN-13, which uses 13 digits. However, the REP system currently uses the term ""EAN-12"" in various areas, such as: https://github.com/frappe/erpnext/blob/81d8f257aaaf29f2df62a197a34842b10b8718fb/erpnext/stock/doctype/item_barcode/item_barcode.py#L23
and
https://github.com/frappe/erpnext/blob/81d8f257aaaf29f2df62a197a34842b10b8718fb/erpnext/stock/doctype/item_barcode/item_barcode.json#L28
This is inaccurate and could lead to confusion and errors in data processing and product identification.

### Module

stock

### Version

ERPNext: v15.47.1
Frappe Framework: v15.51.0
Frappe HR: v15.36.1
Print Designer: v1.4.3

### Installation method

docker

### Relevant log output / Stack trace / Full Error Message.

_No response_",oleynikd,2025-01-08 11:46:40+00:00,[],2025-01-10 03:58:17+00:00,,https://github.com/frappe/erpnext/issues/45169,"[('bug', None)]","[{'comment_id': 2581693402, 'issue_id': 2775188959, 'author': 'lansgt', 'body': 'Likely similar to this https://github.com/frappe/erpnext/issues/45034', 'created_at': datetime.datetime(2025, 1, 10, 3, 58, 17, tzinfo=datetime.timezone.utc)}]","lansgt on (2025-01-10 03:58:17 UTC): Likely similar to this https://github.com/frappe/erpnext/issues/45034

"
2774443033,issue,closed,not_planned,In Subcontracting Receipt > Items > Batch Number shows Qty instead of Batch No,"### Information about bug

In Subcontracting Receipt > Items > Batch Number shows Qty instead of Batch No

<img width=""984"" alt=""image"" src=""https://github.com/user-attachments/assets/0e7ec4c4-f68d-4771-8351-af0437f28e76"" />


### Module

manufacturing

### Version

Anant Blue Theme: v1.0.1 (HEAD)
ERPNext: v15.47.4 (HEAD)
Frappe Framework: v15.51.1 (HEAD)
Frappe HR: v15.37.1 (HEAD)
India Compliance: v15.14.6 (HEAD)
Raven: v2.0.0 (HEAD)

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",nitin-anantpranali,2025-01-08 06:46:02+00:00,['mihir-kandoi'],2025-01-30 00:10:04+00:00,2025-01-15 06:55:03+00:00,https://github.com/frappe/erpnext/issues/45160,"[('bug', None), (""can't-reproduce"", 'We are unable to reproduce this bug, provide more information.')]","[{'comment_id': 2577139985, 'issue_id': 2774443033, 'author': 'mihir-kandoi', 'body': 'Please provide exact replication steps as I am not able to replicate this issue. I can only see the batch ID and not quantity.', 'created_at': datetime.datetime(2025, 1, 8, 9, 2, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2591781008, 'issue_id': 2774443033, 'author': 'mihir-kandoi', 'body': 'Closing as no reproduction steps provided. If one still continues to face this bug, please open a new issue.', 'created_at': datetime.datetime(2025, 1, 15, 6, 55, 3, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-08 09:02:32 UTC): Please provide exact replication steps as I am not able to replicate this issue. I can only see the batch ID and not quantity.

mihir-kandoi (Assginee) on (2025-01-15 06:55:03 UTC): Closing as no reproduction steps provided. If one still continues to face this bug, please open a new issue.

"
2774169682,issue,open,,Customer Details Not Fetching in Payment Entry while using connection,"### Information about bug


![image](https://github.com/user-attachments/assets/7bf6927d-1499-4fb2-922e-9cc505e5d7fb)
![image](https://github.com/user-attachments/assets/62229c4c-2eeb-4b96-9037-8025338dd237)


When i try to create a payment entry from the customer the customer name and address is not fetched from the customer.

But the connection works fine when we create a sale order and invoice from the customer. I also need payment entry.




### Module

buying, selling

### Version

ERPNext: v15.46.2 
Frappe Framework: v15.51.0 (version-15)


### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",kponsakthivel,2025-01-08 03:21:47+00:00,['diptanilsaha'],2025-01-08 07:22:01+00:00,,https://github.com/frappe/erpnext/issues/45155,"[('bug', None)]",[],
2774052002,issue,closed,not_planned,新增一个新的银行户头提示科目被占用,"### Information about bug

![image](https://github.com/user-attachments/assets/e3f1e88b-b978-4dd5-a172-50b167545eeb)
在会计—银行户头新增一个新的银行户头提示科目被占用。这是升级到15.35.1后才出现的信息。

### Module

accounts, stock, buying

### Version

ERPNext: v15.35.1 (version-15)
Frappe Framework: v15.40.6 (version-15)

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",lcese,2025-01-08 01:45:56+00:00,[],2025-01-24 00:10:09+00:00,2025-01-09 05:45:50+00:00,https://github.com/frappe/erpnext/issues/45151,"[('bug', None)]","[{'comment_id': 2579227094, 'issue_id': 2774052002, 'author': 'mihir-kandoi', 'body': 'Please make another issue using English. Closing.', 'created_at': datetime.datetime(2025, 1, 9, 5, 45, 50, tzinfo=datetime.timezone.utc)}]","mihir-kandoi on (2025-01-09 05:45:50 UTC): Please make another issue using English. Closing.

"
2773019569,issue,closed,completed,Broken image in BOM tree,"### Information about bug

![photo_2025-01-07 20 13 29](https://github.com/user-attachments/assets/891afc5d-6b9a-49b0-8dda-1a535e6bec41)

No images are set on items, it should just not render any image tag.

### Module

manufacturing

### Version

Version 15 latest

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

```shell
Check the screenshot's browser console part
```
",NagariaHussain,2025-01-07 14:44:47+00:00,['iamejaaz'],2025-02-04 00:10:15+00:00,2025-01-20 17:18:07+00:00,https://github.com/frappe/erpnext/issues/45147,"[('bug', None)]","[{'comment_id': 2579191297, 'issue_id': 2773019569, 'author': 'iamejaaz', 'body': 'Additionally, images with external URLs are not rendering properly.\r\n![image](https://github.com/user-attachments/assets/bc62b2a4-3455-49e0-b05c-5774d4cd356a)', 'created_at': datetime.datetime(2025, 1, 9, 5, 8, 3, tzinfo=datetime.timezone.utc)}]","iamejaaz (Assginee) on (2025-01-09 05:08:03 UTC): Additionally, images with external URLs are not rendering properly.
![image](https://github.com/user-attachments/assets/bc62b2a4-3455-49e0-b05c-5774d4cd356a)

"
2772985295,issue,open,,Application Logo Update from NAV BAR,"### Information about bug

After Migrating site from an existing one, when We try to change the App Logo from https://erp-amani.frappe.cloud/app/navbar-settings/Navbar%20Settings, it saves the file but does not update.

### Module

other

### Version

ERPNext: v15.47.3 (HEAD)

Frappe Framework: v15.51.1 (HEAD)

Frappe HR: v15.37.1 (HEAD)

Non Profit: v0.0.1 (HEAD)

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

```shell
https://erp-amani.frappe.cloud/app/navbar-settings/Navbar%20Settings
```
",Abir-revolted,2025-01-07 14:29:08+00:00,[],2025-01-19 23:07:58+00:00,,https://github.com/frappe/erpnext/issues/45146,"[('bug', None)]","[{'comment_id': 2579559855, 'issue_id': 2772985295, 'author': 'parasonit', 'body': 'While uploading the Image remove Private tick \r\n\r\n![image](https://github.com/user-attachments/assets/7f3536e2-c1a5-44a1-9f09-8ee0186b3e48)', 'created_at': datetime.datetime(2025, 1, 9, 9, 22, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2601059114, 'issue_id': 2772985295, 'author': 'kalungia', 'body': 'Hey @Abir-revolted may you confirm @parasonit should and close this if it works for you. But it should work.', 'created_at': datetime.datetime(2025, 1, 19, 23, 7, 57, tzinfo=datetime.timezone.utc)}]","parasonit on (2025-01-09 09:22:57 UTC): While uploading the Image remove Private tick 

![image](https://github.com/user-attachments/assets/7f3536e2-c1a5-44a1-9f09-8ee0186b3e48)

kalungia on (2025-01-19 23:07:57 UTC): Hey @Abir-revolted may you confirm @parasonit should and close this if it works for you. But it should work.

"
2772683825,issue,open,,UOM filter is required in the entire application,"While creating a new item, we select UOM + UOM conversion (if applicable).

Still in all doctypes like Purchase order, receipt, invoice, sales order, delivery note and invoice UOM link field has no filter and shows all the UOM.

There are chances that user mistakenly selects some other UOM say for eg:- PCS instead of NOS. Even if the system validates before save, it would be tedious for user to go to each item and modify the UOM.

UOM filter is the requirement which can be based on setting or direct.",sabiha-sh,2025-01-07 12:07:26+00:00,[],2025-01-07 12:07:26+00:00,,https://github.com/frappe/erpnext/issues/45142,"[('feature-request', None)]",[],
2772635742,issue,closed,completed,Unnecessary top separator in context menu ,"### Information about bug

Divider line is not needed at the beginning of the list. 

<img width=""409"" alt=""image"" src=""https://github.com/user-attachments/assets/87ad88b1-2e24-4a4b-b80c-e94377bb4c5d"" />


### Module

stock

### Version

16

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",nish7x,2025-01-07 11:42:26+00:00,['iamejaaz'],2025-01-25 00:09:57+00:00,2025-01-10 10:24:20+00:00,https://github.com/frappe/erpnext/issues/45137,"[('bug', None), ('v16', '')]",[],
2772629592,issue,closed,completed,Misalignment of attachment title and icon ,"### Information about bug

Padlock icon and filename aren't vertically aligned. 

<img width=""541"" alt=""image"" src=""https://github.com/user-attachments/assets/4bc4a530-8af1-44c9-b502-19b80a4da290"" />


### Module

stock

### Version

16

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",nish7x,2025-01-07 11:39:04+00:00,['iamejaaz'],2025-01-23 00:10:08+00:00,2025-01-08 15:10:49+00:00,https://github.com/frappe/erpnext/issues/45136,"[('bug', None), ('v16', '')]",[],
2772620745,issue,closed,completed,Minor misalignment of active tab items ,"### Information about bug

Tab item appears raised by 1 px if active, possibly due to the 1 px border at the bottom. Makes it seem like the title is jumping when switching tabs. 

<img width=""1118"" alt=""image"" src=""https://github.com/user-attachments/assets/c45047dc-1930-4fe8-abe9-46133bd055a5"" />


https://github.com/user-attachments/assets/d1d4cc5e-df13-4adb-baee-78cb8d7409eb



### Module

stock

### Version

16

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",nish7x,2025-01-07 11:34:47+00:00,['iamejaaz'],2025-01-23 00:10:09+00:00,2025-01-08 15:10:09+00:00,https://github.com/frappe/erpnext/issues/45135,"[('bug', None), ('v16', '')]",[],
2772426741,issue,closed,completed,ERPNext Demo not working,"### Information about bug

Going to the [ERPNext Demo Page](https://erpnext-demo.frappe.cloud/api/method/erpnext_demo.erpnext_demo.auth.login_demo) results in the following error message:

```
Server Error
Traceback (most recent call last):
  File ""apps/frappe/frappe/handler.py"", line 74, in execute_cmd
    method = get_attr(cmd)
             ^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 288, in get_attr
    method = frappe.get_attr(cmd)
             ^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/__init__.py"", line 1711, in get_attr
    throw(_(""App {0} is not installed"").format(app_name), AppNotInstalledError)
  File ""apps/frappe/frappe/__init__.py"", line 602, in throw
    msgprint(
  File ""apps/frappe/frappe/__init__.py"", line 567, in msgprint
    _raise_exception()
  File ""apps/frappe/frappe/__init__.py"", line 518, in _raise_exception
    raise exc
frappe.exceptions.AppNotInstalledError: App erpnext_demo is not installed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""apps/frappe/frappe/app.py"", line 114, in application
    response = frappe.api.handle(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/__init__.py"", line 49, in handle
    data = endpoint(**arguments)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/v1.py"", line 36, in handle_rpc_call
    return frappe.handler.handle()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 49, in handle
    data = execute_cmd(cmd)
           ^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 76, in execute_cmd
    frappe.throw(_(""Failed to get method for command {0} with {1}"").format(cmd, e))
  File ""apps/frappe/frappe/__init__.py"", line 602, in throw
    msgprint(
  File ""apps/frappe/frappe/__init__.py"", line 567, in msgprint
    _raise_exception()
  File ""apps/frappe/frappe/__init__.py"", line 518, in _raise_exception
    raise exc
frappe.exceptions.ValidationError: Failed to get method for command erpnext_demo.erpnext_demo.auth.login_demo with App erpnext_demo is not installed
```

### Module

other

### Version

N/A

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",peterdigitrol,2025-01-07 10:07:55+00:00,['diptanilsaha'],2025-01-22 00:10:12+00:00,2025-01-07 11:36:37+00:00,https://github.com/frappe/erpnext/issues/45133,"[('bug', None)]","[{'comment_id': 2575020161, 'issue_id': 2772426741, 'author': 'nabinhait', 'body': 'Thanks for reporting, we are working to fix it.', 'created_at': datetime.datetime(2025, 1, 7, 11, 12, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2575068465, 'issue_id': 2772426741, 'author': 'diptanilsaha', 'body': 'Fixed. @peterdigitrol thanks for reporting.', 'created_at': datetime.datetime(2025, 1, 7, 11, 36, 37, tzinfo=datetime.timezone.utc)}]","nabinhait on (2025-01-07 11:12:18 UTC): Thanks for reporting, we are working to fix it.

diptanilsaha (Assginee) on (2025-01-07 11:36:37 UTC): Fixed. @peterdigitrol thanks for reporting.

"
2772085297,issue,closed,not_planned,GST Breakup Table is showing Incorrect values,"### Information about bug

In ERPNExt Version  v15.43.3 , GST Breakup Table is showing incorrect values , please check screenshot
<img width=""1270"" alt=""Screenshot 2025-01-07 at 12 52 34 PM"" src=""https://github.com/user-attachments/assets/5477abf6-3619-4986-b427-07dd1d012a3e"" />


### Module

selling

### Version

Frappe Version =  v15.48.0
ERPNext Version = v15.43.3

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",honey-sharma1012,2025-01-07 07:24:05+00:00,[],2025-01-24 00:10:07+00:00,2025-01-09 10:43:45+00:00,https://github.com/frappe/erpnext/issues/45127,"[('bug', None)]","[{'comment_id': 2574666652, 'issue_id': 2772085297, 'author': 'ljain112', 'body': 'GST Breakup Table is part of India Compliance App.\r\nKindly create the issue in https://github.com/resilient-tech/india-compliance/issues', 'created_at': datetime.datetime(2025, 1, 7, 8, 26, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2579805662, 'issue_id': 2772085297, 'author': 'mihir-kandoi', 'body': '> GST Breakup Table is part of India Compliance App. Kindly create the issue in https://github.com/resilient-tech/india-compliance/issues', 'created_at': datetime.datetime(2025, 1, 9, 10, 43, 45, tzinfo=datetime.timezone.utc)}]","ljain112 on (2025-01-07 08:26:41 UTC): GST Breakup Table is part of India Compliance App.
Kindly create the issue in https://github.com/resilient-tech/india-compliance/issues

mihir-kandoi on (2025-01-09 10:43:45 UTC): 

"
2770770272,issue,closed,completed,Typo in Manufacturing Settings,"### Information about bug

![CleanShot 2025-01-06 at 19 53 05@2x](https://github.com/user-attachments/assets/a1107a8a-c199-4b17-90ab-3f6c10f016ad)


### Module

manufacturing

### Version

Version 15

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",NagariaHussain,2025-01-06 14:23:47+00:00,['diptanilsaha'],2025-01-29 00:10:07+00:00,2025-01-14 08:39:39+00:00,https://github.com/frappe/erpnext/issues/45110,"[('bug', None)]",[],
2769122557,issue,open,,Asset Maintenance task periodicity need option Half-Monthly,"Dear concern, we are using Erpnext Asset module. I need an option for asset maintenance task periodicity as a half-monthly.
because we make some asset maintenance as Half-Monthly or 15 Days. So we need this feature.

Thanks. 
",arafatmkd,2025-01-05 05:27:02+00:00,['khushi8112'],2025-01-15 08:27:14+00:00,,https://github.com/frappe/erpnext/issues/45091,"[('feature-request', None)]",[],
2768517796,issue,closed,completed,Work Order Issue on latest update,"### Information about bug

1. Work Order in draft mode and showing to close the work order
2. The Alternative Item Selection option is not showing.

3. Validating Only BOM Item & Qty - What if I select the Alternative Item ( Need to test )

https://github.com/user-attachments/assets/1a7a1f53-7585-4cf8-b7df-33bbf4271426



### Module

manufacturing

### Version

ERPNext: v15.47.4 (version-15)

Frappe Framework: v15.51.1 (version-15)

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",dineshpanchal93,2025-01-04 06:32:22+00:00,['mihir-kandoi'],2025-01-30 00:10:01+00:00,2025-01-15 08:23:56+00:00,https://github.com/frappe/erpnext/issues/45082,"[('bug', None), ('awaiting confirmation', 'Awaiting confirmation from user to close the issue')]","[{'comment_id': 2577147145, 'issue_id': 2768517796, 'author': 'mihir-kandoi', 'body': '@dineshpanchal93 Can you confirm if your issue is resolved?', 'created_at': datetime.datetime(2025, 1, 8, 9, 6, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2591917343, 'issue_id': 2768517796, 'author': 'mihir-kandoi', 'body': 'Closing as no confirmation received.', 'created_at': datetime.datetime(2025, 1, 15, 8, 23, 56, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-08 09:06:03 UTC): @dineshpanchal93 Can you confirm if your issue is resolved?

mihir-kandoi (Assginee) on (2025-01-15 08:23:56 UTC): Closing as no confirmation received.

"
2767403892,issue,closed,completed,Issues with Subcontracting,"### Information about bug

The current subcontracting flow I’m using is as follows:
**Purchase Order → Subcontracting Order → Material Transfer to Supplier → Subcontracting Receipt → Purchase Receipt → Purchase Invoice**

<hr>

**Issue 1**
During the Subcontracting Receipt step, the material consumed should logically follow this formula:

> Consumed Quantity = Quantity Received × BOM Quantity

**Problem:**
The system sometimes generates incorrect “consumed quantity” values despite the BOM only containing whole number quantities. This necessitates manual adjustments during the Subcontracting Receipt step.

> [!TIP]
> I have noticed this happens when - the ""Transferred Material to Supplier"" is not exactly the same quantity as required in the BOM - System consumes more is the quantity transferred is more than required, else it consumes less if the quantity transferred is less than required. 

**Scenario 1:** System consumes more is the quantity transferred is more than required
Quantity to Produce = 10
Required Raw Material = 10
Quantity Transferred = 20
Here consumption will be = 20 / 10 = 2 
i.e. it will consume 2 raw material to produce the same 10 Quantity instead of 1 as mentioned in the BOM.

**Scenario 2:** System consumes less if the quantity transferred is less than required
Quantity to Produce = 10
Required Raw Material = 10
Quantity Transferred = 5
Here consumption will be = 5 / 10 = 0.5 
i.e. it will consume 0.5 raw material to produce the same 10 Quantity instead of 1 as mentioned in the BOM. (system will always round to the nearest whole number)

**Expected Behavior:**
Consumption should strictly adhere to the BOM Quantity, regardless of the Transferred Material quantity.

<hr>

**Issue 2:**

If two subcontracted Items share the same Raw Material, the system requires assigning the Raw Material to specific Items during the “Transfer Material to Subcontractor” Stock Entry. 

**Problem:**
This approach lacks flexibility. It should allow raw materials to be transferred without strict item-level allocation, letting the subcontractor manage the consumption.

**Expected Behavior:**
Allow transferring raw materials without strict allocation to specific subcontracted items.

<hr>

**Issue 3:**

When making a Stock Entry for the “Return of Components,” the returned quantity should be:

1. Unavailable for further consumption.
2. Reflected in the “Subcontracted Raw Materials To Be Transferred” report, indicating the material is now back in stock, and it has to be again delivered to the subcontractor for further consumption.

**Problem:**
The returned quantity remains available for consumption, and the report does not update.

**Expected Behavior:**
The system should adjust both the availability and the report to reflect the returned components accurately.

### Module

buying, manufacturing, other

### Version

ERPNext: v15.47.3 (HEAD)

Frappe Framework: v15.51.1 (HEAD)

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",nisarg5900,2025-01-03 11:18:32+00:00,['mihir-kandoi'],2025-01-30 00:10:00+00:00,2025-01-15 08:24:34+00:00,https://github.com/frappe/erpnext/issues/45075,"[('bug', None), ('awaiting confirmation', 'Awaiting confirmation from user to close the issue')]","[{'comment_id': 2571065066, 'issue_id': 2767403892, 'author': 'mihir-kandoi', 'body': 'For issue 1:\r\nCan you tell us the setting you are using for backflush?\r\n\r\n<img width=""661"" alt=""image"" src=""https://github.com/user-attachments/assets/9e75b716-6a95-4c90-a638-3efd2108ea8f"" />', 'created_at': datetime.datetime(2025, 1, 4, 9, 57, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2571081441, 'issue_id': 2767403892, 'author': 'nisarg5900', 'body': '![image](https://github.com/user-attachments/assets/bfd1cfbe-3433-4f26-909e-00662b8662f0)', 'created_at': datetime.datetime(2025, 1, 4, 10, 1, 49, tzinfo=datetime.timezone.utc)}, {'comment_id': 2571089450, 'issue_id': 2767403892, 'author': 'mihir-kandoi', 'body': 'Please change backflush setting to ""BOM"" and your issue should be resolved. Try testing it after saving the Buying Setting.', 'created_at': datetime.datetime(2025, 1, 4, 10, 3, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2591918493, 'issue_id': 2767403892, 'author': 'mihir-kandoi', 'body': 'Closing as no confirmation received.', 'created_at': datetime.datetime(2025, 1, 15, 8, 24, 35, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-04 09:57:39 UTC): For issue 1:
Can you tell us the setting you are using for backflush?

<img width=""661"" alt=""image"" src=""https://github.com/user-attachments/assets/9e75b716-6a95-4c90-a638-3efd2108ea8f"" />

nisarg5900 (Issue Creator) on (2025-01-04 10:01:49 UTC): ![image](https://github.com/user-attachments/assets/bfd1cfbe-3433-4f26-909e-00662b8662f0)

mihir-kandoi (Assginee) on (2025-01-04 10:03:41 UTC): Please change backflush setting to ""BOM"" and your issue should be resolved. Try testing it after saving the Buying Setting.

mihir-kandoi (Assginee) on (2025-01-15 08:24:35 UTC): Closing as no confirmation received.

"
2767390765,issue,closed,completed,Numbers not aligned with rest of the cells ,"### Information about bug

<img width=""1117"" alt=""image"" src=""https://github.com/user-attachments/assets/8e29eff8-dd6a-4408-bca3-19d3665c2abc"" />


### Module

stock

### Version

v16

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",nish7x,2025-01-03 11:08:29+00:00,['iamejaaz'],2025-01-28 00:10:24+00:00,2025-01-13 06:20:03+00:00,https://github.com/frappe/erpnext/issues/45073,"[('bug', None), ('v16', '')]",[],
2767342192,issue,closed,completed,Aspect ratio of brand logo shown on loading screens is not maintained ,"### Information about bug

Logo is resized on loading screens. Probably a fixed dimension is applied? 

<img width=""1271"" alt=""image"" src=""https://github.com/user-attachments/assets/921d6c73-d2d6-49df-9517-383b3d5e3df7"" />


### Module

other

### Version

v16

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",nish7x,2025-01-03 10:32:32+00:00,['iamejaaz'],2025-01-25 00:09:56+00:00,2025-01-10 10:24:56+00:00,https://github.com/frappe/erpnext/issues/45072,"[('bug', None), ('UI', '')]",[],
2767150867,issue,open,,Backport PR #44697 to version-15,,mahsem,2025-01-03 08:08:32+00:00,[],2025-01-03 08:08:32+00:00,,https://github.com/frappe/erpnext/issues/45069,"[('feature-request', None)]",[],
2767063025,issue,closed,completed,Duplicate Tab Label In Item Master,"### Information about bug

The system allows the creation of a duplicate tab with the same label in the item master which it should not.

![image](https://github.com/user-attachments/assets/06c72788-3109-4440-bf3c-59b039d5de3d)

Site https://spindl16.frappe.cloud
Item - https://spindl16.frappe.cloud/app/item/Resistance%20Band-RED%20BOX



### Module

stock

### Version

ERPNext v16

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",DipenFrappe,2025-01-03 06:43:53+00:00,[],2025-01-18 00:09:55+00:00,2025-01-03 09:33:46+00:00,https://github.com/frappe/erpnext/issues/45067,"[('bug', None)]",[],
2767018023,issue,closed,completed,[V16] Reduce item table columns and adjust the width for better user experience,"### Information about bug

Currently, item tables in various DocTypes display too many columns, causing the columns to shrink and become difficult to read. To address this, only a few essential columns should be shown in the list view by default like earlier versions. Users have the option to add additional columns if needed.

Additionally, adjust column widths based on the field type—for example, the ""Item Name"" column should be wider than the ""Quantity"" column. Refer to Version 15 for guidance on these adjustments.

For Example sharing screenshots of one DocType but needs be done in all the DocTypes
Sales Order v16
![image](https://github.com/user-attachments/assets/21306317-8a15-4691-9b34-257bd8fc53eb)

Sales Order v15
![image](https://github.com/user-attachments/assets/aca18c8e-1289-4f04-8bc6-42d7ae6ca1fe)


,

### Module

accounts

### Version

ERPNext V16

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",DipenFrappe,2025-01-03 05:54:24+00:00,['iamejaaz'],2025-01-28 00:10:21+00:00,2025-01-13 06:24:46+00:00,https://github.com/frappe/erpnext/issues/45065,"[('bug', None), ('v16', '')]","[{'comment_id': 2568736977, 'issue_id': 2767018023, 'author': 'DipenFrappe', 'body': 'BOM Screenshot\r\n\r\n![image](https://github.com/user-attachments/assets/25fdfd18-fb25-41c7-b907-918d44ee953f)', 'created_at': datetime.datetime(2025, 1, 3, 6, 11, 42, tzinfo=datetime.timezone.utc)}]","DipenFrappe (Issue Creator) on (2025-01-03 06:11:42 UTC): BOM Screenshot

![image](https://github.com/user-attachments/assets/25fdfd18-fb25-41c7-b907-918d44ee953f)

"
2765894404,issue,closed,completed,Image in bom tree is cut off ,"### Information about bug

![6300665995181802084](https://github.com/user-attachments/assets/179728f1-81d1-4e1d-872f-fc202cce7ece)


### Module

manufacturing

### Version

Frappe Version v16
Erpnext v16

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",sokumon,2025-01-02 11:47:54+00:00,['sokumon'],2025-01-17 00:10:25+00:00,2025-01-02 13:30:26+00:00,https://github.com/frappe/erpnext/issues/45049,"[('bug', None)]",[],
2765704376,issue,closed,completed,Discount Amount Cleared When Modifying Item Rate in Quotation,"### Information about Bug:  
When creating a **Quotation** or other price-related documents, modifying the **Rate** field in the **Items** child table causes an issue:

1. Change the **Rate** of an item (e.g., from 2200 to 2000).  
2. The system automatically calculates and populates the **discount_amount** field based on the difference.  
3. Upon clicking **Save**, the **discount_amount** field is cleared.  
4. This results in the price reverting to the original price set in the price list, disregarding the manual rate adjustment.

**Steps to Reproduce:**
1. Open a Quotation or similar price-related document.  
2. In the **Items** table, modify the **Rate** field for any item.  
3. Observe that the **discount_amount** is populated correctly.  
4. Click **Save** and check the **discount_amount** and **Rate** fields.  

**Expected Behavior:**  
After saving, the **discount_amount** and the manually modified **Rate** should be retained, and the final price calculation should reflect these adjustments.  

**Actual Behavior:**  
The **discount_amount** is cleared, and the **Rate** reverts to the original value from the price list.  

### Module

other

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

```shell
erpnext 15.47.3
frappe 15.51.1
```
",kanedai,2025-01-02 09:31:56+00:00,['ruthra-kumar'],2025-01-23 00:10:11+00:00,2025-01-07 05:50:44+00:00,https://github.com/frappe/erpnext/issues/45046,"[('bug', None), ('released', None)]","[{'comment_id': 2567615946, 'issue_id': 2765704376, 'author': 'perotom', 'body': 'Same with invoices. We are not able to bill anything as discounts are not working.\r\n``` \r\nERPNext: v15.47.3 (version-15)\r\nFrappe Framework: v15.51.1 (version-15)\r\n```', 'created_at': datetime.datetime(2025, 1, 2, 11, 15, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2567633238, 'issue_id': 2765704376, 'author': 'dsridhar17', 'body': 'Same issue\r\nWhen a discount is added to the sales quotation and saved, the discount gets reset to 0.\r\nERPNEXT Version 15\r\nFrappe version 15\r\nDeployed on Frappe Cloud\r\nPlease resolve this as soon as possible as workflows are blocked.\r\nFyi no Pricing Rule is implemented, the discount is added case by case in each quotation.', 'created_at': datetime.datetime(2025, 1, 2, 11, 29, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2571679437, 'issue_id': 2765704376, 'author': 'donnieferdian', 'body': 'same issue,.. i hope it will be fix soon,..', 'created_at': datetime.datetime(2025, 1, 5, 16, 24, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572220877, 'issue_id': 2765704376, 'author': 'SvbZ3r0', 'body': '@rohitwaghchaure This is a critical issue which breaks invoicing workflows. Is there a way to downgrade to a previous version until this is fixed?', 'created_at': datetime.datetime(2025, 1, 6, 3, 44, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572697163, 'issue_id': 2765704376, 'author': 'mihir-kandoi', 'body': 'Unable to reproduce on `develop`, `version-15-hotfix` and `version-15`\r\n\r\nPlease provide a screen recording of this issue.', 'created_at': datetime.datetime(2025, 1, 6, 9, 28, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572869291, 'issue_id': 2765704376, 'author': 'rknroot', 'body': 'Hi, we also faced same problem. after updating to `v15.47.5` working fine.', 'created_at': datetime.datetime(2025, 1, 6, 10, 57, 46, tzinfo=datetime.timezone.utc)}, {'comment_id': 2573130178, 'issue_id': 2765704376, 'author': 'SvbZ3r0', 'body': ""Problem still exists in v15.47.5.\r\n\r\n@mihir-kandoi \r\nSteps to replicate\r\n1. Create new Purchase Invoice\r\n2. Choose Supplier, and fill in all necessary fields\r\n3. Add an Item which has existing Item Price such that the `rate` field is autopopulated\r\n4. Edit `rate` field to a **lower** amount (Increasing price doesn't trigger this error)\r\n5. Check if `discount` is set\r\n6. Edit the `posting_date`\r\n7. `discount` field is reset, and `rate` field goes back to original price\r\n\r\nhttps://github.com/user-attachments/assets/f94ab103-7d4e-4e35-8781-b7bda63dc8f1\r\n\r\nI'm not sure if there are other ways to trigger this, but this way is completely replicable.\r\n\r\nAnother thing I noticed while debugging this:\r\n1. Add an Item which has existing Item Price such that the `rate` field is autopopulated\r\n2. Edit `rate` field to a **lower** amount\r\n3. Check if `discount` is set\r\n4. Edit `rate` field to a **higher** amount\r\n5. `margin` field is set, but `discount` field is not reset.\r\n\r\nNot sure if that is related, but I found that odd."", 'created_at': datetime.datetime(2025, 1, 6, 13, 38, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2574440268, 'issue_id': 2765704376, 'author': 'ruthra-kumar', 'body': ""There are 2 different scenarios being reported here.\r\n\r\n1. Discount Amount resetting upon `save` - fixed in [v15.57.4](https://github.com/frappe/erpnext/releases/tag/v15.47.4) and [v14.78.8](https://github.com/frappe/erpnext/releases/tag/v14.78.8)\r\n2. Discount Amount resetting upon `posting_date` / `transaction_date` change\r\n\r\nBoth of them are due to changes from [44989](https://github.com/frappe/erpnext/pull/44989). This change intended to auto remove a Pricing Rule if the document's posting date falls outside the `valid_from` and `valid_to` range of the rule. It achieved this by simply calling `apply_pricing_rule()` on trigger points: `validate` and `posting_date` / `transaction_date` changes.\r\n\r\nBut caused regression on [1], it was partially reverted in above mentioned versions."", 'created_at': datetime.datetime(2025, 1, 7, 5, 46, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2574441337, 'issue_id': 2765704376, 'author': 'ruthra-kumar', 'body': ""Reverting [44989](https://github.com/frappe/erpnext/pull/44989) through [45121](https://github.com/frappe/erpnext/pull/45121) and will be part of this week's release."", 'created_at': datetime.datetime(2025, 1, 7, 5, 48, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2577327512, 'issue_id': 2765704376, 'author': 'frappe-pr-bot', 'body': ':tada: This issue has been resolved in version 14.78.9 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.78.9)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2025, 1, 8, 10, 28, 13, tzinfo=datetime.timezone.utc)}]","perotom on (2025-01-02 11:15:33 UTC): Same with invoices. We are not able to bill anything as discounts are not working.
``` 
ERPNext: v15.47.3 (version-15)
Frappe Framework: v15.51.1 (version-15)
```

dsridhar17 on (2025-01-02 11:29:42 UTC): Same issue
When a discount is added to the sales quotation and saved, the discount gets reset to 0.
ERPNEXT Version 15
Frappe version 15
Deployed on Frappe Cloud
Please resolve this as soon as possible as workflows are blocked.
Fyi no Pricing Rule is implemented, the discount is added case by case in each quotation.

donnieferdian on (2025-01-05 16:24:28 UTC): same issue,.. i hope it will be fix soon,..

SvbZ3r0 on (2025-01-06 03:44:39 UTC): @rohitwaghchaure This is a critical issue which breaks invoicing workflows. Is there a way to downgrade to a previous version until this is fixed?

mihir-kandoi on (2025-01-06 09:28:48 UTC): Unable to reproduce on `develop`, `version-15-hotfix` and `version-15`

Please provide a screen recording of this issue.

rknroot on (2025-01-06 10:57:46 UTC): Hi, we also faced same problem. after updating to `v15.47.5` working fine.

SvbZ3r0 on (2025-01-06 13:38:18 UTC): Problem still exists in v15.47.5.

@mihir-kandoi 
Steps to replicate
1. Create new Purchase Invoice
2. Choose Supplier, and fill in all necessary fields
3. Add an Item which has existing Item Price such that the `rate` field is autopopulated
4. Edit `rate` field to a **lower** amount (Increasing price doesn't trigger this error)
5. Check if `discount` is set
6. Edit the `posting_date`
7. `discount` field is reset, and `rate` field goes back to original price

https://github.com/user-attachments/assets/f94ab103-7d4e-4e35-8781-b7bda63dc8f1

I'm not sure if there are other ways to trigger this, but this way is completely replicable.

Another thing I noticed while debugging this:
1. Add an Item which has existing Item Price such that the `rate` field is autopopulated
2. Edit `rate` field to a **lower** amount
3. Check if `discount` is set
4. Edit `rate` field to a **higher** amount
5. `margin` field is set, but `discount` field is not reset.

Not sure if that is related, but I found that odd.

ruthra-kumar (Assginee) on (2025-01-07 05:46:56 UTC): There are 2 different scenarios being reported here.

1. Discount Amount resetting upon `save` - fixed in [v15.57.4](https://github.com/frappe/erpnext/releases/tag/v15.47.4) and [v14.78.8](https://github.com/frappe/erpnext/releases/tag/v14.78.8)
2. Discount Amount resetting upon `posting_date` / `transaction_date` change

Both of them are due to changes from [44989](https://github.com/frappe/erpnext/pull/44989). This change intended to auto remove a Pricing Rule if the document's posting date falls outside the `valid_from` and `valid_to` range of the rule. It achieved this by simply calling `apply_pricing_rule()` on trigger points: `validate` and `posting_date` / `transaction_date` changes.

But caused regression on [1], it was partially reverted in above mentioned versions.

ruthra-kumar (Assginee) on (2025-01-07 05:48:12 UTC): Reverting [44989](https://github.com/frappe/erpnext/pull/44989) through [45121](https://github.com/frappe/erpnext/pull/45121) and will be part of this week's release.

frappe-pr-bot on (2025-01-08 10:28:13 UTC): :tada: This issue has been resolved in version 14.78.9 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.78.9)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2765669495,issue,open,,FP Precision issue during currency conversion in Sales Invoice ,"### Information about bug

![image](https://github.com/user-attachments/assets/9f286226-2513-4567-89de-f6adb12e210b)
![image](https://github.com/user-attachments/assets/c4e41387-3aaa-45f7-bbdc-636aa844ee65)

![image](https://github.com/user-attachments/assets/1a41caca-c39e-49e0-b819-f25bea9fb6af)


### Module

accounts, selling

### Version

crm 1.31.3
erpnext 15.47.3
frappe 15.51.1
hrms 15.37.1
india_compliance 15.14.6
payments 0.0.1
print_designer 1.4.3

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",SvbZ3r0,2025-01-02 09:05:27+00:00,['mihir-kandoi'],2025-02-04 02:46:37+00:00,,https://github.com/frappe/erpnext/issues/45045,"[('bug', None)]","[{'comment_id': 2601462269, 'issue_id': 2765669495, 'author': 'mihir-kandoi', 'body': 'Unable to replicate.\n\n<img width=""604"" alt=""Image"" src=""https://github.com/user-attachments/assets/8d87dd3c-cb7e-4b39-b85f-339193d9d84d"" />\n\nPlease provide replication steps.', 'created_at': datetime.datetime(2025, 1, 20, 6, 20, 20, tzinfo=datetime.timezone.utc)}, {'comment_id': 2601607205, 'issue_id': 2765669495, 'author': 'SvbZ3r0', 'body': ""Steps to replicate:\n1) Create Sales Invoice with multiple items at multiple rates in USD\n2) Set exchange rate\n3) Totals are wrong\n\nI also noticed this weird little thing happening with the rounding\n\n![Image](https://github.com/user-attachments/assets/a2210b98-fb09-4e24-aeb1-8507b0c413fa)\n\n[Items.csv](https://github.com/user-attachments/files/18473652/Items.csv) is a download of the Items table from the affected Sales Invoice. I've removed most information since it is sensitive, but the item rate and amount fields are there. I've also added columns to see conversion in each item, if thats of any use. Please let me know if this info is sufficient.\n\nThis issue prevents us using the data exported by India Compliance module for GST purposes since there is decimal variation in each HSN code."", 'created_at': datetime.datetime(2025, 1, 20, 7, 22, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2603758647, 'issue_id': 2765669495, 'author': 'mihir-kandoi', 'body': 'Can you share a screenshot of your Date and Number Format settings from System Settings?', 'created_at': datetime.datetime(2025, 1, 21, 6, 22, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2603762544, 'issue_id': 2765669495, 'author': 'SvbZ3r0', 'body': '![Image](https://github.com/user-attachments/assets/a0211b8b-299e-47df-9ede-160639c834ae)', 'created_at': datetime.datetime(2025, 1, 21, 6, 24, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2616394640, 'issue_id': 2765669495, 'author': 'mihir-kandoi', 'body': ""Can you try changing Rounding Method to Banker's Rounding?"", 'created_at': datetime.datetime(2025, 1, 27, 17, 9, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2623524226, 'issue_id': 2765669495, 'author': 'SvbZ3r0', 'body': '![Image](https://github.com/user-attachments/assets/10452116-cc91-47aa-8eaa-f7a5c79a1769)\n\n@mihir-kandoi What exactly does it do? I only have access to the production environment right now. I will boot up a clone and try over the weekend.', 'created_at': datetime.datetime(2025, 1, 30, 5, 1, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2623609224, 'issue_id': 2765669495, 'author': 'mihir-kandoi', 'body': ""You can search up on how Banker's Rounding works. I am not sure how no rounding method is selected in your instance, Banker's Rounding is the default and the field should not be empty.\n\nTry on a local/clone and let me know."", 'created_at': datetime.datetime(2025, 1, 30, 6, 17, 9, tzinfo=datetime.timezone.utc)}, {'comment_id': 2624118970, 'issue_id': 2765669495, 'author': 'SvbZ3r0', 'body': ""It's empty because the option to change was introduced long after we set up our system. Legacy setting is Banker's Rounding by default.\nhttps://github.com/frappe/frappe/pull/20258"", 'created_at': datetime.datetime(2025, 1, 30, 10, 38, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2630501781, 'issue_id': 2765669495, 'author': 'mihir-kandoi', 'body': 'Was your issue resolved?', 'created_at': datetime.datetime(2025, 2, 3, 10, 10, 9, tzinfo=datetime.timezone.utc)}, {'comment_id': 2632695891, 'issue_id': 2765669495, 'author': 'SvbZ3r0', 'body': ""Haven't had a chance to test it yet. And, unfortunately, I won't for a while. \n\nBut until then, just out of curiosity, won't setting this option not impact this issue at all? Since the default behaviour is Banker's Rounding anyway? Unless there's a seperate `legacy_bankers_rounding` fn somewhere."", 'created_at': datetime.datetime(2025, 2, 4, 2, 46, 36, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-20 06:20:20 UTC): Unable to replicate.

<img width=""604"" alt=""Image"" src=""https://github.com/user-attachments/assets/8d87dd3c-cb7e-4b39-b85f-339193d9d84d"" />

Please provide replication steps.

SvbZ3r0 (Issue Creator) on (2025-01-20 07:22:23 UTC): Steps to replicate:
1) Create Sales Invoice with multiple items at multiple rates in USD
2) Set exchange rate
3) Totals are wrong

I also noticed this weird little thing happening with the rounding

![Image](https://github.com/user-attachments/assets/a2210b98-fb09-4e24-aeb1-8507b0c413fa)

[Items.csv](https://github.com/user-attachments/files/18473652/Items.csv) is a download of the Items table from the affected Sales Invoice. I've removed most information since it is sensitive, but the item rate and amount fields are there. I've also added columns to see conversion in each item, if thats of any use. Please let me know if this info is sufficient.

This issue prevents us using the data exported by India Compliance module for GST purposes since there is decimal variation in each HSN code.

mihir-kandoi (Assginee) on (2025-01-21 06:22:04 UTC): Can you share a screenshot of your Date and Number Format settings from System Settings?

SvbZ3r0 (Issue Creator) on (2025-01-21 06:24:59 UTC): ![Image](https://github.com/user-attachments/assets/a0211b8b-299e-47df-9ede-160639c834ae)

mihir-kandoi (Assginee) on (2025-01-27 17:09:11 UTC): Can you try changing Rounding Method to Banker's Rounding?

SvbZ3r0 (Issue Creator) on (2025-01-30 05:01:38 UTC): ![Image](https://github.com/user-attachments/assets/10452116-cc91-47aa-8eaa-f7a5c79a1769)

@mihir-kandoi What exactly does it do? I only have access to the production environment right now. I will boot up a clone and try over the weekend.

mihir-kandoi (Assginee) on (2025-01-30 06:17:09 UTC): You can search up on how Banker's Rounding works. I am not sure how no rounding method is selected in your instance, Banker's Rounding is the default and the field should not be empty.

Try on a local/clone and let me know.

SvbZ3r0 (Issue Creator) on (2025-01-30 10:38:04 UTC): It's empty because the option to change was introduced long after we set up our system. Legacy setting is Banker's Rounding by default.
https://github.com/frappe/frappe/pull/20258

mihir-kandoi (Assginee) on (2025-02-03 10:10:09 UTC): Was your issue resolved?

SvbZ3r0 (Issue Creator) on (2025-02-04 02:46:36 UTC): Haven't had a chance to test it yet. And, unfortunately, I won't for a while. 

But until then, just out of curiosity, won't setting this option not impact this issue at all? Since the default behaviour is Banker's Rounding anyway? Unless there's a seperate `legacy_bankers_rounding` fn somewhere.

"
2765359837,issue,closed,completed,Sales Invoice payment table automatically sets full amount to default payment mode after v15 update,"### Information about bug

**Problem Description:**
After updating to ERPNext v15, when activating ""Include Payment"" in Sales Invoice, the system automatically sets the full invoice amount to the default payment mode. Previously, all payment rows would start with $0, allowing users to manually distribute amounts across different payment methods.

**Steps to Reproduce:**
1. Create new Sales Invoice
2. Add items and set amount
3. Check ""Include Payment""
4. Observe that full amount is automatically set to default payment mode
5. Try to modify amount in different payment mode
6. Save document
7. Amount reverts to default payment mode

**Expected Behavior:**
- All payment rows should start with $0
- Users should be able to manually distribute amounts across different payment methods
- Changes to payment amounts should persist after saving

**Current Behavior:**
- Full invoice amount is automatically set to default payment mode
- When trying to change payment mode, amount reverts to default mode after saving
- Makes it difficult to handle split payments across different methods

**Related Commit:**
This behavior appears to have been introduced in commit [6d07d2](https://github.com/frappe/erpnext/pull/37142)

**Impact:**
This change affects common use cases where customers pay using multiple payment methods in a single transaction.

### Module

accounts

### Version

ERPNext: v15.47.3 (version-15)
Frappe Framework: v15.51.1 (version-15)
Frappe HR: v15.37.1 (version-15)
Payments: v0.0.1 (version-15)

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",franciscobuendiao,2025-01-02 01:59:48+00:00,['mihir-kandoi'],2025-01-27 17:05:11+00:00,2025-01-27 17:05:10+00:00,https://github.com/frappe/erpnext/issues/45035,"[('bug', None), ('awaiting confirmation', 'Awaiting confirmation from user to close the issue')]","[{'comment_id': 2571270181, 'issue_id': 2765359837, 'author': 'mihir-kandoi', 'body': 'Unable to reproduce on develop branch.\r\nCan you try reproducing it on develop branch as well?\r\n\r\nIf you are also not able to reproduce on develop then it will become easier to isolate the issue.', 'created_at': datetime.datetime(2025, 1, 4, 12, 11, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2571679480, 'issue_id': 2765359837, 'author': 'franciscobuendiao', 'body': ""I currently don't have access to a develop branch environment to reproduce the issue, but I've identified the exact change in the code that's causing this behavior.\r\n\r\nThe change occurred in PR #37142 (commit 6d07d2) in the file `erpnext/accounts/doctype/sales_invoice/sales_invoice.py`, specifically in the `set_missing_values` method:\r\n\r\nBefore the change:\r\n```\r\npython\r\ndef set_missing_values(self, for_validate=False):\r\n    if self.is_pos:\r\n        if not self.payments:\r\n            self.payments = []\r\n            default_mode = get_mode_of_payment(self)\r\n            if default_mode:\r\n                self.append('payments', {\r\n                    'mode_of_payment': default_mode,\r\n                    'amount': 0,  # Initialize with 0\r\n                    'default': 1\r\n                })\r\n```\r\n                \r\nAfter PR #37142:\r\n\r\n```\r\ndef set_missing_values(self, for_validate=False):\r\n    if self.is_pos:\r\n        if not self.payments:\r\n            self.payments = []\r\n            default_mode = get_mode_of_payment(self)\r\n            if default_mode:\r\n                self.append('payments', {\r\n                    'mode_of_payment': default_mode,\r\n                    'amount': self.outstanding_amount,  # Now uses total amount\r\n                    'default': 1\r\n                })\r\n```\r\n\r\nThe key difference is that previously, the payment amounts were initialized to 0, allowing users to manually set the amounts across different payment methods. Now, it automatically assigns the full outstanding amount to the default payment method.\r\nThis change affects the common use case where customers pay using multiple payment methods in a single transaction, as any attempt to modify the payment distribution reverts back to putting the full amount in the default payment mode after saving.\r\nEnvironment details:\r\n\r\nERPNext Version: v15.47.3\r\nFrappe Framework: v15.511"", 'created_at': datetime.datetime(2025, 1, 5, 16, 24, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2575129018, 'issue_id': 2765359837, 'author': 'Vigneshsekar', 'body': '@kavin-114, your recent PR may have caused this. Can you please check?', 'created_at': datetime.datetime(2025, 1, 7, 12, 10, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2575641632, 'issue_id': 2765359837, 'author': 'kavin-114', 'body': ""> @kavin-114, your recent PR may have caused this. Can you please check?\r\n\r\nI've checked, and I don't think that PR could be the cause of this issue since it specifically handles POS return invoices."", 'created_at': datetime.datetime(2025, 1, 7, 15, 54, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2579243738, 'issue_id': 2765359837, 'author': 'mihir-kandoi', 'body': '@franciscobuendiao Unable to reproduce even with the given steps. Can you please share a screen recording of this issue?\r\n\r\nHere is a screen recording of me **not** being able to replicate this.\r\n\r\nhttps://github.com/user-attachments/assets/55e086a4-58eb-4f30-b7e1-b5ac7da6ed43\r\n\r\nEdit:\r\n\r\nNote:\r\n\r\n1. The default payment mode being set to the full amount is intended behaviour\r\n2. New rows already start with 0\r\n3. This screen recording is only trying to replicate the ""Save"" issue', 'created_at': datetime.datetime(2025, 1, 9, 6, 2, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2582464488, 'issue_id': 2765359837, 'author': 'ljain112', 'body': 'https://github.com/frappe/erpnext/pull/45166', 'created_at': datetime.datetime(2025, 1, 10, 11, 15, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2591777923, 'issue_id': 2765359837, 'author': 'mihir-kandoi', 'body': '@franciscobuendiao does #45166 solve your issue?', 'created_at': datetime.datetime(2025, 1, 15, 6, 52, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2616384606, 'issue_id': 2765359837, 'author': 'mihir-kandoi', 'body': 'Confirmation not given. Closing.', 'created_at': datetime.datetime(2025, 1, 27, 17, 5, 10, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-04 12:11:39 UTC): Unable to reproduce on develop branch.
Can you try reproducing it on develop branch as well?

If you are also not able to reproduce on develop then it will become easier to isolate the issue.

franciscobuendiao (Issue Creator) on (2025-01-05 16:24:40 UTC): I currently don't have access to a develop branch environment to reproduce the issue, but I've identified the exact change in the code that's causing this behavior.

The change occurred in PR #37142 (commit 6d07d2) in the file `erpnext/accounts/doctype/sales_invoice/sales_invoice.py`, specifically in the `set_missing_values` method:

Before the change:
```
python
def set_missing_values(self, for_validate=False):
    if self.is_pos:
        if not self.payments:
            self.payments = []
            default_mode = get_mode_of_payment(self)
            if default_mode:
                self.append('payments', {
                    'mode_of_payment': default_mode,
                    'amount': 0,  # Initialize with 0
                    'default': 1
                })
```
                
After PR #37142:

```
def set_missing_values(self, for_validate=False):
    if self.is_pos:
        if not self.payments:
            self.payments = []
            default_mode = get_mode_of_payment(self)
            if default_mode:
                self.append('payments', {
                    'mode_of_payment': default_mode,
                    'amount': self.outstanding_amount,  # Now uses total amount
                    'default': 1
                })
```

The key difference is that previously, the payment amounts were initialized to 0, allowing users to manually set the amounts across different payment methods. Now, it automatically assigns the full outstanding amount to the default payment method.
This change affects the common use case where customers pay using multiple payment methods in a single transaction, as any attempt to modify the payment distribution reverts back to putting the full amount in the default payment mode after saving.
Environment details:

ERPNext Version: v15.47.3
Frappe Framework: v15.511

Vigneshsekar on (2025-01-07 12:10:42 UTC): @kavin-114, your recent PR may have caused this. Can you please check?

kavin-114 on (2025-01-07 15:54:53 UTC): I've checked, and I don't think that PR could be the cause of this issue since it specifically handles POS return invoices.

mihir-kandoi (Assginee) on (2025-01-09 06:02:53 UTC): @franciscobuendiao Unable to reproduce even with the given steps. Can you please share a screen recording of this issue?

Here is a screen recording of me **not** being able to replicate this.

https://github.com/user-attachments/assets/55e086a4-58eb-4f30-b7e1-b5ac7da6ed43

Edit:

Note:

1. The default payment mode being set to the full amount is intended behaviour
2. New rows already start with 0
3. This screen recording is only trying to replicate the ""Save"" issue

ljain112 on (2025-01-10 11:15:04 UTC): https://github.com/frappe/erpnext/pull/45166

mihir-kandoi (Assginee) on (2025-01-15 06:52:27 UTC): @franciscobuendiao does #45166 solve your issue?

mihir-kandoi (Assginee) on (2025-01-27 17:05:10 UTC): Confirmation not given. Closing.

"
2765291676,issue,open,,GTIN 14 not validating correctly,"### Information about bug

20813628068987 passes in external validation tools:

![image](https://github.com/user-attachments/assets/422ea1ae-7f88-4f97-ba13-cd7985cd34e8)

but fails in Item /barcode 

![image](https://github.com/user-attachments/assets/e7ed1a45-70d6-448a-aff0-8e9e558f8c5d)




### Module

stock

### Version

ERPNext: v15.47.3
Frappe Framework: v15.51.1

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",lansgt,2025-01-01 22:39:04+00:00,[],2025-01-01 22:40:11+00:00,,https://github.com/frappe/erpnext/issues/45034,"[('bug', None)]",[],
2765044268,issue,open,,Need column for ARABIC customer name and Item name in arabic ,"
Hi,

We need column for customer name and item code in arabic",sibyastropack,2025-01-01 12:32:34+00:00,[],2025-01-26 14:32:18+00:00,,https://github.com/frappe/erpnext/issues/45032,"[('feature-request', None)]","[{'comment_id': 2614449180, 'issue_id': 2765044268, 'author': 'mn3m-cs', 'body': 'Hi @sibyastropack \nYou can add a **Custom Field** throw customization to achieve this.\nread more on [Custom Field](https://docs.frappe.io/erpnext/user/manual/en/custom-field).\n\nto ship it with your application, export it as a fixture.', 'created_at': datetime.datetime(2025, 1, 26, 14, 32, 17, tzinfo=datetime.timezone.utc)}]","mn3m-cs on (2025-01-26 14:32:17 UTC): Hi @sibyastropack 
You can add a **Custom Field** throw customization to achieve this.
read more on [Custom Field](https://docs.frappe.io/erpnext/user/manual/en/custom-field).

to ship it with your application, export it as a fixture.

"
2764970402,issue,open,,Roles for Customer and Supplier Roles are much less,"### Information about bug

We have Customer and Supplier Roles as a Portal user. In V16 sites, it seems like roles assigned to Portal users are reset.

Supplier Roles

<img width=""1138"" alt=""Screenshot 2025-01-01 at 2 50 28 PM"" src=""https://github.com/user-attachments/assets/7cfb2e23-b0a9-45a5-be5d-59fe84a7ca97"" />

Customer Roles

<img width=""1150"" alt=""Screenshot 2025-01-01 at 3 29 51 PM"" src=""https://github.com/user-attachments/assets/2838eac5-1680-4f9d-9df5-acc0288c562d"" />

Frappe team can replicate it https://gadgetsv16.frappe.cloud/

<img width=""1143"" alt=""Screenshot 2025-01-01 at 3 34 23 PM"" src=""https://github.com/user-attachments/assets/67071e38-71ae-418c-9f53-c308e0cbb15c"" />


### Module

buying

### Version

V16

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",umairsy,2025-01-01 10:01:02+00:00,['rohitwaghchaure'],2025-01-03 10:13:35+00:00,,https://github.com/frappe/erpnext/issues/45030,"[('bug', None), ('v16', '')]",[],
2764646263,issue,open,,Historical Exchange Rate Not Applied in Payroll Entry,"### Information about bug

Description
The Payroll module in ERPNext does not apply historical exchange rates for transactions. The same functionality works as expected in other modules, such as Sales Invoices and Purchase Invoices, but fails when processing Payroll Entries.

Steps to Reproduce
Enable Allow Stale Exchange Rates in Currency Exchange Settings.
Add historical exchange rates for a currency pair (e.g., USD to CAD) in Accounts > Currency Exchange.
Create a Payroll Entry dated earlier than the current date, involving a multi-currency scenario.
Submit the Payroll Entry or attempt to process the Bank Entry.
Observe that the system does not fetch or apply the historical exchange rate and defaults to current behavior.
Expected Behavior
The Payroll module should apply the historical exchange rate based on the payroll entry date, similar to how it works in other modules like Sales Invoices or Purchase Invoices.

Actual Behavior
The Payroll module ignores the historical exchange rate and does not fetch or apply it. This causes inconsistencies and makes it difficult to process payroll with backdated entries.

Error Message
No error is displayed, but the historical exchange rate is not applied.

Environment Details
ERPNext Version: [e.g., v14.0.3]
Frappe Version: [e.g., v14.0.3]
Deployment Type: [Self-hosted / Cloud-hosted]
Exchange Rate Provider: [e.g., Currency Layer / Open Exchange Rates]
Base Currency: [e.g., CAD]
Payroll Currency: [e.g., USD]
Screenshots
Attach screenshots showing:

Currency Exchange setup with historical rates.
Payroll Entry configuration.
The journal entry or other output showing that the exchange rate was not applied.
Additional Context
The historical exchange rate functionality works correctly in other modules (e.g., Sales and Purchase) but fails in Payroll.
Enabling Allow Stale Exchange Rates does not resolve the issue in Payroll.
Manual entry of the exchange rate temporarily resolves the issue, but this is not ideal for automated workflows.
Steps Taken to Troubleshoot
Verified that historical exchange rates are correctly entered in Currency Exchange.
Confirmed that the same exchange rates work in Sales Invoices and Purchase Invoices.
Reviewed Payroll Entry settings and journal entry logs for anomalies.
Updated ERPNext to the latest version to rule out older bugs.
This issue affects multi-currency organizations that rely on accurate and automated historical exchange rates for payroll processing. Please address this inconsistency for smoother payroll operations.

### Module

HR

### Version

Environment Details
ERPNext Version: [e.g., v14.0.3]
Frappe Version: [e.g., v14.0.3]

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

```shell
no log output
```
",melhembitar,2024-12-31 20:02:11+00:00,[],2024-12-31 20:02:11+00:00,,https://github.com/frappe/erpnext/issues/45018,"[('bug', None)]",[],
2764537797,issue,open,,Better POS ,"Hello Guys, ERP NEXT is awesome its really help people to start in business world i just wanted to say it.

I have some features request :

- make cash register linkable with erpnext to automatically open it.
- link electronic payment terminals in stores with erpnext.

Thanks for this masterpiece.",RedWillDev,2024-12-31 16:49:23+00:00,[],2024-12-31 16:49:23+00:00,,https://github.com/frappe/erpnext/issues/45017,"[('feature-request', None)]",[],
2764282019,issue,open,,Stock Entry Type not getting translated for User with Language Türkçe,"### Information about bug

User is accessing the ERPNext system with Language Türkçe. Stock Entry Types are not getting translated and always comes in English.
When Custom Translation is entered for the Stock Entry Type, only the entries and status of the Stock Entry DocType is listed in Turkish.
When user wants to execute the transactions, the Stock Entry Types remain in English.

### Module

stock

### Version

ERPNext: v15.47.1 (version-15)
Frappe Framework: v15.51.0 (version-15)
Frappe HR: v15.37.1 (version-15)
Print Designer: v1.4.3 (main)

### Installation method

easy-install

### Relevant log output / Stack trace / Full Error Message.

_No response_",toofun666,2024-12-31 11:38:30+00:00,[],2024-12-31 11:38:30+00:00,,https://github.com/frappe/erpnext/issues/45012,"[('bug', None)]",[],
2764149273,issue,open,,Paused and Resume Button inside the timsheet dialog box ,"Hi team;

       we need a feature request to Add a Paused & Resume button into Timesheet Dialog Box . This is very helpfully for it Can you please helpme",Shubhamshinde2206,2024-12-31 09:16:46+00:00,[],2024-12-31 09:16:46+00:00,,https://github.com/frappe/erpnext/issues/45003,"[('feature-request', None)]",[],
2764066022,issue,closed,completed,"[UX] GL Entry print format, Party Type isn't rendered well","### Information about bug

Highlighted in the screenshot

<img width=""1160"" alt=""Screenshot 2024-12-31 at 1 06 42 PM"" src=""https://github.com/user-attachments/assets/b423df6f-a174-4160-a2fd-c2968c7f098a"" />


### Module

accounts

### Version

V16

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",umairsy,2024-12-31 07:40:32+00:00,['iamejaaz'],2025-01-28 00:10:22+00:00,2025-01-13 06:22:46+00:00,https://github.com/frappe/erpnext/issues/45000,"[('UX', ''), ('v16', '')]",[],
2764053318,issue,closed,completed,[UX] Sales Invoice - Prompt on Payment Due Date,"### Information about bug

Steps to replicate:

- First scenario: Create a new Sales Invoice > Set Payment Due Date > Save > Change Payment Due Date
- Second scenario: Duplicate Sales Invoice > Change Payment Due Date
- Third scenario: Sales Order is converted into Sales Invoice > user changes Payment Due Date

<img width=""1157"" alt=""Screenshot 2024-12-31 at 12 08 40 PM"" src=""https://github.com/user-attachments/assets/6c7e013d-75b4-4540-bd32-992100286f9d"" />

Just the message isn't helpful, esp. for the new user, as Payment Schedule table isn't easy to locate. Here are the two proposal for enhancing the UX.

- If there is only single row found in the payment schedule, then simply update new date, as user has explicitly selected it.
- Even if there is multiple rows in the payment schedule, we can ask for the confirmation in the dialog itself and update dates in the payment schedule?

#### Edit

If old Due Date remains in the schedule, then this validation message is thrown. I have updated the Due Date in the main section, but still message. 

Also, the validation message about Supplier's invoice date field is wrong, as Sales Invoice doesn't have Supplier Invoice Date field at all. @nabinhait has context over it.

<img width=""1142"" alt=""Screenshot 2024-12-31 at 3 26 24 PM"" src=""https://github.com/user-attachments/assets/cb69e40d-d03c-425f-b3ad-9828e97d3f1d"" />

### Module

accounts

### Version

V15 and V16

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",umairsy,2024-12-31 07:24:30+00:00,['iamejaaz'],2025-01-23 00:10:13+00:00,2025-01-08 07:19:03+00:00,https://github.com/frappe/erpnext/issues/44998,"[('UX', ''), ('v16', '')]",[],
2764029094,issue,closed,completed,Sales Invoice - Buttons for next action,"Even after an invoice is saved, there are too many buttons on the top.

1. Can we move option for fetching Timesheet into Fetch From only?
2. Can we have only one primary on the Sales Invoice? In the following screen, Create is Primary, with ""Quality Inspection"" as a option in it. It's not even required, as there is no ""Update Stock"" checked in it. We should show ""Quality Inspection"" only if Update Stock is checked. Or even if we didn't show, system does give a prompt. Excuse if am missing some use-case.

<img width=""1160"" alt=""Screenshot 2024-12-31 at 12 14 53 PM"" src=""https://github.com/user-attachments/assets/e36e5c23-1015-4c31-9f50-045d3a191a98"" />


<img width=""1091"" alt=""Screenshot 2024-12-31 at 12 22 12 PM"" src=""https://github.com/user-attachments/assets/43569b9c-039d-43ad-a912-2674492e7fa8"" />
",umairsy,2024-12-31 06:54:47+00:00,['iamejaaz'],2025-01-22 00:10:11+00:00,2025-01-07 11:48:01+00:00,https://github.com/frappe/erpnext/issues/44995,"[('UX', ''), ('v16', '')]",[],
2763154345,issue,closed,completed,Padding for table on the right,"### Information about bug

Even though window has full-width, in the report view, the last column needs scroll to see value. Ideally, there should be padding on the both the sides?

Also, check the field and button below table, for selecting no. of levels of tree you want to show. (Button names are Set Level, Collapse All)

<img width=""1280"" alt=""Screenshot 2024-12-30 at 6 06 20 PM"" src=""https://github.com/user-attachments/assets/c7b6a802-0eeb-49c5-ae65-968d5e92f965"" />




### Module

accounts

### Version

V16

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",umairsy,2024-12-30 12:39:45+00:00,['sokumon'],2025-01-23 00:10:12+00:00,2025-01-08 08:52:13+00:00,https://github.com/frappe/erpnext/issues/44984,"[('bug', None), ('v16', '')]",[],
2763093594,issue,closed,completed,Alignment of buttons disturbed due to window size,"### Information about bug

incase of smaller screen size, buttons overlapping with section break.

<img width=""1156"" alt=""Screenshot 2024-12-30 at 5 15 08 PM"" src=""https://github.com/user-attachments/assets/2317d33d-6d12-4009-a3ed-9bedb68dd0c1"" />

Incase of full-width window as well, button alignment isn't ideal.

<img width=""1279"" alt=""Screenshot 2024-12-30 at 5 18 07 PM"" src=""https://github.com/user-attachments/assets/b5c19f3a-1ae6-49c3-bf78-5569c569b364"" />


### Module

accounts

### Version

V16

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",umairsy,2024-12-30 11:50:36+00:00,['sokumon'],2025-01-25 00:09:58+00:00,2025-01-10 10:22:32+00:00,https://github.com/frappe/erpnext/issues/44982,"[('bug', None), ('v16', '')]",[],
2763039518,issue,closed,completed,Item image doesn't render correctly,"### Information about bug

Issues:

1. I attached an image by providing a web link to an image. Though link got attached to doc, image didn't render in the block.

2. Then I got the image locally and then attached the image by picking the image file from local. Again, image got attached but image didn't render in the block.

3. Then tried ""refresh"", and image appeared, but overflowing the allotted container.

<img width=""1280"" alt=""Screenshot 2024-12-30 at 4 31 29 PM"" src=""https://github.com/user-attachments/assets/265c2276-7da7-47eb-accd-4ba1da3b2ef1"" />


### Module

stock

### Version

V16

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",umairsy,2024-12-30 11:06:11+00:00,['sokumon'],2025-01-17 00:10:24+00:00,2025-01-02 14:02:59+00:00,https://github.com/frappe/erpnext/issues/44981,"[('bug', None)]","[{'comment_id': 2567822911, 'issue_id': 2763039518, 'author': 'sokumon', 'body': 'Closing this as this originates from framework and it is solved here https://github.com/frappe/frappe/pull/28987', 'created_at': datetime.datetime(2025, 1, 2, 14, 2, 59, tzinfo=datetime.timezone.utc)}]","sokumon (Assginee) on (2025-01-02 14:02:59 UTC): Closing this as this originates from framework and it is solved here https://github.com/frappe/frappe/pull/28987

"
2763026445,issue,closed,completed,General ledger Remarks Issue,"### Information about bug

In General ledger the remarks field is replaced with Supplier's invoice number, as a result while printing statement of accounts the system is not fetching remarks in default print format

below are the screenshot for reference

![Screenshot 2024-12-30 at 14-51-20 General Ledger](https://github.com/user-attachments/assets/d27006a8-fa26-4b12-a74a-da263edcd6a0)



![Screenshot 2024-12-30 at 14-53-03 General Ledger_KHALID SIYAR AL ENAZY   PARTNERS CO LTD_2024-11-30_2024-12-30___Group by Voucher (Consolidated)______1_1 pdf](https://github.com/user-attachments/assets/f19c0426-3973-411a-8d77-b6cb5193f47e)


### Module

accounts, buying, selling

### Version

same error in V15 and V16 latest update



### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",maveezmh,2024-12-30 10:55:55+00:00,['mihir-kandoi'],2025-01-30 00:09:59+00:00,2025-01-15 09:18:56+00:00,https://github.com/frappe/erpnext/issues/44980,"[('bug', None), (""can't-reproduce"", 'We are unable to reproduce this bug, provide more information.'), ('need-more-info', 'Provide additional context, steps to reproduce this issue.')]","[{'comment_id': 2571271172, 'issue_id': 2763026445, 'author': 'mihir-kandoi', 'body': 'Can you try clicking on the ""Show remarks"" button (like in the screenshot you provided) and try again?', 'created_at': datetime.datetime(2025, 1, 4, 12, 15, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2585212136, 'issue_id': 2763026445, 'author': 'saivineeth100', 'body': 'if show remarks is checked, pdf will have remarks\r\nbut we need to change pdf format in a way that if show remarks column is not checked then that column should not be there', 'created_at': datetime.datetime(2025, 1, 11, 11, 38, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2591774294, 'issue_id': 2763026445, 'author': 'mihir-kandoi', 'body': 'I am not able to reproduce this issue. I do not have the ""Remarks"" field in the PDF or print file by default. Please provide replication steps.', 'created_at': datetime.datetime(2025, 1, 15, 6, 49, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2592014101, 'issue_id': 2763026445, 'author': 'saivineeth100', 'body': ""It's there in v15, \nin develop it is fixed by https://github.com/frappe/erpnext/pull/44057\n\nRefer this https://github.com/frappe/erpnext/pull/44057#pullrequestreview-2445452913 & https://github.com/frappe/erpnext/pull/44057#issuecomment-2489202897"", 'created_at': datetime.datetime(2025, 1, 15, 9, 4, 6, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-04 12:15:58 UTC): Can you try clicking on the ""Show remarks"" button (like in the screenshot you provided) and try again?

saivineeth100 on (2025-01-11 11:38:33 UTC): if show remarks is checked, pdf will have remarks
but we need to change pdf format in a way that if show remarks column is not checked then that column should not be there

mihir-kandoi (Assginee) on (2025-01-15 06:49:36 UTC): I am not able to reproduce this issue. I do not have the ""Remarks"" field in the PDF or print file by default. Please provide replication steps.

saivineeth100 on (2025-01-15 09:04:06 UTC): It's there in v15, 
in develop it is fixed by https://github.com/frappe/erpnext/pull/44057

Refer this https://github.com/frappe/erpnext/pull/44057#pullrequestreview-2445452913 & https://github.com/frappe/erpnext/pull/44057#issuecomment-2489202897

"
2762893797,issue,open,,Corrective Job Card Raw Material cost Not Added in the Finished Goods Valuation Cost,"In Manufacturing Some of the Operations has failure and it will require the necessary Corrective Job Card and adding some other material with respective quantity. This Material transaction was not Preplanned and which is only planned by while create the corrective Job Card and Material Transaction. And after Completing Production while transfer the goods from Work in Progress warehouse to Finished goods warehouse, the stock entry does not show the corrective Job card details and also the cost was not added in the finished goods valuation rate.
<img width=""835"" alt=""image"" src=""https://github.com/user-attachments/assets/9542aad9-e61d-4260-85bd-1850a7c073dd"" />
<img width=""830"" alt=""image"" src=""https://github.com/user-attachments/assets/68feb3bc-0705-426e-9232-bff68f25f68f"" />
",prasathchandrasekar,2024-12-30 09:07:15+00:00,[],2025-01-09 16:08:13+00:00,,https://github.com/frappe/erpnext/issues/44976,"[('feature-request', None), ('work-in-progress', None)]",[],
2762790549,issue,open,,Customisation on birthday and work anniversary reminder messages required,There is a requirement for customising the birthday and work anniversary messages which are fixed by the system currently.,sabiha-sh,2024-12-30 07:39:04+00:00,['mihir-kandoi'],2025-01-09 16:08:37+00:00,,https://github.com/frappe/erpnext/issues/44968,"[('feature-request', None), ('Low Priority', '')]","[{'comment_id': 2566155583, 'issue_id': 2762790549, 'author': 'lansgt', 'body': '+1', 'created_at': datetime.datetime(2024, 12, 31, 5, 54, 18, tzinfo=datetime.timezone.utc)}]","lansgt on (2024-12-31 05:54:18 UTC): +1

"
2762760896,issue,open,,"In COGS system, item group wise GL is required during GRN","For an example, there are two items :- Color and Chemical (when we talk about textile process house)

Both the items belong to the same warehouse but they have different characteristics and so have different groups.

The person viewing the ledger should have differentiation in GL based on Color and Chemical. He/she would want to see Color consumption separately and chemical consumption separately.

Currently the system allows to have only one GL against the warehouse.",sabiha-sh,2024-12-30 07:07:43+00:00,[],2024-12-30 07:07:43+00:00,,https://github.com/frappe/erpnext/issues/44967,"[('feature-request', None)]",[],
2762259337,issue,open,,Reusability of Defined Operations in ERPNext Manufacturing Module ,"In the ERPNext manufacturing module, the `Operation` doctype is used in `BOM Operation`. By design, operations appear to be intended for reuse across multiple BOMs. However, the `Operation` doctype includes a field for the ""quality inspection template"" which assumes that the same inspection template applies to all `BOM Operations` using the operation. This design is problematic because quality inspection requirements often vary depending on the context in which the operation is used.

#### Proposed Solutions
To address this issue assuming that opertions are supposed to be reusable (correct me if I am wrong):  
- **Option 1**:
  - Remove the ""quality inspection template"" field from the `Operation` doctype.  
  - Move this field to the `BOM Operation` doctype, enabling BOM-specific quality inspection templates to be assigned.  
- **Option 2**:
  - Retain the ""quality inspection template"" field in the `Operation` doctype as a default template.  
  - Allow users to override the default template by selecting a BOM-specific quality inspection template in the `BOM Operation` doctype.

I would be happy to submit a merge request if either solution is accepted.
",alirezamohammadi,2024-12-29 13:47:27+00:00,[],2025-02-04 10:36:21+00:00,,https://github.com/frappe/erpnext/issues/44953,"[('feature-request', None)]","[{'comment_id': 2580686808, 'issue_id': 2762259337, 'author': 'mihir-kandoi', 'body': 'I think Option 2 would be a better approach.', 'created_at': datetime.datetime(2025, 1, 9, 16, 12, 6, tzinfo=datetime.timezone.utc)}, {'comment_id': 2633508387, 'issue_id': 2762259337, 'author': 'alirezamohammadi', 'body': '> I think Option 2 would be a better approach.\n\nThanks for your reply! I see the benefit of Option 2 in providing a default while still allowing customization at the BOM level. \nWhat is the procedure for adding such features to an application? I added this feature in my custom app, but I think many users need this.', 'created_at': datetime.datetime(2025, 2, 4, 10, 36, 20, tzinfo=datetime.timezone.utc)}]","mihir-kandoi on (2025-01-09 16:12:06 UTC): I think Option 2 would be a better approach.

alirezamohammadi (Issue Creator) on (2025-02-04 10:36:20 UTC): Thanks for your reply! I see the benefit of Option 2 in providing a default while still allowing customization at the BOM level. 
What is the procedure for adding such features to an application? I added this feature in my custom app, but I think many users need this.

"
2761152410,issue,open,,Tax validation causes unwanted change in Purchase Invoice Item Tax Template,"### Information about bug

The following alert is displayed when a tax template is chosen which has a validity start date later than the invoice date:

> Item Tax template updated as per validity and rate applied.

This is unwanted behaviour, as e.g. some invoices will span two tax rate validity periods and the tax on one item will still be calculated according to the old tax rate, while the tax on another item on the same invoice will be calculated according to the new tax rate. This is especially important on invoices for subscription services (such as domain names, for example).

While such an alert is acceptable, it should not modify the user's selection in the invoice items, causing the calculated total to become wrong.

### Module

accounts

### Version

erpnext 15.39.3
erpnextswiss 1.25.0
frappe 15.45.1
hrms 15.33.0
payments 0.0.1

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

```shell
""Item Tax template updated as per validity and rate applied""
```
",konradbr,2024-12-27 18:10:34+00:00,[],2025-01-02 09:22:14+00:00,,https://github.com/frappe/erpnext/issues/44947,"[('bug', None)]","[{'comment_id': 2563929108, 'issue_id': 2761152410, 'author': 'konradbr', 'body': '### Note\r\n\r\nThis only happens when the Tax Template ""valid from"" dates are set in the corresponding [Stock] Item settings.', 'created_at': datetime.datetime(2024, 12, 27, 18, 17, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2567387117, 'issue_id': 2761152410, 'author': 'ljain112', 'body': 'This is expected behaviour if filters like tax category, valid form, and valid to are set in Item Master and if the item tax template is set in item the item tax template will be validated and updated.', 'created_at': datetime.datetime(2025, 1, 2, 7, 49, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2567474175, 'issue_id': 2761152410, 'author': 'konradbr', 'body': '@ljain112 Thank you for looking into this issue.\r\n\r\n> This is expected behaviour if filters like tax category, valid form, and valid to are set in Item Master and if the item tax template is set in item the item tax template will be validated and updated.\r\n\r\nThis is **not** expected behaviour: the user should always be **able to override settings per item**. An Item Master should not re-set user overrides, thence this should be modified. As I mentioned, an alert could be an option, but it **must be possible** for the user to set whatever Item Tax template he deems appropriate, exactly for the type of scenario (different tax rates for the same item on the same invoice) that I described.', 'created_at': datetime.datetime(2025, 1, 2, 9, 19, 40, tzinfo=datetime.timezone.utc)}]","konradbr (Issue Creator) on (2024-12-27 18:17:24 UTC): ### Note

This only happens when the Tax Template ""valid from"" dates are set in the corresponding [Stock] Item settings.

ljain112 on (2025-01-02 07:49:02 UTC): This is expected behaviour if filters like tax category, valid form, and valid to are set in Item Master and if the item tax template is set in item the item tax template will be validated and updated.

konradbr (Issue Creator) on (2025-01-02 09:19:40 UTC): @ljain112 Thank you for looking into this issue.


This is **not** expected behaviour: the user should always be **able to override settings per item**. An Item Master should not re-set user overrides, thence this should be modified. As I mentioned, an alert could be an option, but it **must be possible** for the user to set whatever Item Tax template he deems appropriate, exactly for the type of scenario (different tax rates for the same item on the same invoice) that I described.

"
2761139626,issue,closed,completed,Add Phone Number Field to Payment Request for Phone-Based Payment Channels,"### Description:

Currently, the Payment Request doctype in ERPNext lacks a dedicated field for capturing the phone number when the payment channel is phone-based. This enhancement proposes adding a **Phone Number** field to the Payment Request, which will be applicable when the selected payment channel is **Phone**.

This feature will be particularly useful for scenarios where phone-based payments, such as **Mpesa STK Push**, are used. By capturing the payer's phone number directly in the Payment Request, the system can streamline payment processing by enabling real-time STK push to the specified phone number.
![image](https://github.com/user-attachments/assets/4686911f-5518-4dd4-8894-57191c377195)


### Benefits:

1.  **Enhanced Payment Experience**:
    
    -   Enables capturing the payer's phone number directly in the Payment Request.
    -   Facilitates real-time payment requests for phone-based channels, such as Mpesa.
2.  **Improved Integration**:
    
    -   Adds flexibility to use phone-based payments across modules like **Webshop** and **POS Standards**.
    -   Makes it easier to integrate ERPNext with local payment gateways that rely on phone numbers.
3.  **Use Case Coverage**:
    
    -   Improves the utility of the Payment Request for users in regions where mobile payment systems are dominant.

### Implementation:

-   **Frontend**:
    
    -   Add a **Phone Number** field to the Payment Request doctype.
    -   Conditionally display the Phone Number field when the payment channel is set to **Phone**.
-   **Backend**:
    
    -   Validate the phone number format during submission.
    -   Ensure the phone number is passed to the appropriate payment gateway for processing.

### Compatibility:

This feature is backward-compatible and will not affect existing functionality. The Phone Number field will only be visible and required when the payment channel is set to **Phone**.",maniamartial,2024-12-27 17:55:46+00:00,['mihir-kandoi'],2025-01-26 00:10:43+00:00,2025-01-11 16:33:03+00:00,https://github.com/frappe/erpnext/issues/44945,"[('feature-request', None), ('awaiting confirmation', 'Awaiting confirmation from user to close the issue')]","[{'comment_id': 2580693341, 'issue_id': 2761139626, 'author': 'mihir-kandoi', 'body': '@maniamartial Is your issue fixed?', 'created_at': datetime.datetime(2025, 1, 9, 16, 14, 6, tzinfo=datetime.timezone.utc)}, {'comment_id': 2581171863, 'issue_id': 2761139626, 'author': 'maniamartial', 'body': 'Yes, I opened a PR and it was merged. I need to close on this.', 'created_at': datetime.datetime(2025, 1, 9, 20, 17, 22, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-09 16:14:06 UTC): @maniamartial Is your issue fixed?

maniamartial (Issue Creator) on (2025-01-09 20:17:22 UTC): Yes, I opened a PR and it was merged. I need to close on this.

"
2760657461,issue,open,,Chart of Accounts tooltip does not disappear,"### Information about bug

![image](https://github.com/user-attachments/assets/8169b96c-b18d-40c3-8c9b-e646af74c6c8)
I scrolled over Chart of Accounts from the Home main menu and the tooltip appeared. I clicked Chart of Accounts, but I received a permissions error that did not allow me to enter Chart of Accounts. I went to the awesome bar and typed in Chart of Accounts, and that let me view the Chart of Accounts. However, the tooltip never disappeared.

### Module

accounts

### Version

Installed Apps
ERPNext: v15.45.4 (HEAD)

Frappe Framework: v15.50.0 (HEAD)

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",gitforgrant,2024-12-27 09:47:53+00:00,[],2024-12-27 09:47:53+00:00,,https://github.com/frappe/erpnext/issues/44938,"[('bug', None)]",[],
2760657156,issue,closed,completed,Error when open Asset Item. No tabs are loaded,"### Information about bug

1. Filter Fixed Asset item
2. Open any item

Frappe team can replicate in the same site as mentioned below.

<img width=""1158"" alt=""Screenshot 2024-12-27 at 3 13 21 PM"" src=""https://github.com/user-attachments/assets/e7833b18-3435-4c0b-9769-f72ff92eba77"" />


### Module

stock

### Version

V16

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

```shell
utils.js:1078 let out = gst_settings.validate_hsn_code && doc.is_sales_item; return out
eval @ utils.js:1078Understand this errorAI
script_manager.js:32 ƒ (frm, asset_naming_series) {
		if ((frm.doc.__onload && frm.doc.__onload.asset_naming_series) || asset_naming_series) {
			let naming_series =
				(frm.doc.__onload && frm.doc.__onload.asset_naming_s…
d @ script_manager.js:32Understand this errorAI
script_manager.js:32 ƒ (frm) {
		india_compliance.set_hsn_code_query(frm.get_field(""gst_hsn_code""));
	}
d @ script_manager.js:32Understand this errorAI
utils.js:1077 Error evaluating the following expression:
utils.js:1078 let out = gst_settings.validate_hsn_code && doc.is_sales_item; return out
eval @ utils.js:1078Understand this errorAI
messages.js:26 Uncaught (in promise) Error: Invalid ""depends_on"" expression
    at frappe.throw (messages.js:26:8)
    at frappe.ui.form.Layout.evaluate_depends_on_value (layout.js:795:12)
    at frappe.ui.form.Layout.set_dependant_property (layout.js:741:27)
    at frappe.ui.form.Layout.refresh_dependency (layout.js:725:10)
    at frappe.ui.form.Form.refresh_field (form.js:1408:16)
    at frappe.ui.form.Form.set_df_property (form.js:1650:10)
    at frappe.ui.form.Layout.set_dependant_property (layout.js:765:14)
    at frappe.ui.form.Layout.refresh_dependency (layout.js:725:10)
    at frappe.ui.form.Form.refresh_field (form.js:1408:16)
    at frappe.ui.form.Form.set_df_property (form.js:1650:10)Understand this errorAI
item__js:1027 Uncaught (in promise) ReferenceError: india_compliance is not defined
    at onload (item__js:1027:3)
    at d (script_manager.js:30:12)
    at n (script_manager.js:109:16)
    at script_manager.js:127:22Understand this errorAI
messages.js:26 Uncaught (in promise) Error: Invalid ""depends_on"" expression
    at frappe.throw (messages.js:26:8)
    at frappe.ui.form.Layout.evaluate_depends_on_value (layout.js:795:12)
    at frappe.ui.form.Layout.set_dependant_property (layout.js:741:27)
    at frappe.ui.form.Layout.refresh_dependency (layout.js:725:10)
    at frappe.ui.form.Layout.refresh (layout.js:351:8)
    at frappe.ui.form.Form.refresh_fields (form.js:687:15)
    at form.js:626:16
```
",umairsy,2024-12-27 09:47:38+00:00,['sokumon'],2025-01-25 00:09:55+00:00,2025-01-07 10:22:05+00:00,https://github.com/frappe/erpnext/issues/44937,"[('bug', None), ('v16', '')]","[{'comment_id': 2582526153, 'issue_id': 2760657156, 'author': 'umairsy', 'body': '@sokumon thanks for the fixes. In this case, was there any fix required?', 'created_at': datetime.datetime(2025, 1, 10, 11, 50, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2582636265, 'issue_id': 2760657156, 'author': 'sokumon', 'body': '@umairsy no it was due to something which was fixed earlier', 'created_at': datetime.datetime(2025, 1, 10, 12, 48, 6, tzinfo=datetime.timezone.utc)}]","umairsy (Issue Creator) on (2025-01-10 11:50:13 UTC): @sokumon thanks for the fixes. In this case, was there any fix required?

sokumon (Assginee) on (2025-01-10 12:48:06 UTC): @umairsy no it was due to something which was fixed earlier

"
2760426625,issue,open,,Linking sibling rows in Child table,"# Issue

Consider a Pricing Rule where `Item B` is setup as a free item for `Item A`. When user added `Item A` system automatically adds `Item B` to the document. Currently there is no reliable way to identify which row in the Items table triggered the addition of the free item

# Possible Solution

Adding a new field in child table that holds the primary key (`name`) of the row that triggered the free item.

# Limitations

On an unsaved new Sales Invoice, `Items` have auto-generated temporary names (ex: new-sales-invoice-item-sdjkfg). 

## Before save
```
| name                          | Item Code | ... | Linked to                     | context                    |
|-------------------------------+-----------+-----+-------------------------------+----------------------------|
| new-sales-invoice-item-sdjkfg | Item A    |     |                               | Primary Item added by user |
| new-sales-invoice-item-eirwhn | Item B    |     | new-sales-invoice-item-sdjkfg | free item added by system  |
```

This gets overridden by upon first save with an hash name, due to which the link becomes invalid on first save.
## After save
```
| name   | Item Code | ... | Linked to                     | context                    |
|--------+-----------+-----+-------------------------------+----------------------------|
| erutfg | Item A    |     |                               | Primary Item added by user |
| lkdfjg | Item B    |     | new-sales-invoice-item-sdjkfg | free item added by system  |
```

",ruthra-kumar,2024-12-27 05:42:38+00:00,['ruthra-kumar'],2025-01-14 11:54:42+00:00,,https://github.com/frappe/erpnext/issues/44929,"[('bug', None)]","[{'comment_id': 2566287019, 'issue_id': 2760426625, 'author': 'ruthra-kumar', 'body': 'Even for a partially working solution, change in Framework will be required.', 'created_at': datetime.datetime(2024, 12, 31, 9, 36, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2589718847, 'issue_id': 2760426625, 'author': 'ruthra-kumar', 'body': 'part of: https://github.com/frappe/erpnext/issues/42195', 'created_at': datetime.datetime(2025, 1, 14, 11, 54, 7, tzinfo=datetime.timezone.utc)}]","ruthra-kumar (Issue Creator) on (2024-12-31 09:36:44 UTC): Even for a partially working solution, change in Framework will be required.

ruthra-kumar (Issue Creator) on (2025-01-14 11:54:07 UTC): part of: https://github.com/frappe/erpnext/issues/42195

"
2759764614,issue,closed,completed,Chart of Account Issue in ERPNext,"### Information about bug

Can not create an Account in the Chart of Accounts in ErpNext 

When creating an Account under Cash in Hand it's showing this issue and not creating the account.

<img width=""849"" alt=""image"" src=""https://github.com/user-attachments/assets/5d400611-8730-47b6-aaa4-c5719af28b35"" />


### Module

accounts

### Version

ERPNext: v15.28.0 (version-15)

Frappe Framework: v15.32.0 (version-15)

Frappe HR: v15.23.0 (version-15)

Frappe Lending: v0.0.1 (develop)

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",Aamir14all,2024-12-26 13:16:20+00:00,[],2025-02-01 00:11:22+00:00,2025-01-17 10:01:49+00:00,https://github.com/frappe/erpnext/issues/44924,"[('bug', None)]","[{'comment_id': 2597865956, 'issue_id': 2759764614, 'author': 'nabinhait', 'body': ""Can't replicate it. But this validation comes when the newly added account name is already present in the tree as its grandparent node."", 'created_at': datetime.datetime(2025, 1, 17, 10, 1, 49, tzinfo=datetime.timezone.utc)}]","nabinhait on (2025-01-17 10:01:49 UTC): Can't replicate it. But this validation comes when the newly added account name is already present in the tree as its grandparent node.

"
2759341350,issue,open,,Option to set Stock valuation method company wise,"### Information about bug

there are certain scenarios where each company within one instance should have different valuation method. one company might have fifo while other will have moving average method. 

right now there is no provision to set valuation method based on company.

### Module

accounts, stock

### Version

V15

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",maveezmh,2024-12-26 06:25:46+00:00,['mihir-kandoi'],2025-01-09 16:15:01+00:00,,https://github.com/frappe/erpnext/issues/44914,"[('feature-request', None)]",[],
2759277013,issue,open,,Book appointment date block issue.,"

**Is your feature request related to a problem? Please describe.**

**Describe the solution you'd like**


ERPNext: v15.42.0 (HEAD)
Frappe Framework: v15.47.2 (HEAD)

Our ""book appointment"" event is date-selective, and it works properly on Chrome and desktop. However, when users have an ISO phone or tablet, it is not functioning correctly, and any date can be selected for the appointment. Please check and fix this issue.

I've added a screenshot as well; please check it.

example: iPhone SS
![6MAciIj](https://github.com/user-attachments/assets/8a137738-5a27-4ec3-9eea-33074c184546)

chrome & desktop.
![lMNOQ24](https://github.com/user-attachments/assets/6fd25f85-d6b9-4f24-8ae4-8ca1c2a97e1e)


",precihole,2024-12-26 04:57:54+00:00,[],2024-12-26 04:57:54+00:00,,https://github.com/frappe/erpnext/issues/44912,"[('feature-request', None)]",[],
2758891940,issue,closed,completed,Ability to enforce validation of BOM formula/ratios in Stock Entry's items table,"Currently, the users are able to edit the items table in a stock entry (Manufacture) in any way they want, causing issues when they delete items or modify quantity randomly. We should have ability to enforce BOM ratios as validation. For example, if in BOM it is defined:

* 1 X -> 2 Y, 3 Z

Then the user should not be able to delete Y and Z, and also validate the ratio 1:2 and 1:3 (of course the overall quantity could be changed).",NagariaHussain,2024-12-25 16:47:32+00:00,['rohitwaghchaure'],2025-01-17 00:10:26+00:00,2025-01-02 08:14:30+00:00,https://github.com/frappe/erpnext/issues/44909,"[('feature-request', None)]","[{'comment_id': 2562181885, 'issue_id': 2758891940, 'author': 'dineshpanchal93', 'body': 'Wow - Waiting for this feature from long time.', 'created_at': datetime.datetime(2024, 12, 26, 5, 46, 14, tzinfo=datetime.timezone.utc)}]","dineshpanchal93 on (2024-12-26 05:46:14 UTC): Wow - Waiting for this feature from long time.

"
2758709408,issue,open,,Stock and Account Value Comparision Report,"Stock and Account Value Comparision Report
the report should include Landed Cost Value in Account Value columns or added new column as Landed Cost Value
",thida-bcn,2024-12-25 10:22:50+00:00,[],2024-12-25 10:22:50+00:00,,https://github.com/frappe/erpnext/issues/44905,"[('feature-request', None)]",[],
2758439616,issue,open,,POS with multiple currency payments ,"In my country, we use multiple currencies. 
**NIO** as the primary currency and **USD** as a foreign currency.  
Currently, POS does not support handling payments in multiple currencies. For example:

1. Customers may pay using a combination of USD and NIO (cash or card).
2. If a product is priced in USD (e.g., $47.50), customers may pay $50 in cash, and we provide the change in NIO.

These scenarios are common in multi-currency environments, but the current POS system lacks the capability to handle them, leading to manual workarounds and inaccuracies in reconciliation.

**Describe the solution you’d like**
I would like the POS to support multi-currency payments with the following features:

1. The ability to accept payments in both the configured base currency (e.g., NIO) and a foreign currency (e.g., USD) simultaneously.
2. Support for split payments in multiple currencies (e.g., part in USD cash, part in NIO card).
3. Handling change in a different currency. For instance: if a product is $47.50 and the customer pays $50 in USD, the system should calculate and display the change in NIO

Describe alternatives you’ve considered

1. Manually creating sales invoice with base currency payments and with Payment entry for foreign currency. This is error-prone and disrupts workflow.
2. Creating separate POS profiles for USD and NIO, which complicates operations and leads to reconciliation issues.

**Additional context**
In my business, we accept payments in both currencies via cash, credit card, and bank transfers. Customers frequently use mixed payment methods, such as paying part in USD cash and part in NIO card. Additionally, it’s common for customers to pay in USD for products priced in USD, with the change provided in NIO.

This feature would significantly enhance the POS usability for businesses operating in multi-currency environments. It would streamline operations, improve reporting accuracy, and provide a better experience for both staff and customers.",JeansReal,2024-12-25 03:01:36+00:00,[],2024-12-25 03:01:36+00:00,,https://github.com/frappe/erpnext/issues/44901,"[('feature-request', None)]",[],
2758248218,issue,closed,completed,tax template is not applied when sales invoice is created with rest api,"### Information about bug

automatic tax determination should be done by erpnext when sales invoice are generated by api.

### Module

accounts

### Version

version 15

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

```shell
NO Error but invoices are created without tax when created via api.


sample request:

{
    ""customer"": ""Customer A"",
    ""company"": ""ABC"",
    ""currency"": ""EUR"",
    ""items"": [
      {
        ""item_code"": ""Execution"",
        ""qty"": 100,
        ""rate"": 500
      }
    ],
    ""sales_team"": [],
    ""payments"": [],
    ""timesheets"": [],
    ""payment_schedule"": [
    ]
} 
```
",pritambiswal,2024-12-24 20:16:43+00:00,['mihir-kandoi'],2025-01-30 17:54:43+00:00,2025-01-30 17:54:43+00:00,https://github.com/frappe/erpnext/issues/44900,"[('bug', None)]","[{'comment_id': 2623605750, 'issue_id': 2758248218, 'author': 'mihir-kandoi', 'body': '@ruthra-kumar shall we close this issue now that PR is merged?', 'created_at': datetime.datetime(2025, 1, 30, 6, 14, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2623659491, 'issue_id': 2758248218, 'author': 'ruthra-kumar', 'body': '> [@ruthra-kumar](https://github.com/ruthra-kumar) shall we close this issue now that PR is merged?\n\nYes', 'created_at': datetime.datetime(2025, 1, 30, 6, 55, 24, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-30 06:14:23 UTC): @ruthra-kumar shall we close this issue now that PR is merged?

ruthra-kumar on (2025-01-30 06:55:24 UTC): Yes

"
2757681654,issue,closed,not_planned,Delivery Status In sales order,"### Information about bug

![Screenshot from 2024-12-24 17-28-00](https://github.com/user-attachments/assets/aa3ed9df-318a-4b46-b9a1-93b7c28b64c1)


i have created sales order with 10 qty and one free item,item has Batch configuration enabled 
![Screenshot from 2024-12-24 17-28-28](https://github.com/user-attachments/assets/cf76a919-e678-4cca-9422-7a2b573089c3)
![Screenshot from 2024-12-24 17-28-13](https://github.com/user-attachments/assets/938be1a3-551b-4d29-98e2-11890d1f4ee4)

Created delivery note with different line item for same item code to mention different batches

after submitting the delivery note it does not updating delivery status in sales order properly

### Module

stock, selling

### Version

ERPNext: v15.45.5 (HEAD)

Frappe Framework: v15.50.0 (HEAD)

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",poojavadher,2024-12-24 12:02:56+00:00,['mihir-kandoi'],2025-02-03 10:09:40+00:00,2025-02-03 10:09:40+00:00,https://github.com/frappe/erpnext/issues/44895,"[('bug', None), ('awaiting confirmation', 'Awaiting confirmation from user to close the issue')]","[{'comment_id': 2591769088, 'issue_id': 2757681654, 'author': 'mihir-kandoi', 'body': 'Instead of creating a new line item in the delivery note, please try duplicating the row for which you are changing the batch. A new line item will not have the correct references to the Sales Order which is why you are experiencing this issue.\n\nLet me know if this solves your issue.', 'created_at': datetime.datetime(2025, 1, 15, 6, 45, 19, tzinfo=datetime.timezone.utc)}, {'comment_id': 2609061512, 'issue_id': 2757681654, 'author': 'poojavadher', 'body': 'Yes,it works in v15 the  way you suggested\nbut not in v14\n\nERPNext: v14.78.4 (HEAD)\n\nFrappe Framework: v14.88.1 (HEAD)\n\n![Image](https://github.com/user-attachments/assets/cb2efb5e-6c62-45a9-9441-47528d1c6920)\n\n![Image](https://github.com/user-attachments/assets/78d89a7b-0a6d-4d5d-b6fe-7c88b4902087)', 'created_at': datetime.datetime(2025, 1, 23, 7, 38, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2616382793, 'issue_id': 2757681654, 'author': 'mihir-kandoi', 'body': ""Can you update to v15 then? It's recommended to stay on the latest version."", 'created_at': datetime.datetime(2025, 1, 27, 17, 4, 26, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-15 06:45:19 UTC): Instead of creating a new line item in the delivery note, please try duplicating the row for which you are changing the batch. A new line item will not have the correct references to the Sales Order which is why you are experiencing this issue.

Let me know if this solves your issue.

poojavadher (Issue Creator) on (2025-01-23 07:38:03 UTC): Yes,it works in v15 the  way you suggested
but not in v14

ERPNext: v14.78.4 (HEAD)

Frappe Framework: v14.88.1 (HEAD)

![Image](https://github.com/user-attachments/assets/cb2efb5e-6c62-45a9-9441-47528d1c6920)

![Image](https://github.com/user-attachments/assets/78d89a7b-0a6d-4d5d-b6fe-7c88b4902087)

mihir-kandoi (Assginee) on (2025-01-27 17:04:26 UTC): Can you update to v15 then? It's recommended to stay on the latest version.

"
2757592491,issue,closed,completed,Not able authenticate the login page from Iframe.,"### Information about bug

While calling an erpnext or frappe site from an iframe. we are able to see the login page but after submitting the credentials we are not able to pass through further...
the error : 403 Forbidden & ""frappe.exceptions.PermissionError: <details><summary>You are not permitted to access this resource.</summary>Function <strong>helpdesk.api.telemetry.is_enabled</strong> is not whitelisted.</details>
![Screenshot_1](https://github.com/user-attachments/assets/a19c1f6e-fb3b-4be2-a58f-27c33c1bd574)
![Screenshot 2024-12-24 151147](https://github.com/user-attachments/assets/d399d75f-46e7-475d-b687-4772024f104d)


### Module

other

### Version

Frappe Framework: v15.39.1 (version-15)
Helpdesk: v1.2.0 (develop)
ERPNext: v15.33.2 (version-15)

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

```shell
the error : 403 Forbidden & ""frappe.exceptions.PermissionError: <details><summary>You are not permitted to access this resource.</summary>Function <strong>helpdesk.api.telemetry.is_enabled</strong> is not whitelisted.</details>
```
",Indrakumar14m,2024-12-24 10:49:34+00:00,[],2025-02-05 00:10:17+00:00,2025-01-21 08:58:40+00:00,https://github.com/frappe/erpnext/issues/44890,"[('bug', None)]","[{'comment_id': 2604044679, 'issue_id': 2757592491, 'author': 'diptanilsaha', 'body': ""This issue is not related to ERPNext. You may create a separate issue on Frappe Framework's repo."", 'created_at': datetime.datetime(2025, 1, 21, 8, 58, 40, tzinfo=datetime.timezone.utc)}]","diptanilsaha on (2025-01-21 08:58:40 UTC): This issue is not related to ERPNext. You may create a separate issue on Frappe Framework's repo.

"
2757514516,issue,closed,not_planned,Issue with submitting Stock Entry type of Manufacture with Scrap involved,"### Information about bug

Once work order is complete, based on BOM a stock entry document is created with the finished goods and scrap if specified in BOM. On checking ""Inspection Required"", the Item which goes to Finish Goods warehouse the Quality inspection is getting added. 
But it Also asks for Quality of Scrap Item. On trying to add a quality inspection for scrap item we are unable to add the Quality Inspection.

<img width=""856"" alt=""Screenshot 2024-12-24 at 3 10 48 PM"" src=""https://github.com/user-attachments/assets/e2cb2efe-fa3f-49aa-94ff-d4339798ed06"" />


- On trying to submit the Stock Entry, I get the below message.

<img width=""575"" alt=""Screenshot 2024-12-24 at 3 15 20 PM"" src=""https://github.com/user-attachments/assets/a3d4407f-0786-46ad-8c19-c97a08925897"" />


- On trying to Create ""Quality Inspection"" from  Create button, I get below error.

<img width=""576"" alt=""Screenshot 2024-12-24 at 3 14 17 PM"" src=""https://github.com/user-attachments/assets/85c2b63e-569e-499e-bc5e-edc80c93f512"" />

So, I am unable to perform stock entry unless I remove Scrap item from the stock entry or uncheck Inspection Required.

### Module

stock, manufacturing

### Version

ERPNext: v15.44.0

Frappe Framework: v15.48.1

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",Guru107,2024-12-24 09:49:39+00:00,['mihir-kandoi'],2025-01-27 17:03:10+00:00,2025-01-27 17:03:09+00:00,https://github.com/frappe/erpnext/issues/44888,"[('bug', None)]","[{'comment_id': 2594596821, 'issue_id': 2757514516, 'author': 'mihir-kandoi', 'body': 'Please provide replication steps.', 'created_at': datetime.datetime(2025, 1, 16, 5, 56, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2616379710, 'issue_id': 2757514516, 'author': 'mihir-kandoi', 'body': 'Replication steps not provided. Closing.', 'created_at': datetime.datetime(2025, 1, 27, 17, 3, 9, tzinfo=datetime.timezone.utc)}]","mihir-kandoi (Assginee) on (2025-01-16 05:56:28 UTC): Please provide replication steps.

mihir-kandoi (Assginee) on (2025-01-27 17:03:09 UTC): Replication steps not provided. Closing.

"
2757355559,issue,closed,completed,Issue with Purchase Order/Sales Order creation from Blanket Order,"### Information about bug

- Create a Blanket Order, Add item with rate, no quantity defined because the quantity is not known at the time of creating a Blanket Order

<img width=""1005"" alt=""Screenshot 2024-12-24 at 12 56 08 PM"" src=""https://github.com/user-attachments/assets/0e24135b-9ea3-4284-ad24-bd87bbdabe7e"" />

- Create a Purchase Order or Sales Order based on Order Type. It does not take the items from the Blanket Order from which it was created. Also there is no option for ""Get Items From"" Blanket Order.

<img width=""1051"" alt=""Screenshot 2024-12-24 at 12 59 19 PM"" src=""https://github.com/user-attachments/assets/c4315362-9abd-4e4b-adba-acdb2d4f8855"" />

<img width=""1090"" alt=""Screenshot 2024-12-24 at 1 03 10 PM"" src=""https://github.com/user-attachments/assets/90b36a96-ce54-4769-8e59-773718ebc3d5"" />

- Once the Sales Order / Purchase Order is saved and Submitted, it does not appear in Connections section of the Blanket Order.  Also the ""Ordered Quantity"" in the Items table does not get updated in the Blanket Order.



### Module

buying, selling, manufacturing

### Version

ERPNext: v15.44.0

Frappe Framework: v15.48.1

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",Guru107,2024-12-24 07:46:49+00:00,['diptanilsaha'],2025-02-01 00:11:17+00:00,2025-01-17 11:36:23+00:00,https://github.com/frappe/erpnext/issues/44880,"[('bug', None)]",[],
2757178454,issue,closed,completed,frappe education fee schedule not creating invoice,"### Information about bug

I get an error when creating sales invoice for fee schedule
![image (1)](https://github.com/user-attachments/assets/4461e09f-ad92-4f36-bb2a-1f7bdef450fd)

The fee schedule is put invoice pending status after showing giving the error.
Thought this would automatically create so for each student in the group with the fee structure set in the schedule.

### Module

accounts, education

### Version

""education"": ""15.5.0"",
""erpnext"": ""15.44.0"",
""frappe"": ""15.48.1"",

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

```shell
Traceback (most recent call last):
  File ""apps/education/education/education/doctype/fee_schedule/fee_schedule.py"", line 182, in generate_fees
    create_sales_invoice(fee_schedule, student_id)
  File ""apps/education/education/education/doctype/fee_schedule/fee_schedule.py"", line 236, in create_sales_invoice
    sales_invoice_doc.submit()
  File ""apps/frappe/frappe/utils/typing_validations.py"", line 31, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1052, in submit
    return self._submit()
           ^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1035, in _submit
    return self.save()
           ^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 341, in save
    return self._save(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 394, in _save
    self.run_post_save_methods()
  File ""apps/frappe/frappe/model/document.py"", line 1135, in run_post_save_methods
    self.run_method(""on_submit"")
  File ""apps/frappe/frappe/model/document.py"", line 966, in run_method
    out = Document.hook(fn)(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1326, in composer
    return composed(self, method, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1308, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 963, in fn
    return method_object(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/erpnext/erpnext/accounts/doctype/sales_invoice/sales_invoice.py"", line 463, in on_submit
    self.make_gl_entries()
  File ""apps/erpnext/erpnext/accounts/doctype/sales_invoice/sales_invoice.py"", line 1183, in make_gl_entries
    make_gl_entries(
  File ""apps/erpnext/erpnext/accounts/general_ledger.py"", line 48, in make_gl_entries
    save_entries(gl_map, adv_adj, update_outstanding, from_repost)
  File ""apps/erpnext/erpnext/accounts/general_ledger.py"", line 371, in save_entries
    validate_against_pcv(is_opening, gl_map[0][""posting_date""], gl_map[0][""company""])
  File ""apps/erpnext/erpnext/accounts/general_ledger.py"", line 727, in validate_against_pcv
    last_pcv_date = frappe.db.get_value(
                    ^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/database/database.py"", line 514, in get_value
    result = self.get_values(
             ^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/database/database.py"", line 618, in get_values
    out = self._get_values_from_table(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/database/database.py"", line 891, in _get_values_from_table
    return query.run(as_dict=as_dict, debug=debug, update=update, run=run, pluck=pluck)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/query_builder/utils.py"", line 87, in execute_query
    result = frappe.db.sql(query, params, *args, **kwargs)  # nosemgrep
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/database/database.py"", line 229, in sql
    self._cursor.execute(query, values)
  File ""env/lib/python3.12/site-packages/pymysql/cursors.py"", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File ""env/lib/python3.12/site-packages/pymysql/cursors.py"", line 322, in _query
    conn.query(q)
  File ""env/lib/python3.12/site-packages/pymysql/connections.py"", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""env/lib/python3.12/site-packages/pymysql/connections.py"", line 825, in _read_query_result
    result.read()
  File ""env/lib/python3.12/site-packages/pymysql/connections.py"", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""env/lib/python3.12/site-packages/pymysql/connections.py"", line 775, in _read_packet
    packet.raise_for_error()
  File ""env/lib/python3.12/site-packages/pymysql/protocol.py"", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File ""env/lib/python3.12/site-packages/pymysql/err.py"", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, ""Unknown column 'period_end_date' in 'field list'"")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""apps/frappe/frappe/app.py"", line 114, in application
    response = frappe.api.handle(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/__init__.py"", line 49, in handle
    data = endpoint(**arguments)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/v1.py"", line 36, in handle_rpc_call
    return frappe.handler.handle()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 49, in handle
    data = execute_cmd(cmd)
           ^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 85, in execute_cmd
    return frappe.call(method, **frappe.form_dict)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/__init__.py"", line 1725, in call
    return fn(*args, **newargs)
           ^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 331, in run_doc_method
    response = doc.run_method(method)
               ^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 966, in run_method
    out = Document.hook(fn)(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1326, in composer
    return composed(self, method, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1308, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 963, in fn
    return method_object(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/utils/typing_validations.py"", line 31, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/education/education/education/doctype/fee_schedule/fee_schedule.py"", line 158, in create_fees
    generate_fees(self.name)
  File ""apps/education/education/education/doctype/fee_schedule/fee_schedule.py"", line 193, in generate_fees
    frappe.local.message_log and ""\n\n"".join(frappe.local.message_log) or cstr(e)
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: sequence item 0: expected str instance, _dict found
```
",ryanmunene79,2024-12-24 04:59:27+00:00,[],2025-01-08 00:10:30+00:00,2024-12-24 07:52:00+00:00,https://github.com/frappe/erpnext/issues/44876,"[('bug', None)]","[{'comment_id': 2560652012, 'issue_id': 2757178454, 'author': 'ryanmunene79', 'body': '![image](https://github.com/user-attachments/assets/c1015004-acc5-4085-b59e-885b712d46ef)\r\nFor a larger student group same error but status remains as in process', 'created_at': datetime.datetime(2024, 12, 24, 5, 2, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2560742849, 'issue_id': 2757178454, 'author': 'ryanmunene79', 'body': 'pymysql.err.OperationalError: (1054, ""Unknown column \'period_end_date\' in \'field list\'"")\r\nI keep on getting this error across the system', 'created_at': datetime.datetime(2024, 12, 24, 6, 56, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2560793776, 'issue_id': 2757178454, 'author': 'ryanmunene79', 'body': 'Education: v15.5.0 (develop)\r\n\r\nERPNext: v15.46.2 (version-15)\r\n\r\nFrappe Framework: v15.50.1\r\n\r\nFrappe HR: v16.0.0-dev (develop)\r\n\r\nhave updated my apps and now can create invoices and the error has dissapeared.\r\ni can see differences in frappe framework and erp next my education module remains as it', 'created_at': datetime.datetime(2024, 12, 24, 7, 52, tzinfo=datetime.timezone.utc)}]","ryanmunene79 (Issue Creator) on (2024-12-24 05:02:17 UTC): ![image](https://github.com/user-attachments/assets/c1015004-acc5-4085-b59e-885b712d46ef)
For a larger student group same error but status remains as in process

ryanmunene79 (Issue Creator) on (2024-12-24 06:56:18 UTC): pymysql.err.OperationalError: (1054, ""Unknown column 'period_end_date' in 'field list'"")
I keep on getting this error across the system

ryanmunene79 (Issue Creator) on (2024-12-24 07:52:00 UTC): Education: v15.5.0 (develop)

ERPNext: v15.46.2 (version-15)

Frappe Framework: v15.50.1

Frappe HR: v16.0.0-dev (develop)

have updated my apps and now can create invoices and the error has dissapeared.
i can see differences in frappe framework and erp next my education module remains as it

"
2757142792,issue,open,,In Stock Entry populate source warehouse by scan batch no,"![image](https://github.com/user-attachments/assets/0b96ed9d-cc7b-4002-be64-d603f9112d78)

It is possible to auto populate and fill the source warehouse by scan barcode with scan batch no.

thanks erpnext
",classita2661,2024-12-24 04:22:45+00:00,[],2025-01-01 04:00:06+00:00,,https://github.com/frappe/erpnext/issues/44873,"[('feature-request', None)]","[{'comment_id': 2566834094, 'issue_id': 2757142792, 'author': 'rohitwaghchaure', 'body': '@classita2661 What if the same batch exists in two different warehouses?', 'created_at': datetime.datetime(2025, 1, 1, 4, 0, 4, tzinfo=datetime.timezone.utc)}]","rohitwaghchaure on (2025-01-01 04:00:04 UTC): @classita2661 What if the same batch exists in two different warehouses?

"
2756268961,issue,open,,"In some Stock Entries, observed that Stock Ledger entry is not created","### Information about bug

It is observed in stock entry that in some of the stock entries of ""Stock Transfer"" type, Stock Ledger is not generated.
Also system is allowing to submit stock entries where stock is not available.

### Module

stock

### Version

Installed Apps
ERPNext: v15.39.0 (version-15)

Frappe Framework: v15.45.0 (version-15)

India Compliance: v15.13.5 (version-15)

Stock Entry as below.

<img width=""1134"" alt=""image"" src=""https://github.com/user-attachments/assets/13686905-5790-4387-becb-9d3ce9060e87"" />

<img width=""1096"" alt=""image"" src=""https://github.com/user-attachments/assets/8df99a9b-af0d-4bce-97dd-20949a9e5b4c"" />


No Stock Ledger entry is shown.

<img width=""1249"" alt=""image"" src=""https://github.com/user-attachments/assets/6035bcb0-8a3f-4156-9042-287074ca17f5"" />


### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

```shell
No Stock Entry is shown against this stock entry.
```
",satisharalkar,2024-12-23 15:20:01+00:00,[],2025-01-13 07:46:07+00:00,,https://github.com/frappe/erpnext/issues/44869,"[('bug', None), (""can't-reproduce"", 'We are unable to reproduce this bug, provide more information.')]","[{'comment_id': 2586410914, 'issue_id': 2756268961, 'author': 'nabinhait', 'body': 'Can you replicate it in frappecloud account and send us the link of the Stock Entry?', 'created_at': datetime.datetime(2025, 1, 13, 7, 45, 49, tzinfo=datetime.timezone.utc)}]","nabinhait on (2025-01-13 07:45:49 UTC): Can you replicate it in frappecloud account and send us the link of the Stock Entry?

"
2756110167,issue,open,,"Allow custom fields in ""Add Multiple"" window","
![изображение_2024-12-23_180432246](https://github.com/user-attachments/assets/d7d6c6c5-4a1b-4264-ad25-e2f7853a2dcd)
Problem
The ""Add Multiple"" dialog in documents like Sales Invoice only shows predefined fields. This makes it impossible to include custom fields like item price, stock balance, or other specific data.

Proposed Solution
Allow users to configure the fields displayed in the ""Add Multiple"" dialog, including custom fields, via Customize Form or similar settings.

Alternative Suggestion
At least add more predefined fields (e.g., item rate, available quantity) to the ""Add Multiple"" dialog in Sales Invoice. Currently, the dialog looks too basic with just a single column for item names.

Why This is Needed
This feature would save time and improve flexibility for businesses that rely on additional fields for their workflows. For example, showing ""Default Unit of Measure"" or ""Brand"" directly in the dialog would significantly improve usability.

This enhancement would make ERPNext more user-friendly and adaptable to common use cases.",Awey01,2024-12-23 13:48:28+00:00,[],2025-01-27 12:06:11+00:00,,https://github.com/frappe/erpnext/issues/44864,"[('feature-request', None)]","[{'comment_id': 2562667851, 'issue_id': 2756110167, 'author': 'Awey01', 'body': 'Also, any advanced search in any doctype is very basic, and need customization', 'created_at': datetime.datetime(2024, 12, 26, 12, 54, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572440612, 'issue_id': 2756110167, 'author': 'Awey01', 'body': ""Maybe there is way to add fields, but i don't know how"", 'created_at': datetime.datetime(2025, 1, 6, 7, 13, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2615581987, 'issue_id': 2756110167, 'author': 'Awey01', 'body': 'No suggestions?', 'created_at': datetime.datetime(2025, 1, 27, 12, 6, 10, tzinfo=datetime.timezone.utc)}]","Awey01 (Issue Creator) on (2024-12-26 12:54:54 UTC): Also, any advanced search in any doctype is very basic, and need customization

Awey01 (Issue Creator) on (2025-01-06 07:13:42 UTC): Maybe there is way to add fields, but i don't know how

Awey01 (Issue Creator) on (2025-01-27 12:06:10 UTC): No suggestions?

"
2755247268,issue,open,reopened,Provisional Accounting for Expenses only for Non-Stock Items,"### Information about bug

In Purchase, we invoiced a service item, the cost is added under “Cost of Goods Sold”. Here we are not selling that service. How can i nullify that balance under “Cost of Goods Sold”. Provisional Accounting enabled under Company.
As we referred documentation, different accounts used. This was getting confused.

<img width=""941"" alt=""Untitled1"" src=""https://github.com/user-attachments/assets/c5f92518-f251-4d44-983e-e474e9b8d14f"" />
<img width=""950"" alt=""Untitled"" src=""https://github.com/user-attachments/assets/24845e52-41f6-4497-8341-9d07a1b10be8"" />
@ruthra-kumar

### Module

accounts, buying

### Version

erpnext 14.70.6
frappe 14.85.1

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",PraveenkumarSubramani,2024-12-23 05:23:06+00:00,[],2025-01-10 09:16:07+00:00,,https://github.com/frappe/erpnext/issues/44831,"[('bug', None), ('need-more-info', 'Provide additional context, steps to reproduce this issue.')]","[{'comment_id': 2579837708, 'issue_id': 2755247268, 'author': 'mihir-kandoi', 'body': 'Please provide replication steps.', 'created_at': datetime.datetime(2025, 1, 9, 10, 57, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2582139843, 'issue_id': 2755247268, 'author': 'PraveenkumarSubramani', 'body': '1. GL view of Purchase Receipt before Invoice\r\n![image](https://github.com/user-attachments/assets/7ea7fa82-28f5-419e-8fd5-28fdad2ef338)\r\n\r\n2. GL view of Purchase Receipt after Invoice\r\n![image](https://github.com/user-attachments/assets/ec86a57d-a60e-4481-9e2e-ee0a0cf19ccd)\r\n\r\n3. GL view of Invoice \r\n![image](https://github.com/user-attachments/assets/1e15d176-a57d-48fa-b37b-cbf059da6b03)', 'created_at': datetime.datetime(2025, 1, 10, 9, 15, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2582141034, 'issue_id': 2755247268, 'author': 'PraveenkumarSubramani', 'body': 'Once Purchase Invoice Created, reverse entry created for Purchase Receipt and separate entry will getting created for Invoice. In this time Expense Account Credited and Debited in Purchase Receipt. But while invoicing time also it is getting debited. So, balances are added under Expense Account', 'created_at': datetime.datetime(2025, 1, 10, 9, 16, 3, tzinfo=datetime.timezone.utc)}]","mihir-kandoi on (2025-01-09 10:57:10 UTC): Please provide replication steps.

PraveenkumarSubramani (Issue Creator) on (2025-01-10 09:15:28 UTC): 1. GL view of Purchase Receipt before Invoice
![image](https://github.com/user-attachments/assets/7ea7fa82-28f5-419e-8fd5-28fdad2ef338)

2. GL view of Purchase Receipt after Invoice
![image](https://github.com/user-attachments/assets/ec86a57d-a60e-4481-9e2e-ee0a0cf19ccd)

3. GL view of Invoice 
![image](https://github.com/user-attachments/assets/1e15d176-a57d-48fa-b37b-cbf059da6b03)

PraveenkumarSubramani (Issue Creator) on (2025-01-10 09:16:03 UTC): Once Purchase Invoice Created, reverse entry created for Purchase Receipt and separate entry will getting created for Invoice. In this time Expense Account Credited and Debited in Purchase Receipt. But while invoicing time also it is getting debited. So, balances are added under Expense Account

"
2754521957,issue,closed,completed,Error in Journal Entry - Account Type Stock,"### Information about bug

Supposedly, an account linked to the inventory cannot be added.

![image](https://github.com/user-attachments/assets/379724c9-587d-46ce-9938-ccc0d1c820a3)


### Module

accounts

### Version

ERPNext: v15.46.1 (version-15)

Frappe Framework: v15.50.1 (HEAD)

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",tajff,2024-12-22 07:04:15+00:00,[],2025-01-28 00:10:20+00:00,2025-01-13 08:35:21+00:00,https://github.com/frappe/erpnext/issues/44821,"[('bug', None)]","[{'comment_id': 2586490421, 'issue_id': 2754521957, 'author': 'nabinhait', 'body': ""This is not a bug, it's designed in this way."", 'created_at': datetime.datetime(2025, 1, 13, 8, 35, 21, tzinfo=datetime.timezone.utc)}]","nabinhait on (2025-01-13 08:35:21 UTC): This is not a bug, it's designed in this way.

"
2754427008,issue,closed,completed,Companies can't be removed.,"### Information about bug

Companies can't be removed, or edited

### Module

other

### Version

docker

### Installation method

docker

### Relevant log output / Stack trace / Full Error Message.

_No response_",Dmole,2024-12-22 00:58:47+00:00,[],2025-01-30 00:09:58+00:00,2025-01-15 10:27:08+00:00,https://github.com/frappe/erpnext/issues/44820,"[('bug', None), ('need-more-info', 'Provide additional context, steps to reproduce this issue.')]","[{'comment_id': 2586488536, 'issue_id': 2754427008, 'author': 'nabinhait', 'body': 'Please provide more information, preferably with screenshots.', 'created_at': datetime.datetime(2025, 1, 13, 8, 34, 14, tzinfo=datetime.timezone.utc)}]","nabinhait on (2025-01-13 08:34:14 UTC): Please provide more information, preferably with screenshots.

"
2754426778,issue,closed,completed,Canada is only 1/10 french,"### Information about bug

Making a Canadian company forces everything to be french and can't be changed.

### Module

accounts

### Version

docker

### Installation method

docker

### Relevant log output / Stack trace / Full Error Message.

_No response_",Dmole,2024-12-22 00:57:47+00:00,[],2025-02-01 00:11:21+00:00,2025-01-17 10:03:54+00:00,https://github.com/frappe/erpnext/issues/44819,"[('bug', None)]","[{'comment_id': 2597871706, 'issue_id': 2754426778, 'author': 'nabinhait', 'body': ""Can't replicate it. There is no restrictions like this in the system, you can change the language of the system from the User record."", 'created_at': datetime.datetime(2025, 1, 17, 10, 3, 54, tzinfo=datetime.timezone.utc)}]","nabinhait on (2025-01-17 10:03:54 UTC): Can't replicate it. There is no restrictions like this in the system, you can change the language of the system from the User record.

"
2754347282,issue,open,,version is obsolete,"### Information about bug

> sudo docker compose -f pwd.yml up -d
WARN[0000] /home/$USER/frappe_docker/pwd.yml: the attribute version is obsolete, it will be ignored, please remove it to avoid potential confusion

### Module

other

### Version

fresh docker

### Installation method

docker

### Relevant log output / Stack trace / Full Error Message.

_No response_",Dmole,2024-12-21 20:18:44+00:00,[],2024-12-21 20:18:44+00:00,,https://github.com/frappe/erpnext/issues/44818,"[('bug', None)]",[],
2752030286,issue,closed,completed,Bank Reconciliation Statement Report not filtering for the selected company,"### Information about bug

When Selecting the company filter,  all the journal entries and payment entries are displayed, which belong to the selected bank account, regardless of the company filter set. The company is not set in the filters:

This is applied to the 
**get_entries_for_bank_reconciliation_statement**
and **get_amounts_not_reflected_in_system_for_bank_reconciliation_statement** functions in the report

It just needs and company = %(company)s in the where statements


**def get_journal_entries(filters):**
	return frappe.db.sql(
		""""""
		select ""Journal Entry"" as payment_document, jv.posting_date,
			jv.name as payment_entry, jvd.debit_in_account_currency as debit,
			jvd.credit_in_account_currency as credit, jvd.against_account,
			jv.cheque_no as reference_no, jv.cheque_date as ref_date, jv.clearance_date, jvd.account_currency
		from
			`tabJournal Entry Account` jvd, `tabJournal Entry` jv
		where jvd.parent = jv.name and jv.docstatus=1
			and jvd.account = %(account)s and jv.posting_date <= %(report_date)s
			and ifnull(jv.clearance_date, '4000-01-01') > %(report_date)s
			and ifnull(jv.is_opening, 'No') = 'No'"""""",
		filters,
		as_dict=1,
	)


**def get_payment_entries(filters):**
	return frappe.db.sql(
		""""""
		select
			""Payment Entry"" as payment_document, name as payment_entry,
			reference_no, reference_date as ref_date,
			if(paid_to=%(account)s, received_amount_after_tax, 0) as debit,
			if(paid_from=%(account)s, paid_amount_after_tax, 0) as credit,
			posting_date, ifnull(party,if(paid_from=%(account)s,paid_to,paid_from)) as against_account, clearance_date,
			if(paid_to=%(account)s, paid_to_account_currency, paid_from_account_currency) as account_currency
		from `tabPayment Entry`
		where
			(paid_from=%(account)s or paid_to=%(account)s) and docstatus=1
			and posting_date <= %(report_date)s
			and ifnull(clearance_date, '4000-01-01') > %(report_date)s
	"""""",
		filters,
		as_dict=1,
	)


**def get_pos_entries(filters):**
	return frappe.db.sql(
		""""""
			select
				""Sales Invoice Payment"" as payment_document, sip.name as payment_entry, sip.amount as debit,
				si.posting_date, si.debit_to as against_account, sip.clearance_date,
				account.account_currency, 0 as credit
			from `tabSales Invoice Payment` sip, `tabSales Invoice` si, `tabAccount` account
			where
				sip.account=%(account)s and si.docstatus=1 and sip.parent = si.name
				and account.name = sip.account and si.posting_date <= %(report_date)s and
				ifnull(sip.clearance_date, '4000-01-01') > %(report_date)s
			order by
				si.posting_date ASC, si.name DESC
		"""""",
		filters,
		as_dict=1,
	)
	
	
	**def get_amounts_not_reflected_in_system_for_bank_reconciliation_statement(filters):**
		je_amount = frappe.db.sql(
		""""""
		select sum(jvd.debit_in_account_currency - jvd.credit_in_account_currency)
		from `tabJournal Entry Account` jvd, `tabJournal Entry` jv
		where jvd.parent = jv.name and jv.docstatus=1 and jvd.account=%(account)s
		and jv.posting_date > %(report_date)s and jv.clearance_date <= %(report_date)s
		and ifnull(jv.is_opening, 'No') = 'No' """""",
		filters,
	)

	je_amount = flt(je_amount[0][0]) if je_amount else 0.0

	pe_amount = frappe.db.sql(
		""""""
		select sum(if(paid_from=%(account)s, paid_amount, received_amount))
		from `tabPayment Entry`
		where (paid_from=%(account)s or paid_to=%(account)s) and docstatus=1
		and posting_date > %(report_date)s and clearance_date <= %(report_date)s"""""",
		filters,
	)

	pe_amount = flt(pe_amount[0][0]) if pe_amount else 0.0

	return je_amount + pe_amount
	

### Module

accounts

### Version

Frappe version: 15.49.1
ERPNext Version: 15.45.0

![image](https://github.com/user-attachments/assets/2402c27a-4389-4c60-8d59-3f4ac431e524)
![image](https://github.com/user-attachments/assets/760564fa-cc8f-49f3-ba6d-fa64d93a771e)


### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

```shell
Payment Entry	ACC-PAY-2024-00008	0	9876	Supplier 1	1234	2024-12-10		AED
	Bank Statement balance as per General Ledger	0	14876					AED
								
	Outstanding Cheques and Deposits to clear	0	9876					AED
	Cheques and Deposits incorrectly cleared	0	0					AED
								
	Calculated Bank Statement balance	0	5000					AED
```
",Omar-Abdullah-Shaikh-Al-Zoor,2024-12-20 06:19:55+00:00,[],2025-02-06 13:45:49+00:00,2025-02-06 13:45:48+00:00,https://github.com/frappe/erpnext/issues/44806,"[('bug', None)]","[{'comment_id': 2639874485, 'issue_id': 2752030286, 'author': 'ljain112', 'body': 'Fixed: https://github.com/frappe/erpnext/pull/44943', 'created_at': datetime.datetime(2025, 2, 6, 13, 45, 48, tzinfo=datetime.timezone.utc)}]","ljain112 on (2025-02-06 13:45:48 UTC): Fixed: https://github.com/frappe/erpnext/pull/44943

"
2751546164,issue,open,reopened,Payment Entries can't be used to net together a credit note and invoice that equal each other exactly,"### Information about bug

My understanding is that for both purchase and sales invoices a credit or debit note can be used to cancel out part of an invoice at the payment entry step. Example would look like

Invoice = $100
CreditNote = $50
Paid = $50

This doesn't seem to work if the paid amount is $0, which would be the case if the credit note and invoice were canceling each other out exactly. Perhaps that isn't very common but still. If paid amount = 0 than the payment entry fails to save and also the whole reference section disappears.

Am I missing something about how that is suppose to work?

### Module

accounts

### Version

ERPNext: v15.32.1
Frappe Framework: v15.37.0

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",jdigiorgio,2024-12-19 22:31:41+00:00,[],2024-12-19 23:06:02+00:00,,https://github.com/frappe/erpnext/issues/44803,"[('bug', None)]","[{'comment_id': 2555926611, 'issue_id': 2751546164, 'author': 'jdigiorgio', 'body': ""It occurs to me that this would also be the case if the credit note exceeded the invoice it was being used to credit. If say the credit note was for $100 and you wanted to use that credit to pay for a $50 invoice, how would you do that? If you used a payment entry then paid amount would be zero again and so wouldn't work."", 'created_at': datetime.datetime(2024, 12, 19, 23, 6, tzinfo=datetime.timezone.utc)}]","jdigiorgio (Issue Creator) on (2024-12-19 23:06:00 UTC): It occurs to me that this would also be the case if the credit note exceeded the invoice it was being used to credit. If say the credit note was for $100 and you wanted to use that credit to pay for a $50 invoice, how would you do that? If you used a payment entry then paid amount would be zero again and so wouldn't work.

"
2751084827,issue,closed,completed,Plaid Linking to Bank Authentication Error,"### Information about bug

I am having issues linking my bank to the Plaid integration.

I think this is due to Plaid changes in October 2024.  The link interface has changed.  I think line 15 in plaid_connector.py needs to change from:
     self.products = [""transactions""]
to
     self.products = [""transactions"", ""auth"", ""balance""]

Plead's Link customization has a ""Data Transparency"" section that allows you to select the types of access needed for the application.  Also, called Data Transparency Messaging (DTM) and it is enabled for all new customers.  Lucky me, I just signed up in December, so this applies to me.  There is a new requirement for new customers:

_""As of October 31, 2024, all new customers launching to consumers in the US and/or Canada are automatically enrolled for Data Transparency Messaging, and must [select a use case](https://dashboard.plaid.com/link/data-transparency-v5) to use Link in Production, including Limited Production.""  (Plead website documentation)_

When trying to link my bank to Plaid in the Plaid settings doc, I get a Plaid popup to log into plaid.  I provide my phone number and Plaid pops up the select financial institution.  I select that and the ERPNext page refreshes and that is all that happens.

I was expecting a popup to log into my bank and provide credentials to allow Plaid access, but that doesn't happen.

Here are the errors I get from ERPNext:

### **Plaid Authentication error:**

Traceback with variables (most recent call last):
  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/plaid_settings/plaid_connector.py"", line 74, in auth
    self.client.Auth.get(self.access_token)
      self = <erpnext.erpnext_integrations.doctype.plaid_settings.plaid_connector.PlaidConnector object at 0x7f29e94c9410>
      e = InvalidInputError('client does not have user consent to access the PRODUCT_AUTH product')
  File ""env/lib/python3.11/site-packages/plaid/api/auth.py"", line 23, in get
    return self.client.post('/auth/get', {
      self = <plaid.api.auth.Auth object at 0x7f29e94b4f50>
      access_token = ********
      _options = None
      account_ids = None
      options = {}
  File ""env/lib/python3.11/site-packages/plaid/client.py"", line 103, in post
    return self._post(path, post_data, is_json)
      self = <plaid.client.Client object at 0x7f29e9f4be90>
      path = '/auth/get'
      data = {'access_token': 'access-production-xxxxxxxxxxx', 'options': {}}
      is_json = True
      post_data = {'client_id': 'xxxxxxxxxxx', 'secret': '********', 'access_token': 'access-production-xxxxxxxx', 'options': {}}
  File ""env/lib/python3.11/site-packages/plaid/client.py"", line 115, in _post
    return post_request(
      self = <plaid.client.Client object at 0x7f29e9f4be90>
      path = '/auth/get'
      data = {'client_id': 'xxxxxxxxxx', 'secret': '********', 'access_token': 'access-production-xxxxxxxxx', 'options': {}}
      is_json = True
      headers = {'Plaid-Version': '2020-09-14', 'User-Agent': 'Plaid Python v7.2.1'}
  File ""env/lib/python3.11/site-packages/plaid/internal/requester.py"", line 68, in _http_request
    raise PlaidError.from_response(response_body)
      url = 'https://production.plaid.com/auth/get'
      method = 'POST'
      data = {'client_id': 'xxxxxxxx', 'secret': '********', 'access_token': 'access-production-xxxxxxxx', 'options': {}}
      headers = {'Plaid-Version': '2020-09-14', 'User-Agent': 'Plaid Python v7.2.1'}
      timeout = 600
      is_json = True
      response = <Response [400]>
      response_body = {'display_message': None, 'documentation_url': 'https://plaid.com/docs/?ref=error#invalid-input-errors', 'error_code': 'ADDITIONAL_CONSENT_REQUIRED', 'error_message': 'client does not have user consent to access the PRODUCT_AUTH product', 'error_type': 'INVALID_INPUT', 'request_id': 'qvjoOpdzcfnG9NA', 'suggested_action': None}
plaid.errors.InvalidInputError: client does not have user consent to access the PRODUCT_AUTH product

I think this points to not logging into the bank and providing credentials.

**### Here is the error from Plaid:** 

![Plaid Error](https://github.com/user-attachments/assets/19e9a847-7524-4543-af5f-16cb1a20c1c2)

This video talks about the product arrays and what is needed.  Since we need Auth and might need Balance as well, they should be added to the products list.

I suppose there could be a configuration issue within Plaid, but there is no documentation I can find to tell me what settings should be.

I know I have production enabled for Auth, Balance, and Transactions products.


### Module

integrations

### Version

ERPNext: v15.45.4 (HEAD)
Frappe Framework: v15.50.0 (HEAD)


### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",aripperden,2024-12-19 17:54:24+00:00,[],2025-02-08 00:10:02+00:00,2025-01-24 07:41:56+00:00,https://github.com/frappe/erpnext/issues/44802,"[('bug', None)]","[{'comment_id': 2557507901, 'issue_id': 2751084827, 'author': 'aripperden', 'body': 'I contacted Plaid support concerning this and here is their reply:\r\n\r\n_Plaid Support Dec 20, 2024 11:47 AM\r\n\r\nThanks for reaching out to Plaid Support!\r\n \r\nAfter looking into the logs, I can confirm that this user is experiencing the ADDITIONAL_CONSENT_REQUIRED error because you are using a Link flow that is enabled for Data Transparency Messaging and are trying to access an endpoint (/auth/get) for which you did not initially collect consent for.\r\n \r\nWhen creating a Link token, make sure to include all the products you intend to use in the products array. This ensures that consent is collected for each product during the Link flow.\r\n\r\nUse additional_consented_products: If you plan to use additional products later, specify them in the additional_consented_products field during the /link/token/create request.\r\nUpdate Mode: If you need to add products to an existing Item, use the update mode to prompt the user to consent to additional products.\r\n \r\nTo resolve this error, please re-initiate the Link flow to collect the necessary consent from the user. This involves sending the user through the Link flow again with the correct products specified (including the Auth product).\r\n \r\nPlease ensure that your API calls are consistent with the products for which you have collected consent. If you attempt to access a product without consent, you will encounter this error._\r\n\r\nDue to this reply, I think line 15 in plaid_connector.py needs to change from:\r\nself.products = [""transactions""]\r\nto\r\nself.products = [""transactions"", ""auth""]', 'created_at': datetime.datetime(2024, 12, 20, 18, 21, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2568524580, 'issue_id': 2751084827, 'author': 'mluessi', 'body': '@aripperden I had the same problem. ""auth"" isn\'t actually used in ERPNext. The fix is in https://github.com/frappe/erpnext/pull/44305', 'created_at': datetime.datetime(2025, 1, 2, 23, 40, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572007551, 'issue_id': 2751084827, 'author': 'aripperden', 'body': '@mluessi, thanks, but how do we get this in so I can use it?', 'created_at': datetime.datetime(2025, 1, 6, 2, 0, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2573347933, 'issue_id': 2751084827, 'author': 'mluessi', 'body': '@aripperden until the fix is included in an official version, you would have to use a custom erpnext version with the fix included.', 'created_at': datetime.datetime(2025, 1, 6, 15, 29, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2579814669, 'issue_id': 2751084827, 'author': 'mihir-kandoi', 'body': '> @aripperden I had the same problem. ""auth"" isn\'t actually used in ERPNext. The fix is in #44305\r\n\r\n@nabinhait @rohitwaghchaure requesting your intervention. This seems like a critical issue that can be solved with a simple merge (given that the code is acceptable).', 'created_at': datetime.datetime(2025, 1, 9, 10, 47, 11, tzinfo=datetime.timezone.utc)}]","aripperden (Issue Creator) on (2024-12-20 18:21:13 UTC): I contacted Plaid support concerning this and here is their reply:

_Plaid Support Dec 20, 2024 11:47 AM

Thanks for reaching out to Plaid Support!
 
After looking into the logs, I can confirm that this user is experiencing the ADDITIONAL_CONSENT_REQUIRED error because you are using a Link flow that is enabled for Data Transparency Messaging and are trying to access an endpoint (/auth/get) for which you did not initially collect consent for.
 
When creating a Link token, make sure to include all the products you intend to use in the products array. This ensures that consent is collected for each product during the Link flow.

Use additional_consented_products: If you plan to use additional products later, specify them in the additional_consented_products field during the /link/token/create request.
Update Mode: If you need to add products to an existing Item, use the update mode to prompt the user to consent to additional products.
 
To resolve this error, please re-initiate the Link flow to collect the necessary consent from the user. This involves sending the user through the Link flow again with the correct products specified (including the Auth product).
 
Please ensure that your API calls are consistent with the products for which you have collected consent. If you attempt to access a product without consent, you will encounter this error._

Due to this reply, I think line 15 in plaid_connector.py needs to change from:
self.products = [""transactions""]
to
self.products = [""transactions"", ""auth""]

mluessi on (2025-01-02 23:40:34 UTC): @aripperden I had the same problem. ""auth"" isn't actually used in ERPNext. The fix is in https://github.com/frappe/erpnext/pull/44305

aripperden (Issue Creator) on (2025-01-06 02:00:26 UTC): @mluessi, thanks, but how do we get this in so I can use it?

mluessi on (2025-01-06 15:29:05 UTC): @aripperden until the fix is included in an official version, you would have to use a custom erpnext version with the fix included.

mihir-kandoi on (2025-01-09 10:47:11 UTC): @nabinhait @rohitwaghchaure requesting your intervention. This seems like a critical issue that can be solved with a simple merge (given that the code is acceptable).

"
2749469335,issue,open,,Bug in Linked Doctype (Payroll Entry in module hrms ) in Doctype Bank Account - Erpnext Version 15,"### Information about bug

At [Rukn](https://www.linkedin.com/company/ruknsoftware) Company we attempting to perform operations(Create Custom fields or set property setter) on the Bank Account doctype in Erpnext Version 15, an error occurs indicating that there is no such doctype as Payroll Entry. This issue arises even if the hrms module (where the Payroll Entry doctype resides) is not installed.

This bug disrupts workflows involving the Bank Account doctype, making it challenging to manage bank-related operations without installing the hrms module.

### Module

accounts, HR

### Version

Frappe Version - v15.43.0
Erpnext Version - v15.37.0

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",husamhammad,2024-12-19 07:22:27+00:00,[],2024-12-19 07:22:27+00:00,,https://github.com/frappe/erpnext/issues/44788,"[('bug', None)]",[],
2747750153,issue,open,,I cannot formulate new MCC account request,"### Information about bug

i cannot formulate new MCC account request, all tabs are restricted and cannot ask any

### Module

education, other

### Version

i cannot formulate new MCC account request, all tabs are restricted and cannot ask any

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",AlshahraniFm,2024-12-18 12:57:32+00:00,[],2025-01-17 10:07:42+00:00,,https://github.com/frappe/erpnext/issues/44779,[],[],
2747157509,issue,closed,completed,[Bug] After Update to v15.46.0 (version-15) - All Financial Report Can't Open,"### Information about bug

Hello @ruthra-kumar ,

Following the latest update, I am unable to access all financial statements reports.

The affected reports include:
- Balance Sheet
- Profit and Loss
- Cash Flow

Could you please assist me in resolving this issue?

<img width=""608"" alt=""image"" src=""https://github.com/user-attachments/assets/aa756594-f023-4ba7-9cb7-4e1fd928f3e5"" />


Thanks,

Donnie

### Module

accounts

### Version

ERPNext: v15.46.0 (version-15)
Frappe Framework: v15.50.1 (version-15)
Frappe HR: v15.36.0 (version-15)
Payments: v0.0.1 (version-15)
Print Designer: v1.4.3 (main)
Webshop: v0.0.1 (develop)

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

```shell
### App Versions

{
	""erpnext"": ""15.46.0"",
	""frappe"": ""15.50.1"",
	""hrms"": ""15.36.0"",
	""payments"": ""0.0.1"",
	""print_designer"": ""1.4.3"",
	""webshop"": ""0.0.1""
}
```
### Route
```
query-report/Balance Sheet
```
### Traceback
```
Traceback (most recent call last):
  File ""apps/frappe/frappe/app.py"", line 114, in application
    response = frappe.api.handle(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/__init__.py"", line 49, in handle
    data = endpoint(**arguments)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/v1.py"", line 36, in handle_rpc_call
    return frappe.handler.handle()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 50, in handle
    data = execute_cmd(cmd)
           ^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 86, in execute_cmd
    return frappe.call(method, **frappe.form_dict)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/__init__.py"", line 1726, in call
    return fn(*args, **newargs)
           ^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/utils/typing_validations.py"", line 31, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/__init__.py"", line 879, in wrapper_fn
    retval = fn(*args, **get_newargs(fn, kwargs))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/desk/query_report.py"", line 224, in run
    result = generate_report_result(report, filters, user, custom_columns, is_tree, parent_field)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/__init__.py"", line 879, in wrapper_fn
    retval = fn(*args, **get_newargs(fn, kwargs))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/desk/query_report.py"", line 84, in generate_report_result
    res = get_report_result(report, filters) or []
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/desk/query_report.py"", line 65, in get_report_result
    res = report.execute_script_report(filters)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/core/doctype/report/report.py"", line 163, in execute_script_report
    res = self.execute_module(filters)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/core/doctype/report/report.py"", line 180, in execute_module
    return frappe.get_attr(method_name)(frappe._dict(filters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/erpnext/erpnext/accounts/report/profit_and_loss_statement/profit_and_loss_statement.py"", line 30, in execute
    income = get_data(
             ^^^^^^^^^
  File ""apps/erpnext/erpnext/accounts/report/financial_statements.py"", line 182, in get_data
    set_gl_entries_by_account(
  File ""apps/erpnext/erpnext/accounts/report/financial_statements.py"", line 466, in set_gl_entries_by_account
    gl_entries += get_accounting_entries(
                  ^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/erpnext/erpnext/accounts/report/financial_statements.py"", line 537, in get_accounting_entries
    query, params = query.walk()
                    ^^^^^^^^^^^^
  File ""apps/frappe/frappe/query_builder/utils.py"", line 111, in prepare_query
    query = query.get_sql(param_wrapper=param_collector)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""env/lib/python3.11/site-packages/pypika/queries.py"", line 607, in get_sql
    set_operation_querystring = set_operation_query.get_sql(
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get_sql'

```
### Request Data
```
{
	""type"": ""POST"",
	""args"": {
		""report_name"": ""Profit and Loss Statement"",
		""filters"": ""{\""company\"":\""Area51 Distribution Manado\"",\""filter_based_on\"":\""Fiscal Year\"",\""period_start_date\"":\""2024-01-01\"",\""period_end_date\"":\""2024-12-31\"",\""from_fiscal_year\"":\""2024\"",\""to_fiscal_year\"":\""2024\"",\""periodicity\"":\""Monthly\"",\""selected_view\"":\""Report\"",\""accumulated_values\"":0}"",
		""ignore_prepared_report"": 1
	},
	""headers"": {},
	""error_handlers"": {},
	""url"": ""/api/method/frappe.desk.query_report.run"",
	""request_id"": null
}
```
### Response Data
```
{
	""exception"": ""AttributeError: 'str' object has no attribute 'get_sql'"",
	""exc_type"": ""AttributeError"",
	""_exc_source"": ""erpnext (app)""
}
```
```
",donnieferdian,2024-12-18 08:36:39+00:00,['ruthra-kumar'],2025-01-09 00:10:33+00:00,2024-12-18 08:42:30+00:00,https://github.com/frappe/erpnext/issues/44766,"[('bug', None), ('released', None)]","[{'comment_id': 2550758847, 'issue_id': 2747157509, 'author': 'frappe-pr-bot', 'body': ':tada: This issue has been resolved in version 14.78.4 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.78.4)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 12, 18, 9, 7, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2550792481, 'issue_id': 2747157509, 'author': 'ruthra-kumar', 'body': 'Fixed in https://github.com/frappe/erpnext/releases/tag/v15.46.1', 'created_at': datetime.datetime(2024, 12, 18, 9, 17, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2561582575, 'issue_id': 2747157509, 'author': 'frappe-pr-bot', 'body': ':tada: This issue has been resolved in version 14.78.5 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.78.5)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2024, 12, 25, 3, 35, 22, tzinfo=datetime.timezone.utc)}]","frappe-pr-bot on (2024-12-18 09:07:47 UTC): :tada: This issue has been resolved in version 14.78.4 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.78.4)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

ruthra-kumar (Assginee) on (2024-12-18 09:17:44 UTC): Fixed in https://github.com/frappe/erpnext/releases/tag/v15.46.1

frappe-pr-bot on (2024-12-25 03:35:22 UTC): :tada: This issue has been resolved in version 14.78.5 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.78.5)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2745398948,issue,open,,Order Total Amount & Total Amount(Sales Taxes and Charges) – Different,"### Information about bug

At Sales Order, Delivery Note, Sales Invoice, I find $0.01 different for Order Total Amount & Total Amount(Sales Taxes and Charges) . for same data, In Frappe - 15.48, Erpnext - 15.41.1, But not find this problem.
![erpnext_15 45 5](https://github.com/user-attachments/assets/68be620b-f8e5-4d8f-b603-4ffd90747d03)
![erpnext_15 41 1](https://github.com/user-attachments/assets/50fec5c8-a1d4-4b6f-b5da-1d7a2cee23b6)


### Module

accounts, stock, selling

### Version

Frappe - 15.50
Erpnext - 15.45.5

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

```shell
Sales Tax Rate : 13%
Item : W957D6NKR-4J
Qty : 21,146
Sell Rate : 0.68251200 (Rate with tax)
Total Order Amount : 14,432.40

For Erpnext - 15.45.5
Total Amount(Sales Taxes and Charges) : 14,432.41

For Erpnext - 15.41.1 
Total Amount(Sales Taxes and Charges) : 14,432.40
```
",JasonFu06,2024-12-17 16:23:18+00:00,[],2024-12-17 16:23:18+00:00,,https://github.com/frappe/erpnext/issues/44756,"[('bug', None)]",[],
2744588826,issue,open,,Taxes Error. Actual Tax with subsequent On Prev. Row Total throws errors.,"### Information about bug

Hey all!

I noticed an error on ERPNext Desk, when trying to add taxes.

The error consists of two parts.
1) You have to check Is this Tax included in Basic Rate first, when trying to add a ""on previous row total tax"" after an ""actual"" tax to circumvent some validation and make this possible in the first place.
2)  Error Messages: The whole operation works in the end, but there are errors thrown to the user, and it is unclear why.

**Reproduction steps**
1. Add the first tax row and set it to Actual, enter any amount (e.g. 100€) and save.
2. Add another tax row and open the full form view for that tax row:
       - before anything else check true Is this Tax included in Basic Rate
       - Select type on previous row total
       - Then select type On previous row total
       - Set account head
       - Error is thrown: For row 2 in Sales Taxes and Charges. To include On Previous Row Total in Item rate, rows 1 must also be included

Here is a recording of the process:
[VIDEO RECORDING](https://www.loom.com/share/f561f34effa144a0bafaf886b7bca5d0?sid=802aba96-693c-45bd-9962-5feaa2d400e3)


**Why is this tax constellation required / desirable?**
- I would like to enter a shipping charge into the taxes and charges.
- The VAT should be applied to the total of the items (included in basic rate) + shipping

So for example:
- Items - 500€ (incl. VAT)
- Shipping 125€ (incl. VAT)
- Total Gross Amount: 625€
- of which 19% VAT is 99.79€


**As a side note:**
If there is an alternative way to calculate shipping and achieve the same calculation flow, please let me know. Quite a few people struggled, as you can see here, and there has not been a satisfactory solution.
[Post 1](https://discuss.frappe.io/t/pay-vat-tax-on-shipping-charges/6803)
[Post 2](https://discuss.frappe.io/t/vat-calculation-on-shipping-costs-in-the-purchase-invoice-help-please/134518)

### Module

selling

### Version

ERPNext: v15.45.5 (version-15)
Frappe Framework: v15.50.0 (version-15)

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",timeo-schmidt,2024-12-17 10:50:09+00:00,[],2024-12-17 10:50:09+00:00,,https://github.com/frappe/erpnext/issues/44744,"[('bug', None)]",[],
2744526807,issue,open,,Calculation Logic Error Additional Discount Taxes and Total,"### Information about bug

Hey all!

we are unfortunately experiencing a stubborn issue with the taxes_and_total calculation in transaction doctypes (e.g. Sales Order). 

Under certain scenarios, the `additional_discount` does not correctly subtract/add to the `grand_total`, as one would expect. There appears to be a rounding issue happening in the calculation.

**To reproduce:**
- Create a sales order
- Add an item with a rate of 500€
- Add the following taxes and charges:
    - 1st row: Actual, 100€ Amount
    - 2nd row: On previous row total, 20% Tax rate
- This should produce a grand total of 620€ ( 500€ from item and 120€ gross from charge)
- Try to increase the grand total by 0,01 and input -0,01 into discount_amount and apply on grand total. You will see the grand total jumping to 620,02, which is incorrect.

It seems like the taxes and totals calculations do not work as expected with this tax constellation.
I was able to reproduce it in a simple excel sheet, where the effect is visible too.

Here is a recording of the reproduction:
[Video Recording](https://www.loom.com/share/980ac24fbd984358811cf06b42bb7499?sid=8da5353f-5006-4c1c-8c44-bb372c178e24)

### Module

selling

### Version

ERPNext: v15.45.5 (version-15)
Frappe Framework: v15.50.0 (version-15)

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",timeo-schmidt,2024-12-17 10:23:12+00:00,['ruthra-kumar'],2025-01-13 10:33:07+00:00,,https://github.com/frappe/erpnext/issues/44743,"[('bug', None)]",[],
2742787476,issue,open,,Letterhead does not come as created from dev server to prod server via exported fixtures,"### Information about bug

LetterHead doctype, when i create a letterhead on development server and push it to github and pull it from github to production server i note that the footer is ok but the HEADER has issues as it sticks to IMAGE as it supposed to be HTML
in steps:
**development server** 
![image](https://github.com/user-attachments/assets/64daab01-53d4-4036-a56f-c848f6c899b2)

**production server**
![image](https://github.com/user-attachments/assets/8b79d617-bb70-414f-b287-fdce20bcb18e)




### Module

accounts, stock, buying, selling

### Version

erpnext 15.45.5
frappe 15.50.0

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",Rebaz-balisani,2024-12-16 16:04:20+00:00,[],2024-12-16 16:04:20+00:00,,https://github.com/frappe/erpnext/issues/44718,"[('bug', None)]",[],
2741946185,issue,closed,completed,"Cannot use custom fields in auto batch creation, only built in fields are usable","### Information about bug

I am trying to create Auto naming for batch with custom field so i did the following:
1- Customize item doctype form
2- Add new field ""custom_lot_suffix""
3- Go to item and enable Batch auto creation with the following rule "".YY..MM..####..{custom_lot_suffix}..{item_name}.""
4- Add value ""C002"" in log suffix field.
4- Create new purchase receipt for the item
5- Batch gets created but the value of the ""custom_lot_suffix"" is missing and all other values are there.


### Module

stock, buying

### Version

Frappe Framework: v15.39.0 (version-15)
ERPNext: v15.33.2 (version-15)


### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",AlaaL,2024-12-16 10:19:29+00:00,[],2025-01-28 00:10:18+00:00,2025-01-13 09:00:44+00:00,https://github.com/frappe/erpnext/issues/44715,"[('bug', None)]","[{'comment_id': 2547625461, 'issue_id': 2741946185, 'author': 'MeetSherasiya', 'body': 'Create a custom field named `custom_lot_suffix` in the `Batch` doctype, and configure it to fetch the value of the `custom_lot_suffix` field from the `Item` doctype. After doing this, test it to ensure it works correctly.', 'created_at': datetime.datetime(2024, 12, 17, 6, 44, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2586540107, 'issue_id': 2741946185, 'author': 'nabinhait', 'body': 'Please post this kind of issue on discuss.frappe.io, Github issues should be used to report bugs or adding feature requests.', 'created_at': datetime.datetime(2025, 1, 13, 9, 1, 52, tzinfo=datetime.timezone.utc)}]","MeetSherasiya on (2024-12-17 06:44:42 UTC): Create a custom field named `custom_lot_suffix` in the `Batch` doctype, and configure it to fetch the value of the `custom_lot_suffix` field from the `Item` doctype. After doing this, test it to ensure it works correctly.

nabinhait on (2025-01-13 09:01:52 UTC): Please post this kind of issue on discuss.frappe.io, Github issues should be used to report bugs or adding feature requests.

"
2740862744,issue,closed,completed,Unselect All button ticks checkbox,"### Information about bug

User > Roles & Permissions > Roles > Role Profile
Select All and Unselect All button acts opposite function

https://github.com/user-attachments/assets/0c6f622e-2010-4243-b920-f790c995b923



### Module

other

### Version

ERPNext: v15.45.4 (HEAD)
Frappe Framework: v15.50.0 (HEAD)

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",sh3hz,2024-12-15 20:09:14+00:00,[],2025-01-03 00:10:26+00:00,2024-12-19 10:04:58+00:00,https://github.com/frappe/erpnext/issues/44709,"[('bug', None)]","[{'comment_id': 2544905378, 'issue_id': 2740862744, 'author': 'rs-rethik', 'body': 'Hi @sh3hz \r\nKindly refresh the page and check else migrate the site once\r\nIt may work', 'created_at': datetime.datetime(2024, 12, 16, 8, 27, 40, tzinfo=datetime.timezone.utc)}]","rs-rethik on (2024-12-16 08:27:40 UTC): Hi @sh3hz 
Kindly refresh the page and check else migrate the site once
It may work

"
2740122283,issue,open,,HERO SLIDER Prev and Next icons direction is gets reversed mistakenly when switching between between English to Arabic or any rtl,"### Information about bug

in English the HERO SLIDERs PREV and NEXT button icon is perfect but when switching to any other rtl language example to Arabic

English
![image](https://github.com/user-attachments/assets/f2bf749f-38ea-4b26-8ab0-4bdc53e034de)

Arabic
![image](https://github.com/user-attachments/assets/fcfc2fd9-92d3-4f73-8ea2-583dca36b79a)


### Module

portal

### Version

erpnext 15.45.5
frappe 15.50.0

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",Rebaz-balisani,2024-12-14 20:00:40+00:00,[],2024-12-14 20:00:40+00:00,,https://github.com/frappe/erpnext/issues/44706,"[('bug', None)]",[],
2740092165,issue,open,,"Explore button, variants item card on webshop is not translatable","### Information about bug

I have put in red rectangles that are not translatable and when switching to any language it wont get translated

![image](https://github.com/user-attachments/assets/b941bfc6-d561-4022-9ea3-001f9bda35d0)
![image](https://github.com/user-attachments/assets/390d25b7-d7cf-4b50-8595-3e6a6c260d1a)
![image](https://github.com/user-attachments/assets/b6fa9743-c0c7-49b1-ab8c-4059e0562552)
![image](https://github.com/user-attachments/assets/d3e6f610-f18c-4d11-abda-ec9cb2079307)
![image](https://github.com/user-attachments/assets/a1e58ccf-1267-4098-82bf-ae63e8316c0a)
![image](https://github.com/user-attachments/assets/dc69c388-f095-4676-939b-0254d19ef61f)



### Module

stock, selling, ecommerce

### Version

erpnext 15.45.4
frappe 15.49.1

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",Rebaz-balisani,2024-12-14 18:40:14+00:00,[],2024-12-14 18:40:14+00:00,,https://github.com/frappe/erpnext/issues/44705,"[('bug', None)]",[],
2739509144,issue,open,,"Webshop product pages pagination ""Next"" and ""Prev"" button dont get translated","### Information about bug

Webshop product pages pagination **""Next"" and ""Prev""** button dont get translated when switching to all available languages in ERPNext
![image](https://github.com/user-attachments/assets/deebc401-1c76-43d7-ba03-aafd9801e639)


### Module

selling, ecommerce

### Version

erpnext 15.45.5
frappe 15.50.0


### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",Rebaz-balisani,2024-12-14 03:33:16+00:00,[],2024-12-14 03:33:16+00:00,,https://github.com/frappe/erpnext/issues/44701,"[('bug', None)]",[],
2739235046,issue,closed,completed,Price List inconsistency in POS page after backtracking from checkout,"### Information about bug

Let's say you have two price lists, PL1 and PL2, and you have an item, I1. Suppose you have a POS of setup so that it loads the price list PL1, but the I1 has two prices, one for PL1 and one for PL2.

Now, once on the POS page, the first time you load in and select the customer, it loads PL1 for the price of I1.

If you have a Customer that has the Price List of PL2, if you select it on the POS page, it still displays the prices for PL1 as it's documented.

However, if you then add an item to the cart, go to checkout, and then click back on ""Edit Cart"", the price for all the items will be PL2, overriding the setting on the POS profile.

This is both good and bad behavior in my opinion, as it can actually load the prices for PL2 (despite the documentation), but in an inconsistent way (which is obviously bad).

There's two possible solutions:
1. Use the price list for the client, which solves many POS issues and allows users a finer grain of control
2. Only use the price list described for the POS Profile

IMO it should be the `1` as the behavior, and maybe include a fallback if the item has no price for the loaded Price List.

[Screencast from 2024-12-13 18-25-37.webm](https://github.com/user-attachments/assets/d3492ffa-7eff-45ee-9e09-24ba0280cb22)


### Module

selling

### Version

Frappe version - v15.39.3 (version-15)
ERPNext version - v15.45.1 (version-15)

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",Shirkit,2024-12-13 21:26:27+00:00,['diptanilsaha'],2025-01-16 00:10:19+00:00,2024-12-31 06:44:31+00:00,https://github.com/frappe/erpnext/issues/44700,"[('bug', None), ('POS', None), ('released', None)]","[{'comment_id': 2565138362, 'issue_id': 2739235046, 'author': 'diptanilsaha', 'body': '@Shirkit can you give an example, where you need a separate price list for customers in pos?', 'created_at': datetime.datetime(2024, 12, 30, 7, 55, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2565263734, 'issue_id': 2739235046, 'author': 'Shirkit', 'body': ""Certainly @diptanilsaha \n\nI work in a small/medium sized producing company, where we deal with two types of customers: resellers and direct buyers.\n\nBoth of them can purchase remote and in-store, and most of the sales happens in-store. For direct buyers, they pay full price for each product, while resellers are pre-authorized to have access to a fixed discounted price, and that price varies from product by product, and not all products have a discounted price. Some products have a 5/10/15/20/30% off, some have an absolute 5/9/14/25 currency units off, and some no discount at all.\n\nThere's no single pricing policy that we could come up with to simplify and keep both customers and company happy, and that can be applied that satisfies all these requirements except for a different pricing list. We could open two registers, one for direct buyers and one for resellers, but now the reports gets mixed up.\n\nWe use the POS to more easily sell in-store to allow faster sales. Currently, we deal with this by automating pricing rule for all products that have a different price for one type of customer vs the other, apply a fixed discount on them on the direct buyer price, and only use that pricing list on the POS."", 'created_at': datetime.datetime(2024, 12, 30, 9, 58, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2566356030, 'issue_id': 2739235046, 'author': 'Shirkit', 'body': ""That was awesome! I tried fixing it myself but couldn't find a way, glad you know the ways into ERPNext to be able to tackle these things.\r\n\r\nOne question though, what happens if a product has no price in that price list? Is there any fallback for that product?"", 'created_at': datetime.datetime(2024, 12, 31, 11, 10, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2566367745, 'issue_id': 2739235046, 'author': 'diptanilsaha', 'body': 'price will be "" 0 / {uom} "" if the product does not exist in a price list.', 'created_at': datetime.datetime(2024, 12, 31, 11, 27, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2566371246, 'issue_id': 2739235046, 'author': 'Shirkit', 'body': ""Thank you! I guess that makes perfect sense, there shouldn't be any additional action being done.\r\n\r\nI'll just copy the prices from the price list when no discount should be applied. Now I can remove the mess of the pricing rules automation I've made."", 'created_at': datetime.datetime(2024, 12, 31, 11, 33, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2566916113, 'issue_id': 2739235046, 'author': 'frappe-pr-bot', 'body': ':tada: This issue has been resolved in version 14.78.6 :tada:\n\nThe release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.78.6)\n\nYour **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:', 'created_at': datetime.datetime(2025, 1, 1, 8, 57, 41, tzinfo=datetime.timezone.utc)}]","diptanilsaha (Assginee) on (2024-12-30 07:55:38 UTC): @Shirkit can you give an example, where you need a separate price list for customers in pos?

Shirkit (Issue Creator) on (2024-12-30 09:58:34 UTC): Certainly @diptanilsaha 

I work in a small/medium sized producing company, where we deal with two types of customers: resellers and direct buyers.

Both of them can purchase remote and in-store, and most of the sales happens in-store. For direct buyers, they pay full price for each product, while resellers are pre-authorized to have access to a fixed discounted price, and that price varies from product by product, and not all products have a discounted price. Some products have a 5/10/15/20/30% off, some have an absolute 5/9/14/25 currency units off, and some no discount at all.

There's no single pricing policy that we could come up with to simplify and keep both customers and company happy, and that can be applied that satisfies all these requirements except for a different pricing list. We could open two registers, one for direct buyers and one for resellers, but now the reports gets mixed up.

We use the POS to more easily sell in-store to allow faster sales. Currently, we deal with this by automating pricing rule for all products that have a different price for one type of customer vs the other, apply a fixed discount on them on the direct buyer price, and only use that pricing list on the POS.

Shirkit (Issue Creator) on (2024-12-31 11:10:42 UTC): That was awesome! I tried fixing it myself but couldn't find a way, glad you know the ways into ERPNext to be able to tackle these things.

One question though, what happens if a product has no price in that price list? Is there any fallback for that product?

diptanilsaha (Assginee) on (2024-12-31 11:27:58 UTC): price will be "" 0 / {uom} "" if the product does not exist in a price list.

Shirkit (Issue Creator) on (2024-12-31 11:33:10 UTC): Thank you! I guess that makes perfect sense, there shouldn't be any additional action being done.

I'll just copy the prices from the price list when no discount should be applied. Now I can remove the mess of the pricing rules automation I've made.

frappe-pr-bot on (2025-01-01 08:57:41 UTC): :tada: This issue has been resolved in version 14.78.6 :tada:

The release is available on [GitHub release](https://github.com/frappe/erpnext/releases/tag/v14.78.6)

Your **[semantic-release](https://github.com/semantic-release/semantic-release)** bot :package::rocket:

"
2737739191,issue,open,, Unable to login into erpnext site while accessing from iframe.,"### Information about bug

![Screenshot_1](https://github.com/user-attachments/assets/a0f869d6-bc25-4f0a-8b38-180000264444)
When i tried to call the erpnext site (http) from iframe using chrome browser. it shows the login page. after submitting the credentials it not logged in and shows login not permitted.



### Module

other

### Version

ERPNext: v15.33.2 (version-15)

Frappe Framework: v15.39.1 (version-15)

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",Indrakumar14m,2024-12-13 08:09:19+00:00,[],2024-12-13 08:09:19+00:00,,https://github.com/frappe/erpnext/issues/44692,"[('bug', None)]",[],
2737540954,issue,open,,Landed Cost Voucher currency error manual distribution,"### Information about bug

![image](https://github.com/user-attachments/assets/3a68f86d-138c-4cb5-9129-ca4171d776d8)
The default currency is NIO and the account currency is USD, but when this is posted in the GL only the moment is sent without considering the currency.

![image](https://github.com/user-attachments/assets/76f52c41-49e4-494e-a612-70d6f137b2d3)
This does not occur when the distribution is based on quantity or amount. It only occurs in manual mode.

### Module

stock

### Version

- erpnext 15.45.4
- frappe 15.49.1
- helpdesk 1.2.0
- hrms 15.35.3
- insights 3.0.11
- lending 0.0.1
- print_designer 1.4.3

### Installation method

docker

### Relevant log output / Stack trace / Full Error Message.

_No response_",albertfns,2024-12-13 06:33:47+00:00,[],2024-12-17 12:52:45+00:00,,https://github.com/frappe/erpnext/issues/44688,"[('bug', None)]","[{'comment_id': 2548383137, 'issue_id': 2737540954, 'author': 'albertfns', 'body': 'Does anyone know why this happens!?', 'created_at': datetime.datetime(2024, 12, 17, 12, 52, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548383286, 'issue_id': 2737540954, 'author': 'albertfns', 'body': 'Does anyone know why this happens!?', 'created_at': datetime.datetime(2024, 12, 17, 12, 52, 44, tzinfo=datetime.timezone.utc)}]","albertfns (Issue Creator) on (2024-12-17 12:52:40 UTC): Does anyone know why this happens!?

albertfns (Issue Creator) on (2024-12-17 12:52:44 UTC): Does anyone know why this happens!?

"
2737365732,issue,closed,completed,Getting Error in Tally Migration During Day Book Import,"### Information about bug

In the Tally Migration Tool, the Master Data gets imported successfully, but the Day Book gets processed and on clicking the Import Day Book button shows the error

### Module

integrations

### Version

Frappe Version - v15.50.0
ERPNext Version - v15.45.4

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

```shell
Data:
""Importing Day Book Data""
----------------------------------------------------------------------------------------------------

Exception:
Traceback (most recent call last):
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/model/base_document.py"", line 554, in db_insert
    frappe.db.sql(
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/database/database.py"", line 230, in sql
    self._cursor.execute(query, values)
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/pymysql/cursors.py"", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/pymysql/cursors.py"", line 322, in _query
    conn.query(q)
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/pymysql/connections.py"", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/pymysql/connections.py"", line 825, in _read_query_result
    result.read()
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/pymysql/connections.py"", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/pymysql/connections.py"", line 775, in _read_packet
    packet.raise_for_error()
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/pymysql/protocol.py"", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File ""/home/frappe/frappe-bench/env/lib/python3.11/site-packages/pymysql/err.py"", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, ""Duplicate entry 'Tally Price List' for key 'PRIMARY'"")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""/home/frappe/frappe-bench/apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 673, in _import_day_book_data
    create_price_list()
  File ""/home/frappe/frappe-bench/apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 650, in create_price_list
    ).insert()
      ^^^^^^^^
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/model/document.py"", line 306, in insert
    self.db_insert(ignore_if_duplicate=ignore_if_duplicate)
  File ""/home/frappe/frappe-bench/apps/frappe/frappe/model/base_document.py"", line 581, in db_insert
    raise frappe.DuplicateEntryError(self.doctype, self.name, e)
frappe.exceptions.DuplicateEntryError: ('Price List', 'Tally Price List', IntegrityError(1062, ""Duplicate entry 'Tally Price List' for key 'PRIMARY'""))
```
",sank8-2,2024-12-13 04:22:04+00:00,[],2025-01-28 00:10:17+00:00,2025-01-13 09:03:18+00:00,https://github.com/frappe/erpnext/issues/44680,"[('bug', None)]","[{'comment_id': 2540535135, 'issue_id': 2737365732, 'author': 'sank8-2', 'body': '```\r\nTraceback with variables (most recent call last):\r\n  File ""apps/frappe/frappe/utils/background_jobs.py"", line 221, in execute_job\r\n    retval = method(**kwargs)\r\n      site = \'amiyasagar.frappe.cloud\'\r\n      method = <function run_doc_method at 0x7f89485432e0>\r\n      event = None\r\n      job_name = \'frappe.utils.background_jobs.run_doc_method\'\r\n      kwargs = {\'doctype\': \'Tally Migration\', \'name\': \'Tally Migration on 13-12-2024 09:38:35\', \'doc_method\': \'_import_vouchers\', \'start\': 1, \'total\': 1159, \'is_last\': False}\r\n      user = \'Administrator\'\r\n      is_async = True\r\n      retry = 0\r\n      retval = None\r\n      method_name = \'frappe.utils.background_jobs.run_doc_method\'\r\n      before_job_task = \'frappe.monitor.start\'\r\n  File ""apps/frappe/frappe/utils/background_jobs.py"", line 186, in run_doc_method\r\n    getattr(frappe.get_doc(doctype, name), doc_method)(**kwargs)\r\n      doctype = \'Tally Migration\'\r\n      name = \'Tally Migration on 13-12-2024 09:38:35\'\r\n      doc_method = \'_import_vouchers\'\r\n      kwargs = {\'start\': 1, \'total\': 1159, \'is_last\': False}\r\n  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 714, in _import_vouchers\r\n    self.log(voucher_doc)\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n      start = 1\r\n      total = 1159\r\n      is_last = False\r\n      vouchers_file = <File: acbab01a07>\r\n      vouchers = [{\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013b1\', \'tally_voucher_no\': \'SK/23-24/01\', \'posting_date\': \'20230401\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'Sundry Debtors - SKL\', \'cost_center\': \'Main - SKL\', \'party_type\': \'Customer\', \'party\': \'Custom Capsules Private Limited\', \'debit_in_account_currency\': \'82600.00\'}, {\'account\': \'Testing Charges - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'70000.00\'}, {\'account\': \'Output CGST @ 9% - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'6300.00\'}, {\'account\': \'Output SGST @ 9% - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'6300.00\'}]}, {\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf\', \'tally_voucher_no\': \'1\', \'posting_date\': \'20230402\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'Petrol  Deisel - SKL\', \'cost_center\': \'Main - SKL\', \'debit_in_account_currency\': \'3068...\r\n      chunk = [{\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf\', \'tally_voucher_no\': \'1\', \'posting_date\': \'20230402\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'Petrol  Deisel - SKL\', \'cost_center\': \'Main - SKL\', \'debit_in_account_currency\': \'3068.93\', \'doctype\': \'Journal Entry Account\'}, {\'account\': \'Yes Bank A/c 041261900000424 - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'3068.93\', \'doctype\': \'Journal Entry Account\'}]}, {\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013d0\', \'tally_voucher_no\': \'2\', \'posting_date\': \'20230402\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'Staff Welfare - SKL\', \'cost_center\': \'Main - SKL\', \'debit_in_account_currency\': \'1481.00\', \'doctype\': \'Journal Entry Account\'}, {\'account\': \'Yes Bank A/c 041261900000424 - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'1481.00\', \'doctype\': \'Journal Entry Account\'}]}, {\'doctype\': \'J...\r\n      index = 3\r\n      voucher = {\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013e6\', \'tally_voucher_no\': \'3\', \'posting_date\': \'20230402\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'Printing  Stationery - SKL\', \'cost_center\': \'Main - SKL\', \'debit_in_account_currency\': \'610.00\', \'doctype\': \'Journal Entry Account\'}, {\'account\': \'Cash - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'610.00\', \'doctype\': \'Journal Entry Account\'}]}\r\n      voucher_doc = <JournalEntry: unsaved>\r\n  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 750, in log\r\n    self.save()\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n      data = <JournalEntry: unsaved>\r\n      failed_import_log = [{\'doc\': {\'name\': None, \'owner\': \'Administrator\', \'creation\': None, \'modified\': \'2024-12-13 10:02:39.050047\', \'modified_by\': \'Administrator\', \'docstatus\': 0, \'idx\': 0, \'tally_voucher_no\': \'1\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf\', \'is_system_generated\': 0, \'title\': None, \'voucher_type\': \'Journal Entry\', \'naming_series\': \'ACC-JV-.YYYY.-\', \'finance_book\': None, \'process_deferred_accounting\': None, \'reversal_of\': None, \'tax_withholding_category\': None, \'from_template\': None, \'company\': \'Swen Konformity LLP\', \'posting_date\': \'20230402\', \'apply_tds\': 0, \'cheque_no\': None, \'cheque_date\': None, \'user_remark\': None, \'total_debit\': 0.0, \'total_credit\': 0.0, \'difference\': 0.0, \'multi_currency\': 0, \'total_amount_currency\': None, \'total_amount\': 0.0, \'total_amount_in_words\': None, \'clearance_date\': None, \'remark\': None, \'paid_loan\': None, \'inter_company_journal_entry_reference\': None, \'bill_no\': None, \'bill_date\': None, \'due_date\': None, \'write_off_based_on\': \'Accounts Rec...\r\n      doc = {\'name\': None, \'owner\': \'Administrator\', \'creation\': None, \'modified\': \'2024-12-13 10:02:39.486598\', \'modified_by\': \'Administrator\', \'docstatus\': 0, \'idx\': 0, \'tally_voucher_no\': \'3\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013e6\', \'is_system_generated\': 0, \'title\': None, \'voucher_type\': \'Journal Entry\', \'naming_series\': \'ACC-JV-.YYYY.-\', \'finance_book\': None, \'process_deferred_accounting\': None, \'reversal_of\': None, \'tax_withholding_category\': None, \'from_template\': None, \'company\': \'Swen Konformity LLP\', \'posting_date\': \'20230402\', \'apply_tds\': 0, \'cheque_no\': None, \'cheque_date\': None, \'user_remark\': None, \'total_debit\': 0.0, \'total_credit\': 0.0, \'difference\': 0.0, \'multi_currency\': 0, \'total_amount_currency\': None, \'total_amount\': 0.0, \'total_amount_in_words\': None, \'clearance_date\': None, \'remark\': None, \'paid_loan\': None, \'inter_company_journal_entry_reference\': None, \'bill_no\': None, \'bill_date\': None, \'due_date\': None, \'write_off_based_on\': \'Accounts Receivable\',...\r\n  File ""apps/frappe/frappe/model/document.py"", line 342, in save\r\n    return self._save(*args, **kwargs)\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n      args = ()\r\n      kwargs = {}\r\n  File ""apps/frappe/frappe/model/document.py"", line 378, in _save\r\n    self.run_before_save_methods()\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n      ignore_permissions = None\r\n      ignore_version = None\r\n  File ""apps/frappe/frappe/model/document.py"", line 1103, in run_before_save_methods\r\n    self.run_method(""validate"")\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n  File ""apps/frappe/frappe/model/document.py"", line 974, in run_method\r\n    out = Document.hook(fn)(self, *args, **kwargs)\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n      method = \'validate\'\r\n      args = ()\r\n      kwargs = {}\r\n      fn = <function Document.run_method.<locals>.fn at 0x7f893e24ede0>\r\n  File ""apps/frappe/frappe/model/document.py"", line 1334, in composer\r\n    return composed(self, method, *args, **kwargs)\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n      args = ()\r\n      kwargs = {}\r\n      hooks = [<function apply at 0x7f893e588b80>, <function check_for_running_deletion_job at 0x7f893e58a7a0>]\r\n      method = \'validate\'\r\n      doc_events = {\'*\': {\'on_update\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.core.doctype.file.utils.attach_files_to_document\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\', \'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date\', \'frappe.core.doctype.user_type.user_type.apply_permissions_for_non_standard_user_type\'], \'after_rename\': [\'frappe.desk.notifications.clear_doctype_notifications\'], \'on_cancel\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\', \'frappe.automation.doctype.assignment_rule.assignment_rule.apply\'], \'on_trash\': [\'frappe.desk.notifications.clear_doctype_notifications\', \'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions\'], \'on_update_after_submit\': [\'frappe.workflow.doctype.workflow_action.workflow_action.process_w...\r\n      handler = \'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job\'\r\n      composed = <function Document.hook.<locals>.compose.<locals>.runner at 0x7f893e305940>\r\n      compose = <function Document.hook.<locals>.compose at 0x7f893e265e40>\r\n      f = <function Document.run_method.<locals>.fn at 0x7f893e24ede0>\r\n  File ""apps/frappe/frappe/model/document.py"", line 1316, in runner\r\n    add_to_return_value(self, fn(self, *args, **kwargs))\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n      method = \'validate\'\r\n      args = ()\r\n      kwargs = {}\r\n      add_to_return_value = <function Document.hook.<locals>.add_to_return_value at 0x7f893e265ee0>\r\n      fn = <function Document.run_method.<locals>.fn at 0x7f893e24ede0>\r\n      hooks = (<function apply at 0x7f893e588b80>, <function check_for_running_deletion_job at 0x7f893e58a7a0>)\r\n  File ""apps/frappe/frappe/model/document.py"", line 971, in fn\r\n    return method_object(*args, **kwargs)\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n      args = ()\r\n      kwargs = {}\r\n      method_object = <bound method TallyMigration.validate of <TallyMigration: Tally Migration on 13-12-2024 09:38:35>>\r\n      method = \'validate\'\r\n  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 78, in validate\r\n    sorted_failed_import_log = sorted(failed_import_log, key=lambda row: row[""doc""][""creation""])\r\n      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>\r\n      failed_import_log = [{\'doc\': {\'name\': None, \'owner\': \'Administrator\', \'creation\': None, \'modified\': \'2024-12-13 10:02:39.050047\', \'modified_by\': \'Administrator\', \'docstatus\': 0, \'idx\': 0, \'tally_voucher_no\': \'1\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf\', \'is_system_generated\': 0, \'title\': None, \'voucher_type\': \'Journal Entry\', \'naming_series\': \'ACC-JV-.YYYY.-\', \'finance_book\': None, \'process_deferred_accounting\': None, \'reversal_of\': None, \'tax_withholding_category\': None, \'from_template\': None, \'company\': \'Swen Konformity LLP\', \'posting_date\': \'20230402\', \'apply_tds\': 0, \'cheque_no\': None, \'cheque_date\': None, \'user_remark\': None, \'total_debit\': 0.0, \'total_credit\': 0.0, \'difference\': 0.0, \'multi_currency\': 0, \'total_amount_currency\': None, \'total_amount\': 0.0, \'total_amount_in_words\': None, \'clearance_date\': None, \'remark\': None, \'paid_loan\': None, \'inter_company_journal_entry_reference\': None, \'bill_no\': None, \'bill_date\': None, \'due_date\': None, \'write_off_based_on\': \'Accounts Rec...\r\nbuiltins.TypeError: \'<\' not supported between instances of \'NoneType\' and \'NoneType\'\r\n```', 'created_at': datetime.datetime(2024, 12, 13, 4, 35, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2540554173, 'issue_id': 2737365732, 'author': 'sank8-2', 'body': '```\r\nTraceback with variables (most recent call last):\r\n  File ""apps/frappe/frappe/utils/background_jobs.py"", line 221, in execute_job\r\n    retval = method(**kwargs)\r\n      site = \'amiyasagar.frappe.cloud\'\r\n      method = <function run_doc_method at 0x7f7930dd32e0>\r\n      event = None\r\n      job_name = \'frappe.utils.background_jobs.run_doc_method\'\r\n      kwargs = {\'doctype\': \'Tally Migration\', \'name\': \'Tally Migration on 29-11-2024 12:16:19\', \'doc_method\': \'_import_vouchers\', \'start\': 501, \'total\': 1159, \'is_last\': False}\r\n      user = \'Administrator\'\r\n      is_async = True\r\n      retry = 0\r\n      retval = None\r\n      method_name = \'frappe.utils.background_jobs.run_doc_method\'\r\n      before_job_task = \'frappe.monitor.start\'\r\n  File ""apps/frappe/frappe/utils/background_jobs.py"", line 186, in run_doc_method\r\n    getattr(frappe.get_doc(doctype, name), doc_method)(**kwargs)\r\n      doctype = \'Tally Migration\'\r\n      name = \'Tally Migration on 29-11-2024 12:16:19\'\r\n      doc_method = \'_import_vouchers\'\r\n      kwargs = {\'start\': 501, \'total\': 1159, \'is_last\': False}\r\n  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 714, in _import_vouchers\r\n    self.log(voucher_doc)\r\n      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>\r\n      start = 501\r\n      total = 1159\r\n      is_last = False\r\n      vouchers_file = <File: 0434630086>\r\n      vouchers = [{\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013b1\', \'tally_voucher_no\': \'SK/23-24/01\', \'posting_date\': \'20230401\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'Sundry Debtors - SKL\', \'cost_center\': \'Main - SKL\', \'party_type\': \'Customer\', \'party\': \'Custom Capsules Private Limited\', \'debit_in_account_currency\': \'82600.00\'}, {\'account\': \'Testing Charges - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'70000.00\'}, {\'account\': \'Output CGST @ 9% - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'6300.00\'}, {\'account\': \'Output SGST @ 9% - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'6300.00\'}]}, {\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf\', \'tally_voucher_no\': \'1\', \'posting_date\': \'20230402\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'Petrol  Deisel - SKL\', \'cost_center\': \'Main - SKL\', \'debit_in_account_currency\': \'3068...\r\n      chunk = [{\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-0000155d\', \'tally_voucher_no\': \'248\', \'posting_date\': \'20230907\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'TDS on Professional Fees - SKL\', \'cost_center\': \'Main - SKL\', \'debit_in_account_currency\': \'1100.00\', \'doctype\': \'Journal Entry Account\'}, {\'account\': \'ICICI Bank  - 336805000003 - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'1100.00\', \'doctype\': \'Journal Entry Account\'}]}, {\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000015a2\', \'tally_voucher_no\': \'AAFEE/3927/23-24\', \'posting_date\': \'20230907\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'Sundry Creditors - SKL\', \'cost_center\': \'Main - SKL\', \'party_type\': \'Supplier\', \'party\': \'Quality Council of India\', \'credit_in_account_currency\': \'51840.00\', \'doctype\': \'Journal Entry Account\'}, {\'account\': \'Techinical Service  Fees - SKL\', \'cost_center\': \'Main - SKL\', \'debi...\r\n      index = 502\r\n      voucher = {\'doctype\': \'Journal Entry\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000015a2\', \'tally_voucher_no\': \'AAFEE/3927/23-24\', \'posting_date\': \'20230907\', \'company\': \'Swen Konformity LLP\', \'accounts\': [{\'account\': \'Sundry Creditors - SKL\', \'cost_center\': \'Main - SKL\', \'party_type\': \'Supplier\', \'party\': \'Quality Council of India\', \'credit_in_account_currency\': \'51840.00\', \'doctype\': \'Journal Entry Account\'}, {\'account\': \'Techinical Service  Fees - SKL\', \'cost_center\': \'Main - SKL\', \'debit_in_account_currency\': \'48000.00\', \'doctype\': \'Journal Entry Account\'}, {\'account\': \'Input IGST @ 18% - SKL\', \'cost_center\': \'Main - SKL\', \'debit_in_account_currency\': \'8640.00\', \'doctype\': \'Journal Entry Account\'}, {\'account\': \'TDS on Professional Fees - SKL\', \'cost_center\': \'Main - SKL\', \'credit_in_account_currency\': \'4800.00\', \'doctype\': \'Journal Entry Account\'}]}\r\n      voucher_doc = <JournalEntry: unsaved>\r\n  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 750, in log\r\n    self.save()\r\n      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>\r\n      data = <JournalEntry: unsaved>\r\n      failed_import_log = [{\'doc\': {\'name\': None, \'owner\': \'Administrator\', \'creation\': None, \'modified\': \'2024-12-13 10:25:27.957047\', \'modified_by\': \'Administrator\', \'docstatus\': 0, \'idx\': 0, \'tally_voucher_no\': \'AAFEE/3927/23-24\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000015a2\', \'is_system_generated\': 0, \'title\': None, \'voucher_type\': \'Journal Entry\', \'naming_series\': \'ACC-JV-.YYYY.-\', \'finance_book\': None, \'process_deferred_accounting\': None, \'reversal_of\': None, \'tax_withholding_category\': None, \'from_template\': None, \'company\': \'Swen Konformity LLP\', \'posting_date\': \'20230907\', \'apply_tds\': 0, \'cheque_no\': None, \'cheque_date\': None, \'user_remark\': None, \'total_debit\': 0.0, \'total_credit\': 0.0, \'difference\': 0.0, \'multi_currency\': 0, \'total_amount_currency\': None, \'total_amount\': 0.0, \'total_amount_in_words\': None, \'clearance_date\': None, \'remark\': None, \'paid_loan\': None, \'inter_company_journal_entry_reference\': None, \'bill_no\': None, \'bill_date\': None, \'due_date\': None, \'write_off_based_on\'...\r\n      doc = {\'name\': None, \'owner\': \'Administrator\', \'creation\': None, \'modified\': \'2024-12-13 10:25:27.957047\', \'modified_by\': \'Administrator\', \'docstatus\': 0, \'idx\': 0, \'tally_voucher_no\': \'AAFEE/3927/23-24\', \'tally_guid\': \'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000015a2\', \'is_system_generated\': 0, \'title\': None, \'voucher_type\': \'Journal Entry\', \'naming_series\': \'ACC-JV-.YYYY.-\', \'finance_book\': None, \'process_deferred_accounting\': None, \'reversal_of\': None, \'tax_withholding_category\': None, \'from_template\': None, \'company\': \'Swen Konformity LLP\', \'posting_date\': \'20230907\', \'apply_tds\': 0, \'cheque_no\': None, \'cheque_date\': None, \'user_remark\': None, \'total_debit\': 0.0, \'total_credit\': 0.0, \'difference\': 0.0, \'multi_currency\': 0, \'total_amount_currency\': None, \'total_amount\': 0.0, \'total_amount_in_words\': None, \'clearance_date\': None, \'remark\': None, \'paid_loan\': None, \'inter_company_journal_entry_reference\': None, \'bill_no\': None, \'bill_date\': None, \'due_date\': None, \'write_off_based_on\': \'Accoun...\r\n  File ""apps/frappe/frappe/model/document.py"", line 342, in save\r\n    return self._save(*args, **kwargs)\r\n      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>\r\n      args = ()\r\n      kwargs = {}\r\n  File ""apps/frappe/frappe/model/document.py"", line 372, in _save\r\n    self.check_if_latest()\r\n      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>\r\n      ignore_permissions = None\r\n      ignore_version = None\r\n  File ""apps/frappe/frappe/model/document.py"", line 827, in check_if_latest\r\n    frappe.msgprint(\r\n      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>\r\n      previous = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>\r\n  File ""apps/frappe/frappe/__init__.py"", line 567, in msgprint\r\n    _raise_exception()\r\n      msg = \'Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.\'\r\n      title = None\r\n      raise_exception = <class \'frappe.exceptions.TimestampMismatchError\'>\r\n      as_table = False\r\n      as_list = False\r\n      indicator = \'red\'\r\n      alert = False\r\n      primary_action = None\r\n      is_minimizable = False\r\n      wide = False\r\n      realtime = False\r\n      sys = <module \'sys\' (built-in)>\r\n      _raise_exception = <function msgprint.<locals>._raise_exception at 0x7f7932a6a3e0>\r\n      inspect = <module \'inspect\' from \'/usr/lib/python3.11/inspect.py\'>\r\n      out = {\'message\': \'Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.\', \'title\': \'Message\', \'indicator\': \'red\', \'raise_exception\': 1, \'__frappe_exc_id\': \'1950e66a485a6bbbce7eafad124f3b23120ab58fa383d9fbcc26435b\'}\r\n  File ""apps/frappe/frappe/__init__.py"", line 518, in _raise_exception\r\n    raise exc\r\n      exc = TimestampMismatchError(\'Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.\')\r\n      inspect = <module \'inspect\' from \'/usr/lib/python3.11/inspect.py\'>\r\n      msg = \'Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.\'\r\n      out = {\'message\': \'Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.\', \'title\': \'Message\', \'indicator\': \'red\', \'raise_exception\': 1, \'__frappe_exc_id\': \'1950e66a485a6bbbce7eafad124f3b23120ab58fa383d9fbcc26435b\'}\r\n      raise_exception = <class \'frappe.exceptions.TimestampMismatchError\'>\r\nfrappe.exceptions.TimestampMismatchError: Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.\r\n```', 'created_at': datetime.datetime(2024, 12, 13, 4, 59, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2586543126, 'issue_id': 2737365732, 'author': 'nabinhait', 'body': 'We have removed Tally Migration in the latest version, closing the issue.', 'created_at': datetime.datetime(2025, 1, 13, 9, 3, 18, tzinfo=datetime.timezone.utc)}]","sank8-2 (Issue Creator) on (2024-12-13 04:35:35 UTC): ```
Traceback with variables (most recent call last):
  File ""apps/frappe/frappe/utils/background_jobs.py"", line 221, in execute_job
    retval = method(**kwargs)
      site = 'amiyasagar.frappe.cloud'
      method = <function run_doc_method at 0x7f89485432e0>
      event = None
      job_name = 'frappe.utils.background_jobs.run_doc_method'
      kwargs = {'doctype': 'Tally Migration', 'name': 'Tally Migration on 13-12-2024 09:38:35', 'doc_method': '_import_vouchers', 'start': 1, 'total': 1159, 'is_last': False}
      user = 'Administrator'
      is_async = True
      retry = 0
      retval = None
      method_name = 'frappe.utils.background_jobs.run_doc_method'
      before_job_task = 'frappe.monitor.start'
  File ""apps/frappe/frappe/utils/background_jobs.py"", line 186, in run_doc_method
    getattr(frappe.get_doc(doctype, name), doc_method)(**kwargs)
      doctype = 'Tally Migration'
      name = 'Tally Migration on 13-12-2024 09:38:35'
      doc_method = '_import_vouchers'
      kwargs = {'start': 1, 'total': 1159, 'is_last': False}
  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 714, in _import_vouchers
    self.log(voucher_doc)
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
      start = 1
      total = 1159
      is_last = False
      vouchers_file = <File: acbab01a07>
      vouchers = [{'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013b1', 'tally_voucher_no': 'SK/23-24/01', 'posting_date': '20230401', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'Sundry Debtors - SKL', 'cost_center': 'Main - SKL', 'party_type': 'Customer', 'party': 'Custom Capsules Private Limited', 'debit_in_account_currency': '82600.00'}, {'account': 'Testing Charges - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '70000.00'}, {'account': 'Output CGST @ 9% - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '6300.00'}, {'account': 'Output SGST @ 9% - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '6300.00'}]}, {'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf', 'tally_voucher_no': '1', 'posting_date': '20230402', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'Petrol  Deisel - SKL', 'cost_center': 'Main - SKL', 'debit_in_account_currency': '3068...
      chunk = [{'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf', 'tally_voucher_no': '1', 'posting_date': '20230402', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'Petrol  Deisel - SKL', 'cost_center': 'Main - SKL', 'debit_in_account_currency': '3068.93', 'doctype': 'Journal Entry Account'}, {'account': 'Yes Bank A/c 041261900000424 - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '3068.93', 'doctype': 'Journal Entry Account'}]}, {'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013d0', 'tally_voucher_no': '2', 'posting_date': '20230402', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'Staff Welfare - SKL', 'cost_center': 'Main - SKL', 'debit_in_account_currency': '1481.00', 'doctype': 'Journal Entry Account'}, {'account': 'Yes Bank A/c 041261900000424 - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '1481.00', 'doctype': 'Journal Entry Account'}]}, {'doctype': 'J...
      index = 3
      voucher = {'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013e6', 'tally_voucher_no': '3', 'posting_date': '20230402', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'Printing  Stationery - SKL', 'cost_center': 'Main - SKL', 'debit_in_account_currency': '610.00', 'doctype': 'Journal Entry Account'}, {'account': 'Cash - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '610.00', 'doctype': 'Journal Entry Account'}]}
      voucher_doc = <JournalEntry: unsaved>
  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 750, in log
    self.save()
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
      data = <JournalEntry: unsaved>
      failed_import_log = [{'doc': {'name': None, 'owner': 'Administrator', 'creation': None, 'modified': '2024-12-13 10:02:39.050047', 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 0, 'tally_voucher_no': '1', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf', 'is_system_generated': 0, 'title': None, 'voucher_type': 'Journal Entry', 'naming_series': 'ACC-JV-.YYYY.-', 'finance_book': None, 'process_deferred_accounting': None, 'reversal_of': None, 'tax_withholding_category': None, 'from_template': None, 'company': 'Swen Konformity LLP', 'posting_date': '20230402', 'apply_tds': 0, 'cheque_no': None, 'cheque_date': None, 'user_remark': None, 'total_debit': 0.0, 'total_credit': 0.0, 'difference': 0.0, 'multi_currency': 0, 'total_amount_currency': None, 'total_amount': 0.0, 'total_amount_in_words': None, 'clearance_date': None, 'remark': None, 'paid_loan': None, 'inter_company_journal_entry_reference': None, 'bill_no': None, 'bill_date': None, 'due_date': None, 'write_off_based_on': 'Accounts Rec...
      doc = {'name': None, 'owner': 'Administrator', 'creation': None, 'modified': '2024-12-13 10:02:39.486598', 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 0, 'tally_voucher_no': '3', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013e6', 'is_system_generated': 0, 'title': None, 'voucher_type': 'Journal Entry', 'naming_series': 'ACC-JV-.YYYY.-', 'finance_book': None, 'process_deferred_accounting': None, 'reversal_of': None, 'tax_withholding_category': None, 'from_template': None, 'company': 'Swen Konformity LLP', 'posting_date': '20230402', 'apply_tds': 0, 'cheque_no': None, 'cheque_date': None, 'user_remark': None, 'total_debit': 0.0, 'total_credit': 0.0, 'difference': 0.0, 'multi_currency': 0, 'total_amount_currency': None, 'total_amount': 0.0, 'total_amount_in_words': None, 'clearance_date': None, 'remark': None, 'paid_loan': None, 'inter_company_journal_entry_reference': None, 'bill_no': None, 'bill_date': None, 'due_date': None, 'write_off_based_on': 'Accounts Receivable',...
  File ""apps/frappe/frappe/model/document.py"", line 342, in save
    return self._save(*args, **kwargs)
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
      args = ()
      kwargs = {}
  File ""apps/frappe/frappe/model/document.py"", line 378, in _save
    self.run_before_save_methods()
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
      ignore_permissions = None
      ignore_version = None
  File ""apps/frappe/frappe/model/document.py"", line 1103, in run_before_save_methods
    self.run_method(""validate"")
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
  File ""apps/frappe/frappe/model/document.py"", line 974, in run_method
    out = Document.hook(fn)(self, *args, **kwargs)
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
      method = 'validate'
      args = ()
      kwargs = {}
      fn = <function Document.run_method.<locals>.fn at 0x7f893e24ede0>
  File ""apps/frappe/frappe/model/document.py"", line 1334, in composer
    return composed(self, method, *args, **kwargs)
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
      args = ()
      kwargs = {}
      hooks = [<function apply at 0x7f893e588b80>, <function check_for_running_deletion_job at 0x7f893e58a7a0>]
      method = 'validate'
      doc_events = {'*': {'on_update': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.core.doctype.file.utils.attach_files_to_document', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply', 'frappe.automation.doctype.assignment_rule.assignment_rule.update_due_date', 'frappe.core.doctype.user_type.user_type.apply_permissions_for_non_standard_user_type'], 'after_rename': ['frappe.desk.notifications.clear_doctype_notifications'], 'on_cancel': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions', 'frappe.automation.doctype.assignment_rule.assignment_rule.apply'], 'on_trash': ['frappe.desk.notifications.clear_doctype_notifications', 'frappe.workflow.doctype.workflow_action.workflow_action.process_workflow_actions'], 'on_update_after_submit': ['frappe.workflow.doctype.workflow_action.workflow_action.process_w...
      handler = 'erpnext.setup.doctype.transaction_deletion_record.transaction_deletion_record.check_for_running_deletion_job'
      composed = <function Document.hook.<locals>.compose.<locals>.runner at 0x7f893e305940>
      compose = <function Document.hook.<locals>.compose at 0x7f893e265e40>
      f = <function Document.run_method.<locals>.fn at 0x7f893e24ede0>
  File ""apps/frappe/frappe/model/document.py"", line 1316, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
      method = 'validate'
      args = ()
      kwargs = {}
      add_to_return_value = <function Document.hook.<locals>.add_to_return_value at 0x7f893e265ee0>
      fn = <function Document.run_method.<locals>.fn at 0x7f893e24ede0>
      hooks = (<function apply at 0x7f893e588b80>, <function check_for_running_deletion_job at 0x7f893e58a7a0>)
  File ""apps/frappe/frappe/model/document.py"", line 971, in fn
    return method_object(*args, **kwargs)
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
      args = ()
      kwargs = {}
      method_object = <bound method TallyMigration.validate of <TallyMigration: Tally Migration on 13-12-2024 09:38:35>>
      method = 'validate'
  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 78, in validate
    sorted_failed_import_log = sorted(failed_import_log, key=lambda row: row[""doc""][""creation""])
      self = <TallyMigration: Tally Migration on 13-12-2024 09:38:35>
      failed_import_log = [{'doc': {'name': None, 'owner': 'Administrator', 'creation': None, 'modified': '2024-12-13 10:02:39.050047', 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 0, 'tally_voucher_no': '1', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf', 'is_system_generated': 0, 'title': None, 'voucher_type': 'Journal Entry', 'naming_series': 'ACC-JV-.YYYY.-', 'finance_book': None, 'process_deferred_accounting': None, 'reversal_of': None, 'tax_withholding_category': None, 'from_template': None, 'company': 'Swen Konformity LLP', 'posting_date': '20230402', 'apply_tds': 0, 'cheque_no': None, 'cheque_date': None, 'user_remark': None, 'total_debit': 0.0, 'total_credit': 0.0, 'difference': 0.0, 'multi_currency': 0, 'total_amount_currency': None, 'total_amount': 0.0, 'total_amount_in_words': None, 'clearance_date': None, 'remark': None, 'paid_loan': None, 'inter_company_journal_entry_reference': None, 'bill_no': None, 'bill_date': None, 'due_date': None, 'write_off_based_on': 'Accounts Rec...
builtins.TypeError: '<' not supported between instances of 'NoneType' and 'NoneType'
```

sank8-2 (Issue Creator) on (2024-12-13 04:59:33 UTC): ```
Traceback with variables (most recent call last):
  File ""apps/frappe/frappe/utils/background_jobs.py"", line 221, in execute_job
    retval = method(**kwargs)
      site = 'amiyasagar.frappe.cloud'
      method = <function run_doc_method at 0x7f7930dd32e0>
      event = None
      job_name = 'frappe.utils.background_jobs.run_doc_method'
      kwargs = {'doctype': 'Tally Migration', 'name': 'Tally Migration on 29-11-2024 12:16:19', 'doc_method': '_import_vouchers', 'start': 501, 'total': 1159, 'is_last': False}
      user = 'Administrator'
      is_async = True
      retry = 0
      retval = None
      method_name = 'frappe.utils.background_jobs.run_doc_method'
      before_job_task = 'frappe.monitor.start'
  File ""apps/frappe/frappe/utils/background_jobs.py"", line 186, in run_doc_method
    getattr(frappe.get_doc(doctype, name), doc_method)(**kwargs)
      doctype = 'Tally Migration'
      name = 'Tally Migration on 29-11-2024 12:16:19'
      doc_method = '_import_vouchers'
      kwargs = {'start': 501, 'total': 1159, 'is_last': False}
  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 714, in _import_vouchers
    self.log(voucher_doc)
      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>
      start = 501
      total = 1159
      is_last = False
      vouchers_file = <File: 0434630086>
      vouchers = [{'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013b1', 'tally_voucher_no': 'SK/23-24/01', 'posting_date': '20230401', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'Sundry Debtors - SKL', 'cost_center': 'Main - SKL', 'party_type': 'Customer', 'party': 'Custom Capsules Private Limited', 'debit_in_account_currency': '82600.00'}, {'account': 'Testing Charges - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '70000.00'}, {'account': 'Output CGST @ 9% - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '6300.00'}, {'account': 'Output SGST @ 9% - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '6300.00'}]}, {'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000013cf', 'tally_voucher_no': '1', 'posting_date': '20230402', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'Petrol  Deisel - SKL', 'cost_center': 'Main - SKL', 'debit_in_account_currency': '3068...
      chunk = [{'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-0000155d', 'tally_voucher_no': '248', 'posting_date': '20230907', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'TDS on Professional Fees - SKL', 'cost_center': 'Main - SKL', 'debit_in_account_currency': '1100.00', 'doctype': 'Journal Entry Account'}, {'account': 'ICICI Bank  - 336805000003 - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '1100.00', 'doctype': 'Journal Entry Account'}]}, {'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000015a2', 'tally_voucher_no': 'AAFEE/3927/23-24', 'posting_date': '20230907', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'Sundry Creditors - SKL', 'cost_center': 'Main - SKL', 'party_type': 'Supplier', 'party': 'Quality Council of India', 'credit_in_account_currency': '51840.00', 'doctype': 'Journal Entry Account'}, {'account': 'Techinical Service  Fees - SKL', 'cost_center': 'Main - SKL', 'debi...
      index = 502
      voucher = {'doctype': 'Journal Entry', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000015a2', 'tally_voucher_no': 'AAFEE/3927/23-24', 'posting_date': '20230907', 'company': 'Swen Konformity LLP', 'accounts': [{'account': 'Sundry Creditors - SKL', 'cost_center': 'Main - SKL', 'party_type': 'Supplier', 'party': 'Quality Council of India', 'credit_in_account_currency': '51840.00', 'doctype': 'Journal Entry Account'}, {'account': 'Techinical Service  Fees - SKL', 'cost_center': 'Main - SKL', 'debit_in_account_currency': '48000.00', 'doctype': 'Journal Entry Account'}, {'account': 'Input IGST @ 18% - SKL', 'cost_center': 'Main - SKL', 'debit_in_account_currency': '8640.00', 'doctype': 'Journal Entry Account'}, {'account': 'TDS on Professional Fees - SKL', 'cost_center': 'Main - SKL', 'credit_in_account_currency': '4800.00', 'doctype': 'Journal Entry Account'}]}
      voucher_doc = <JournalEntry: unsaved>
  File ""apps/erpnext/erpnext/erpnext_integrations/doctype/tally_migration/tally_migration.py"", line 750, in log
    self.save()
      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>
      data = <JournalEntry: unsaved>
      failed_import_log = [{'doc': {'name': None, 'owner': 'Administrator', 'creation': None, 'modified': '2024-12-13 10:25:27.957047', 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 0, 'tally_voucher_no': 'AAFEE/3927/23-24', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000015a2', 'is_system_generated': 0, 'title': None, 'voucher_type': 'Journal Entry', 'naming_series': 'ACC-JV-.YYYY.-', 'finance_book': None, 'process_deferred_accounting': None, 'reversal_of': None, 'tax_withholding_category': None, 'from_template': None, 'company': 'Swen Konformity LLP', 'posting_date': '20230907', 'apply_tds': 0, 'cheque_no': None, 'cheque_date': None, 'user_remark': None, 'total_debit': 0.0, 'total_credit': 0.0, 'difference': 0.0, 'multi_currency': 0, 'total_amount_currency': None, 'total_amount': 0.0, 'total_amount_in_words': None, 'clearance_date': None, 'remark': None, 'paid_loan': None, 'inter_company_journal_entry_reference': None, 'bill_no': None, 'bill_date': None, 'due_date': None, 'write_off_based_on'...
      doc = {'name': None, 'owner': 'Administrator', 'creation': None, 'modified': '2024-12-13 10:25:27.957047', 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 0, 'tally_voucher_no': 'AAFEE/3927/23-24', 'tally_guid': 'f293ba3c-54da-4fdd-99e7-cf46bbe4be14-000015a2', 'is_system_generated': 0, 'title': None, 'voucher_type': 'Journal Entry', 'naming_series': 'ACC-JV-.YYYY.-', 'finance_book': None, 'process_deferred_accounting': None, 'reversal_of': None, 'tax_withholding_category': None, 'from_template': None, 'company': 'Swen Konformity LLP', 'posting_date': '20230907', 'apply_tds': 0, 'cheque_no': None, 'cheque_date': None, 'user_remark': None, 'total_debit': 0.0, 'total_credit': 0.0, 'difference': 0.0, 'multi_currency': 0, 'total_amount_currency': None, 'total_amount': 0.0, 'total_amount_in_words': None, 'clearance_date': None, 'remark': None, 'paid_loan': None, 'inter_company_journal_entry_reference': None, 'bill_no': None, 'bill_date': None, 'due_date': None, 'write_off_based_on': 'Accoun...
  File ""apps/frappe/frappe/model/document.py"", line 342, in save
    return self._save(*args, **kwargs)
      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>
      args = ()
      kwargs = {}
  File ""apps/frappe/frappe/model/document.py"", line 372, in _save
    self.check_if_latest()
      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>
      ignore_permissions = None
      ignore_version = None
  File ""apps/frappe/frappe/model/document.py"", line 827, in check_if_latest
    frappe.msgprint(
      self = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>
      previous = <TallyMigration: Tally Migration on 29-11-2024 12:16:19>
  File ""apps/frappe/frappe/__init__.py"", line 567, in msgprint
    _raise_exception()
      msg = 'Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.'
      title = None
      raise_exception = <class 'frappe.exceptions.TimestampMismatchError'>
      as_table = False
      as_list = False
      indicator = 'red'
      alert = False
      primary_action = None
      is_minimizable = False
      wide = False
      realtime = False
      sys = <module 'sys' (built-in)>
      _raise_exception = <function msgprint.<locals>._raise_exception at 0x7f7932a6a3e0>
      inspect = <module 'inspect' from '/usr/lib/python3.11/inspect.py'>
      out = {'message': 'Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.', 'title': 'Message', 'indicator': 'red', 'raise_exception': 1, '__frappe_exc_id': '1950e66a485a6bbbce7eafad124f3b23120ab58fa383d9fbcc26435b'}
  File ""apps/frappe/frappe/__init__.py"", line 518, in _raise_exception
    raise exc
      exc = TimestampMismatchError('Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.')
      inspect = <module 'inspect' from '/usr/lib/python3.11/inspect.py'>
      msg = 'Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.'
      out = {'message': 'Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.', 'title': 'Message', 'indicator': 'red', 'raise_exception': 1, '__frappe_exc_id': '1950e66a485a6bbbce7eafad124f3b23120ab58fa383d9fbcc26435b'}
      raise_exception = <class 'frappe.exceptions.TimestampMismatchError'>
frappe.exceptions.TimestampMismatchError: Error: Document has been modified after you have opened it (2024-12-13 10:25:27.803618, 2024-12-13 10:25:27.963170). Please refresh to get the latest document.
```

nabinhait on (2025-01-13 09:03:18 UTC): We have removed Tally Migration in the latest version, closing the issue.

"
2736051572,issue,closed,completed,Issue: Stock Entry uses incorrect company when generated from Pick List,"### Information about bug

When creating a Stock Entry from a Pick List, the company associated with the Stock Entry is incorrect. This occurs even when the Pick List is created from a Material Request with the correct company.

### Module

stock

### Version

V14

### Installation method

docker

### Relevant log output / Stack trace / Full Error Message.

```shell
Steps to Reproduce
1
Create a Material Requisition of type ""Material Transfer"" for a specific company code (e.g. ""company2"").
2
Create a Picking List from the Requisition.
3
Generate a Stock Entry from the Picking List.
4
Verify that the company code associated with the Stock Entry does not match the company code of the original Requisition (""company2"").
Issue Location
The issue is likely located in the `pick_list.py file (lines 865-878) of the `erpnext.stock.doctype.pick_list.` module.
Proposed Solution
To fix this issue, it is suggested to change the line `stock_entry.company = pick_list.get(""company"") to get the correct company code from the original Material Requisition.
```
",hqnicolas,2024-12-12 14:20:06+00:00,[],2025-01-28 00:10:16+00:00,2025-01-13 09:03:58+00:00,https://github.com/frappe/erpnext/issues/44678,"[('bug', None)]",[],
2735808522,issue,closed,completed,Creating a Serial and Batch Bundle from a purchase receipt doesn't work anymore,"### Information about bug

I noticed that creating a Serial and Batch Bundle through the pop-up when adding a new item to a purchase receipt doesn't work anymore. The action fails due to a recent code change ([commit 7f7564b line 446](https://github.com/frappe/erpnext/commit/7f7564b581b8bc2e373b1bf6fc668b54f375d00c#diff-3be1fdd9b4eafcbf43c01df1b23134f6bb49a1782a33f4223e8792b77d244faeL448) by @rohitwaghchaure).

![image](https://github.com/user-attachments/assets/6db1986b-82c4-410b-9749-b65e447a0ef7)

I have identified the exact line where things go wrong, as well as the reason why.

When getting the rate for a not-yet-existing Purchase Receipt Item, the following line returns `None`:
```py
rate = frappe.db.get_value(child_table, self.voucher_detail_no, valuation_field)
```

When this rate is later on used to perform the calculation in line 446, the multiplication fails due to `d.incoming_rate` being `None`:
```py
d.stock_value_difference = d.qty * d.incoming_rate
```

Before this commit that was not the case, as both `d.qty` and `d.incoming_rate` where first converted to a float:
```py
d.stock_value_difference = flt(d.qty) * flt(d.incoming_rate)
```

My proposed solution would be to change this line again in the same way, or change the line right above the if statement as follows:
```diff
- d.incoming_rate = rate
+ d.incoming_rate = rate if rate else 0
if d.qty:
    d.stock_value_difference = d.qty * d.incoming_rate
```

### Module

stock, buying

### Version

Frappe version 15.45.5
ERPNext version 15.50.0

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

```shell
### App Versions

{
	""erpnext"": ""15.45.5"",
	""frappe"": ""15.50.0"",
}
```
### Route
```
Form/Purchase Receipt/new-purchase-receipt-cbrubpndkc
```
### Traceback
```
Traceback (most recent call last):
  File ""apps/frappe/frappe/app.py"", line 114, in application
    response = frappe.api.handle(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/__init__.py"", line 49, in handle
    data = endpoint(**arguments)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/api/v1.py"", line 36, in handle_rpc_call
    return frappe.handler.handle()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 49, in handle
    data = execute_cmd(cmd)
           ^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/handler.py"", line 85, in execute_cmd
    return frappe.call(method, **frappe.form_dict)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/__init__.py"", line 1725, in call
    return fn(*args, **newargs)
           ^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/utils/typing_validations.py"", line 31, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/desk/form/save.py"", line 39, in savedocs
    doc.save()
  File ""apps/frappe/frappe/model/document.py"", line 342, in save
    return self._save(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 364, in _save
    return self.insert()
           ^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 295, in insert
    self.run_before_save_methods()
  File ""apps/frappe/frappe/model/document.py"", line 1103, in run_before_save_methods
    self.run_method(""validate"")
  File ""apps/frappe/frappe/model/document.py"", line 974, in run_method
    out = Document.hook(fn)(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1334, in composer
    return composed(self, method, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 1316, in runner
    add_to_return_value(self, fn(self, *args, **kwargs))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/frappe/frappe/model/document.py"", line 971, in fn
    return method_object(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""apps/erpnext/erpnext/stock/doctype/purchase_receipt/purchase_receipt.py"", line 235, in validate
    super().validate()
  File ""apps/erpnext/erpnext/controllers/buying_controller.py"", line 63, in validate
    self.set_serial_and_batch_bundle()
  File ""apps/erpnext/erpnext/controllers/stock_controller.py"", line 780, in set_serial_and_batch_bundle
    frappe.get_doc(""Serial and Batch Bundle"", row.get(field)).set_serial_and_batch_values(
  File ""apps/erpnext/erpnext/stock/doctype/serial_and_batch_bundle/serial_and_batch_bundle.py"", line 554, in set_serial_and_batch_values
    self.set_incoming_rate(parent=parent, row=row, save=True)
  File ""apps/erpnext/erpnext/stock/doctype/serial_and_batch_bundle/serial_and_batch_bundle.py"", line 262, in set_incoming_rate
    self.set_incoming_rate_for_inward_transaction(row, save)
  File ""apps/erpnext/erpnext/stock/doctype/serial_and_batch_bundle/serial_and_batch_bundle.py"", line 510, in set_incoming_rate_for_inward_transaction
    d.stock_value_difference = d.qty * d.incoming_rate
                               ~~~~~~^~~~~~~~~~~~~~~~~
TypeError: unsupported operand type(s) for *: 'float' and 'NoneType'

```
### Request Data
```
{
	""type"": ""POST"",
	""args"": {
		""doc"": REMOVED,
		""action"": ""Save""
	},
	""freeze"": true,
	""headers"": {},
	""error_handlers"": {},
	""url"": ""/api/method/frappe.desk.form.save.savedocs"",
	""request_id"": null
}
```
### Response Data
```
{
	""exception"": ""TypeError: unsupported operand type(s) for *: 'float' and 'NoneType'"",
	""exc_type"": ""TypeError"",
	""_exc_source"": ""erpnext (app)""
}
```
```
",daanlenaerts,2024-12-12 12:47:37+00:00,[],2025-01-01 00:11:33+00:00,2024-12-17 03:49:59+00:00,https://github.com/frappe/erpnext/issues/44677,"[('bug', None)]",[],
2735428589,issue,open,,[V16] Field alignment issue in dialog due to checkbox field,"### Information about bug

The data entry box for check-box is left aligned, while label is right. Won't keep label on left and block for inserting value on right bring consistency?

<img width=""1184"" alt=""Screenshot 2024-12-12 at 3 28 28 PM"" src=""https://github.com/user-attachments/assets/add02cc3-df24-423f-b804-550acb4288e0"" />


### Module

accounts

### Version

V16

https://gadgetsv16.frappe.cloud/

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",umairsy,2024-12-12 10:00:26+00:00,['sokumon'],2025-01-09 12:47:58+00:00,,https://github.com/frappe/erpnext/issues/44675,"[('bug', None), ('UI', ''), ('v16', '')]",[],
2735409305,issue,closed,completed,[V16] Different Field alignment in Stock Entry > Warehouse section,"### Information about bug

Fields alignment and spacing with label is very erratic

<img width=""1166"" alt=""Screenshot 2024-12-12 at 3 20 28 PM"" src=""https://github.com/user-attachments/assets/ac8c9607-b8ed-4664-9543-5a5f29ad1b83"" />

check in: https://gadgetsv16.frappe.cloud/

### Module

stock

### Version

v16

### Installation method

FrappeCloud

### Relevant log output / Stack trace / Full Error Message.

_No response_",umairsy,2024-12-12 09:52:12+00:00,['iamejaaz'],2025-01-23 00:10:14+00:00,2025-01-08 06:20:42+00:00,https://github.com/frappe/erpnext/issues/44673,"[('bug', None), ('v16', '')]",[],
2735387184,issue,closed,completed,Payment Terms Template is not auto fetching in the purchase invoice. ,"### Information about bug

1. Create a Quotation. And select the Payment Terms Template in terms tab
2. Submit the quotation.
3. Create Sales Order from quotation.  Or else Directly create a new sales order and choose/select the payment terms template in the terms tab. Submit the Sales Order.
4. Create a Delivery Note from Sales Order. And submit the delivery note.
5. Create a Sales Invoice from delivery note. in terms tab Payment Terms Template field is getting empty. what ever we selected the Payment Terms Template in the sales order order those template is not appearing on the template field in the  sales invoice doctype.

### Module

selling

### Version

Version15

### Installation method

manual install

### Relevant log output / Stack trace / Full Error Message.

_No response_",vvvijaynaidu,2024-12-12 09:42:20+00:00,[],2025-01-28 00:10:10+00:00,2025-01-13 11:09:41+00:00,https://github.com/frappe/erpnext/issues/44672,"[('bug', None)]","[{'comment_id': 2544769783, 'issue_id': 2735387184, 'author': 'rahib-hassan', 'body': 'You have to check _""Automatically Fetch Payment Terms from Order""_ in the **Invoice Features** section of the **Accounts Settings** Doctype.', 'created_at': datetime.datetime(2024, 12, 16, 7, 9, 13, tzinfo=datetime.timezone.utc)}]","rahib-hassan on (2024-12-16 07:09:13 UTC): You have to check _""Automatically Fetch Payment Terms from Order""_ in the **Invoice Features** section of the **Accounts Settings** Doctype.

"
2732862138,issue,closed,completed,[V16] Navigation to subcontracting transactions missing from Workspace,"### Information about bug

There are several doctypes specific to Subcontracing, like Subcontracting BOM, Subcontracting Order etc.

However, neither Stock nor Manufacturing module has links to these doctypes. Neither a Workspace existing for subcontracting.

Am I missing something?


### Module

stock, manufacturing

### Version

V16

### Installation method

None

### Relevant log output / Stack trace / Full Error Message.

_No response_",umairsy,2024-12-11 12:35:25+00:00,['iamejaaz'],2025-01-24 00:10:08+00:00,2025-01-06 06:52:24+00:00,https://github.com/frappe/erpnext/issues/44661,"[('bug', None), ('v16', '')]",[],
