id,type,state,state_reason,title,body,author,created_at,assignees,updated_at,closed_at,url,labels,comments_list,comment_thread
2528339337,issue,closed,not_planned,Use axis lables instead of original names in .xlsx export,"### Describe the bug

When the users try to export a question from a dashboard with custom labels to an .xlsx file they have a hard time understand the data since columns are note the same in the file as on the question.

### To Reproduce

1. edit a question with axis (e.g. bar)
2. go to the visualisation settings -> axes and pick custom labels for both axes
![image](https://github.com/user-attachments/assets/1fddaf75-521a-4403-91c2-821a90e5a245)
3. export to xlsx -> columns have original names
![image](https://github.com/user-attachments/assets/5517dcce-d86c-4a7e-ada5-18c395ecb9b5)


### Expected behavior

include the custom labels in the export

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.22+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.22"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.22+7"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-1051-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Europe/Stockholm""
  },
  ""metabase-info"": {
    ""databases"": [
      ""sqlserver"",
      ""h2"",
      ""postgres""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.17""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.5.4""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-01-25"",
      ""tag"": ""v1.47.13"",
      ""branch"": ""?"",
      ""hash"": ""1b6582a""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

annoying

### Additional context

_No response_",BregenzerK,2024-09-16 12:31:43+00:00,[],2024-09-18 23:20:40+00:00,2024-09-16 12:57:05+00:00,https://github.com/metabase/metabase/issues/47950,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Reporting/Export', ''), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2352846195, 'issue_id': 2528339337, 'author': 'paoliniluis', 'body': 'please upgrade', 'created_at': datetime.datetime(2024, 9, 16, 12, 57, 5, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-16 12:57:05 UTC): please upgrade

"
2527964939,issue,closed,completed,Dashboard Subscription sometimes double sends ,"### Describe the bug

My metabase VM starts up everyday 9am. I have a dashboard subscription that is scheduled to send emails on 10am. but sometimes it sends once the VM starts up, then it will send another email at 10am. I observed also that it does that only on Mondays. Basically my VM is up from monday-friday only.

### To Reproduce

1. Create dashboard subscription
2. set the schedule
3. 

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:130.0) Gecko/20100101 Firefox/130.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""mongo"",
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-26"",
      ""tag"": ""v0.50.22"",
      ""hash"": ""16a6c22""
    },
    ""settings"": {
      ""report-timezone"": ""UTC""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8-post-Ubuntu-1ubuntu322.04"",
    ""java.vendor"": ""Ubuntu"",
    ""java.vendor.url"": ""https://ubuntu.com/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8-post-Ubuntu-1ubuntu322.04"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.5.0-1024-azure"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```


### Severity

annoying

### Additional context

_No response_",jrca025,2024-09-16 09:37:44+00:00,[],2025-01-06 10:40:53+00:00,2025-01-06 10:40:02+00:00,https://github.com/metabase/metabase/issues/47949,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Pulses', 'Now called Subscriptions'), ('.Backend', ''), ('.Team/Workflows', 'aka BEC'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2352852005, 'issue_id': 2527964939, 'author': 'paoliniluis', 'body': ""Hi @jrca025, can you check if there's a subscription set up on Sunday that might be misfiring?"", 'created_at': datetime.datetime(2024, 9, 16, 12, 59, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2367150915, 'issue_id': 2527964939, 'author': 'jrca025', 'body': '@paoliniluis there is none actually. is there a way to check the overall dashboard subscriptions? Or what logs should I check for this?', 'created_at': datetime.datetime(2024, 9, 23, 2, 59, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2383986570, 'issue_id': 2527964939, 'author': 'ixipixi', 'body': 'Possibly related to: https://github.com/metabase/metabase/issues/48141', 'created_at': datetime.datetime(2024, 9, 30, 19, 25, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2384604721, 'issue_id': 2527964939, 'author': 'qnkhuat', 'body': ""@jrca025 can I get a dump of this query?\r\n\r\n```sql\r\nselect * from task_history where task = 'send-pulse';\r\n```"", 'created_at': datetime.datetime(2024, 10, 1, 1, 31, 46, tzinfo=datetime.timezone.utc)}, {'comment_id': 2384623495, 'issue_id': 2527964939, 'author': 'jrca025', 'body': ""@qnkhuat I'm still using H2"", 'created_at': datetime.datetime(2024, 10, 1, 1, 52, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2384630637, 'issue_id': 2527964939, 'author': 'qnkhuat', 'body': 'You can use this console to connect and do querying https://www.h2database.com/html/download.html', 'created_at': datetime.datetime(2024, 10, 1, 2, 0, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572837926, 'issue_id': 2527964939, 'author': 'piranha', 'body': 'I think it\'s because we just allow to set ""Daily"" in the UI, which means that after executing the subscription on Friday it schedules another one for Saturday - and that executes at 9:00 AM on Monday. I think this is by design.\n\nWe plan to allow custom schedules in future, which means you\'d be able to configure sending notifications from Monday to Friday.', 'created_at': datetime.datetime(2025, 1, 6, 10, 40, 2, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-16 12:59:36 UTC): Hi @jrca025, can you check if there's a subscription set up on Sunday that might be misfiring?

jrca025 (Issue Creator) on (2024-09-23 02:59:38 UTC): @paoliniluis there is none actually. is there a way to check the overall dashboard subscriptions? Or what logs should I check for this?

ixipixi on (2024-09-30 19:25:21 UTC): Possibly related to: https://github.com/metabase/metabase/issues/48141

qnkhuat on (2024-10-01 01:31:46 UTC): @jrca025 can I get a dump of this query?

```sql
select * from task_history where task = 'send-pulse';
```

jrca025 (Issue Creator) on (2024-10-01 01:52:04 UTC): @qnkhuat I'm still using H2

qnkhuat on (2024-10-01 02:00:28 UTC): You can use this console to connect and do querying https://www.h2database.com/html/download.html

piranha on (2025-01-06 10:40:02 UTC): I think it's because we just allow to set ""Daily"" in the UI, which means that after executing the subscription on Friday it schedules another one for Saturday - and that executes at 9:00 AM on Monday. I think this is by design.

We plan to allow custom schedules in future, which means you'd be able to configure sending notifications from Monday to Friday.

"
2527685574,issue,open,,"Error on home page after upgrade with error ""OffsetDateTime cannot be cast ...""","**Describe the bug**
After upgrade from v.0.49.9 to v-0.50.25 admins now see an error on the start page

**Logs**
```
[c00c0535-a69a-4d00-98d5-005b9a5b0451] 2024-09-16T14:07:02+07:00 ERROR metabase.server.middleware.log GET /api/activity/popular_items 500 30.5 ms (2 DB calls) {:metabase-user-id 29} 
{:via
 [{:type java.lang.ClassCastException,
   :message
   ""class java.time.OffsetDateTime cannot be cast to class java.time.chrono.ChronoLocalDateTime (java.time.OffsetDateTime and java.time.chrono.ChronoLocalDateTime are in module java.base of loader 'bootstrap')"",
   :at [java.time.LocalDateTime compareTo nil -1]}],
 :trace
 [[java.time.LocalDateTime compareTo nil -1]
  [clojure.lang.Util compare ""Util.java"" 153]
  [clojure.core$compare invokeStatic ""core.clj"" 842]
  [clojure.core$compare invoke ""core.clj"" 833]
  [clojure.lang.AFunction compare ""AFunction.java"" 51]
  [clojure.core$sort_by$fn__6045 invoke ""core.clj"" 3133]
  [clojure.lang.AFunction compare ""AFunction.java"" 51]
  [java.util.TimSort countRunAndMakeAscending nil -1]
  [java.util.TimSort sort nil -1]
  [java.util.Arrays sort nil -1]
  [clojure.core$sort invokeStatic ""core.clj"" 3117]
  [clojure.core$sort_by invokeStatic ""core.clj"" 3121]
  [clojure.core$sort_by invokeStatic ""core.clj"" 3121]
  [clojure.core$sort_by invoke ""core.clj"" 3121]
  [metabase.api.activity$views_and_runs invokeStatic ""activity.clj"" 108]
  [metabase.api.activity$views_and_runs invoke ""activity.clj"" 63]
  [metabase.api.activity$get_popular_items_model_and_id invokeStatic ""activity.clj"" 211]
  [metabase.api.activity$get_popular_items_model_and_id invoke ""activity.clj"" 202]
  [metabase.api.activity$fn__101692 invokeStatic ""activity.clj"" 238]
  [metabase.api.activity$fn__101692 invoke ""activity.clj"" 234]
  [compojure.core$wrap_response$fn__52754 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__52738 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__52743 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [metabase.server.middleware.auth$enforce_authentication$fn__97278 invoke ""auth.clj"" 18]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__52794 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__52798 invoke ""core.clj"" 300]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52798 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [metabase.api.routes$fn__102954$fn__102957 invoke ""routes.clj"" 73]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__103234$fn__103235 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__52794 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__52798 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [metabase.server.routes$fn__103217$fn__103219 invoke ""routes.clj"" 47]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__99312 invoke ""exceptions.clj"" 107]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__99309 invoke ""exceptions.clj"" 96]
  [metabase.server.middleware.log$log_api_call$fn__103521$fn__103522$fn__103523 invoke ""log.clj"" 233]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__103521$fn__103522 invoke ""log.clj"" 224]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__103521 invoke ""log.clj"" 223]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__106811 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__99268 invoke ""security.clj"" 246]
  [ring.middleware.json$wrap_json_body$fn__107070 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__87699 invoke ""offset_paging.clj"" 43]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__54361 invoke ""json.clj"" 83]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__107159 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__107178 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__64160 invoke ""misc.clj"" 59]
  [metabase.server.middleware.session$reset_session_timeout$fn__65711 invoke ""session.clj"" 548]
  [metabase.server.middleware.session$bind_current_user$fn__65677$fn__65678 invoke ""session.clj"" 443]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 422]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 405]
  [metabase.server.middleware.session$bind_current_user$fn__65677 invoke ""session.clj"" 442]
  [metabase.server.middleware.session$wrap_current_user_info$fn__65658 invoke ""session.clj"" 381]
  [metabase.server.middleware.session$wrap_session_id$fn__65630 invoke ""session.clj"" 259]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__97286 invoke ""auth.clj"" 32]
  [ring.middleware.cookies$wrap_cookies$fn__106998 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__64142 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__64168 invoke ""misc.clj"" 75]
  [ring.middleware.gzip$wrap_gzip$fn__107040 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.misc$bind_request$fn__64171 invoke ""misc.clj"" 91]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__106827 invoke ""ssl.clj"" 51]
  [metabase.server$async_proxy_handler$fn__71902 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run nil -1]],
 :cause
 ""class java.time.OffsetDateTime cannot be cast to class java.time.chrono.ChronoLocalDateTime (java.time.OffsetDateTime and java.time.chrono.ChronoLocalDateTime are in module java.base of loader 'bootstrap')"",
 :message
 ""class java.time.OffsetDateTime cannot be cast to class java.time.chrono.ChronoLocalDateTime (java.time.OffsetDateTime and java.time.chrono.ChronoLocalDateTime are in module java.base of loader 'bootstrap')""}
 ```

**To Reproduce**
Steps to reproduce the behavior:
1. Login
2. See error on startpage

**Expected behavior**
Seeing recently viewed questions and dashboard

**Screenshots**

![image](https://github.com/user-attachments/assets/77c76924-a0f6-4f64-b4a2-01ac1ae85171)

**Severity**
It's not blocking, but the startpage is ""Broken""

**Additional context**
The application runs through Kubernetes cluster

**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-09-10"",
      ""tag"": ""v0.50.25"",
      ""hash"": ""473a7ca""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Stockholm""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.39""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.224-212.876.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Europe/Stockholm""
  }
}
```",BenjaminGK,2024-09-16 07:15:11+00:00,[],2024-12-10 01:51:24+00:00,,https://github.com/metabase/metabase/issues/47948,[],"[{'comment_id': 2352983255, 'issue_id': 2527685574, 'author': 'paoliniluis', 'body': '@BenjaminGK  Is it possible that your mysql database is set to another timezone?', 'created_at': datetime.datetime(2024, 9, 16, 13, 49, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2357353088, 'issue_id': 2527685574, 'author': 'BenjaminGK', 'body': ""@paoliniluis Yes it is set to a different timezone (Europe/Amsterdam vs Europe/Stockholm) which is essentially the same. Changing it to match everywhere doesn't change it though"", 'created_at': datetime.datetime(2024, 9, 18, 2, 14, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2527385414, 'issue_id': 2527685574, 'author': 'benoittgt', 'body': 'We have the same error. Any idea?', 'created_at': datetime.datetime(2024, 12, 9, 9, 28, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2527855247, 'issue_id': 2527685574, 'author': 'paoliniluis', 'body': ""@BenjaminGK @benoittgt can you run the following query in the application database?\n\nSELECT @@global.time_zone, @@session.time_zone;\n\nI have set:\n1) metabase user timezone to Stockholm\n2) metabase reporting timezone to Stockholm\n3) application database (mysql) timezone to Stockholm\n\nand I can't hit the issue when I hit the /api/popular_items endpoint on v51"", 'created_at': datetime.datetime(2024, 12, 9, 12, 56, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2530018071, 'issue_id': 2527685574, 'author': 'BenjaminGK', 'body': ""@paoliniluis I don't actually think it is related to time zone settings.\nMy reason for saying this is that we were actually able to solve this issue as a test by creating a new metabase instance on the same version, and then copy all data (data only and not structure) from the old metabase database to the newly created tables and the issue was not found. \nSo my suspicion is that somewhere in the migration process something has failed to be updated which then causes the issue.\nI could of cause be wrong and we would prefer not to do it this way if we can avoid it"", 'created_at': datetime.datetime(2024, 12, 10, 1, 51, 23, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-16 13:49:57 UTC): @BenjaminGK  Is it possible that your mysql database is set to another timezone?

BenjaminGK (Issue Creator) on (2024-09-18 02:14:24 UTC): @paoliniluis Yes it is set to a different timezone (Europe/Amsterdam vs Europe/Stockholm) which is essentially the same. Changing it to match everywhere doesn't change it though

benoittgt on (2024-12-09 09:28:34 UTC): We have the same error. Any idea?

paoliniluis on (2024-12-09 12:56:53 UTC): @BenjaminGK @benoittgt can you run the following query in the application database?

SELECT @@global.time_zone, @@session.time_zone;

I have set:
1) metabase user timezone to Stockholm
2) metabase reporting timezone to Stockholm
3) application database (mysql) timezone to Stockholm

and I can't hit the issue when I hit the /api/popular_items endpoint on v51

BenjaminGK (Issue Creator) on (2024-12-10 01:51:23 UTC): @paoliniluis I don't actually think it is related to time zone settings.
My reason for saying this is that we were actually able to solve this issue as a test by creating a new metabase instance on the same version, and then copy all data (data only and not structure) from the old metabase database to the newly created tables and the issue was not found. 
So my suspicion is that somewhere in the migration process something has failed to be updated which then causes the issue.
I could of cause be wrong and we would prefer not to do it this way if we can avoid it

"
2526938274,issue,open,,"Inconsistency in how tables and other viz's work with fields that have ""show only in detail view"" visibility","### Describe the bug

We seem to have wiped a bug in v49 where we still showed a field even if we had the ""show only on detail views"" setting (we no longer show the field in the table visualization), but we do still show it on other charts (e.g. do a line chart and you'll get the field there)

### To Reproduce

1) set a field to only show on detail view
2) make a line chart
3) the field is there

### Expected behavior

should this field be shown at all? does the setting only apply to table view and only if you have the ID?

### Logs

NA

### Information about your Metabase installation

```JSON
v50.x
```


### Severity

P3

### Additional context

Check ticket 30269",paoliniluis,2024-09-15 14:26:03+00:00,[],2025-02-04 20:29:55+00:00,,https://github.com/metabase/metabase/issues/47945,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/', ''), ('.Frontend', ''), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2359615740, 'issue_id': 2526938274, 'author': 'ranquild', 'body': ""It's indeed implemented for table & object detail views only atm"", 'created_at': datetime.datetime(2024, 9, 18, 23, 21, 48, tzinfo=datetime.timezone.utc)}]","ranquild on (2024-09-18 23:21:48 UTC): It's indeed implemented for table & object detail views only atm

"
2526590264,issue,open,,"When ""Auto y-axis range"" is disabled, if the lower limit is higher than the min value, lower limit for y-axis is set to 0","### Describe the bug

When ""Auto y-axis range"" is disabled, if the lower limit is higher than the min value, lower limit for y-axis is set to 0.

![Screenshot 2024-09-14 130520](https://github.com/user-attachments/assets/f3bffe0b-fb8b-42a4-8b72-619d0c7e3eb8)
![Screenshot 2024-09-14 130533](https://github.com/user-attachments/assets/f96641b5-cb8b-4311-9c60-1dbaebbb0fd7)


### To Reproduce

- Sample Dataset -> Products -> Average of rating group by category
- Line Chart -> Disable ""Auto y-axis range"", set higher limit to 4. 
- Now if we set lower limit to 3.1 it works fine, but if we set it to 3.2 the y-axis min value gets set to 0.


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
v.50.25
```


### Severity

Low

### Additional context

_No response_",vvaezian,2024-09-14 20:06:33+00:00,[],2025-02-04 20:31:27+00:00,,https://github.com/metabase/metabase/issues/47944,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Visualization/Chart Settings', ''), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2525748892,issue,open,,Run backend tests with EE features enabled by default,"Follow-up issue for https://github.com/metabase/metabase/issues/47704

Currently backend tests in CI don't have an EE token provided, so don't run with any premium features enabled. We require backend tests to opt-in to specific features that are relevant to each test.

However, this can lead to a situation where a test doesn't enable every feature that could be relevant, thus skipping code paths which could otherwise cause test failures.

We should consider running tests with two tokens: one with all features enabled, and one with no features enabled. This way, we can ensure we're testing for every possible combination of OSS/EE build and features enabled or disabled.",noahmoss,2024-09-13 21:48:19+00:00,[],2025-02-04 20:29:48+00:00,,https://github.com/metabase/metabase/issues/47941,"[('Type:Tech Debt', 'or Refactoring'), ('.CI & Tests', ''), ('postmortem-followup', '')]",[],
2525719270,issue,closed,completed,Casting UNIX to Datetime on a Field Generates Invalid SQL in Several Cases,"### Describe the bug

If you have a datetime stored in UNIX format and cast the field to datetime it shows up correctly in the Questions. If you JOIN this to another question it generates invalid SQL:

![wut](https://github.com/user-attachments/assets/0164141a-eb4b-40f7-88c3-e7dbc409490b)


```
ERROR: operator does not exist: timestamp with time zone / integer
  Hint: No operator matches the given name and argument types. You might need to add explicit type casts.
  Position: 180
```

This also presents if you bad Questions promoted to models before you applied the CAST. 

### To Reproduce

1. Set up a test table in Postgres with sample data in it:

`CREATE TABLE hits (
    id SERIAL PRIMARY KEY,
    hit_time BIGINT
);
`

`INSERT INTO hits (hit_time) VALUES
(1724693536475),
(1724694536475),
(1724695536475);
`

2. Create a GUI question with this table in Metabase
3. Promote the Question to a Model
4. In Table Metadata, cast the field with ""UNIX milliseconds → Datetime""
5. Refresh the model & observe the error

Second path: 
1. Create a GUI question with this table in Metabase (don't promote this one)
2. Start a question in Metabase with another table and then JOIN the Question with the date column in it 
3. Run it
4. Observe the error




### Expected behavior

We should generate valid SQL in these cases

### Logs

_No response_

### Information about your Metabase installation

```JSON
v50.25
```


### Severity

Prevents users form leveraging models in some cases

### Additional context

_No response_",ixipixi,2024-09-13 21:21:07+00:00,['metamben'],2024-11-19 17:39:00+00:00,2024-11-19 16:39:36+00:00,https://github.com/metabase/metabase/issues/47940,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Processor', ''), ('.Backend', ''), ('Querying/Models', 'aka Datasets'), ('.Team/Querying', '')]","[{'comment_id': 2356655458, 'issue_id': 2525719270, 'author': 'camsaul', 'body': 'See also https://github.com/metabase/metabase/issues/38994', 'created_at': datetime.datetime(2024, 9, 17, 18, 48, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2451904356, 'issue_id': 2525719270, 'author': 'parker-codes', 'body': 'I also ran into this issue. My tables were set up to cast from unix timestamps (in seconds). These unix timestamps worked well for a single question, but failed with `ERROR: function to_timestamp(date) does not exist Hint: No function matches the given name and argument types. You might need to add explicit type casts.` when I would use a 3rd question to join the results of two other questions that exposed those timestamps.\n\nI converted all of the timestamps in the DB to be ""proper"", and now it works just fine. This makes me think that it was properly casting at one question ""deep"", but not understanding when to cast or not cast as those questions were composed.\n\nSee support ticket 31722 for more info.', 'created_at': datetime.datetime(2024, 11, 1, 13, 49, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2455139802, 'issue_id': 2525719270, 'author': 'metamben', 'body': ""@ixipixi the two reproduction paths highlight different causes. The one with the model doesn't fail in 0.49.17, the one with the join does (so it's not a regression in 0.50.x). The problem with the model is easier to fix. Would fixing the model reduce the priority of this issue? If yes, I create a PR fixing only that."", 'created_at': datetime.datetime(2024, 11, 4, 16, 18, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2455568946, 'issue_id': 2525719270, 'author': 'metamben', 'body': '#49502 should fix the v50 regression.', 'created_at': datetime.datetime(2024, 11, 4, 19, 49, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2460243749, 'issue_id': 2525719270, 'author': 'ixipixi', 'body': ""@metamben I didn't set the priority on this one. Looks like @ranquild made that change and may have some additional context?"", 'created_at': datetime.datetime(2024, 11, 6, 16, 29, 19, tzinfo=datetime.timezone.utc)}]","camsaul on (2024-09-17 18:48:35 UTC): See also https://github.com/metabase/metabase/issues/38994

parker-codes on (2024-11-01 13:49:26 UTC): I also ran into this issue. My tables were set up to cast from unix timestamps (in seconds). These unix timestamps worked well for a single question, but failed with `ERROR: function to_timestamp(date) does not exist Hint: No function matches the given name and argument types. You might need to add explicit type casts.` when I would use a 3rd question to join the results of two other questions that exposed those timestamps.

I converted all of the timestamps in the DB to be ""proper"", and now it works just fine. This makes me think that it was properly casting at one question ""deep"", but not understanding when to cast or not cast as those questions were composed.

See support ticket 31722 for more info.

metamben (Assginee) on (2024-11-04 16:18:29 UTC): @ixipixi the two reproduction paths highlight different causes. The one with the model doesn't fail in 0.49.17, the one with the join does (so it's not a regression in 0.50.x). The problem with the model is easier to fix. Would fixing the model reduce the priority of this issue? If yes, I create a PR fixing only that.

metamben (Assginee) on (2024-11-04 19:49:26 UTC): #49502 should fix the v50 regression.

ixipixi (Issue Creator) on (2024-11-06 16:29:19 UTC): @metamben I didn't set the priority on this one. Looks like @ranquild made that change and may have some additional context?

"
2525696553,issue,open,,Frontend Query Validator Cleanup,"[discussion](https://metaboat.slack.com/archives/C06V3JMECH2/p1725041262830449)
- [ ] limit table width
- [ ] introduce loading state
- [ ] show total number of pages
- [ ] disable sorting on created by column

_We had hoped to use our new table component for this so it could handle most of these, but that timing may not work out before the v51 release_",iethree,2024-09-13 21:03:23+00:00,[],2024-12-13 21:54:20+00:00,,https://github.com/metabase/metabase/issues/47939,[],[],
2525658144,issue,open,,"Specifying a y-axis range doesn't work if you don't ""split y-axis when necessary""","### Describe the bug

THe graph does not work/respect the range if i toggle off ""split y-axis when necessary"" and toggle off ""auto y-axis range"" and specify a range

### To Reproduce

* Make a line chart with 2 lines
* Maybe the default behaviour, it splits y-axis so there is 1 y-axis for 1 line and 2nd y-axis for 2nd line
* Then toggle off ""split y-axis when necessary"" and see the 2 lines use 1 y-axis. nice
* Then toggle off ""auto y-axis range""
* Then type in a range of 0- 10 . the graph does not update

(i tried then looking at the individual preferences for each line under ""data"" tab and tweaked some stuff, no impact)

### Expected behavior

If i toggle off ""split y-axis when necessary"" and toggle off ""auto y-axis range"" and specify a range, the chart should obey this range.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.22+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.22"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.22+7"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.223-212.873.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""snowflake"",
      ""redshift""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.6.0""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-03-04"",
      ""tag"": ""v0.48.8"",
      ""hash"": ""a900c85""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

Blocking

### Additional context

_No response_",aarthi-subramanian,2024-09-13 20:40:26+00:00,[],2025-02-04 20:31:26+00:00,,https://github.com/metabase/metabase/issues/47938,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/Chart Settings', ''), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2525651741,issue,closed,completed,Gauge middle label sometimes is not visible,"**Context**

In some cases gauge chart middle label becomes hidden — [slack report](https://metaboat.slack.com/archives/C01LQQ2UW03/p1726258978599119)

",alxnddr,2024-09-13 20:35:50+00:00,['lorem--ipsum'],2025-01-29 09:40:54+00:00,2025-01-28 14:39:38+00:00,https://github.com/metabase/metabase/issues/47937,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Scalars', 'Numbers, progress bars, gauges'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2525367998,issue,closed,completed,"fix percent label not appearing on ""other"" slice","<img width=""1221"" alt=""Screenshot 2024-09-13 at 10 53 50 AM"" src=""https://github.com/user-attachments/assets/e77df8ed-f4c1-47cb-b878-6ab5666fa895"">

left is how it looked before and should be, right is what the branch currently outputs

http://localhost:6006/?path=/story/static-viz-piechart--all-settings",EmmadUsmani,2024-09-13 17:54:30+00:00,['EmmadUsmani'],2024-09-18 17:55:41+00:00,2024-09-18 17:55:41+00:00,https://github.com/metabase/metabase/issues/47931,[],[],
2525119079,issue,open,,Provide more user-friendly error messages to FE when operations fail,"**Context**

[Slack convo](https://metaboat.slack.com/archives/C064QMXEV9N/p1726174017251939)

We should provide more user-friendly error messages to users instead of confusing stack traces or sql errors.
The slack report is about saving dashboard but I believe this is common to many if not all operations in modals and not only.



",alxnddr,2024-09-13 15:33:34+00:00,[],2024-09-13 15:33:35+00:00,,https://github.com/metabase/metabase/issues/47926,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2524754601,issue,closed,completed,Add detailed dashboard info component,,iethree,2024-09-13 12:42:45+00:00,['iethree'],2024-10-08 16:14:19+00:00,2024-09-26 15:09:33+00:00,https://github.com/metabase/metabase/issues/47919,[],[],
2524134719,issue,closed,completed,[Epic] Make query builder UI controls more predictable,"**Links**
- product doc: https://www.notion.so/metabase/Make-query-builder-UI-controls-more-predictable-6fd99a110a954c2fb3fba8d8a8c24ae5
- feature branch: `qb-predictable`
- testing plan - ML1 changes only existing functionality, so no new tests required, ML2 requires a new testing plan



```[tasklist]
### Actual Milestone
- [ ] https://github.com/metabase/metabase/pull/51651
- [ ] https://github.com/metabase/metabase/pull/51650
- [ ] https://github.com/metabase/metabase/pull/51670
- [ ] https://github.com/metabase/metabase/pull/51666
- [ ] https://github.com/metabase/metabase/pull/51655
- [ ] https://github.com/metabase/metabase/pull/51671
- [ ] https://github.com/metabase/metabase/pull/51674
- [ ] https://github.com/metabase/metabase/pull/51903
- [ ] https://github.com/metabase/metabase/pull/51905
```










### Abandoned

```[tasklist]
### Milestone 1 - Abandoned
- [x] Change Last to Previous
- [x] Change the icon for the preview buttons to the eye icon
- [x] Add View the SQL / Hide the SQL text to the SQL preview button instead of the tooltip
- [x] Rename Visualization to Visualization type and add Settings text to the viz settings button
- [x] Add Results and Visualization texts to the viz switch
- [x] Change the visual style of the buttons so that they all look active instead of 3 active ones
- [x] sort the buttons in the order of the blocks they will add
- [x] Show small Join data and Custom column buttons when there is an aggregation without breakouts in the last query stage
```


```[tasklist]
### Milestone 2 - Abandoned
- [x] Convert ChartSettinsg to TS
- [ ] https://github.com/metabase/metabase/issues/50027
- [ ] https://github.com/metabase/metabase/issues/50026
- [ ] https://github.com/metabase/metabase/issues/50262
- [ ] https://github.com/metabase/metabase/issues/50265
- [ ] https://github.com/metabase/metabase/issues/50358
- [ ] https://github.com/metabase/metabase/issues/50362
- [x] hide chart settings button in results view
- [ ] https://github.com/metabase/metabase/issues/50025
- [ ] https://github.com/metabase/metabase/issues/50263
- [ ] https://github.com/metabase/metabase/issues/50451
- [ ] https://github.com/metabase/metabase/issues/50452
- [ ] button height problem
```

",uladzimirdev,2024-09-13 07:53:11+00:00,['uladzimirdev'],2025-01-17 20:50:36+00:00,2025-01-17 20:50:35+00:00,https://github.com/metabase/metabase/issues/47911,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2523978732,issue,closed,not_planned,New dashboard filters no longer work when referring to a Custom column,"### Describe the bug

Issue related to https://github.com/metabase/metabase/issues/44354

If for the filter I select a normal column for ""Column to supply the values"", then the values of the column will be correctly displayed on the right part.
But if I select a custom column, I get the message ""An error occurred in your query"" thus it is not possible to display the values for the filtering.

### To Reproduce

1. Create a dashboard with a filter:
![image](https://github.com/user-attachments/assets/69da6c7e-b6c9-4bce-b9fa-e2d268b502e4)

2. Create a question with a custom column:
![image](https://github.com/user-attachments/assets/25364205-0b68-4565-93d2-e1c3436625c4)

3. Configure the filter to use the custom column:
![image](https://github.com/user-attachments/assets/2b0452c1-4de6-45cb-abda-5e556784dfbc)


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
Metabase v0.50.23
```


### Severity

Blocking some users

### Additional context

_No response_",MarcSamD,2024-09-13 06:28:01+00:00,[],2024-10-15 13:12:32+00:00,2024-10-15 13:12:31+00:00,https://github.com/metabase/metabase/issues/47908,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Frontend', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('Querying/Remapping', 'Remapped display values, whether human-readable values or Field->Field remappings'), ('.metabase-lib', 'Label for tracking all issues related to the shared CLJC metabase-lib'), ('.Team/Querying', '')]","[{'comment_id': 2413682007, 'issue_id': 2523978732, 'author': 'bshepherdson', 'body': 'The `api/dataset/parameter/values` request references the field as `[:field ""CatVend"" {:base-type :type/Text}]` which returns a 500. The BE cannot find that field, because the correct reference to a custom column is `[:expression ""CatVend"" {:base-type :type/Text}]`.\n\nTweaking that request and sending it with curl returns the correct `CatVend` values from the BE, so this is a FE issue. It should be sending correct refs for expressions. (The right solution is to convert the MBQL lib column for the filter to a legacy ref, which should use the correct `:field`/`:expression`/`:aggregation` form.)', 'created_at': datetime.datetime(2024, 10, 15, 11, 43, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2413880700, 'issue_id': 2523978732, 'author': 'ranquild', 'body': 'Duplicate of https://github.com/metabase/metabase/issues/44703', 'created_at': datetime.datetime(2024, 10, 15, 13, 12, 31, tzinfo=datetime.timezone.utc)}]","bshepherdson on (2024-10-15 11:43:22 UTC): The `api/dataset/parameter/values` request references the field as `[:field ""CatVend"" {:base-type :type/Text}]` which returns a 500. The BE cannot find that field, because the correct reference to a custom column is `[:expression ""CatVend"" {:base-type :type/Text}]`.

Tweaking that request and sending it with curl returns the correct `CatVend` values from the BE, so this is a FE issue. It should be sending correct refs for expressions. (The right solution is to convert the MBQL lib column for the filter to a legacy ref, which should use the correct `:field`/`:expression`/`:aggregation` form.)

ranquild on (2024-10-15 13:12:31 UTC): Duplicate of https://github.com/metabase/metabase/issues/44703

"
2523961799,issue,closed,completed,mysql 1 and 0 are incorrectly automatically converted to true and false.,"### Describe the bug


<img width=""535"" alt=""image"" src=""https://github.com/user-attachments/assets/57946654-35c5-4146-9c9a-f1f5ca3545bc"">

`use_type` tinyint(1)


### To Reproduce

1. Go to SQL Query 
2. create test table and include filed 'use_type tinyint(1)'
3. select * from xxx_table
4. see error


### Expected behavior

0 or 1

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-09-06"",
      ""tag"": ""v0.50.24.4"",
      ""hash"": ""3b502f8""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Shanghai""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""3.10.0-1160.el7.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""US/Pacific""
  }
}
```


### Severity

I hope it can be displayed consistently with MySQL Console

### Additional context

_No response_",xys2015,2024-09-13 06:15:36+00:00,[],2024-09-23 02:48:35+00:00,2024-09-19 06:32:16+00:00,https://github.com/metabase/metabase/issues/47907,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Database/MySQL', None), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2349269498, 'issue_id': 2523961799, 'author': 'bshepherdson', 'body': 'There may not be much we can do here, since this behaviour is coming directly from the JDBC driver.\r\n\r\n```clojure\r\n;; Create a basic table with a tinyint(1) column.\r\n(jdbc/execute! mysql [""create table boolean_demo (number tinyint(1), description text)""])\r\n(jdbc/execute! mysql [""insert into boolean_demo values (1, \'true?\'), (0, \'false?\')""])\r\n\r\n;; Using the MySQL JDBC driver directly, nothing from Metabase.\r\n(with-open [connection (java.sql.DriverManager/getConnection conn-string)\r\n            statement  (.prepareStatement connection ""select * from boolean_demo"")\r\n            rs (.executeQuery statement)]\r\n  (let [column-count (.getColumnCount (.getMetaData rs))]\r\n    (into []\r\n          (take-while some?)\r\n          (repeatedly\r\n            (fn []\r\n              (when (.next rs)\r\n                (into [] (for [i (range 1 (inc column-count))]\r\n                           (.getObject rs i)))))))))\r\n\r\n;; which returns\r\n[[true ""true?""] [false ""false?""]]\r\n```\r\n\r\n(Hat tip to @dpsutton for the exploration.)\r\n\r\nThat is, the JDBC driver interprets `tinyint(1)` as booleans and returns Java boolean values in the results.', 'created_at': datetime.datetime(2024, 9, 13, 15, 51, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2367144042, 'issue_id': 2523961799, 'author': 'xys2015', 'body': 'this can turn off by JDBC connection string options like this\r\n\r\n<img width=""716"" alt=""image"" src=""https://github.com/user-attachments/assets/4e9b1ad5-9964-44f4-9d56-4e7232bc4656"">', 'created_at': datetime.datetime(2024, 9, 23, 2, 48, 34, tzinfo=datetime.timezone.utc)}]","bshepherdson on (2024-09-13 15:51:40 UTC): There may not be much we can do here, since this behaviour is coming directly from the JDBC driver.

```clojure
;; Create a basic table with a tinyint(1) column.
(jdbc/execute! mysql [""create table boolean_demo (number tinyint(1), description text)""])
(jdbc/execute! mysql [""insert into boolean_demo values (1, 'true?'), (0, 'false?')""])

;; Using the MySQL JDBC driver directly, nothing from Metabase.
(with-open [connection (java.sql.DriverManager/getConnection conn-string)
            statement  (.prepareStatement connection ""select * from boolean_demo"")
            rs (.executeQuery statement)]
  (let [column-count (.getColumnCount (.getMetaData rs))]
    (into []
          (take-while some?)
          (repeatedly
            (fn []
              (when (.next rs)
                (into [] (for [i (range 1 (inc column-count))]
                           (.getObject rs i)))))))))

;; which returns
[[true ""true?""] [false ""false?""]]
```

(Hat tip to @dpsutton for the exploration.)

That is, the JDBC driver interprets `tinyint(1)` as booleans and returns Java boolean values in the results.

xys2015 (Issue Creator) on (2024-09-23 02:48:34 UTC): this can turn off by JDBC connection string options like this

<img width=""716"" alt=""image"" src=""https://github.com/user-attachments/assets/4e9b1ad5-9964-44f4-9d56-4e7232bc4656"">

"
2523799429,issue,closed,completed,Propigate the replaced settings + error out when incompatible settings are provided,See project doc for how setting variables should propigate.,escherize,2024-09-13 03:27:10+00:00,['escherize'],2024-10-07 17:43:39+00:00,2024-10-07 17:43:37+00:00,https://github.com/metabase/metabase/issues/47906,[],"[{'comment_id': 2397527519, 'issue_id': 2523799429, 'author': 'escherize', 'body': 'closed by https://github.com/metabase/metabase/pull/48154', 'created_at': datetime.datetime(2024, 10, 7, 17, 43, 37, tzinfo=datetime.timezone.utc)}]","escherize (Issue Creator) on (2024-10-07 17:43:37 UTC): closed by https://github.com/metabase/metabase/pull/48154

"
2523502041,issue,closed,completed,Sidesheets Cleanup,"- [x] fix padding on tabbed sidesheets
- [x] fix sidesheet detail icon alignment and flex-sizing
- [x] wider question info sidesheet to match dashboards
- [x] hide question settings option for instance analytics content
- [x] hide history tab on instance analytics content
",iethree,2024-09-12 23:01:49+00:00,['iethree'],2024-10-08 16:14:33+00:00,2024-09-24 04:04:42+00:00,https://github.com/metabase/metabase/issues/47904,[],[],
2523464497,issue,open,,The Y-Axis dropdown in visualization settings for a chart disappears after removing the associated value in the question within GUI builder.,"### Describe the bug

The Y-Axis dropdown in visualization settings for a chart disappears after removing the associated value in the question within GUI builder.

### To Reproduce

1. Create a new question using Products table
2. Visualize using bar or line chart, I haven't tested with others.
3. Breakout X-Axis by something like Category and Vendor
4. Breakout Y-Axis by something like price or rating
5. Visualize
6. Go back to editor and uncheck the field you set for the Y-Axis from the Products table dropdown

Of course this should break the visualization, however, it removes the option to select a different value for the Y-Axis.
You have to remove the X-Axis values and the dropdown option for Y-Axis returns.

Here's a Loom.
https://www.loom.com/share/fd1d5bca042d48209573cd912fbaab88?sid=f3d7921f-24de-416c-a579-2f9c808bf197



### Expected behavior

The dropdown for the Y-Axis to remain in visualization settings in this scenario

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""mysql"",
      ""clickhouse"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-09-10"",
      ""tag"": ""v1.50.25"",
      ""hash"": ""473a7ca""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.3""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.22+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.22"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.22+7"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""14.5"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Chicago""
  }
}
```


### Severity

P3 - Easy workaround in place and is more of an annoyance

### Additional context

_No response_",FilmonK,2024-09-12 22:25:09+00:00,[],2025-02-04 20:31:22+00:00,,https://github.com/metabase/metabase/issues/47903,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2523196815,issue,closed,not_planned,Can not migrate from h2.db to aurora postgres,"### Describe the bug

I was following the [migration guide](https://www.metabase.com/docs/latest/installation-and-operation/migrating-from-h2#jar-how-to-migrate-from-h2-to-your-production-application-database) to move from h2.db to aurora postgres but got this error: `org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name_2col""`

### To Reproduce

1.  I attached to the metabase pod running in our EKS
2. copied recursively h2.db
3. downloaded h2.db dir from metabase pod
4. contents of downloaded dir
```
h2.db
├── h2.db.mv.db
├── h2.db.trace.db
└── h2.db.v1-backup.mv.db
```
5. ran `java -jar metabase.jar load-from-h2 h2.db/h2.d`
6. got the error from the log below.

### Expected behavior

Migration script should run successfully. 

### Logs

```
2024-09-12 21:04:25,960 INFO cmd.copy :: Copying instances of Field...
2024-09-12 21:04:32,614 ERROR cmd.copy :: BatchUpdateException:
 Message: Batch entry 19 INSERT INTO metabase_field ( ""description"", ""database_type"", ""semantic_type"", ""table_id"", ""coercion_strategy"", ""database_indexed"", ""name"", ""fingerprint_version"", ""has_field_values"", ""settings"", ""caveats"", ""fk_target_field_id"", ""updated_at"", ""custom_position"", ""effective_type"", ""active"", ""nfc_path"", ""parent_id"", ""id"", ""last_analyzed"", ""database_partitioned"", ""database_is_auto_increment"", ""json_unfolding"", ""position"", ""visibility_type"", ""preview_display"", ""display_name"", ""database_position"", ""database_required"", ""fingerprint"", ""created_at"", ""base_type"", ""points_of_interest"" ) VALUES ( (NULL), ('java.lang.String'), ('type/Category'), ('55'::int4), (NULL), (NULL), ('type'), ('5'::int4), ('auto-list'), (NULL), (NULL), (NULL), ('2023-10-02 18:09:12.323317+00'::timestamp with time zone), ('0'::int4), ('type/Text'), ('TRUE'::boolean), (NULL), (NULL), ('3789'::int4), ('2023-03-22 10:34:51.986+00'::timestamp with time zone), (NULL), ('FALSE'::boolean), ('FALSE'::boolean), ('4'::int4), ('normal'), ('TRUE'::boolean), ('Type'), ('4'::int4), ('FALSE'::boolean), ('{""global"":{""distinct-count"":2,""nil%"":0.9961046188091263},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":0.0,""average-length"":0.07011686143572621}}}'), ('2023-03-22 10:26:38.37+00'::timestamp with time zone), ('type/Text'), (NULL) ) was aborted: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name_2col""
  Detail: Key (table_id, name)=(55, type) already exists.  Call getNextException to see other errors in the batch.
 SQLState: 23505
 Error Code: 0
PSQLException:
 Message: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name_2col""
  Detail: Key (table_id, name)=(55, type) already exists.
 SQLState: 23505
 Error Code: 0

2024-09-12 21:04:32,621 INFO cmd.copy :: Re-enabling DB constraints...
2024-09-12 21:04:32,623 INFO cmd.copy :: [OK]
clojure.lang.ExceptionInfo: Error copying instances of Field {:model ""Field""}
	at metabase.cmd.copy$copy_data_BANG_$fn__99746$fn__99747.invoke(copy.clj:196)
	at metabase.cmd.copy$copy_data_BANG_$fn__99746.invoke(copy.clj:193)
	at clojure.core$partition_all$fn__8625$fn__8626.invoke(core.clj:7333)
	at clojure.java.jdbc$init_reduce_rs.invokeStatic(jdbc.clj:1205)
	at clojure.java.jdbc$init_reduce_rs.invoke(jdbc.clj:1197)
	at clojure.java.jdbc$reducible_result_set_STAR_$reify__41980.reduce(jdbc.clj:1227)
	at clojure.core$reduce.invokeStatic(core.clj:6886)
	at clojure.core$reduce.invoke(core.clj:6869)
	at clojure.java.jdbc$query_reducer$fn__41986$fn__41989.invoke(jdbc.clj:1262)
	at clojure.java.jdbc$execute_query_with_params.invokeStatic(jdbc.clj:1091)
	at clojure.java.jdbc$execute_query_with_params.invoke(jdbc.clj:1084)
	at clojure.java.jdbc$db_query_with_resultset_STAR_.invokeStatic(jdbc.clj:1106)
	at clojure.java.jdbc$db_query_with_resultset_STAR_.invoke(jdbc.clj:1093)
	at clojure.java.jdbc$reducible_query$reify__42003.reduce(jdbc.clj:1357)
	at clojure.core$transduce.invokeStatic(core.clj:6947)
	at clojure.core$transduce.invoke(core.clj:6934)
	at metabase.cmd.copy$copy_data_BANG_.invokeStatic(copy.clj:180)
	at metabase.cmd.copy$copy_data_BANG_.invoke(copy.clj:174)
	at metabase.cmd.copy$copy_BANG_$fn__99881$fn__99882$fn__99883.invoke(copy.clj:411)
	at metabase.cmd.copy$do_with_disabled_db_constraints.invokeStatic(copy.clj:275)
	at metabase.cmd.copy$do_with_disabled_db_constraints.invoke(copy.clj:271)
	at metabase.cmd.copy$copy_BANG_$fn__99881$fn__99882.invoke(copy.clj:410)
	at metabase.cmd.copy$do_with_connection_rollback_only.invokeStatic(copy.clj:217)
	at metabase.cmd.copy$do_with_connection_rollback_only.invoke(copy.clj:215)
	at metabase.cmd.copy$copy_BANG_$fn__99881.invoke(copy.clj:408)
	at clojure.java.jdbc$db_transaction_STAR_.invokeStatic(jdbc.clj:807)
	at clojure.java.jdbc$db_transaction_STAR_.invoke(jdbc.clj:776)
	at clojure.java.jdbc$db_transaction_STAR_.invokeStatic(jdbc.clj:852)
	at clojure.java.jdbc$db_transaction_STAR_.invoke(jdbc.clj:776)
	at clojure.java.jdbc$db_transaction_STAR_.invokeStatic(jdbc.clj:789)
	at clojure.java.jdbc$db_transaction_STAR_.invoke(jdbc.clj:776)
	at metabase.cmd.copy$copy_BANG_.invokeStatic(copy.clj:405)
	at metabase.cmd.copy$copy_BANG_.invoke(copy.clj:380)
	at metabase.cmd.load_from_h2$load_from_h2_BANG_.invokeStatic(load_from_h2.clj:35)
	at metabase.cmd.load_from_h2$load_from_h2_BANG_.invoke(load_from_h2.clj:25)
	at clojure.lang.Var.invoke(Var.java:384)
	at metabase.cmd$load_from_h2.invokeStatic(cmd.clj:74)
	at metabase.cmd$load_from_h2.invoke(cmd.clj:68)
	at clojure.lang.AFn.applyToHelper(AFn.java:154)
	at clojure.lang.AFn.applyTo(AFn.java:144)
	at clojure.core$apply.invokeStatic(core.clj:667)
	at clojure.core$apply.invoke(core.clj:662)
	at metabase.cmd$run_cmd$fn__106482.invoke(cmd.clj:301)
	at metabase.cmd$run_cmd.invokeStatic(cmd.clj:300)
	at metabase.cmd$run_cmd.invoke(cmd.clj:290)
	at clojure.lang.Var.invoke(Var.java:388)
	at metabase.core$run_cmd.invokeStatic(core.clj:192)
	at metabase.core$run_cmd.invoke(core.clj:190)
	at metabase.core$entrypoint.invokeStatic(core.clj:214)
	at metabase.core$entrypoint.doInvoke(core.clj:209)
	at clojure.lang.RestFn.applyTo(RestFn.java:137)
	at clojure.lang.Var.applyTo(Var.java:705)
	at clojure.core$apply.invokeStatic(core.clj:667)
	at clojure.core$apply.invoke(core.clj:662)
	at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
	at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
	at clojure.lang.RestFn.applyTo(RestFn.java:137)
	at metabase.bootstrap.main(Unknown Source)
Caused by: java.sql.BatchUpdateException: Batch entry 19 INSERT INTO metabase_field ( ""description"", ""database_type"", ""semantic_type"", ""table_id"", ""coercion_strategy"", ""database_indexed"", ""name"", ""fingerprint_version"", ""has_field_values"", ""settings"", ""caveats"", ""fk_target_field_id"", ""updated_at"", ""custom_position"", ""effective_type"", ""active"", ""nfc_path"", ""parent_id"", ""id"", ""last_analyzed"", ""database_partitioned"", ""database_is_auto_increment"", ""json_unfolding"", ""position"", ""visibility_type"", ""preview_display"", ""display_name"", ""database_position"", ""database_required"", ""fingerprint"", ""created_at"", ""base_type"", ""points_of_interest"" ) VALUES ( (NULL), ('java.lang.String'), ('type/Category'), ('55'::int4), (NULL), (NULL), ('type'), ('5'::int4), ('auto-list'), (NULL), (NULL), (NULL), ('2023-10-02 18:09:12.323317+00'::timestamp with time zone), ('0'::int4), ('type/Text'), ('TRUE'::boolean), (NULL), (NULL), ('3789'::int4), ('2023-03-22 10:34:51.986+00'::timestamp with time zone), (NULL), ('FALSE'::boolean), ('FALSE'::boolean), ('4'::int4), ('normal'), ('TRUE'::boolean), ('Type'), ('4'::int4), ('FALSE'::boolean), ('{""global"":{""distinct-count"":2,""nil%"":0.9961046188091263},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":0.0,""average-length"":0.07011686143572621}}}'), ('2023-03-22 10:26:38.37+00'::timestamp with time zone), ('type/Text'), (NULL) ) was aborted: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name_2col""
  Detail: Key (table_id, name)=(55, type) already exists.  Call getNextException to see other errors in the batch.
	at org.postgresql.jdbc.BatchResultHandler.handleError(BatchResultHandler.java:165)
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2413)
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:579)
	at org.postgresql.jdbc.PgStatement.internalExecuteBatch(PgStatement.java:912)
	at org.postgresql.jdbc.PgStatement.executeBatch(PgStatement.java:936)
	at org.postgresql.jdbc.PgPreparedStatement.executeBatch(PgPreparedStatement.java:1733)
	at com.mchange.v2.c3p0.impl.NewProxyPreparedStatement.executeBatch(NewProxyPreparedStatement.java:2544)
	at clojure.java.jdbc$execute_batch.invokeStatic(jdbc.clj:598)
	at clojure.java.jdbc$execute_batch.invoke(jdbc.clj:591)
	at clojure.java.jdbc$db_do_execute_prepared_statement.invokeStatic(jdbc.clj:1058)
	at clojure.java.jdbc$db_do_execute_prepared_statement.invoke(jdbc.clj:1042)
	at clojure.java.jdbc$db_do_prepared.invokeStatic(jdbc.clj:1080)
	at clojure.java.jdbc$db_do_prepared.invoke(jdbc.clj:1060)
	at clojure.java.jdbc$insert_cols_BANG_.invokeStatic(jdbc.clj:1594)
	at clojure.java.jdbc$insert_cols_BANG_.invoke(jdbc.clj:1585)
	at clojure.java.jdbc$insert_multi_BANG_.invokeStatic(jdbc.clj:1653)
	at clojure.java.jdbc$insert_multi_BANG_.invoke(jdbc.clj:1619)
	at metabase.cmd.copy$insert_chunk_BANG_.invokeStatic(copy.clj:129)
	at metabase.cmd.copy$insert_chunk_BANG_.invoke(copy.clj:123)
	at metabase.cmd.copy$copy_data_BANG_$fn__99746$fn__99747.invoke(copy.clj:194)
	... 57 more
Caused by: org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name_2col""
  Detail: Key (table_id, name)=(55, type) already exists.
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
	... 75 more
Command failed with exception: Error copying instances of Field
```

### Information about your Metabase installation

```JSON
- metabase version  v0.50.2
- metabase.jar version v0.50.2
- internal database: h2.db -> H2 2.1.214 (2022-06-13) got from the logs
- destination db, aurora postgres 15.5
```


### Severity

Annoying, blocking us to implement usage tracking

### Additional context

_No response_",ivanrezic,2024-09-12 19:29:05+00:00,[],2024-09-12 20:18:38+00:00,2024-09-12 20:18:37+00:00,https://github.com/metabase/metabase/issues/47900,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2347162740, 'issue_id': 2523196815, 'author': 'paoliniluis', 'body': 'Check https://github.com/metabase/metabase/issues/45885', 'created_at': datetime.datetime(2024, 9, 12, 20, 18, 38, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-12 20:18:38 UTC): Check https://github.com/metabase/metabase/issues/45885

"
2523188915,issue,closed,completed,Search results from root collection have all `collection.*` attributes as `null`,"GET `/api/search` results that are in the root collection have all attributes of `collection` set to `null` (see [image](https://github.com/user-attachments/assets/f8144e65-68e0-47ba-b81c-1fab26fad857)).

FE needs correct `collection.id` to make #47281 happen (FE-side search applied on top of BE search).

-----

See [Slack](https://metaboat.slack.com/archives/C0645JP1W81/p1726166192792019?thread_ts=1726161967.066949&cid=C0645JP1W81)",kamilmielnik,2024-09-12 19:24:46+00:00,[],2024-09-13 13:25:07+00:00,2024-09-13 13:25:07+00:00,https://github.com/metabase/metabase/issues/47899,[],"[{'comment_id': 2348959127, 'issue_id': 2523188915, 'author': 'kamilmielnik', 'body': 'No longer needed after using a different approach: #47912', 'created_at': datetime.datetime(2024, 9, 13, 13, 25, 7, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-09-13 13:25:07 UTC): No longer needed after using a different approach: #47912

"
2523019188,issue,closed,completed,Show Select all in the filter dropdown in dashboards,,ranquild,2024-09-12 17:58:20+00:00,['ranquild'],2024-10-08 16:14:41+00:00,2024-09-13 20:17:05+00:00,https://github.com/metabase/metabase/issues/47896,[],[],
2522420317,issue,open,,Model metadata is not saved for custom columns,"### Describe the bug

[Slack thread](https://metaboat.slack.com/archives/C05MPF0TM3L/p1726093418654429)

Updates to model metadata for custom columns do not persist.

From 50.15 to 50.25, happens to models created using ""Turn into a model""  but does not happen to models created from  +New -> Model.
In 50.26-50.27, happens to models created using either route.

### To Reproduce

1. Start a new query builder question from Products
2. Add a custom column `=case([Category] = ""Gadget"", true, false)`
3. Save the question
4. Turn it into a model 
5. Go to model metadata and edit the metadata for the custom column:
  - Set the description
  - Set semantic type to `Category`
6. Save
7. Refresh the browser page
8. Go back to metadata editor — no metadata.

### Expected behavior

Metadata is updated.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:130.0) Gecko/20100101 Firefox/130.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-09-10"",
      ""tag"": ""v1.50.25"",
      ""hash"": ""473a7ca""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.1 (Debian 16.1-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.6.12-linuxkit"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

P2

### Additional context

Recorded on 50.25:

https://github.com/user-attachments/assets/1ca5506f-0f60-4103-825d-4d663ffec854

",alexyarosh,2024-09-12 13:34:31+00:00,[],2025-02-04 20:31:06+00:00,,https://github.com/metabase/metabase/issues/47890,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Backend', ''), ('Querying/Models', 'aka Datasets'), ('.Team/Querying', ''), ('Semantic Model', ''), ('Semantic Model/Models', '')]","[{'comment_id': 2346549584, 'issue_id': 2522420317, 'author': 'bshepherdson', 'body': ""I suspect this is related to https://github.com/metabase/metabase/issues/26755 and will be fixed as part of it. There's a regression in master where model metadata is getting overwritten in some cases when it shouldn't be."", 'created_at': datetime.datetime(2024, 9, 12, 15, 2, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2387578793, 'issue_id': 2522420317, 'author': 'alexyarosh', 'body': 'On 50.27, metadata is not saved for custom columns regardless of the path I took to create a model. Updated description.', 'created_at': datetime.datetime(2024, 10, 2, 3, 58, 9, tzinfo=datetime.timezone.utc)}, {'comment_id': 2575623051, 'issue_id': 2522420317, 'author': 'thebiglabasky', 'body': ""Isn't that a dupe of #43112 ?"", 'created_at': datetime.datetime(2025, 1, 7, 15, 47, 2, tzinfo=datetime.timezone.utc)}]","bshepherdson on (2024-09-12 15:02:12 UTC): I suspect this is related to https://github.com/metabase/metabase/issues/26755 and will be fixed as part of it. There's a regression in master where model metadata is getting overwritten in some cases when it shouldn't be.

alexyarosh (Issue Creator) on (2024-10-02 03:58:09 UTC): On 50.27, metadata is not saved for custom columns regardless of the path I took to create a model. Updated description.

thebiglabasky on (2025-01-07 15:47:02 UTC): Isn't that a dupe of #43112 ?

"
2522225426,issue,closed,completed,Notebook Editor filter breaks on custom column returning a date - (seems Bigquery specific),"### Describe the bug

I created a custom column and when i attempt to filter on it the question breaks. I am able to query if I select the ""include this xxx"" option. 

You will not be able to replicate this on stats due to https://github.com/metabase/metabase/issues/47887

### To Reproduce

Make sure you are connected to a BigQuery DB (I tested on PG and MYSQL and none of them show this issue but others might)

1. Go to New -> BigQuery Sample Test -> Make sure you select Table with a Date column -> People -> Add the following custom column:

`case([Name] = ""Won"", datetimeAdd([Created At], 0, ""month""), datetimeAdd([Birth Date], 0, ""month""))`

<img width=""781"" alt=""image"" src=""https://github.com/user-attachments/assets/10db97eb-c907-46c0-91bd-833491f6a58b"">

2. Go to Filter on this column with `previous 12 months` and notice the error:

<img width=""1075"" alt=""image"" src=""https://github.com/user-attachments/assets/56e51f99-8e1c-4523-9183-c5dfecc07453"">

3 This works if you select the `Include this month` option:

<img width=""1107"" alt=""image"" src=""https://github.com/user-attachments/assets/7d5da730-622b-40c2-ba4f-0cc6c6dd3541"">


### Expected behavior

The Filter Works

### Logs

```
ERROR metabase.query-processor.middleware.catch-exceptions Error processing query: 400 Bad Request
POST https://bigquery.googleapis.com/bigquery/v2/projects/metabase-driver-dev/queries
{
  ""code"": 400,
  ""errors"": [
    {
      ""domain"": ""global"",
      ""location"": ""q"",
      ""locationType"": ""parameter"",
      ""message"": ""No matching signature for operator < for argument types: DATETIME, TIMESTAMP. Supported signature: ANY < ANY at [2:1209]"",
      ""reason"": ""invalidQuery""
    }
  ],
  ""message"": ""No matching signature for operator < for argument types: DATETIME, TIMESTAMP. Supported signature: ANY < ANY at [2:1209]"",
  ""status"": ""INVALID_ARGUMENT""
}
{:database_id 7,
 :started_at #t ""2024-09-12T12:07:37.416435Z[GMT]"",
 :via
 [{:status :failed,
   :class com.google.cloud.bigquery.BigQueryException,
   :error
   ""No matching signature for operator < for argument types: DATETIME, TIMESTAMP. Supported signature: ANY < ANY at [2:1209]"",
   :stacktrace
   [""com.google.cloud.bigquery.spi.v2.HttpBigQueryRpc.translate(HttpBigQueryRpc.java:115)""
    ""com.google.cloud.bigquery.spi.v2.HttpBigQueryRpc.queryRpc(HttpBigQueryRpc.java:771)""
    ""com.google.cloud.bigquery.BigQueryImpl$35.call(BigQueryImpl.java:1365)""
    ""com.google.cloud.bigquery.BigQueryImpl$35.call(BigQueryImpl.java:1362)""
    ""com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:103)""
    ""com.google.cloud.bigquery.BigQueryRetryHelper.run(BigQueryRetryHelper.java:86)""
    ""com.google.cloud.bigquery.BigQueryRetryHelper.runWithRetries(BigQueryRetryHelper.java:49)""
    ""com.google.cloud.bigquery.BigQueryImpl.queryRpc(BigQueryImpl.java:1361)""
    ""com.google.cloud.bigquery.BigQueryImpl.query(BigQueryImpl.java:1349)""
    ""--> driver.bigquery_cloud_sdk$execute_bigquery_off_thread$fn__127900$fn__127901.invoke(bigquery_cloud_sdk.clj:421)""
    ""driver.bigquery_cloud_sdk$execute_bigquery_off_thread$fn__127900.invoke(bigquery_cloud_sdk.clj:418)""]}
  {:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error
   ""Error executing query: No matching signature for operator < for argument types: DATETIME, TIMESTAMP. Supported signature: ANY < ANY at [2:1209]"",
   :stacktrace
   [""--> driver.bigquery_cloud_sdk$throw_invalid_query.invokeStatic(bigquery_cloud_sdk.clj:395)""
    ""driver.bigquery_cloud_sdk$throw_invalid_query.invoke(bigquery_cloud_sdk.clj:394)""
    ""driver.bigquery_cloud_sdk$handle_bigquery_exception.invokeStatic(bigquery_cloud_sdk.clj:449)""
    ""driver.bigquery_cloud_sdk$handle_bigquery_exception.invoke(bigquery_cloud_sdk.clj:436)""
    ""driver.bigquery_cloud_sdk$execute_bigquery.invokeStatic(bigquery_cloud_sdk.clj:471)""
    ""driver.bigquery_cloud_sdk$execute_bigquery.invoke(bigquery_cloud_sdk.clj:453)""
    ""driver.bigquery_cloud_sdk$execute_bigquery_on_db.invokeStatic(bigquery_cloud_sdk.clj:477)""
    ""driver.bigquery_cloud_sdk$execute_bigquery_on_db.invoke(bigquery_cloud_sdk.clj:474)""
    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_$thunk__128038.invoke(bigquery_cloud_sdk.clj:517)""
    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invokeStatic(bigquery_cloud_sdk.clj:524)""
    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invoke(bigquery_cloud_sdk.clj:506)""
    ""driver.bigquery_cloud_sdk$fn__128054.invokeStatic(bigquery_cloud_sdk.clj:545)""
    ""driver.bigquery_cloud_sdk$fn__128054.invoke(bigquery_cloud_sdk.clj:537)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)""
    ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)""
    ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)""
    ""query_processor.execute$run.invokeStatic(execute.clj:60)""
    ""query_processor.execute$run.invoke(execute.clj:54)""
    ""query_processor.middleware.update_used_cards$update_used_cards_BANG_$fn__71508.invoke(update_used_cards.clj:60)""
    ""query_processor.execute$add_native_form_to_result_metadata$fn__71523.invoke(execute.clj:23)""
    ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__71528.invoke(execute.clj:34)""
    ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___71481.invoke(cache.clj:239)""
    ""query_processor.middleware.permissions$check_query_permissions$fn__66122.invoke(permissions.clj:147)""
    ""metabase_enterprise.advanced_permissions.query_processor.middleware.permissions$fn__108681$check_download_permissions__108682$fn__108683.invoke(permissions.clj:90)""
    ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__66734.invoke(enterprise.clj:51)""
    ""metabase_enterprise.sandbox.query_processor.middleware.column_level_perms_check$fn__110512$maybe_apply_column_level_perms_check__110513$fn__110514.invoke(column_level_perms_check.clj:38)""
    ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__66744.invoke(enterprise.clj:64)""
    ""query_processor.execute$execute$fn__71555.invoke(execute.clj:92)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor.execute$execute.invokeStatic(execute.clj:91)""
    ""query_processor.execute$execute.invoke(execute.clj:87)""
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)""
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
    ""metabase_enterprise.audit_app.query_processor.middleware.handle_audit_queries$fn__82876$handle_audit_app_internal_queries__82877$fn__82878.invoke(handle_audit_queries.clj:145)""
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__66772.invoke(enterprise.clj:103)""
    ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76744.invoke(process_userland_query.clj:198)""
    ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__76813.invoke(catch_exceptions.clj:128)""
    ""query_processor$process_query$fn__76850.invoke(query_processor.clj:78)""
    ""query_processor.setup$do_with_canceled_chan$fn__67176.invoke(setup.clj:187)""
    ""query_processor.setup$do_with_database_local_settings$fn__67171.invoke(setup.clj:181)""
    ""query_processor.setup$do_with_driver$fn__67166$fn__67167.invoke(setup.clj:166)""
    ""driver$do_with_driver.invokeStatic(driver.clj:104)""
    ""driver$do_with_driver.invoke(driver.clj:99)""
    ""query_processor.setup$do_with_driver$fn__67166.invoke(setup.clj:165)""
    ""query_processor.setup$do_with_metadata_provider$fn__67159$fn__67162.invoke(setup.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:170)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:159)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""
    ""query_processor.setup$do_with_metadata_provider$fn__67159.invoke(setup.clj:150)""
    ""query_processor.setup$do_with_resolved_database$fn__67153.invoke(setup.clj:128)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
    ""query_processor$process_query.invoke(query_processor.clj:69)""
    ""api.dataset$run_streaming_query$fn__94750.invoke(dataset.clj:84)""
    ""query_processor.streaming$_streaming_response$fn__70064$fn__70065$fn__70066.invoke(streaming.clj:176)""
    ""query_processor.streaming$_streaming_response$fn__70064$fn__70065.invoke(streaming.clj:174)""
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
    ""query_processor.streaming$_streaming_response$fn__70064.invoke(streaming.clj:171)""
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)""
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)""
    ""async.streaming_response$do_f_async$task__52029.invoke(streaming_response.clj:97)""],
   :error_type :invalid-query,
   :ex-data
   {:type :invalid-query,
    :sql
    ""-- Metabase:: userID: 1 queryType: MBQL queryHash: fdb026a8ea5aa796591d94b04fde94b02e359c6dc7ac5cb00f3b2ef149aab50f\nSELECT `sample_database.people`.`person_id` AS `person_id`, `sample_database.people`.`address` AS `address`, `sample_database.people`.`email` AS `email`, `sample_database.people`.`password` AS `password`, `sample_database.people`.`name` AS `name`, `sample_database.people`.`city` AS `city`, `sample_database.people`.`longitude` AS `longitude`, `sample_database.people`.`state` AS `state`, `sample_database.people`.`source` AS `source`, `sample_database.people`.`birth_date` AS `birth_date`, `sample_database.people`.`zip` AS `zip`, `sample_database.people`.`latitude` AS `latitude`, `sample_database.people`.`created_at` AS `created_at`, CASE WHEN `sample_database.people`.`name` = ? THEN DATETIME_ADD(CAST(`sample_database.people`.`created_at` AS datetime), INTERVAL 0 month) ELSE DATE_ADD(`sample_database.people`.`birth_date`, INTERVAL 0 month) END AS `test` FROM `sample_database.people` WHERE (DATETIME(CASE WHEN `sample_database.people`.`name` = ? THEN DATETIME_ADD(CAST(`sample_database.people`.`created_at` AS datetime), INTERVAL 0 month) ELSE DATE_ADD(`sample_database.people`.`birth_date`, INTERVAL 0 month) END) >= DATETIME_TRUNC(DATETIME_ADD(CURRENT_DATETIME(), INTERVAL -12 month), month)) AND (CASE WHEN `sample_database.people`.`name` = ? THEN DATETIME_ADD(CAST(`sample_database.people`.`created_at` AS datetime), INTERVAL 0 month) ELSE DATE_ADD(`sample_database.people`.`birth_date`, INTERVAL 0 month) END < DATETIME_TRUNC(CURRENT_TIMESTAMP(), month)) LIMIT 10"",
    :parameters (""Won"" ""Won"" ""Won"")}}],
 :action_id nil,
 :error_type :invalid-query,
 :json_query
 {:database 7,
  :type ""query"",
  :query
  {:source-table 151,
   :expressions
   {:test
    [""case""
     [[[""="" [""field"" 1648 {:base-type ""type/Text""}] ""Won""]
       [""datetime-add"" [""field"" 1638 {:base-type ""type/DateTimeWithLocalTZ""}] 0 ""month""]]]
     {:default [""datetime-add"" [""field"" 1643 {:base-type ""type/Date""}] 0 ""month""]}]},
   :limit 10,
   :filter [""time-interval"" [""expression"" ""test"" {:base-type ""type/Temporal""}] -12 ""month"" {:include-current false}]},
  :parameters [],
  :middleware {:js-int-to-string? true, :userland-query? true, :add-default-userland-constraints? true}},
 :native
 {:query
  ""SELECT `sample_database.people`.`person_id` AS `person_id`, `sample_database.people`.`address` AS `address`, `sample_database.people`.`email` AS `email`, `sample_database.people`.`password` AS `password`, `sample_database.people`.`name` AS `name`, `sample_database.people`.`city` AS `city`, `sample_database.people`.`longitude` AS `longitude`, `sample_database.people`.`state` AS `state`, `sample_database.people`.`source` AS `source`, `sample_database.people`.`birth_date` AS `birth_date`, `sample_database.people`.`zip` AS `zip`, `sample_database.people`.`latitude` AS `latitude`, `sample_database.people`.`created_at` AS `created_at`, CASE WHEN `sample_database.people`.`name` = ? THEN DATETIME_ADD(CAST(`sample_database.people`.`created_at` AS datetime), INTERVAL 0 month) ELSE DATE_ADD(`sample_database.people`.`birth_date`, INTERVAL 0 month) END AS `test` FROM `sample_database.people` WHERE (DATETIME(CASE WHEN `sample_database.people`.`name` = ? THEN DATETIME_ADD(CAST(`sample_database.people`.`created_at` AS datetime), INTERVAL 0 month) ELSE DATE_ADD(`sample_database.people`.`birth_date`, INTERVAL 0 month) END) >= DATETIME_TRUNC(DATETIME_ADD(CURRENT_DATETIME(), INTERVAL -12 month), month)) AND (CASE WHEN `sample_database.people`.`name` = ? THEN DATETIME_ADD(CAST(`sample_database.people`.`created_at` AS datetime), INTERVAL 0 month) ELSE DATE_ADD(`sample_database.people`.`birth_date`, INTERVAL 0 month) END < DATETIME_TRUNC(CURRENT_TIMESTAMP(), month)) LIMIT 10"",
  :params (""Won"" ""Won"" ""Won""),
  :table-name ""people"",
  :mbql? true},
 :status :failed,
 :class com.google.api.client.googleapis.json.GoogleJsonResponseException,
 :stacktrace
 [""com.google.api.client.googleapis.json.GoogleJsonResponseException.from(GoogleJsonResponseException.java:146)""
  ""com.google.api.client.googleapis.services.json.AbstractGoogleJsonClientRequest.newExceptionOnError(AbstractGoogleJsonClientRequest.java:118)""
  ""com.google.api.client.googleapis.services.json.AbstractGoogleJsonClientRequest.newExceptionOnError(AbstractGoogleJsonClientRequest.java:37)""
  ""com.google.api.client.googleapis.services.AbstractGoogleClientRequest$3.interceptResponse(AbstractGoogleClientRequest.java:466)""
  ""com.google.api.client.http.HttpRequest.execute(HttpRequest.java:1111)""
  ""com.google.api.client.googleapis.services.AbstractGoogleClientRequest.executeUnparsed(AbstractGoogleClientRequest.java:552)""
  ""com.google.api.client.googleapis.services.AbstractGoogleClientRequest.executeUnparsed(AbstractGoogleClientRequest.java:493)""
  ""com.google.api.client.googleapis.services.AbstractGoogleClientRequest.execute(AbstractGoogleClientRequest.java:603)""
  ""com.google.cloud.bigquery.spi.v2.HttpBigQueryRpc.queryRpc(HttpBigQueryRpc.java:769)""
  ""com.google.cloud.bigquery.BigQueryImpl$35.call(BigQueryImpl.java:1365)""
  ""com.google.cloud.bigquery.BigQueryImpl$35.call(BigQueryImpl.java:1362)""
  ""com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:103)""
  ""com.google.cloud.bigquery.BigQueryRetryHelper.run(BigQueryRetryHelper.java:86)""
  ""com.google.cloud.bigquery.BigQueryRetryHelper.runWithRetries(BigQueryRetryHelper.java:49)""
  ""com.google.cloud.bigquery.BigQueryImpl.queryRpc(BigQueryImpl.java:1361)""
  ""com.google.cloud.bigquery.BigQueryImpl.query(BigQueryImpl.java:1349)""
  ""--> driver.bigquery_cloud_sdk$execute_bigquery_off_thread$fn__127900$fn__127901.invoke(bigquery_cloud_sdk.clj:421)""
  ""driver.bigquery_cloud_sdk$execute_bigquery_off_thread$fn__127900.invoke(bigquery_cloud_sdk.clj:418)""],
 :card_id nil,
 :context :ad-hoc,
 :error
 ""400 Bad Request\nPOST https://bigquery.googleapis.com/bigquery/v2/projects/metabase-driver-dev/queries\n{\n  \""code\"": 400,\n  \""errors\"": [\n    {\n      \""domain\"": \""global\"",\n      \""location\"": \""q\"",\n      \""locationType\"": \""parameter\"",\n      \""message\"": \""No matching signature for operator < for argument types: DATETIME, TIMESTAMP. Supported signature: ANY < ANY at [2:1209]\"",\n      \""reason\"": \""invalidQuery\""\n    }\n  ],\n  \""message\"": \""No matching signature for operator < for argument types: DATETIME, TIMESTAMP. Supported signature: ANY < ANY at [2:1209]\"",\n  \""status\"": \""INVALID_ARGUMENT\""\n}"",
 :row_count 0,
 :running_time 0,
 :preprocessed
 {:database 7,
  :middleware {:js-int-to-string? true, :userland-query? true, :add-default-userland-constraints? true},
  :info {:executed-by 1, :context :ad-hoc},
  :constraints {:max-results 10000, :max-results-bare-rows 10000},
  :type :query,
  :query
  {:source-table 151,
   :expressions
   {""test""
    [:case
     [[[:=
        [:field 1648 {:base-type :type/Text}]
        [:value
         ""Won""
         {:base_type :type/Text,
          :effective_type :type/Text,
          :coercion_strategy nil,
          :semantic_type :type/Name,
          :database_type ""STRING"",
          :name ""name""}]]
       [:datetime-add [:field 1638 {:base-type :type/DateTimeWithLocalTZ, :temporal-unit :default}] 0 :month]]]
     {:default [:datetime-add [:field 1643 {:base-type :type/Date, :temporal-unit :default}] 0 :month]}]},
   :limit 10,
   :filter
   [:and
    [:>= [:expression ""test"" {:base-type :type/Temporal, :temporal-unit :default}] [:relative-datetime -12 :month]]
    [:< [:expression ""test"" {:base-type :type/Temporal, :temporal-unit :default}] [:relative-datetime 0 :month]]],
   :fields
   [[:field 1641 nil]
    [:field 1639 nil]
    [:field 1640 nil]
    [:field 1646 nil]
    [:field 1648 nil]
    [:field 1649 nil]
    [:field 1644 nil]
    [:field 1645 nil]
    [:field 1650 nil]
    [:field 1643 {:temporal-unit :default}]
    [:field 1647 nil]
    [:field 1642 nil]
    [:field 1638 {:temporal-unit :default}]
    [:expression ""test""]]}},
 :data {:rows [], :cols []}}
```

### Information about your Metabase installation

```JSON
Tested on 50 but couldn't test it on master (due to bug 47887)
```


### Severity

Breaks Bigquery question so it's a big problem

### Additional context

_No response_",Tony-metabase,2024-09-12 12:11:46+00:00,['lbrdnk'],2024-10-31 17:03:49+00:00,2024-10-18 15:41:43+00:00,https://github.com/metabase/metabase/issues/47888,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/MBQL', ''), ('Database/BigQuery', ''), ('.Backend', ''), ('.Regression/master', 'Regression that is only present on master, or bug in new upcoming feature'), ('.Team/Querying', '')]","[{'comment_id': 2346542003, 'issue_id': 2522225426, 'author': 'bshepherdson', 'body': ""There's some unusual logic for BigQuery around date filters; they don't use `<` etc.\r\n\r\nI suspect this is just a symptom of #47887 and that this will start working with no extra effort once we fix that issue. (Because then the QP will see this column as a date again, and generate the right Bigquery syntax.)"", 'created_at': datetime.datetime(2024, 9, 12, 14, 59, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2450388450, 'issue_id': 2522225426, 'author': 'github-actions[bot]', 'body': '🚀 This should also be released by [v0.51.1](https://github.com/metabase/metabase/milestone/231)', 'created_at': datetime.datetime(2024, 10, 31, 17, 3, 48, tzinfo=datetime.timezone.utc)}]","bshepherdson on (2024-09-12 14:59:08 UTC): There's some unusual logic for BigQuery around date filters; they don't use `<` etc.

I suspect this is just a symptom of #47887 and that this will start working with no extra effort once we fix that issue. (Because then the QP will see this column as a date again, and generate the right Bigquery syntax.)

github-actions[bot] on (2024-10-31 17:03:48 UTC): 🚀 This should also be released by [v0.51.1](https://github.com/metabase/metabase/milestone/231)

"
2522200069,issue,closed,completed,Custom column that returns a date is not interpreted as a date filter,"### Describe the bug

I am creating a custom column that is returning a Date. The UI is also saying that is a date but it's filtering options are only empty and is not empty

### To Reproduce

1. Go to New -> Sample DB -> People -> Add a Custom column ->`case([Name] = ""Won"", datetimeAdd([Created At], 0, ""month""), datetimeAdd([Birth Date], 0, ""month""))`

You can access the Question [here](https://stats.metabase.com/question/19582-wrong-filter-option/notebook)

2. Try to filter on this custom column:

<img width=""792"" alt=""image"" src=""https://github.com/user-attachments/assets/e0724a4e-0b2e-454b-9797-00f0106fd3ff"">

The UI clearly knows it's a date but it's not giving the right options

<img width=""781"" alt=""image"" src=""https://github.com/user-attachments/assets/2ade2b6e-53bf-4e5b-a5b4-cd28a224e42c"">


### Expected behavior

I get the usual date filtering

### Logs

None that are relevant

### Information about your Metabase installation

```JSON
Doesn't happen on 50 and only on master (you can check stats)
```


### Severity

Breaking change/regression

### Additional context

_No response_",Tony-metabase,2024-09-12 12:00:10+00:00,['lbrdnk'],2024-10-31 17:03:46+00:00,2024-10-18 15:41:42+00:00,https://github.com/metabase/metabase/issues/47887,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/MBQL', ''), ('.Backend', ''), ('Querying/Notebook/Custom Expression', ''), ('.Regression/master', 'Regression that is only present on master, or bug in new upcoming feature'), ('.metabase-lib', 'Label for tracking all issues related to the shared CLJC metabase-lib'), ('.Team/Querying', '')]","[{'comment_id': 2349000648, 'issue_id': 2522200069, 'author': 'NevRA', 'body': '@lbrdnk discussed with AlexP, the solution looks ok', 'created_at': datetime.datetime(2024, 9, 13, 13, 44, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2450388360, 'issue_id': 2522200069, 'author': 'github-actions[bot]', 'body': '🚀 This should also be released by [v0.51.1](https://github.com/metabase/metabase/milestone/231)', 'created_at': datetime.datetime(2024, 10, 31, 17, 3, 45, tzinfo=datetime.timezone.utc)}]","NevRA on (2024-09-13 13:44:38 UTC): @lbrdnk discussed with AlexP, the solution looks ok

github-actions[bot] on (2024-10-31 17:03:45 UTC): 🚀 This should also be released by [v0.51.1](https://github.com/metabase/metabase/milestone/231)

"
2521663734,issue,closed,completed,Allow CORS for instance properties API and set all non-essential properties to be authenticated,"We should change every instance properties to be `:authenticated`, except the ones that **must** be public (e.g. used by setup flow and embedding), per [AlexP's recommendation](https://metaboat.slack.com/archives/C97M2U8M6/p1726072284724699?thread_ts=1726050496.687369&cid=C97M2U8M6).

We should also modify the CORS origin of /api/session/properties to allow all origin access.

This is to display helpful [visual cues](https://www.notion.so/metabase/Add-visual-cues-in-SDK-around-evaluation-usage-and-feature-flag-004be55a2ed247839cc9521e9a58f6d4?pvs=4) in the SDK to help them identify misconfiguration, such as forgetting to turn on the ""Enable Embedding SDK"" feature flag or not having the correct token features, but this won't be possible as they wouldn't have configured the authorized origins yet at this stage.",heypoom,2024-09-12 08:07:34+00:00,[],2024-10-03 00:00:40+00:00,2024-10-03 00:00:39+00:00,https://github.com/metabase/metabase/issues/47884,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2390055098, 'issue_id': 2521663734, 'author': 'heypoom', 'body': 'Closing as we are moving towards the free-with-attribution approach.', 'created_at': datetime.datetime(2024, 10, 3, 0, 0, 39, tzinfo=datetime.timezone.utc)}]","heypoom (Issue Creator) on (2024-10-03 00:00:39 UTC): Closing as we are moving towards the free-with-attribution approach.

"
2521601699,issue,open,,"""unpin from 0"" for bar charts","**Is your feature request related to a problem? Please describe.**
I believe (non-line) bar charts could also benefit from the ""unpin from 0"" setting. As an example, I want to display a stacked bar chart to see the variation of the number of new users. The variation being small compared to the total number, the auto-scaling makes it almost invisible.
<img width=""500"" alt=""Screenshot 2024-09-12 at 09 10 39"" src=""https://github.com/user-attachments/assets/ba24ee6f-a156-4849-b94f-69cdab84417b"">


**Describe the solution you'd like**
Allow ""unpin from 0"" for bar charts. Since it is possible to disable auto-scaling and input my own range, I don't see why the ""unpin from 0"" setting is not allowed.
<img width=""500"" alt=""Screenshot 2024-09-12 at 09 32 18"" src=""https://github.com/user-attachments/assets/518b10f3-be68-4bd7-9f04-23e478982bba"">


**Describe alternatives you've considered**
I guess if it was possible to choose my own range through a mechanism similar to dashboard filters (since my charts are embedded), I could work with that too but that's maybe another feature request.
",nicoayci,2024-09-12 07:39:25+00:00,[],2025-02-04 20:31:22+00:00,,https://github.com/metabase/metabase/issues/47882,"[('Type:New Feature', ''), ('Visualization/Chart Settings', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2521580619,issue,closed,completed,Make `enable-embedding-interactive` respects `embedding` feature flag,,WiNloSt,2024-09-12 07:29:14+00:00,['WiNloSt'],2024-09-12 14:54:57+00:00,2024-09-12 14:54:57+00:00,https://github.com/metabase/metabase/issues/47881,[],[],
2520921499,issue,closed,not_planned,Inconsistent bar chart legend,"### Describe the bug

I created my bar chart and put a legend. I added this question to a dashboard. Few days after, I changed my legend (ordinate).
From the dahsboard, I continue seeing the old ordinate legend on my graph whereas the good legend is set when I see my question.

It is weird because some others charts updated weel but some others did not.

From dashboard :
![image](https://github.com/user-attachments/assets/f15cb58e-94a2-47f3-b1ac-476e774effce)

From question :
![image](https://github.com/user-attachments/assets/25d1d8f5-ddec-4ebc-8cd1-06e256e398a7)



### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

Both legends shall be the same

### Logs

_No response_

### Information about your Metabase installation

```JSON
- Windows 10
- Firefox version 115
- Database : postgreSQL
- Metabase version : v1.48.4 (released on 2024-01-29)
- French version
```


### Severity

Annoying...

### Additional context

_No response_",Pierre-PSUD,2024-09-11 22:45:30+00:00,[],2024-09-11 23:23:42+00:00,2024-09-11 23:15:18+00:00,https://github.com/metabase/metabase/issues/47878,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2344902321, 'issue_id': 2520921499, 'author': 'paoliniluis', 'body': 'go to the visualization settings on the card on the dashboard and click on ""reset to defaults""', 'created_at': datetime.datetime(2024, 9, 11, 23, 15, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2344952459, 'issue_id': 2520921499, 'author': 'Pierre-PSUD', 'body': 'Thanks Luis !', 'created_at': datetime.datetime(2024, 9, 11, 23, 23, 40, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-11 23:15:18 UTC): go to the visualization settings on the card on the dashboard and click on ""reset to defaults""

Pierre-PSUD (Issue Creator) on (2024-09-11 23:23:40 UTC): Thanks Luis !

"
2520916287,issue,open,,We ignore the MB_HUMANIZATION_STRATEGY env var if there's a value in the settings table,"### Describe the bug

If you have a value in the app db, we ignore the env var completely. This is not what should happen, as we should always respect the env vars no matter what the settings table says

### To Reproduce

1) set up metabase
2) change the setting on the admin->general tab to none
3) then shut down metabase and set MB_HUMANIZATION_STRATEGY=simple
4) see that there's no effect

### Expected behavior

It should work, and set the humanization strategy as we say on the env var

### Logs

NA

### Information about your Metabase installation

```JSON
v50.x?
```


### Severity

P2'ish?

### Additional context

_No response_",paoliniluis,2024-09-11 22:42:26+00:00,[],2025-02-04 20:26:33+00:00,,https://github.com/metabase/metabase/issues/47876,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('Operation/Environment variables', ''), ('.Team/Drivers', '')]","[{'comment_id': 2344925663, 'issue_id': 2520916287, 'author': 'dpsutton', 'body': 'I\'ve done the following\r\n\r\n```shell\r\n MB_JETTY_PORT=3050 java ""$(socket-repl 6050)"" -jar 0.50.23.jar\r\n\r\n# another terminal\r\n❯ netcat localhost 6050\r\nuser=> (metabase.models.humanization/humanization-strategy)\r\n:simple\r\nuser=> (metabase.models.humanization/humanization-strategy! :none)\r\nnil\r\nuser=> (metabase.models.humanization/humanization-strategy)\r\n:none\r\nuser=> %\r\n\r\n# so now the value is set to none in the app-db\r\nMB_JETTY_PORT=3050 MB_HUMANIZATION_STRATEGY=simple java ""$(socket-repl 6050)"" -jar 0.50.23.jar\r\n\r\n#now started up with a value in the env\r\n# another repl:\r\n\r\n❯ netcat localhost 6050\r\nuser=> (metabase.models.humanization/humanization-strategy)\r\n:simple\r\nuser=> %\r\n```\r\n\r\nAll this is to say that we are correctly getting the value. Perhaps some of the humanized values have been put in the database?', 'created_at': datetime.datetime(2024, 9, 11, 23, 18, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2371797621, 'issue_id': 2520916287, 'author': 'ixipixi', 'body': ""@dpsutton that's it - the DB was synced before the env var was in place."", 'created_at': datetime.datetime(2024, 9, 24, 16, 37, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2371862483, 'issue_id': 2520916287, 'author': 'ixipixi', 'body': '@dpsutton After some additional little testing it looks the behavior is different between when you modify this setting in the GUI vs when you modify it via ENV variable.\r\n\r\nIf you have a table called ""test_table"" and the display name is ""Test Table"" - toggling OFF the humanization setting via the admin panel recalculates the display name (as far as I can tell this only work for tables that you haven\'t customized the name for). But if you use the env variable it seems like it only calculates the display name during the initial sync.\r\n\r\nShouldn\'t the behavior should be the same?', 'created_at': datetime.datetime(2024, 9, 24, 17, 11, 15, tzinfo=datetime.timezone.utc)}]","dpsutton on (2024-09-11 23:18:37 UTC): I've done the following

```shell
 MB_JETTY_PORT=3050 java ""$(socket-repl 6050)"" -jar 0.50.23.jar

# another terminal
❯ netcat localhost 6050
user=> (metabase.models.humanization/humanization-strategy)
:simple
user=> (metabase.models.humanization/humanization-strategy! :none)
nil
user=> (metabase.models.humanization/humanization-strategy)
:none
user=> %

# so now the value is set to none in the app-db
MB_JETTY_PORT=3050 MB_HUMANIZATION_STRATEGY=simple java ""$(socket-repl 6050)"" -jar 0.50.23.jar

#now started up with a value in the env
# another repl:

❯ netcat localhost 6050
user=> (metabase.models.humanization/humanization-strategy)
:simple
user=> %
```

All this is to say that we are correctly getting the value. Perhaps some of the humanized values have been put in the database?

ixipixi on (2024-09-24 16:37:27 UTC): @dpsutton that's it - the DB was synced before the env var was in place.

ixipixi on (2024-09-24 17:11:15 UTC): @dpsutton After some additional little testing it looks the behavior is different between when you modify this setting in the GUI vs when you modify it via ENV variable.

If you have a table called ""test_table"" and the display name is ""Test Table"" - toggling OFF the humanization setting via the admin panel recalculates the display name (as far as I can tell this only work for tables that you haven't customized the name for). But if you use the env variable it seems like it only calculates the display name during the initial sync.

Shouldn't the behavior should be the same?

"
2520784882,issue,open,,"Aggregating by ""hour of day"" will make a subscription that shows a date in the x-axis","### Describe the bug

Interesting bug where we show the previous day in the axis when aggregating by the hour of the day. e.g.
this is the question
![image](https://github.com/user-attachments/assets/5807651f-609c-4173-a7a4-a48729b4fbf0)
 
this is the subscription
![image](https://github.com/user-attachments/assets/a17ea9e3-3ee4-4723-8652-da846d99b14b)


### To Reproduce

1) create
![image](https://github.com/user-attachments/assets/d9e8ed55-142b-4ce1-b8f0-c790888fb605)

(see the hour of day aggregation)
2) add it to a dashboard and save, send a test subscription

see the day being added to the x-axis

### Expected behavior

the date shouldn't be there

### Logs

NA

### Information about your Metabase installation

```JSON
v50
```


### Severity

P1'ish?

### Additional context

_No response_",paoliniluis,2024-09-11 21:11:21+00:00,[],2025-02-04 20:31:52+00:00,,https://github.com/metabase/metabase/issues/47873,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Static', 'Subscriptions/pulse generated image'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2346523858, 'issue_id': 2520784882, 'author': 'bshepherdson', 'body': ""I'm not sure about P1 - the data looks correct, just poorly labeled. I agree it's misleading, since it implies we're looking at a single day of data. But I'll let it start it at P1 and the team can lower it."", 'created_at': datetime.datetime(2024, 9, 12, 14, 51, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2346567742, 'issue_id': 2520784882, 'author': 'alxnddr', 'body': 'Looks more like P2 to me', 'created_at': datetime.datetime(2024, 9, 12, 15, 9, 17, tzinfo=datetime.timezone.utc)}]","bshepherdson on (2024-09-12 14:51:59 UTC): I'm not sure about P1 - the data looks correct, just poorly labeled. I agree it's misleading, since it implies we're looking at a single day of data. But I'll let it start it at P1 and the team can lower it.

alxnddr on (2024-09-12 15:09:17 UTC): Looks more like P2 to me

"
2520689455,issue,open,,offset doesn't calculate values with custom column filled by simple expression,"**Context**

[Question at stats](https://stats.metabase.com/question#eyJkYXRhc2V0X3F1ZXJ5Ijp7ImRhdGFiYXNlIjoxLCJ0eXBlIjoicXVlcnkiLCJxdWVyeSI6eyJzb3VyY2UtdGFibGUiOjEsImV4cHJlc3Npb25zIjp7Imp1c3QgMiI6WyIrIiwxLDFdfSwiYWdncmVnYXRpb24iOltbInN1bSIsWyJmaWVsZCIsMjMseyJiYXNlLXR5cGUiOiJ0eXBlL0Zsb2F0In1dXSxbIm9mZnNldCIseyJsaWIvdXVpZCI6ImNkZGI4NjNmLTQyNWItNDJlNy05YmIwLTYzNWVkZWZlYjcwYiIsIm5hbWUiOiJTdW0gb2YgVG90YWwgKHByZXZpb3VzIG1vbnRoKSIsImRpc3BsYXktbmFtZSI6IlN1bSBvZiBUb3RhbCAocHJldmlvdXMgbW9udGgpIn0sWyJzdW0iLFsiZmllbGQiLDIzLHsiYmFzZS10eXBlIjoidHlwZS9GbG9hdCJ9XV0sLTFdXSwiYnJlYWtvdXQiOltbImV4cHJlc3Npb24iLCJqdXN0IDIiLHsiYmFzZS10eXBlIjoidHlwZS9JbnRlZ2VyIn1dLFsiZmllbGQiLDI1LHsiYmFzZS10eXBlIjoidHlwZS9EYXRlVGltZSIsInRlbXBvcmFsLXVuaXQiOiJtb250aCJ9XV19fSwiZGlzcGxheSI6InRhYmxlIiwidmlzdWFsaXphdGlvbl9zZXR0aW5ncyI6e30sInR5cGUiOiJxdWVzdGlvbiJ9)


there is a test at `offset.cy.spec.ts` - `works when custom column is a simple expression`
<img width=""860"" alt=""Screenshot 2024-09-11 at 23 20 26"" src=""https://github.com/user-attachments/assets/404e4109-6153-4e5b-862f-b921f942bc30"">


last column is empty when it should contain data.

<img width=""459"" alt=""Screenshot 2024-09-11 at 23 20 32"" src=""https://github.com/user-attachments/assets/3840b92b-9317-4d3d-a46a-7e90e0b0ec67"">

if we change the order of breakouts

<img width=""682"" alt=""image"" src=""https://github.com/user-attachments/assets/275a9288-8619-4dcf-8d3f-69118603ba30"">

the data appears

<img width=""577"" alt=""image"" src=""https://github.com/user-attachments/assets/b4f2cce8-505a-4cc5-a2b2-17ac2619f8d9"">

- issue links: https://github.com/metabase/metabase/issues/47806

",uladzimirdev,2024-09-11 20:22:33+00:00,[],2025-02-04 20:27:54+00:00,,https://github.com/metabase/metabase/issues/47870,"[('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2346024594, 'issue_id': 2520689455, 'author': 'uladzimirdev', 'body': ""It's not a bug, but current behaviour, should be addressed in a different project [context](https://metaboat.slack.com/archives/C0645JP1W81/p1726133144398459?thread_ts=1725997000.451069&cid=C0645JP1W81)"", 'created_at': datetime.datetime(2024, 9, 12, 11, 22, 53, tzinfo=datetime.timezone.utc)}]","uladzimirdev (Issue Creator) on (2024-09-12 11:22:53 UTC): It's not a bug, but current behaviour, should be addressed in a different project [context](https://metaboat.slack.com/archives/C0645JP1W81/p1726133144398459?thread_ts=1725997000.451069&cid=C0645JP1W81)

"
2520618340,issue,closed,completed,fully negative chart renders nothing,,EmmadUsmani,2024-09-11 19:39:50+00:00,[],2024-09-20 22:04:27+00:00,2024-09-20 22:04:27+00:00,https://github.com/metabase/metabase/issues/47869,[],[],
2520590552,issue,closed,completed,slices removed from query result still appear in pie chart settings,"### Describe the bug

https://github.com/user-attachments/assets/0eeaa36b-1d73-4d06-b8bf-abc54c89d285

After the query result changes, the rows that are no longer in the query result should not have slices visible in the viz settings UI.


### To Reproduce

1. New question -> Count of orders by created at: month, limit 5
2. Render as pie chart, move some rows around
3. Go back to notebook editor, change row limit to 2
4. Go back to viz settings sidebar, all 5 slices still visible


### Expected behavior

Only the current rows from the query result should have visible slices in the settings UI

### Logs

_No response_

### Information about your Metabase installation

```JSON
stats, commit hash 0064a6a
```


### Severity

Can make the pie chart difficult to use, makes the currently in development sunburst chart incorrect when switching dimension columns

### Additional context

_No response_",EmmadUsmani,2024-09-11 19:24:09+00:00,['alxnddr'],2024-10-08 16:14:45+00:00,2024-09-13 14:32:52+00:00,https://github.com/metabase/metabase/issues/47867,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/Charts/Pie', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2520386784,issue,open,,Native query with long column name breaks filtering,"### Describe the bug

If you have a native sql question with a very long column name or alias, and either convert it into a model or click on ""Explore results"", then try to add a filter on the overly-long column, it will fail to run the query.

This was discovered while testing the fix for #47584.

Note that with the (unmerged) fix for #47584, filtering *does* work in the v50 release branch, but not in current master (future v51).

### To Reproduce

1. New -> SQL query

```sql
SELECT
  count(*) AS count,
  state AS Total_number_of_people_from_each_state_separated_by_state_and_then_we_do_a_count
FROM
  people
GROUP BY
  Total_number_of_people_from_each_state_separated_by_state_and_then_we_do_a_count
```

2. `...` menu -> Turn into a model
3. Filter -> Contains 'A' for the long column
4. See the following error. Note that the `WHERE` clause is referencing the truncated column name, which does not exist in `source`

```
Column ""source.TOTAL_NUMBER_OF_PEOPLE_FROM_EACH_STATE_SEPARATED_BY_165e2c32"" not found; SQL statement:
SELECT
  ""source"".""COUN"" AS ""COUN"",
  ""source"".""TOTAL_NUMBER_OF_PEOPLE_FROM_EACH_STATE_SEPARATED_BY_STATE_AND_THEN_WE_DO_A_COUNT""
    AS ""TOTAL_NUMBER_OF_PEOPLE_FROM_EACH_STATE_SEPARATED_BY_165e2c32""
FROM (
  select
    count(*) as coun,
    state as Total_number_of_people_from_each_state_separated_by_state_and_then_we_do_a_count
  from
    people
  group by
    Total_number_of_people_from_each_state_separated_by_state_and_then_we_do_a_count
) AS ""source""
WHERE
  LOWER(""source"".""TOTAL_NUMBER_OF_PEOPLE_FROM_EACH_STATE_SEPARATED_BY_165e2c32"") LIKE ?
LIMIT 2000
```

### Expected behavior

Query should execute and results should be filtered.

### Logs

_No response_

### Information about your Metabase installation

```JSON
Metabase version: master

Filtering works in v50 once bug from #47584 that prevents turning into a model is resolved
```


### Severity

not great

### Additional context

_No response_",appleby,2024-09-11 17:52:04+00:00,[],2025-02-04 20:27:42+00:00,,https://github.com/metabase/metabase/issues/47863,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Nested Queries', 'Questions based on other saved questions'), ('.Backend', ''), ('.Team/Querying', '')]",[],
2520247107,issue,closed,completed,Show Select all in the filter dropdown in the QB,,ranquild,2024-09-11 16:50:55+00:00,['ranquild'],2024-10-08 16:14:47+00:00,2024-09-12 18:37:20+00:00,https://github.com/metabase/metabase/issues/47861,"[('.Team/Querying', '')]",[],
2520246842,issue,closed,completed,[Epic] Show Select all in the filter dropdown,"Product doc https://www.notion.so/metabase/Show-Select-all-in-the-filter-dropdown-d6ef3f831b304f089bee6f6ff8ee3e42

Milestone 1

```[tasklist]
- [ ] https://github.com/metabase/metabase/issues/47861
```

Milestone 2

```[tasklist]
- [ ] https://github.com/metabase/metabase/issues/47896
```",ranquild,2024-09-11 16:50:45+00:00,['ranquild'],2024-09-13 20:17:18+00:00,2024-09-13 20:17:14+00:00,https://github.com/metabase/metabase/issues/47860,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2519964778,issue,closed,completed,unskip a test in `offset.cy.spec.ts`,unskip `should work with metrics (metabase#47854)` from `e2e/test/scenarios/question/offset.cy.spec.ts`,uladzimirdev,2024-09-11 14:47:58+00:00,['kamilmielnik'],2024-10-08 16:14:07+00:00,2024-10-01 05:35:37+00:00,https://github.com/metabase/metabase/issues/47855,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2519936651,issue,closed,completed,metrics do not work with offset in custom expressions,"**Context**

- [ ] #47855 - I accidentally converted it to issue

- new metric, orders table, save
- show editor, add summarize, custom expression -> `Offset([Orders, Count], -1)`, add name, notice the error

<img width=""754"" alt=""image"" src=""https://github.com/user-attachments/assets/bdc26712-8115-4d93-b3e5-f60112441a17"">

The same expression is added if you go through ""compare to the past"", expression is marked as not valid if you try to edit it

- issue links: https://github.com/metabase/metabase/issues/47806

",uladzimirdev,2024-09-11 14:36:52+00:00,['kamilmielnik'],2024-10-01 05:35:37+00:00,2024-10-01 05:35:37+00:00,https://github.com/metabase/metabase/issues/47854,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', '')]",[],
2519630196,issue,closed,completed,Line charts sized to a small width do not display tooltip and data point values,"### Describe the bug

If a line chart is resized to a small horizontal dimension, the data points are no longer shown, and the tooltip fails to appear.
This only happens when the X-axis type is set to Ordinal.

Tooltip and values on data points are shown:
<img width=""1187"" alt=""image"" src=""https://github.com/user-attachments/assets/012bb537-37d6-4011-80ae-dc9646e73964"">

Not shown at a smaller width:
<img width=""1045"" alt=""image"" src=""https://github.com/user-attachments/assets/7ff1a29b-f416-49f1-a2a8-03046176f101"">



### To Reproduce

1. Create a question: Orders, Count of rows, by Created At: Day, Filter: Created At: Day is in the previous 3 monthds
2. Visualize: Line
- Display / Show values on data points: true
- Display / Values to show: Some
- Axes / X-Axis / Scale: Ordinal
3. Resize the visualization horizontally:
- if the chart is wide enough, data points are shown and tooltip works
- (!) if it is narrower: no values for data points neither the tooltip is shown


### Expected behavior

Data points and tooltips should work independently of the width of the chart

### Logs

_No response_

### Information about your Metabase installation

```JSON
1.50.24.2
```


### Severity

Reported by a customer. It affects their usage of line charts on dashboards.

### Additional context

This was working in version 1.49.18.",zbodi74,2024-09-11 12:35:50+00:00,['alxnddr'],2024-12-03 18:02:50+00:00,2024-12-03 17:02:03+00:00,https://github.com/metabase/metabase/issues/47847,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2519232412,issue,open,,Adding Elestio as deployment option,"Hey team,
I am Kaiwalya, Developer Advocate at Elestio. Elestio has been providing options of fully deploying and managing Metabase application as shown [here](https://elest.io/open-source/metabase). I think it would be a great idea if we can add it to official readme/documentation here.
🔔 In addition to this, if you are interested we provide partnership opportunities with tools we support by **revenue share** upon addition of this method in docs. If you would like to collaborate, just shoot me an email at [kaiwalya@elest.io](mailto:kaiwalya@elest.io) :)",kaiwalyakoparkar,2024-09-11 09:52:22+00:00,[],2024-09-11 09:52:22+00:00,,https://github.com/metabase/metabase/issues/47843,[],[],
2519164610,issue,closed,completed,SDK Fixes,"These can be released independent of Metabase 51.

```[tasklist]
### Eliminate style leaks
- [ ] https://github.com/metabase/metabase/issues/47624
- [ ] https://github.com/metabase/metabase/issues/44802
```

```[tasklist]
### Fix TypeScript typings
- [ ] https://github.com/metabase/metabase/issues/47627
```

```[tasklist]
### Theming for entity picker / create question
- [ ] https://github.com/metabase/metabase/issues/47344
- [ ] https://github.com/metabase/metabase/issues/47561
```

```[tasklist]
### Reduce errors and warnings in console
- [ ] https://github.com/metabase/metabase/issues/47656
```

```[tasklist]
### Fixes for Create/Modify Question (`QuestionEditor`)
- [ ] https://github.com/metabase/metabase/pull/47448
- [ ] https://github.com/metabase/metabase/issues/47464
- [ ] https://github.com/metabase/metabase/issues/47535
- [ ] https://github.com/metabase/metabase/issues/47537
- [ ] https://github.com/metabase/metabase/issues/47344
```


### Related Epics

- https://github.com/metabase/metabase/issues/47656
",NevRA,2024-09-11 09:28:40+00:00,[],2024-10-24 09:41:25+00:00,2024-10-24 09:41:09+00:00,https://github.com/metabase/metabase/issues/47842,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2434791852, 'issue_id': 2519164610, 'author': 'heypoom', 'body': 'Closing these as issues are resolved. Migrating remaining issues to https://github.com/metabase/metabase/issues/49080', 'created_at': datetime.datetime(2024, 10, 24, 9, 41, 9, tzinfo=datetime.timezone.utc)}]","heypoom on (2024-10-24 09:41:09 UTC): Closing these as issues are resolved. Migrating remaining issues to https://github.com/metabase/metabase/issues/49080

"
2519159454,issue,closed,completed,"[Epic] On embedding homepage, guide admins to the right embedding feature, including SDK",,NevRA,2024-09-11 09:26:54+00:00,['npretto'],2024-09-26 08:59:28+00:00,2024-09-26 08:59:28+00:00,https://github.com/metabase/metabase/issues/47841,[],[],
2519158934,issue,closed,completed,[Epic] Surface SDK in the share/embed flow,https://www.figma.com/design/W1TfzdrR8ldzp4vdjP1z36/SDK-Embedding%3A-admin-settings-%2B-embed-flow?node-id=10661-18909&t=UnHxyK1bnFGE3Npy-4,NevRA,2024-09-11 09:26:44+00:00,['npretto'],2024-10-04 07:12:20+00:00,2024-10-04 07:12:19+00:00,https://github.com/metabase/metabase/issues/47840,[],"[{'comment_id': 2392984319, 'issue_id': 2519158934, 'author': 'npretto', 'body': 'Closing as  [47840 - surface sdk in share modal](https://github.com/metabase/metabase/pull/47967) has been merged in the integration branch `sdk-launch-in-core-app`', 'created_at': datetime.datetime(2024, 10, 4, 7, 12, 19, tzinfo=datetime.timezone.utc)}]","npretto (Assginee) on (2024-10-04 07:12:19 UTC): Closing as  [47840 - surface sdk in share modal](https://github.com/metabase/metabase/pull/47967) has been merged in the integration branch `sdk-launch-in-core-app`

"
2518936514,issue,open,,"Allow left, middle and right alignment of columns","**Is your feature request related to a problem? Please describe.**

When creating a report, number columns default to right aligned (good) and text defaults to left aligned (often good) but there is no way manually override either. eg some date format look much better when right aligned, and there are many times when a short text column would be better middle or right aligned depending on the context of the report.


**Describe the solution you'd like**
I would like in the column style options a new setting for the alignment:
![image](https://github.com/user-attachments/assets/9e6bfde3-023a-466b-a7c4-d2d1d608db0a)

It would default to auto which would choose right for numbers and left for text and also have explicit options for middle and right and left aligned.

**Describe alternatives you've considered**
For some dates in the past I've converted a date to a string and formatted the date to get better alignment but then this has other downsides. I haven't found a workaround for other types.

**How important is this feature to you?**
Nice to have

**Additional context**
-",brendanheywood,2024-09-11 08:11:18+00:00,[],2025-02-04 20:31:52+00:00,,https://github.com/metabase/metabase/issues/47837,"[('Type:New Feature', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations')]","[{'comment_id': 2343269048, 'issue_id': 2518936514, 'author': 'jwcatau', 'body': ""I couldn't agree more. Given the numeric/reporting aspects of metabase, I'm surprised right alignment isn't already implemented."", 'created_at': datetime.datetime(2024, 9, 11, 10, 33, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2343873685, 'issue_id': 2518936514, 'author': 'paoliniluis', 'body': 'related to https://github.com/metabase/metabase/issues/8335', 'created_at': datetime.datetime(2024, 9, 11, 14, 40, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2343874162, 'issue_id': 2518936514, 'author': 'paoliniluis', 'body': 'cc @cdeweyx for the table project', 'created_at': datetime.datetime(2024, 9, 11, 14, 40, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2345750589, 'issue_id': 2518936514, 'author': 'brendanheywood', 'body': 'This could be another issue or bundle here, but equally related would be to add an option for allowing text wrapping as well', 'created_at': datetime.datetime(2024, 9, 12, 9, 30, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2345996150, 'issue_id': 2518936514, 'author': 'paoliniluis', 'body': '@brendanheywood that’s another issue', 'created_at': datetime.datetime(2024, 9, 12, 11, 8, 1, tzinfo=datetime.timezone.utc)}]","jwcatau on (2024-09-11 10:33:30 UTC): I couldn't agree more. Given the numeric/reporting aspects of metabase, I'm surprised right alignment isn't already implemented.

paoliniluis on (2024-09-11 14:40:05 UTC): related to https://github.com/metabase/metabase/issues/8335

paoliniluis on (2024-09-11 14:40:18 UTC): cc @cdeweyx for the table project

brendanheywood (Issue Creator) on (2024-09-12 09:30:48 UTC): This could be another issue or bundle here, but equally related would be to add an option for allowing text wrapping as well

paoliniluis on (2024-09-12 11:08:01 UTC): @brendanheywood that’s another issue

"
2518375915,issue,closed,completed,"Charts with timeseries x-axis are rendering offset along that axis, possibly time zone related, post v0.49 -> v0.50 upgrade","### Describe the bug

Charts using a timeseries x-axis at any data granularity (raw, hourly, daily etc.) are being rendered with the data offset along the x-axis. The amount offset is +12 hours, this also happens to be my time zone offset from UTC (New Zealand)

The axis limits are correct, and the data returned by the query is correct. The charts rendered with an ordinal x-axis, row chart, or table are correct. This is not a query issue. Metabase ""Report Timezone"" doesn't seem to make any differece.

This occurs in v0.50.24 but not in v0.49.7.

All 4 of the questions in the below dashboard are using the same native SQL query:
![image](https://github.com/user-attachments/assets/e0a14373-c781-4d06-b2e3-2f24049cc7f7)

You can see that the top right chart is the timeseries x-axis and isn't showing all the data, and what it is showing is in the wrong place. All the other questions show the correct data.

Note that the MSSQL datetime data type (we use this almost exclusivley) doesn't have any knowledge of timezones.

I can't reproduce this in the Sample database, or in a Postgres database.

### To Reproduce

1. With a non 0 UTC offset environment and an MSSSQL database
2. Create a native SQL query for this SQL:
```sql
DECLARE @date_var DATETIME
SELECT @date_var = '2024-09-01 00:00'

;WITH Dates AS
(
    SELECT DATEPART(HOUR,@date_var) [Hour], 
      @date_var DatetimeHour, 0 HourNumber
    UNION ALL
    SELECT DATEPART(HOUR,DATEADD(HOUR,1,DatetimeHour)), 
      DATEADD(HOUR,1,DatetimeHour), HourNumber+1
    FROM Dates
    WHERE HourNumber < 23
)
SELECT HourNumber, DatetimeHour
FROM Dates
order by DatetimeHour asc
```
3. Run the question and see the table returned starts at 1 September 00:00, with values for each hour of that day
![image](https://github.com/user-attachments/assets/ae685623-4e31-4b53-a91f-13ec577b6d46)
4. Change the visualisation to a bar chart and set the x-axis to timeseries, only half the values from the table are rendered, and it starts about half way along the x-axis with the value from 01:00
![image](https://github.com/user-attachments/assets/8c2a584a-4a63-4a35-baa7-0d4eadb71b22)
5. Changing the x-axis to ordinal and all the values are shown in the correct place
![image](https://github.com/user-attachments/assets/28975a37-2a63-42b2-97ec-bb374cb32234)

Note that the min and max values for both x and y axis are correct for the dataset, not just what's displayed in the timeseries chart.




### Expected behavior

Charts should render correctly regardless of axis settings.

### Logs

Nothing of note when the chart is rendered.

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-NZ"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""sqlserver"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-09-03"",
      ""tag"": ""v0.50.24"",
      ""hash"": ""3b63317""
    },
    ""settings"": {
      ""report-timezone"": ""Pacific/Auckland""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""Cp1252"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""17.0.2+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""17.0.2"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""17.0.2+8"",
    ""os.name"": ""Windows 10"",
    ""os.version"": ""10.0"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Pacific/Auckland""
  }
}
```


### Severity

Blocking upgrade to v0.50

### Additional context

Time series charts form a really big part of our usage of Metabase. This is stopping us from upgrading and getting some of the good things available in v0.50.

The issue also presents when charting data grouped by day etc. however it's not as clearly incorrect at that level, it's still wrong but it's not as obvious.",notrom,2024-09-11 03:31:55+00:00,['alxnddr'],2024-10-05 00:10:09+00:00,2024-10-04 16:18:38+00:00,https://github.com/metabase/metabase/issues/47835,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Database/SQLServer', None), ('Misc/Timezones', ''), ('.Frontend', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2343494826, 'issue_id': 2518375915, 'author': 'bshepherdson', 'body': 'This may or may not be related to other recent MSSQL datetime and bucketing changes; see #47248.', 'created_at': datetime.datetime(2024, 9, 11, 12, 10, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2343495799, 'issue_id': 2518375915, 'author': 'bshepherdson', 'body': 'Also, thank you for the beautifully detailed bug report!', 'created_at': datetime.datetime(2024, 9, 11, 12, 10, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2344791738, 'issue_id': 2518375915, 'author': 'notrom', 'body': ""> Also, thank you for the beautifully detailed bug report!\r\n\r\n@bshepherdson I've had enough date/time/timezone related issues with Metabase over the years to know that it needs to be clearly shown up front. Being UTC +12, and MSSQL Server datetimes, makes some of these things really stand out for me that may slip under the radar elsewhere.\r\n\r\nThis one's a blocker for us if I can't find a work around or get it fixed."", 'created_at': datetime.datetime(2024, 9, 11, 22, 11, 59, tzinfo=datetime.timezone.utc)}]","bshepherdson on (2024-09-11 12:10:13 UTC): This may or may not be related to other recent MSSQL datetime and bucketing changes; see #47248.

bshepherdson on (2024-09-11 12:10:40 UTC): Also, thank you for the beautifully detailed bug report!

notrom (Issue Creator) on (2024-09-11 22:11:59 UTC): @bshepherdson I've had enough date/time/timezone related issues with Metabase over the years to know that it needs to be clearly shown up front. Being UTC +12, and MSSQL Server datetimes, makes some of these things really stand out for me that may slip under the radar elsewhere.

This one's a blocker for us if I can't find a work around or get it fixed.

"
2518310847,issue,closed,completed,Investigate browser lockup in v49,"### Describe the bug

A customer has browser lockups when rendering a table in v49

### To Reproduce

Please check https://drive.google.com/file/d/14BHzFVpZMTVZoI3tGub0VONpg67DAOAg/view?usp=sharing

### Expected behavior

Rendering tables should be fast

### Logs

NA

### Information about your Metabase installation

```JSON
v49, custom fork
```


### Severity

P1

### Additional context

_No response_",paoliniluis,2024-09-11 02:24:28+00:00,"['ranquild', 'alxnddr']",2024-10-04 14:20:38+00:00,2024-10-04 14:20:37+00:00,https://github.com/metabase/metabase/issues/47834,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2388908140, 'issue_id': 2518310847, 'author': 'github-actions[bot]', 'body': '🚀 This should also be released by [v0.51](https://github.com/metabase/metabase/milestone/231)', 'created_at': datetime.datetime(2024, 10, 2, 15, 4, 16, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-10-02 15:04:16 UTC): 🚀 This should also be released by [v0.51](https://github.com/metabase/metabase/milestone/231)

"
2518296274,issue,open,,Support daylight saving timezones (shift the timezone for periods of time),"**Is your feature request related to a problem? Please describe.**
There are some timezones that are switched along the year, e.g.: Eastern Daylight Time (EDT) is in use from the second Sunday in March to the first Sunday in November and Eastern Standard Time (EST) is used during the remainder of the year. We should have a way to set that up or configure it from the admin

**Describe the solution you'd like**
Be able to shift the timezone during the year, on certain periods of time

**Describe alternatives you've considered**
doing timezone conversions in the database programmatically

**How important is this feature to you?**
Requested by a customer

**Additional context**
NA
",paoliniluis,2024-09-11 02:09:33+00:00,[],2025-02-04 20:30:48+00:00,,https://github.com/metabase/metabase/issues/47833,"[('Type:New Feature', ''), ('Misc/Timezones', '')]",[],
2518157825,issue,closed,completed,"Selecting search doc option in Command Palette is resulting in ""An error occurred""","### Describe the bug

When using Command Palette to search for doc, when you click on ""Search documentation ..."" option, it will open a new tab for the doc (good), but the existing tab will now show ""An error occurred"" (not good). 

### To Reproduce

1. Open Command Palette
2. Search for something
3. Select ""Search Documentation ...""
4. A new tab opens for doc while existing tab shows error. 


### Expected behavior

Existing tab should stay the same with Command Palette open or closed but not error. 

### Logs

n/a

### Information about your Metabase installation

```JSON
Postgres @ Master
```


### Severity

Medium as it confuses user but mostly cosmetic

### Additional context

_No response_",maxzheng,2024-09-10 23:34:11+00:00,['rafpaf'],2024-10-07 14:33:56+00:00,2024-10-01 13:42:01+00:00,https://github.com/metabase/metabase/issues/47829,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2518114862,issue,closed,not_planned,"On Dashboard getting intermittent 500s for Cards ""ERROR: cannot execute UPDATE in a read-only transaction""","### Describe the bug

When I am on a dashboard, several questions do not load and show a ""There was a problem displaying this chart.""

This is because the HTTP call had a 500.

The response payload has an error that is similar to one of the below:

""message"": ""ERROR: cannot execute DELETE in a read-only transaction""
""message"": ""ERROR: cannot execute UPDATE in a read-only transaction""

Upon refreshing the dashboard, different questions will not load. If I refresh 10 times, different combinations of questions do not load.

I have also tried running the HTTP call via Insomnia as well every 10 seconds. Anecdotally, this results in a 1/6 calls being successful.

Details:
- We use Amazon RDS for our Metabase Database
- We use Amazon RDS for our data warehouse

### To Reproduce

Load a dashboard with many questions

### Expected behavior

The questions should load

### Logs

```{
    ""via"": [
        {
            ""type"": ""clojure.lang.ExceptionInfo"",
            ""message"": ""ERROR: cannot execute UPDATE in a read-only transaction"",
            ""data"": {
                ""toucan2/context-trace"": [
                    [
                        ""execute SQL with class com.mchange.v2.c3p0.impl.NewProxyConnection"",
                        {
                            ""toucan2.jdbc.query/sql-args"": [
                                ""UPDATE \""user_parameter_value\"" SET \""value\"" = ? WHERE (\""user_id\"" = ?) AND (\""dashboard_id\"" = ?) AND (\""parameter_id\"" = ?)"",
                                ""[\""day\""]"",
                                237,
                                5670,
                                ""641e1c9b""
                            ]
                        }
                    ],
                    [
                        ""resolve connection"",
                        {
                            ""toucan2.connection/connectable"": ""class org.postgresql.jdbc.PgConnection""
                        }
                    ],
                    [
                        ""resolve connection"",
                        {
                            ""toucan2.connection/connectable"": null
                        }
                    ],
                    {
                        ""toucan2.pipeline/rf"": ""clojure.core$completing$fn__8528@cc45fb6""
                    },
                    [
                        ""with compiled query"",
                        {
                            ""toucan2.pipeline/compiled-query"": [
                                ""UPDATE \""user_parameter_value\"" SET \""value\"" = ? WHERE (\""user_id\"" = ?) AND (\""dashboard_id\"" = ?) AND (\""parameter_id\"" = ?)"",
                                ""[\""day\""]"",
                                237,
                                5670,
                                ""641e1c9b""
                            ]
                        }
                    ],```

### Information about your Metabase installation

```JSON
- Browser: Brave Version 1.68.141 Chromium: 127.0.6533.120 (Official Build) (arm64)
- macOS 14.6.1 (23G93)
- Datawarehouse: PostgreSQL 15.4 on aarch64-unknown-linux-gnu, compiled by aarch64-unknown-linux-gnu-gcc (GCC) 9.5.0, 64-bit
- Metabase internal DB: PostgreSQL 12.16 on x86_64-pc-linux-gnu, compiled by x86_64-pc-linux-gnu-gcc (GCC) 9.5.0, 64-bit
- Metabase version: 0.50.14
- Metabase hosting: AWS ec2 (via k8s)
```


### Severity

Severe: Makes dashboards unusable

### Additional context

_No response_",sifxtreme,2024-09-10 22:52:32+00:00,[],2024-09-10 23:00:02+00:00,2024-09-10 23:00:02+00:00,https://github.com/metabase/metabase/issues/47828,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2342306907, 'issue_id': 2518114862, 'author': 'paoliniluis', 'body': ""Please move to 50.25 and also please keep a look at https://github.com/metabase/metabase/pull/47719 which should solve the problem you're seeing"", 'created_at': datetime.datetime(2024, 9, 10, 23, 0, 2, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-10 23:00:02 UTC): Please move to 50.25 and also please keep a look at https://github.com/metabase/metabase/pull/47719 which should solve the problem you're seeing

"
2518076702,issue,closed,not_planned,Update field name in model metadata reverts to the default one when it's a SUM,"### Describe the bug

Some weird (FE?) error that doesn't let the user update the field name when it's a sum

### To Reproduce

1) create the following model
![image](https://github.com/user-attachments/assets/c6eedb72-d346-4981-bfd6-fe1e278d8c4a)
2) save it and then try to change the name of the sum column. Save it, see that the column didn't change the name


### Expected behavior

It should change the name

### Logs

no logs on the BE, FE only
```
""Error normalizing pMBQL:\n{:value {:lib/type :mbql/query, :stages [{:lib/type :mbql.stage/mbql}]},\n :schema #object[Object [object Object]],\n :explain\n {:schema #object[Object [object Object]],\n  :value {:lib/type :mbql/query, :stages [{:lib/type :mbql.stage/mbql}]},\n  :errors\n  ({:path [0 0 :database],\n    :in [:database],\n    :schema #object[Object [object Object]],\n    :value nil,\n    :type :malli.core/missing-key}\n   {:path [0 0 :stages 0 1 0 0 :mbql.stage/mbql],\n    :in [:stages 0], \n    :schema #object[Object [object Object]], \n    :value {:lib/type :mbql.stage/mbql}})}}\n""
e8 @ core.cljs:4009
core.cljs:4009 [metabase.lib.normalize] ""Error normalizing pMBQL:\n{:value {:lib/type :mbql/query, :stages [{:lib/type :mbql.stage/mbql}], :lib/metadata #object[p [object Object]]},\n :schema #object[Object [object Object]],\n :explain\n {:schema #object[Object [object Object]],\n  :value {:lib/type :mbql/query, :stages [{:lib/type :mbql.stage/mbql}], :lib/metadata #object[p [object Object]]},\n  :errors\n  ({:path [0 0 :database],\n    :in [:database],\n    :schema #object[Object [object Object]],\n    :value nil,\n    :type :malli.core/missing-key}\n   {:path [0 0 :stages 0 1 0 0 :mbql.stage/mbql],\n    :in [:stages 0], \n    :schema #object[Object [object Object]], \n    :value {:lib/type :mbql.stage/mbql}})}}\n""
e8 @ core.cljs:4009
```

### Information about your Metabase installation

```JSON
- v50+

Maybe this comes back from before, but I'm not sure
```


### Severity

P2

### Additional context

_No response_",paoliniluis,2024-09-10 22:31:42+00:00,[],2024-09-11 12:03:22+00:00,2024-09-11 12:03:22+00:00,https://github.com/metabase/metabase/issues/47825,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2343479309, 'issue_id': 2518076702, 'author': 'bshepherdson', 'body': 'Duplicate of #26755.', 'created_at': datetime.datetime(2024, 9, 11, 12, 3, 22, tzinfo=datetime.timezone.utc)}]","bshepherdson on (2024-09-11 12:03:22 UTC): Duplicate of #26755.

"
2518033662,issue,closed,completed,Add visual cues in SDK around evaluation usage and feature flags,Refer to [product docs](https://www.notion.so/metabase/Add-visual-cues-in-SDK-around-evaluation-usage-and-feature-flag-004be55a2ed247839cc9521e9a58f6d4?pvs=4) here,heypoom,2024-09-10 22:18:45+00:00,['heypoom'],2024-10-08 16:14:40+00:00,2024-09-13 20:18:56+00:00,https://github.com/metabase/metabase/issues/47824,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2517539390,issue,open,,sql preview shows an error when offset is used without breakout,"**Context**

sql preview is not able to provide correct sql, but maybe we should consider providing a nice message instead of ""broken sql""


- issue links: https://github.com/metabase/metabase/issues/47806

",uladzimirdev,2024-09-10 19:33:53+00:00,[],2025-01-16 20:10:15+00:00,,https://github.com/metabase/metabase/issues/47819,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2374613189, 'issue_id': 2517539390, 'author': 'mngr', 'body': 'I think in case without breakouts we should just generate a column as is without window functions, the same way as we do for cumulative functions', 'created_at': datetime.datetime(2024, 9, 25, 16, 46, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2374618295, 'issue_id': 2517539390, 'author': 'mngr', 'body': 'Actually in this case there is no valid output at all, so this is more than just ""no preview""', 'created_at': datetime.datetime(2024, 9, 25, 16, 48, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2596800935, 'issue_id': 2517539390, 'author': 'ranquild', 'body': 'A new feature - would require certain changes', 'created_at': datetime.datetime(2025, 1, 16, 20, 10, 14, tzinfo=datetime.timezone.utc)}]","mngr on (2024-09-25 16:46:29 UTC): I think in case without breakouts we should just generate a column as is without window functions, the same way as we do for cumulative functions

mngr on (2024-09-25 16:48:52 UTC): Actually in this case there is no valid output at all, so this is more than just ""no preview""

ranquild on (2025-01-16 20:10:14 UTC): A new feature - would require certain changes

"
2517362899,issue,closed,completed,Expose columns from all stages for filtering in the QB,,ranquild,2024-09-10 18:43:18+00:00,['ranquild'],2024-10-08 16:14:51+00:00,2024-09-12 15:03:05+00:00,https://github.com/metabase/metabase/issues/47817,[],[],
2517195763,issue,closed,not_planned,Deduplicate column groups from multiple stages,,ranquild,2024-09-10 18:00:17+00:00,['ranquild'],2024-09-10 18:43:10+00:00,2024-09-10 18:43:10+00:00,https://github.com/metabase/metabase/issues/47816,[],[],
2517086819,issue,open,,Log of .png download in embedded,"Edit:
We can log PNG downloads in the audit_log, but low-priority given that any user can capture the screen and we won't know about it.


### Describe the bug

1. When downloading full results from a static embedded chart, it is not generating a log in v_query_log.

### To Reproduce

1. In a embedded bar chart
2. Click on '...'
3. Select Download Results
4. Select .png


### Expected behavior

A log in v_query_log like .csv: 
query_source = embedded-csv-download -> embedded-png-download


### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""pt-BR"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""postgres"",
      ""bigquery-cloud-sdk""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-self-hosted-yearly"",
    ""version"": {
      ""date"": ""2024-09-03"",
      ""tag"": ""v1.50.24"",
      ""hash"": ""3b63317""
    },
    ""settings"": {
      ""report-timezone"": ""America/Sao_Paulo""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.90+"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

annoying

### Additional context

_No response_",fer-batista,2024-09-10 17:26:52+00:00,[],2025-02-04 20:31:00+00:00,,https://github.com/metabase/metabase/issues/47815,"[('Type:New Feature', ''), ('.Frontend', ''), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('Administration/Usage analytics', 'Pro and Enterprise meta analytics, fka audit'), ('.Team/Embedding', '')]","[{'comment_id': 2341570376, 'issue_id': 2517086819, 'author': 'paoliniluis', 'body': 'because the png download is just a screen capture, the query has already been run', 'created_at': datetime.datetime(2024, 9, 10, 17, 37, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2371359509, 'issue_id': 2517086819, 'author': 'npfitz', 'body': ""To build on what @paoliniluis said, when downloading a PNG, you're actually not hitting the backend at all. We're using some tools on the frontend to generate a PGN from the HTML on the screen. We could send info to the BE do log that this happened, but we currently done. Is this something we should plan to do @luizarakaki ?"", 'created_at': datetime.datetime(2024, 9, 24, 13, 57, 7, tzinfo=datetime.timezone.utc)}, {'comment_id': 2371370661, 'issue_id': 2517086819, 'author': 'luizarakaki', 'body': ""There is an argument to log this in the activity log, but low-priority imo.\r\n\r\nAny user can capture the screen and it would be impossible for us to know, so there is little value in this log.\r\n\r\nI'm editing the issue for clarity"", 'created_at': datetime.datetime(2024, 9, 24, 13, 59, 31, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-10 17:37:32 UTC): because the png download is just a screen capture, the query has already been run

npfitz on (2024-09-24 13:57:07 UTC): To build on what @paoliniluis said, when downloading a PNG, you're actually not hitting the backend at all. We're using some tools on the frontend to generate a PGN from the HTML on the screen. We could send info to the BE do log that this happened, but we currently done. Is this something we should plan to do @luizarakaki ?

luizarakaki on (2024-09-24 13:59:31 UTC): There is an argument to log this in the activity log, but low-priority imo.

Any user can capture the screen and it would be impossible for us to know, so there is little value in this log.

I'm editing the issue for clarity

"
2516908809,issue,closed,completed,Move `Summaries` title to MBQL lib,,ranquild,2024-09-10 16:21:42+00:00,['ranquild'],2024-10-08 16:15:00+00:00,2024-09-10 18:39:10+00:00,https://github.com/metabase/metabase/issues/47811,[],[],
2516851965,issue,open,,Improve charts series colors selection when some series have preferred colors,"**Context**

[Slack report](https://metaboat.slack.com/archives/C064QMXEV9N/p1725955764278409)

For series with certain names like ""success"" or ""cancel"" we have default preferred colors defined. In some cases when other series got similar colors auto assigned they do not look great or accessible by default until users set different colors manually:
<img width=""410"" alt=""Screenshot 2024-09-10 at 11 54 37 AM"" src=""https://github.com/user-attachments/assets/136ea35d-1d29-4dbe-a53e-ca5c5583f335"">

We need to improve the color auto assignment to avoid having similar colors.",alxnddr,2024-09-10 15:55:41+00:00,[],2024-09-10 15:55:42+00:00,,https://github.com/metabase/metabase/issues/47810,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2516674418,issue,closed,completed,[Epic] Cover offset() with e2e tests and find bugs,"**Links**
- [product doc](https://www.notion.so/metabase/Cover-offset-with-e2e-tests-and-find-bugs-2bc2933ad01e4eb682bebd9dd6a850eb)
- feature branch: `e2e-tests-offset`

**Implementation Plan**
- create testing plan
- add tests
- file bugs

Testing plan
___


- implicit joins
	- when custom column is in the first place of breakout
		- works with custom column that contains a function
		- works with custom column that contains a column
		- works when custom column is a simple expression
	- when custom column is not in the first place of breakout
		- works with custom column that contains a function
		- works with custom column that contains a column
		- works when custom column is a simple expression
- explicit joins
	- offset expression not in the first place in aggregation
	- offset expression is in the first place in aggregation
	- offset and avg function applied to custom column
- when expression contains a standard function with offset
	- works with avg
	- works with 3 breakouts
- works with filtering using segment
- works with metric",uladzimirdev,2024-09-10 14:42:14+00:00,['uladzimirdev'],2024-10-08 16:14:42+00:00,2024-09-13 17:32:08+00:00,https://github.com/metabase/metabase/issues/47806,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2516662635,issue,open,,Don't log requests to api/cloud-migration when in read-only mode,"We log requests to api endpoints. We don't log _all_ of them.

```clojure
(defn- logging-disabled-uris
  ""The set of URIs that should not be logged.""
  []
  (cond-> #{""/api/util/logs""}
    (not (health-check-logging-enabled)) (conj ""/api/health"")))
```

When someone is attempting to migrate to cloud, their logs are _full_ of 

```
s: 5/50 (2 idle, 0 queued) (70 total active threads) Queries in flight: 0 (0 queued) \{:metabase-user-id 4\}\
2024-08-28 13:13:17,601 DEBUG middleware.log :: GET /api/cloud-migration 200 1.3 ms (1 DB calls) App DB connections: 0/15 Jetty threads: 5/50 (2 idle, 0 queued) (70 total active threads) Queries in flight: 0 (0 queued) \{:metabase-user-id 4\}\
2024-08-28 13:13:21,597 DEBUG middleware.log :: GET /api/cloud-migration 200 1.4 ms (1 DB calls) App DB connections: 0/15 Jetty threads: 5/50 (2 idle, 0 queued) (70 total active threads) Queries in flight: 0 (0 queued) \{:metabase-user-id 4\}\
2024-08-28 13:13:25,608 DEBUG middleware.log :: GET /api/cloud-migration 200 2.0 ms (1 DB calls) App DB connections: 0/15 Jetty threads: 5/50 (2 idle, 0 queued) (70 total active threads) Queries in flight: 0 (0 queued) \{:metabase-user-id 4\}\
2024-08-28 13:13:29,600 DEBUG middleware.log :: GET /api/cloud-migration 200 1.4 ms (1 DB calls) App DB connections: 0/15 Jetty threads: 5/50 (2 idle, 0 queued) (70 total active threads) Queries in flight: 0 (0 queued) \{:metabase-user-id 4\}\
2024-08-28 13:13:33,597 DEBUG middleware.log :: GET /api/cloud-migration 200 1.3 ms (1 DB calls) App DB connections: 0/15 Jetty threads: 5/50 (2 idle, 0 queued) (70 total active threads) Queries in flight: 0 (0 queued) \{:metabase-user-id 4\}\
2024-08-28 13:13:37,630 DEBUG middleware.log :: GET /api/cloud-migration 200 1.3 ms (1 DB calls) App DB connections: 0/15 Jetty threads: 5/50 (2 idle, 0 queued) (70 total active threads) Queries in flight: 0 (0 queued) \{:metabase-user-id 4\}\
2024-08-28 13:13:41,593 DEBUG middleware.log :: GET /api/cloud-migration 200 1.3 ms (1 DB calls) App DB connections: 0/15 Jetty threads: 5/50 (2 idle, 0 queued) (70 total active threads) Queries in flight: 0 (0 queued) \{:metabase-user-id 4\}\
2024-08-28 13:13:45,604 DEBUG middleware.log :: GET /api/cloud-migration 200 1.2 ms (1 DB calls) App DB connections: 0/15 Jetty threads: 5/50 (2 idle, 0 queued) (70 total active threads) Queries in flight: 0 (0 queued) \{:metabase-user-id 4\}\
```

Of a file I've seen, there are 2122 lines, 1703 of which are just useloess logs

```
❯ wc -l Cloud-Migration\ Log.rtf
    2122 Cloud-Migration Log.rtf
❯ grep ""GET /api/cloud-migration"" Cloud-Migration\ Log.rtf | wc -l
    1703
```

### IDEA

When we are in read-only mode, let's not log these api/cloud-migration polling requests.",dpsutton,2024-09-10 14:37:16+00:00,[],2025-02-04 20:23:51+00:00,,https://github.com/metabase/metabase/issues/47804,"[('.Backend', ''), ('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2516648002,issue,closed,completed,"Show verified metrics by default, add a checkbox to switch to all metrics",,romeovs,2024-09-10 14:31:34+00:00,[],2024-10-08 16:14:30+00:00,2024-09-24 16:44:32+00:00,https://github.com/metabase/metabase/issues/47803,[],[],
2516608311,issue,closed,completed,Remove column group names singularization,,ranquild,2024-09-10 14:15:56+00:00,['ranquild'],2024-10-08 16:15:01+00:00,2024-09-10 17:41:06+00:00,https://github.com/metabase/metabase/issues/47802,[],[],
2516535194,issue,closed,completed,[Epic] Allow to filter by all columns in the query builder,"Product doc https://www.notion.so/metabase/Allow-to-filter-by-all-columns-47f4e5eef7f04e2f9d41e4f140c93596

#### Milestone 1 - deduplicate column group names

Fix existing issues with column group names that become more important if we expose more groups.

```[tasklist]
- [ ] https://github.com/metabase/metabase/issues/47802
- [ ] https://github.com/metabase/metabase/issues/47811
```

#### Milestone 2 - QB

Allow filtering on any column in the QB.

```[tasklist]
- [ ] https://github.com/metabase/metabase/issues/47817
```
",ranquild,2024-09-10 13:47:25+00:00,['ranquild'],2024-10-25 09:01:48+00:00,2024-09-12 15:03:18+00:00,https://github.com/metabase/metabase/issues/47800,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]","[{'comment_id': 2437239829, 'issue_id': 2516535194, 'author': 'JamesPoel', 'body': ""Is this in 1.51.1? Unless I'm misunderstanding this ticket, I had assumed it would also fix https://discourse.metabase.com/t/cant-filter-dashboard-with-double-aggregation/12569/9"", 'created_at': datetime.datetime(2024, 10, 25, 8, 48, 33, tzinfo=datetime.timezone.utc)}]","JamesPoel on (2024-10-25 08:48:33 UTC): Is this in 1.51.1? Unless I'm misunderstanding this ticket, I had assumed it would also fix https://discourse.metabase.com/t/cant-filter-dashboard-with-double-aggregation/12569/9

"
2516219100,issue,closed,completed,Show temporal metric last value,,romeovs,2024-09-10 11:49:28+00:00,[],2024-10-08 16:14:50+00:00,2024-09-12 16:11:58+00:00,https://github.com/metabase/metabase/issues/47797,[],[],
2516212445,issue,closed,completed,Show scalar metric value,,romeovs,2024-09-10 11:46:10+00:00,[],2024-10-08 16:15:02+00:00,2024-09-10 16:47:40+00:00,https://github.com/metabase/metabase/issues/47796,[],[],
2516133804,issue,closed,completed,Serialization fails for Mongo nested fields,"### Describe the bug

Full context [here](https://metaboat.slack.com/archives/C0641E4PB9B/p1725634813914559)

### To Reproduce

@piranha is already aware of this and the below is mainly his research:

So in mongo db you can have nested data:
```
qwe> db.whatever.find()
[
  {
    _id: ObjectId('664f3e4fe27a442f03aace62'),
    level_0: { level_1: { level_2: 'test' } }
  },
  {
    _id: ObjectId('66dffa90f3ee3a31efa72a44'),
    level_0: { level_2: 'a lie' }
  }
]
```

We represent those nested levels as separate fields, which point to their parent id (so they don't create new parent_ids, they just reference them)

The problem here is that we disregard those `parent_ids` during serialization phase, we just don't care
and so if you have a same name for a column on two different levels - there will be errors


### Expected behavior

Serialisation works when there are nested columns in Mongo

### Logs

```
Caused by org.postgresql.util.PSQLException
   ERROR: duplicate key value violates unique constraint ""idx_unique_field""
   Detail: Key (name, table_id, unique_field_helper)=(level_2, 60, 468) already
   exists.
```

### Information about your Metabase installation

```JSON
50.24 and master
```


### Severity

Blocking some customer from upgrading to 50 since they depend on a serialization pipeline

### Additional context

_No response_",Tony-metabase,2024-09-10 11:07:57+00:00,['piranha'],2024-09-13 09:21:34+00:00,2024-09-13 06:32:27+00:00,https://github.com/metabase/metabase/issues/47795,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Operation/Serialization', 'Enterprise contents migration'), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2340844851, 'issue_id': 2516133804, 'author': 'paoliniluis', 'body': 'I would actually escalate this @Tony-metabase', 'created_at': datetime.datetime(2024, 9, 10, 13, 43, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2340858734, 'issue_id': 2516133804, 'author': 'Tony-metabase', 'body': ""it's on Alexander radar and he will start working on this once he adds a fix to the deadlock problems we are facing"", 'created_at': datetime.datetime(2024, 9, 10, 13, 47, 39, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-10 13:43:41 UTC): I would actually escalate this @Tony-metabase

Tony-metabase (Issue Creator) on (2024-09-10 13:47:39 UTC): it's on Alexander radar and he will start working on this once he adds a fix to the deadlock problems we are facing

"
2515569271,issue,closed,completed,Query preview showing blank page on UI,"### Describe the bug

we're running  metabase v0.50.24 with docker and the ""Preview the query"" feature in the query Editor is not working

### To Reproduce

1. Go to 'query editor'
2. Click on 'Preview the query'
3. I can see the /api/dataset/native POST request can get reponse  data from metabase
4. but the Query preview page doesn't display the data which  was returned by /api/dataset/native request


### Expected behavior

display the sql on dashboard

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mongo""],
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-09-03"",
      ""tag"": ""v0.50.24"",
      ""hash"": ""3b63317""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Shanghai""
    },
    ""hosting-env"": ""docker"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.6""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.49-70.116.amzn2023.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

blocking some users

### Additional context

<img width=""1456"" alt=""image"" src=""https://github.com/user-attachments/assets/82ea177d-1ec7-4032-b8d8-fa9b7a1dfc93"">
",allen12921,2024-09-10 06:55:38+00:00,['ranquild'],2024-10-22 18:51:28+00:00,2024-10-22 18:06:48+00:00,https://github.com/metabase/metabase/issues/47793,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Database/Mongo', None), ('Querying/Native', 'The SQL/native query editor'), ('.Frontend', ''), ('.Team/Querying', ''), ('Frequency:Often', 'Something users bump into often')]",[],
2514656918,issue,closed,completed,Decouple release from tags (latest/nightly/beta),"[discussion](https://metaboat.slack.com/archives/C864UT5CZ/p1723818227926829?thread_ts=1723794043.125729&cid=C864UT5CZ)

[discussion](https://metaboat.slack.com/archives/C0669P4AF9N/p1725418191282799)

- [x] remove `latest` tagging from publish action
- [x] Github action to set a tag on a version
- [x] update version-info logic
- [x] some sort of display of what is tagged how/where
- [ ] link to action in ops issues
- [ ] link nightly releases to latest tag

",iethree,2024-09-09 18:39:08+00:00,['iethree'],2024-10-08 16:14:29+00:00,2024-09-24 17:14:01+00:00,https://github.com/metabase/metabase/issues/47786,"[('.Building & Releasing', '')]",[],
2514655546,issue,closed,completed,Automatic Milestone adding for major release,"The current automatic milestone-setting logic is triggered when any commit is added to a release branch. Since the releasse branch for the next major release doesn't exist - the next major release milestone has had no issues automatically added.

We need a repeatable way to, when the new release branch gets cut, to parse all the commits since the last major release branch was cut and figure out which commits did not get backported and add them to the new major release milestone",iethree,2024-09-09 18:38:19+00:00,['iethree'],2024-10-08 16:13:44+00:00,2024-10-02 22:47:44+00:00,https://github.com/metabase/metabase/issues/47785,"[('.Building & Releasing', '')]",[],
2514437135,issue,open,,[Epic] Metrics page (part 2),"**Links**
- [product doc](https://www.notion.so/metabase/Metrics-page-part-2-de5ca5fcc8a24d8499d167a74137feac)
- [tech doc](https://www.notion.so/Tech-Doc-Allow-users-to-view-all-metrics-in-one-place-5b39d90e8df849909302fab389e15097?pvs=24)

**Implementation Plan**

### Milestone 1
Implemented in https://github.com/metabase/metabase/issues/46956

### Milestone 2 — FE+BE

```[tasklist]
- [ ] [BE] add `sort` and `sort_order` to `/api/search`  OR build a separate endpoint for metrics
- [ ] [BE] support permission check to show Edit definition in (…)
- [ ] Implement pagination on the “Browse metrics” page
```

### Milestone 3 — FE
Implemented in https://github.com/metabase/metabase/issues/46956

### Milestone 4 — BE+FE
```[tasklist]
- [ ] [BE] allow to change granularity and filter for metrics
- [ ] Allow to choose granularity and filter to calculate the value — in case of error not show the results
```

### Milestone 5 — BE+FE
```[tasklist]
- [ ] [BE] return metric data source name and data source type in search results
- [ ] Show data source name and type icon
```

### Milestone 6 — BE+FE
```[tasklist]
- [ ] Add text search input to the Browse metrics page
- [ ] [BE] Allow filtering by collections and data source ids in /api/search
- [ ] Add filtering dropdowns for source and collection
```

### Milestone 7 — BE+FE
```[tasklist]
- [ ] Sparklines — possibly reuse or customize current line chart implementation
```",romeovs,2024-09-09 16:47:46+00:00,[],2024-10-03 01:28:02+00:00,,https://github.com/metabase/metabase/issues/47777,"[('.Epic', 'Feature Implementation or Project'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2514416829,issue,closed,completed,wrong slice thickness when there are less rings due to slices being aggregated into other,"<img width=""1089"" alt=""Screenshot 2024-09-09 at 9 33 03 AM"" src=""https://github.com/user-attachments/assets/43ee79bf-beeb-4ba1-82f3-f36de685d1a3"">

This is normally a three ring chart, but since the minimum slice percentage is high, only one ring is rendered. We need to update the logic so that the slice thickness is not so large, it should be treated as if there is only one ring.",EmmadUsmani,2024-09-09 16:37:08+00:00,[],2024-09-20 22:48:13+00:00,2024-09-20 22:48:13+00:00,https://github.com/metabase/metabase/issues/47776,[],[],
2514416714,issue,closed,completed,wrong legend/mouse hover on other slice in inner ring when there are multiple rings,"<img width=""1250"" alt=""Screenshot 2024-09-09 at 9 31 01 AM"" src=""https://github.com/user-attachments/assets/f517723b-6aee-48dd-9496-a70ff645fdb4"">

Should focus the other slice in the inner ring, this bug happens both when hovering on the legend and on the slice itself",EmmadUsmani,2024-09-09 16:37:04+00:00,[],2024-09-18 21:18:15+00:00,2024-09-18 21:18:15+00:00,https://github.com/metabase/metabase/issues/47775,[],[],
2514184059,issue,open,,Track trashing of items in usage analytics/audit log,"**Is your feature request related to a problem? Please describe.**
If we track a ""card-update"" event in our audit log it would be pretty difficult to understand what was the change done to it (e.g. I want to see which cards were archived and who did that)

**Describe the solution you'd like**
Add the change that we did to the entity on the audit log (e.g. audit is archived=true)

**Describe alternatives you've considered**
None

**How important is this feature to you?**
There's a real pain here: let's say you don't find a card and you see it's archived: the only way to find who did that is either on the app db (checking the last ""card-update"" event), or unarchiving the card to see who did that and then archiving it again

**Additional context**
NA
",paoliniluis,2024-09-09 14:48:53+00:00,[],2025-02-04 20:30:26+00:00,,https://github.com/metabase/metabase/issues/47771,"[('Type:New Feature', ''), ('Administration/Usage analytics', 'Pro and Enterprise meta analytics, fka audit')]",[],
2514089692,issue,closed,completed,Lift tab state,"See https://metaboat.slack.com/archives/C0645JP1W81/p1725883604211259

Remove `keepMounted` prop from `TabsView` of `EntityPickerModal`. Refactor tab state to match the behavior.",kamilmielnik,2024-09-09 14:11:16+00:00,[],2024-10-02 12:48:27+00:00,2024-10-02 12:48:17+00:00,https://github.com/metabase/metabase/issues/47769,[],"[{'comment_id': 2388563936, 'issue_id': 2514089692, 'author': 'kamilmielnik', 'body': 'No longer relevant', 'created_at': datetime.datetime(2024, 10, 2, 12, 48, 17, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-10-02 12:48:17 UTC): No longer relevant

"
2514017296,issue,closed,completed,Handle settings set via environment variables,"```[tasklist]
### Tasks
- [ ] `enable-embedding` (old setting)
- [ ] `enable-embedding-sdk`
- [ ] `enable-embedding-static`
- [ ] `enable-embedding-interactive`
- [ ] `embedding-app-origin` (old setting)
- [ ] `embedding-app-origins-sdk`
- [ ] `embedding-app-origins-interactive`
```
",WiNloSt,2024-09-09 13:44:06+00:00,[],2024-10-10 19:42:58+00:00,2024-10-10 19:42:58+00:00,https://github.com/metabase/metabase/issues/47768,[],[],
2514012670,issue,closed,completed,Update copy/design,"- Add a beta flag to the SDK card
    ![image](https://github.com/user-attachments/assets/dcc3cbdc-1443-4214-9151-845129d47933)
- Add an API key banner in SDk settings page
    ![image](https://github.com/user-attachments/assets/9e1316ae-d794-42aa-81f8-1cec49f9e707)
- Add Try SDK CTA
    ![Screenshot 2024-09-09 at 8 52 05 PM](https://github.com/user-attachments/assets/d9e6c872-39ef-4dd4-8a02-c749e3e03c12)
- Add a doc link
    ![Screenshot 2024-09-09 at 8 52 57 PM](https://github.com/user-attachments/assets/4a14e7e2-43dd-4e08-a8da-7ef2f599aefb)
- Add an upsell banner (non Pro/EE)
    ![image](https://github.com/user-attachments/assets/65bc69ac-d42a-4f12-8036-4dd5cb997929)
- Add version pinning CTA for Pro cloud
    ![image](https://github.com/user-attachments/assets/6b08439e-9904-4810-adb8-42f033dc266e)",WiNloSt,2024-09-09 13:42:13+00:00,['WiNloSt'],2024-09-27 09:42:00+00:00,2024-09-27 09:42:00+00:00,https://github.com/metabase/metabase/issues/47767,[],"[{'comment_id': 2378876754, 'issue_id': 2514012670, 'author': 'oisincoveney', 'body': ""Closed with https://github.com/metabase/metabase/pull/47891. For some reason I wasn't able to directly link the branch on the sidebar."", 'created_at': datetime.datetime(2024, 9, 27, 9, 42, tzinfo=datetime.timezone.utc)}]","oisincoveney on (2024-09-27 09:42:00 UTC): Closed with https://github.com/metabase/metabase/pull/47891. For some reason I wasn't able to directly link the branch on the sidebar.

"
2514007405,issue,closed,completed,introduce `enable-embedding-static` and `enable-embedding-interactive`,"```[tasklist]
### Tasks
- [x] Adds toggle to embedding cards (static/interactive)
- [x] Add toggles to each individual settings page (static/interactive)
```
",WiNloSt,2024-09-09 13:40:01+00:00,['WiNloSt'],2024-09-12 14:54:51+00:00,2024-09-12 14:54:50+00:00,https://github.com/metabase/metabase/issues/47766,[],[],
2513510830,issue,closed,not_planned,Error During Migration from H2 to PostgreSQL: “Unable to connect to Metabase H2 DB”,"**Context**
Migration issues from H2 to PostgreSQL.

Hello Team,

Following the official documentation, I’m attempting to migrate my Metabase setup from H2 to PostgreSQL. I was using a Docker container for this process and took a backup of my H2 database before starting the migration.

When I run the migration command:
java -jar metabase.jar load-from-h2 /path/to/metabase.db

I encounter the following error:
clojure.lang.ExceptionInfo: ERROR Set up h2 source database and run migrations...: Unable to connect to Metabase h2 DB. {}
at metabase.cmd.copy$do_step$fn__100134.invoke(copy.clj:34)
at metabase.cmd.copy$do_step.invokeStatic(copy.clj:30)
at metabase.cmd.copy$do_step.invoke(copy.clj:28)
at metabase.cmd.copy$copy_BANG_.invokeStatic(copy.clj:393)
at metabase.cmd.copy$copy_BANG_.invoke(copy.clj:383)
at metabase.cmd.load_from_h2$load_from_h2_BANG_.invokeStatic(load_from_h2.clj:35)
at metabase.cmd.load_from_h2$load_from_h2_BANG_.invoke(load_from_h2.clj:25)
at clojure.lang.Var.invoke(Var.java:384)
at metabase.cmd$load_from_h2.invokeStatic(cmd.clj:74)
at metabase.cmd$load_from_h2.invoke(cmd.clj:68)
at clojure.lang.AFn.applyToHelper(AFn.java:154)
at clojure.lang.AFn.applyTo(AFn.java:144)
at clojure.core$apply.invokeStatic(core.clj:667)
at clojure.core$apply.invoke(core.clj:662)
at metabase.cmd$run_cmd$fn__107764.invoke(cmd.clj:313)
at metabase.cmd$run_cmd.invokeStatic(cmd.clj:310)
at metabase.cmd$run_cmd.invoke(cmd.clj:300)
at clojure.lang.Var.invoke(Var.java:393)
at metabase.core$run_cmd.invokeStatic(core.clj:193)
at metabase.core$run_cmd.invoke(core.clj:191)
at metabase.core$entrypoint.invokeStatic(core.clj:215)
at metabase.core$entrypoint.doInvoke(core.clj:210)
at clojure.lang.RestFn.applyTo(RestFn.java:137)
at clojure.lang.Var.applyTo(Var.java:705)
at clojure.core$apply.invokeStatic(core.clj:667)
at clojure.core$apply.invoke(core.clj:662)
at metabase.bootstrap$<em>main.invokeStatic(bootstrap.clj:31)
at metabase.bootstrap$<em>main.doInvoke(bootstrap.clj:28)
at clojure.lang.RestFn.applyTo(RestFn.java:137)
at metabase.bootstrap.main(Unknown Source)
Caused by: clojure.lang.ExceptionInfo: Unable to connect to Metabase h2 DB. {}
at metabase.db.setup$verify_db_connection$fn__53455.invoke(setup.clj:117)
at metabase.db.setup$verify_db_connection.invokeStatic(setup.clj:115)
at metabase.db.setup$verify_db_connection.invoke(setup.clj:107)
at metabase.db.setup$setup_db_BANG</em>$fn__53475$fn__53476.invoke(setup.clj:165)
at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)
at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)
at metabase.db.setup$setup_db_BANG</em>$fn__53475.invoke(setup.clj:161)
at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)
at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)
at metabase.cmd.copy$copy_BANG_$fn__100326.invoke(copy.clj:394)
at metabase.cmd.copy$do_step$fn__100134.invoke(copy.clj:31)
... 29 more
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database ""/home/metabase/metabase.db"" not found, and IFEXISTS=true, so we cant auto-create it [90146-214]
at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
at org.h2.message.DbException.get(DbException.java:223)
at org.h2.message.DbException.get(DbException.java:199)
at org.h2.engine.Engine.throwNotFound(Engine.java:186)
at org.h2.engine.Engine.openSession(Engine.java:72)
at org.h2.engine.Engine.openSession(Engine.java:222)
at org.h2.engine.Engine.createSession(Engine.java:201)
at org.h2.engine.SessionRemote.connectEmbeddedOrServer(SessionRemote.java:338)
at org.h2.jdbc.JdbcConnection.(JdbcConnection.java:122)
at org.h2.Driver.connect(Driver.java:59)
at java.sql/java.sql.DriverManager.getConnection(Unknown Source)
at java.sql/java.sql.DriverManager.getConnection(Unknown Source)
at metabase.db.data_source.DataSource.getConnection(data_source.clj:79)
at clojure.java.jdbc$get_connection.invokeStatic(jdbc.clj:372)
at clojure.java.jdbc$get_connection.invoke(jdbc.clj:274)
at clojure.java.jdbc$db_query_with_resultset_STAR_.invokeStatic(jdbc.clj:1111)
at clojure.java.jdbc$db_query_with_resultset_STAR_.invoke(jdbc.clj:1093)
at clojure.java.jdbc$query.invokeStatic(jdbc.clj:1182)
at clojure.java.jdbc$query.invoke(jdbc.clj:1144)
at clojure.java.jdbc$query.invokeStatic(jdbc.clj:1160)
at clojure.java.jdbc$query.invoke(jdbc.clj:1144)
at metabase.driver.sql_jdbc.connection$can_connect_with_spec_QMARK_.invokeStatic(connection.clj:349)
at metabase.driver.sql_jdbc.connection$can_connect_with_spec_QMARK_.invoke(connection.clj:346)
at clojure.lang.Var.invoke(Var.java:384)
at metabase.db.setup$verify_db_connection$fn__53455.invoke(setup.clj:115)
... 39 more
Command failed with exception: ERROR Set up h2 source database and run migrations...: Unable to connect to Metabase h2 DB.

It appears that Metabase cannot locate the H2 database file. I've confirmed that the file exists at the specified path and that Docker volumes are correctly set up. Despite this, the error persists.

Has anyone else encountered this issue or have any insights into what might be going wrong? I’d appreciate any guidance or solutions you might have!

Thank you!

",nb1907,2024-09-09 10:04:02+00:00,[],2024-09-10 05:34:30+00:00,2024-09-09 15:32:33+00:00,https://github.com/metabase/metabase/issues/47760,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]","[{'comment_id': 2337945815, 'issue_id': 2513510830, 'author': 'paoliniluis', 'body': ""99% of the times this happened it was due to permissions, what's the file permissions?"", 'created_at': datetime.datetime(2024, 9, 9, 12, 7, 6, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338160391, 'issue_id': 2513510830, 'author': 'nb1907', 'body': 'These are the file permissions that I have and also tried after changing it even though faced the same error. \r\n\r\n\r\nls -l /home/nitin/Downloads/metabase2.db/metabase2.db/metabase.db.mv.db\r\n-rw-r--r-- 1 nitin nitin 251797504 Sep  3 13:50 /home/nitin/Downloads/metabase2.db/metabase2.db/metabase.db.mv.db\r\n\r\n\r\nls -l /home/nitin/Downloads/metabase2.db/metabase2.db\r\n-rw-r--r-- 1 nitin nitin 251797504 Sep  3 13:50 metabase.db.mv.db\r\n-rw-r--r-- 1 nitin nitin    271295 Sep  5 11:27 metabase.db.trace.db', 'created_at': datetime.datetime(2024, 9, 9, 13, 40, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338441051, 'issue_id': 2513510830, 'author': 'paoliniluis', 'body': ""well... the logs say that we're looking for /home/metabase/metabase.db and you sent some paths that are different from that"", 'created_at': datetime.datetime(2024, 9, 9, 15, 32, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2339659666, 'issue_id': 2513510830, 'author': 'nb1907', 'body': 'Yes, you\'re right! but I tried with the right path and also created a separate folder for it even though I faced the similar error here is the complete information of the new folder from which I tried to migrate.\r\n\r\nCommands which I run for db_connection: \r\nexport MB_DB_TYPE=postgres\r\nexport MB_DB_CONNECTION_URI=""jdbc:postgresql://<host>:5432/metabase?user=<username>&password=<password>""\r\n\r\nCommands for migration which I run after successful db_connection:\r\njava -jar metabase.jar load-from-h2 /path/to/metabase.db \r\n\r\njava -jar metabase.jar load-from-h2 /home/nitin/metabase-data                   \r\n2024-09-10 10:55:46,512 INFO metabase.util :: Maximum memory available to JVM: 3.7 GB\r\n2024-09-10 10:55:49,262 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance. 🔓 \r\n For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html\r\n2024-09-10 10:55:55,254 INFO driver.impl :: Registered abstract driver :sql  🚚\r\n2024-09-10 10:55:55,280 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql]) 🚚\r\n2024-09-10 10:55:55,286 INFO metabase.util :: Load driver :sql-jdbc took 10.5 ms\r\n2024-09-10 10:55:55,286 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc]) 🚚\r\n2024-09-10 10:55:55,567 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc]) 🚚\r\n2024-09-10 10:55:55,609 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc]) 🚚\r\n2024-09-10 10:55:57,234 INFO metabase.core :: \r\nMetabase v0.50.23 (7040ff1) \r\n\r\nCopyright © 2024 Metabase, Inc. \r\n\r\nMetabase Enterprise Edition extensions are NOT PRESENT.\r\n2024-09-10 10:55:57,290 INFO driver.impl :: Registered abstract driver :metabase.driver.sql-jdbc.execute.legacy-impl/use-legacy-classes-for-read-and-set  🚚\r\n2024-09-10 10:55:57,295 INFO driver.impl :: Registered abstract driver :metabase.driver.sql.query-processor.empty-string-is-null/empty-string-is-null  🚚\r\n2024-09-10 10:55:57,597 INFO cmd.copy :: Set up h2 source database and run migrations... \r\n2024-09-10 10:55:57,598 INFO db.setup :: Verifying h2 Database Connection ...\r\n2024-09-10 10:55:57,635 ERROR cmd.copy :: [FAIL]\r\n\r\nclojure.lang.ExceptionInfo: ERROR Set up h2 source database and run migrations...: Unable to connect to Metabase h2 DB. {}\r\n\tat metabase.cmd.copy$do_step$fn__100127.invoke(copy.clj:34)\r\n\tat metabase.cmd.copy$do_step.invokeStatic(copy.clj:30)\r\n\tat metabase.cmd.copy$do_step.invoke(copy.clj:28)\r\n\tat metabase.cmd.copy$copy_BANG_.invokeStatic(copy.clj:392)\r\n\tat metabase.cmd.copy$copy_BANG_.invoke(copy.clj:382)\r\n\tat metabase.cmd.load_from_h2$load_from_h2_BANG_.invokeStatic(load_from_h2.clj:35)\r\n\tat metabase.cmd.load_from_h2$load_from_h2_BANG_.invoke(load_from_h2.clj:25)\r\n\tat clojure.lang.Var.invoke(Var.java:384)\r\n\tat metabase.cmd$load_from_h2.invokeStatic(cmd.clj:74)\r\n\tat metabase.cmd$load_from_h2.invoke(cmd.clj:68)\r\n\tat clojure.lang.AFn.applyToHelper(AFn.java:154)\r\n\tat clojure.lang.AFn.applyTo(AFn.java:144)\r\n\tat clojure.core$apply.invokeStatic(core.clj:667)\r\n\tat clojure.core$apply.invoke(core.clj:662)\r\n\tat metabase.cmd$run_cmd$fn__107778.invoke(cmd.clj:313)\r\n\tat metabase.cmd$run_cmd.invokeStatic(cmd.clj:310)\r\n\tat metabase.cmd$run_cmd.invoke(cmd.clj:300)\r\n\tat clojure.lang.Var.invoke(Var.java:393)\r\n\tat metabase.core$run_cmd.invokeStatic(core.clj:193)\r\n\tat metabase.core$run_cmd.invoke(core.clj:191)\r\n\tat metabase.core$entrypoint.invokeStatic(core.clj:215)\r\n\tat metabase.core$entrypoint.doInvoke(core.clj:210)\r\n\tat clojure.lang.RestFn.applyTo(RestFn.java:137)\r\n\tat clojure.lang.Var.applyTo(Var.java:705)\r\n\tat clojure.core$apply.invokeStatic(core.clj:667)\r\n\tat clojure.core$apply.invoke(core.clj:662)\r\n\tat metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)\r\n\tat metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)\r\n\tat clojure.lang.RestFn.applyTo(RestFn.java:137)\r\n\tat metabase.bootstrap.main(Unknown Source)\r\nCaused by: clojure.lang.ExceptionInfo: Unable to connect to Metabase h2 DB. {}\r\n\tat metabase.db.setup$verify_db_connection$fn__53175.invoke(setup.clj:117)\r\n\tat metabase.db.setup$verify_db_connection.invokeStatic(setup.clj:115)\r\n\tat metabase.db.setup$verify_db_connection.invoke(setup.clj:107)\r\n\tat metabase.db.setup$setup_db_BANG_$fn__53195$fn__53196.invoke(setup.clj:165)\r\n\tat metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)\r\n\tat metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)\r\n\tat metabase.db.setup$setup_db_BANG_$fn__53195.invoke(setup.clj:161)\r\n\tat metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)\r\n\tat metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)\r\n\tat metabase.cmd.copy$copy_BANG_$fn__100319.invoke(copy.clj:393)\r\n\tat metabase.cmd.copy$do_step$fn__100127.invoke(copy.clj:31)\r\n\t... 29 more\r\nCaused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database ""/home/nitin/metabase-data"" not found, and IFEXISTS=true, so we cant auto-create it [90146-214]\r\n\tat org.h2.message.DbException.getJdbcSQLException(DbException.java:678)\r\n\tat org.h2.message.DbException.getJdbcSQLException(DbException.java:477)\r\n\tat org.h2.message.DbException.get(DbException.java:223)\r\n\tat org.h2.message.DbException.get(DbException.java:199)\r\n\tat org.h2.engine.Engine.throwNotFound(Engine.java:186)\r\n\tat org.h2.engine.Engine.openSession(Engine.java:72)\r\n\tat org.h2.engine.Engine.openSession(Engine.java:222)\r\n\tat org.h2.engine.Engine.createSession(Engine.java:201)\r\n\tat org.h2.engine.SessionRemote.connectEmbeddedOrServer(SessionRemote.java:338)\r\n\tat org.h2.jdbc.JdbcConnection.<init>(JdbcConnection.java:122)\r\n\tat org.h2.Driver.connect(Driver.java:59)\r\n\tat java.sql/java.sql.DriverManager.getConnection(DriverManager.java:677)\r\n\tat java.sql/java.sql.DriverManager.getConnection(DriverManager.java:251)\r\n\tat metabase.db.data_source.DataSource.getConnection(data_source.clj:79)\r\n\tat clojure.java.jdbc$get_connection.invokeStatic(jdbc.clj:372)\r\n\tat clojure.java.jdbc$get_connection.invoke(jdbc.clj:274)\r\n\tat clojure.java.jdbc$db_query_with_resultset_STAR_.invokeStatic(jdbc.clj:1111)\r\n\tat clojure.java.jdbc$db_query_with_resultset_STAR_.invoke(jdbc.clj:1093)\r\n\tat clojure.java.jdbc$query.invokeStatic(jdbc.clj:1182)\r\n\tat clojure.java.jdbc$query.invoke(jdbc.clj:1144)\r\n\tat clojure.java.jdbc$query.invokeStatic(jdbc.clj:1160)\r\n\tat clojure.java.jdbc$query.invoke(jdbc.clj:1144)\r\n\tat metabase.driver.sql_jdbc.connection$can_connect_with_spec_QMARK_.invokeStatic(connection.clj:348)\r\n\tat metabase.driver.sql_jdbc.connection$can_connect_with_spec_QMARK_.invoke(connection.clj:345)\r\n\tat clojure.lang.Var.invoke(Var.java:384)\r\n\tat metabase.db.setup$verify_db_connection$fn__53175.invoke(setup.clj:115)\r\n\t... 39 more\r\nCommand failed with exception: ERROR Set up h2 source database and run migrations...: Unable to connect to Metabase h2 DB.\r\n\r\n\r\n\r\n\r\n\r\n\r\nI got a similar error and here I mentioned the permissions I have with these files and the location of the files where it exist already.\r\n\r\nls /home/nitin/metabase-data\r\nmetabase.db.mv.db  metabase.db.trace.db\r\n\r\n\r\nls -l /home/nitin/metabase-data\r\n-rw-r--r-- 1 nitin nitin 251797504 Sep  3 16:07 metabase.db.mv.db\r\n-rw-r--r-- 1 nitin nitin    266619 Sep  3 16:07 metabase.db.trace.db\r\n\r\n\r\nls -l /home/nitin/metabase-data/metabase.db.mv.db \r\n-rw-r--r-- 1 nitin nitin 251797504 Sep  3 16:07 /home/nitin/metabase-data/metabase.db.mv.db\r\n\r\n\r\nls -l /home/nitin/metabase-data/metabase.db.trace.db \r\n-rw-r--r-- 1 nitin nitin 266619 Sep  3 16:07 /home/nitin/metabase-data/metabase.db.trace.db', 'created_at': datetime.datetime(2024, 9, 10, 5, 34, 29, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-09 12:07:06 UTC): 99% of the times this happened it was due to permissions, what's the file permissions?

nb1907 (Issue Creator) on (2024-09-09 13:40:36 UTC): These are the file permissions that I have and also tried after changing it even though faced the same error. 


ls -l /home/nitin/Downloads/metabase2.db/metabase2.db/metabase.db.mv.db
-rw-r--r-- 1 nitin nitin 251797504 Sep  3 13:50 /home/nitin/Downloads/metabase2.db/metabase2.db/metabase.db.mv.db


ls -l /home/nitin/Downloads/metabase2.db/metabase2.db
-rw-r--r-- 1 nitin nitin 251797504 Sep  3 13:50 metabase.db.mv.db
-rw-r--r-- 1 nitin nitin    271295 Sep  5 11:27 metabase.db.trace.db

paoliniluis on (2024-09-09 15:32:33 UTC): well... the logs say that we're looking for /home/metabase/metabase.db and you sent some paths that are different from that

nb1907 (Issue Creator) on (2024-09-10 05:34:29 UTC): Yes, you're right! but I tried with the right path and also created a separate folder for it even though I faced the similar error here is the complete information of the new folder from which I tried to migrate.

Commands which I run for db_connection: 
export MB_DB_TYPE=postgres
export MB_DB_CONNECTION_URI=""jdbc:postgresql://<host>:5432/metabase?user=<username>&password=<password>""

Commands for migration which I run after successful db_connection:
java -jar metabase.jar load-from-h2 /path/to/metabase.db 

java -jar metabase.jar load-from-h2 /home/nitin/metabase-data                   
2024-09-10 10:55:46,512 INFO metabase.util :: Maximum memory available to JVM: 3.7 GB
2024-09-10 10:55:49,262 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance. 🔓 
 For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html
2024-09-10 10:55:55,254 INFO driver.impl :: Registered abstract driver :sql  🚚
2024-09-10 10:55:55,280 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql]) 🚚
2024-09-10 10:55:55,286 INFO metabase.util :: Load driver :sql-jdbc took 10.5 ms
2024-09-10 10:55:55,286 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc]) 🚚
2024-09-10 10:55:55,567 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc]) 🚚
2024-09-10 10:55:55,609 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc]) 🚚
2024-09-10 10:55:57,234 INFO metabase.core :: 
Metabase v0.50.23 (7040ff1) 

Copyright © 2024 Metabase, Inc. 

Metabase Enterprise Edition extensions are NOT PRESENT.
2024-09-10 10:55:57,290 INFO driver.impl :: Registered abstract driver :metabase.driver.sql-jdbc.execute.legacy-impl/use-legacy-classes-for-read-and-set  🚚
2024-09-10 10:55:57,295 INFO driver.impl :: Registered abstract driver :metabase.driver.sql.query-processor.empty-string-is-null/empty-string-is-null  🚚
2024-09-10 10:55:57,597 INFO cmd.copy :: Set up h2 source database and run migrations... 
2024-09-10 10:55:57,598 INFO db.setup :: Verifying h2 Database Connection ...
2024-09-10 10:55:57,635 ERROR cmd.copy :: [FAIL]

clojure.lang.ExceptionInfo: ERROR Set up h2 source database and run migrations...: Unable to connect to Metabase h2 DB. {}
	at metabase.cmd.copy$do_step$fn__100127.invoke(copy.clj:34)
	at metabase.cmd.copy$do_step.invokeStatic(copy.clj:30)
	at metabase.cmd.copy$do_step.invoke(copy.clj:28)
	at metabase.cmd.copy$copy_BANG_.invokeStatic(copy.clj:392)
	at metabase.cmd.copy$copy_BANG_.invoke(copy.clj:382)
	at metabase.cmd.load_from_h2$load_from_h2_BANG_.invokeStatic(load_from_h2.clj:35)
	at metabase.cmd.load_from_h2$load_from_h2_BANG_.invoke(load_from_h2.clj:25)
	at clojure.lang.Var.invoke(Var.java:384)
	at metabase.cmd$load_from_h2.invokeStatic(cmd.clj:74)
	at metabase.cmd$load_from_h2.invoke(cmd.clj:68)
	at clojure.lang.AFn.applyToHelper(AFn.java:154)
	at clojure.lang.AFn.applyTo(AFn.java:144)
	at clojure.core$apply.invokeStatic(core.clj:667)
	at clojure.core$apply.invoke(core.clj:662)
	at metabase.cmd$run_cmd$fn__107778.invoke(cmd.clj:313)
	at metabase.cmd$run_cmd.invokeStatic(cmd.clj:310)
	at metabase.cmd$run_cmd.invoke(cmd.clj:300)
	at clojure.lang.Var.invoke(Var.java:393)
	at metabase.core$run_cmd.invokeStatic(core.clj:193)
	at metabase.core$run_cmd.invoke(core.clj:191)
	at metabase.core$entrypoint.invokeStatic(core.clj:215)
	at metabase.core$entrypoint.doInvoke(core.clj:210)
	at clojure.lang.RestFn.applyTo(RestFn.java:137)
	at clojure.lang.Var.applyTo(Var.java:705)
	at clojure.core$apply.invokeStatic(core.clj:667)
	at clojure.core$apply.invoke(core.clj:662)
	at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
	at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
	at clojure.lang.RestFn.applyTo(RestFn.java:137)
	at metabase.bootstrap.main(Unknown Source)
Caused by: clojure.lang.ExceptionInfo: Unable to connect to Metabase h2 DB. {}
	at metabase.db.setup$verify_db_connection$fn__53175.invoke(setup.clj:117)
	at metabase.db.setup$verify_db_connection.invokeStatic(setup.clj:115)
	at metabase.db.setup$verify_db_connection.invoke(setup.clj:107)
	at metabase.db.setup$setup_db_BANG_$fn__53195$fn__53196.invoke(setup.clj:165)
	at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)
	at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)
	at metabase.db.setup$setup_db_BANG_$fn__53195.invoke(setup.clj:161)
	at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)
	at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)
	at metabase.cmd.copy$copy_BANG_$fn__100319.invoke(copy.clj:393)
	at metabase.cmd.copy$do_step$fn__100127.invoke(copy.clj:31)
	... 29 more
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database ""/home/nitin/metabase-data"" not found, and IFEXISTS=true, so we cant auto-create it [90146-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.engine.Engine.throwNotFound(Engine.java:186)
	at org.h2.engine.Engine.openSession(Engine.java:72)
	at org.h2.engine.Engine.openSession(Engine.java:222)
	at org.h2.engine.Engine.createSession(Engine.java:201)
	at org.h2.engine.SessionRemote.connectEmbeddedOrServer(SessionRemote.java:338)
	at org.h2.jdbc.JdbcConnection.<init>(JdbcConnection.java:122)
	at org.h2.Driver.connect(Driver.java:59)
	at java.sql/java.sql.DriverManager.getConnection(DriverManager.java:677)
	at java.sql/java.sql.DriverManager.getConnection(DriverManager.java:251)
	at metabase.db.data_source.DataSource.getConnection(data_source.clj:79)
	at clojure.java.jdbc$get_connection.invokeStatic(jdbc.clj:372)
	at clojure.java.jdbc$get_connection.invoke(jdbc.clj:274)
	at clojure.java.jdbc$db_query_with_resultset_STAR_.invokeStatic(jdbc.clj:1111)
	at clojure.java.jdbc$db_query_with_resultset_STAR_.invoke(jdbc.clj:1093)
	at clojure.java.jdbc$query.invokeStatic(jdbc.clj:1182)
	at clojure.java.jdbc$query.invoke(jdbc.clj:1144)
	at clojure.java.jdbc$query.invokeStatic(jdbc.clj:1160)
	at clojure.java.jdbc$query.invoke(jdbc.clj:1144)
	at metabase.driver.sql_jdbc.connection$can_connect_with_spec_QMARK_.invokeStatic(connection.clj:348)
	at metabase.driver.sql_jdbc.connection$can_connect_with_spec_QMARK_.invoke(connection.clj:345)
	at clojure.lang.Var.invoke(Var.java:384)
	at metabase.db.setup$verify_db_connection$fn__53175.invoke(setup.clj:115)
	... 39 more
Command failed with exception: ERROR Set up h2 source database and run migrations...: Unable to connect to Metabase h2 DB.






I got a similar error and here I mentioned the permissions I have with these files and the location of the files where it exist already.

ls /home/nitin/metabase-data
metabase.db.mv.db  metabase.db.trace.db


ls -l /home/nitin/metabase-data
-rw-r--r-- 1 nitin nitin 251797504 Sep  3 16:07 metabase.db.mv.db
-rw-r--r-- 1 nitin nitin    266619 Sep  3 16:07 metabase.db.trace.db


ls -l /home/nitin/metabase-data/metabase.db.mv.db 
-rw-r--r-- 1 nitin nitin 251797504 Sep  3 16:07 /home/nitin/metabase-data/metabase.db.mv.db


ls -l /home/nitin/metabase-data/metabase.db.trace.db 
-rw-r--r-- 1 nitin nitin 266619 Sep  3 16:07 /home/nitin/metabase-data/metabase.db.trace.db

"
2513288413,issue,open,,Visualization: Geographic Flow Maps,"hello, I would like to request the addition of Flow Maps as a new type of visualization in Metabase. Flow Maps are essential for representing movements or flows between different geographic locations, such as the movement of goods, people, or data. 

This type of visualization is commonly used to display migration patterns, traffic flow, or network connections across regions.

Thanks,
Marco.",csi-mboero,2024-09-09 08:33:05+00:00,[],2025-02-04 20:31:54+00:00,,https://github.com/metabase/metabase/issues/47758,"[('Type:New Feature', ''), ('Visualization/Maps', '')]","[{'comment_id': 2338004075, 'issue_id': 2513288413, 'author': 'paoliniluis', 'body': 'Please post an example and check if our new viz library supports it (echarts)', 'created_at': datetime.datetime(2024, 9, 9, 12, 34, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338732945, 'issue_id': 2513288413, 'author': 'csi-mboero', 'body': 'Here is an example of a representation of a map showing movement flows: \r\nhttps://appsource.microsoft.com/en-us/product/office/wa104380901?tab=overview\r\n\r\nThis link showcases a tool from Microsoft AppSource that visualizes movement patterns using flow maps. Flow maps typically display the movement of people, goods, or other variables between locations, with lines representing the direction and intensity of these flows. \r\n\r\nI think that the flow map chart is not supported by ECharts. Below is an old issue I found on GitHub: \r\nhttps://github.com/apache/echarts/issues/4603', 'created_at': datetime.datetime(2024, 9, 9, 17, 54, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2339053056, 'issue_id': 2513288413, 'author': 'paoliniluis', 'body': ""It would be a bit difficult to implement a new chart if our map library doesn't provide it in some way :("", 'created_at': datetime.datetime(2024, 9, 9, 20, 43, 49, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-09 12:34:02 UTC): Please post an example and check if our new viz library supports it (echarts)

csi-mboero (Issue Creator) on (2024-09-09 17:54:41 UTC): Here is an example of a representation of a map showing movement flows: 
https://appsource.microsoft.com/en-us/product/office/wa104380901?tab=overview

This link showcases a tool from Microsoft AppSource that visualizes movement patterns using flow maps. Flow maps typically display the movement of people, goods, or other variables between locations, with lines representing the direction and intensity of these flows. 

I think that the flow map chart is not supported by ECharts. Below is an old issue I found on GitHub: 
https://github.com/apache/echarts/issues/4603

paoliniluis on (2024-09-09 20:43:49 UTC): It would be a bit difficult to implement a new chart if our map library doesn't provide it in some way :(

"
2513214414,issue,open,,Tooltip Shows Wrong Data with 'Replace Missing Values with Zero' in Line Charts,"### Describe the bug

Using the ""Replace missing values with Zero"" option in line charts causes incorrect data to be shown in the tooltip. Instead of displaying the expected zero values, the tooltip displays values from other points in the series, which is misleading.



### To Reproduce

1. Create a line chart based on a time series with some missing data points.
2. In the chart's visualization settings, set ""Replace missing values with"" to ""Zero"".
3. Hover over the data points that should show zero in the chart.
4. Notice that the tooltip displays values from other data points, not the expected zero.

### Expected behavior

When hovering over points where the value is zero (because of missing data), the tooltip should display zero, not values from other points in the series.



### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""fr-FR"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.146.1-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""postgres""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-06-28"",
      ""tag"": ""v0.50.8"",
      ""hash"": ""dc9e68b""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

Is this annoying

### Additional context

Exemple:
![image](https://github.com/user-attachments/assets/1b2cbfb7-fbf5-4850-b84b-5ae4ca448238)

![image](https://github.com/user-attachments/assets/f5a08e54-7334-431a-8bbc-e3fd93cb75b2)

![image](https://github.com/user-attachments/assets/16f8fa94-8249-4ae7-a5e4-7121103a95e8)
",DieudonneCesar,2024-09-09 08:01:57+00:00,['alxnddr'],2025-02-04 20:29:56+00:00,,https://github.com/metabase/metabase/issues/47757,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2470235862, 'issue_id': 2513214414, 'author': 'DieudonneCesar', 'body': 'Any updates on this issue?', 'created_at': datetime.datetime(2024, 11, 12, 11, 4, 34, tzinfo=datetime.timezone.utc)}]","DieudonneCesar (Issue Creator) on (2024-11-12 11:04:34 UTC): Any updates on this issue?

"
2513107831,issue,closed,completed,E2E tests with CORS,[Figure out how to have Cypress tests with CORS](https://www.notion.so/metabase/Tech-Feature-flag-and-settings-for-SDK-9945e76d7e80404fa79b7d5b93049978?pvs=4#533141d5a1814677a8a23f7362865c2f),WiNloSt,2024-09-09 07:12:48+00:00,['WiNloSt'],2024-09-11 13:36:19+00:00,2024-09-11 13:36:19+00:00,https://github.com/metabase/metabase/issues/47754,[],[],
2512097056,issue,open,,Unable to set local timezone for MySQL queries,"### Describe the bug

I'm trying to run queries in my local timezone (To see my local time in the result and to be able to filter in the where clause as well)
First I tried this:
```sql
SET @@session.time_zone = ""-03:00"";
select now();
```
But I got an error when running this query.

Then I tried to change the settings to use the timezone America/Sao_Paulo, but when running select now() it displayed the time in UTC.

![image](https://github.com/user-attachments/assets/2ee7139f-245b-4981-abd1-e11e7ecd2b7c)


### To Reproduce

1. Connect to the MySQL database
2. Try to set the session timezone: `SET @@session.time_zone = ""-03:00"";`
4. This results in an error.
5. Alternatively, change the database settings to use the timezone ""America/Sao_Paulo""
6. Run the following query: `SELECT NOW();`
8. The result is still displayed in UTC time, not the expected local time (UTC-03:00).

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""pt-BR"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.8.8-4-pve"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""mysql""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-13"",
      ""tag"": ""v0.50.20"",
      ""hash"": ""df82d58""
    },
    ""settings"": {
      ""report-timezone"": ""America/Sao_Paulo""
    }
  }
}
```


### Severity

low

### Additional context

_No response_",gabrielpeixoto,2024-09-07 22:15:52+00:00,[],2025-02-04 20:28:43+00:00,,https://github.com/metabase/metabase/issues/47751,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Database/MySQL', None), ('Querying/Native', 'The SQL/native query editor'), ('.Team/Drivers', '')]","[{'comment_id': 2359699083, 'issue_id': 2512097056, 'author': 'qkzsky', 'body': ""I have also encountered this issue, and adding useTimezone=true&serverTimezone=Asia/Shanghai in the database JDBC does not work either. I hope that operations can be added after the database connection, allowing users to customize commands, such as SET time_zone = 'Asia/Shanghai'."", 'created_at': datetime.datetime(2024, 9, 19, 0, 58, 32, tzinfo=datetime.timezone.utc)}]","qkzsky on (2024-09-19 00:58:32 UTC): I have also encountered this issue, and adding useTimezone=true&serverTimezone=Asia/Shanghai in the database JDBC does not work either. I hope that operations can be added after the database connection, allowing users to customize commands, such as SET time_zone = 'Asia/Shanghai'.

"
2511285967,issue,open,,User-defined min/max values for X-Axis (similar to Y-Axis),"**Is your feature request related to a problem? Please describe.**
**Describe the solution you'd like**

Creating this feature request on behalf of a customer attempting to create a scatter plot where the X-Axis (non time series) will always span from 0 to 1. 
In their use case, they can have spans going from 0.02 - 0.4 or 0.52 to 0.94 and would like the scale to always be 0 to 1.


**Describe alternatives you've considered**
1. If the y-axis isn’t being utilized and manual min/max values are required for better control, consider swapping the data series between the x-axis and y-axis to achieve the desired format. 

2. Alternatively, placeholder or dummy data can be used to extend the series values, but this approach may not always produce the expected result and should be applied based on specific needs.""

**How important is this feature to you?**
N/A

",FilmonK,2024-09-06 22:45:30+00:00,[],2025-02-04 20:31:26+00:00,,https://github.com/metabase/metabase/issues/47746,"[('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Type:New Feature', ''), ('Visualization/Chart Settings', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.')]","[{'comment_id': 2336814409, 'issue_id': 2511285967, 'author': 'mariaorsolabenzoni', 'body': 'Thanks, very appreciated, would be great to find a way to implement this! The twoalternatives are not relaly valid options because:\r\n1. Y axis is used and the chart cannot really be flipped\r\n2. complicated to apply because of the implemented dashboard filters\r\nmany thanks', 'created_at': datetime.datetime(2024, 9, 8, 20, 26, 13, tzinfo=datetime.timezone.utc)}]","mariaorsolabenzoni on (2024-09-08 20:26:13 UTC): Thanks, very appreciated, would be great to find a way to implement this! The twoalternatives are not relaly valid options because:
1. Y axis is used and the chart cannot really be flipped
2. complicated to apply because of the implemented dashboard filters
many thanks

"
2511186386,issue,closed,completed,Not able to use existing tables and models as starting points for new questions,"### Describe the bug

We have a cloud customer that we updated to 1.50.24 and hasn't been able to use existing tables and models as starting points for new questions. We haven't been able to reproduce the issue on our end.

### To Reproduce


Create a new Question as you normally would by clicking on the New button, then click on Tables or Models.
Nothing is available and you encounter the following error making a call to the /api/search/?limit=&models=card endpoint.

<img width=""1582"" alt=""5"" src=""https://github.com/user-attachments/assets/a5b8768e-8040-40f6-bfe5-d7900ba4afe6"">

<br>
<br>

More details about the 500 error
<img width=""938"" alt=""6"" src=""https://github.com/user-attachments/assets/5bd57f14-0a0d-4f25-95d1-173d5ceb9df7"">

<br>
<br>

A call to the http://ncx.metabaseapp.com/api/search endpoint does work and returns a JSON, which I can provide independently from posting in this github issue.

### Expected behavior

For them to be able to use existing questions and models as starting points for new questions.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""internal"",
    ""version"": {
      ""date"": ""2024-09-04"",
      ""tag"": ""v1.50.24.2"",
      ""hash"": ""014582c""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres""
  }
}
```


### Severity

P1

### Additional context

_No response_",FilmonK,2024-09-06 20:59:19+00:00,[],2024-09-10 16:33:28+00:00,2024-09-10 16:33:28+00:00,https://github.com/metabase/metabase/issues/47741,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Needs Triage', '')]","[{'comment_id': 2334831792, 'issue_id': 2511186386, 'author': 'noahmoss', 'body': '@FilmonK Could they send the entire stack trace in the error response?', 'created_at': datetime.datetime(2024, 9, 6, 21, 25, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338227225, 'issue_id': 2511186386, 'author': 'FilmonK', 'body': ""> @FilmonK Could they send the entire stack trace in the error response?\r\n\r\n@noahmoss Will do. We let them know we can temporarily log into their environment and making sure they're good with that before proceeding."", 'created_at': datetime.datetime(2024, 9, 9, 14, 7, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338607240, 'issue_id': 2511186386, 'author': 'riazjahangir', 'body': '@FilmonK please don\'t share the JSON result of our /api/search endpoint -- it contains PII I will need to anonymize if it needs to be shared for debugging.\r\n\r\n@noahmoss the full error trace from https://ncx.metabaseapp.com/api/search?limit=0&models=card (made pretty) is:\r\n\r\n<details>\r\n<summary>expand to see stacktrace</summary>\r\n\r\n```javascript\r\n{\r\n  ""via"": [\r\n    {\r\n      ""type"": ""com.fasterxml.jackson.core.exc.StreamConstraintsException"",\r\n      ""message"": ""String value length (20051112) exceeds the maximum allowed (20000000, from `StreamReadConstraints.getMaxStringLength()`)"",\r\n      ""at"": [\r\n        ""com.fasterxml.jackson.core.StreamReadConstraints"",\r\n        ""_constructException"",\r\n        ""StreamReadConstraints.java"",\r\n        549\r\n      ]\r\n    }\r\n  ],\r\n  ""trace"": [\r\n    [\r\n      ""com.fasterxml.jackson.core.StreamReadConstraints"",\r\n      ""_constructException"",\r\n      ""StreamReadConstraints.java"",\r\n      549\r\n    ],\r\n    [\r\n      ""com.fasterxml.jackson.core.StreamReadConstraints"",\r\n      ""validateStringLength"",\r\n      ""StreamReadConstraints.java"",\r\n      484\r\n    ],\r\n    [\r\n      ""com.fasterxml.jackson.core.util.ReadConstrainedTextBuffer"",\r\n      ""validateStringLength"",\r\n      ""ReadConstrainedTextBuffer.java"",\r\n      27\r\n    ],\r\n    [\r\n      ""com.fasterxml.jackson.core.util.TextBuffer"",\r\n      ""finishCurrentSegment"",\r\n      ""TextBuffer.java"",\r\n      946\r\n    ],\r\n    [\r\n      ""com.fasterxml.jackson.core.json.ReaderBasedJsonParser"",\r\n      ""_finishString2"",\r\n      ""ReaderBasedJsonParser.java"",\r\n      2208\r\n    ],\r\n    [\r\n      ""com.fasterxml.jackson.core.json.ReaderBasedJsonParser"",\r\n      ""_finishString"",\r\n      ""ReaderBasedJsonParser.java"",\r\n      2174\r\n    ],\r\n    [\r\n      ""com.fasterxml.jackson.core.json.ReaderBasedJsonParser"",\r\n      ""getText"",\r\n      ""ReaderBasedJsonParser.java"",\r\n      295\r\n    ],\r\n    [\r\n      ""cheshire.parse$parse_STAR_"",\r\n      ""invokeStatic"",\r\n      ""parse.clj"",\r\n      67\r\n    ],\r\n    [\r\n      ""cheshire.parse$parse_STAR_"",\r\n      ""invoke"",\r\n      ""parse.clj"",\r\n      63\r\n    ],\r\n    [\r\n      ""cheshire.parse$parse_STAR_"",\r\n      ""invokeStatic"",\r\n      ""parse.clj"",\r\n      65\r\n    ],\r\n    [\r\n      ""cheshire.parse$parse_STAR_"",\r\n      ""invoke"",\r\n      ""parse.clj"",\r\n      63\r\n    ],\r\n    [\r\n      ""cheshire.parse$parse_STAR_"",\r\n      ""invokeStatic"",\r\n      ""parse.clj"",\r\n      65\r\n    ],\r\n    [\r\n      ""cheshire.parse$parse_STAR_"",\r\n      ""invoke"",\r\n      ""parse.clj"",\r\n      63\r\n    ],\r\n    [\r\n      ""cheshire.parse$parse"",\r\n      ""invokeStatic"",\r\n      ""parse.clj"",\r\n      100\r\n    ],\r\n    [\r\n      ""cheshire.parse$parse"",\r\n      ""invoke"",\r\n      ""parse.clj"",\r\n      88\r\n    ],\r\n    [\r\n      ""cheshire.core$parse_string"",\r\n      ""invokeStatic"",\r\n      ""core.clj"",\r\n      208\r\n    ],\r\n    [\r\n      ""cheshire.core$parse_string"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      194\r\n    ],\r\n    [\r\n      ""cheshire.core$parse_string"",\r\n      ""invokeStatic"",\r\n      ""core.clj"",\r\n      204\r\n    ],\r\n    [\r\n      ""cheshire.core$parse_string"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      194\r\n    ],\r\n    [\r\n      ""metabase.search.scoring$serialize$fn__100044"",\r\n      ""invoke"",\r\n      ""scoring.clj"",\r\n      329\r\n    ],\r\n    [\r\n      ""clojure.core$update"",\r\n      ""invokeStatic"",\r\n      ""core.clj"",\r\n      6232\r\n    ],\r\n    [\r\n      ""clojure.core$update"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      6224\r\n    ],\r\n    [\r\n      ""metabase.search.scoring$serialize"",\r\n      ""invokeStatic"",\r\n      ""scoring.clj"",\r\n      329\r\n    ],\r\n    [\r\n      ""metabase.search.scoring$serialize"",\r\n      ""invoke"",\r\n      ""scoring.clj"",\r\n      305\r\n    ],\r\n    [\r\n      ""clojure.core$map$fn__5935"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      2770\r\n    ],\r\n    [\r\n      ""clojure.lang.LazySeq"",\r\n      ""sval"",\r\n      ""LazySeq.java"",\r\n      42\r\n    ],\r\n    [\r\n      ""clojure.lang.LazySeq"",\r\n      ""seq"",\r\n      ""LazySeq.java"",\r\n      51\r\n    ],\r\n    [\r\n      ""clojure.lang.ChunkedCons"",\r\n      ""chunkedNext"",\r\n      ""ChunkedCons.java"",\r\n      59\r\n    ],\r\n    [\r\n      ""clojure.lang.ChunkedCons"",\r\n      ""next"",\r\n      ""ChunkedCons.java"",\r\n      43\r\n    ],\r\n    [\r\n      ""clojure.lang.RT"",\r\n      ""countFrom"",\r\n      ""RT.java"",\r\n      653\r\n    ],\r\n    [\r\n      ""clojure.lang.RT"",\r\n      ""count"",\r\n      ""RT.java"",\r\n      643\r\n    ],\r\n    [\r\n      ""metabase.api.search$search"",\r\n      ""invokeStatic"",\r\n      ""search.clj"",\r\n      542\r\n    ],\r\n    [\r\n      ""metabase.api.search$search"",\r\n      ""invoke"",\r\n      ""search.clj"",\r\n      504\r\n    ],\r\n    [\r\n      ""metabase.api.search$fn__101702"",\r\n      ""invokeStatic"",\r\n      ""search.clj"",\r\n      681\r\n    ],\r\n    [\r\n      ""metabase.api.search$fn__101702"",\r\n      ""invoke"",\r\n      ""search.clj"",\r\n      640\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_response$fn__52757"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      160\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_route_middleware$fn__52741"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      132\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_route_info$fn__52746"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      139\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_route_matches$fn__52750"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      151\r\n    ],\r\n    [\r\n      ""clojure.lang.Var"",\r\n      ""invoke"",\r\n      ""Var.java"",\r\n      393\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_route_matches$fn__52750"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      152\r\n    ],\r\n    [\r\n      ""clojure.lang.Var"",\r\n      ""invoke"",\r\n      ""Var.java"",\r\n      393\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.auth$enforce_authentication$fn__97896"",\r\n      ""invoke"",\r\n      ""auth.clj"",\r\n      18\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$handler__52797"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      290\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      300\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_route_matches$fn__52750"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      152\r\n    ],\r\n    [\r\n      ""clojure.lang.Var"",\r\n      ""invoke"",\r\n      ""Var.java"",\r\n      393\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      199\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      199\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      199\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""metabase.api.routes$fn__103549$fn__103550"",\r\n      ""invoke"",\r\n      ""routes.clj"",\r\n      70\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.lang.AFunction$1"",\r\n      ""doInvoke"",\r\n      ""AFunction.java"",\r\n      31\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyToHelper"",\r\n      ""AFn.java"",\r\n      160\r\n    ],\r\n    [\r\n      ""clojure.lang.AFn"",\r\n      ""applyTo"",\r\n      ""AFn.java"",\r\n      144\r\n    ],\r\n    [\r\n      ""clojure.core$apply"",\r\n      ""invokeStatic"",\r\n      ""core.clj"",\r\n      667\r\n    ],\r\n    [\r\n      ""clojure.core$apply"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      662\r\n    ],\r\n    [\r\n      ""metabase.server.routes$fn__103829$fn__103830"",\r\n      ""doInvoke"",\r\n      ""routes.clj"",\r\n      73\r\n    ],\r\n    [\r\n      ""clojure.lang.RestFn"",\r\n      ""invoke"",\r\n      ""RestFn.java"",\r\n      436\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$handler__52797"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      290\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      300\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_route_matches$fn__52750"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      153\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_route_matches$fn__52750"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      152\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_route_matches$fn__52750"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      152\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$wrap_route_matches$fn__52750"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      152\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      199\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      199\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      199\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$handler__52797"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      290\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      300\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      197\r\n    ],\r\n    [\r\n      ""compojure.core$make_context$fn__52801"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      301\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769$f__52770"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      198\r\n    ],\r\n    [\r\n      ""compojure.core$routes$fn__52769"",\r\n      ""invoke"",\r\n      ""core.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__99929"",\r\n      ""invoke"",\r\n      ""exceptions.clj"",\r\n      107\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.exceptions$catch_api_exceptions$fn__99926"",\r\n      ""invoke"",\r\n      ""exceptions.clj"",\r\n      96\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.log$log_api_call$fn__106186$fn__106187$fn__106188"",\r\n      ""invoke"",\r\n      ""log.clj"",\r\n      233\r\n    ],\r\n    [\r\n      ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",\r\n      ""invokeStatic"",\r\n      ""diagnostic.clj"",\r\n      18\r\n    ],\r\n    [\r\n      ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",\r\n      ""invoke"",\r\n      ""diagnostic.clj"",\r\n      12\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.log$log_api_call$fn__106186$fn__106187"",\r\n      ""invoke"",\r\n      ""log.clj"",\r\n      224\r\n    ],\r\n    [\r\n      ""toucan2.execute$do_with_call_counts"",\r\n      ""invokeStatic"",\r\n      ""execute.clj"",\r\n      112\r\n    ],\r\n    [\r\n      ""toucan2.execute$do_with_call_counts"",\r\n      ""invoke"",\r\n      ""execute.clj"",\r\n      103\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.log$log_api_call$fn__106186"",\r\n      ""invoke"",\r\n      ""log.clj"",\r\n      223\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__112391"",\r\n      ""invoke"",\r\n      ""browser_cookie.clj"",\r\n      40\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.security$add_security_headers$fn__99885"",\r\n      ""invoke"",\r\n      ""security.clj"",\r\n      240\r\n    ],\r\n    [\r\n      ""ring.middleware.json$wrap_json_body$fn__112650"",\r\n      ""invoke"",\r\n      ""json.clj"",\r\n      64\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.offset_paging$handle_paging$fn__88332"",\r\n      ""invoke"",\r\n      ""offset_paging.clj"",\r\n      42\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.json$wrap_streamed_json_response$fn__54341"",\r\n      ""invoke"",\r\n      ""json.clj"",\r\n      83\r\n    ],\r\n    [\r\n      ""ring.middleware.keyword_params$wrap_keyword_params$fn__112739"",\r\n      ""invoke"",\r\n      ""keyword_params.clj"",\r\n      55\r\n    ],\r\n    [\r\n      ""ring.middleware.params$wrap_params$fn__112758"",\r\n      ""invoke"",\r\n      ""params.clj"",\r\n      77\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.misc$maybe_set_site_url$fn__64081"",\r\n      ""invoke"",\r\n      ""misc.clj"",\r\n      59\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.session$reset_session_timeout$fn__65632"",\r\n      ""invoke"",\r\n      ""session.clj"",\r\n      548\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.session$bind_current_user$fn__65598$fn__65599"",\r\n      ""invoke"",\r\n      ""session.clj"",\r\n      443\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.session$do_with_current_user"",\r\n      ""invokeStatic"",\r\n      ""session.clj"",\r\n      422\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.session$do_with_current_user"",\r\n      ""invoke"",\r\n      ""session.clj"",\r\n      405\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.session$bind_current_user$fn__65598"",\r\n      ""invoke"",\r\n      ""session.clj"",\r\n      442\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.session$wrap_current_user_info$fn__65579"",\r\n      ""invoke"",\r\n      ""session.clj"",\r\n      381\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.session$wrap_session_id$fn__65551"",\r\n      ""invoke"",\r\n      ""session.clj"",\r\n      259\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.auth$wrap_static_api_key$fn__97904"",\r\n      ""invoke"",\r\n      ""auth.clj"",\r\n      32\r\n    ],\r\n    [\r\n      ""ring.middleware.cookies$wrap_cookies$fn__112578"",\r\n      ""invoke"",\r\n      ""cookies.clj"",\r\n      200\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.misc$add_content_type$fn__64063"",\r\n      ""invoke"",\r\n      ""misc.clj"",\r\n      28\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.misc$disable_streaming_buffering$fn__64089"",\r\n      ""invoke"",\r\n      ""misc.clj"",\r\n      75\r\n    ],\r\n    [\r\n      ""ring.middleware.gzip$wrap_gzip$fn__112620"",\r\n      ""invoke"",\r\n      ""gzip.clj"",\r\n      86\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.misc$bind_request$fn__64092"",\r\n      ""invoke"",\r\n      ""misc.clj"",\r\n      91\r\n    ],\r\n    [\r\n      ""metabase.server.middleware.ssl$redirect_to_https_middleware$fn__112407"",\r\n      ""invoke"",\r\n      ""ssl.clj"",\r\n      51\r\n    ],\r\n    [\r\n      ""metabase.server$async_proxy_handler$fn__71821"",\r\n      ""invoke"",\r\n      ""server.clj"",\r\n      77\r\n    ],\r\n    [\r\n      ""metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a"",\r\n      ""handle"",\r\n      null,\r\n      -1\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.server.handler.StatisticsHandler"",\r\n      ""handle"",\r\n      ""StatisticsHandler.java"",\r\n      173\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.server.handler.HandlerWrapper"",\r\n      ""handle"",\r\n      ""HandlerWrapper.java"",\r\n      122\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.server.Server"",\r\n      ""handle"",\r\n      ""Server.java"",\r\n      563\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.server.HttpChannel$RequestDispatchable"",\r\n      ""dispatch"",\r\n      ""HttpChannel.java"",\r\n      1598\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.server.HttpChannel"",\r\n      ""dispatch"",\r\n      ""HttpChannel.java"",\r\n      753\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.server.HttpChannel"",\r\n      ""handle"",\r\n      ""HttpChannel.java"",\r\n      501\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.server.HttpConnection"",\r\n      ""onFillable"",\r\n      ""HttpConnection.java"",\r\n      287\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.io.AbstractConnection$ReadCallback"",\r\n      ""succeeded"",\r\n      ""AbstractConnection.java"",\r\n      314\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.io.FillInterest"",\r\n      ""fillable"",\r\n      ""FillInterest.java"",\r\n      100\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.io.SelectableChannelEndPoint$1"",\r\n      ""run"",\r\n      ""SelectableChannelEndPoint.java"",\r\n      53\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\r\n      ""runTask"",\r\n      ""AdaptiveExecutionStrategy.java"",\r\n      421\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\r\n      ""consumeTask"",\r\n      ""AdaptiveExecutionStrategy.java"",\r\n      390\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\r\n      ""tryProduce"",\r\n      ""AdaptiveExecutionStrategy.java"",\r\n      277\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\r\n      ""run"",\r\n      ""AdaptiveExecutionStrategy.java"",\r\n      199\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread"",\r\n      ""run"",\r\n      ""ReservedThreadExecutor.java"",\r\n      411\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.util.thread.QueuedThreadPool"",\r\n      ""runJob"",\r\n      ""QueuedThreadPool.java"",\r\n      969\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",\r\n      ""doRunJob"",\r\n      ""QueuedThreadPool.java"",\r\n      1194\r\n    ],\r\n    [\r\n      ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",\r\n      ""run"",\r\n      ""QueuedThreadPool.java"",\r\n      1149\r\n    ],\r\n    [\r\n      ""java.lang.Thread"",\r\n      ""run"",\r\n      null,\r\n      -1\r\n    ]\r\n  ],\r\n  ""cause"": ""String value length (20051112) exceeds the maximum allowed (20000000, from `StreamReadConstraints.getMaxStringLength()`)"",\r\n  ""message"": ""String value length (20051112) exceeds the maximum allowed (20000000, from `StreamReadConstraints.getMaxStringLength()`)""\r\n}\r\n``` \r\n\r\n</details>', 'created_at': datetime.datetime(2024, 9, 9, 16, 51, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338643297, 'issue_id': 2511186386, 'author': 'ixipixi', 'body': '@riazjahangir I have an update for you I just shared in your ticket.', 'created_at': datetime.datetime(2024, 9, 9, 17, 11, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2341243005, 'issue_id': 2511186386, 'author': 'riazjahangir', 'body': 'Our issue is resolved; we had several questions with large (1000+ lines) raw queries. Seems like either this suddenly became a problem after our upgrade to 1.50.24, or else creating a few new small questions finally put us over the edge to make the result from /api/search too large.\r\n\r\nDeleting the questions with the largest `dataset_query` values got things back in working order.', 'created_at': datetime.datetime(2024, 9, 10, 15, 23, 9, tzinfo=datetime.timezone.utc)}]","noahmoss on (2024-09-06 21:25:17 UTC): @FilmonK Could they send the entire stack trace in the error response?

FilmonK (Issue Creator) on (2024-09-09 14:07:11 UTC): @noahmoss Will do. We let them know we can temporarily log into their environment and making sure they're good with that before proceeding.

riazjahangir on (2024-09-09 16:51:45 UTC): @FilmonK please don't share the JSON result of our /api/search endpoint -- it contains PII I will need to anonymize if it needs to be shared for debugging.

@noahmoss the full error trace from https://ncx.metabaseapp.com/api/search?limit=0&models=card (made pretty) is:

<details>
<summary>expand to see stacktrace</summary>

```javascript
{
  ""via"": [
    {
      ""type"": ""com.fasterxml.jackson.core.exc.StreamConstraintsException"",
      ""message"": ""String value length (20051112) exceeds the maximum allowed (20000000, from `StreamReadConstraints.getMaxStringLength()`)"",
      ""at"": [
        ""com.fasterxml.jackson.core.StreamReadConstraints"",
        ""_constructException"",
        ""StreamReadConstraints.java"",
        549
      ]
    }
  ],
  ""trace"": [
    [
      ""com.fasterxml.jackson.core.StreamReadConstraints"",
      ""_constructException"",
      ""StreamReadConstraints.java"",
      549
    ],
    [
      ""com.fasterxml.jackson.core.StreamReadConstraints"",
      ""validateStringLength"",
      ""StreamReadConstraints.java"",
      484
    ],
    [
      ""com.fasterxml.jackson.core.util.ReadConstrainedTextBuffer"",
      ""validateStringLength"",
      ""ReadConstrainedTextBuffer.java"",
      27
    ],
    [
      ""com.fasterxml.jackson.core.util.TextBuffer"",
      ""finishCurrentSegment"",
      ""TextBuffer.java"",
      946
    ],
    [
      ""com.fasterxml.jackson.core.json.ReaderBasedJsonParser"",
      ""_finishString2"",
      ""ReaderBasedJsonParser.java"",
      2208
    ],
    [
      ""com.fasterxml.jackson.core.json.ReaderBasedJsonParser"",
      ""_finishString"",
      ""ReaderBasedJsonParser.java"",
      2174
    ],
    [
      ""com.fasterxml.jackson.core.json.ReaderBasedJsonParser"",
      ""getText"",
      ""ReaderBasedJsonParser.java"",
      295
    ],
    [
      ""cheshire.parse$parse_STAR_"",
      ""invokeStatic"",
      ""parse.clj"",
      67
    ],
    [
      ""cheshire.parse$parse_STAR_"",
      ""invoke"",
      ""parse.clj"",
      63
    ],
    [
      ""cheshire.parse$parse_STAR_"",
      ""invokeStatic"",
      ""parse.clj"",
      65
    ],
    [
      ""cheshire.parse$parse_STAR_"",
      ""invoke"",
      ""parse.clj"",
      63
    ],
    [
      ""cheshire.parse$parse_STAR_"",
      ""invokeStatic"",
      ""parse.clj"",
      65
    ],
    [
      ""cheshire.parse$parse_STAR_"",
      ""invoke"",
      ""parse.clj"",
      63
    ],
    [
      ""cheshire.parse$parse"",
      ""invokeStatic"",
      ""parse.clj"",
      100
    ],
    [
      ""cheshire.parse$parse"",
      ""invoke"",
      ""parse.clj"",
      88
    ],
    [
      ""cheshire.core$parse_string"",
      ""invokeStatic"",
      ""core.clj"",
      208
    ],
    [
      ""cheshire.core$parse_string"",
      ""invoke"",
      ""core.clj"",
      194
    ],
    [
      ""cheshire.core$parse_string"",
      ""invokeStatic"",
      ""core.clj"",
      204
    ],
    [
      ""cheshire.core$parse_string"",
      ""invoke"",
      ""core.clj"",
      194
    ],
    [
      ""metabase.search.scoring$serialize$fn__100044"",
      ""invoke"",
      ""scoring.clj"",
      329
    ],
    [
      ""clojure.core$update"",
      ""invokeStatic"",
      ""core.clj"",
      6232
    ],
    [
      ""clojure.core$update"",
      ""invoke"",
      ""core.clj"",
      6224
    ],
    [
      ""metabase.search.scoring$serialize"",
      ""invokeStatic"",
      ""scoring.clj"",
      329
    ],
    [
      ""metabase.search.scoring$serialize"",
      ""invoke"",
      ""scoring.clj"",
      305
    ],
    [
      ""clojure.core$map$fn__5935"",
      ""invoke"",
      ""core.clj"",
      2770
    ],
    [
      ""clojure.lang.LazySeq"",
      ""sval"",
      ""LazySeq.java"",
      42
    ],
    [
      ""clojure.lang.LazySeq"",
      ""seq"",
      ""LazySeq.java"",
      51
    ],
    [
      ""clojure.lang.ChunkedCons"",
      ""chunkedNext"",
      ""ChunkedCons.java"",
      59
    ],
    [
      ""clojure.lang.ChunkedCons"",
      ""next"",
      ""ChunkedCons.java"",
      43
    ],
    [
      ""clojure.lang.RT"",
      ""countFrom"",
      ""RT.java"",
      653
    ],
    [
      ""clojure.lang.RT"",
      ""count"",
      ""RT.java"",
      643
    ],
    [
      ""metabase.api.search$search"",
      ""invokeStatic"",
      ""search.clj"",
      542
    ],
    [
      ""metabase.api.search$search"",
      ""invoke"",
      ""search.clj"",
      504
    ],
    [
      ""metabase.api.search$fn__101702"",
      ""invokeStatic"",
      ""search.clj"",
      681
    ],
    [
      ""metabase.api.search$fn__101702"",
      ""invoke"",
      ""search.clj"",
      640
    ],
    [
      ""compojure.core$wrap_response$fn__52757"",
      ""invoke"",
      ""core.clj"",
      160
    ],
    [
      ""compojure.core$wrap_route_middleware$fn__52741"",
      ""invoke"",
      ""core.clj"",
      132
    ],
    [
      ""compojure.core$wrap_route_info$fn__52746"",
      ""invoke"",
      ""core.clj"",
      139
    ],
    [
      ""compojure.core$wrap_route_matches$fn__52750"",
      ""invoke"",
      ""core.clj"",
      151
    ],
    [
      ""clojure.lang.Var"",
      ""invoke"",
      ""Var.java"",
      393
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__52750"",
      ""invoke"",
      ""core.clj"",
      152
    ],
    [
      ""clojure.lang.Var"",
      ""invoke"",
      ""Var.java"",
      393
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""metabase.server.middleware.auth$enforce_authentication$fn__97896"",
      ""invoke"",
      ""auth.clj"",
      18
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""compojure.core$make_context$handler__52797"",
      ""invoke"",
      ""core.clj"",
      290
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      300
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__52750"",
      ""invoke"",
      ""core.clj"",
      152
    ],
    [
      ""clojure.lang.Var"",
      ""invoke"",
      ""Var.java"",
      393
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      199
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      199
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      199
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""metabase.api.routes$fn__103549$fn__103550"",
      ""invoke"",
      ""routes.clj"",
      70
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.lang.AFunction$1"",
      ""doInvoke"",
      ""AFunction.java"",
      31
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""clojure.lang.AFn"",
      ""applyToHelper"",
      ""AFn.java"",
      160
    ],
    [
      ""clojure.lang.AFn"",
      ""applyTo"",
      ""AFn.java"",
      144
    ],
    [
      ""clojure.core$apply"",
      ""invokeStatic"",
      ""core.clj"",
      667
    ],
    [
      ""clojure.core$apply"",
      ""invoke"",
      ""core.clj"",
      662
    ],
    [
      ""metabase.server.routes$fn__103829$fn__103830"",
      ""doInvoke"",
      ""routes.clj"",
      73
    ],
    [
      ""clojure.lang.RestFn"",
      ""invoke"",
      ""RestFn.java"",
      436
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""compojure.core$make_context$handler__52797"",
      ""invoke"",
      ""core.clj"",
      290
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      300
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__52750"",
      ""invoke"",
      ""core.clj"",
      153
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__52750"",
      ""invoke"",
      ""core.clj"",
      152
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__52750"",
      ""invoke"",
      ""core.clj"",
      152
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__52750"",
      ""invoke"",
      ""core.clj"",
      152
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      199
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      199
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      199
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""compojure.core$make_context$handler__52797"",
      ""invoke"",
      ""core.clj"",
      290
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      300
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770$respond_SINGLEQUOTE___52771"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__52801"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""compojure.core$routes$fn__52769$f__52770"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__52769"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__99929"",
      ""invoke"",
      ""exceptions.clj"",
      107
    ],
    [
      ""metabase.server.middleware.exceptions$catch_api_exceptions$fn__99926"",
      ""invoke"",
      ""exceptions.clj"",
      96
    ],
    [
      ""metabase.server.middleware.log$log_api_call$fn__106186$fn__106187$fn__106188"",
      ""invoke"",
      ""log.clj"",
      233
    ],
    [
      ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",
      ""invokeStatic"",
      ""diagnostic.clj"",
      18
    ],
    [
      ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",
      ""invoke"",
      ""diagnostic.clj"",
      12
    ],
    [
      ""metabase.server.middleware.log$log_api_call$fn__106186$fn__106187"",
      ""invoke"",
      ""log.clj"",
      224
    ],
    [
      ""toucan2.execute$do_with_call_counts"",
      ""invokeStatic"",
      ""execute.clj"",
      112
    ],
    [
      ""toucan2.execute$do_with_call_counts"",
      ""invoke"",
      ""execute.clj"",
      103
    ],
    [
      ""metabase.server.middleware.log$log_api_call$fn__106186"",
      ""invoke"",
      ""log.clj"",
      223
    ],
    [
      ""metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__112391"",
      ""invoke"",
      ""browser_cookie.clj"",
      40
    ],
    [
      ""metabase.server.middleware.security$add_security_headers$fn__99885"",
      ""invoke"",
      ""security.clj"",
      240
    ],
    [
      ""ring.middleware.json$wrap_json_body$fn__112650"",
      ""invoke"",
      ""json.clj"",
      64
    ],
    [
      ""metabase.server.middleware.offset_paging$handle_paging$fn__88332"",
      ""invoke"",
      ""offset_paging.clj"",
      42
    ],
    [
      ""metabase.server.middleware.json$wrap_streamed_json_response$fn__54341"",
      ""invoke"",
      ""json.clj"",
      83
    ],
    [
      ""ring.middleware.keyword_params$wrap_keyword_params$fn__112739"",
      ""invoke"",
      ""keyword_params.clj"",
      55
    ],
    [
      ""ring.middleware.params$wrap_params$fn__112758"",
      ""invoke"",
      ""params.clj"",
      77
    ],
    [
      ""metabase.server.middleware.misc$maybe_set_site_url$fn__64081"",
      ""invoke"",
      ""misc.clj"",
      59
    ],
    [
      ""metabase.server.middleware.session$reset_session_timeout$fn__65632"",
      ""invoke"",
      ""session.clj"",
      548
    ],
    [
      ""metabase.server.middleware.session$bind_current_user$fn__65598$fn__65599"",
      ""invoke"",
      ""session.clj"",
      443
    ],
    [
      ""metabase.server.middleware.session$do_with_current_user"",
      ""invokeStatic"",
      ""session.clj"",
      422
    ],
    [
      ""metabase.server.middleware.session$do_with_current_user"",
      ""invoke"",
      ""session.clj"",
      405
    ],
    [
      ""metabase.server.middleware.session$bind_current_user$fn__65598"",
      ""invoke"",
      ""session.clj"",
      442
    ],
    [
      ""metabase.server.middleware.session$wrap_current_user_info$fn__65579"",
      ""invoke"",
      ""session.clj"",
      381
    ],
    [
      ""metabase.server.middleware.session$wrap_session_id$fn__65551"",
      ""invoke"",
      ""session.clj"",
      259
    ],
    [
      ""metabase.server.middleware.auth$wrap_static_api_key$fn__97904"",
      ""invoke"",
      ""auth.clj"",
      32
    ],
    [
      ""ring.middleware.cookies$wrap_cookies$fn__112578"",
      ""invoke"",
      ""cookies.clj"",
      200
    ],
    [
      ""metabase.server.middleware.misc$add_content_type$fn__64063"",
      ""invoke"",
      ""misc.clj"",
      28
    ],
    [
      ""metabase.server.middleware.misc$disable_streaming_buffering$fn__64089"",
      ""invoke"",
      ""misc.clj"",
      75
    ],
    [
      ""ring.middleware.gzip$wrap_gzip$fn__112620"",
      ""invoke"",
      ""gzip.clj"",
      86
    ],
    [
      ""metabase.server.middleware.misc$bind_request$fn__64092"",
      ""invoke"",
      ""misc.clj"",
      91
    ],
    [
      ""metabase.server.middleware.ssl$redirect_to_https_middleware$fn__112407"",
      ""invoke"",
      ""ssl.clj"",
      51
    ],
    [
      ""metabase.server$async_proxy_handler$fn__71821"",
      ""invoke"",
      ""server.clj"",
      77
    ],
    [
      ""metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a"",
      ""handle"",
      null,
      -1
    ],
    [
      ""org.eclipse.jetty.server.handler.StatisticsHandler"",
      ""handle"",
      ""StatisticsHandler.java"",
      173
    ],
    [
      ""org.eclipse.jetty.server.handler.HandlerWrapper"",
      ""handle"",
      ""HandlerWrapper.java"",
      122
    ],
    [
      ""org.eclipse.jetty.server.Server"",
      ""handle"",
      ""Server.java"",
      563
    ],
    [
      ""org.eclipse.jetty.server.HttpChannel$RequestDispatchable"",
      ""dispatch"",
      ""HttpChannel.java"",
      1598
    ],
    [
      ""org.eclipse.jetty.server.HttpChannel"",
      ""dispatch"",
      ""HttpChannel.java"",
      753
    ],
    [
      ""org.eclipse.jetty.server.HttpChannel"",
      ""handle"",
      ""HttpChannel.java"",
      501
    ],
    [
      ""org.eclipse.jetty.server.HttpConnection"",
      ""onFillable"",
      ""HttpConnection.java"",
      287
    ],
    [
      ""org.eclipse.jetty.io.AbstractConnection$ReadCallback"",
      ""succeeded"",
      ""AbstractConnection.java"",
      314
    ],
    [
      ""org.eclipse.jetty.io.FillInterest"",
      ""fillable"",
      ""FillInterest.java"",
      100
    ],
    [
      ""org.eclipse.jetty.io.SelectableChannelEndPoint$1"",
      ""run"",
      ""SelectableChannelEndPoint.java"",
      53
    ],
    [
      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
      ""runTask"",
      ""AdaptiveExecutionStrategy.java"",
      421
    ],
    [
      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
      ""consumeTask"",
      ""AdaptiveExecutionStrategy.java"",
      390
    ],
    [
      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
      ""tryProduce"",
      ""AdaptiveExecutionStrategy.java"",
      277
    ],
    [
      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
      ""run"",
      ""AdaptiveExecutionStrategy.java"",
      199
    ],
    [
      ""org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread"",
      ""run"",
      ""ReservedThreadExecutor.java"",
      411
    ],
    [
      ""org.eclipse.jetty.util.thread.QueuedThreadPool"",
      ""runJob"",
      ""QueuedThreadPool.java"",
      969
    ],
    [
      ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",
      ""doRunJob"",
      ""QueuedThreadPool.java"",
      1194
    ],
    [
      ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",
      ""run"",
      ""QueuedThreadPool.java"",
      1149
    ],
    [
      ""java.lang.Thread"",
      ""run"",
      null,
      -1
    ]
  ],
  ""cause"": ""String value length (20051112) exceeds the maximum allowed (20000000, from `StreamReadConstraints.getMaxStringLength()`)"",
  ""message"": ""String value length (20051112) exceeds the maximum allowed (20000000, from `StreamReadConstraints.getMaxStringLength()`)""
}
``` 

</details>

ixipixi on (2024-09-09 17:11:03 UTC): @riazjahangir I have an update for you I just shared in your ticket.

riazjahangir on (2024-09-10 15:23:09 UTC): Our issue is resolved; we had several questions with large (1000+ lines) raw queries. Seems like either this suddenly became a problem after our upgrade to 1.50.24, or else creating a few new small questions finally put us over the edge to make the result from /api/search too large.

Deleting the questions with the largest `dataset_query` values got things back in working order.

"
2511009729,issue,closed,completed,Cannot use window functions with metrics,"### Describe the bug

""Compare to the past"" aggregation options lead to query errors.

### To Reproduce

1. New -> Metric -> Orders -> Save
2. Show editor -> In Summarize click Plus -> Compare to the past -> Done
3. Visualize
4. See the query error

```
Invalid output: {:query {:aggregation [nil [nil nil [""valid instance of one of these MBQL clauses: :expression, :field, got: [:aggregation-options [:count] {:name \""Orders, Count\""}]"" ""valid instance of one of these MBQL clauses: :avg, :cum-sum, :distinct, :stddev, :sum, :min, :max, :metric, :share, :count-where, :sum-where, :case, :median, :percentile, :var, :cum-count, :count, :offset, got: [:aggregation-options [:count] {:name \""Orders, Count\""}]""]] [nil [nil [nil nil [nil nil [""valid instance of one of these MBQL clauses: :expression, :field, got: [:aggregation-options [:count] {:name \""Orders, Count\""}]"" ""valid instance of one of these MBQL clauses: :avg, :cum-sum, :distinct, :stddev, :sum, :min, :max, :metric, :share, :count-where, :sum-where, :case, :median, :percentile, :var, :cum-count, :count, :offset, got: [:aggregation-options [:count] {:name \""Orders, Count\""}]""]]]]]]}}
```

### Expected behavior

I should be able to use window functions with metrics

### Logs

_No response_

### Information about your Metabase installation

```JSON
Date: 2024-09-06
Commit: 38dcee8
Version: Pre-0.51
```


### Severity

P1

### Additional context

_No response_",ranquild,2024-09-06 18:46:37+00:00,['metamben'],2024-09-12 14:59:24+00:00,2024-09-10 22:34:48+00:00,https://github.com/metabase/metabase/issues/47735,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]",[],
2510972755,issue,open,,Cannot toggle join fields for a question that has multiple breakouts,"### Describe the bug

When a question used for a join has multiple breakouts of the same column, is not possible to toggle columns on and off.

### To Reproduce

1. New -> Question -> Sample DB -> Orders
2. Aggregate by Count, Breakout by Created At: Month, Created At: Year -> Save as Q1
3. New -> Question -> Select Orders
4. Join -> Questions -> Select Q1 -> On Orders.ID = Q1.Count
5. Visualize
6. Open the viz settings sidebar (Gear icon in the bottom left corner) -> Add or remove columns
7. Try to toggle Created At columns from Q1 on and off


### Expected behavior

It should be possible to add/remove join fields; the `:selected` property should be correct.

The root cause seems to be that `lib.ref/ref` returns a field id-based field ref in this case that would be fully identical for these columns.

### Logs

`Multiple plausible matches with the same :join-alias - more disambiguation needed`

### Information about your Metabase installation

```JSON
Date: 2024-09-06
Commit: 38dcee8
Version: Pre-0.51
```


### Severity

P2

### Additional context

_No response_",ranquild,2024-09-06 18:18:59+00:00,[],2025-02-04 20:27:18+00:00,,https://github.com/metabase/metabase/issues/47734,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/MBQL', ''), ('.Backend', ''), ('.Team/Querying', '')]",[],
2510958440,issue,open,,Field values remapping and composite PKs (as in Dashboard ID filter of Metabase Analytics / Dashboard overview),"### Describe the bug

The dashboard ID filter in Metabase Analytics / Dashboard overview occasionally displays incorrect names, such as the name of a collection or a question instead of the name of the dashboard.

### To Reproduce

1. Go to Metabase Analytics / Dashboard Overview
2. Enter IDs of existing dashboards in the dashoard id filter (try entering small numbers)
3. In the filter widget,  an incorrect name will be displayed occasionally. Instead of the dashboards name, a name of a collection or a question with the same ID will be shown.

An example, here the correct name should be 'NewDashboard', the name displayed in the filter belongs to a question.
<img width=""797"" alt=""image"" src=""https://github.com/user-attachments/assets/354cac71-558c-4f60-bb7d-91ce97ce62dc"">

### Expected behavior

The filter should always show the name of the dashboard with the selected id.

### Logs

_No response_

### Information about your Metabase installation

```JSON
1.50.24.2
```


### Severity

Minor -  noticed by a customer

### Additional context

_No response_",zbodi74,2024-09-06 18:08:34+00:00,[],2025-02-04 20:31:02+00:00,,https://github.com/metabase/metabase/issues/47733,"[('Type:New Feature', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Frontend', ''), ('Administration/Usage analytics', 'Pro and Enterprise meta analytics, fka audit'), ('.Team/Querying', '')]","[{'comment_id': 2607283526, 'issue_id': 2510958440, 'author': 'luizarakaki', 'body': ""This is a querying issue. The dashboard filter label is naive and doens't work well in dynamic situantions like this (the source table has duplicates of ID numbers, as it contains questions, dashboards, tables etc)"", 'created_at': datetime.datetime(2025, 1, 22, 13, 41, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2607487075, 'issue_id': 2510958440, 'author': 'ranquild', 'body': 'Marking as a frontend issue for now to investigate this further.', 'created_at': datetime.datetime(2025, 1, 22, 15, 2, 50, tzinfo=datetime.timezone.utc)}, {'comment_id': 2617767241, 'issue_id': 2510958440, 'author': 'ranquild', 'body': '@luizarakaki this cannot work correctly now. Essentially in the `Content` model `Entity ID` is not a unique key; `Entity ID` + `Entity Type` is a composite primary key. FK to PK field remapping only works for non-composite keys.', 'created_at': datetime.datetime(2025, 1, 28, 3, 26, 31, tzinfo=datetime.timezone.utc)}]","luizarakaki on (2025-01-22 13:41:56 UTC): This is a querying issue. The dashboard filter label is naive and doens't work well in dynamic situantions like this (the source table has duplicates of ID numbers, as it contains questions, dashboards, tables etc)

ranquild on (2025-01-22 15:02:50 UTC): Marking as a frontend issue for now to investigate this further.

ranquild on (2025-01-28 03:26:31 UTC): @luizarakaki this cannot work correctly now. Essentially in the `Content` model `Entity ID` is not a unique key; `Entity ID` + `Entity Type` is a composite primary key. FK to PK field remapping only works for non-composite keys.

"
2510552362,issue,open,,"Time series metric — last value (latest value), tooltip: latest breakout value",,romeovs,2024-09-06 14:18:29+00:00,[],2024-09-06 14:18:29+00:00,,https://github.com/metabase/metabase/issues/47726,[],[],
2510312181,issue,open,,Database path getting lost when accessing Question/Table from URL,"### Describe the bug

Database path getting lost when accessing Question/Table from URL. Only visible in the UI when playing with a question or table. Easier to see the replication below

### To Reproduce

Use stats

1. Then go to New -> Question -> Analytics Datawarehouse -> Uploads -> Select any table ... Notice this int he UI:

<img width=""779"" alt=""image"" src=""https://github.com/user-attachments/assets/ca7e5f8b-8872-43f8-a2a9-4de2787dac97"">


2. Save this question and you will still notice the full Table path after you save:

<img width=""1512"" alt=""image"" src=""https://github.com/user-attachments/assets/bd47924f-dab6-45e2-9eb6-e324ecbfcdab"">

3. Now copy the URL and paste it in a new tab or go to the main menu and find again this question:

<img width=""1512"" alt=""image"" src=""https://github.com/user-attachments/assets/1b1b9449-b4f3-4969-ad42-ba40b43f3eb1"">

The schema path gets lost and this also happens if the question isn't saved and you select a table from the browse data:

<img width=""789"" alt=""image"" src=""https://github.com/user-attachments/assets/9b703ddc-b815-49d2-9a40-1d8cb0546e54"">

Then copy the large URL that appears and paste it again in a new tab (or same tab)

<img width=""1512"" alt=""image"" src=""https://github.com/user-attachments/assets/34c53bdc-aa6d-4471-9a07-74a272b39e90"">


### Expected behavior

The full path remains there

### Logs

None that are relevant

### Information about your Metabase installation

```JSON
Both 50.24 and master
```


### Severity

Annoying 

### Additional context

_No response_",Tony-metabase,2024-09-06 12:22:19+00:00,[],2025-02-05 19:24:38+00:00,,https://github.com/metabase/metabase/issues/47715,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Correctness', ''), ('Organization/Collections', ''), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('Organization/Uploads', 'Direct data upload (CSV)')]",[],
2510261495,issue,closed,not_planned,Querys buggeadas,"**Describe the bug**
We have a problem with queries that is still being processed. We cut off the process and they start again but we do not find them in any dashboard. These are: 

SELECT ""history"".""sales_ticket"".""document_type_id"" AS ""document_type_id"" FROM ""history"".""sales_ticket"" GROUP BY ""history"".""sales_ticket"".""document_type_id"" ORDER BY ""history"".""sales_ticket"".""document_type_id"" ASC LIMIT 1000

SELECT ""history"".""sales_ticket_details"".""unit_of_measure_code"" AS ""unit_of_measure_code"" 
FROM ""history"".""sales_ticket_details"" 
GROUP BY ""history"".""sales_ticket_details"".""unit_of_measure_code"" 
ORDER BY ""history"".""sales_ticket_details"".""unit_of_measure_code"" 
ASC LIMIT 1000

SELECT ""history"".""sales_ticket"".""loyalty_program_code"" AS ""loyalty_program_code"" 
FROM ""history"".""sales_ticket"" 
GROUP BY ""history"".""sales_ticket"".""loyalty_program_code"" 
ORDER BY ""history"".""sales_ticket"".""loyalty_program_code"" ASC 
LIMIT 1000

SELECT ""history"".""sales_ticket"".""is_deleted"" AS ""is_deleted"" 
FROM ""history"".""sales_ticket"" 
GROUP BY ""history"".""sales_ticket"".""is_deleted"" 
ORDER BY ""history"".""sales_ticket"".""is_deleted"" ASC 
LIMIT 1000


**To Reproduce**
Steps to reproduce the behavior:
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

**Expected behavior**
We need to find the queries to delete them

**Severity**
It´s a severe issue, is a bug to us, because block the entire database for our customers.
",epacheco90,2024-09-06 11:53:59+00:00,[],2024-09-06 12:46:14+00:00,2024-09-06 12:46:14+00:00,https://github.com/metabase/metabase/issues/47714,[],"[{'comment_id': 2333975230, 'issue_id': 2510261495, 'author': 'paoliniluis', 'body': 'Please disable field values (settings-> admin->databases -> advanced settings in your database + disable all linked filter and also set all field to “input box”', 'created_at': datetime.datetime(2024, 9, 6, 12, 46, 14, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-06 12:46:14 UTC): Please disable field values (settings-> admin->databases -> advanced settings in your database + disable all linked filter and also set all field to “input box”

"
2510256040,issue,closed,completed,Add analytics events,,romeovs,2024-09-06 11:50:51+00:00,[],2024-09-11 12:04:37+00:00,2024-09-11 12:04:37+00:00,https://github.com/metabase/metabase/issues/47713,[],"[{'comment_id': 2343481921, 'issue_id': 2510256040, 'author': 'romeovs', 'body': ""From a Slack discussion with @Somtom: \r\n> The page views should cover it. In case there is special navigation that will not change the route, then we might need to think about it but for now it could be save to only use page views I guess.\r\n\r\nWe don't need to add custom analytics events for now."", 'created_at': datetime.datetime(2024, 9, 11, 12, 4, 37, tzinfo=datetime.timezone.utc)}]","romeovs (Issue Creator) on (2024-09-11 12:04:37 UTC): From a Slack discussion with @Somtom: 

We don't need to add custom analytics events for now.

"
2508952506,issue,closed,completed,Public Actions Fail,"### Describe the bug

Public actions fail with ""An error occurred"".

### To Reproduce

1. Set up a simple test table in Postgres
`CREATE TABLE test_table (
    ID SERIAL PRIMARY KEY,
    NAME VARCHAR(50)
);

INSERT INTO test_table (NAME)
VALUES 
    ('Alice'),  
    ('Ivan'),
    ('Judy');`
2. In Metabase create a model on this table
3. Add an action
`UPDATE test_table
SET NAME = {{newName}}
WHERE ID = {{id}};`
4. Test the action to confirm it works
5. Publish the action
6. Navigate to the public link for the action
7. Test the action and see that it fails



### Expected behavior

Public actions should work

### Logs

400 Bad Request response on the post request:

http://localhost:15023/api/public/action/ba5262f7-f0d6-41c1-af03-822837bc5bb1/execute


### Information about your Metabase installation

```JSON
v50.23
```


### Severity

Blocking some users

### Additional context

https://www.loom.com/share/d62b408926e84fcabe2f7daff746c4d3",ixipixi,2024-09-05 22:47:19+00:00,['noahmoss'],2024-10-01 22:15:40+00:00,2024-09-06 21:14:06+00:00,https://github.com/metabase/metabase/issues/47704,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Administration/Permissions', 'Collection or Data permissions'), ('Querying/Actions', ''), ('.Escalation', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2332967724, 'issue_id': 2508952506, 'author': 'perivamsi', 'body': '@ixipixi can you try opening the link in a normal browser tab, not in incognito mode?', 'created_at': datetime.datetime(2024, 9, 6, 0, 42, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2332993662, 'issue_id': 2508952506, 'author': 'ixipixi', 'body': '@perivamsi it still fails', 'created_at': datetime.datetime(2024, 9, 6, 1, 16, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2332997130, 'issue_id': 2508952506, 'author': 'ixipixi', 'body': ""I did just notice that it still works if you open the public link from a browser where you're already authenticated. Might be a helpful detail for anyone else trying to reproduce this!"", 'created_at': datetime.datetime(2024, 9, 6, 1, 21, 7, tzinfo=datetime.timezone.utc)}]","perivamsi on (2024-09-06 00:42:32 UTC): @ixipixi can you try opening the link in a normal browser tab, not in incognito mode?

ixipixi (Issue Creator) on (2024-09-06 01:16:34 UTC): @perivamsi it still fails

ixipixi (Issue Creator) on (2024-09-06 01:21:07 UTC): I did just notice that it still works if you open the public link from a browser where you're already authenticated. Might be a helpful detail for anyone else trying to reproduce this!

"
2508663710,issue,closed,completed,[FE] Remove compare aggregations from notebook for metrics,,ranquild,2024-09-05 20:34:42+00:00,['ranquild'],2024-10-08 16:15:15+00:00,2024-09-06 20:40:15+00:00,https://github.com/metabase/metabase/issues/47701,[],[],
2508417929,issue,closed,completed,Column info popover is getting in my way too often,"### Describe the bug

When I hover column header the column info popover is shown immediately
When I click column header first the column info popover flickers and then the modal is opened
https://www.loom.com/share/b0fa10a94b454bd492ec22f43b6bd2b9
https://www.loom.com/share/6c193fbb2b4b4b44b3811a81325c8117

### To Reproduce

1. Open any table
2. Hover a column header, you'll see the popover right away
3. Click on a column header, you'll first see the popover flickering


### Expected behavior

Column info popover should be shown only when you keep the mouse over the column header for a while, like 500 ms?
It should not flicker on click

### Logs

_No response_

### Information about your Metabase installation

```JSON
9f706d5
```


### Severity

Annoying

### Additional context

_No response_",mngr,2024-09-05 18:01:51+00:00,['romeovs'],2024-10-22 10:17:28+00:00,2024-10-22 06:32:15+00:00,https://github.com/metabase/metabase/issues/47694,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', ''), ('Frequency:Often', 'Something users bump into often')]",[],
2508313730,issue,closed,completed,Replace legacy MBQL queries in the sdk in StaticQuestion,"We should get rid of the use of [legacy MBQL queries](https://github.com/metabase/metabase/blob/c2b7cc9e807ee75d2bc94f0b5a814e01d29fd077/enterprise/frontend/src/embedding-sdk/components/public/StaticQuestion/StaticQuestion.tsx#L134) in StaticQuestion.

```ts
const legacyQuery = question.legacyQuery({
  useStructuredQuery: true,
});
```

[See the note in this channel](https://metaboat.slack.com/archives/C0645JP1W81/p1725554873732219) for more information on how to replace it.",heypoom,2024-09-05 17:02:12+00:00,['heypoom'],2024-10-08 16:15:09+00:00,2024-09-09 11:21:18+00:00,https://github.com/metabase/metabase/issues/47690,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2508245277,issue,open,,Update migration id format -- add support for optional suffix in migration IDs. Drop time?,This came up in guild sync today -- migration names are just version number + timestamp right now which is good for ordering and uniqueness but bad for readability -- can we add support for arbitrary names at the end of the version to make them more readable?,camsaul,2024-09-05 16:26:41+00:00,[],2025-02-04 20:26:30+00:00,,https://github.com/metabase/metabase/issues/47688,"[('Operation/Database Migrations', 'Issues with application DB migrations when launching Metabase'), ('.Backend', '')]","[{'comment_id': 2332181980, 'issue_id': 2508245277, 'author': 'camsaul', 'body': ""alternative possibility: \r\n\r\n```\r\nversion-date-title-part\r\n```\r\n\r\ne.g.\r\n\r\n```\r\nv50-2024-09-05-whatever-01\r\n```\r\n\r\nif we drop time, it's important to put part number at the end of the suffix so all migrations in a group get run together"", 'created_at': datetime.datetime(2024, 9, 5, 16, 35, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2332184378, 'issue_id': 2508245277, 'author': 'camsaul', 'body': 'should we drop the time part of the timestamp format? Mixed feelings on this. Discuss more in Slack before proceeding', 'created_at': datetime.datetime(2024, 9, 5, 16, 36, 28, tzinfo=datetime.timezone.utc)}]","camsaul (Issue Creator) on (2024-09-05 16:35:01 UTC): alternative possibility: 

```
version-date-title-part
```

e.g.

```
v50-2024-09-05-whatever-01
```

if we drop time, it's important to put part number at the end of the suffix so all migrations in a group get run together

camsaul (Issue Creator) on (2024-09-05 16:36:28 UTC): should we drop the time part of the timestamp format? Mixed feelings on this. Discuss more in Slack before proceeding

"
2508096469,issue,closed,completed,Introduce a new toggle `enable-embedding-sdk`,,WiNloSt,2024-09-05 15:20:09+00:00,['WiNloSt'],2024-09-09 13:36:38+00:00,2024-09-09 13:36:38+00:00,https://github.com/metabase/metabase/issues/47682,[],[],
2507914310,issue,open,,It should be possible to remove crashed cards from dashboard,"[Slack report](https://metaboat.slack.com/archives/C05MPF0TM3L/p1725494736816499)

When cards completely crash on dashboards it still should be possible to remove them from dashboards.",alxnddr,2024-09-05 14:08:12+00:00,[],2025-02-04 20:28:43+00:00,,https://github.com/metabase/metabase/issues/47675,"[('Priority:P2', 'Average run of the mill bug'), ('Reporting/Dashboards', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2507903696,issue,closed,completed,Update Question Overflow Menu,"![Screen Shot 2024-09-05 at 8 03 38 AM](https://github.com/user-attachments/assets/5a4a85fd-cb07-4419-af55-574f159cfb46)
",iethree,2024-09-05 14:04:08+00:00,[],2024-09-27 13:36:50+00:00,2024-09-27 13:36:50+00:00,https://github.com/metabase/metabase/issues/47674,[],"[{'comment_id': 2379305777, 'issue_id': 2507903696, 'author': 'iethree', 'body': 'this got completed as part of question settings sidesheet', 'created_at': datetime.datetime(2024, 9, 27, 13, 36, 50, tzinfo=datetime.timezone.utc)}]","iethree (Issue Creator) on (2024-09-27 13:36:50 UTC): this got completed as part of question settings sidesheet

"
2507901044,issue,closed,completed,Add more detailed question info component,"
![Screen Shot 2024-09-05 at 8 04 00 AM](https://github.com/user-attachments/assets/167735ad-dd65-40d7-a707-743582815c04)
",iethree,2024-09-05 14:02:58+00:00,[],2024-10-08 16:14:46+00:00,2024-09-12 20:36:20+00:00,https://github.com/metabase/metabase/issues/47673,[],[],
2507765780,issue,closed,not_planned,XLSX exports giving invalid file format error,"**Describe the bug**
When I export [this report](https://yellow-card-financial.metabaseapp.com/question#eyJkYXRhc2V0X3F1ZXJ5Ijp7ImRhdGFiYXNlIjo2LCJ0eXBlIjoicXVlcnkiLCJxdWVyeSI6eyJzb3VyY2UtdGFibGUiOjI3MSwiZmlsdGVyIjpbImFuZCIsWyI9IixbImZpZWxkIiw1MzUxLHsiYmFzZS10eXBlIjoidHlwZS9UZXh0In1dLCJtZnMiXSxbImJldHdlZW4iLFsiZmllbGQiLDUzNTQseyJiYXNlLXR5cGUiOiJ0eXBlL0RhdGVUaW1lIn1dLCIyMDI0LTA5LTAxIiwiMjAyNC0wOS0wNSJdXX19LCJkaXNwbGF5IjoidGFibGUiLCJ2aXN1YWxpemF0aW9uX3NldHRpbmdzIjp7fSwib3JpZ2luYWxfY2FyZF9pZCI6bnVsbCwidHlwZSI6InF1ZXN0aW9uIn0=) into xlsx and open I get an ""Invalid file format"" error. I have tested with the following environments:
* Microsoft Excel
* MacOS Numbers
* Google Sheets

**Logs**
Below is what I could extract from the Google Sheets export
```json
{
    ""status"":""failed"",
    class:""class clojure.lang.ExceptionInfo"",
    error:""Error reducing result rows: Multiple methods in multimethod 'global-type-settings' match dispatch value: :type/SnowflakeVariant -> :type/Temporal and :type/Number	and neither is preferred""
}
```

**To Reproduce**
Steps to reproduce the behavior:
1. Go to the above report link.
2. Click on the cloud icon on the bottom right. Tooltip should read ""Download full results"".
3. Scroll down to .xlsx
4. Download the file
5. Open the file in either
  * Microsoft Excel
  * MacOS Numbers
  * Google Sheets

**Expected behavior**
I except the file to have the data as shown in the Metabase link.

**Screenshots**
<img width=""1465"" alt=""Screenshot 2024-09-05 at 15 04 09"" src=""https://github.com/user-attachments/assets/c865cda4-48ca-4609-9e7a-563295291623"">

**Severity**
It it blocking my treasury team from validating reconciliations for the month.
In some instances, it is blocking processing of withdrawals.

**Additional context**
The problem appears to be with this report only. I have tested others and I am able to open them.

**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""snowflake""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-cloud"",
    ""version"": {
      ""date"": ""2024-08-29"",
      ""tag"": ""v1.50.23"",
      ""hash"": ""7040ff1""
    }, /// I cannot confirm this.
    ""settings"": {
      ""report-timezone"": ""Africa/Lagos""
    },
    ""hosting-env"": ""aws"",
    ""application-database"": ""unknown""
  }
}
```",jamangile,2024-09-05 13:08:42+00:00,[],2024-09-05 13:53:24+00:00,2024-09-05 13:53:24+00:00,https://github.com/metabase/metabase/issues/47670,[],"[{'comment_id': 2331707643, 'issue_id': 2507765780, 'author': 'paoliniluis', 'body': ""@jamangile please contact our helpdesk. The previous comments point to viruses, so please stay away from those. They've been reported to github already"", 'created_at': datetime.datetime(2024, 9, 5, 13, 37, 23, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-05 13:37:23 UTC): @jamangile please contact our helpdesk. The previous comments point to viruses, so please stay away from those. They've been reported to github already

"
2507277880,issue,closed,completed,[Epic] Prepare Embedding SDK Release for Metabase 51,"### Product related

```[tasklist]
### SDK release blockers
- [ ] https://github.com/metabase/metabase/issues/46970
- [ ] https://github.com/metabase/metabase/issues/47824
- [ ] https://github.com/metabase/metabase/issues/47840
- [ ] https://github.com/metabase/metabase/issues/47841
```

",heypoom,2024-09-05 09:33:39+00:00,[],2024-10-08 12:41:53+00:00,2024-10-08 12:41:53+00:00,https://github.com/metabase/metabase/issues/47661,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2507222211,issue,closed,completed,Version 50 is causing Deadlocks when App DB is Postgres ,"### Describe the bug

Metabase is hitting a number of deadlock issues when there are a lot of parameters on a chart. Something that didn't use to happen on 49. So some of the cards will not load due to a deadlock error, causing something like this:

<img width=""1214"" alt=""image"" src=""https://github.com/user-attachments/assets/e0ef1aed-a5c8-466f-985b-ba459eba4bdd"">

I believe this is causing other issues in other features like serialisation. Cause I am following another issue that has this error:

```
ERROR serialization.api :: Error during deserialization: Failed to load into database for Card RUvyr0HeZx4Si-k2SrN8Q {:path [{:id ""RUvyr0HeZx4Si-k2SrN8Q"", :model ""Card""}], :deps-chain #{}, :model ""Card"", :table :report_card, :error :metabase-enterprise.serialization.v2.load/load-failure}
2024-09-04 08:55:58,254 ERROR serialization.api ::   caused by: ERROR: deadlock detected
  Detail: Process 1204 waits for ShareLock on transaction 2424836558; blocked by process 30145.
Process 30145 waits for ShareLock on transaction 2424835949; blocked by process 1204.
  Hint: See server log for query details.
  Where: while updating tuple (3,5) in relation ""report_card"" {}
2024-09-04 08:55:58,254 ERROR serialization.api ::   caused by: ERROR: deadlock detected
  Detail: Process 1204 waits for ShareLock on transaction 2424836558; blocked by process 30145.
Process 30145 waits for ShareLock on transaction 2424835949; blocked by process 1204.
  Hint: See server log for query details.
  Where: while updating tuple (3,5) in relation ""report_card"" 
2024-09-04 08:55:58,254 ERROR serialization.api :: Error during deserialization: Failed to load into database for Card RUvyr0HeZx4Si-k2SrN8Q {:path [{:id ""RUvyr0HeZx4Si-k2SrN8Q"", :model ""Card""}], :deps-chain #{}, :model ""Card"", :table :report_card, :error :metabase-enterprise.serialization.v2.load/load-failure}
2024-09-04 08:55:58,254 ERROR serialization.api ::   caused by: ERROR: deadlock detected
2024-09-04 08:55:58,254 ERROR serialization.api ::   caused by: ERROR: deadlock detected
```

### To Reproduce

Make sure Metabase is running a Postges Application DB since I was not able to replicate this on H2

1. Go to New -> Question -> Product -> Save -> Add this Question 25 times into a dashbaord
2. Then add 3 filters and link them to Vendor, Ean, Title -> Finally select around 130 items from Title Filter:

<img width=""1240"" alt=""image"" src=""https://github.com/user-attachments/assets/6b90c9bd-ad0e-48b8-8c9d-ad92a7eaf68e"">

3. If you load this dashboard (inside metabase or embedded) you will notice some charts failing to load and an error in the logs as well

I also created a public link [on a cloud instance](https://metabasetest.metabaseapp.com/public/dashboard/2c2e01e6-7ac5-45e3-90ee-64f50b850db2) I have that will show up the error. Tried on stats but wasn't able to replicate

### Expected behavior

No deadlock errors or if a deadlock error happens metabase will retry to execute the query not fail the question

### Logs

```
[43d3414a-9423-43ff-a740-9be048810216] 2024-09-05T10:53:17+02:00 ERROR metabase.server.middleware.log POST /api/dashboard/199/dashcard/289/card/331/query 500 13.3 s (8 DB calls) {:metabase-user-id 1} 
{:via
 [{:type clojure.lang.ExceptionInfo,
   :message
   ""ERROR: deadlock detected\n  Detail: Process 13367 waits for ShareLock on transaction 1806773214; blocked by process 13361.\nProcess 13361 waits for ShareLock on transaction 1806773197; blocked by process 13367.\n  Hint: See server log for query details.\n  Where: while locking tuple (2,3) in relation \""user_parameter_value\"""",
   :data
   {:toucan2/context-trace
    [[""execute SQL with class com.mchange.v2.c3p0.impl.NewProxyConnection""
      {:toucan2.jdbc.query/sql-args
       [""UPDATE \""user_parameter_value\"" SET \""value\"" = ? WHERE (\""user_id\"" = ?) AND (\""dashboard_id\"" = ?) AND (\""parameter_id\"" = ?)""
        ""[\""Sleek Aluminum Clock\"",\""Mediocre Cotton Coat\"",\""Durable Wool Toucan\"",\""Lightweight Wool Plate\"",\""Awesome Iron Hat\"",\""Rustic Paper Bench\"",\""Small Rubber Clock\"",\""Synergistic Leather Coat\"",\""Awesome Bronze Plate\"",\""Aerodynamic Paper Coat\"",\""Ergonomic Granite Bottle\"",\""Lightweight Steel Knife\"",\""Heavy-Duty Linen Toucan\"",\""Durable Cotton Bench\"",\""Aerodynamic Leather Computer\"",\""Aerodynamic Granite Bottle\"",\""Incredible Linen Knife\"",\""Sleek Marble Table\"",\""Mediocre Rubber Shoes\"",\""Rustic Silk Knife\"",\""Mediocre Paper Car\"",\""Gorgeous Marble Plate\"",\""Gorgeous Aluminum Plate\"",\""Enormous Granite Wallet\"",\""Enormous Cotton Pants\"",\""Enormous Steel Watch\"",\""Aerodynamic Leather Toucan\"",\""Aerodynamic Concrete Bench\"",\""Fantastic Aluminum Bottle\"",\""Practical Copper Car\"",\""Awesome Aluminum Table\"",\""Rustic Iron Bench\"",\""Small Granite Gloves\"",\""Enormous Marble Gloves\"",\""Enormous Plastic Coat\"",\""Sleek Steel Table\"",\""Ergonomic Marble Computer\"",\""Enormous Granite Bottle\"",\""Awesome Aluminum Keyboard\"",\""Heavy-Duty Rubber Gloves\"",\""Heavy-Duty Silk Car\"",\""Sleek Wool Wallet\"",\""Durable Leather Wallet\"",\""Heavy-Duty Silk Chair\"",\""Fantastic Copper Hat\"",\""Practical Plastic Keyboard\"",\""Durable Aluminum Bag\"",\""Intelligent Paper Hat\"",\""Rustic Rubber Clock\"",\""Aerodynamic Granite Bench\"",\""Practical Aluminum Coat\"",\""Mediocre Marble Lamp\"",\""Incredible Bronze Wallet\"",\""Rustic Concrete Bottle\"",\""Incredible Concrete Keyboard\"",\""Awesome Cotton Shoes\"",\""Durable Iron Knife\"",\""Ergonomic Iron Watch\"",\""Sleek Bronze Lamp\"",\""Fantastic Steel Knife\"",\""Ergonomic Marble Hat\"",\""Rustic Paper Wallet\"",\""Rustic Linen Keyboard\"",\""Lightweight Steel Watch\"",\""Sleek Aluminum Watch\"",\""Practical Bronze Watch\"",\""Lightweight Bronze Table\"",\""Rustic Copper Hat\"",\""Mediocre Wool Toucan\"",\""Rustic Copper Knife\"",\""Intelligent Bronze Knife\"",\""Lightweight Paper Bottle\"",\""Synergistic Rubber Shoes\"",\""Lightweight Linen Hat\"",\""Lightweight Linen Bottle\"",\""Durable Steel Toucan\"",\""Durable Rubber Computer\"",\""Small Copper Plate\"",\""Small Cotton Chair\"",\""Intelligent Steel Car\"",\""Durable Copper Clock\"",\""Mediocre Aluminum Lamp\"",\""Incredible Bronze Pants\"",\""Gorgeous Concrete Chair\"",\""Incredible Plastic Chair\"",\""Ergonomic Paper Wallet\"",\""Practical Silk Computer\"",\""Practical Steel Table\"",\""Sleek Wool Watch\"",\""Lightweight Leather Gloves\"",\""Sleek Plastic Shoes\"",\""Enormous Marble Shoes\"",\""Lightweight Granite Hat\"",\""Sleek Marble Clock\"",\""Small Plastic Computer\"",\""Aerodynamic Concrete Lamp\"",\""Intelligent Wooden Gloves\"",\""Practical Aluminum Table\"",\""Enormous Copper Shirt\"",\""Synergistic Marble Keyboard\"",\""Heavy-Duty Linen Gloves\"",\""Small Marble Knife\"",\""Mediocre Cotton Toucan\"",\""Small Wool Wallet\"",\""Synergistic Copper Computer\"",\""Synergistic Granite Chair\"",\""Synergistic Steel Chair\"",\""Synergistic Wool Coat\"",\""Small Marble Shoes\"",\""Small Marble Hat\"",\""Small Copper Clock\"",\""Sleek Granite Pants\"",\""Sleek Leather Table\"",\""Sleek Leather Toucan\"",\""Sleek Copper Watch\"",\""Rustic Silk Pants\"",\""Rustic Paper Car\"",\""Rustic Rubber Knife\"",\""Lightweight Copper Wallet\"",\""Lightweight Leather Bench\"",\""Lightweight Linen Coat\"",\""Lightweight Marble Bag\"",\""Intelligent Paper Car\"",\""Intelligent Iron Shirt\"",\""Incredible Silk Shoes\"",\""Intelligent Granite Hat\"",\""Practical Wool Hat\"",\""Rustic Iron Keyboard\"",\""Rustic Marble Bottle\"",\""Sleek Paper Toucan\"",\""Small Concrete Knife\""]""
        1
        199
        ""e2f7a863""]}]
     [""resolve connection"" {:toucan2.connection/connectable org.postgresql.jdbc.PgConnection}]
     [""resolve connection"" {:toucan2.connection/connectable nil}]
     {:toucan2.pipeline/rf
      #object[clojure.core$completing$fn__8528 0x524f7e08 ""clojure.core$completing$fn__8528@524f7e08""]}
     [""with compiled query""
      {:toucan2.pipeline/compiled-query
       [""UPDATE \""user_parameter_value\"" SET \""value\"" = ? WHERE (\""user_id\"" = ?) AND (\""dashboard_id\"" = ?) AND (\""parameter_id\"" = ?)""
        ""[\""Sleek Aluminum Clock\"",\""Mediocre Cotton Coat\"",\""Durable Wool Toucan\"",\""Lightweight Wool Plate\"",\""Awesome Iron Hat\"",\""Rustic Paper Bench\"",\""Small Rubber Clock\"",\""Synergistic Leather Coat\"",\""Awesome Bronze Plate\"",\""Aerodynamic Paper Coat\"",\""Ergonomic Granite Bottle\"",\""Lightweight Steel Knife\"",\""Heavy-Duty Linen Toucan\"",\""Durable Cotton Bench\"",\""Aerodynamic Leather Computer\"",\""Aerodynamic Granite Bottle\"",\""Incredible Linen Knife\"",\""Sleek Marble Table\"",\""Mediocre Rubber Shoes\"",\""Rustic Silk Knife\"",\""Mediocre Paper Car\"",\""Gorgeous Marble Plate\"",\""Gorgeous Aluminum Plate\"",\""Enormous Granite Wallet\"",\""Enormous Cotton Pants\"",\""Enormous Steel Watch\"",\""Aerodynamic Leather Toucan\"",\""Aerodynamic Concrete Bench\"",\""Fantastic Aluminum Bottle\"",\""Practical Copper Car\"",\""Awesome Aluminum Table\"",\""Rustic Iron Bench\"",\""Small Granite Gloves\"",\""Enormous Marble Gloves\"",\""Enormous Plastic Coat\"",\""Sleek Steel Table\"",\""Ergonomic Marble Computer\"",\""Enormous Granite Bottle\"",\""Awesome Aluminum Keyboard\"",\""Heavy-Duty Rubber Gloves\"",\""Heavy-Duty Silk Car\"",\""Sleek Wool Wallet\"",\""Durable Leather Wallet\"",\""Heavy-Duty Silk Chair\"",\""Fantastic Copper Hat\"",\""Practical Plastic Keyboard\"",\""Durable Aluminum Bag\"",\""Intelligent Paper Hat\"",\""Rustic Rubber Clock\"",\""Aerodynamic Granite Bench\"",\""Practical Aluminum Coat\"",\""Mediocre Marble Lamp\"",\""Incredible Bronze Wallet\"",\""Rustic Concrete Bottle\"",\""Incredible Concrete Keyboard\"",\""Awesome Cotton Shoes\"",\""Durable Iron Knife\"",\""Ergonomic Iron Watch\"",\""Sleek Bronze Lamp\"",\""Fantastic Steel Knife\"",\""Ergonomic Marble Hat\"",\""Rustic Paper Wallet\"",\""Rustic Linen Keyboard\"",\""Lightweight Steel Watch\"",\""Sleek Aluminum Watch\"",\""Practical Bronze Watch\"",\""Lightweight Bronze Table\"",\""Rustic Copper Hat\"",\""Mediocre Wool Toucan\"",\""Rustic Copper Knife\"",\""Intelligent Bronze Knife\"",\""Lightweight Paper Bottle\"",\""Synergistic Rubber Shoes\"",\""Lightweight Linen Hat\"",\""Lightweight Linen Bottle\"",\""Durable Steel Toucan\"",\""Durable Rubber Computer\"",\""Small Copper Plate\"",\""Small Cotton Chair\"",\""Intelligent Steel Car\"",\""Durable Copper Clock\"",\""Mediocre Aluminum Lamp\"",\""Incredible Bronze Pants\"",\""Gorgeous Concrete Chair\"",\""Incredible Plastic Chair\"",\""Ergonomic Paper Wallet\"",\""Practical Silk Computer\"",\""Practical Steel Table\"",\""Sleek Wool Watch\"",\""Lightweight Leather Gloves\"",\""Sleek Plastic Shoes\"",\""Enormous Marble Shoes\"",\""Lightweight Granite Hat\"",\""Sleek Marble Clock\"",\""Small Plastic Computer\"",\""Aerodynamic Concrete Lamp\"",\""Intelligent Wooden Gloves\"",\""Practical Aluminum Table\"",\""Enormous Copper Shirt\"",\""Synergistic Marble Keyboard\"",\""Heavy-Duty Linen Gloves\"",\""Small Marble Knife\"",\""Mediocre Cotton Toucan\"",\""Small Wool Wallet\"",\""Synergistic Copper Computer\"",\""Synergistic Granite Chair\"",\""Synergistic Steel Chair\"",\""Synergistic Wool Coat\"",\""Small Marble Shoes\"",\""Small Marble Hat\"",\""Small Copper Clock\"",\""Sleek Granite Pants\"",\""Sleek Leather Table\"",\""Sleek Leather Toucan\"",\""Sleek Copper Watch\"",\""Rustic Silk Pants\"",\""Rustic Paper Car\"",\""Rustic Rubber Knife\"",\""Lightweight Copper Wallet\"",\""Lightweight Leather Bench\"",\""Lightweight Linen Coat\"",\""Lightweight Marble Bag\"",\""Intelligent Paper Car\"",\""Intelligent Iron Shirt\"",\""Incredible Silk Shoes\"",\""Intelligent Granite Hat\"",\""Practical Wool Hat\"",\""Rustic Iron Keyboard\"",\""Rustic Marble Bottle\"",\""Sleek Paper Toucan\"",\""Small Concrete Knife\""]""
        1
        199
        ""e2f7a863""]}]
     [""with built query""
      {:toucan2.pipeline/built-query
       {:update [:user_parameter_value],
        :set
        {:value
         ""[\""Sleek Aluminum Clock\"",\""Mediocre Cotton Coat\"",\""Durable Wool Toucan\"",\""Lightweight Wool Plate\"",\""Awesome Iron Hat\"",\""Rustic Paper Bench\"",\""Small Rubber Clock\"",\""Synergistic Leather Coat\"",\""Awesome Bronze Plate\"",\""Aerodynamic Paper Coat\"",\""Ergonomic Granite Bottle\"",\""Lightweight Steel Knife\"",\""Heavy-Duty Linen Toucan\"",\""Durable Cotton Bench\"",\""Aerodynamic Leather Computer\"",\""Aerodynamic Granite Bottle\"",\""Incredible Linen Knife\"",\""Sleek Marble Table\"",\""Mediocre Rubber Shoes\"",\""Rustic Silk Knife\"",\""Mediocre Paper Car\"",\""Gorgeous Marble Plate\"",\""Gorgeous Aluminum Plate\"",\""Enormous Granite Wallet\"",\""Enormous Cotton Pants\"",\""Enormous Steel Watch\"",\""Aerodynamic Leather Toucan\"",\""Aerodynamic Concrete Bench\"",\""Fantastic Aluminum Bottle\"",\""Practical Copper Car\"",\""Awesome Aluminum Table\"",\""Rustic Iron Bench\"",\""Small Granite Gloves\"",\""Enormous Marble Gloves\"",\""Enormous Plastic Coat\"",\""Sleek Steel Table\"",\""Ergonomic Marble Computer\"",\""Enormous Granite Bottle\"",\""Awesome Aluminum Keyboard\"",\""Heavy-Duty Rubber Gloves\"",\""Heavy-Duty Silk Car\"",\""Sleek Wool Wallet\"",\""Durable Leather Wallet\"",\""Heavy-Duty Silk Chair\"",\""Fantastic Copper Hat\"",\""Practical Plastic Keyboard\"",\""Durable Aluminum Bag\"",\""Intelligent Paper Hat\"",\""Rustic Rubber Clock\"",\""Aerodynamic Granite Bench\"",\""Practical Aluminum Coat\"",\""Mediocre Marble Lamp\"",\""Incredible Bronze Wallet\"",\""Rustic Concrete Bottle\"",\""Incredible Concrete Keyboard\"",\""Awesome Cotton Shoes\"",\""Durable Iron Knife\"",\""Ergonomic Iron Watch\"",\""Sleek Bronze Lamp\"",\""Fantastic Steel Knife\"",\""Ergonomic Marble Hat\"",\""Rustic Paper Wallet\"",\""Rustic Linen Keyboard\"",\""Lightweight Steel Watch\"",\""Sleek Aluminum Watch\"",\""Practical Bronze Watch\"",\""Lightweight Bronze Table\"",\""Rustic Copper Hat\"",\""Mediocre Wool Toucan\"",\""Rustic Copper Knife\"",\""Intelligent Bronze Knife\"",\""Lightweight Paper Bottle\"",\""Synergistic Rubber Shoes\"",\""Lightweight Linen Hat\"",\""Lightweight Linen Bottle\"",\""Durable Steel Toucan\"",\""Durable Rubber Computer\"",\""Small Copper Plate\"",\""Small Cotton Chair\"",\""Intelligent Steel Car\"",\""Durable Copper Clock\"",\""Mediocre Aluminum Lamp\"",\""Incredible Bronze Pants\"",\""Gorgeous Concrete Chair\"",\""Incredible Plastic Chair\"",\""Ergonomic Paper Wallet\"",\""Practical Silk Computer\"",\""Practical Steel Table\"",\""Sleek Wool Watch\"",\""Lightweight Leather Gloves\"",\""Sleek Plastic Shoes\"",\""Enormous Marble Shoes\"",\""Lightweight Granite Hat\"",\""Sleek Marble Clock\"",\""Small Plastic Computer\"",\""Aerodynamic Concrete Lamp\"",\""Intelligent Wooden Gloves\"",\""Practical Aluminum Table\"",\""Enormous Copper Shirt\"",\""Synergistic Marble Keyboard\"",\""Heavy-Duty Linen Gloves\"",\""Small Marble Knife\"",\""Mediocre Cotton Toucan\"",\""Small Wool Wallet\"",\""Synergistic Copper Computer\"",\""Synergistic Granite Chair\"",\""Synergistic Steel Chair\"",\""Synergistic Wool Coat\"",\""Small Marble Shoes\"",\""Small Marble Hat\"",\""Small Copper Clock\"",\""Sleek Granite Pants\"",\""Sleek Leather Table\"",\""Sleek Leather Toucan\"",\""Sleek Copper Watch\"",\""Rustic Silk Pants\"",\""Rustic Paper Car\"",\""Rustic Rubber Knife\"",\""Lightweight Copper Wallet\"",\""Lightweight Leather Bench\"",\""Lightweight Linen Coat\"",\""Lightweight Marble Bag\"",\""Intelligent Paper Car\"",\""Intelligent Iron Shirt\"",\""Incredible Silk Shoes\"",\""Intelligent Granite Hat\"",\""Practical Wool Hat\"",\""Rustic Iron Keyboard\"",\""Rustic Marble Bottle\"",\""Sleek Paper Toucan\"",\""Small Concrete Knife\""]""},
        :where [:and [:= :user_id 1] [:= :dashboard_id 199] [:= :parameter_id ""e2f7a863""]]}}]
     [""with resolved query""
      {:toucan2.pipeline/resolved-query {:user_id 1, :dashboard_id 199, :parameter_id ""e2f7a863""}}]
     [""with parsed args""
      {:toucan2.pipeline/query-type :toucan.query-type/update.update-count,
       :toucan2.pipeline/parsed-args
       {:queryable {:user_id 1, :dashboard_id 199, :parameter_id ""e2f7a863""},
        :changes
        {:value
         [""Sleek Aluminum Clock""
          ""Mediocre Cotton Coat""
          ""Durable Wool Toucan""
          ""Lightweight Wool Plate""
          ""Awesome Iron Hat""
          ""Rustic Paper Bench""
          ""Small Rubber Clock""
          ""Synergistic Leather Coat""
          ""Awesome Bronze Plate""
          ""Aerodynamic Paper Coat""
          ""Ergonomic Granite Bottle""
          ""Lightweight Steel Knife""
          ""Heavy-Duty Linen Toucan""
          ""Durable Cotton Bench""
          ""Aerodynamic Leather Computer""
          ""Aerodynamic Granite Bottle""
          ""Incredible Linen Knife""
          ""Sleek Marble Table""
          ""Mediocre Rubber Shoes""
          ""Rustic Silk Knife""
          ""Mediocre Paper Car""
          ""Gorgeous Marble Plate""
          ""Gorgeous Aluminum Plate""
          ""Enormous Granite Wallet""
          ""Enormous Cotton Pants""
          ""Enormous Steel Watch""
          ""Aerodynamic Leather Toucan""
          ""Aerodynamic Concrete Bench""
          ""Fantastic Aluminum Bottle""
          ""Practical Copper Car""
          ""Awesome Aluminum Table""
          ""Rustic Iron Bench""
          ""Small Granite Gloves""
          ""Enormous Marble Gloves""
          ""Enormous Plastic Coat""
          ""Sleek Steel Table""
          ""Ergonomic Marble Computer""
          ""Enormous Granite Bottle""
          ""Awesome Aluminum Keyboard""
          ""Heavy-Duty Rubber Gloves""
          ""Heavy-Duty Silk Car""
          ""Sleek Wool Wallet""
          ""Durable Leather Wallet""
          ""Heavy-Duty Silk Chair""
          ""Fantastic Copper Hat""
          ""Practical Plastic Keyboard""
          ""Durable Aluminum Bag""
          ""Intelligent Paper Hat""
          ""Rustic Rubber Clock""
          ""Aerodynamic Granite Bench""
          ""Practical Aluminum Coat""
          ""Mediocre Marble Lamp""
          ""Incredible Bronze Wallet""
          ""Rustic Concrete Bottle""
          ""Incredible Concrete Keyboard""
          ""Awesome Cotton Shoes""
          ""Durable Iron Knife""
          ""Ergonomic Iron Watch""
          ""Sleek Bronze Lamp""
          ""Fantastic Steel Knife""
          ""Ergonomic Marble Hat""
          ""Rustic Paper Wallet""
          ""Rustic Linen Keyboard""
          ""Lightweight Steel Watch""
          ""Sleek Aluminum Watch""
          ""Practical Bronze Watch""
          ""Lightweight Bronze Table""
          ""Rustic Copper Hat""
          ""Mediocre Wool Toucan""
          ""Rustic Copper Knife""
          ""Intelligent Bronze Knife""
          ""Lightweight Paper Bottle""
          ""Synergistic Rubber Shoes""
          ""Lightweight Linen Hat""
          ""Lightweight Linen Bottle""
          ""Durable Steel Toucan""
          ""Durable Rubber Computer""
          ""Small Copper Plate""
          ""Small Cotton Chair""
          ""Intelligent Steel Car""
          ""Durable Copper Clock""
          ""Mediocre Aluminum Lamp""
          ""Incredible Bronze Pants""
          ""Gorgeous Concrete Chair""
          ""Incredible Plastic Chair""
          ""Ergonomic Paper Wallet""
          ""Practical Silk Computer""
          ""Practical Steel Table""
          ""Sleek Wool Watch""
          ""Lightweight Leather Gloves""
          ""Sleek Plastic Shoes""
          ""Enormous Marble Shoes""
          ""Lightweight Granite Hat""
          ""Sleek Marble Clock""
          ""Small Plastic Computer""
          ""Aerodynamic Concrete Lamp""
          ""Intelligent Wooden Gloves""
          ""Practical Aluminum Table""
          ""Enormous Copper Shirt""
          ""Synergistic Marble Keyboard""
          ""Heavy-Duty Linen Gloves""
          ""Small Marble Knife""
          ""Mediocre Cotton Toucan""
          ""Small Wool Wallet""
          ""Synergistic Copper Computer""
          ""Synergistic Granite Chair""
          ""Synergistic Steel Chair""
          ""Synergistic Wool Coat""
          ""Small Marble Shoes""
          ""Small Marble Hat""
          ""Small Copper Clock""
          ""Sleek Granite Pants""
          ""Sleek Leather Table""
          ""Sleek Leather Toucan""
          ""Sleek Copper Watch""
          ""Rustic Silk Pants""
          ""Rustic Paper Car""
          ""Rustic Rubber Knife""
          ""Lightweight Copper Wallet""
          ""Lightweight Leather Bench""
          ""Lightweight Linen Coat""
          ""Lightweight Marble Bag""
          ""Intelligent Paper Car""
          ""Intelligent Iron Shirt""
          ""Incredible Silk Shoes""
          ""Intelligent Granite Hat""
          ""Practical Wool Hat""
          ""Rustic Iron Keyboard""
          ""Rustic Marble Bottle""
          ""Sleek Paper Toucan""
          ""Small Concrete Knife""]}}}]
     [""with model"" {:toucan2.pipeline/model :model/UserParameterValue}]
     [""with unparsed args""
      {:toucan2.pipeline/query-type :toucan.query-type/update.update-count,
       :toucan2.pipeline/unparsed-args
       (:model/UserParameterValue
        {:user_id 1, :dashboard_id 199, :parameter_id ""e2f7a863""}
        {:value
         [""Sleek Aluminum Clock""
          ""Mediocre Cotton Coat""
          ""Durable Wool Toucan""
          ""Lightweight Wool Plate""
          ""Awesome Iron Hat""
          ""Rustic Paper Bench""
          ""Small Rubber Clock""
          ""Synergistic Leather Coat""
          ""Awesome Bronze Plate""
          ""Aerodynamic Paper Coat""
          ""Ergonomic Granite Bottle""
          ""Lightweight Steel Knife""
          ""Heavy-Duty Linen Toucan""
          ""Durable Cotton Bench""
          ""Aerodynamic Leather Computer""
          ""Aerodynamic Granite Bottle""
          ""Incredible Linen Knife""
          ""Sleek Marble Table""
          ""Mediocre Rubber Shoes""
          ""Rustic Silk Knife""
          ""Mediocre Paper Car""
          ""Gorgeous Marble Plate""
          ""Gorgeous Aluminum Plate""
          ""Enormous Granite Wallet""
          ""Enormous Cotton Pants""
          ""Enormous Steel Watch""
          ""Aerodynamic Leather Toucan""
          ""Aerodynamic Concrete Bench""
          ""Fantastic Aluminum Bottle""
          ""Practical Copper Car""
          ""Awesome Aluminum Table""
          ""Rustic Iron Bench""
          ""Small Granite Gloves""
          ""Enormous Marble Gloves""
          ""Enormous Plastic Coat""
          ""Sleek Steel Table""
          ""Ergonomic Marble Computer""
          ""Enormous Granite Bottle""
          ""Awesome Aluminum Keyboard""
          ""Heavy-Duty Rubber Gloves""
          ""Heavy-Duty Silk Car""
          ""Sleek Wool Wallet""
          ""Durable Leather Wallet""
          ""Heavy-Duty Silk Chair""
          ""Fantastic Copper Hat""
          ""Practical Plastic Keyboard""
          ""Durable Aluminum Bag""
          ""Intelligent Paper Hat""
          ""Rustic Rubber Clock""
          ""Aerodynamic Granite Bench""
          ""Practical Aluminum Coat""
          ""Mediocre Marble Lamp""
          ""Incredible Bronze Wallet""
          ""Rustic Concrete Bottle""
          ""Incredible Concrete Keyboard""
          ""Awesome Cotton Shoes""
          ""Durable Iron Knife""
          ""Ergonomic Iron Watch""
          ""Sleek Bronze Lamp""
          ""Fantastic Steel Knife""
          ""Ergonomic Marble Hat""
          ""Rustic Paper Wallet""
          ""Rustic Linen Keyboard""
          ""Lightweight Steel Watch""
          ""Sleek Aluminum Watch""
          ""Practical Bronze Watch""
          ""Lightweight Bronze Table""
          ""Rustic Copper Hat""
          ""Mediocre Wool Toucan""
          ""Rustic Copper Knife""
          ""Intelligent Bronze Knife""
          ""Lightweight Paper Bottle""
          ""Synergistic Rubber Shoes""
          ""Lightweight Linen Hat""
          ""Lightweight Linen Bottle""
          ""Durable Steel Toucan""
          ""Durable Rubber Computer""
          ""Small Copper Plate""
          ""Small Cotton Chair""
          ""Intelligent Steel Car""
          ""Durable Copper Clock""
          ""Mediocre Aluminum Lamp""
          ""Incredible Bronze Pants""
          ""Gorgeous Concrete Chair""
          ""Incredible Plastic Chair""
          ""Ergonomic Paper Wallet""
          ""Practical Silk Computer""
          ""Practical Steel Table""
          ""Sleek Wool Watch""
          ""Lightweight Leather Gloves""
          ""Sleek Plastic Shoes""
          ""Enormous Marble Shoes""
          ""Lightweight Granite Hat""
          ""Sleek Marble Clock""
          ""Small Plastic Computer""
          ""Aerodynamic Concrete Lamp""
          ""Intelligent Wooden Gloves""
          ""Practical Aluminum Table""
          ""Enormous Copper Shirt""
          ""Synergistic Marble Keyboard""
          ""Heavy-Duty Linen Gloves""
          ""Small Marble Knife""
          ""Mediocre Cotton Toucan""
          ""Small Wool Wallet""
          ""Synergistic Copper Computer""
          ""Synergistic Granite Chair""
          ""Synergistic Steel Chair""
          ""Synergistic Wool Coat""
          ""Small Marble Shoes""
          ""Small Marble Hat""
          ""Small Copper Clock""
          ""Sleek Granite Pants""
          ""Sleek Leather Table""
          ""Sleek Leather Toucan""
          ""Sleek Copper Watch""
          ""Rustic Silk Pants""
          ""Rustic Paper Car""
          ""Rustic Rubber Knife""
          ""Lightweight Copper Wallet""
          ""Lightweight Leather Bench""
          ""Lightweight Linen Coat""
          ""Lightweight Marble Bag""
          ""Intelligent Paper Car""
          ""Intelligent Iron Shirt""
          ""Incredible Silk Shoes""
          ""Intelligent Granite Hat""
          ""Practical Wool Hat""
          ""Rustic Iron Keyboard""
          ""Rustic Marble Bottle""
          ""Sleek Paper Toucan""
          ""Small Concrete Knife""]})}]
     [""resolve connection"" {:toucan2.connection/connectable metabase.db.connection.ApplicationDB}]
     [""resolve connection"" {:toucan2.connection/connectable :default}]
     [""resolve connection"" {:toucan2.connection/connectable nil}]]},
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse ""QueryExecutorImpl.java"" 2725]}
  {:type org.postgresql.util.PSQLException,
   :message
   ""ERROR: deadlock detected\n  Detail: Process 13367 waits for ShareLock on transaction 1806773214; blocked by process 13361.\nProcess 13361 waits for ShareLock on transaction 1806773197; blocked by process 13367.\n  Hint: See server log for query details.\n  Where: while locking tuple (2,3) in relation \""user_parameter_value\"""",
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse ""QueryExecutorImpl.java"" 2725]}],
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse ""QueryExecutorImpl.java"" 2725]
  [org.postgresql.core.v3.QueryExecutorImpl processResults ""QueryExecutorImpl.java"" 2412]
  [org.postgresql.core.v3.QueryExecutorImpl execute ""QueryExecutorImpl.java"" 371]
  [org.postgresql.jdbc.PgStatement executeInternal ""PgStatement.java"" 502]
  [org.postgresql.jdbc.PgStatement execute ""PgStatement.java"" 419]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags ""PgPreparedStatement.java"" 194]
  [org.postgresql.jdbc.PgPreparedStatement execute ""PgPreparedStatement.java"" 180]
  [com.mchange.v2.c3p0.impl.NewProxyPreparedStatement execute ""NewProxyPreparedStatement.java"" 67]
  [toucan2.jdbc.query$reduce_jdbc_query invokeStatic ""query.clj"" 40]
  [toucan2.jdbc.query$reduce_jdbc_query invoke ""query.clj"" 22]
  [toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default
   invokeStatic
   ""pipeline.clj""
   19]
  [toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default
   invoke
   ""pipeline.clj""
   9]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 15]
  [methodical.impl.combo.threaded$combine_methods_thread_last$fn__18430$combined_method_thread_last__18431
   invoke
   ""threaded.clj""
   64]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 65]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 216]
  [toucan2.pipeline$transduce_execute$with_connection_STAR___21534$with_transaction_STAR___21535
   invoke
   ""pipeline.clj""
   75]
  [toucan2.connection$bind_current_connectable_fn$fn__21215 invoke ""connection.clj"" 104]
  [metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection invokeStatic ""connection.clj"" 180]
  [metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection invoke ""connection.clj"" 162]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 13]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_transaction_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 249]
  [toucan2.connection$do_with_transaction_around_method_toucan2_connection_default invoke ""connection.clj"" 245]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 13]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 58]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 212]
  [toucan2.pipeline$transduce_execute$with_connection_STAR___21534 invoke ""pipeline.clj"" 74]
  [toucan2.connection$bind_current_connectable_fn$fn__21215 invoke ""connection.clj"" 104]
  [toucan2.connection$bind_current_connectable_fn$fn__21215 invoke ""connection.clj"" 104]
  [toucan2.jdbc.connection$do_with_connection_primary_method_java_sql_Connection invokeStatic ""connection.clj"" 13]
  [toucan2.jdbc.connection$do_with_connection_primary_method_java_sql_Connection invoke ""connection.clj"" 11]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.connection$do_with_connection_primary_method_ invokeStatic ""connection.clj"" 204]
  [toucan2.connection$do_with_connection_primary_method_ invoke ""connection.clj"" 194]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.pipeline$transduce_execute invokeStatic ""pipeline.clj"" 74]
  [toucan2.pipeline$transduce_execute invoke ""pipeline.clj"" 64]
  [clojure.lang.Var invoke ""Var.java"" 399]
  [toucan2.pipeline$transduce_compiled_query invokeStatic ""pipeline.clj"" 244]
  [toucan2.pipeline$transduce_compiled_query invoke ""pipeline.clj"" 240]
  [toucan2.pipeline$transduce_built_query invokeStatic ""pipeline.clj"" 252]
  [toucan2.pipeline$transduce_built_query invoke ""pipeline.clj"" 246]
  [toucan2.pipeline$transduce_query_primary_method_default invokeStatic ""pipeline.clj"" 272]
  [toucan2.pipeline$transduce_query_primary_method_default invoke ""pipeline.clj"" 269]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 15]
  [methodical.impl.combo.threaded$combine_methods_thread_last$fn__18430$combined_method_thread_last__18431
   invoke
   ""threaded.clj""
   64]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 65]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 216]
  [toucan2.pipeline$transduce_query_STAR_ invokeStatic ""pipeline.clj"" 278]
  [toucan2.pipeline$transduce_query_STAR_ invoke ""pipeline.clj"" 274]
  [toucan2.pipeline$transduce_with_model invokeStatic ""pipeline.clj"" 293]
  [toucan2.pipeline$transduce_with_model invoke ""pipeline.clj"" 280]
  [toucan2.pipeline$transduce_parsed invokeStatic ""pipeline.clj"" 309]
  [toucan2.pipeline$transduce_parsed invoke ""pipeline.clj"" 295]
  [toucan2.pipeline$transduce_unparsed invokeStatic ""pipeline.clj"" 317]
  [toucan2.pipeline$transduce_unparsed invoke ""pipeline.clj"" 311]
  [toucan2.pipeline$transduce_unparsed_with_default_rf invokeStatic ""pipeline.clj"" 374]
  [toucan2.pipeline$transduce_unparsed_with_default_rf invoke ""pipeline.clj"" 368]
  [toucan2.update$update_BANG_ invokeStatic ""update.clj"" 53]
  [toucan2.update$update_BANG_ doInvoke ""update.clj"" 50]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [metabase.models.user_parameter_value$batched_upsert_BANG_$with_connection_STAR___98119$with_transaction_STAR___98120
   invoke
   ""user_parameter_value.clj""
   45]
  [toucan2.connection$bind_current_connectable_fn$fn__21215 invoke ""connection.clj"" 104]
  [metabase.db.connection$do_transaction$thunk__42360 invoke ""connection.clj"" 140]
  [metabase.db.connection$do_transaction invokeStatic ""connection.clj"" 152]
  [metabase.db.connection$do_transaction invoke ""connection.clj"" 136]
  [metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection invokeStatic ""connection.clj"" 189]
  [metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection invoke ""connection.clj"" 162]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 13]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_transaction_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 249]
  [toucan2.connection$do_with_transaction_around_method_toucan2_connection_default invoke ""connection.clj"" 245]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 13]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 58]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 212]
  [metabase.models.user_parameter_value$batched_upsert_BANG_$with_connection_STAR___98119
   invoke
   ""user_parameter_value.clj""
   43]
  [toucan2.connection$bind_current_connectable_fn$fn__21215 invoke ""connection.clj"" 104]
  [toucan2.connection$bind_current_connectable_fn$fn__21215 invoke ""connection.clj"" 104]
  [toucan2.connection$bind_current_connectable_fn$fn__21215 invoke ""connection.clj"" 104]
  [toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource invokeStatic ""connection.clj"" 18]
  [toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource invoke ""connection.clj"" 15]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [metabase.db.connection$do_with_connection_primary_method_default invokeStatic ""connection.clj"" 132]
  [metabase.db.connection$do_with_connection_primary_method_default invoke ""connection.clj"" 130]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.connection$do_with_connection_primary_method_ invokeStatic ""connection.clj"" 204]
  [toucan2.connection$do_with_connection_primary_method_ invoke ""connection.clj"" 194]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__18120 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [metabase.models.user_parameter_value$batched_upsert_BANG_ invokeStatic ""user_parameter_value.clj"" 43]
  [metabase.models.user_parameter_value$batched_upsert_BANG_ invoke ""user_parameter_value.clj"" 33]
  [metabase.query_processor.dashboard$resolve_params_for_query invokeStatic ""dashboard.clj"" 147]
  [metabase.query_processor.dashboard$resolve_params_for_query invoke ""dashboard.clj"" 118]
  [metabase.query_processor.dashboard$process_query_for_dashcard invokeStatic ""dashboard.clj"" 182]
  [metabase.query_processor.dashboard$process_query_for_dashcard doInvoke ""dashboard.clj"" 163]
  [clojure.lang.RestFn applyTo ""RestFn.java"" 137]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [medley.core$mapply invokeStatic ""core.cljc"" 243]
  [medley.core$mapply invoke ""core.cljc"" 237]
  [metabase.api.dashboard$fn__99040$fn__99043 invoke ""dashboard.clj"" 1240]
  [metabase.api.dashboard$do_with_dashboard_load_id invokeStatic ""dashboard.clj"" 307]
  [metabase.api.dashboard$do_with_dashboard_load_id invoke ""dashboard.clj"" 302]
  [metabase.api.dashboard$fn__99040 invokeStatic ""dashboard.clj"" 1239]
  [metabase.api.dashboard$fn__99040 invoke ""dashboard.clj"" 1231]
  [compojure.core$wrap_response$fn__52704 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__52688 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__52693 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [metabase.server.middleware.auth$enforce_authentication$fn__98049 invoke ""auth.clj"" 18]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__52744 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 300]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [metabase.api.routes$fn__105642$fn__105643 invoke ""routes.clj"" 70]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__105922$fn__105923 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__52744 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52697 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__52744 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716$f__52717$respond_SINGLEQUOTE___52718 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52748 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [compojure.core$routes$fn__52716$f__52717 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52716 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__102022 invoke ""exceptions.clj"" 107]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__102019 invoke ""exceptions.clj"" 96]
  [metabase.server.middleware.log$log_api_call$fn__108278$fn__108279$fn__108280 invoke ""log.clj"" 233]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__108278$fn__108279 invoke ""log.clj"" 224]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__108278 invoke ""log.clj"" 223]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__114444 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__101978 invoke ""security.clj"" 240]
  [ring.middleware.json$wrap_json_body$fn__114703 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__88221 invoke ""offset_paging.clj"" 43]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__54325 invoke ""json.clj"" 83]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__114792 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__114811 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__70881 invoke ""misc.clj"" 59]
  [metabase.server.middleware.session$reset_session_timeout$fn__77889 invoke ""session.clj"" 548]
  [metabase.server.middleware.session$bind_current_user$fn__77855$fn__77856 invoke ""session.clj"" 443]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 422]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 405]
  [metabase.server.middleware.session$bind_current_user$fn__77855 invoke ""session.clj"" 442]
  [metabase.server.middleware.session$wrap_current_user_info$fn__77836 invoke ""session.clj"" 381]
  [metabase.server.middleware.session$wrap_session_id$fn__77808 invoke ""session.clj"" 259]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__98057 invoke ""auth.clj"" 32]
  [ring.middleware.cookies$wrap_cookies$fn__114631 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__70863 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__70889 invoke ""misc.clj"" 75]
  [ring.middleware.gzip$wrap_gzip$fn__114673 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.misc$bind_request$fn__70892 invoke ""misc.clj"" 91]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__114460 invoke ""ssl.clj"" 51]
  [metabase.server$async_proxy_handler$fn__71227 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run nil -1]],
 :cause
 ""ERROR: deadlock detected\n  Detail: Process 13367 waits for ShareLock on transaction 1806773214; blocked by process 13361.\nProcess 13361 waits for ShareLock on transaction 1806773197; blocked by process 13367.\n  Hint: See server log for query details.\n  Where: while locking tuple (2,3) in relation \""user_parameter_value\"""",
 :message
 ""ERROR: deadlock detected\n  Detail: Process 13367 waits for ShareLock on transaction 1806773214; blocked by process 13361.\nProcess 13361 waits for ShareLock on transaction 1806773197; blocked by process 13367.\n  Hint: See server log for query details.\n  Where: while locking tuple (2,3) in relation \""user_parameter_value\""""}
```

### Information about your Metabase installation

```JSON
Was able to replicate on 50.24 ... Not able to hit on stats
```


### Severity

Broke dashboards of some customers

### Additional context

A workaround is to increase the App DB connection pool ... but this is not really a workaround but more of a hiding of the problem",Tony-metabase,2024-09-05 09:10:16+00:00,[],2025-01-08 15:45:55+00:00,2024-09-11 14:57:14+00:00,https://github.com/metabase/metabase/issues/47660,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Escalation', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2331012881, 'issue_id': 2507222211, 'author': 'Tony-metabase', 'body': 'It could be the fix here https://github.com/metabase/metabase/pull/46615 improved this some time ago but the issue is still there', 'created_at': datetime.datetime(2024, 9, 5, 9, 13, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2351619044, 'issue_id': 2507222211, 'author': 'eli-noogata', 'body': '@paoliniluis hey, is there a new version that includes the fix?', 'created_at': datetime.datetime(2024, 9, 15, 14, 31, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2351833816, 'issue_id': 2507222211, 'author': 'paoliniluis', 'body': '@eli-noogata, you might want to try 50.25.3 which should do the trick. Please try that and report back', 'created_at': datetime.datetime(2024, 9, 15, 23, 34, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2578001719, 'issue_id': 2507222211, 'author': 'paoliniluis', 'body': '@eli-noogata can you check 52.5?', 'created_at': datetime.datetime(2025, 1, 8, 15, 45, 54, tzinfo=datetime.timezone.utc)}]","Tony-metabase (Issue Creator) on (2024-09-05 09:13:44 UTC): It could be the fix here https://github.com/metabase/metabase/pull/46615 improved this some time ago but the issue is still there

eli-noogata on (2024-09-15 14:31:23 UTC): @paoliniluis hey, is there a new version that includes the fix?

paoliniluis on (2024-09-15 23:34:15 UTC): @eli-noogata, you might want to try 50.25.3 which should do the trick. Please try that and report back

paoliniluis on (2025-01-08 15:45:54 UTC): @eli-noogata can you check 52.5?

"
2507175871,issue,closed,not_planned,Error upgrading metabase 0.46.6 to 0.50.24,"### Describe the bug

Im trying to upgrade my self hosted metabase (docker) from 0.46.6 to 0.50.24, but the following migration fails: Migration failed for changeset migrations/001_update_migrations.yaml::v49.00-059::qnkhuat:

with the following error:
Reason: clojure.lang.ExceptionInfo: (conn=3836133) SAVEPOINT 70c9749c-9fa1-48d3-9c82-1eb4ffc3c2f8 does not exist {:toucan2/context-trace [[""resolve connection"" {:toucan2.connection/connectable org.mariadb.jdbc.MariaDbConnection}] [""resolve connection"" {:toucan2.connection/connectable nil}]]}


### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
OS: centos 7.9
database : mysql 8
run by docker
```


### Severity

yes

### Additional context

[databasechangelog.txt](https://github.com/user-attachments/files/16886525/databasechangelog.txt)
",wangxiaojie0506,2024-09-05 08:49:57+00:00,[],2025-01-08 15:46:14+00:00,2024-09-05 10:38:00+00:00,https://github.com/metabase/metabase/issues/47657,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Operation/Database Migrations', 'Issues with application DB migrations when launching Metabase'), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2331161779, 'issue_id': 2507175871, 'author': 'wangxiaojie0506', 'body': 'the following error is also occur when i use a new empty database to redeploy 0.50.24', 'created_at': datetime.datetime(2024, 9, 5, 10, 23, 31, tzinfo=datetime.timezone.utc)}, {'comment_id': 2331188277, 'issue_id': 2507175871, 'author': 'paoliniluis', 'body': 'Please upgrade your Postgres or MySQL database version', 'created_at': datetime.datetime(2024, 9, 5, 10, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2331199917, 'issue_id': 2507175871, 'author': 'wangxiaojie0506', 'body': 'thanks, but which version need i upgrade to ?', 'created_at': datetime.datetime(2024, 9, 5, 10, 44, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2578002518, 'issue_id': 2507175871, 'author': 'paoliniluis', 'body': '@wangxiaojie0506 can you check 52.5?', 'created_at': datetime.datetime(2025, 1, 8, 15, 46, 13, tzinfo=datetime.timezone.utc)}]","wangxiaojie0506 (Issue Creator) on (2024-09-05 10:23:31 UTC): the following error is also occur when i use a new empty database to redeploy 0.50.24

paoliniluis on (2024-09-05 10:38:00 UTC): Please upgrade your Postgres or MySQL database version

wangxiaojie0506 (Issue Creator) on (2024-09-05 10:44:17 UTC): thanks, but which version need i upgrade to ?

paoliniluis on (2025-01-08 15:46:13 UTC): @wangxiaojie0506 can you check 52.5?

"
2507140223,issue,closed,completed,"Remove the ""Unknown Premium Feature"" console warning","The ""Unknown Premium Feature"" console warning is spamming the console for sdk users.

![image](https://github.com/user-attachments/assets/0cf23f82-2b50-4aa4-8f7c-baa8a90b61c2)
",heypoom,2024-09-05 08:33:35+00:00,['heypoom'],2024-10-08 16:14:48+00:00,2024-09-12 17:39:31+00:00,https://github.com/metabase/metabase/issues/47656,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2507136831,issue,closed,completed,[Epic] Remove low-hanging fruit console errors visible in the embedding sdk,"Let's aim to eliminate the visible console errors present in the embedding sdk. This is usually caused by React errors in the main Metabase app's components, which is especially visible for embedding sdk users.

```[tasklist]
### Tasks
- [ ] https://github.com/metabase/metabase/issues/47656
- [ ] https://github.com/metabase/metabase/issues/48496
- [ ] https://github.com/metabase/metabase/pull/48764
- [ ] https://github.com/metabase/metabase/pull/48770
```

### Screenshots

When using create-react-app and installing the embedding SDK via npm (which uses our production bundle), the React errors still appears on the host application.

![Image](https://github.com/user-attachments/assets/263168e5-24f8-487d-83e7-a7c20575fd94)
",heypoom,2024-09-05 08:31:55+00:00,['heypoom'],2025-02-05 15:25:59+00:00,2025-02-05 15:25:59+00:00,https://github.com/metabase/metabase/issues/47655,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2441596217, 'issue_id': 2507136831, 'author': 'heypoom', 'body': 'Paused to prioritize working on important SDK polishing/improvements.', 'created_at': datetime.datetime(2024, 10, 28, 13, 29, 41, tzinfo=datetime.timezone.utc)}]","heypoom (Issue Creator) on (2024-10-28 13:29:41 UTC): Paused to prioritize working on important SDK polishing/improvements.

"
2506758212,issue,closed,completed,Archived cards are included in dashboard subscriptions,"### Describe the bug

If you have a dashboard that has archived cards on it, the dashboard subscriptions will include those cards.

### To Reproduce

1. Setup email
2. Create a card and Add it to a dashboard
3. Create a dashboard subscription
4. Archive the card
5. Try sending the dashboard subscription
6. See the archived card is included in the email

### Expected behavior

Archived cards should be excluded

### Logs

_No response_

### Information about your Metabase installation

```JSON
master
```


### Severity

P2

### Additional context

_No response_",qnkhuat,2024-09-05 04:46:36+00:00,['qnkhuat'],2024-10-01 22:18:33+00:00,2024-09-05 12:55:30+00:00,https://github.com/metabase/metabase/issues/47649,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Dashboards', ''), ('Reporting/Pulses', 'Now called Subscriptions'), ('.Backend', ''), ('.Team/Workflows', 'aka BEC')]",[],
2506499264,issue,open,,charts don't use whitelabeled colors in subscriptions,"### Describe the bug

If I set custom whitelabeled colors in admin settings, charts will have those colors in app, but not necessarily in subscriptions. For example, this line chart has custom colors in app, but uses the default ones in an email subscription.

<img width=""635"" alt=""Screenshot 2024-09-04 at 3 04 59 PM"" src=""https://github.com/user-attachments/assets/4a3195fa-3be5-4d47-adaa-a3d969096d0a"">

<img width=""523"" alt=""Screenshot 2024-09-04 at 3 05 08 PM"" src=""https://github.com/user-attachments/assets/2106b017-0053-4fa7-9d07-cf56a3673619"">



### To Reproduce

1. Set custom colors in admin settings (need to use ee jar)
2. Create a line chart, leave the colors unchanged
3. Add the chart to a dashboard, send a test email subscription


### Expected behavior

Both charts should have the custom colors

### Logs

_No response_

### Information about your Metabase installation

```JSON
Src_hash: 2b9cfba992fc65a1a6f1e74db373e37a8dc9a597
```


### Severity

Moderately severe, paid feature is not working where it is expected to

### Additional context

_No response_",EmmadUsmani,2024-09-04 23:55:39+00:00,['alxnddr'],2025-02-04 20:31:51+00:00,,https://github.com/metabase/metabase/issues/47644,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/Chart Settings', ''), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('Visualization/Static', 'Subscriptions/pulse generated image'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2506480417,issue,open,,Broken Kondo schema for new recents API,"Original PR: #42239 

The Kondo output schema for `metabase.api.activity/get-popular-items-model-and-id` is in the wrong place and doesn't actually get applied:

https://github.com/metabase/metabase/blob/2b91354fd4/src/metabase/api/activity.clj#L187

fixing it leads to several test failures in ` metabase.api.activity-test/popular-items-test`:

```
FAIL in metabase.api.activity-test/popular-items-test (http_client.clj:211)

...

GET /api/activity/popular_items expected a status code of 200, got 500.
expected: 200
  actual: 500
```

is seems like the issue here is that the `metabase.models.recent-views/Item` schema does not accurately reflect what gets returned by that function -- nothing comes back with Database ID for example. 

Not sure whether the schema itself is wrong or the function is broken, so I'm opening this issue so someone closer to the original PR can investigate.",camsaul,2024-09-04 23:37:25+00:00,[],2025-02-04 20:26:18+00:00,,https://github.com/metabase/metabase/issues/47642,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Misc/API', ''), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2330326693, 'issue_id': 2506480417, 'author': 'camsaul', 'body': 'CC @escherize as the original PR author', 'created_at': datetime.datetime(2024, 9, 4, 23, 37, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2330328202, 'issue_id': 2506480417, 'author': 'camsaul', 'body': 'The newest version of Kondo actually catches the output schemas being in the wrong place and warns about it. In #47418 I moved  the schema to the right place in the `mu/defn` and just commented out the parts of the schema causing the test failures. Not sure if this was the right thing to do or not -- whoever investigates can either remove that stuff completely or uncomment out that stuff and fix the function', 'created_at': datetime.datetime(2024, 9, 4, 23, 39, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2352087294, 'issue_id': 2506480417, 'author': 'BenjaminGK', 'body': '@camsaul Not sure if it is related, but it seems we are getting an error due to this after upgrading to v50\r\n\r\n```\r\n[c00c0535-a69a-4d00-98d5-005b9a5b0451] 2024-09-16T13:09:14+07:00 ERROR metabase.server.middleware.log GET /api/activity/popular_items 500 34.5 ms (2 DB calls) {:metabase-user-id 11} \r\n{:via\r\n [{:type java.lang.ClassCastException,\r\n   :message\r\n   ""class java.time.OffsetDateTime cannot be cast to class java.time.chrono.ChronoLocalDateTime (java.time.OffsetDateTime and java.time.chrono.ChronoLocalDateTime are in module java.base of loader \'bootstrap\')"",\r\n   :at [java.time.LocalDateTime compareTo nil -1]}],\r\n :trace\r\n [[java.time.LocalDateTime compareTo nil -1]\r\n  [clojure.lang.Util compare ""Util.java"" 153]\r\n  [clojure.core$compare invokeStatic ""core.clj"" 842]\r\n  [clojure.core$compare invoke ""core.clj"" 833]\r\n  [clojure.lang.AFunction compare ""AFunction.java"" 51]\r\n  [clojure.core$sort_by$fn__6045 invoke ""core.clj"" 3133]\r\n  [clojure.lang.AFunction compare ""AFunction.java"" 51]\r\n  [java.util.TimSort countRunAndMakeAscending nil -1]\r\n  [java.util.TimSort sort nil -1]\r\n  [java.util.Arrays sort nil -1]\r\n  [clojure.core$sort invokeStatic ""core.clj"" 3117]\r\n  [clojure.core$sort_by invokeStatic ""core.clj"" 3121]\r\n  [clojure.core$sort_by invokeStatic ""core.clj"" 3121]\r\n  [clojure.core$sort_by invoke ""core.clj"" 3121]\r\n  [metabase.api.activity$views_and_runs invokeStatic ""activity.clj"" 108]\r\n  [metabase.api.activity$views_and_runs invoke ""activity.clj"" 63]\r\n  [metabase.api.activity$get_popular_items_model_and_id invokeStatic ""activity.clj"" 211]\r\n  [metabase.api.activity$get_popular_items_model_and_id invoke ""activity.clj"" 202]\r\n  [metabase.api.activity$fn__101692 invokeStatic ""activity.clj"" 238]\r\n  [metabase.api.activity$fn__101692 invoke ""activity.clj"" 234]\r\n  [compojure.core$wrap_response$fn__52754 invoke ""core.clj"" 160]\r\n  [compojure.core$wrap_route_middleware$fn__52738 invoke ""core.clj"" 132]\r\n  [compojure.core$wrap_route_info$fn__52743 invoke ""core.clj"" 139]\r\n  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 151]\r\n  [clojure.lang.Var invoke ""Var.java"" 393]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]\r\n  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]\r\n  [clojure.lang.AFn applyTo ""AFn.java"" 144]\r\n  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]\r\n  [clojure.lang.RestFn invoke ""RestFn.java"" 436]\r\n  [metabase.server.middleware.auth$enforce_authentication$fn__97278 invoke ""auth.clj"" 18]\r\n  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]\r\n  [clojure.lang.AFn applyTo ""AFn.java"" 144]\r\n  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]\r\n  [clojure.lang.RestFn invoke ""RestFn.java"" 436]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]\r\n  [compojure.core$make_context$handler__52794 invoke ""core.clj"" 290]\r\n  [compojure.core$make_context$fn__52798 invoke ""core.clj"" 300]\r\n  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]\r\n  [clojure.lang.AFn applyTo ""AFn.java"" 144]\r\n  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]\r\n  [clojure.lang.RestFn invoke ""RestFn.java"" 436]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]\r\n  [compojure.core$make_context$fn__52798 invoke ""core.clj"" 301]\r\n  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]\r\n  [clojure.lang.AFn applyTo ""AFn.java"" 144]\r\n  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]\r\n  [clojure.lang.RestFn invoke ""RestFn.java"" 436]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]\r\n  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]\r\n  [clojure.lang.Var invoke ""Var.java"" 393]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]\r\n  [metabase.api.routes$fn__102954$fn__102957 invoke ""routes.clj"" 73]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]\r\n  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]\r\n  [clojure.lang.AFn applyTo ""AFn.java"" 144]\r\n  [clojure.core$apply invokeStatic ""core.clj"" 667]\r\n  [clojure.core$apply invoke ""core.clj"" 662]\r\n  [metabase.server.routes$fn__103234$fn__103235 doInvoke ""routes.clj"" 73]\r\n  [clojure.lang.RestFn invoke ""RestFn.java"" 436]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]\r\n  [compojure.core$make_context$handler__52794 invoke ""core.clj"" 290]\r\n  [compojure.core$make_context$fn__52798 invoke ""core.clj"" 300]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]\r\n  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 153]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]\r\n  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]\r\n  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]\r\n  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]\r\n  [metabase.server.routes$fn__103217$fn__103219 invoke ""routes.clj"" 47]\r\n  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]\r\n  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__99312 invoke ""exceptions.clj"" 107]\r\n  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__99309 invoke ""exceptions.clj"" 96]\r\n  [metabase.server.middleware.log$log_api_call$fn__103521$fn__103522$fn__103523 invoke ""log.clj"" 233]\r\n  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]\r\n  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]\r\n  [metabase.server.middleware.log$log_api_call$fn__103521$fn__103522 invoke ""log.clj"" 224]\r\n  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]\r\n  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]\r\n  [metabase.server.middleware.log$log_api_call$fn__103521 invoke ""log.clj"" 223]\r\n  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__106811 invoke ""browser_cookie.clj"" 40]\r\n  [metabase.server.middleware.security$add_security_headers$fn__99268 invoke ""security.clj"" 246]\r\n  [ring.middleware.json$wrap_json_body$fn__107070 invoke ""json.clj"" 64]\r\n  [metabase.server.middleware.offset_paging$handle_paging$fn__87699 invoke ""offset_paging.clj"" 43]\r\n  [metabase.server.middleware.json$wrap_streamed_json_response$fn__54361 invoke ""json.clj"" 83]\r\n  [ring.middleware.keyword_params$wrap_keyword_params$fn__107159 invoke ""keyword_params.clj"" 55]\r\n  [ring.middleware.params$wrap_params$fn__107178 invoke ""params.clj"" 77]\r\n  [metabase.server.middleware.misc$maybe_set_site_url$fn__64160 invoke ""misc.clj"" 59]\r\n  [metabase.server.middleware.session$reset_session_timeout$fn__65711 invoke ""session.clj"" 548]\r\n  [metabase.server.middleware.session$bind_current_user$fn__65677$fn__65678 invoke ""session.clj"" 443]\r\n  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 422]\r\n  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 405]\r\n  [metabase.server.middleware.session$bind_current_user$fn__65677 invoke ""session.clj"" 442]\r\n  [metabase.server.middleware.session$wrap_current_user_info$fn__65658 invoke ""session.clj"" 381]\r\n  [metabase.server.middleware.session$wrap_session_id$fn__65630 invoke ""session.clj"" 259]\r\n  [metabase.server.middleware.auth$wrap_static_api_key$fn__97286 invoke ""auth.clj"" 32]\r\n  [ring.middleware.cookies$wrap_cookies$fn__106998 invoke ""cookies.clj"" 200]\r\n  [metabase.server.middleware.misc$add_content_type$fn__64142 invoke ""misc.clj"" 28]\r\n  [metabase.server.middleware.misc$disable_streaming_buffering$fn__64168 invoke ""misc.clj"" 75]\r\n  [ring.middleware.gzip$wrap_gzip$fn__107040 invoke ""gzip.clj"" 86]\r\n  [metabase.server.middleware.misc$bind_request$fn__64171 invoke ""misc.clj"" 91]\r\n  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__106827 invoke ""ssl.clj"" 51]\r\n  [metabase.server$async_proxy_handler$fn__71902 invoke ""server.clj"" 77]\r\n  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]\r\n  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]\r\n  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]\r\n  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]\r\n  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]\r\n  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]\r\n  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]\r\n  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]\r\n  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]\r\n  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]\r\n  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]\r\n  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]\r\n  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]\r\n  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]\r\n  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]\r\n  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]\r\n  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]\r\n  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]\r\n  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]\r\n  [java.lang.Thread run nil -1]],\r\n :cause\r\n ""class java.time.OffsetDateTime cannot be cast to class java.time.chrono.ChronoLocalDateTime (java.time.OffsetDateTime and java.time.chrono.ChronoLocalDateTime are in module java.base of loader \'bootstrap\')"",\r\n :message\r\n ""class java.time.OffsetDateTime cannot be cast to class java.time.chrono.ChronoLocalDateTime (java.time.OffsetDateTime and java.time.chrono.ChronoLocalDateTime are in module java.base of loader \'bootstrap\')""}\r\n ```', 'created_at': datetime.datetime(2024, 9, 16, 6, 13, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2352877233, 'issue_id': 2506480417, 'author': 'paoliniluis', 'body': '@BenjaminGK this is not the same issue', 'created_at': datetime.datetime(2024, 9, 16, 13, 9, 55, tzinfo=datetime.timezone.utc)}]","camsaul (Issue Creator) on (2024-09-04 23:37:41 UTC): CC @escherize as the original PR author

camsaul (Issue Creator) on (2024-09-04 23:39:27 UTC): The newest version of Kondo actually catches the output schemas being in the wrong place and warns about it. In #47418 I moved  the schema to the right place in the `mu/defn` and just commented out the parts of the schema causing the test failures. Not sure if this was the right thing to do or not -- whoever investigates can either remove that stuff completely or uncomment out that stuff and fix the function

BenjaminGK on (2024-09-16 06:13:57 UTC): @camsaul Not sure if it is related, but it seems we are getting an error due to this after upgrading to v50

```
[c00c0535-a69a-4d00-98d5-005b9a5b0451] 2024-09-16T13:09:14+07:00 ERROR metabase.server.middleware.log GET /api/activity/popular_items 500 34.5 ms (2 DB calls) {:metabase-user-id 11} 
{:via
 [{:type java.lang.ClassCastException,
   :message
   ""class java.time.OffsetDateTime cannot be cast to class java.time.chrono.ChronoLocalDateTime (java.time.OffsetDateTime and java.time.chrono.ChronoLocalDateTime are in module java.base of loader 'bootstrap')"",
   :at [java.time.LocalDateTime compareTo nil -1]}],
 :trace
 [[java.time.LocalDateTime compareTo nil -1]
  [clojure.lang.Util compare ""Util.java"" 153]
  [clojure.core$compare invokeStatic ""core.clj"" 842]
  [clojure.core$compare invoke ""core.clj"" 833]
  [clojure.lang.AFunction compare ""AFunction.java"" 51]
  [clojure.core$sort_by$fn__6045 invoke ""core.clj"" 3133]
  [clojure.lang.AFunction compare ""AFunction.java"" 51]
  [java.util.TimSort countRunAndMakeAscending nil -1]
  [java.util.TimSort sort nil -1]
  [java.util.Arrays sort nil -1]
  [clojure.core$sort invokeStatic ""core.clj"" 3117]
  [clojure.core$sort_by invokeStatic ""core.clj"" 3121]
  [clojure.core$sort_by invokeStatic ""core.clj"" 3121]
  [clojure.core$sort_by invoke ""core.clj"" 3121]
  [metabase.api.activity$views_and_runs invokeStatic ""activity.clj"" 108]
  [metabase.api.activity$views_and_runs invoke ""activity.clj"" 63]
  [metabase.api.activity$get_popular_items_model_and_id invokeStatic ""activity.clj"" 211]
  [metabase.api.activity$get_popular_items_model_and_id invoke ""activity.clj"" 202]
  [metabase.api.activity$fn__101692 invokeStatic ""activity.clj"" 238]
  [metabase.api.activity$fn__101692 invoke ""activity.clj"" 234]
  [compojure.core$wrap_response$fn__52754 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__52738 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__52743 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [metabase.server.middleware.auth$enforce_authentication$fn__97278 invoke ""auth.clj"" 18]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__52794 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__52798 invoke ""core.clj"" 300]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__52798 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [metabase.api.routes$fn__102954$fn__102957 invoke ""routes.clj"" 73]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__103234$fn__103235 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__52794 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__52798 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52747 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766$f__52767$respond_SINGLEQUOTE___52768 invoke ""core.clj"" 197]
  [metabase.server.routes$fn__103217$fn__103219 invoke ""routes.clj"" 47]
  [compojure.core$routes$fn__52766$f__52767 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52766 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__99312 invoke ""exceptions.clj"" 107]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__99309 invoke ""exceptions.clj"" 96]
  [metabase.server.middleware.log$log_api_call$fn__103521$fn__103522$fn__103523 invoke ""log.clj"" 233]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__103521$fn__103522 invoke ""log.clj"" 224]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__103521 invoke ""log.clj"" 223]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__106811 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__99268 invoke ""security.clj"" 246]
  [ring.middleware.json$wrap_json_body$fn__107070 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__87699 invoke ""offset_paging.clj"" 43]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__54361 invoke ""json.clj"" 83]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__107159 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__107178 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__64160 invoke ""misc.clj"" 59]
  [metabase.server.middleware.session$reset_session_timeout$fn__65711 invoke ""session.clj"" 548]
  [metabase.server.middleware.session$bind_current_user$fn__65677$fn__65678 invoke ""session.clj"" 443]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 422]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 405]
  [metabase.server.middleware.session$bind_current_user$fn__65677 invoke ""session.clj"" 442]
  [metabase.server.middleware.session$wrap_current_user_info$fn__65658 invoke ""session.clj"" 381]
  [metabase.server.middleware.session$wrap_session_id$fn__65630 invoke ""session.clj"" 259]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__97286 invoke ""auth.clj"" 32]
  [ring.middleware.cookies$wrap_cookies$fn__106998 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__64142 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__64168 invoke ""misc.clj"" 75]
  [ring.middleware.gzip$wrap_gzip$fn__107040 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.misc$bind_request$fn__64171 invoke ""misc.clj"" 91]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__106827 invoke ""ssl.clj"" 51]
  [metabase.server$async_proxy_handler$fn__71902 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run nil -1]],
 :cause
 ""class java.time.OffsetDateTime cannot be cast to class java.time.chrono.ChronoLocalDateTime (java.time.OffsetDateTime and java.time.chrono.ChronoLocalDateTime are in module java.base of loader 'bootstrap')"",
 :message
 ""class java.time.OffsetDateTime cannot be cast to class java.time.chrono.ChronoLocalDateTime (java.time.OffsetDateTime and java.time.chrono.ChronoLocalDateTime are in module java.base of loader 'bootstrap')""}
 ```

paoliniluis on (2024-09-16 13:09:55 UTC): @BenjaminGK this is not the same issue

"
2506425492,issue,closed,completed,Models treating text fields as booleans for filtering,"### Describe the bug

<img width=""314"" alt=""Screenshot 2024-09-04 at 5 31 16 PM"" src=""https://github.com/user-attachments/assets/f1326078-ec5d-456e-bc78-f12ee6c4d827"">

Since updating to Metabase 50 yesterday, I have a number of text/categorical fields in models that only want to filter as booleans (see example above), even after changing the table metadata and the column metadata in the model. This is leaving me unable to filter these fields at all. This happens both when I create a new model or I edit an existing model based on this table.

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

Unable to reproduce with sample database

### Expected behavior

Should align with the field values, not a boolean

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""snowflake"",
      ""postgres"",
      ""mysql"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-09-03"",
      ""tag"": ""v0.50.23.2"",
      ""hash"": ""95f1c3b""
    },
    ""settings"": {
      ""report-timezone"": ""UTC""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.12""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.223-212.873.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

Pretty severe; several models are not working because of this

### Additional context

_No response_",megansmcguire,2024-09-04 22:37:13+00:00,['ranquild'],2024-10-01 22:17:19+00:00,2024-09-05 18:21:30+00:00,https://github.com/metabase/metabase/issues/47639,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('.Backend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', '')]","[{'comment_id': 2330421830, 'issue_id': 2506425492, 'author': 'ranquild', 'body': ""Likely caused by https://github.com/metabase/metabase/pull/45674 and Snowflake's `VARIANT` type."", 'created_at': datetime.datetime(2024, 9, 5, 1, 24, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2330425304, 'issue_id': 2506425492, 'author': 'ranquild', 'body': '@megansmcguire meanwhile you could click ""Custom Expression"" when filtering and use custom expressions like `contains([Priority], ""P1"")`', 'created_at': datetime.datetime(2024, 9, 5, 1, 29, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2330433515, 'issue_id': 2506425492, 'author': 'megansmcguire', 'body': ""TY, should've thought of that! Will help for now"", 'created_at': datetime.datetime(2024, 9, 5, 1, 38, 50, tzinfo=datetime.timezone.utc)}, {'comment_id': 2334242205, 'issue_id': 2506425492, 'author': 'ranquild', 'body': 'The current state of things:\r\n1. For `VARIANT` columns, we will render a widget that allows you to use only `Is empty` and `Not empty` operators. You can use `Custom expression` and use any expression as long as the database can execute it.\r\n2. If you want to get typed columns, you would need to create a SQL model/question and explicitly cast the column. If you cast it to a number, you would get a widget with numeric operators like `Greater than` etc.', 'created_at': datetime.datetime(2024, 9, 6, 14, 55, 26, tzinfo=datetime.timezone.utc)}]","ranquild (Assginee) on (2024-09-05 01:24:58 UTC): Likely caused by https://github.com/metabase/metabase/pull/45674 and Snowflake's `VARIANT` type.

ranquild (Assginee) on (2024-09-05 01:29:13 UTC): @megansmcguire meanwhile you could click ""Custom Expression"" when filtering and use custom expressions like `contains([Priority], ""P1"")`

megansmcguire (Issue Creator) on (2024-09-05 01:38:50 UTC): TY, should've thought of that! Will help for now

ranquild (Assginee) on (2024-09-06 14:55:26 UTC): The current state of things:
1. For `VARIANT` columns, we will render a widget that allows you to use only `Is empty` and `Not empty` operators. You can use `Custom expression` and use any expression as long as the database can execute it.
2. If you want to get typed columns, you would need to create a SQL model/question and explicitly cast the column. If you cast it to a number, you would get a widget with numeric operators like `Greater than` etc.

"
2506165840,issue,closed,not_planned,Error in Question when a field no longer exists,"### Describe the bug

I`m using Questions selecting some fields.  If I change my table deleting fields and one of these selected fields no longer exists, the query breaks without automatically keeping the field in the calculation. 

### To Reproduce

1. Create a new Question.
2. Select a table - in my case, I am using BigQuery.
3. Select only a few fields.
4. Save the question.
5. In BigQuery, delete one of the selected fields.
6. Return to Metabase, synchronize the schema and field values (admin menu).
7. Go back to the Question, and the error appears:

```
400 Bad Request
POST https://bigquery.googleapis.com/bigquery/v2/projects/xxxxx/queries
{
  ""code"": 400,
  ""errors"": [
    {
      ""domain"": ""global"",
      ""location"": ""q"",
      ""locationType"": ""parameter"",
      ""message"": ""Name current_balance not found inside skill_dev.dev_teste_metabase_campo_alterado at [2:342]"",
      ""reason"": ""invalidQuery""
    }
  ],
  ""message"": ""Name current_balance not found inside skill_dev.dev_teste_metabase_campo_alterado at [2:342]"",
  ""status"": ""INVALID_ARGUMENT""
}
```

8. Upon opening the notebook editor, there is no option to remove the faulty field; it can only be removed by selecting all items.

![image](https://github.com/user-attachments/assets/c0ce87a3-421e-4e19-bd64-f245da025797)
![image](https://github.com/user-attachments/assets/f44ff9d7-d805-418d-a6a6-87e623e0ee9d)



### Expected behavior

When a field no longer exists, the query should remove it from the code instead of the user having to select all the fields and then select some of the fields again.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""pt-BR"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""bigquery-cloud-sdk"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-self-hosted-yearly"",
    ""version"": {
      ""date"": ""2024-08-29"",
      ""tag"": ""v1.50.23"",
      ""hash"": ""7040ff1""
    },
    ""settings"": {
      ""report-timezone"": ""America/Sao_Paulo""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.90+"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

annoying

### Additional context

_No response_",fer-batista,2024-09-04 19:57:10+00:00,[],2024-09-05 16:24:55+00:00,2024-09-05 16:24:54+00:00,https://github.com/metabase/metabase/issues/47633,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Metadata & Sync', ''), ('Querying/', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2329885547, 'issue_id': 2506165840, 'author': 'andrewillard', 'body': '+1', 'created_at': datetime.datetime(2024, 9, 4, 20, 11, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2329987665, 'issue_id': 2506165840, 'author': 'paoliniluis', 'body': ""@fer-batista if you're a paid customer, please contact us as bugs from paid customers get prioritized faster"", 'created_at': datetime.datetime(2024, 9, 4, 20, 48, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2332163279, 'issue_id': 2506165840, 'author': 'paoliniluis', 'body': 'duplicate of https://github.com/metabase/metabase/issues/12721', 'created_at': datetime.datetime(2024, 9, 5, 16, 24, 54, tzinfo=datetime.timezone.utc)}]","andrewillard on (2024-09-04 20:11:56 UTC): +1

paoliniluis on (2024-09-04 20:48:48 UTC): @fer-batista if you're a paid customer, please contact us as bugs from paid customers get prioritized faster

paoliniluis on (2024-09-05 16:24:54 UTC): duplicate of https://github.com/metabase/metabase/issues/12721

"
2505929096,issue,closed,completed,"If we export something that relies on an import from ""embedding-sdk"" the users of the sdk will see it types as any","Thread 1: https://metaboat.slack.com/archives/C063Q3F1HPF/p1723023805043939

Thread 2: https://metaboat.slack.com/archives/C063Q3F1HPF/p1725464383559709

",npretto,2024-09-04 17:28:50+00:00,['heypoom'],2024-10-08 16:15:26+00:00,2024-09-05 16:48:48+00:00,https://github.com/metabase/metabase/issues/47627,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2330939956, 'issue_id': 2505929096, 'author': 'heypoom', 'body': 'I think this is caused by the fixup script not fixing up ""embedding-sdk"" references.\r\n\r\n![image](https://github.com/user-attachments/assets/216b6c8c-6c75-4c1d-bb36-1607c846e694)', 'created_at': datetime.datetime(2024, 9, 5, 8, 38, 22, tzinfo=datetime.timezone.utc)}]","heypoom (Assginee) on (2024-09-05 08:38:22 UTC): I think this is caused by the fixup script not fixing up ""embedding-sdk"" references.

![image](https://github.com/user-attachments/assets/216b6c8c-6c75-4c1d-bb36-1607c846e694)

"
2505810324,issue,closed,completed,Font inside <MetabaseProvider> is changed even for customer's components. Metabase components don't use the default metabase font by default,"Example:
<img width=""959"" alt=""image"" src=""https://github.com/user-attachments/assets/13dec702-a0ca-4721-bcc5-38b1560c0ac2"">

I'm also seeing a background color that I haven't set.

The weirdest thing is that I haven't set any custom theme and we're still not rendering metabase with the same font of what we have internally:
<img width=""1347"" alt=""image"" src=""https://github.com/user-attachments/assets/e12b5046-a5fe-4159-96a3-973a456afa6b"">


Compared to how it looks internally on metabase:
<img width=""1255"" alt=""image"" src=""https://github.com/user-attachments/assets/326f56f1-0323-4f04-8dac-9cea0e16198b"">


As as user this would confuse me, I would expect that by default it should show as it does inside metabase",npretto,2024-09-04 16:22:20+00:00,['npretto'],2024-09-30 11:49:14+00:00,2024-09-30 11:49:14+00:00,https://github.com/metabase/metabase/issues/47624,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2352189994, 'issue_id': 2505810324, 'author': 'npretto', 'body': ""Should have been fixed by https://github.com/metabase/metabase/pull/47764\r\nI'll keep it open until we add the tests"", 'created_at': datetime.datetime(2024, 9, 16, 7, 27, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2382968181, 'issue_id': 2505810324, 'author': 'npretto', 'body': ""I'll close this as I added tests with https://github.com/metabase/metabase/pull/48071"", 'created_at': datetime.datetime(2024, 9, 30, 11, 49, 14, tzinfo=datetime.timezone.utc)}]","npretto (Issue Creator) on (2024-09-16 07:27:04 UTC): Should have been fixed by https://github.com/metabase/metabase/pull/47764
I'll keep it open until we add the tests

npretto (Issue Creator) on (2024-09-30 11:49:14 UTC): I'll close this as I added tests with https://github.com/metabase/metabase/pull/48071

"
2505707867,issue,open,,Have a way to add up negative and positive totals when stacking Bar charts,"**Is your feature request related to a problem? Please describe.**
If you have a series breakout that has negative points, then when you stack and select show values on data points, you'll see that the ""Total"" adds up for the positive and negative values separately.
![Screenshot 2024-09-04 at 12 34 18 PM](https://github.com/user-attachments/assets/3506a3aa-21cf-4b84-a2d8-2fa685ee8182)

**Describe the solution you'd like**
A customer wishes to have this unified and show the sum of positive and negative values, instead of two different values.

**Describe alternatives you've considered**
N/A

**How important is this feature to you?**
Context [here](https://metaboat.slack.com/archives/C07DF9QKMV5/p1725456768027019).

**Additional context**
N/A
",ignacio-mb,2024-09-04 15:34:52+00:00,[],2025-02-04 20:31:26+00:00,,https://github.com/metabase/metabase/issues/47621,"[('Type:New Feature', ''), ('Visualization/Chart Settings', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.')]",[],
2505511028,issue,closed,completed,Minified React Error on embedding Questions,"### Describe the bug

A Minified React Error is popping out on 50 for some questions. It could be related to data that our react app is not able to handle. Question works on metabase without issues

### To Reproduce

I am using a csv output from a customer.

1) Upload the csv [test_dataset.csv](https://github.com/user-attachments/files/16868877/test_dataset.csv) to metabase
2) Go to New -> Question using this data -> Bar Chart -> X-Axis Month and the Y-Axis Owner Earnings same as below:

<img width=""1501"" alt=""image"" src=""https://github.com/user-attachments/assets/2ecc04f9-e96a-449f-a3f7-db5e435c4bb3"">

3) Go to Embedding -> Preview

<img width=""1506"" alt=""image"" src=""https://github.com/user-attachments/assets/ca6706dd-3be0-4706-9517-3282493e0c78"">

Fails both on preview and on actual embedding with error `Minified React error #185; visit https://reactjs.org/docs/error-decoder.html?invariant=185 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`



### Expected behavior

The Question loads 

### Logs

Nothing on the backend everything frontend:

`Minified React error #185; visit https://reactjs.org/docs/error-decoder.html?invariant=185 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`

### Information about your Metabase installation

```JSON
50.24
```


### Severity

Broke some questions of a customer and potentially other customers will reachout. This was working on 49

### Additional context

_No response_",Tony-metabase,2024-09-04 14:19:09+00:00,[],2024-09-06 18:10:43+00:00,2024-09-06 18:10:43+00:00,https://github.com/metabase/metabase/issues/47617,"[('Type:Bug', 'Product defects'), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Escalation', ''), ('.Team/Embedding', '')]","[{'comment_id': 2329245606, 'issue_id': 2505511028, 'author': 'WiNloSt', 'body': 'Can\'t reproduce with `master` @ c86e4b3fa394af347ead1d8953d75a697a49262e\r\n<img width=""1181"" alt=""Screenshot 2024-09-04 at 9 29 25\u202fPM"" src=""https://github.com/user-attachments/assets/840ad6ce-4a56-42ef-8734-3cee794e871c"">\r\n\r\nBut can reproduce with `release-x.50.x` @ d40b0287c95fb3433b97c42ec05f08f5fde3263f\r\n<img width=""1161"" alt=""Screenshot 2024-09-04 at 9 34 22\u202fPM"" src=""https://github.com/user-attachments/assets/a4ed9d23-33aa-4af9-ba86-d35691f487da"">', 'created_at': datetime.datetime(2024, 9, 4, 14, 36, 32, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2024-09-04 14:36:32 UTC): Can't reproduce with `master` @ c86e4b3fa394af347ead1d8953d75a697a49262e
<img width=""1181"" alt=""Screenshot 2024-09-04 at 9 29 25 PM"" src=""https://github.com/user-attachments/assets/840ad6ce-4a56-42ef-8734-3cee794e871c"">

But can reproduce with `release-x.50.x` @ d40b0287c95fb3433b97c42ec05f08f5fde3263f
<img width=""1161"" alt=""Screenshot 2024-09-04 at 9 34 22 PM"" src=""https://github.com/user-attachments/assets/a4ed9d23-33aa-4af9-ba86-d35691f487da"">

"
2505414522,issue,closed,completed,Always allow `localhost:*` in `embedding-app-origin`,"> [!note]
> The work in the PR should be replaced by the work in https://github.com/metabase/metabase/issues/46970 when merged.

This is a follow up task for https://github.com/metabase/metabase/pull/47229. As a temporary measure as the actual work would be implemented in https://github.com/metabase/metabase/issues/46970, but that feature won't be merged to `master` until we feel ready.

Without this, we won't be able to test the CLI without valid enterprise token, because without valid tokens, users can't modify `embedding-app-origin`.

",WiNloSt,2024-09-04 13:40:32+00:00,['WiNloSt'],2024-10-01 22:16:51+00:00,2024-09-06 08:55:09+00:00,https://github.com/metabase/metabase/issues/47615,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2505171377,issue,closed,completed,Bug in Cumulative Sum Calculation in Metabase v0.50,"### Describe the bug

I've encountered a bug with the cumulative sum calculation in Metabase version 0.50.xx that didn't exist in version 0.48 (I use 0.50.18 version)

In version 0.48, creating a cumulative sum of quantities sorted by categories worked correctly. However, in version 0.50, the cumulative sum does not sort properly

i have post this in discourse : 
https://discourse.metabase.com/t/bug-in-cumulative-sum-calculation-in-metabase-v0-50/144567/10

### To Reproduce


![image](https://github.com/user-attachments/assets/c38f4039-23d8-4da5-850f-d56db647269d)



herebelow is SQL code autogenerate by metabase 0.50.17

SELECT
""source"".""Products__CATEGORY"" AS ""Products__CATEGORY"",
SUM(""source"".""QUANTITY"") AS ""sum"",
SUM(SUM(""source"".""QUANTITY"")) OVER (

ORDER BY
""source"".""Products__CATEGORY"" ASC ROWS UNBOUNDED PRECEDING
) AS ""sum_2""
FROM
(
SELECT
""Products"".""CATEGORY"" AS ""Products__CATEGORY"",
""PUBLIC"".""ORDERS"".""QUANTITY"" AS ""QUANTITY""
FROM
""PUBLIC"".""ORDERS""

LEFT JOIN ""PUBLIC"".""PRODUCTS"" AS ""Products"" ON ""PUBLIC"".""ORDERS"".""PRODUCT_ID"" = ""Products"".""ID""
) AS ""source""
GROUP BY
""source"".""Products__CATEGORY""
ORDER BY
""sum"" DESC,
""source"".""Products__CATEGORY"" ASC

this is the screenshot
![image](https://github.com/user-attachments/assets/1ddb2fb4-d55a-4762-a1b7-7c71466747a4)




### Expected behavior

Expected result: The cumulative sum should start with the value 18.920 as the first row (corresponding to the sum quantity column), but the result was started with 69540

as comparation, using the same steps in producing the cumulative with 0.48 herebelow SQL code autogenerate by metabase 0.48

SELECT
  ""Products"".""CATEGORY"" AS ""Products__CATEGORY"",
  SUM(""PUBLIC"".""ORDERS"".""QUANTITY"") AS ""sum"",
  SUM(""PUBLIC"".""ORDERS"".""QUANTITY"") AS ""sum_2""
FROM
  ""PUBLIC"".""ORDERS""
 
LEFT JOIN ""PUBLIC"".""PRODUCTS"" AS ""Products"" ON ""PUBLIC"".""ORDERS"".""PRODUCT_ID"" = ""Products"".""ID""
GROUP BY
  ""Products"".""CATEGORY""
ORDER BY
  ""sum"" DESC,
  ""Products"".""CATEGORY"" ASC

screenshot : 
https://discourse.metabase.com/uploads/default/original/3X/9/c/9cbd5b5440140011a7317830e71217625f93a0c4.png

the result is correct.
you can see the difference.
I think this is big issue that make metabase don't have ability to make pareto diagram anymore. Which is common in analytic jobs

### Logs

_No response_

### Information about your Metabase installation

```JSON
Metabase Version 0.50.18 
Server in our own Using Ubuntu 20.04 Server LTS, and the database is MariaDB 10.1x
```


### Severity

I think this is substantial problem, Urgent to resolve

### Additional context

_No response_",ceereme,2024-09-04 12:11:19+00:00,['metamben'],2024-09-18 02:46:29+00:00,2024-09-13 23:15:12+00:00,https://github.com/metabase/metabase/issues/47613,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Team/Querying', '')]","[{'comment_id': 2330435157, 'issue_id': 2505171377, 'author': 'cbeauch', 'body': ""We're having a different SUM issue since updating.\r\n\r\n`Partitioning by expressions of type FLOAT64 is not allowed at [13:5]`\r\n\r\n```\r\nSUM(SUM(source.amount)) OVER (\r\nPARTITION BY source.dateCreated,\r\nsource.reserve_event_type,\r\nsource.reserve_event_status,\r\nsource.amount,\r\nsource.notes,\r\nsource.reserve_event_id\r\n```\r\n\r\nThis occured after we updated to 0.50 for a bunch of questions. Unsure if the questions themselves were changed during the update or if something else is going on but I know the table did not change."", 'created_at': datetime.datetime(2024, 9, 5, 1, 40, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2357383968, 'issue_id': 2505171377, 'author': 'ceereme', 'body': 'Thank you very much to the entire Metabase team for resolving this bug. I look forward to the updated version', 'created_at': datetime.datetime(2024, 9, 18, 2, 46, 28, tzinfo=datetime.timezone.utc)}]","cbeauch on (2024-09-05 01:40:56 UTC): We're having a different SUM issue since updating.

`Partitioning by expressions of type FLOAT64 is not allowed at [13:5]`

```
SUM(SUM(source.amount)) OVER (
PARTITION BY source.dateCreated,
source.reserve_event_type,
source.reserve_event_status,
source.amount,
source.notes,
source.reserve_event_id
```

This occured after we updated to 0.50 for a bunch of questions. Unsure if the questions themselves were changed during the update or if something else is going on but I know the table did not change.

ceereme (Issue Creator) on (2024-09-18 02:46:28 UTC): Thank you very much to the entire Metabase team for resolving this bug. I look forward to the updated version

"
2504921902,issue,open,,Proof-of-concept for auto-generating API documentation from types and comments for the embedding sdk,Let's try to make a proof-of-concept for auto-generating API documentation from types and comments for the embedding sdk. Refer to this [product document](https://www.notion.so/metabase/API-docs-for-the-SDK-auto-generated-from-code-f7a54dab49b14bedb83d9d90d9a8cea9?pvs=4).,heypoom,2024-09-04 10:23:49+00:00,[],2025-02-04 20:25:55+00:00,,https://github.com/metabase/metabase/issues/47610,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2504474020,issue,open,,"Scalar metric — render value as is, tooltip: `Overall`",,romeovs,2024-09-04 07:00:32+00:00,[],2024-09-04 07:00:32+00:00,,https://github.com/metabase/metabase/issues/47603,[],[],
2504406233,issue,open,,"Unfolding JSON causes error when first key is called ""case""","**Describe the bug**
We're unfolding JSON in custom columns and our first JSON key is called ""case"". 
When this column is added, we get the error: `nth not supported on this type: Character`

![Screenshot 2024-09-04 at 3 46 06 PM](https://github.com/user-attachments/assets/819c7efc-bfb6-4dd6-99b1-252756be2738)

This appears to be because when unfolding JSON, the auto-generated query uses parameters for the JSON keys being added as columns, and when 'case' is passed as the first parameter in the list it converts it to a `:case` clause, instead of using 'case' as a value.

This does not happen when the columns are re-ordered so that 'case' is not first.


**Logs**
From the logs, I can see the compiled query is like:
```
SELECT (\""db\"".\""table\"".\""jsonColumn\""#>> array[?, ?]::text[])::text AS \""jsonColumn → case → foo\"", 
(\""db\"".\""table\"".\""jsonColumn\""#>> array[?, ?]::text[])::text AS \""jsonColumn → case → bah\"", 
(\""db\"".\""table\"".\""jsonColumn\""#>> array[?, ?]::text[])::text AS \""jsonColumn → otherKey → foo\"", 
(\""db\"".\""table\"".\""jsonColumn\""#>> array[?, ?]::text[])::text AS \""jsonColumn → otherKey → bah\"", 
FROM \""db\"".\""table\"" LIMIT 2000"", 
```
With params of:
```
:params (""case"" ""foo"" ""case"" ""bah"" ""otherKey"" ""foo"" ""otherKey"" ""bah"")
```

And the error is:
```
Invalid clause: [:case foo case bah otherKey foo otherKey bah]
```

Then I believe the `nth not supported on this type: Character` error is coming from `legacy_mbql.normalize$canonicalize_mbql_clauses$fn__28991.invoke(normalize.cljc:710)` in the stack trace.

**To Reproduce**
1. Make a table with a json column 
2. Add records with payloads that have keys, the first of which (alphabetically) being 'case'
3. Set ""Unfold JSON"" to ""Yes"" for that field in the Admin Settings (Table Metadata)
![Screenshot 2024-09-04 at 4 02 09 PM](https://github.com/user-attachments/assets/7946df25-9ade-47de-9e07-0990e51fcf6e)
4. Try to load the view for that table.

Note: If it's not breaking, check that the ""case"" column is the first one of the unfolded JSON columns.

**Expected behavior**
Viewing the table as normal without any errors when ""jsonColumn → case → foo"" is the first unfolded JSON column.

**Severity**
We have worked around it by changing the sorting order of the columns, but are concerned by the risk associated with not sanitising parameters correctly.

**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""en-AU"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""googleanalytics"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-29"",
      ""tag"": ""v0.50.23"",
      ""hash"": ""7040ff1""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.10""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.223-212.873.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```",beccu-dev,2024-09-04 06:17:48+00:00,[],2024-09-04 06:17:48+00:00,,https://github.com/metabase/metabase/issues/47601,[],[],
2504116948,issue,closed,completed,[FE] Extract MetricEditor as a separate component,,ranquild,2024-09-04 01:41:24+00:00,['ranquild'],2024-10-03 11:58:14+00:00,2024-10-03 11:58:14+00:00,https://github.com/metabase/metabase/issues/47600,[],[],
2503914468,issue,open,,Negative data labels overlap with x-axis labels at certain dashcard sizes,"## Context
More details in [this thread](https://metaboat.slack.com/archives/C064QMXEV9N/p1725344123923459). Basically when bar charts are represented at certain dashcard sizes, with negative numbers, the data labels and axis labels run into eachother and look very rough.",cdeweyx,2024-09-03 22:25:45+00:00,[],2025-02-04 20:31:24+00:00,,https://github.com/metabase/metabase/issues/47597,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/', ''), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2503906285,issue,open,,Stacked bar chart with mixed negative and positive values creates nonsensical percentage breakdowns in tooltips,"## Context
It's confusing that we are presenting a “parts of the whole” calculation when there are negative numbers in the mix. We should omit them or take the absolute value if all are negative. More details on the desired approach in the thread below.

[Thread](https://metaboat.slack.com/archives/C064QMXEV9N/p1725282199004319)
[Example](https://stats.metabase.com/question#eyJkYXRhc2V0X3F1ZXJ5Ijp7ImRhdGFiYXNlIjoxLCJ0eXBlIjoicXVlcnkiLCJxdWVyeSI6eyJzb3VyY2UtdGFibGUiOjEsImFnZ3JlZ2F0aW9uIjpbWyJhdmciLFsiZmllbGQiLDE4LHsiYmFzZS10eXBlIjoidHlwZS9GbG9hdCJ9XV0sWyJhZ2dyZWdhdGlvbi1vcHRpb25zIixbIioiLFsiY291bnQiXSwtMV0seyJuYW1lIjoiTmVnYXRpdmUgQ291bnQiLCJkaXNwbGF5LW5hbWUiOiJOZWdhdGl2ZSBDb3VudCJ9XV0sImJyZWFrb3V0IjpbWyJmaWVsZCIsMjUseyJiYXNlLXR5cGUiOiJ0eXBlL0RhdGVUaW1lIiwidGVtcG9yYWwtdW5pdCI6Im1vbnRoIn1dXX19LCJkaXNwbGF5IjoiYmFyIiwiZGlzcGxheUlzTG9ja2VkIjp0cnVlLCJ2aXN1YWxpemF0aW9uX3NldHRpbmdzIjp7InN0YWNrYWJsZS5zdGFja190eXBlIjoic3RhY2tlZCJ9LCJ0eXBlIjoicXVlc3Rpb24ifQ==)

![Image](https://github.com/user-attachments/assets/bc20e6e4-8c3e-47af-86e3-f2ff3ccb666d)

",cdeweyx,2024-09-03 22:20:03+00:00,[],2025-02-04 20:31:19+00:00,,https://github.com/metabase/metabase/issues/47596,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/', ''), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2503904035,issue,closed,completed,Can't see vertical and/or horizontal scrollbar in pivot chart,"### Describe the bug

As you can see, there are no scrollbars.
![Screenshot from 2024-09-04 00-11-57](https://github.com/user-attachments/assets/335c9eff-59e2-4bac-998c-434d47cf80af)

The same chart shows scrollbars correctly when put inside a dashboard
![Screenshot from 2024-09-04 00-15-33](https://github.com/user-attachments/assets/3bb11c0d-416a-48b5-8eb1-984417ce5868)


### To Reproduce

1. Create new chart
2. Select pivot as visualization
3. Notice no scrollbars when expected

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
- Metabase 0.50.23 on Docker container running on Ubuntu 24.04
- Browser: Chromium/Firefox on Ubuntu 24.04
```


### Severity

Can't explore data on a pivot if mouse has no horizontal scrolling capability

### Additional context

_No response_",ilvenini,2024-09-03 22:18:30+00:00,['alxnddr'],2024-10-01 22:19:38+00:00,2024-09-05 01:52:54+00:00,https://github.com/metabase/metabase/issues/47595,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Visualization/', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2503626891,issue,closed,completed,[FE] Add metric-specific visualization empty state,Figma https://www.figma.com/design/Elev9KzNuxxtAG586dLqYO/Metrics-V2-in-0.51?node-id=8530-2143&node-type=FRAME&t=yKb29BzN6PaDAeXR-0,ranquild,2024-09-03 19:34:24+00:00,['ranquild'],2024-10-08 16:15:25+00:00,2024-09-05 19:23:51+00:00,https://github.com/metabase/metabase/issues/47588,[],[],
2503591716,issue,open,,Figure out a better approach for ensuring `updated_at` is updated accurately on models,"**Context**

https://github.com/metabase/metabase/issues/47582 was caused by new logic in 50 which sets `last_used_at` on a Card whenever it is accessed. However this unintentionally resulted in setting `updated_at` much more often than necessary, which then had a downstream effect of invalidating saved field values for sandboxed users after every dashboard load.

We should figure out a better approach for ensuring `updated_at` is only set when the appropriate fields are updated, instead of grandfathering in every new field, since it can have wide-ranging consequences.",noahmoss,2024-09-03 19:16:00+00:00,[],2025-02-04 20:29:49+00:00,,https://github.com/metabase/metabase/issues/47586,"[('Type:Tech Debt', 'or Refactoring'), ('.Performance', ''), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('postmortem-followup', '')]",[],
2503571815,issue,closed,completed,We don't like long column names in models,"### Describe the bug

If you have a very big column name, turning the query into a model will make the query to fail

### To Reproduce

1) create a sql question like
```
select count(*) as coun, state as Total_number_of_people_from_each_state_separated_by_state_and_then_we_do_a_count from people
group by Total_number_of_people_from_each_state_separated_by_state_and_then_we_do_a_count
```
2) save it as a model
3) see the error

### Expected behavior

we should honor the name of the columns

### Logs

NA

### Information about your Metabase installation

```JSON
v50
```


### Severity

P1

### Additional context

A customer mentioned that this is a regression",paoliniluis,2024-09-03 19:04:23+00:00,['appleby'],2024-09-16 15:43:22+00:00,2024-09-16 15:43:22+00:00,https://github.com/metabase/metabase/issues/47584,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Processor', ''), ('.Backend', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Escalation', ''), ('.Team/Querying', '')]",[],
2503555373,issue,closed,completed,A sandboxed user's field values become invalidated shortly after every dashboard load,"### Describe the bug

If you're a sandboxed user, and you're viewing a dashboard with filters that require field values, we store a separate copy of field values identified by a hash. This hash incorporates the `updated_at` value of the card that powers the sandbox.

We are needlessly modifying `updated_at` when setting `last_used_at` on a card after it is used. This results in the field values hash changing every time a dashboard is loaded.

### To Reproduce

1. Set up sandboxing for a table using a saved question as the base for the sandbox
2. Create a dashboard that includes a card that queries the sandboxed table, and at least one filter (using a dropdown list of values) attached to the card
3. Log in as the sandboxed user and open the dashboard
4. Look at the `metabase_fieldvalues` table to see the entry for the stored sandboxed field values. Here's a convenient query for this:
```
SELECT
  fv.id,
  field_id,
  type,
  hash_key,
  mf.name
FROM
  metabase_fieldvalues fv
  JOIN metabase_field mf ON mf.id = fv.field_id
WHERE
  type = 'sandbox';
```
5. Wait ~30 seconds, and then refresh the dashboard
6. You should see duplicate entries for the fields with new hashes

### Expected behavior

The hash should stay valid as long as the card definition has not actually been updated.

### Logs

_No response_

### Information about your Metabase installation

```JSON
Current master `7fee2ecfde`
```


### Severity

P1

### Additional context

_No response_",noahmoss,2024-09-03 18:55:29+00:00,['noahmoss'],2024-09-03 18:58:20+00:00,2024-09-03 18:58:20+00:00,https://github.com/metabase/metabase/issues/47582,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('Administration/Data Sandboxes', 'Enterprise Sandboxing')]",[],
2503417984,issue,closed,completed,Include temporal bucket/binning name in query_metadata for a card,"Epic https://github.com/metabase/metabase/issues/46536
Slack thread https://metaboat.slack.com/archives/C0645JP1W81/p1725385223657789

When there are multiple breakouts of the same column in the source card, all metadata columns would have the same name. Like this:

<img width=""906"" alt=""Screenshot 2024-09-03 at 13 37 34"" src=""https://github.com/user-attachments/assets/9b73ae94-4f5b-4ec4-8ce5-9afeb99a41a3"">

We should forcefully include the temporal bucket or binning name in card column names, similar to how MBQL lib does that for columns from the previous stage. 

The same should happen with query results columns. Currently the FE computes the `: Year`-style suffixes in some cases, but it's unreliable and only works for same-stage columns. The BE should return column names with temporal unit + binning info included.

Date: 2024-09-06
Commit: 38dcee804c0009f14e51a077b7338df6a5846dea
Version: Pre-0.51",ranquild,2024-09-03 17:36:09+00:00,['lbrdnk'],2024-12-11 09:03:48+00:00,2024-12-05 17:28:40+00:00,https://github.com/metabase/metabase/issues/47579,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2535243589, 'issue_id': 2503417984, 'author': 'github-actions[bot]', 'body': '🚀 This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)', 'created_at': datetime.datetime(2024, 12, 11, 9, 3, 48, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-11 09:03:48 UTC): 🚀 This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)

"
2503395552,issue,closed,completed,Wrong column names in query results,"Epic https://github.com/metabase/metabase/issues/46536

There are several cases where the QP generates the `:display_name` incorrectly when there are multiple breakouts of the same column. Look for TODOs in this test suite https://github.com/metabase/metabase/blob/c2dc11b1b48592e9327f412f1155440698a27fda/e2e/test/scenarios/question/multiple-column-breakouts.cy.spec.ts#L1046

In the scope of this task we should only fix display names of columns where we already include temporal units / binning and leave other cases unchanged. 

Date: 2024-09-06
Commit: 38dcee804c0009f14e51a077b7338df6a5846dea
Version: Pre-0.51",ranquild,2024-09-03 17:22:57+00:00,[],2025-01-27 20:11:35+00:00,2025-01-27 12:51:58+00:00,https://github.com/metabase/metabase/issues/47576,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2369394011, 'issue_id': 2503395552, 'author': 'mngr', 'body': '<img width=""1600"" alt=""Captura de ecrã 2024-09-23, às 22 06 41"" src=""https://github.com/user-attachments/assets/97b573b4-f1f9-4cbe-8c3e-a6d2bd1163f7"">\r\nWill this be fixed here?', 'created_at': datetime.datetime(2024, 9, 23, 21, 9, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2615682073, 'issue_id': 2503395552, 'author': 'lbrdnk', 'body': 'Fixed by https://github.com/metabase/metabase/pull/48946.', 'created_at': datetime.datetime(2025, 1, 27, 12, 51, 58, tzinfo=datetime.timezone.utc)}]","mngr on (2024-09-23 21:09:52 UTC): <img width=""1600"" alt=""Captura de ecrã 2024-09-23, às 22 06 41"" src=""https://github.com/user-attachments/assets/97b573b4-f1f9-4cbe-8c3e-a6d2bd1163f7"">
Will this be fixed here?

lbrdnk on (2025-01-27 12:51:58 UTC): Fixed by https://github.com/metabase/metabase/pull/48946.

"
2503395437,issue,closed,completed,[BE] Cannot select/deselect columns coming from the source card when there are multiple breakouts of the same column,"Skipped e2e test https://github.com/metabase/metabase/blob/c2dc11b1b48592e9327f412f1155440698a27fda/e2e/test/scenarios/question/multiple-column-breakouts.cy.spec.ts#L1758

When the source card contains multiple breakouts for the same column, deselecting a field leads to loss of `:selected` state for columns coming from `Lib.visibleColumns`. The problem:
1. deselection creates a `:fields` clause in the query
2. `returned-columns` now have `:lib/source :source/fields` and not `:source/card`
3. `column-metadata->field-ref` generates field id-based field refs and not based on the `:lib/desired-column-alias` for `returned-columns`; these field refs are fully identical now
4. `find-matching-column` cannot disambiguate the field refs.",ranquild,2024-09-03 17:22:54+00:00,['ranquild'],2024-10-08 16:15:34+00:00,2024-09-04 16:15:54+00:00,https://github.com/metabase/metabase/issues/47575,"[('Querying/MBQL', '')]",[],
2503272437,issue,closed,completed,Update static embed locked parameter default value in the code,"Based on https://github.com/metabase/metabase/issues/47436#issuecomment-2324431950, since the fix of https://github.com/metabase/metabase/issues/40292. We reverted the behavior for locked parameter values to `null` on locked parameters so that it will not render the card.

So it makes sense to update the default value to `[]` instead which will allow rendering the card, otherwise, the preview will break.
![image](https://github.com/user-attachments/assets/f5ebc5a7-c1dc-4c56-a30c-43d547800c9d)
",WiNloSt,2024-09-03 16:13:17+00:00,['WiNloSt'],2024-09-04 14:07:35+00:00,2024-09-04 13:35:21+00:00,https://github.com/metabase/metabase/issues/47570,[],[],
2503158635,issue,closed,completed,Grid color in the EditableDashboard component should be themeable in the sdk,"Editable dashboard's grid can look out of place in pages with different background colors, so the grid colors should follow the theme.

![Image](https://github.com/user-attachments/assets/3e30305c-c62a-4783-be89-35226c426a4b)

",heypoom,2024-09-03 15:21:12+00:00,['heypoom'],2025-01-10 13:37:20+00:00,2024-12-23 17:08:13+00:00,https://github.com/metabase/metabase/issues/47567,"[('Type:New Feature', ''), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2582731785, 'issue_id': 2503158635, 'author': 'github-actions[bot]', 'body': '🚀 This should also be released by [v0.52.5](https://github.com/metabase/metabase/milestone/296)', 'created_at': datetime.datetime(2025, 1, 10, 13, 37, 19, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2025-01-10 13:37:19 UTC): 🚀 This should also be released by [v0.52.5](https://github.com/metabase/metabase/milestone/296)

"
2503097741,issue,open,,useAdminSetting hook,"```ts
const {
  settingValue,
  settingInfo,
  updateSetting, // function
} = useAdminSetting(""my-setting-name"");


const {
  settingValues, // map
  settingsInfo, // map
  updateSettings, // function
} = useAdminSettings([""my-setting-name"", ""my-other-setting-name""]);

```",iethree,2024-09-03 14:53:32+00:00,[],2024-09-03 14:56:28+00:00,,https://github.com/metabase/metabase/issues/47566,[],[],
2503093578,issue,open,,remove deprecated MetabaseSettings usages,"Except in very rare cases, we should not be duplicating redux state in a global window object
 
- #47433
- https://github.com/metabase/metabase/pull/47510
- [ ] all the rest of them (70 uses in 44 files left)",iethree,2024-09-03 14:51:51+00:00,['iethree'],2025-02-04 20:29:48+00:00,,https://github.com/metabase/metabase/issues/47565,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', '')]",[],
2502970311,issue,closed,completed,No loading state after clicking visualize when creating question in the sdk,"When clicking on the ""Visualize"" button in the Notebook Editor in the InteractiveQuestion component, we don't get any feedback until the question has been visualized. We should either flip to the ""Visualization"" tab immediately to use its loading state, or have some loading state in the Visualize button itself.

<div>
    <a href=""https://www.loom.com/share/a3b6fdeec06d49448e2a5654efee5420"">
      <p>Clicking on Visualize while in the Notebook Editor takes time before the viz is shown - Watch Video</p>
    </a>
    <a href=""https://www.loom.com/share/a3b6fdeec06d49448e2a5654efee5420"">
      <img style=""max-width:300px;"" src=""https://cdn.loom.com/sessions/thumbnails/a3b6fdeec06d49448e2a5654efee5420-aa1389ac85e9c978-full-play.gif"">
    </a>
  </div>",heypoom,2024-09-03 14:02:41+00:00,['heypoom'],2024-11-25 20:21:23+00:00,2024-11-25 19:37:58+00:00,https://github.com/metabase/metabase/issues/47564,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2502952980,issue,closed,completed,"The InteractiveQuestion component throws ""converting :aggregation reference: no aggregation at index 0""","When the question is being drilled-down for the first time when there is no data yet, and the ""Doing Science..."" loading indicator is showing, there is a Warning icon shown in the component while the loading indicator also shows.

The warning icon bug appears to be caused by this optimization PR: https://github.com/metabase/metabase/pull/46652. Since that PR, it starts to throw this error `converting :aggregation reference: no aggregation at index 0` in the dev console. This also results in an uncaught runtime error overlay screen in create-react-app in the sample React app.

![Image](https://github.com/user-attachments/assets/3c5bdaba-9768-45f4-b7a8-bb6f2d1e8f99)

![Image](https://github.com/user-attachments/assets/b8a89d2a-6551-43c8-bb61-1df714ede573)

",heypoom,2024-09-03 13:55:43+00:00,['deniskaber'],2024-10-24 11:20:40+00:00,2024-10-24 11:20:40+00:00,https://github.com/metabase/metabase/issues/47563,"[('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2349689763, 'issue_id': 2502952980, 'author': 'heypoom', 'body': 'There seems to be an error: _Error converting :aggregation reference: no aggregation at index 0_', 'created_at': datetime.datetime(2024, 9, 13, 17, 58, 41, tzinfo=datetime.timezone.utc)}]","heypoom (Issue Creator) on (2024-09-13 17:58:41 UTC): There seems to be an error: _Error converting :aggregation reference: no aggregation at index 0_

"
2502944386,issue,closed,completed,Add a loading state in the ModifyQuestion component when the question is being loaded,"When the question is being loaded in ModifyQuestion, we are left with a brief period where the question editor becomes empty. Should we add a loading state here?

<div>
    <a href=""https://www.loom.com/share/7c12d5adab7f4205b1e2bd326c0096d5"">
      <p>Should we add a loading state in ModifyQuestion - Watch Video</p>
    </a>
    <a href=""https://www.loom.com/share/7c12d5adab7f4205b1e2bd326c0096d5"">
      <img style=""max-width:300px;"" src=""https://cdn.loom.com/sessions/thumbnails/7c12d5adab7f4205b1e2bd326c0096d5-820e83a1a0de5380-full-play.gif"">
    </a>
  </div>",heypoom,2024-09-03 13:52:04+00:00,[],2024-11-15 14:24:41+00:00,2024-11-15 14:24:22+00:00,https://github.com/metabase/metabase/issues/47562,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2426477192, 'issue_id': 2502944386, 'author': 'oisincoveney', 'body': ""@heypoom i think we should close this one since we'll probably nuke ModifyQuestion soon?"", 'created_at': datetime.datetime(2024, 10, 21, 12, 2, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2479010063, 'issue_id': 2502944386, 'author': 'albertoperdomo', 'body': 'ModifyQuestion has been deprecated.', 'created_at': datetime.datetime(2024, 11, 15, 14, 24, 40, tzinfo=datetime.timezone.utc)}]","oisincoveney on (2024-10-21 12:02:44 UTC): @heypoom i think we should close this one since we'll probably nuke ModifyQuestion soon?

albertoperdomo on (2024-11-15 14:24:40 UTC): ModifyQuestion has been deprecated.

"
2502936536,issue,closed,completed,Notebook editor's entity picker button and the pick columns button is different in size in the sdk,"In the notebook editor, the button for entity picker and the ""pick columns"" button directly on the right size has a slight size difference. It is supposed to be of equal size.

![CleanShot 2567-09-03 at 20 47 38@2x](https://github.com/user-attachments/assets/dbd21aad-b7ed-4188-b542-fbc218afe7a1)
",heypoom,2024-09-03 13:48:42+00:00,['npretto'],2024-10-08 16:14:04+00:00,2024-10-01 07:46:35+00:00,https://github.com/metabase/metabase/issues/47561,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2383047224, 'issue_id': 2502936536, 'author': 'npretto', 'body': ""This seems to be fixed either on master or on a branch i'm opening soon"", 'created_at': datetime.datetime(2024, 9, 30, 12, 26, 32, tzinfo=datetime.timezone.utc)}]","npretto (Assginee) on (2024-09-30 12:26:32 UTC): This seems to be fixed either on master or on a branch i'm opening soon

"
2502923622,issue,closed,completed,Entity picker's hover colors are not themeable in the sdk,"In the entity picker that is part of the notebook editor (`<InteractiveQuestion.Editor />`), the hover color of the entity picker button (e.g. in the Recents tab) makes it so that the text is not legible. It should support dark-themed apps as well.

Recents Button Hover

![CleanShot 2567-09-03 at 20 42 27@2x](https://github.com/user-attachments/assets/93eb7b7f-987c-4749-bc2d-3f6d1a7c4ace)

Sidebar Button Hover

![CleanShot 2567-09-03 at 20 46 12@2x](https://github.com/user-attachments/assets/15449f8e-089a-472a-a17d-aa964b599d5f)

Tab Hover

![CleanShot 2567-09-03 at 20 46 46@2x](https://github.com/user-attachments/assets/20200696-ca64-4472-8406-5faeef299858)
",heypoom,2024-09-03 13:43:11+00:00,['heypoom'],2024-11-21 12:44:53+00:00,2024-11-21 12:01:12+00:00,https://github.com/metabase/metabase/issues/47560,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2459689031, 'issue_id': 2502923622, 'author': 'albertoperdomo', 'body': '@heypoom Is this issue specific to Shoppy themes or generic (SDK)?', 'created_at': datetime.datetime(2024, 11, 6, 12, 58, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2468602531, 'issue_id': 2502923622, 'author': 'heypoom', 'body': '@albertoperdomo generic - this is SDK-related, happens when you use theme configuration that has dark colors.', 'created_at': datetime.datetime(2024, 11, 11, 16, 42, 6, tzinfo=datetime.timezone.utc)}]","albertoperdomo on (2024-11-06 12:58:28 UTC): @heypoom Is this issue specific to Shoppy themes or generic (SDK)?

heypoom (Issue Creator) on (2024-11-11 16:42:06 UTC): @albertoperdomo generic - this is SDK-related, happens when you use theme configuration that has dark colors.

"
2502916479,issue,closed,completed,Save question button's disabled state should be themed in the sdk's dark mode,"The default view's save question button (which is shown when rendering `<InteractiveQuestion isSaveEnabled />`) should have a correctly themed disabled state in dark mode. It currently looks off in dark-themed apps.

![CleanShot 2567-09-03 at 20 40 20@2x](https://github.com/user-attachments/assets/9c52bb24-5710-4260-b613-6b14f5c134db)
",heypoom,2024-09-03 13:40:03+00:00,['heypoom'],2024-11-14 08:20:14+00:00,2024-11-14 07:35:58+00:00,https://github.com/metabase/metabase/issues/47559,"[('Type:Bug', 'Product defects'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2502901171,issue,closed,completed,Background color of the entity picker in the recents tab in the sdk's CreateQuestion component should follow the theme,Background color of the entity picker in the recents tab in the sdk's CreateQuestion component should follow the theme color.,heypoom,2024-09-03 13:33:21+00:00,[],2024-09-03 13:37:50+00:00,2024-09-03 13:37:16+00:00,https://github.com/metabase/metabase/issues/47558,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2326551628, 'issue_id': 2502901171, 'author': 'heypoom', 'body': 'My bad, it is already using `colors.background-hover` from the theme.', 'created_at': datetime.datetime(2024, 9, 3, 13, 37, 16, tzinfo=datetime.timezone.utc)}]","heypoom (Issue Creator) on (2024-09-03 13:37:16 UTC): My bad, it is already using `colors.background-hover` from the theme.

"
2502571211,issue,closed,completed,Presto driver - user cancelled queries don't get cancelled on Presto,"### Describe the bug

When I execute a query using the default presto driver shipped with metabase and cancel the query from the UI, the query keeps running on Presto. Ideally this query should have gotten cancelled on Presto. 

This has resulted in increased resource usage as many user cancelled queries keep executing and using up resources.

### To Reproduce

1. Go to New -> Native query
2. Select Presto driver
3. Execute any long running query
4. Cancel the query in between
5. Check Presto UI, the query keeps running


### Expected behavior

User cancelled queries from the UI should be cancelled on Presto

### Logs

I see these errors in the logs when the query is cancelled from the UI

```
[2e8b8166-a68a-4869-849a-a2eeb401d2db] 2024-09-03T16:26:41+05:30 WARN metabase.driver.sql-jdbc.execute Statement cancelation failed.
[2e8b8166-a68a-4869-849a-a2eeb401d2db] 2024-09-03T16:26:41+05:30 ERROR metabase.query-processor.middleware.catch-exceptions Error processing query: Broken pipe
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.85+"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Calcutta""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""bigquery-cloud-sdk"",
      ""presto-jdbc"",
      ""mysql"",
      ""postgres"",
      ""starburst""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.31-google""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-06-13"",
      ""tag"": ""v0.50.5-SNAPSHOT"",
      ""hash"": ""15343a3""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Kolkata""
    }
  }
}
```


### Severity

Severe - As this increases resource usage on Presto blocking execution of actual queries

### Additional context

This started happening after a recent upgrade from 0.39.6 to 0.50",harshith-bolar-rapido,2024-09-03 10:59:10+00:00,['metamben'],2024-10-01 22:15:01+00:00,2024-09-09 17:23:56+00:00,https://github.com/metabase/metabase/issues/47555,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2326401557, 'issue_id': 2502571211, 'author': 'paoliniluis', 'body': 'related to https://github.com/metabase/metabase/issues/45571', 'created_at': datetime.datetime(2024, 9, 3, 12, 30, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2339770415, 'issue_id': 2502571211, 'author': 'sabyasachinandy', 'body': 'Thanks for acting on this ! We will check this out', 'created_at': datetime.datetime(2024, 9, 10, 6, 23, 44, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-03 12:30:02 UTC): related to https://github.com/metabase/metabase/issues/45571

sabyasachinandy on (2024-09-10 06:23:44 UTC): Thanks for acting on this ! We will check this out

"
2502553446,issue,open,,Exporting from embedded question with multiple variable selections exports only one selection,"### Describe the bug

When exporting data from embedded question in Metabase, if a variable is set to allow multiple selections, only one of the selected options is included in the export. This behavior is unexpected and inconsistent with the selected state in the dashboard where multiple options are selected.

### To Reproduce

1. create question with variable. doesn't need complecated. I made fugafuga with a string.
```
select *
from hogehoge
where 
1 = 1
[[and {{fugafuga}}]]
```
2. embed it
3. filter with 2 or more selection
4. export it in anyway


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
Mac
Google Chrome
Metabase v0.50.19
Database: MySQL
Internal DB: H2
```


### Severity

blocking some users

### Additional context

_No response_",star-tsukuda-x,2024-09-03 10:51:09+00:00,[],2025-02-04 20:29:07+00:00,,https://github.com/metabase/metabase/issues/47554,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('.Team/Embedding', '')]","[{'comment_id': 2326789115, 'issue_id': 2502553446, 'author': 'WiNloSt', 'body': ""For engineers troubleshooting this.\r\n\r\nTested with Postgres on master @ ee7bc42d73da2d172145c62eca3f4edcfb96bb40\r\n- DB: H2 Sample, Postgres Sample\r\n- Question: `select * from products where 1 = 1 [[and {{category}}]]`\r\n- Parameter `Field Filter` maps to `Category` with filter type `string`.\r\n- Export as `CSV`, `JSON`\r\n\r\nCouldn't reproduce the issue.\r\n\r\nI haven't tested the reported version, so it's worth taking a look."", 'created_at': datetime.datetime(2024, 9, 3, 15, 15, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2330477065, 'issue_id': 2502553446, 'author': 'star-tsukuda-x', 'body': 'Thank you, @WiNloSt for investigating this. I will try it with the latest version next Tuesday.', 'created_at': datetime.datetime(2024, 9, 5, 2, 28, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2342401193, 'issue_id': 2502553446, 'author': 'star-tsukuda-x', 'body': ""it's still happen on my environment with v0.50.24 (newest)."", 'created_at': datetime.datetime(2024, 9, 11, 0, 43, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2342405237, 'issue_id': 2502553446, 'author': 'star-tsukuda-x', 'body': 'the prerequisites might be different to reproduce the issue correctly.\r\n\r\nLet me share the conditions again:\r\n\r\n```\r\nselect *\r\nfrom hogehoge\r\nwhere \r\n1 = 1\r\n[[and {{fugafuga}}]]\r\n[[and {{piyopiyo}}]]\r\n```\r\n\r\nIn this case, please specify fugafuga and piyopiyo as field filters in Metabase, mapped to some fields in the hogehoge table.\r\nThen, publish a static embedding, setting fugafuga as locked and piyopiyo as editable.\r\nOn the embedding server, the payload is created like this:\r\n```\r\n{\r\n  resource: { question: question_num },\r\n  params: {\r\n    ""fugafuga"" => fugafuga\r\n  },\r\n  exp: 1.days.from_now.to_i\r\n}\r\n```\r\n\r\nThe URL is `/embed/question/#{token}#bordered=true&titled=true&hide_parameters=fugafuga`.\r\n\r\nHowever, when piyopiyo is selected multiple times in the embedded state, the export output contains only one of the selected values, not all.\r\n\r\nBy the way, the same issue occurs even if piyopiyo is not a string type.', 'created_at': datetime.datetime(2024, 9, 11, 0, 48, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2460141164, 'issue_id': 2502553446, 'author': 'felipedsc', 'body': 'Still happening on 0.51.2', 'created_at': datetime.datetime(2024, 11, 6, 15, 55, 46, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2024-09-03 15:15:29 UTC): For engineers troubleshooting this.

Tested with Postgres on master @ ee7bc42d73da2d172145c62eca3f4edcfb96bb40
- DB: H2 Sample, Postgres Sample
- Question: `select * from products where 1 = 1 [[and {{category}}]]`
- Parameter `Field Filter` maps to `Category` with filter type `string`.
- Export as `CSV`, `JSON`

Couldn't reproduce the issue.

I haven't tested the reported version, so it's worth taking a look.

star-tsukuda-x (Issue Creator) on (2024-09-05 02:28:56 UTC): Thank you, @WiNloSt for investigating this. I will try it with the latest version next Tuesday.

star-tsukuda-x (Issue Creator) on (2024-09-11 00:43:39 UTC): it's still happen on my environment with v0.50.24 (newest).

star-tsukuda-x (Issue Creator) on (2024-09-11 00:48:47 UTC): the prerequisites might be different to reproduce the issue correctly.

Let me share the conditions again:

```
select *
from hogehoge
where 
1 = 1
[[and {{fugafuga}}]]
[[and {{piyopiyo}}]]
```

In this case, please specify fugafuga and piyopiyo as field filters in Metabase, mapped to some fields in the hogehoge table.
Then, publish a static embedding, setting fugafuga as locked and piyopiyo as editable.
On the embedding server, the payload is created like this:
```
{
  resource: { question: question_num },
  params: {
    ""fugafuga"" => fugafuga
  },
  exp: 1.days.from_now.to_i
}
```

The URL is `/embed/question/#{token}#bordered=true&titled=true&hide_parameters=fugafuga`.

However, when piyopiyo is selected multiple times in the embedded state, the export output contains only one of the selected values, not all.

By the way, the same issue occurs even if piyopiyo is not a string type.

felipedsc on (2024-11-06 15:55:46 UTC): Still happening on 0.51.2

"
2502403999,issue,closed,completed,Generating API token with same name gives an empty input,"### Describe the bug

In admin interface, if you try to generate an API token with the same name as an already existing one, you will get an empty input field (instead of expected token or error saying ""name already exists"" or similar). See video.

https://github.com/user-attachments/assets/4ef02ef1-0b9d-420a-b5a5-faf7a0e6d952



### To Reproduce

1. Go to 'Admin settings > Authentication'.
2. Click on 'Manage' under 'API Keys' section.
3. Click on 'Create API key' and fill in a name and pick a user group. Create the token.
4. Again, click on 'Create API key' and fill in the same name and pick a user group. Create the token.
4. The input field will not contain token, but instead just be empty.


### Expected behavior

Show user an error saying that the name of the token already exists and can therefore not be created.

### Logs

Network response:

```
POST: 400 Bad Request
errors : {name: ""An API key with this name already exists.""}
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-29"",
      ""tag"": ""v0.50.23"",
      ""hash"": ""7040ff1""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Stockholm""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.5 (Debian 15.5-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.10.0-linuxkit"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```


### Severity

low - bad user experience

### Additional context

_No response_",antonhedstrom,2024-09-03 09:42:03+00:00,[],2025-01-02 21:10:30+00:00,2025-01-02 21:10:29+00:00,https://github.com/metabase/metabase/issues/47552,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Auth', 'Google Auth, LDAP, pw+email login'), ('.Frontend', ''), ('Administration/', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2568382020, 'issue_id': 2502403999, 'author': 'sloansparger', 'body': 'Fixed by #51395', 'created_at': datetime.datetime(2025, 1, 2, 21, 10, 29, tzinfo=datetime.timezone.utc)}]","sloansparger on (2025-01-02 21:10:29 UTC): Fixed by #51395

"
2502309287,issue,closed,not_planned,Option to customize which dashboard tabs are sent in dashboard subscription ,"**Is your feature request related to a problem? Please describe.**
Some users are only interested in some tabs in a dashboard, while others are interested in all of them. 

**Describe the solution you'd like**
It would be nice to select which dashboard tabs are to be sent in a subscription mail. Also only filters linked to the chosen tabs would need to be selected.

**Describe alternatives you've considered**
The current working alternative is to create multiple redundant dashboards for each different subscription. This results in a high number of dashboards which all have to be maintained.
",J-Reichardt,2024-09-03 08:58:19+00:00,[],2025-01-28 11:59:20+00:00,2024-09-13 22:59:29+00:00,https://github.com/metabase/metabase/issues/47550,"[('Reporting/Dashboards', ''), ('Reporting/Pulses', 'Now called Subscriptions'), ('Type:New Feature', '')]","[{'comment_id': 2350649292, 'issue_id': 2502309287, 'author': 'paoliniluis', 'body': 'I think this is a dupe of https://github.com/metabase/metabase/issues/36366', 'created_at': datetime.datetime(2024, 9, 13, 22, 59, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2618804165, 'issue_id': 2502309287, 'author': 'MfMark', 'body': 'We also need this feature of setting subscriptions on specific tabs', 'created_at': datetime.datetime(2025, 1, 28, 11, 59, 20, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-13 22:59:29 UTC): I think this is a dupe of https://github.com/metabase/metabase/issues/36366

MfMark on (2025-01-28 11:59:20 UTC): We also need this feature of setting subscriptions on specific tabs

"
2501632949,issue,closed,not_planned,"Can't run SQL questions (or models) if there's a least 1 table with ""blocked"" permissions","### Describe the bug

If you have at least 1 table with blocked permissions, you won't be able to run SQL questions

### To Reproduce

1) create a question (select * from people)
2) create a group and a user, add this user to the group
3) go to permissions, and block access to a single table
![image](https://github.com/user-attachments/assets/0d2a2b01-edb2-4992-88da-518026a46aa5)

(BTW: all users should have everything blocked)

4) log in as the user and try running the SQL question

### Expected behavior

The user should be able to run the SQL question (it has permissions to run questions, and we don't care about the block, unless we did a change in v50 that blocking a single table implies that the SQL questions can't be run)

### Logs

NA

### Information about your Metabase installation

```JSON
v50
```


### Severity

P?

### Additional context

regression?",paoliniluis,2024-09-02 22:16:35+00:00,[],2024-09-04 01:01:47+00:00,2024-09-03 15:03:54+00:00,https://github.com/metabase/metabase/issues/47547,[],"[{'comment_id': 2326762128, 'issue_id': 2501632949, 'author': 'WiNloSt', 'body': 'Noah mentioned [this is documented](https://www.metabase.com/docs/latest/permissions/data#blocked-view-data-permission).', 'created_at': datetime.datetime(2024, 9, 3, 15, 3, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2327710723, 'issue_id': 2501632949, 'author': 'paoliniluis', 'body': 'Although I agree @WiNloSt, this is a spot of confusion, and several customers hit this spot already. I would really like product to make the call here', 'created_at': datetime.datetime(2024, 9, 4, 1, 1, 46, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2024-09-03 15:03:54 UTC): Noah mentioned [this is documented](https://www.metabase.com/docs/latest/permissions/data#blocked-view-data-permission).

paoliniluis (Issue Creator) on (2024-09-04 01:01:46 UTC): Although I agree @WiNloSt, this is a spot of confusion, and several customers hit this spot already. I would really like product to make the call here

"
2501339754,issue,closed,completed,Add filters for model types in the CreateQuestion component,Add a prop to the `QuestionEditor` that allows users to filter by a model (`dataset` or `card` or whatever) to restrict the datasets that users can use when creating/modifying a question,oisincoveney,2024-09-02 16:55:03+00:00,['oisincoveney'],2024-09-25 16:30:03+00:00,2024-09-25 16:30:03+00:00,https://github.com/metabase/metabase/issues/47537,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2501333951,issue,closed,completed,[SDK] Improvements for Create/Modify Question,"```[tasklist]
### Tasks
- [ ] https://github.com/metabase/metabase/pull/47448
- [ ] https://github.com/metabase/metabase/issues/47464
- [ ] https://github.com/metabase/metabase/issues/47535
- [ ] https://github.com/metabase/metabase/issues/47537
- [ ] https://github.com/metabase/metabase/issues/47347
- [ ] https://github.com/metabase/metabase/issues/47344
- [ ] https://github.com/metabase/metabase/issues/47559
- [ ] https://github.com/metabase/metabase/issues/47561
- [ ] https://github.com/metabase/metabase/issues/47562
```
",oisincoveney,2024-09-02 16:49:51+00:00,['oisincoveney'],2024-11-18 12:52:49+00:00,2024-09-23 12:49:45+00:00,https://github.com/metabase/metabase/issues/47536,"[('.Team/Embedding', '')]","[{'comment_id': 2368125769, 'issue_id': 2501333951, 'author': 'oisincoveney', 'body': 'Moved all items to https://github.com/metabase/metabase/issues/47842', 'created_at': datetime.datetime(2024, 9, 23, 12, 49, 46, tzinfo=datetime.timezone.utc)}]","oisincoveney (Issue Creator) on (2024-09-23 12:49:46 UTC): Moved all items to https://github.com/metabase/metabase/issues/47842

"
2501333572,issue,closed,completed,Add chart type visualization buttons to SDK,"**Context**
We want to be able to allow users to change the visualization (pie/bar/chart/table/etc) when viewing a question in the SDK.


```[tasklist]
### Tasks
- [ ] https://github.com/metabase/metabase/pull/47745
- [ ] https://github.com/metabase/metabase/pull/47744
```
",oisincoveney,2024-09-02 16:49:31+00:00,['oisincoveney'],2024-10-14 09:07:37+00:00,2024-10-14 09:07:36+00:00,https://github.com/metabase/metabase/issues/47535,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2501293537,issue,closed,completed,"Investigate how to set locale on the FE, will be used for both #locale=xx in static/public and for sdk","Investigation for https://www.notion.so/metabase/Support-language-localization-in-static-embedding-0307665e3008435d9bb2b3fff8148d7d?d=c0b61d2c75724252862ca9be79325b8e#15c80ff0ce4a4fb79635d71602e58aa9

POC branch: `poc-frontend-locale`


What should work
- ui
- query results (ie: ~dates?~ dates are formatted on the FE)
- query downloads (ie: dates and things like ""unique values for"")


# Results and issues found
main results:
- Downloads are not localized on static/public, we can use X-Metabase-Locale to fix that but it requires BE changes, read below for more context.

- I got sdk to load another language, I still have to do more in depth tests to see if all the components work, I'll ask Oisin to tell me what issues he ran into. There's also a CORS issue we have to solve but it seems we can do it on the FE.


## Keeping the locale as a # parameter -> extra loading on the FE

Currently the i18n is server rendered, the BE knows the language of the user and sends the json file with the translations together with the html of the page.
The `?locale=xx` parameter worked in the same way and no extra loading was required, but if we switch to `#locale=xx`, the BE won't be able to read it and we'll have to make add a small loading to the FE (when the locale is not 'en').

## ""X-Metabase-Locale""

The BE accepts an header called `X-Metabase-Locale` to set the locale, this is not documented very well and AFAIK it's not used anywhere at the current time.
It does work, but it works by adding the locale to the user information in the session, this won't work on contexts where we don't have user session, like public and static embeds.

I wrote an ugly middleware that makes it work but it 100% needs to be rewritten by somebody who understands how the middlewares work on MB.

## Loading locales from the host app causes CORS issues
<img width=""1422"" alt=""image"" src=""https://github.com/user-attachments/assets/db8f65a0-a07d-422a-bcf5-e2a57cd9711d"">

This is because we use the helper `GET` method that adds headers.
We can either add the cors headers on the BE, or more simply use fetch directly without setting any heade to get the i18n json files.

",npretto,2024-09-02 16:17:02+00:00,['npretto'],2024-09-05 13:55:39+00:00,2024-09-05 13:55:39+00:00,https://github.com/metabase/metabase/issues/47533,"[('.Team/Embedding', '')]","[{'comment_id': 2331752404, 'issue_id': 2501293537, 'author': 'npretto', 'body': ""I update the product doc, will close this as I'm moving to other tasks for now"", 'created_at': datetime.datetime(2024, 9, 5, 13, 55, 39, tzinfo=datetime.timezone.utc)}]","npretto (Issue Creator) on (2024-09-05 13:55:39 UTC): I update the product doc, will close this as I'm moving to other tasks for now

"
2501234714,issue,closed,completed,Cumulative count/sum is confusing to work with when having more than 1 aggregate,"### Describe the bug

When you have a Cumulative count/sum having more than 1 aggregate gives the impression it defaults to a normal count when viewing as a table

### To Reproduce

1. Go to New -> Question -> Sample DB -> Products -> Cumulative Count Group by Category & Created_at Month

<img width=""887"" alt=""image"" src=""https://github.com/user-attachments/assets/f7c15008-fcf2-4998-ad48-a6f1ba0751e6"">

2. Visualise as a table and notice the numbers don't make sense. The Cumulative Count is simply a Count:

<img width=""699"" alt=""image"" src=""https://github.com/user-attachments/assets/deb43e14-c340-4fcc-b3ac-ab83a0b6cbf2"">

This is how it used to look in 49:

<img width=""893"" alt=""image"" src=""https://github.com/user-attachments/assets/3faf31dd-ff03-440a-b983-468fc02905dc"">

### Expected behavior

Cumulative Count needs to be more intuitive to work with

### Logs

None that are relevant

### Information about your Metabase installation

```JSON
50 and master
```


### Severity

blocking issue since questions that were working are not working as before anymore

### Additional context

_No response_",Tony-metabase,2024-09-02 15:36:14+00:00,[],2024-12-16 22:41:33+00:00,2024-12-16 22:41:32+00:00,https://github.com/metabase/metabase/issues/47531,"[('Type:UX', ''), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Team/Querying', '')]","[{'comment_id': 2325169192, 'issue_id': 2501234714, 'author': 'mngr', 'body': 'Cumulative count was changed to be a window function. Now we always sort by the first breakout and partition by all the rest, so here you should just swap the breakouts\r\n<img width=""921"" alt=""Captura de ecrã 2024-09-02, às 19 09 58"" src=""https://github.com/user-attachments/assets/b8a7a236-f8c4-45ac-bce0-4f8175037d67"">', 'created_at': datetime.datetime(2024, 9, 2, 18, 11, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2325204537, 'issue_id': 2501234714, 'author': 'Tony-metabase', 'body': 'According to this PR [#41340](https://github.com/metabase/metabase/pull/41340) this is how the cum sum/count should work:\r\n\r\n<img width=""890"" alt=""image"" src=""https://github.com/user-attachments/assets/a7921dbd-74c2-49f1-a202-073dc7e13189"">\r\n\r\nIf i try to implement the same in the GUI it doesn\'t work \r\n\r\n<img width=""709"" alt=""image"" src=""https://github.com/user-attachments/assets/da010d48-3b9e-446d-89c5-fecc7fd3a7f7"">\r\n\r\nand if i follow the flow you described to start with created_at and then category I end up with this:\r\n\r\n<img width=""753"" alt=""image"" src=""https://github.com/user-attachments/assets/277e2b82-94a8-4556-a939-9dc200a6aa7a"">\r\n\r\nWhich is still confusing and to be able to understand what is going on I have to move the category back to the first column and order by category. Two extra steps which \r\n\r\n<img width=""702"" alt=""image"" src=""https://github.com/user-attachments/assets/58bc6263-6f04-4fac-b277-c15516a58c95"">\r\n\r\nSo in summary this PR or the spec described there is not in line to what is happening right now. It could be the pull request has an issue or the spec where changed but right now it\'s confusing to understand how this works. I am expecting metabase to behave like the spec', 'created_at': datetime.datetime(2024, 9, 2, 18, 53, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2325214975, 'issue_id': 2501234714, 'author': 'camsaul', 'body': 'This is behaving by design, per product request I changed the column order in #42131 (see https://metaboat.slack.com/archives/C05MPF0TM3L/p1714508528096849?thread_ts=1714084449.574689&cid=C05MPF0TM3L). The tables you\'ve screenshotted from my older PR are no longer accurate.\r\n\r\n@mngr is correct that it works as expected when you order the breakouts the other way around \r\n\r\n![image](https://github.com/user-attachments/assets/46fddf13-9dad-4ae8-ad12-4b2127beab2c)\r\n\r\nNote that the line visualization is the default so you have to go out of your way to see ""confusing"" table results. It makes sense when you look at the line visualization.\r\n\r\nMaybe we just need to clarify the dox more.', 'created_at': datetime.datetime(2024, 9, 2, 19, 7, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2547015989, 'issue_id': 2501234714, 'author': 'mngr', 'body': 'Fixed by https://github.com/metabase/metabase/pull/48028', 'created_at': datetime.datetime(2024, 12, 16, 22, 41, 32, tzinfo=datetime.timezone.utc)}]","mngr on (2024-09-02 18:11:59 UTC): Cumulative count was changed to be a window function. Now we always sort by the first breakout and partition by all the rest, so here you should just swap the breakouts
<img width=""921"" alt=""Captura de ecrã 2024-09-02, às 19 09 58"" src=""https://github.com/user-attachments/assets/b8a7a236-f8c4-45ac-bce0-4f8175037d67"">

Tony-metabase (Issue Creator) on (2024-09-02 18:53:16 UTC): According to this PR [#41340](https://github.com/metabase/metabase/pull/41340) this is how the cum sum/count should work:

<img width=""890"" alt=""image"" src=""https://github.com/user-attachments/assets/a7921dbd-74c2-49f1-a202-073dc7e13189"">

If i try to implement the same in the GUI it doesn't work 

<img width=""709"" alt=""image"" src=""https://github.com/user-attachments/assets/da010d48-3b9e-446d-89c5-fecc7fd3a7f7"">

and if i follow the flow you described to start with created_at and then category I end up with this:

<img width=""753"" alt=""image"" src=""https://github.com/user-attachments/assets/277e2b82-94a8-4556-a939-9dc200a6aa7a"">

Which is still confusing and to be able to understand what is going on I have to move the category back to the first column and order by category. Two extra steps which 

<img width=""702"" alt=""image"" src=""https://github.com/user-attachments/assets/58bc6263-6f04-4fac-b277-c15516a58c95"">

So in summary this PR or the spec described there is not in line to what is happening right now. It could be the pull request has an issue or the spec where changed but right now it's confusing to understand how this works. I am expecting metabase to behave like the spec

camsaul on (2024-09-02 19:07:23 UTC): This is behaving by design, per product request I changed the column order in #42131 (see https://metaboat.slack.com/archives/C05MPF0TM3L/p1714508528096849?thread_ts=1714084449.574689&cid=C05MPF0TM3L). The tables you've screenshotted from my older PR are no longer accurate.

@mngr is correct that it works as expected when you order the breakouts the other way around 

![image](https://github.com/user-attachments/assets/46fddf13-9dad-4ae8-ad12-4b2127beab2c)

Note that the line visualization is the default so you have to go out of your way to see ""confusing"" table results. It makes sense when you look at the line visualization.

Maybe we just need to clarify the dox more.

mngr on (2024-12-16 22:41:32 UTC): Fixed by https://github.com/metabase/metabase/pull/48028

"
2501112385,issue,closed,completed,Warn users about the deprecated setting,"Warn users about these 2 deprecated settings
- `MB_ENABLE_EMBEDDING` -> replaced with `enable-embedding-static`, `enable-embedding-interactive`, and `enable-embedding-sdk`
- `MB_EMBEDDING_APP_ORIGIN` -> replaced with `embedding-app-origins-interactive`

These are logs on BE side. For example
`”Warning: MB_ENABLE_EMBEDDING is deprecated and will be removed in Metabase 53. Read more: URL.”`
",WiNloSt,2024-09-02 14:29:59+00:00,['escherize'],2024-09-27 12:21:27+00:00,2024-09-27 12:21:27+00:00,https://github.com/metabase/metabase/issues/47528,[],[],
2501112295,issue,closed,completed,Rename `embedding-app-origin` to `embedding-app-origins-interactive`,,WiNloSt,2024-09-02 14:29:56+00:00,['escherize'],2024-10-07 17:43:36+00:00,2024-10-07 17:43:35+00:00,https://github.com/metabase/metabase/issues/47527,[],"[{'comment_id': 2397527458, 'issue_id': 2501112295, 'author': 'escherize', 'body': 'closed by https://github.com/metabase/metabase/pull/48154', 'created_at': datetime.datetime(2024, 10, 7, 17, 43, 35, tzinfo=datetime.timezone.utc)}]","escherize (Assginee) on (2024-10-07 17:43:35 UTC): closed by https://github.com/metabase/metabase/pull/48154

"
2501112206,issue,closed,completed,Add a new boolean setting `enable-embedding-interactive`,"Add a new `boolean` setting `enable-embedding-interactive`
- Default value: `false`
- Unencrypted
- Will be used for enabling or disabling interactive embedding",WiNloSt,2024-09-02 14:29:53+00:00,['escherize'],2024-09-27 12:21:10+00:00,2024-09-27 12:21:10+00:00,https://github.com/metabase/metabase/issues/47526,[],[],
2501112086,issue,closed,completed,Add a new boolean setting `enable-embedding-static`,"Add a new `boolean` setting `enable-embedding-static`
- Default value: `false`
- Unencrypted
- Will be used for enabling or disabling static embedding.
- Replace `embed.settings/enable-embedding` in [enterprise/backend/src/metabase_enterprise/stale.clj](https://github.com/metabase/metabase/blob/master/enterprise/backend/src/metabase_enterprise/stale.clj) with this setting",WiNloSt,2024-09-02 14:29:50+00:00,['escherize'],2024-09-27 12:21:05+00:00,2024-09-27 12:21:05+00:00,https://github.com/metabase/metabase/issues/47525,[],[],
2501111875,issue,closed,completed,Remove `enable-embedding` and introduce `enable-embedding-static` and `enable-embedding-interactive`,"#### Description
- Remove `enable-embedding`
- Introduce `enable-embedding-static` (implement in https://github.com/metabase/metabase/issues/47525)
- Introduce `enable-embedding-interactive` (implement in https://github.com/metabase/metabase/issues/47526)

Using this [migration strategy](https://www.notion.so/metabase/Feature-flag-and-settings-for-SDK-8ed424c776194528b6332c5fc2510a0c#6a615898a14648bfae230652e9d87f2d).

#### Note
- Most usage of `enable-embedding` would be referred to `enable-embedding-static` instead. Only the usage around setting the value to frame-ancestors that we should be referred to `enable-embedding-interactive` instead.
- We could almost say that this is like 90%+ renaming `enable-embedding` to `enable-embedding-static` as most of the code uses `enable-embedding` for static embedding, the rest 10% is for interactive embedding.",WiNloSt,2024-09-02 14:29:44+00:00,['escherize'],2024-10-07 17:43:29+00:00,2024-10-07 17:43:27+00:00,https://github.com/metabase/metabase/issues/47524,[],"[{'comment_id': 2397527202, 'issue_id': 2501111875, 'author': 'escherize', 'body': 'closed by https://github.com/metabase/metabase/pull/48154', 'created_at': datetime.datetime(2024, 10, 7, 17, 43, 27, tzinfo=datetime.timezone.utc)}]","escherize (Assginee) on (2024-10-07 17:43:27 UTC): closed by https://github.com/metabase/metabase/pull/48154

"
2501111778,issue,closed,not_planned,duplicate,,WiNloSt,2024-09-02 14:29:40+00:00,[],2024-09-02 14:35:35+00:00,2024-09-02 14:35:35+00:00,https://github.com/metabase/metabase/issues/47523,[],[],
2501111638,issue,closed,completed,Add a new string setting `embedding-app-origins-sdk`,"Add a new `string` setting `embedding-app-origins-sdk`
- Will be used for authorized SDK hosts on production
- `localhost:*` is always assumed (always append `localhost:*` to whatever the value this input has).


Here’s how this ~setting~ works:
  - When `enable-embedding-sdk: true`
      - By default, if the request origin is `localhost` from any port, we’ll allow it and return the same origin back in `Access-Control-Allow-Origin`
      - If users specify `localhost` in the value, just ignore it since it works the same way as the implicit `localhost:*` matching.
      - For EE users with a token with `embedding-sdk` flag, this input is editable and we allow saving this value, otherwise, don’t allow modifying this value.
  - When `enabled-embedding-sdk: false`
      - No CORS headers are set",WiNloSt,2024-09-02 14:29:36+00:00,['escherize'],2024-09-27 12:20:58+00:00,2024-09-27 12:20:58+00:00,https://github.com/metabase/metabase/issues/47522,[],"[{'comment_id': 2327166567, 'issue_id': 2501111638, 'author': 'escherize', 'body': ""Hi @WiNloSt, Can you explain what shape you expect this string setting to have? Is it a list of comma seperated `host:port|*`'s?\r\n\r\nEBNF explained here:\r\n\r\n```\r\nS = h +\r\nh = host ':' port\r\nhost = ip | hostname\r\nip = \\d+ '.' \\d+ '.' \\d+ '.' \\d+\r\nhostname = \\w+\r\nport = \\d+ | '*'\r\n```\r\n\r\nPlease let me know what you expect, and how you think this will be updated. (In the meantime I'll see if I can figure it out on your PR)."", 'created_at': datetime.datetime(2024, 9, 3, 18, 31, 20, tzinfo=datetime.timezone.utc)}, {'comment_id': 2327169208, 'issue_id': 2501111638, 'author': 'escherize', 'body': 'We can take an array of strings as json that we can validate on-write, I think that could work better for this, compared to encoding a collection inside of a string.', 'created_at': datetime.datetime(2024, 9, 3, 18, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2327178036, 'issue_id': 2501111638, 'author': 'escherize', 'body': 'Should this default to `""localhost:*""`, (or `[""localhost:*""]`, or even `[{:host ""localhost"" :port ""*""}]`)?\r\n\r\nThe reasons to go for json are that it\'s easier to validate the shape, and it\'s easier to go from data -> string than parse it (and include good error messages).', 'created_at': datetime.datetime(2024, 9, 3, 18, 38, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2328065362, 'issue_id': 2501111638, 'author': 'WiNloSt', 'body': '@escherize \r\n\r\n>Can you explain what shape you expect this string setting to have? Is it a list of comma seperated host:port|*\'s?\r\n\r\nI initially thought to have this setting behave more like `embedding-app-origin` which is a space-separated string e.g. `""mydomain.com myanotherdomain.com""`.\r\n\r\nPlease note that we don\'t expect users to input `localhost` themselves as `localhost:*` should always be allowed.\r\n\r\nOne thing to note is that we\'re following the [frame-ancestors spec](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors#sources). This matches the spec we allow in `embedding-app-origin` (old setting)\r\n\r\n\r\n\r\n> Should this default to `""localhost:*""`, (or `[""localhost:*""]`, or even `[{:host ""localhost"" :port ""*""}]`)?\r\n> \r\n> The reasons to go for json are that it\'s easier to validate the shape, and it\'s easier to go from data -> string than parse it (and include good error messages).\r\n\r\nI\'m not up to snuff with all the BE work, but from my expectation, I\'d expect this new setting `embedding-app-origins-sdk` would behave similarly to `embedding-app-origin` so they\'re consistent and easy to reason about. Since the old setting doesn\'t have any validation i.e. we don\'t care if you set the wrong domain, we only will try to match the parse-able domain to the request origin. I don\'t think this new setting necessarily needs to have any validation.\r\n\r\nMy 2c, I\'d not validate anything here since we can almost reuse the logic we have with `embedding-app-origin`, that way the 2 settings are consistent, if we add validation to one place we should add to the other place too to have consistent behavior.\r\n\r\n@albertoperdomo What do you think about input validation? We don\'t validate anything when saving `embedding-app-origin`, I think it\'d be consistent and simpler to do the same for `embedding-app-origins-sdk`. But let me know if we expect to have some kind of validation here. I don\'t see that in the spec.', 'created_at': datetime.datetime(2024, 9, 4, 6, 58, 1, tzinfo=datetime.timezone.utc)}]","escherize (Assginee) on (2024-09-03 18:31:20 UTC): Hi @WiNloSt, Can you explain what shape you expect this string setting to have? Is it a list of comma seperated `host:port|*`'s?

EBNF explained here:

```
S = h +
h = host ':' port
host = ip | hostname
ip = \d+ '.' \d+ '.' \d+ '.' \d+
hostname = \w+
port = \d+ | '*'
```

Please let me know what you expect, and how you think this will be updated. (In the meantime I'll see if I can figure it out on your PR).

escherize (Assginee) on (2024-09-03 18:33:00 UTC): We can take an array of strings as json that we can validate on-write, I think that could work better for this, compared to encoding a collection inside of a string.

escherize (Assginee) on (2024-09-03 18:38:32 UTC): Should this default to `""localhost:*""`, (or `[""localhost:*""]`, or even `[{:host ""localhost"" :port ""*""}]`)?

The reasons to go for json are that it's easier to validate the shape, and it's easier to go from data -> string than parse it (and include good error messages).

WiNloSt (Issue Creator) on (2024-09-04 06:58:01 UTC): @escherize 


I initially thought to have this setting behave more like `embedding-app-origin` which is a space-separated string e.g. `""mydomain.com myanotherdomain.com""`.

Please note that we don't expect users to input `localhost` themselves as `localhost:*` should always be allowed.

One thing to note is that we're following the [frame-ancestors spec](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors#sources). This matches the spec we allow in `embedding-app-origin` (old setting)




I'm not up to snuff with all the BE work, but from my expectation, I'd expect this new setting `embedding-app-origins-sdk` would behave similarly to `embedding-app-origin` so they're consistent and easy to reason about. Since the old setting doesn't have any validation i.e. we don't care if you set the wrong domain, we only will try to match the parse-able domain to the request origin. I don't think this new setting necessarily needs to have any validation.

My 2c, I'd not validate anything here since we can almost reuse the logic we have with `embedding-app-origin`, that way the 2 settings are consistent, if we add validation to one place we should add to the other place too to have consistent behavior.

@albertoperdomo What do you think about input validation? We don't validate anything when saving `embedding-app-origin`, I think it'd be consistent and simpler to do the same for `embedding-app-origins-sdk`. But let me know if we expect to have some kind of validation here. I don't see that in the spec.

"
2501111519,issue,closed,completed,Add a new boolean setting `enable-embedding-sdk`,"Add a new `boolean` setting `enable-embedding-sdk`
- [x] Default value: `false`
- [x] Unencrypted (all boolean settings default to unencrypted)
- [x] Will be used for enabling or disabling embedding SDK.
- [x] This flag works independently from `enable-embedding-static` and `enable-embedding-interactive`
- [x] Send snowplow events when it is toggled, like `enable-embedding` does",WiNloSt,2024-09-02 14:29:32+00:00,['escherize'],2024-09-13 02:37:30+00:00,2024-09-09 23:01:34+00:00,https://github.com/metabase/metabase/issues/47521,[],"[{'comment_id': 2327496187, 'issue_id': 2501111519, 'author': 'escherize', 'body': '@WiNloSt Do we know if `enable-embedding-sdk` should send snowplow events whenever it is toggled?', 'created_at': datetime.datetime(2024, 9, 3, 21, 45, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2328713221, 'issue_id': 2501111519, 'author': 'albertoperdomo', 'body': '@escherize Probably a good idea', 'created_at': datetime.datetime(2024, 9, 4, 11, 38, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2330189864, 'issue_id': 2501111519, 'author': 'escherize', 'body': ""I am going to swap out usages of the `enable-embedding` defsetting, but keep it there so we can add a deprecation notice when it gets set (and maybe forward it's environment variable value into `MB_ENABLE_EMBEDDING_SDK`)"", 'created_at': datetime.datetime(2024, 9, 4, 21, 37, 30, tzinfo=datetime.timezone.utc)}]","escherize (Assginee) on (2024-09-03 21:45:58 UTC): @WiNloSt Do we know if `enable-embedding-sdk` should send snowplow events whenever it is toggled?

albertoperdomo on (2024-09-04 11:38:04 UTC): @escherize Probably a good idea

escherize (Assginee) on (2024-09-04 21:37:30 UTC): I am going to swap out usages of the `enable-embedding` defsetting, but keep it there so we can add a deprecation notice when it gets set (and maybe forward it's environment variable value into `MB_ENABLE_EMBEDDING_SDK`)

"
2501059622,issue,closed,completed,More logging around Serialization Issues for v50,"### Describe the bug

We are having some failures around serialization such as:

```
ERROR serialization.api :: Error during deserialization: Failed to load into database for [#ordered/map ([:id ""HNpUlSOX2YjoP_ROHK2qz""] [:model ""Card""])] {:path [#ordered/map ([:id ""HNpUlSOX2YjoP_ROHK2qz""] [:model ""Card""])], :deps-chain #{}, :model ""Card"", :table :report_card, :error :metabase-enterprise.serialization.v2.load/load-failure}
2024-09-02 12:09:03,431 ERROR serialization.api :: Error during deserialization: Failed to load into database for [#ordered/map ([:id ""HNpUlSOX2YjoP_ROHK2qz""] [:model ""Card""])] {:path [#ordered/map ([:id ""HNpUlSOX2YjoP_ROHK2qz""] [:model ""Card""])], :deps-chain #{}, :model ""Card"", :table :report_card, :error :metabase-enterprise.serialization.v2.load/load-failure}
```
and 
```
2024-09-02 14:14:30.127 [ERROR] Error: Error while importing default dashboards in Analytics: clojure.lang.ExceptionInfo: Failed to load into database for [#ordered/map ([:id ""StudioDB""] [:model ""Database""]) #ordered/map ([:id ""configurations.files""] [:model ""Table""]) #ordered/map ([:id ""description""] [:model ""Field""])] {:path [#ordered/map ([:id ""StudioDB""] [:model ""Database""]) #ordered/map ([:id ""configurations.files""] [:model ""Table""]) #ordered/map ([:id ""description""] [:model ""Field""])], :deps-chain #{}, :model ""Field"", :table :metabase_field, :error :metabase-enterprise.serialization.v2.load/load-failure, :toucan2/context-trace [[""resolve connection"" {:toucan2.connection/connectable metabase.db.connection.ApplicationDB}] [""resolve connection"" {:toucan2.connection/connectable :default}] [""resolve connection"" {:toucan2.connection/connectable nil}]]}
```

Which aren't helpful in identifying what might be going wrong. We need to add more logging 

### To Reproduce

You need to fail the serialization with some odd path as the above. I don't have easy replication steps but @piranha is already on it

### Expected behavior

Some idea of where the issue might lie or why it failed in the first place

### Logs

added above

### Information about your Metabase installation

```JSON
v50.23
```


### Severity

Blocking some user from upgrading 

### Additional context

_No response_",Tony-metabase,2024-09-02 14:04:00+00:00,['piranha'],2024-09-30 10:13:20+00:00,2024-09-30 10:13:20+00:00,https://github.com/metabase/metabase/issues/47520,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Operation/Serialization', 'Enterprise contents migration'), ('.Escalation', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2324845505, 'issue_id': 2501059622, 'author': 'piranha', 'body': 'The reason for that is that `v2.load/load-one!` re-throws errors with more data, and then when `serialization.api` logs the message, it skips the real cause of the error. My current thinking: we need `log/error`, but which will print only causes, without the stacktrace.', 'created_at': datetime.datetime(2024, 9, 2, 14, 9, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2382700846, 'issue_id': 2501059622, 'author': 'Tony-metabase', 'body': 'Closing this since the customer impacted by this and lack of logs reached out that since they moved all their cards to the MySQL database and discontinued support for ClickHouse, all recent deployments have been successful.', 'created_at': datetime.datetime(2024, 9, 30, 10, 13, 20, tzinfo=datetime.timezone.utc)}]","piranha (Assginee) on (2024-09-02 14:09:32 UTC): The reason for that is that `v2.load/load-one!` re-throws errors with more data, and then when `serialization.api` logs the message, it skips the real cause of the error. My current thinking: we need `log/error`, but which will print only causes, without the stacktrace.

Tony-metabase (Issue Creator) on (2024-09-30 10:13:20 UTC): Closing this since the customer impacted by this and lack of logs reached out that since they moved all their cards to the MySQL database and discontinued support for ClickHouse, all recent deployments have been successful.

"
2500990235,issue,closed,completed,"passing a locale to static/public dashboards breaks dashcard downloads because of `""Unknown parameter :locale.""`",This also affects v50 for static dashboards and static questions (public ones didn't have downloads),npretto,2024-09-02 13:30:04+00:00,[],2025-01-31 12:58:29+00:00,2025-01-30 18:15:48+00:00,https://github.com/metabase/metabase/issues/47518,"[('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', '')]","[{'comment_id': 2626686301, 'issue_id': 2500990235, 'author': 'notz', 'body': '@albertoperdomo In which version this was fixed? For me, it still occurs on the latest 0.52.x release.', 'created_at': datetime.datetime(2025, 1, 31, 8, 57, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2626938994, 'issue_id': 2500990235, 'author': 'albertoperdomo', 'body': ""@notz Can you describe your issue? Is the static embed or public link not being localized when passing ?locale or it is, but downloads don't work?"", 'created_at': datetime.datetime(2025, 1, 31, 11, 3, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2627171496, 'issue_id': 2500990235, 'author': 'notz', 'body': '@albertoperdomo download is not working\n\nrequest to /api/embed/card/…/query/xlsx?parameters=%7B%22locale%22%3A%22de%22%2C%22date%22%3A%22past13months%7E%22%7D&format_rows=true&pivot_results=false returns ""Unknown parameter :locale.""\n\nIf I remove the locale parameter from the url, the download is working.', 'created_at': datetime.datetime(2025, 1, 31, 12, 36, 7, tzinfo=datetime.timezone.utc)}, {'comment_id': 2627263256, 'issue_id': 2500990235, 'author': 'notz', 'body': '@albertoperdomo Ok, I have seen that there was a product change. The locale parameter is now part of the hash and only available to pro / enterprise.', 'created_at': datetime.datetime(2025, 1, 31, 12, 58, 28, tzinfo=datetime.timezone.utc)}]","notz on (2025-01-31 08:57:15 UTC): @albertoperdomo In which version this was fixed? For me, it still occurs on the latest 0.52.x release.

albertoperdomo on (2025-01-31 11:03:39 UTC): @notz Can you describe your issue? Is the static embed or public link not being localized when passing ?locale or it is, but downloads don't work?

notz on (2025-01-31 12:36:07 UTC): @albertoperdomo download is not working

request to /api/embed/card/…/query/xlsx?parameters=%7B%22locale%22%3A%22de%22%2C%22date%22%3A%22past13months%7E%22%7D&format_rows=true&pivot_results=false returns ""Unknown parameter :locale.""

If I remove the locale parameter from the url, the download is working.

notz on (2025-01-31 12:58:28 UTC): @albertoperdomo Ok, I have seen that there was a product change. The locale parameter is now part of the hash and only available to pro / enterprise.

"
2500918848,issue,closed,completed,Phantom tooltip when I hover over the magnifying glass icon here in the Summarize sidebar,"### Describe the bug

Happened after migration to the Mantine tooltip https://github.com/metabase/metabase/pull/45671

![image](https://github.com/user-attachments/assets/93207a0e-2b0d-443d-b181-53921e4640aa)


### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
Latest master
```


### Severity

P3

### Additional context

_No response_",NevRA,2024-09-02 12:58:18+00:00,['oisincoveney'],2024-10-08 16:15:38+00:00,2024-09-03 21:39:31+00:00,https://github.com/metabase/metabase/issues/47515,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Team/Embedding', '')]",[],
2500910896,issue,open,,Clean the /tmp folder,"**Is your feature request related to a problem? Please describe.**
Seems like we have a few instances that have been running 24/7 for months (yay!) but as they don't reboot, the /tmp folder doesn't get cleaned up

**Describe the solution you'd like**
Just a new task that cleans up the /tmp folder daily

**Describe alternatives you've considered**
Make a cron job

**How important is this feature to you?**
Well, I saw 2 instances today with the /tmp folder taking too much space, so maybe I'm biased

**Additional context**
NA
",paoliniluis,2024-09-02 12:54:59+00:00,[],2025-02-04 20:30:59+00:00,,https://github.com/metabase/metabase/issues/47514,"[('Type:New Feature', ''), ('Operation/', ''), ('Administration/', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2500875527,issue,open,,Enable custom character limit in the Detail component,"**Is your feature request related to a problem? Please describe.**
We're trying to dynamically load metric descriptions from our database to accompany the charts and make it easier for the end users to quickly see what a given chart is about. For a number of metrics we use, it's next to impossible to fit the description in 140 characters which results in a ""View more"". It looks rather odd when a two-sentence description gets truncated in the middle of the second sentence. I was hoping that maybe setting a field as description in the model would help but it doesn't affect truncation.

**Describe the solution you'd like**
Make it possible to enable/disable truncation of text as a setting.

**Describe alternatives you've considered**
We've tried rewriting the descriptions to be shorter. Right now they are hard-coded as text boxes but it makes it much more time consuming to update.
![Screenshot 2024-09-02 at 14 34 36](https://github.com/user-attachments/assets/e06d7f5a-cf7e-448a-ac67-8ef26a9da87d)
![Screenshot 2024-09-02 at 14 34 48](https://github.com/user-attachments/assets/78ca4123-b971-40a2-9753-3ebbf9267e32)


**How important is this feature to you?**
It would be very useful, we've been trying to make it work with different updates.

**Additional context**
Added some pictures for context.
",magsaas,2024-09-02 12:39:07+00:00,[],2025-02-04 20:31:34+00:00,,https://github.com/metabase/metabase/issues/47513,"[('Type:New Feature', ''), ('Visualization/Detail', 'ObjectDetail')]",[],
2500545852,issue,open,,BigQuery Spaces in Column Name Break Models,"### Describe the bug

Metabase Version `v1.50.23`


Creating a model based on SQL that contains spaces in column names, breaks the Model (the as a question, it would work).

Simple example:
```sql
SELECT 1 AS `FOO BAR`
```

When turned into a model and executed, it gives
```
400 Bad Request
POST https://bigquery.googleapis.com/bigquery/v2/projects/metabase-bigquery-driver/queries
{
  ""code"": 400,
  ""errors"": [
    {
      ""domain"": ""global"",
      ""location"": ""q"",
      ""locationType"": ""parameter"",
      ""message"": ""Name FOO_BAR not found inside source at [2:17]"",
      ""reason"": ""invalidQuery""
    }
  ],
  ""message"": ""Name FOO_BAR not found inside source at [2:17]"",
  ""status"": ""INVALID_ARGUMENT""
}
```

Since the generated SQL adds a `_` (underscore) to the column name (`source`.`FOO_BAR` instead of   `source`.`FOO BAR`):
```sql
SELECT
  `source`.`FOO_BAR` AS `FOO_BAR`
FROM
  (
    SELECT
      1 AS `FOO BAR`
  ) AS `source`
LIMIT
  1048575
  ```

### To Reproduce

1. Create a new native question with the following SQL ```SELECT 1 AS `FOO BAR````using a BigQuery connector
2. Save it and turn it into a model


### Expected behavior

When querying the SQL model, it should take into account spaces in column names.

### Logs

None

### Information about your Metabase installation

```JSON
Metabase Version `v1.50.23`

(Reproducable on Stats)
```


### Severity

Very annoying and potentially breaks models after updating in new versions

### Additional context

None
",Somtom,2024-09-02 10:05:37+00:00,[],2025-02-04 20:27:57+00:00,,https://github.com/metabase/metabase/issues/47506,"[('Type:Bug', 'Product defects'), ('Database/', ''), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('Database/BigQuery', ''), ('.Team/Drivers', '')]","[{'comment_id': 2391925119, 'issue_id': 2500545852, 'author': 'oreststetsiak', 'body': '+1', 'created_at': datetime.datetime(2024, 10, 3, 17, 14, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2426469625, 'issue_id': 2500545852, 'author': 'paoliniluis', 'body': 'seems like hyphens also break the queries, see ticket 31344', 'created_at': datetime.datetime(2024, 10, 21, 11, 59, 13, tzinfo=datetime.timezone.utc)}]","oreststetsiak on (2024-10-03 17:14:12 UTC): +1

paoliniluis on (2024-10-21 11:59:13 UTC): seems like hyphens also break the queries, see ticket 31344

"
2500470909,issue,closed,completed,Remove useMemo from tabs computation,Address this PR feedback: https://github.com/metabase/metabase/pull/47309#discussion_r1738880979,kamilmielnik,2024-09-02 09:30:29+00:00,['kamilmielnik'],2024-09-09 07:27:00+00:00,2024-09-09 07:27:00+00:00,https://github.com/metabase/metabase/issues/47502,"[('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2337335362, 'issue_id': 2500470909, 'author': 'kamilmielnik', 'body': 'Closed by #47505', 'created_at': datetime.datetime(2024, 9, 9, 7, 27, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-09-09 07:27:00 UTC): Closed by #47505

"
2500446208,issue,closed,completed,Add tests for the new SDK card + settings page,Epic https://github.com/metabase/metabase/issues/46970,WiNloSt,2024-09-02 09:18:39+00:00,['WiNloSt'],2024-09-05 15:20:01+00:00,2024-09-05 15:20:01+00:00,https://github.com/metabase/metabase/issues/47501,[],[],
2500423928,issue,open,,CI migration upgrade/downgrade between versions,"We write migration tests to check if they are applied cleanly, but they are too synthetic to catch all real-world issues.

For example, we recently had an issue where [50 couldn't be upgraded to master](https://github.com/metabase/metabase/issues/47336), and an almost [reverse situation](https://metaboat.slack.com/archives/C064EB1UE5P/p1725029671854789?thread_ts=1725029214.057069&cid=C064EB1UE5P).

It would be really helpful to have a CI job that starts latest release of Metabase and then upgrades it to whatever is in the PR, and a reverse one too.
",piranha,2024-09-02 09:08:15+00:00,[],2025-01-17 20:29:46+00:00,,https://github.com/metabase/metabase/issues/47500,[],"[{'comment_id': 2329558912, 'issue_id': 2500423928, 'author': 'camsaul', 'body': 'discussion thread about data to use for this https://metaboat.slack.com/archives/C010ZSXQY87/p1725468799072829', 'created_at': datetime.datetime(2024, 9, 4, 16, 54, 15, tzinfo=datetime.timezone.utc)}]","camsaul on (2024-09-04 16:54:15 UTC): discussion thread about data to use for this https://metaboat.slack.com/archives/C010ZSXQY87/p1725468799072829

"
2500272911,issue,open,,International characters do not display for charts when rendering subscriptions,"### Describe the bug

Unicode characters not showing up in alerts for charts such as bar chart. This issue only fixed it for tables and text cards:

https://github.com/metabase/metabase/issues/38753

Which makes sense cause for the table renders doesn’t necessarily apply to chart rendrers; for technical reasons in the backend we have 2 different ways they are rendered. Tables use 1 library called ‘CSSBox’ and charts use ‘SVG Batik’. These libraries load fonts somewhat differently, and so fixing 1 doesn’t automatically fix the other, sadly. So the below is the result

![image](https://github.com/user-attachments/assets/56ef1bb6-add0-413e-bb61-f67f76b6eef4)



### To Reproduce

Simply go on this dashboard and send a test email:

https://stats.metabase.com/dashboard/2020-test?date_filter= 

You will notice Thai words on the barchart don't get rendered

### Expected behavior

All International characters get's renders properly for all visualisation types

### Logs

None that are relevant

### Information about your Metabase installation

```JSON
50 and even master
```


### Severity

We gave the impression we supported international characters but only partially

### Additional context

_No response_",Tony-metabase,2024-09-02 07:58:01+00:00,[],2025-02-04 20:28:58+00:00,,https://github.com/metabase/metabase/issues/47497,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Alerts', ''), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2324688166, 'issue_id': 2500272911, 'author': 'paoliniluis', 'body': 'we need to add https://pkgs.alpinelinux.org/package/edge/community/x86/font-noto-thai to the alpine container @Tony-metabase', 'created_at': datetime.datetime(2024, 9, 2, 12, 50, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2324696877, 'issue_id': 2500272911, 'author': 'Tony-metabase', 'body': ""Metabase works without issues, it's the subscription that are experiencing this problem @paoliniluis ... Similar to this issue https://github.com/metabase/metabase/issues/38753"", 'created_at': datetime.datetime(2024, 9, 2, 12, 55, 20, tzinfo=datetime.timezone.utc)}, {'comment_id': 2354147235, 'issue_id': 2500272911, 'author': 'adam-james-v', 'body': ""@Tony-metabase , in this case I do think @paoliniluis is right, it will likely fix this issue. The reason I say this is because locally, I have installed a Thai font and the static-viz renders work properly.\r\n\r\nI suspect the reason in app things are working is because users accessing the app have system fonts intstalled that can render Thai characters.\r\n\r\nBut, in the case of static-viz, particularly cloud instances, the static-viz render is of course happening on the server, and if it's in the container, it won't have the same font access, unless we explicitly install those fonts."", 'created_at': datetime.datetime(2024, 9, 16, 22, 34, 58, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-02 12:50:54 UTC): we need to add https://pkgs.alpinelinux.org/package/edge/community/x86/font-noto-thai to the alpine container @Tony-metabase

Tony-metabase (Issue Creator) on (2024-09-02 12:55:20 UTC): Metabase works without issues, it's the subscription that are experiencing this problem @paoliniluis ... Similar to this issue https://github.com/metabase/metabase/issues/38753

adam-james-v on (2024-09-16 22:34:58 UTC): @Tony-metabase , in this case I do think @paoliniluis is right, it will likely fix this issue. The reason I say this is because locally, I have installed a Thai font and the static-viz renders work properly.

I suspect the reason in app things are working is because users accessing the app have system fonts intstalled that can render Thai characters.

But, in the case of static-viz, particularly cloud instances, the static-viz render is of course happening on the server, and if it's in the container, it won't have the same font access, unless we explicitly install those fonts.

"
2499696427,issue,closed,completed,Pulse card render error - getSeriesVizSettingsKey - TypeError: Cannot read property 'name' of undefined,"### Describe the bug

A question using a stacked bar chart displays fine on the web, however when it is included in an emailed pulse we get ""An error occurred while displaying this card"" in place of the graph. In the log we get a stack trace reflecting an issue with getSeriesVizSettingsKey as per logs below.

This was previously raised as #45397 however it has not been fixed (despite being marked as such).

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

_No response_

### Logs

[metabase-log-error.log](https://github.com/user-attachments/files/16830589/metabase-log-error.log)


### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:129.0) Gecko/20100101 Firefox/129.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-21"",
      ""tag"": ""v0.50.21"",
      ""hash"": ""ec9f5d7""
    },
    ""settings"": {
      ""report-timezone"": ""Australia/Sydney""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.11""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.220-209.869.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

Medium (preventing external subscribers receiving charts)

### Additional context

_No response_",BenPhegan,2024-09-01 21:42:03+00:00,['alxnddr'],2024-09-11 18:42:30+00:00,2024-09-11 04:04:27+00:00,https://github.com/metabase/metabase/issues/47495,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Reporting/Pulses', 'Now called Subscriptions'), ('Visualization/Chart Settings', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2327242733, 'issue_id': 2499696427, 'author': 'alxnddr', 'body': 'Hi @BenPhegan, sorry for missing your comments in the original issue. It appears I fixed a different case which also led to an error but not yours. To understand precisely your case and fix the issue it would be very helpful to learn more about the problematic question so I wonder if you could provide a bit more information:\r\n- Open the chrome dev tools -> Network tab\r\n- Open the question individually\r\n- In the network tab find `/api/card/*:id*` request, copy and save the `visualization_settings` object\r\n<img width=""913"" alt=""Screenshot 2024-09-03 at 3 09 07\u202fPM"" src=""https://github.com/user-attachments/assets/5d9f524a-e121-4526-9875-be4e0d248494"">\r\n- Find `/api/card/*:id*/query` request, copy and save `data.cols`:\r\n<img width=""1018"" alt=""Screenshot 2024-09-03 at 3 12 02\u202fPM"" src=""https://github.com/user-attachments/assets/0a8cc6b0-5bd5-413c-af8d-32c9b632cf70"">\r\n- Send both to aleksandr@metabase.com', 'created_at': datetime.datetime(2024, 9, 3, 19, 16, 17, tzinfo=datetime.timezone.utc)}]","alxnddr (Assginee) on (2024-09-03 19:16:17 UTC): Hi @BenPhegan, sorry for missing your comments in the original issue. It appears I fixed a different case which also led to an error but not yours. To understand precisely your case and fix the issue it would be very helpful to learn more about the problematic question so I wonder if you could provide a bit more information:
- Open the chrome dev tools -> Network tab
- Open the question individually
- In the network tab find `/api/card/*:id*` request, copy and save the `visualization_settings` object
<img width=""913"" alt=""Screenshot 2024-09-03 at 3 09 07 PM"" src=""https://github.com/user-attachments/assets/5d9f524a-e121-4526-9875-be4e0d248494"">
- Find `/api/card/*:id*/query` request, copy and save `data.cols`:
<img width=""1018"" alt=""Screenshot 2024-09-03 at 3 12 02 PM"" src=""https://github.com/user-attachments/assets/0a8cc6b0-5bd5-413c-af8d-32c9b632cf70"">
- Send both to aleksandr@metabase.com

"
2499666832,issue,open,,Driver: Cloudflare D1,"**Is your feature request related to a problem? Please describe.**
Right now it is not possible to query Cloudflare D1 since it would require a custom connector to call the [D1 API](https://developers.cloudflare.com/api/operations/cloudflare-d1-query-database).

**Describe the solution you'd like**
A connector to connect to Cloudflare D1. It would work exactly like the sqlite connector except the connection layer.

**Describe alternatives you've considered**
Otherwise you need a worker to copy data from D1 to another data store

**How important is this feature to you?**
This would open metabase to supporting other sqlite-based remote store and they are getting popular for edge computing.
These are often used to compute statistics so it would be nice to support them. 
",Sytten,2024-09-01 20:23:44+00:00,[],2025-02-04 20:30:39+00:00,,https://github.com/metabase/metabase/issues/47494,"[('Database/', ''), ('Type:New Feature', '')]","[{'comment_id': 2405591206, 'issue_id': 2499666832, 'author': 'CharlieMc0', 'body': 'PLus 1. This feature would be useful for us to.', 'created_at': datetime.datetime(2024, 10, 10, 16, 42, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2405659430, 'issue_id': 2499666832, 'author': 'CryptoFewka', 'body': 'There is a third party JDBC driver which may accelerate any potential integration: https://github.com/isaac-mcfadyen/d1-jdbc-driver/', 'created_at': datetime.datetime(2024, 10, 10, 17, 19, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2430287689, 'issue_id': 2499666832, 'author': 'ebar0n', 'body': '👍🏽  This feature would be useful for us to.', 'created_at': datetime.datetime(2024, 10, 22, 21, 6, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2430295145, 'issue_id': 2499666832, 'author': 'jdpeinado', 'body': '+1, we need this', 'created_at': datetime.datetime(2024, 10, 22, 21, 9, 6, tzinfo=datetime.timezone.utc)}, {'comment_id': 2432039518, 'issue_id': 2499666832, 'author': 'paoliniluis', 'body': ""we don't count comments on issues, but rather thumbs up emojis on the first comment"", 'created_at': datetime.datetime(2024, 10, 23, 12, 45, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2432041093, 'issue_id': 2499666832, 'author': 'paoliniluis', 'body': '@jdpeinado @ebar0n @CryptoFewka @CharlieMc0', 'created_at': datetime.datetime(2024, 10, 23, 12, 46, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2541603668, 'issue_id': 2499666832, 'author': 'ebar0n', 'body': 'Hi, any updates?', 'created_at': datetime.datetime(2024, 12, 13, 14, 39, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2541665711, 'issue_id': 2499666832, 'author': 'paoliniluis', 'body': ""If I'm not wrong this is a database that can be accessed only via REST calls, so we won't be able to do anything till we have https://github.com/metabase/metabase/issues/4831\n\nEDIT: I don't think it makes sense to add a JDBC layer on top of an API, it adds complexity, points of failure, and has security implications (like supply chain attacks)"", 'created_at': datetime.datetime(2024, 12, 13, 15, 10, 35, tzinfo=datetime.timezone.utc)}]","CharlieMc0 on (2024-10-10 16:42:53 UTC): PLus 1. This feature would be useful for us to.

CryptoFewka on (2024-10-10 17:19:54 UTC): There is a third party JDBC driver which may accelerate any potential integration: https://github.com/isaac-mcfadyen/d1-jdbc-driver/

ebar0n on (2024-10-22 21:06:51 UTC): 👍🏽  This feature would be useful for us to.

jdpeinado on (2024-10-22 21:09:06 UTC): +1, we need this

paoliniluis on (2024-10-23 12:45:39 UTC): we don't count comments on issues, but rather thumbs up emojis on the first comment

paoliniluis on (2024-10-23 12:46:15 UTC): @jdpeinado @ebar0n @CryptoFewka @CharlieMc0

ebar0n on (2024-12-13 14:39:27 UTC): Hi, any updates?

paoliniluis on (2024-12-13 15:10:35 UTC): If I'm not wrong this is a database that can be accessed only via REST calls, so we won't be able to do anything till we have https://github.com/metabase/metabase/issues/4831

EDIT: I don't think it makes sense to add a JDBC layer on top of an API, it adds complexity, points of failure, and has security implications (like supply chain attacks)

"
2499147934,issue,open,,You can't get filter values from questions based on hidden models (but you can filter the questions),"### Describe the bug

a really interesting edge case where the filter in the dashboards will fail if the model is on a non-readable collection

### To Reproduce

1. create a group and create a user that belongs to that group
2. create a new collection
3. remove all collection permissions to the newly created group, but only grant view only permissions to our analytics
4. build a model (e.g. select all people), save it on the newly created collection (the one that the user DOESN'T have access to)
5. build a question based on that model (e.g. count of all rows), leave this question on the our analytics collecton
6. create a dashboard and add the dashboard to our analytics
7. add a filter to the dashboard connected to the source field
8. now go with the new user (not admin) to the dashboard. See that the user can enter manually the sources and the question will change, but the filter won't auto populate

In fact, if you add the raw model to the dashboard, it won't be rendered (as the user doesn't have permissions on the collection where the model is), but the aggregated questions will.

### Expected behaviorj

If a user can filter the question, then they should be able to get the filter values

This is a very special edge case, since using all other filter types will work perfectly fine, but NOT the categorical filters

### Logs

It's a permissions issue in the BE

### Information about your Metabase installation

```JSON
v50.23
```

### Severity

P2

### Additional context

most probably since models were introduced

This needs a product input, specifically to check what do we do with model permissions",paoliniluis,2024-09-01 01:50:36+00:00,[],2025-02-05 19:23:28+00:00,,https://github.com/metabase/metabase/issues/47493,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Administration/Permissions', 'Collection or Data permissions'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Backend', ''), ('.Product Input Needed', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2498884484,issue,open,,Support UNIX Socket for PostgreSQL Application Database Connection,"**Is your feature request related to a problem? Please describe.**

I would like to connect to my PostgreSQL database via a local socket connection for the **application database**.

1. **More secure**: User-based auth has no passwords to leak.
2. **More convenient**: No need to create and manage passwords.
3. **Faster**: UNIX sockets are slightly more performant than TCP loopback.

**Describe the solution you'd like**

I don't really care how it works, but the official diver page suggests adding a dependency which can be (very ugily) configured as a socket factory:

https://jdbc.postgresql.org/documentation/use/#unix-sockets

> By adding junixsocket you can obtain a socket factory that works with the driver.
>
> ...
>
> Simply add ?socketFactory=org.newsclub.net.unix.AFUNIXSocketFactory$FactoryArg&socketFactoryArg=[path-to-the-unix-socket] to the connection URL.

Honestly this should be the default behaviour for URLs like `jdbc:postgresql:metabase` but for now I would be happy for any support.

**Describe alternatives you've considered**

Setting `MB_DB_TYPE=postgres` or  `MB_DB_TYPE=postgres MB_DB_CONNECTION_URI=jdbc:postgresql:metabase` doesn't work as it tries to connect to localhost over TCP which has no authorization.

**How important is this feature to you?**

Quite important. I was recommended to move to PostgreSQL off of H2 but I don't want to migrate if it means that I need to generate, safely store and distribute passwords manually.",kevincox,2024-08-31 14:47:34+00:00,[],2025-02-04 20:31:02+00:00,,https://github.com/metabase/metabase/issues/47492,"[('Database/Postgres', None), ('Type:New Feature', '')]","[{'comment_id': 2323099487, 'issue_id': 2498884484, 'author': 'paoliniluis', 'body': 'Have you tried adding the dependency and building?\r\n\r\nit is as easy as adding \r\n```\r\ncom.kohlschutter.junixsocket {:mvn/version ""2.10.0""}\r\n```\r\n\r\non the deps.edn file', 'created_at': datetime.datetime(2024, 9, 1, 1, 10, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2323099750, 'issue_id': 2498884484, 'author': 'paoliniluis', 'body': 'related to https://github.com/metabase/metabase/issues/28044', 'created_at': datetime.datetime(2024, 9, 1, 1, 11, 6, tzinfo=datetime.timezone.utc)}, {'comment_id': 2323100174, 'issue_id': 2498884484, 'author': 'kevincox', 'body': ""At this point I haven't tried customizing the build. If I find some time it is something I might try to get set up."", 'created_at': datetime.datetime(2024, 9, 1, 1, 12, 38, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-01 01:10:05 UTC): Have you tried adding the dependency and building?

it is as easy as adding 
```
com.kohlschutter.junixsocket {:mvn/version ""2.10.0""}
```

on the deps.edn file

paoliniluis on (2024-09-01 01:11:06 UTC): related to https://github.com/metabase/metabase/issues/28044

kevincox (Issue Creator) on (2024-09-01 01:12:38 UTC): At this point I haven't tried customizing the build. If I find some time it is something I might try to get set up.

"
2498433151,issue,open,,"Expose the error of ""convertTimezone"" in the formula","**Is your feature request related to a problem? Please describe.**
If what you enter in convert timezone ends up compiling badly, you'll only be able to see the error in the response of the API. E.g.
![image](https://github.com/user-attachments/assets/4ba634ab-d7e5-4b60-8a1d-26d7f397e828)

**Describe the solution you'd like**
We should surface those errors in the formula builder

**Describe alternatives you've considered**
None

**How important is this feature to you?**
Just asking

**Additional context**
NA
",paoliniluis,2024-08-30 23:42:05+00:00,[],2025-02-04 20:30:45+00:00,,https://github.com/metabase/metabase/issues/47487,"[('Type:New Feature', ''), ('Querying/Notebook/Custom Column', '')]",[],
2498333364,issue,open,,Parameters in the body rather than on the body of the JWT,"**Is your feature request related to a problem? Please describe.**
If you're passing a huge amount of filters in the JWT then the URI that gets generated is very large, leading to the max url limit in browsers https://chromium.googlesource.com/chromium/src/+/master/docs/security/url_display_guidelines/url_display_guidelines.md#url-length

**Describe the solution you'd like**
We need to find a way of sending the parameters in the body of the request, and Metabase will return a signed url

**Describe alternatives you've considered**
You could be doing some hashing at the DB level and use hashes with the combination of filters

**How important is this feature to you?**
requested by a customer

**Additional context**
NA
",paoliniluis,2024-08-30 22:43:41+00:00,[],2025-02-04 20:30:32+00:00,,https://github.com/metabase/metabase/issues/47486,"[('Type:New Feature', ''), ('Embedding/Static', 'Static embedding, previously known as signed embedding')]",[],
2498154631,issue,open,,Printing (via a printer) makes chart not to render correctly in the print preview,"### Describe the bug

There's something weird when you print a dashboard via a printer: the charts don't resize to fit the card space and that's why you don't see anything at all

### To Reproduce

E.g. try printing the dashboard in the stats home page and see the charts not fitting into the cards

### Expected behavior

Charts should at least fit into the card size

### Logs

NA

### Information about your Metabase installation

```JSON
v50.x
```


### Severity

P3

### Additional context

Note: see also how there are many pages empty at the bottom",paoliniluis,2024-08-30 20:49:34+00:00,[],2025-02-04 20:28:42+00:00,,https://github.com/metabase/metabase/issues/47483,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Dashboards', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2386738752, 'issue_id': 2498154631, 'author': 'paoliniluis', 'body': ""Moved to a P2 since now 2 customers are asking for this. Saw some video and there's a little pain on how the print experience"", 'created_at': datetime.datetime(2024, 10, 1, 18, 57, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2387288149, 'issue_id': 2498154631, 'author': 'cdeweyx', 'body': ""Need to figure out how to simulate page breaks in our dashboards PDF exports to avoid one-long-page which doesn't print well. [More discussion here](https://metaboat.slack.com/archives/C01LQQ2UW03/p1723822151560399)."", 'created_at': datetime.datetime(2024, 10, 2, 0, 1, 36, tzinfo=datetime.timezone.utc)}]","paoliniluis (Issue Creator) on (2024-10-01 18:57:24 UTC): Moved to a P2 since now 2 customers are asking for this. Saw some video and there's a little pain on how the print experience

cdeweyx on (2024-10-02 00:01:36 UTC): Need to figure out how to simulate page breaks in our dashboards PDF exports to avoid one-long-page which doesn't print well. [More discussion here](https://metaboat.slack.com/archives/C01LQQ2UW03/p1723822151560399).

"
2497950718,issue,closed,completed,Downloads don't work on sandboxed tables,"### Describe the bug

If you try to download a question that's aggregated from a sandboxed table, it won't work

### To Reproduce

1) create a group and a user. User should have state = CA user property
2) sandbox the people table with the state attribute
3) create a question like 
![image](https://github.com/user-attachments/assets/a122b5c6-9894-4674-bd5a-fa69097cd715)

save it as a bar chart
4) authenticate as the sandboxed user, try to download the results, you can't

### Expected behavior

You should be able to sandbox an aggregated question result

### Logs

```
{""database_id"":8,""started_at"":""2024-08-30T18:21:04.08242Z"",""action_id"":null,""error_type"":""missing-required-permissions"",""json_query"":{""constraints"":null,""type"":""query"",""middleware"":{""js-int-to-string?"":false,""ignore-cached-results?"":true,""process-viz-settings?"":true,""skip-results-metadata?"":true,""format-rows?"":true,""userland-query?"":true},""cache-strategy"":null,""viz-settings"":{""map.type"":""region"",""map.region"":""us_states"",""graph.dimensions"":[""source"",""state""],""graph.series_order_dimension"":null,""graph.series_order"":null,""graph.metrics"":[""count""]},""database"":8,""query"":{""source-table"":246,""aggregation"":[[""count""]],""breakout"":[[""field"",10355,{""base-type"":""type/Text""}],[""field"",10358,{""base-type"":""type/Text""}]]},""parameters"":[]},""native"":null,""status"":""failed"",""class"":""class clojure.lang.ExceptionInfo"",""stacktrace"":[""--> metabase_enterprise.advanced_permissions.query_processor.middleware.permissions$fn__110625$check_download_permissions__110626$fn__110627.invoke(permissions.clj:87)"",""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64732.invoke(enterprise.clj:51)"",""metabase_enterprise.sandbox.query_processor.middleware.column_level_perms_check$fn__112456$maybe_apply_column_level_perms_check__112457$fn__112458.invoke(column_level_perms_check.clj:38)"",""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64742.invoke(enterprise.clj:64)"",""query_processor.execute$execute$fn__70700.invoke(execute.clj:92)"",""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)"",""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)"",""query_processor.execute$execute.invokeStatic(execute.clj:91)"",""query_processor.execute$execute.invoke(execute.clj:87)"",""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)"",""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)"",""metabase_enterprise.audit_app.query_processor.middleware.handle_audit_queries$fn__82775$handle_audit_app_internal_queries__82776$fn__82777.invoke(handle_audit_queries.clj:145)"",""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__64770.invoke(enterprise.clj:103)"",""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76441.invoke(process_userland_query.clj:198)"",""query_processor.middleware.catch_exceptions$catch_exceptions$fn__76510.invoke(catch_exceptions.clj:128)"",""query_processor$process_query$fn__76547.invoke(query_processor.clj:78)"",""query_processor.setup$do_with_canceled_chan$fn__65174.invoke(setup.clj:189)"",""query_processor.setup$do_with_database_local_settings$fn__65169.invoke(setup.clj:181)"",""query_processor.setup$do_with_driver$fn__65164$fn__65165.invoke(setup.clj:166)"",""driver$do_with_driver.invokeStatic(driver.clj:104)"",""driver$do_with_driver.invoke(driver.clj:99)"",""query_processor.setup$do_with_driver$fn__65164.invoke(setup.clj:165)"",""query_processor.setup$do_with_metadata_provider$fn__65157$fn__65160.invoke(setup.clj:151)"",""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:170)"",""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)"",""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:159)"",""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)"",""query_processor.setup$do_with_metadata_provider$fn__65157.invoke(setup.clj:150)"",""query_processor.setup$do_with_resolved_database$fn__65151.invoke(setup.clj:128)"",""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)"",""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)"",""query_processor$process_query.invokeStatic(query_processor.clj:76)"",""query_processor$process_query.invoke(query_processor.clj:69)"",""query_processor.card$process_query_for_card_default_qp.invokeStatic(card.clj:170)"",""query_processor.card$process_query_for_card_default_qp.invoke(card.clj:166)"",""query_processor.card$process_query_for_card_default_run_fn$fn__84508$fn__84509.invoke(card.clj:177)"",""query_processor.streaming$_streaming_response$fn__68656$fn__68657$fn__68658.invoke(streaming.clj:175)"",""query_processor.streaming$_streaming_response$fn__68656$fn__68657.invoke(streaming.clj:174)"",""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)"",""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)"",""query_processor.streaming$_streaming_response$fn__68656.invoke(streaming.clj:171)"",""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)"",""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)"",""async.streaming_response$do_f_async$task__51966.invoke(streaming_response.clj:87)""],""card_id"":145,""context"":""csv-download"",""error"":""You do not have permissions to download the results of this query."",""row_count"":0,""running_time"":0,""preprocessed"":{""middleware"":{""js-int-to-string?"":false,""ignore-cached-results?"":true,""process-viz-settings?"":true,""skip-results-metadata?"":true,""format-rows?"":true,""userland-query?"":true},""viz-settings"":{""map.type"":""region"",""map.region"":""us_states"",""graph.dimensions"":[""source"",""state""],""graph.series_order_dimension"":null,""graph.series_order"":null,""graph.metrics"":[""count""]},""info"":{""executed-by"":2,""context"":""csv-download"",""card-id"":145,""card-name"":""People, Count, Grouped by State and Source"",""visualization-settings"":{""map.type"":""region"",""map.region"":""us_states"",""graph.dimensions"":[""source"",""state""],""graph.metrics"":[""count""]}},""database"":8,""type"":""query"",""query"":{""aggregation"":[[""aggregation-options"",[""count""],{""name"":""count""}]],""breakout"":[[""field"",10355,{""base-type"":""type/Text""}],[""field"",10358,{""base-type"":""type/Text""}]],""source-metadata"":[{""description"":""A unique identifier given to each user."",""semantic_type"":""type/PK"",""table_id"":246,""coercion_strategy"":null,""name"":""id"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10351,null],""effective_type"":""type/BigInteger"",""nfc_path"":null,""parent_id"":null,""id"":10351,""position"":0,""visibility_type"":""normal"",""display_name"":""ID"",""fingerprint"":null,""base_type"":""type/BigInteger""},{""description"":""The street address of the account’s billing address"",""semantic_type"":null,""table_id"":246,""coercion_strategy"":null,""name"":""address"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10363,null],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10363,""position"":1,""visibility_type"":""normal"",""display_name"":""Address"",""fingerprint"":{""global"":{""distinct-count"":2490,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":0.0,""average-length"":20.85}}},""base_type"":""type/Text""},{""description"":""The contact email for the account."",""semantic_type"":""type/Email"",""table_id"":246,""coercion_strategy"":null,""name"":""email"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10362,null],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10362,""position"":2,""visibility_type"":""normal"",""display_name"":""Email"",""fingerprint"":{""global"":{""distinct-count"":2500,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":1.0,""percent-state"":0.0,""average-length"":24.1824}}},""base_type"":""type/Text""},{""description"":""This is the salted password of the user. It should not be visible"",""semantic_type"":null,""table_id"":246,""coercion_strategy"":null,""name"":""password"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10354,null],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10354,""position"":3,""visibility_type"":""normal"",""display_name"":""Password"",""fingerprint"":{""global"":{""distinct-count"":2500,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":0.0,""average-length"":36.0}}},""base_type"":""type/Text""},{""description"":""The name of the user who owns an account"",""semantic_type"":""type/Name"",""table_id"":246,""coercion_strategy"":null,""name"":""name"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10361,null],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10361,""position"":4,""visibility_type"":""normal"",""display_name"":""Name"",""fingerprint"":{""global"":{""distinct-count"":2499,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":0.0,""average-length"":13.532}}},""base_type"":""type/Text""},{""description"":""The city of the account’s billing address"",""semantic_type"":""type/City"",""table_id"":246,""coercion_strategy"":null,""name"":""city"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10359,null],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10359,""position"":5,""visibility_type"":""normal"",""display_name"":""City"",""fingerprint"":{""global"":{""distinct-count"":1966,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":0.002,""average-length"":8.284}}},""base_type"":""type/Text""},{""description"":""This is the longitude of the user on sign-up. It might be updated in the future to the last seen location."",""semantic_type"":""type/Longitude"",""table_id"":246,""coercion_strategy"":null,""name"":""longitude"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10357,null],""effective_type"":""type/Float"",""nfc_path"":null,""parent_id"":null,""id"":10357,""position"":6,""visibility_type"":""normal"",""display_name"":""Longitude"",""fingerprint"":{""global"":{""distinct-count"":2491,""nil%"":0.0},""type"":{""type/Number"":{""min"":-166.5425726,""q1"":-101.58350792373135,""q3"":-84.65289348288829,""max"":-67.96735199999999,""sd"":15.399698968175663,""avg"":-95.18741780363999}}},""base_type"":""type/Float""},{""description"":""The state or province of the account’s billing address"",""semantic_type"":""type/State"",""table_id"":246,""coercion_strategy"":null,""name"":""state"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10355,null],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10355,""position"":7,""visibility_type"":""normal"",""display_name"":""State"",""fingerprint"":{""global"":{""distinct-count"":49,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":1.0,""average-length"":2.0}}},""base_type"":""type/Text""},{""description"":""The channel through which we acquired this user. Valid values include: Affiliate, Facebook, Google, Organic and Twitter"",""semantic_type"":""type/Source"",""table_id"":246,""coercion_strategy"":null,""name"":""source"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10358,null],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10358,""position"":8,""visibility_type"":""normal"",""display_name"":""Source"",""fingerprint"":{""global"":{""distinct-count"":5,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":0.0,""average-length"":7.4084}}},""base_type"":""type/Text""},{""description"":""The date of birth of the user"",""semantic_type"":null,""table_id"":246,""coercion_strategy"":null,""unit"":""default"",""name"":""birth_date"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10353,{""temporal-unit"":""default""}],""effective_type"":""type/Date"",""nfc_path"":null,""parent_id"":null,""id"":10353,""position"":9,""visibility_type"":""normal"",""display_name"":""Birth Date"",""fingerprint"":{""global"":{""distinct-count"":2308,""nil%"":0.0},""type"":{""type/DateTime"":{""earliest"":""1958-04-26"",""latest"":""2000-04-03""}}},""base_type"":""type/Date""},{""description"":""The postal code of the account’s billing address"",""semantic_type"":null,""table_id"":246,""coercion_strategy"":null,""name"":""zip"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10352,null],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10352,""position"":10,""visibility_type"":""normal"",""display_name"":""Zip"",""fingerprint"":{""global"":{""distinct-count"":2234,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":0.0,""average-length"":5.0}}},""base_type"":""type/Text""},{""description"":""This is the latitude of the user on sign-up. It might be updated in the future to the last seen location."",""semantic_type"":""type/Latitude"",""table_id"":246,""coercion_strategy"":null,""name"":""latitude"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10360,null],""effective_type"":""type/Float"",""nfc_path"":null,""parent_id"":null,""id"":10360,""position"":11,""visibility_type"":""normal"",""display_name"":""Latitude"",""fingerprint"":{""global"":{""distinct-count"":2491,""nil%"":0.0},""type"":{""type/Number"":{""min"":25.775827,""q1"":35.302705923023126,""q3"":43.773802584662,""max"":70.6355001,""sd"":6.390832341883712,""avg"":39.87934670484002}}},""base_type"":""type/Float""},{""description"":""The date the user record was created. Also referred to as the user’s \""join date\"""",""semantic_type"":""type/CreationTimestamp"",""table_id"":246,""coercion_strategy"":null,""unit"":""default"",""name"":""created_at"",""settings"":null,""source"":""fields"",""fk_target_field_id"":null,""field_ref"":[""field"",10356,{""temporal-unit"":""default""}],""effective_type"":""type/DateTime"",""nfc_path"":null,""parent_id"":null,""id"":10356,""position"":12,""visibility_type"":""normal"",""display_name"":""Created At"",""fingerprint"":{""global"":{""distinct-count"":2500,""nil%"":0.0},""type"":{""type/DateTime"":{""earliest"":""2016-04-19T21:35:18.752Z"",""latest"":""2019-04-19T14:06:27.3Z""}}},""base_type"":""type/DateTime""}],""order-by"":[[""asc"",[""field"",10355,{""base-type"":""type/Text""}]],[""asc"",[""field"",10358,{""base-type"":""type/Text""}]]],""source-query"":{""source-table"":246,""filter"":[""="",[""field"",10355,{""base-type"":""type/Text""}],[""value"",""CA"",{""base_type"":""type/Text"",""effective_type"":""type/Text"",""coercion_strategy"":null,""semantic_type"":""type/State"",""database_type"":""bpchar"",""name"":""state""}]],""fields"":[[""field"",10351,null],[""field"",10363,null],[""field"",10362,null],[""field"",10354,null],[""field"",10361,null],[""field"",10359,null],[""field"",10357,null],[""field"",10355,null],[""field"",10358,null],[""field"",10353,{""temporal-unit"":""default""}],[""field"",10352,null],[""field"",10360,null],[""field"",10356,{""temporal-unit"":""default""}]],""metabase-enterprise.sandbox.query-processor.middleware.row-level-restrictions/gtap?"":true}},""metabase-enterprise.sandbox.query-processor.middleware.row-level-restrictions/original-metadata"":[{""description"":""The state or province of the account’s billing address"",""semantic_type"":""type/State"",""table_id"":246,""coercion_strategy"":null,""name"":""state"",""settings"":null,""source"":""breakout"",""fk_target_field_id"":null,""field_ref"":[""field"",10355,{""base-type"":""type/Text""}],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10355,""position"":7,""visibility_type"":""normal"",""display_name"":""State"",""fingerprint"":{""global"":{""distinct-count"":49,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":1.0,""average-length"":2.0}}},""base_type"":""type/Text""},{""description"":""The channel through which we acquired this user. Valid values include: Affiliate, Facebook, Google, Organic and Twitter"",""semantic_type"":""type/Source"",""table_id"":246,""coercion_strategy"":null,""name"":""source"",""settings"":null,""source"":""breakout"",""fk_target_field_id"":null,""field_ref"":[""field"",10358,{""base-type"":""type/Text""}],""effective_type"":""type/Text"",""nfc_path"":null,""parent_id"":null,""id"":10358,""position"":8,""visibility_type"":""normal"",""display_name"":""Source"",""fingerprint"":{""global"":{""distinct-count"":5,""nil%"":0.0},""type"":{""type/Text"":{""percent-json"":0.0,""percent-url"":0.0,""percent-email"":0.0,""percent-state"":0.0,""average-length"":7.4084}}},""base_type"":""type/Text""},{""base_type"":""type/Integer"",""name"":""count"",""display_name"":""Count"",""semantic_type"":""type/Quantity"",""source"":""aggregation"",""field_ref"":[""aggregation"",0],""aggregation_index"":0}],""metabase.models.query.permissions/perms"":{""gtaps"":{""perms/view-data"":{},""perms/create-queries"":{""246"":""query-builder""}}}},""ex-data"":{""type"":""missing-required-permissions"",""permissions-error?"":true},""data"":{""rows"":[],""cols"":[]}}
```

### Information about your Metabase installation

```JSON
v50.23
```


### Severity

P1

### Additional context

permissions are
![image](https://github.com/user-attachments/assets/3d8f4c9f-7a47-49f1-a929-20bb44b3bf33)
![image](https://github.com/user-attachments/assets/ea289b88-3308-4958-8876-5cfc5b331b7f)

",paoliniluis,2024-08-30 18:27:43+00:00,['noahmoss'],2024-09-02 19:04:45+00:00,2024-09-02 14:54:23+00:00,https://github.com/metabase/metabase/issues/47478,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('Administration/Data Sandboxes', 'Enterprise Sandboxing'), ('Visualization/Download', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2497932361,issue,closed,duplicate,Opening link to a table looses the schema breadcrumb,"### Describe the bug

If you browse to a table, it will have a breadcrumb of ""Database / Schema / Table Name"" (update: even this is not working now). Now if you copy/paste the URL to open a new tab or simply refresh the page, the ""Schema"" part is gone. 

### To Reproduce

1. Browse to a table inside of a schema
2. Refresh page or copy URL to open a new tab (update: optional / this is happening without this now)
3. ""Schema"" part of the breadcrumb is gone 

### Expected behavior

It should retain the schema when clicking into a table (or after refresh or opening in a new tab)

### Logs

n/a

### Information about your Metabase installation

```JSON
Postgres @ master
```


### Severity

minor inconvenience when sharing with others

### Additional context

_No response_",maxzheng,2024-08-30 18:17:17+00:00,[],2025-01-22 13:53:25+00:00,2025-01-22 13:53:25+00:00,https://github.com/metabase/metabase/issues/47477,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Administration/', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2471553673, 'issue_id': 2497932361, 'author': 'maxzheng', 'body': ""Bumping up to P2 as it reduces usability of browsing as you can't click on the schema name to go back up, but forced to use the back button (which won't be possible if the link was shared by someone). When looking at a table, you won't know which schema it belongs to, this creates confusion."", 'created_at': datetime.datetime(2024, 11, 12, 20, 49, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2607309366, 'issue_id': 2497932361, 'author': 'luizarakaki', 'body': 'closing in favor of #47715', 'created_at': datetime.datetime(2025, 1, 22, 13, 53, 12, tzinfo=datetime.timezone.utc)}]","maxzheng (Issue Creator) on (2024-11-12 20:49:26 UTC): Bumping up to P2 as it reduces usability of browsing as you can't click on the schema name to go back up, but forced to use the back button (which won't be possible if the link was shared by someone). When looking at a table, you won't know which schema it belongs to, this creates confusion.

luizarakaki on (2025-01-22 13:53:12 UTC): closing in favor of #47715

"
2497897208,issue,open,,Signal somehow that a card in a dashboard has custom viz settings,"**Is your feature request related to a problem? Please describe.**
There's a very common scenario we hit with customers where they report that reordering columns does not impact the dashboard order, so we end up telling them to reset the card viz setting to default

**Describe the solution you'd like**
We need to signal to the user that the card has a custom viz setting. This should be in the edit mode of the dashboard, sort of a little red icon or something visual that tells the user of that fact

**Describe alternatives you've considered**
None

**How important is this feature to you?**

**Additional context**
related to https://github.com/metabase/metabase/issues/13595",paoliniluis,2024-08-30 17:55:19+00:00,[],2025-02-04 20:31:26+00:00,,https://github.com/metabase/metabase/issues/47475,"[('Reporting/Dashboards', ''), ('Type:New Feature', ''), ('Visualization/Chart Settings', '')]","[{'comment_id': 2572732824, 'issue_id': 2497897208, 'author': 'thebiglabasky', 'body': 'I ran into this too after changing a question that was part of a dashboard and being puzzled by not seeing the changes impacted on the dashboard. It took me a while to realize I might have had changed the viz settings at the dashboard level and needed to reset it.', 'created_at': datetime.datetime(2025, 1, 6, 9, 39, 36, tzinfo=datetime.timezone.utc)}]","thebiglabasky on (2025-01-06 09:39:36 UTC): I ran into this too after changing a question that was part of a dashboard and being puzzled by not seeing the changes impacted on the dashboard. It took me a while to realize I might have had changed the viz settings at the dashboard level and needed to reset it.

"
2497670363,issue,closed,completed,Replace *current* dynamic variable with function argument,"The thinking here is simply that dynamic variables are hard to reason about.

On the other hand, overloading functions and using combinators is also complex.",crisptrutski,2024-08-30 16:10:00+00:00,['crisptrutski'],2024-09-02 11:19:57+00:00,2024-09-02 09:57:19+00:00,https://github.com/metabase/metabase/issues/47467,[],[],
2497614447,issue,closed,completed,Order Metrics Alphabetically in GUI editor,"**Is your feature request related to a problem? Please describe.**
Now, Common Metrics in the GUI editor are not ordered alphabetically/indexed, but yes, by creation date. This, to some users, can be confusing.
<img width=""271"" alt=""Screenshot 2024-08-30 at 12 51 19 PM"" src=""https://github.com/user-attachments/assets/79691f25-8379-4eed-ab4e-94309740b59b"">

**Describe the solution you'd like**
Have a way to sort them or order them alphabetically by default

**Describe alternatives you've considered**
N/A

**How important is this feature to you?**
Requested by a customer, internal ticket [here](https://app.usepylon.com/issues?conversationID=908b339e-4b90-4c22-a0c7-cfce213fdce3)

**Additional context**
N/A
",ignacio-mb,2024-08-30 15:52:34+00:00,[],2024-09-27 13:57:34+00:00,2024-09-27 13:57:25+00:00,https://github.com/metabase/metabase/issues/47465,"[('Type:New Feature', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('Querying/Metrics', 'v2')]","[{'comment_id': 2379349370, 'issue_id': 2497614447, 'author': 'mngr', 'body': 'Fixed [here ](https://github.com/metabase/metabase/issues/46847)', 'created_at': datetime.datetime(2024, 9, 27, 13, 57, 25, tzinfo=datetime.timezone.utc)}]","mngr on (2024-09-27 13:57:25 UTC): Fixed [here ](https://github.com/metabase/metabase/issues/46847)

"
2497533263,issue,closed,completed,Add onSave and isSaveEnabled prop to CreateQuestion component in the sdk,"Add the `onSave` and `isSaveEnabled` prop to the `<CreateQuestion />` component in the SDK, to allow handling when the question has been saved (e.g. close the modal) and to hide the save button.
```[tasklist]
### Tasks
- [ ] https://github.com/metabase/metabase/pull/47442
- [ ] #47538
```
",heypoom,2024-08-30 15:29:29+00:00,['oisincoveney'],2024-09-23 12:49:21+00:00,2024-09-23 12:49:20+00:00,https://github.com/metabase/metabase/issues/47464,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2368124735, 'issue_id': 2497533263, 'author': 'oisincoveney', 'body': 'All tasks are done 🎉', 'created_at': datetime.datetime(2024, 9, 23, 12, 49, 21, tzinfo=datetime.timezone.utc)}]","oisincoveney (Assginee) on (2024-09-23 12:49:21 UTC): All tasks are done 🎉

"
2497303185,issue,closed,completed,Maintain tab state in Entity Picker,~Revert a93c593615c08a8ec10267859f0c6372a8fe9c9e and try to fix tests~,kamilmielnik,2024-08-30 13:50:29+00:00,['kamilmielnik'],2024-09-10 13:54:02+00:00,2024-09-10 13:54:01+00:00,https://github.com/metabase/metabase/issues/47454,"[('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2340880375, 'issue_id': 2497303185, 'author': 'kamilmielnik', 'body': 'Closed by #47794', 'created_at': datetime.datetime(2024, 9, 10, 13, 54, 1, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-09-10 13:54:01 UTC): Closed by #47794

"
2497266465,issue,closed,completed,Notifications Follow Up,"A few things I noticed in the Product Demo that were missed:
- New slack admin screen does not have breadcrumbs
- Need to update the API Key placeholder text
- Would like to add some e2e tests covering the different auth methods

",npfitz,2024-08-30 13:35:06+00:00,['npfitz'],2024-10-08 16:15:35+00:00,2024-09-04 15:51:30+00:00,https://github.com/metabase/metabase/issues/47452,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2497205851,issue,closed,not_planned,Failing migration between 0.50.10 and 0.50.22,"### Describe the bug

Migrating between community editions 0.50.10 -> 0.50.22 produced the following error:

```
ERROR metabase.core :: Metabase Initialization FAILED
liquibase.exception.CommandExecutionException: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:07::calherries:
Reason: liquibase.exception.DatabaseException: ERROR: syntax error at or near ""(""
Position: 87 [Failed SQL: (0) ALTER TABLE metabase_field ADD COLUMN unique_field_helper INTEGER GENERATED ALWAYS AS (
CASE WHEN is_defective_duplicate = TRUE THEN NULL ELSE (CASE WHEN parent_id IS NULL THEN 0 ELSE parent_id END) END
) STORED]
```

### To Reproduce

1. Go to a version 0.50.10
2. Upgrade to 0.50.22
4. See error


### Expected behavior

It should migrate as normal

### Logs

ERROR metabase.core :: Metabase Initialization FAILED
liquibase.exception.CommandExecutionException: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:07::calherries:
Reason: liquibase.exception.DatabaseException: ERROR: syntax error at or near ""(""
Position: 87 [Failed SQL: (0) ALTER TABLE metabase_field ADD COLUMN unique_field_helper INTEGER GENERATED ALWAYS AS (
CASE WHEN is_defective_duplicate = TRUE THEN NULL ELSE (CASE WHEN parent_id IS NULL THEN 0 ELSE parent_id END) END
) STORED]

### Information about your Metabase installation

```JSON
This isn't browser related.

The metabase instance is running on AWS ECS - we've had no issue migrating in the past but I'm not sure how to debug a syntax error.
```


### Severity

blocking an upgrade

### Additional context

_No response_",ActualAl,2024-08-30 13:12:13+00:00,[],2024-09-03 09:40:03+00:00,2024-08-30 14:18:17+00:00,https://github.com/metabase/metabase/issues/47450,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2321221463, 'issue_id': 2497205851, 'author': 'qnkhuat', 'body': 'Could you provide info about your database?', 'created_at': datetime.datetime(2024, 8, 30, 13, 14, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2321370116, 'issue_id': 2497205851, 'author': 'rciszynski', 'body': 'You probably have a postgresql database in version 10. I also had this error, upgrading to version 14 helped.', 'created_at': datetime.datetime(2024, 8, 30, 14, 4, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2321411065, 'issue_id': 2497205851, 'author': 'paoliniluis', 'body': 'Please upgrade your Postgres', 'created_at': datetime.datetime(2024, 8, 30, 14, 18, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2326067576, 'issue_id': 2497205851, 'author': 'ActualAl', 'body': ""Thanks for your replies everyone. We're running PG v11.22 - I'll update to latest and try again"", 'created_at': datetime.datetime(2024, 9, 3, 9, 40, 1, tzinfo=datetime.timezone.utc)}]","qnkhuat on (2024-08-30 13:14:42 UTC): Could you provide info about your database?

rciszynski on (2024-08-30 14:04:26 UTC): You probably have a postgresql database in version 10. I also had this error, upgrading to version 14 helped.

paoliniluis on (2024-08-30 14:18:17 UTC): Please upgrade your Postgres

ActualAl (Issue Creator) on (2024-09-03 09:40:01 UTC): Thanks for your replies everyone. We're running PG v11.22 - I'll update to latest and try again

"
2496731793,issue,closed,completed,add nice summary of failing tests in github,,uladzimirdev,2024-08-30 09:37:43+00:00,['uladzimirdev'],2024-10-08 16:15:48+00:00,2024-08-30 22:28:44+00:00,https://github.com/metabase/metabase/issues/47444,[],[],
2496196518,issue,closed,completed,[Epic] Notification: Simple text,"**Links**
- product doc: https://www.notion.so/metabase/Simple-text-notification-modularize-notification-triggers-migrate-3-transactional-emails-to-new-ar-8adf797c8c9d46139209a4c14d3b5917?pvs=4
- eng doc: https://www.notion.so/metabase/Simple-text-notification-74beda71982e4d2cab62efeb5b7f3734?pvs=4
- feature branch: `notification-simple-text` 

```[tasklist]
### Milestone 1: Infrastructure
- [x] New table: notification + notification_subscription
- [x] New module: notification + system event notification
- [x] New table: notification_handler, notification_recipient
- [x] New table: channel_template
- [x] Update email channel to render system-event notification
- [x] Send notification async
- [x] Event hydration
```

PR: https://github.com/metabase/metabase/pull/47857

```[tasklist]
### Milestone 2: Migrate transactional emails
- [x] You're invited
- [x] Alert created
- [x] Slack token error
```
PR: https://github.com/metabase/metabase/pull/48392

```[tasklist]
### Milestone 3: Misc
- [x] Channel Retry
- [x] TaskHistory tracking
- [x] Serdes + copy (no serdes)
- [x] Auditing (deferred until we have the APIs)
```
PR: https://github.com/metabase/metabase/pull/48437",qnkhuat,2024-08-30 04:20:31+00:00,['qnkhuat'],2024-10-15 10:13:59+00:00,2024-10-15 10:13:59+00:00,https://github.com/metabase/metabase/issues/47438,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Workflows', 'aka BEC')]",[],
2495916779,issue,closed,completed,Embedded dashboards dropping parameters with value null in the JWT,"### Describe the bug

I have a dashboard setup with some locked params, that I provide via the JWT when embedding it.

When decoding the JWT, I get the following:
```json
{
  ""resource"": {
    ""dashboard"": 81
  },
  ""params"": {
    ""datefrom"": ""2024-08-24T14:00:00.000Z"",
    ""dateto"": ""2024-08-30T14:00:00.000Z"",
    ""projectid"": null,
    ""builderid"": ""xxx""
  },
  ""exp"": 1724979681
}
```

Which I then use to embed the dashboard:
```typescript
const iframeUrl =
    METABASE_SITE_URL +
    '/embed/dashboard/' +
    jwtToken +
    '#bordered=false&titled=false'
```

But I get this result from the request:
`You must specify a value for :projectid in the JWT.`

This used to work, even the parameter being `null`, as some queries do not need it.

### To Reproduce

1. Setup a dashboard with some filters/params
2. Setup the embedding with params being locked
3. Prepare the JWT with params, and sign it
4. Use the JWT in the URL for the iframe
5. Check the network request


### Expected behavior

The parameter should be recognised, as it used to do, before recent changes on Metabase.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""starter"",
    ""version"": {
      ""date"": ""2024-08-29"",
      ""tag"": ""v1.50.23"",
      ""hash"": ""7040ff1""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres""
  }
}
```


### Severity

Blocking usage of most dashboards

### Additional context

_No response_",rafavalerio,2024-08-30 01:00:24+00:00,[],2024-09-02 10:52:44+00:00,2024-08-30 06:27:46+00:00,https://github.com/metabase/metabase/issues/47436,"[('.Team/Embedding', '')]","[{'comment_id': 2320173554, 'issue_id': 2495916779, 'author': 'WiNloSt', 'body': ""Hi @rafavalerio, we reverted the behavior of `null` for locked parameters when we fixed #40292.\r\n\r\nWe didn't intend to support `null` value in the past, and supporting `null` was an accident.\r\n\r\nIf you want to not apply the filter to `projectid` aka allowing all possible values to be returned, please use `[]` (an empty array) instead.\r\n\r\nI hope that answers your question. If not, could you elaborate more on what you're trying to achieve here?"", 'created_at': datetime.datetime(2024, 8, 30, 6, 9, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2320206459, 'issue_id': 2495916779, 'author': 'albertoperdomo', 'body': 'Yes, just change your code to pass `[]` and this should work\r\nThis is the [expected behavior](https://www.metabase.com/docs/latest/embedding/static-embedding-parameters#updating-a-locked-parameter).', 'created_at': datetime.datetime(2024, 8, 30, 6, 27, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2320334942, 'issue_id': 2495916779, 'author': 'rafavalerio', 'body': ""@WiNloSt The idea here is that I have queries that may or may not receive a `projectId`.\r\nThat means I can have queries filtering by a specific project, or in case I get `null`, I can use Metabase templating to skip the checks:\r\n\r\n```\r\n...\r\n[[AND project.id = {{ProjectId}}]\r\n...\r\n```\r\n\r\n\r\nI'll give it a try with `[]`!"", 'created_at': datetime.datetime(2024, 8, 30, 7, 28, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2320435956, 'issue_id': 2495916779, 'author': 'albertoperdomo', 'body': 'Yes, empty array is designed for that case.', 'created_at': datetime.datetime(2024, 8, 30, 8, 10, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2324431950, 'issue_id': 2495916779, 'author': 'rafavalerio', 'body': 'Empty array works as expect!\r\n\r\nWould be useful to update this snippet when setting up the embed dashboard! Can be quite misleading, having `null` values in the preview/example\r\n![image](https://github.com/user-attachments/assets/02e1c5e0-afe6-4730-9c71-33bc057cdb05)', 'created_at': datetime.datetime(2024, 9, 2, 10, 52, 43, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2024-08-30 06:09:56 UTC): Hi @rafavalerio, we reverted the behavior of `null` for locked parameters when we fixed #40292.

We didn't intend to support `null` value in the past, and supporting `null` was an accident.

If you want to not apply the filter to `projectid` aka allowing all possible values to be returned, please use `[]` (an empty array) instead.

I hope that answers your question. If not, could you elaborate more on what you're trying to achieve here?

albertoperdomo on (2024-08-30 06:27:47 UTC): Yes, just change your code to pass `[]` and this should work
This is the [expected behavior](https://www.metabase.com/docs/latest/embedding/static-embedding-parameters#updating-a-locked-parameter).

rafavalerio (Issue Creator) on (2024-08-30 07:28:39 UTC): @WiNloSt The idea here is that I have queries that may or may not receive a `projectId`.
That means I can have queries filtering by a specific project, or in case I get `null`, I can use Metabase templating to skip the checks:

```
...
[[AND project.id = {{ProjectId}}]
...
```


I'll give it a try with `[]`!

albertoperdomo on (2024-08-30 08:10:41 UTC): Yes, empty array is designed for that case.

rafavalerio (Issue Creator) on (2024-09-02 10:52:43 UTC): Empty array works as expect!

Would be useful to update this snippet when setting up the embed dashboard! Can be quite misleading, having `null` values in the preview/example
![image](https://github.com/user-attachments/assets/02e1c5e0-afe6-4730-9c71-33bc057cdb05)

"
2495391403,issue,closed,completed,Time Zone Grouping Issues in Metabase with Snowflake's TIMESTAMP_TZ data Type,"### Describe the bug

Grouping by the TIMESTAMP_TZ data type in Snowflake can have unexpected visualizations in Metabase due to time zone handling. 

### To Reproduce

- Metabase: 1.50.22
- Snowflake with the Session timezone of UTC
- This data set: https://gist.github.com/FilmonK/7462904e8f0df25214cc30559cc6383e


 ```
CREATE TABLE user_travel (
    user_id INTEGER,
    travel_start_time_tz TIMESTAMP_TZ,
    travel_end_time_tz TIMESTAMP_TZ,
    travel_start_time TIMESTAMP,
    travel_end_time TIMESTAMP,
    destination VARCHAR,
    travel_mode VARCHAR
);
```

<br>
<br>

In Metabase, set the Localization to ‘Database Default’, which would be Snowflake’s.
 
Using row 60 from the data set in the gist as an example:
TRAVEL_START_TIME_TZ =  '2024-08-16 00:01:00.000 +09:00
TRAVEL_START_TIME = 2024-08-16 00:01:00.000
 
When a GUI question is run, it should take the time zone offset and come into Metabase as August 15, 2024, 3:01 PM.
This part works fine.
 
![Screenshot 2024-08-29 at 2 04 16 PM](https://github.com/user-attachments/assets/962ea936-6f8d-4221-af26-378d56bee9ed)

<br>
<br>

However, when grouping by a specific day of TIMESTAMP_TZ type
![Screenshot 2024-08-29 at 1 45 17 PM](https://github.com/user-attachments/assets/24e393f8-3252-44aa-a6e2-ec5b24c173fd)

<br>

We run into the following: 
![Screenshot 2024-08-29 at 1 37 52 PM](https://github.com/user-attachments/assets/f5ed61fe-7d3c-4c64-b5ba-66c5ddad4266)

 <br>

 Which tends to correlate with another column that doesn't have any timezone offset.
![badgroup](https://github.com/user-attachments/assets/3fe44a87-a82f-4b9f-a1fe-e6845de9f4d3)

<br>
<br>

Adjusting the query to the following:
```
SELECT
TO_DATE(
  DATE_TRUNC(
    'day',
    TO_TIMESTAMP_LTZ(
      ""TRAVEL_DATA"".""USER_TRAVEL"".""TRAVEL_START_TIME_TZ""
    )
  )
) AS ""TRAVEL_START_TIME_TZ"",
COUNT(*) AS ""count""
FROM
""USER_TRAVEL_DB"".""TRAVEL_DATA"".""USER_TRAVEL""
WHERE
(
  TO_TIMESTAMP_LTZ(""TRAVEL_DATA"".""USER_TRAVEL"".""TRAVEL_START_TIME_TZ"") >= '2024-08-15 00:00:00.000 +0000':: timestamp_tz
)
AND (
  TO_TIMESTAMP_LTZ(""TRAVEL_DATA"".""USER_TRAVEL"".""TRAVEL_START_TIME_TZ"") < '2024-08-16 00:00:00.000 +0000':: timestamp_tz
)
GROUP BY
TO_DATE(
  DATE_TRUNC(
    'day',
    TO_TIMESTAMP_LTZ(
      ""TRAVEL_DATA"".""USER_TRAVEL"".""TRAVEL_START_TIME_TZ""
    )
  )
)
ORDER BY
TO_DATE(
  DATE_TRUNC(
    'day',
    TO_TIMESTAMP_LTZ(
      ""TRAVEL_DATA"".""USER_TRAVEL"".""TRAVEL_START_TIME_TZ""
    )
  )
) ASC
 ```
 
Appears to consolidate the items to a single day and matches the quantity for that day once accounting for timestamp + time zone.
 
![Screenshot 2024-08-29 at 1 44 01 PM](https://github.com/user-attachments/assets/83e789aa-854b-49ad-b89b-eb13c8ebd149)

<br>
<br>

In this situation, if Metabase Localization is to anything other than Database Default or UTC, this doesn't appear to happen.


### Expected behavior

For the visualization generated by summarizing a specific field/date to match the values if there was no summarization.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""snowflake"",
      ""mysql"",
      ""h2"",
      ""athena"",
      ""sqlserver"",
      ""bigquery-cloud-sdk""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-08-26"",
      ""tag"": ""v1.50.22"",
      ""hash"": ""16a6c22""
    },
    ""settings"": {
      ""report-timezone"": ""UTC""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.3""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.22+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.22"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.22+7"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""14.5"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Chicago""
  }
}
```


### Severity

P1 - Viz accuracy

### Additional context

_No response_",FilmonK,2024-08-29 19:31:20+00:00,['snoe'],2024-09-17 14:17:25+00:00,2024-09-16 22:03:50+00:00,https://github.com/metabase/metabase/issues/47426,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Database/Snowflake', ''), ('.Backend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/Drivers', '')]","[{'comment_id': 2324804717, 'issue_id': 2495391403, 'author': 'NevRA', 'body': 'Reassigned to the Drivers, context: https://metaboat.slack.com/archives/C0645JP1W81/p1725268103624419\r\n@lbrdnk if you have some details to share, please add them to the description', 'created_at': datetime.datetime(2024, 9, 2, 13, 48, 25, tzinfo=datetime.timezone.utc)}]","NevRA on (2024-09-02 13:48:25 UTC): Reassigned to the Drivers, context: https://metaboat.slack.com/archives/C0645JP1W81/p1725268103624419
@lbrdnk if you have some details to share, please add them to the description

"
2495332854,issue,closed,completed,Interactive embed using JWT SSO authentication doesn't pass all URL parmeters through,"### Describe the bug

I'm trying to embed a Metabase interactive view in our SaaS product using JWT SSO. The authentication works, but URL parameters in the SSO return url are dropped after the first parameter.

![image](https://github.com/user-attachments/assets/addc4b48-ad72-4329-aaac-cc035c691ceb)


### To Reproduce

- Set up interactive embedding scenario with JWT SSO.
- Hide UI elements using URL parameters in the return_url passed to /auth/sso.
- Bug: Only the first URL parameter is kept in the iframe src.

### Expected behavior

The entire return url should be preserved from Metabase's /auth/sso endpoint.

### Logs

_No response_

### Information about your Metabase installation

```JSON
- Chrome v128.0.6613.85
- MacOS Sonoma 14.5
```


### Severity

Low

### Additional context

_No response_",outinspace,2024-08-29 19:03:20+00:00,[],2024-08-30 16:29:06+00:00,2024-08-30 16:29:06+00:00,https://github.com/metabase/metabase/issues/47425,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Embedding/Interactive', 'Interactive Embedding, previously known as Full app embedding'), ('.Team/Embedding', ''), ('.Needs Clarification', 'Issue is incomplete or missing actionable information.')]","[{'comment_id': 2318659570, 'issue_id': 2495332854, 'author': 'paoliniluis', 'body': 'version of metabase?', 'created_at': datetime.datetime(2024, 8, 29, 19, 6, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2319519170, 'issue_id': 2495332854, 'author': 'rafavalerio', 'body': 'Seeing something similar, where I have some params being passed in the JWT, but getting back from Matabase:\r\n`You must specify a value for :projectid in the JWT.`\r\n\r\nI can see the param present in the JWT when I decode it:\r\n<img width=""363"" alt=""image"" src=""https://github.com/user-attachments/assets/99df35b7-87d9-4582-88be-1c63e03e0d74"">', 'created_at': datetime.datetime(2024, 8, 30, 0, 14, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2320315402, 'issue_id': 2495332854, 'author': 'albertoperdomo', 'body': '@rafavalerio [Your issue](https://github.com/metabase/metabase/issues/47436) is related to static embedding, which also relies on a JWT, but unrelated to this issue, which is about interactive embedding and JWT SSO.', 'created_at': datetime.datetime(2024, 8, 30, 7, 20, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2320401525, 'issue_id': 2495332854, 'author': 'albertoperdomo', 'body': ""@outinspace I believe this is the intended product behavior:\r\n* the params are stripped from the URL but\r\n* the logo and side nav will still be hidden if the user navigates around\r\n\r\nIf this is what you are observing and you have a different expectation (preserve the params), I would consider this a request for improvement and it would help to understand why.\r\n\r\nIf this is not what you are observing, e.g. the side_nav or logo appear after the user navigating around, this is a bug and we'll fix it. We would need to know which version of Metabase you are using."", 'created_at': datetime.datetime(2024, 8, 30, 7, 56, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2320495028, 'issue_id': 2495332854, 'author': 'npretto', 'body': '@outinspace I think I reproduced what you\'re running into, is it possible you\'re not encoding the `return_to` query string parameter in the sso endpoint when you redirect the user?\r\nI can see you\'re doing that in the iframe url, but it needs to be done also in the sso endpoint.\r\nFor me the fix was this:\r\n```diff\r\n- MB_BASE_URL + ""/auth/sso"" + ""?jwt="" + jwtToken + ""&return_to="" + url\r\n+ MB_BASE_URL + ""/auth/sso"" + ""?jwt="" + jwtToken + ""&return_to="" + encodeURIComponent(url)\r\n```', 'created_at': datetime.datetime(2024, 8, 30, 8, 35, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2320529146, 'issue_id': 2495332854, 'author': 'albertoperdomo', 'body': ""BTW, I've found that it's best to [point the iframe to the local SSO endpoint in the app and include the return_to param there](https://github.com/metabase/metabase-nodejs-express-interactive-embedding-sample/blob/main/index.js#L135), and then have the [SSO endpoint handle the additional params and the URL encoding](https://github.com/metabase/metabase-nodejs-express-interactive-embedding-sample/blob/main/index.js#L190-L196)."", 'created_at': datetime.datetime(2024, 8, 30, 8, 48, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2321876124, 'issue_id': 2495332854, 'author': 'outinspace', 'body': ""Thanks for the quick feedback guys. I'm using v1.50.22. I think I've figured out the issue. It seems that `encodeURI` strips off URL params after the first one, but `encodeURIComponent` preserves them all."", 'created_at': datetime.datetime(2024, 8, 30, 16, 29, 6, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-08-29 19:06:30 UTC): version of metabase?

rafavalerio on (2024-08-30 00:14:34 UTC): Seeing something similar, where I have some params being passed in the JWT, but getting back from Matabase:
`You must specify a value for :projectid in the JWT.`

I can see the param present in the JWT when I decode it:
<img width=""363"" alt=""image"" src=""https://github.com/user-attachments/assets/99df35b7-87d9-4582-88be-1c63e03e0d74"">

albertoperdomo on (2024-08-30 07:20:16 UTC): @rafavalerio [Your issue](https://github.com/metabase/metabase/issues/47436) is related to static embedding, which also relies on a JWT, but unrelated to this issue, which is about interactive embedding and JWT SSO.

albertoperdomo on (2024-08-30 07:56:30 UTC): @outinspace I believe this is the intended product behavior:
* the params are stripped from the URL but
* the logo and side nav will still be hidden if the user navigates around

If this is what you are observing and you have a different expectation (preserve the params), I would consider this a request for improvement and it would help to understand why.

If this is not what you are observing, e.g. the side_nav or logo appear after the user navigating around, this is a bug and we'll fix it. We would need to know which version of Metabase you are using.

npretto on (2024-08-30 08:35:18 UTC): @outinspace I think I reproduced what you're running into, is it possible you're not encoding the `return_to` query string parameter in the sso endpoint when you redirect the user?
I can see you're doing that in the iframe url, but it needs to be done also in the sso endpoint.
For me the fix was this:
```diff
- MB_BASE_URL + ""/auth/sso"" + ""?jwt="" + jwtToken + ""&return_to="" + url
+ MB_BASE_URL + ""/auth/sso"" + ""?jwt="" + jwtToken + ""&return_to="" + encodeURIComponent(url)
```

albertoperdomo on (2024-08-30 08:48:56 UTC): BTW, I've found that it's best to [point the iframe to the local SSO endpoint in the app and include the return_to param there](https://github.com/metabase/metabase-nodejs-express-interactive-embedding-sample/blob/main/index.js#L135), and then have the [SSO endpoint handle the additional params and the URL encoding](https://github.com/metabase/metabase-nodejs-express-interactive-embedding-sample/blob/main/index.js#L190-L196).

outinspace (Issue Creator) on (2024-08-30 16:29:06 UTC): Thanks for the quick feedback guys. I'm using v1.50.22. I think I've figured out the issue. It seems that `encodeURI` strips off URL params after the first one, but `encodeURIComponent` preserves them all.

"
2495254747,issue,closed,completed,Recents API does not return table selections for non-admins,"
To reproduce:
- login as a non-admin user
- create a notebook question from a table
- create another notebook question
- you will not see that table in recents, but you should

Other entities seem to work correctly for non-admins.

https://www.loom.com/share/3db8f6de3c3d4e3ca919bc169e1a5eb2
",iethree,2024-08-29 18:24:09+00:00,[],2024-10-16 21:24:57+00:00,2024-10-16 20:41:05+00:00,https://github.com/metabase/metabase/issues/47420,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2494524051,issue,closed,completed,Azure MySQL database --require_secure_transport=ON,"### Describe the bug

Hi team.

I'm triyng using Metabase + Azure MySQL Database with require secure transport on and not working, follow my configs:
MB_DB_TYPE=mysql
MB_DB_DBNAME=nome_do_banco
MB_DB_PORT=3306
MB_DB_USER=usuario
MB_DB_PASS='pa$$w0rd'
MB_DB_HOST=mysql.database.azure.com
MB_DB_SSL=true
MB_DB_SSL_CA_CERT=/caminho/para/DigiCertGlobalRootCA.crt.pem

I tried using this URI too: MB_DB_CONNECTION_URI=jdbc:mysql://database.azure.com:3306/metabase?user=metabase&password=passwordc&verifyServerCertificate=true&useSSL=true&requireSSL=true&sslmode=REQUIRED&serverSslCert=/usr/share/metabase/DigiCertGlobalRootCA.crt.pem

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error
Try  use Metabase with Azure database with require secure transport=ON

### Expected behavior

_No response_

### Logs

Caused by: java.sql.SQLTransientConnectionException: Could not connect to address=(host=mysql.database.azure.com)(port=3306)(type=master) : (conn=11864) Connections using insecure transport are prohibited while --require_secure_transport=ON.
 

### Information about your Metabase installation

```JSON
Azure MySQL database with Require_Secure_tranport=ON
 
I can't copy admin > troubleshooting because Metabase does not start :(
```


### Severity

Unable to use Metbase

### Additional context

_No response_",SilvaFernando,2024-08-29 13:53:14+00:00,[],2024-08-29 14:02:29+00:00,2024-08-29 14:02:29+00:00,https://github.com/metabase/metabase/issues/47399,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2317735227, 'issue_id': 2494524051, 'author': 'paoliniluis', 'body': 'You need to use the MB_DB_CONNECTION_URI environment variable, not the other approach. What’s the log that you get when you use the URI?', 'created_at': datetime.datetime(2024, 8, 29, 13, 55, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2317748395, 'issue_id': 2494524051, 'author': 'SilvaFernando', 'body': 'Am I correct in using this ENV? \r\n\r\nMB_DB_CONNECTION_URI=jdbc:mysql://database.azure.com:3306/metabase?user=metabase&password=passwordc&verifyServerCertificate=true&useSSL=true&requireSSL=true&sslmode=REQUIRED&serverSslCert=/usr/share/metabase/DigiCertGlobalRootCA.crt.pem', 'created_at': datetime.datetime(2024, 8, 29, 13, 59, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2317758853, 'issue_id': 2494524051, 'author': 'SilvaFernando', 'body': '@paoliniluis I tried and worked, thanks :)', 'created_at': datetime.datetime(2024, 8, 29, 14, 2, 29, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-08-29 13:55:34 UTC): You need to use the MB_DB_CONNECTION_URI environment variable, not the other approach. What’s the log that you get when you use the URI?

SilvaFernando (Issue Creator) on (2024-08-29 13:59:10 UTC): Am I correct in using this ENV? 

MB_DB_CONNECTION_URI=jdbc:mysql://database.azure.com:3306/metabase?user=metabase&password=passwordc&verifyServerCertificate=true&useSSL=true&requireSSL=true&sslmode=REQUIRED&serverSslCert=/usr/share/metabase/DigiCertGlobalRootCA.crt.pem

SilvaFernando (Issue Creator) on (2024-08-29 14:02:29 UTC): @paoliniluis I tried and worked, thanks :)

"
2494500154,issue,closed,completed,change liquibase log level to INFO from ERROR,"with default config `<Logger name=""liquibase"" level=""ERROR""/>`


upgrading 49 -> 50
```
2024-08-29 08:37:03,836 INFO db.liquibase :: Checking if Database has unrun migrations...
2024-08-29 08:37:04,045 INFO db.liquibase :: Database has unrun migrations. Checking if migration lock is taken...
2024-08-29 08:37:04,047 INFO db.liquibase :: No migration lock found.
2024-08-29 08:37:04,047 INFO db.liquibase :: Migration lock acquired.
2024-08-29 08:37:04,167 INFO db.liquibase :: Running 83 migrations ...
```

with INFO: `<Logger name=""liquibase"" level=""INFO""/>

```
2024-08-29 08:39:45,019 INFO db.liquibase :: Running 83 migrations ...
...
2024-08-29 08:39:45,166 INFO liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:00::calherries ran successfully in 0ms
2024-08-29 08:39:45,182 INFO liquibase.changelog :: Columns is_defective_duplicate(boolean) added to metabase_field
2024-08-29 08:39:45,182 INFO liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:01::calherries ran successfully in 14ms
2024-08-29 08:39:45,199 INFO liquibase.changelog :: Custom SQL executed
2024-08-29 08:39:45,200 INFO liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:02::calherries ran successfully in 16ms
2024-08-29 08:39:45,202 INFO liquibase.changelog :: Foreign key fk_field_parent_ref_field_id dropped
2024-08-29 08:39:45,202 INFO liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:03::calherries ran successfully in 1ms
2024-08-29 08:39:45,204 INFO liquibase.changelog :: Foreign key constraint added to metabase_field (parent_id)
2024-08-29 08:39:45,205 INFO liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:04::calherries ran successfully in 2ms
...
```",dpsutton,2024-08-29 13:44:37+00:00,[],2024-08-29 17:01:16+00:00,2024-08-29 15:20:21+00:00,https://github.com/metabase/metabase/issues/47396,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2494416440,issue,closed,completed,cache config migration breaks on numbers larger than 10^9,"### Describe the bug

migration fails on numbers like `100000000000`

### To Reproduce

set query-caching-ttl-ratio	100000000000

### Expected behavior

migrate to 50

### Logs

_No response_

### Information about your Metabase installation

```JSON
50
```


### Severity

p1

### Additional context

_No response_",dpsutton,2024-08-29 13:16:15+00:00,[],2024-08-29 16:16:37+00:00,2024-08-29 15:09:26+00:00,https://github.com/metabase/metabase/issues/47394,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Team/Workflows', 'aka BEC')]",[],
2494405551,issue,closed,completed,Slack notification mixes metrics,"### Describe the bug

We upgraded from v0.49.13 to v0.50.22 and now one of our periodic Slack dashboard notifications is showing wrong metrics:

Before:
![image](https://github.com/user-attachments/assets/b90e3fa4-9e14-4097-a82a-d01974626ee6)

After:
![image](https://github.com/user-attachments/assets/a1bae4c4-f428-4aee-8f09-10f42fe58882)

Now, some numeric questions have the value, and link to, the first question in the dashboard


### To Reproduce

1. Create a dashboard with multiple numeric questions
2. Send a Slack notification
3. Most metrics point to the first one


### Expected behavior

Each metric should be independent

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""pt"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-26"",
      ""tag"": ""v0.50.22"",
      ""hash"": ""16a6c22""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.1""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.220-209.869.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

Misleading metrics for our business team

### Additional context

_No response_",danilofuchs,2024-08-29 13:12:13+00:00,"['alxnddr', 'adam-james-v']",2024-09-03 15:31:09+00:00,2024-09-03 15:31:08+00:00,https://github.com/metabase/metabase/issues/47392,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Reporting/Pulses', 'Now called Subscriptions'), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2317666420, 'issue_id': 2494405551, 'author': 'danilofuchs', 'body': 'Update:\r\nI sent another Slack notification manually, and one metric which was wrong is now correct. This seems like a caching issue', 'created_at': datetime.datetime(2024, 8, 29, 13, 30, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2322188549, 'issue_id': 2494405551, 'author': 'luizarakaki', 'body': '> I sent another Slack notification manually, and one metric which was wrong is now correct. This seems like a caching issue\r\n\r\nOnly one? The others are still repeating the first question?', 'created_at': datetime.datetime(2024, 8, 30, 19, 16, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2326825622, 'issue_id': 2494405551, 'author': 'danilofuchs', 'body': '> > I sent another Slack notification manually, and one metric which was wrong is now correct. This seems like a caching issue\r\n> \r\n> Only one? The others are still repeating the first question?\r\n\r\nCorrect, this was the behavior\r\n\r\nWe upgraded to 0.50.23.1 and the issue seems fixed, I will reopen if it happens again', 'created_at': datetime.datetime(2024, 9, 3, 15, 31, 8, tzinfo=datetime.timezone.utc)}]","danilofuchs (Issue Creator) on (2024-08-29 13:30:32 UTC): Update:
I sent another Slack notification manually, and one metric which was wrong is now correct. This seems like a caching issue

luizarakaki on (2024-08-30 19:16:51 UTC): Only one? The others are still repeating the first question?

danilofuchs (Issue Creator) on (2024-09-03 15:31:08 UTC): Correct, this was the behavior

We upgraded to 0.50.23.1 and the issue seems fixed, I will reopen if it happens again

"
2493978660,issue,closed,completed,The latitude and longitude columns whose data types are decimal in StarRocks cannot autobin when aggregated,"### Describe the bug

All of latitude and longitude columns whose data types are decimal in StarRocks cannot autobin when aggregated, even though I specify the specific data type Latitude or Longitute in metabase backgroud.
![image](https://github.com/user-attachments/assets/e268f610-4c22-48ba-a46c-61422c35a8e3)
![image](https://github.com/user-attachments/assets/f622bee2-4e83-448f-96f6-69f6c38a7307)

I feel like that's because the fingerprint field in metabase_field table is null. Is the mechanism of fetching fingerprint values related to the database_type field in metabase_field table or to something else?
![image](https://github.com/user-attachments/assets/cb4fd434-2b52-4168-b4c2-a2006a479ce2)

### To Reproduce

-

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
- Browser: Chrome 128
- OS: CentOS 7
- Databases: MySQL, StarRocks
- Metabase version: v0.50.22
- Metabase hosting environment: Docker
- Metabase internal database: PostgreSQL
```


### Severity

Medium

### Additional context

_No response_",Jerrylovescoding,2024-08-29 09:52:25+00:00,[],2024-08-29 19:02:57+00:00,2024-08-29 19:02:57+00:00,https://github.com/metabase/metabase/issues/47387,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2318651803, 'issue_id': 2493978660, 'author': 'alxnddr', 'body': 'Hi @Jerrylovescoding 👋 We do not provide an official StarRocks driver so it seems you are using their third-party driver. Since this functionality works with the official drivers, I assume the problem is in the StarRocks driver implementation. It is better to reach out to the team that developed the StarRocks driver about this problem', 'created_at': datetime.datetime(2024, 8, 29, 19, 2, 57, tzinfo=datetime.timezone.utc)}]","alxnddr on (2024-08-29 19:02:57 UTC): Hi @Jerrylovescoding 👋 We do not provide an official StarRocks driver so it seems you are using their third-party driver. Since this functionality works with the official drivers, I assume the problem is in the StarRocks driver implementation. It is better to reach out to the team that developed the StarRocks driver about this problem

"
2493595533,issue,open,,Add recents to metrics page with standard viz,,romeovs,2024-08-29 06:50:31+00:00,[],2024-08-29 06:50:31+00:00,,https://github.com/metabase/metabase/issues/47383,[],[],
2493321206,issue,open,,Metabase field-sync error: presto connection in metabase 0.50.22 & 0.50.21,"**Describe the bug**
A clear and concise description of what the bug is.
![image](https://github.com/user-attachments/assets/13dcf41d-bd89-404f-bd0f-6be905ac47ce)
![image](https://github.com/user-attachments/assets/0c359758-5b16-4676-b39b-9751af8525b3)

**Logs**
Please include javascript console and server logs around the time this bug occurred. For information about how to get these, consult our [bug troubleshooting guide](https://metabase.com/docs/latest/troubleshooting-guide/bugs.html)

**To Reproduce**
Steps to reproduce the behavior:
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

**Expected behavior**
A clear and concise description of what you expected to happen.

**Screenshots**
If applicable, add screenshots to help explain your problem.

**Severity**
How severe an issue is this bug to you? Is this annoying, blocking some users, blocking an upgrade or blocking your usage of Metabase entirely?
Note: the more honest and specific you are here the more we will take you seriously.

**Additional context**
Add any other context about the problem here.

**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""presto-jdbc""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-26"",
      ""tag"": ""v0.50.22"",
      ""hash"": ""16a6c22""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Bangkok""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.39-0ubuntu0.22.04.1""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8-post-Ubuntu-1ubuntu322.04"",
    ""java.vendor"": ""Ubuntu"",
    ""java.vendor.url"": ""https://ubuntu.com/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8-post-Ubuntu-1ubuntu322.04"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-119-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```",huelee2020,2024-08-29 02:32:12+00:00,[],2025-01-06 22:53:27+00:00,,https://github.com/metabase/metabase/issues/47380,[],[],
2493118308,issue,open,,Cloud migration read-only mode prevents middleware.update-used-cards,"### Describe the bug

We put the app-db in readonly mode when doing a cloud migration. But there are some exceptions to this: we want to register usages, record field values, but we don't want to create new records in the core tables. To allow for this we have some exceptions to read-only mode: https://github.com/metabase/metabase/blob/master/src/metabase/models/cloud_migration.clj#L89-L99

We should make the middleware.update-used-cards not throw exceptions

```
2024-08-28 12:41:21,673 ERROR middleware.update-used-cards :: Error updating used cards
clojure.lang.ExceptionInfo: Metabase is in read-only-mode mode! {:status-code 403, :toucan2/context-trace [[""resolve connection"" {:toucan2.connection/connectable metabase.db.connection.ApplicationDB}] [""resolve connection"" {:toucan2.connection/connectable :default}] [""resolve connection"" {:toucan2.connection/connectable nil}] [""with resolved query"" {:toucan2.pipeline/resolved-query {}}] [""with parsed args"" {:toucan2.pipeline/query-type :toucan.query-type/update.update-count, 
```

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

not entirely sure.

Start a cloud migration and then trigger the update-used-cards middleware



### Logs

_No response_

### Information about your Metabase installation

```JSON
v50
```


### Severity

p2

### Additional context

_No response_",dpsutton,2024-08-28 23:00:27+00:00,[],2025-02-04 20:26:30+00:00,,https://github.com/metabase/metabase/issues/47376,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Operation/Database Migrations', 'Issues with application DB migrations when launching Metabase'), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2493099500,issue,open,,Deduplicate Results from the Question Builder,"**Is your feature request related to a problem? Please describe.**
It's not uncommon to have to use joins that will cause rows to be duplicated in the result set. In the GUI query builder there is no simple way to deduplicate results.

**Describe the solution you'd like**
Some method, in the GUI query builder, of removing duplicate records from the result set

**Describe alternatives you've considered**
- Native SQL
- Building multiple GUI questions that reduce the results then joining them back together

**Additional context**
You can usually work around this by create multiple questions and joining them back together in such a way that you prevent record duplication. This is cumbersome, time consuming, opens up a lot of room for error if intermediate questions are modified and clutters up the instance with Question that are built for specific niche use cases.
",ixipixi,2024-08-28 22:38:42+00:00,[],2025-02-04 20:31:06+00:00,,https://github.com/metabase/metabase/issues/47375,"[('Type:New Feature', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode')]",[],
2493071136,issue,closed,completed,"Currency Symbol for ""Swedish Krona"" is ""Skr"" rather than ""kr""","### Describe the bug

Customer wants to use the ""Unit of Currency"" settings but they have avoided doing so because the symbol for the Swedish Krona doesn't match the local convention of ""kr"".

### To Reproduce

1. Create a question from the orders table
2. Set a numeric field to currency type of ""Swedish Krona""
3. note that the symbol option is ""Skr"" and it's verified to the left of the field, like ""Skr 4.5""


### Expected behavior

The unit of currency should match local convention, like ""4.5 kr""

### Logs

_No response_

### Information about your Metabase installation

```JSON
v50
```


### Severity

blocking some users

### Additional context

Swedish customer wants to use the ""Unit of Currency"" settings but they have avoided doing so because the symbol for the Swedish Krona doesn't align with local convention.

Custom suffixes aren't a good workaround because of these issues:

- https://github.com/metabase/metabase/issues/42867
- https://github.com/metabase/metabase/issues/47373",ixipixi,2024-08-28 22:11:07+00:00,[],2025-02-03 21:13:39+00:00,2025-02-03 15:50:28+00:00,https://github.com/metabase/metabase/issues/47374,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2343878433, 'issue_id': 2493071136, 'author': 'paoliniluis', 'body': '@ixipixi check https://github.com/metabase/metabase/blob/d908592d02f1fc0d34530253f2a0f06abbf367f0/src/metabase/shared/util/currency.cljc#L729', 'created_at': datetime.datetime(2024, 9, 11, 14, 41, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2345780030, 'issue_id': 2493071136, 'author': 'andreasenberg', 'body': '@paoliniluis I\'m not sure I understand the point you\'re trying to make here or how that `symbol_native` is being used but it is not available as an option in the UI trying to configure metadata for a certain field.\r\n<img width=""319"" alt=""image"" src=""https://github.com/user-attachments/assets/e70c0801-9060-4bd4-8950-3b77cf4a9ed1"">\r\n\r\nIf you can shed some light on how `symbol_native` is used and if there is some configuration we can do to have it render that instead of the symbol ""Skr"" that would be appreciated. \r\nAs a Swede I\'m not sure in what situations ""Skr"" would be used over ""kr"" to be honest. Personally I\'ve never seen ""Skr"" used as a symbol for the Swedish Krona. I understand that there might be a case in which you want to distinguish it from its danish counterpart for example but I believe that should be handled in a different way.', 'created_at': datetime.datetime(2024, 9, 12, 9, 44, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2345955760, 'issue_id': 2493071136, 'author': 'paoliniluis', 'body': '@andreasenberg if that’s the case open a PR changing the file i mentioned above', 'created_at': datetime.datetime(2024, 9, 12, 10, 48, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2632089645, 'issue_id': 2493071136, 'author': 'github-actions[bot]', 'body': '🚀 This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)', 'created_at': datetime.datetime(2025, 2, 3, 21, 13, 38, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-11 14:41:51 UTC): @ixipixi check https://github.com/metabase/metabase/blob/d908592d02f1fc0d34530253f2a0f06abbf367f0/src/metabase/shared/util/currency.cljc#L729

andreasenberg on (2024-09-12 09:44:37 UTC): @paoliniluis I'm not sure I understand the point you're trying to make here or how that `symbol_native` is being used but it is not available as an option in the UI trying to configure metadata for a certain field.
<img width=""319"" alt=""image"" src=""https://github.com/user-attachments/assets/e70c0801-9060-4bd4-8950-3b77cf4a9ed1"">

If you can shed some light on how `symbol_native` is used and if there is some configuration we can do to have it render that instead of the symbol ""Skr"" that would be appreciated. 
As a Swede I'm not sure in what situations ""Skr"" would be used over ""kr"" to be honest. Personally I've never seen ""Skr"" used as a symbol for the Swedish Krona. I understand that there might be a case in which you want to distinguish it from its danish counterpart for example but I believe that should be handled in a different way.

paoliniluis on (2024-09-12 10:48:54 UTC): @andreasenberg if that’s the case open a PR changing the file i mentioned above

github-actions[bot] on (2025-02-03 21:13:38 UTC): 🚀 This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)

"
2493061554,issue,closed,completed,"Suffix is Added to ""Rate of Change"" in Tooltip","### Describe the bug

If you add a custom suffix to a series in a chart that generates a period over period change rate in the tooltip - the suffix is added to the rate of change. 

![suffix_rate](https://github.com/user-attachments/assets/3058bca9-39d0-40c7-b975-f6fb215ceb29)


### To Reproduce

1. Set up v50
2. Create question from the Orders table that sum of discount grouped by month
3. Add a custom suffix like ""kr"" or ""dollars""
4. View the line chart and mouse over the data point and see that it will say something like ""+18.3% dollars""

### Expected behavior

Either remove prefix and suffixes from the rate of change in the tooltip or split it out into it's own setting

### Logs

_No response_

### Information about your Metabase installation

```JSON
v50
```


### Severity

Annoying

### Additional context

_No response_",ixipixi,2024-08-28 22:02:37+00:00,['alxnddr'],2024-08-30 03:22:45+00:00,2024-08-30 03:22:45+00:00,https://github.com/metabase/metabase/issues/47373,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2316359021, 'issue_id': 2493061554, 'author': 'cdeweyx', 'body': 'Should tackle https://github.com/metabase/metabase/issues/42867 at the same time if we can', 'created_at': datetime.datetime(2024, 8, 28, 22, 36, 27, tzinfo=datetime.timezone.utc)}]","cdeweyx on (2024-08-28 22:36:27 UTC): Should tackle https://github.com/metabase/metabase/issues/42867 at the same time if we can

"
2492608335,issue,closed,completed,Track how often entity IDs are being used for analytics purposes,,escherize,2024-08-28 17:08:08+00:00,[],2024-10-01 22:20:27+00:00,2024-09-04 22:48:20+00:00,https://github.com/metabase/metabase/issues/47360,[],[],
2492503709,issue,open,,`TIMESTAMP_NTZ` columns are not syncable with Databricks JDBC,"I've discovered the issue while working with `attempted-murders` test dataset. Ideally its dt column should be mapped to Databricks' `TIMESTAMP_NTZ` type. Doing so and creating the dataset revealed there are no `TIMESTAMP_NTZ` columns synced. `TIMESTAMP` columns are synced correctly however.

I assume there is some discrepacny in underlying Databricks JDBC driver.

The `TIMESTAMP_NTZ` column could be selected. Using `.getColumns` on `DatabaseMetaData` does not return it however.

To reproduce:

Create table containing `TIMESTAMP_NTZ` column via Databricks ui.
```
use <your catalog>;
create schema xix;
use schema xix;
create table yiy (ntz timestamp_ntz);
insert into yiy (ntz) values (to_timestamp('2016-12-31 00:12:00'));
select * from yiy;
```

Following is the (transformed) Metabase code that gets columns for a table during sync. Original can be found in `metabase.driver.sql-jdbc.sync.describe-table/jdbc-fields-metadata`. It ~~returns~~ prints nothing.
```
(with-open [conn (clojure.java.jdbc/get-connection
                    (sql-jdbc.conn/connection-details->spec
                     :databricks-jdbc
                     (assoc (metabase.test.data.interface/dbdef->connection-details :databricks-jdbc :server nil)
                            :schema ""xix"")))
              rs (.getColumns (.getMetaData conn)
                                nil
                                ""xix""
                                ""yiy""
                                nil)]
    (let [col-count (.getColumnCount (.getMetaData rs))]
      (while (.next rs)
        (loop [i 1
               r []]
          (if (= i col-count)
            (println r)
            (recur (inc i) 
                   (conj r (.getObject rs (inc i) String))))))))
```",lbrdnk,2024-08-28 16:08:44+00:00,[],2025-02-04 20:27:55+00:00,,https://github.com/metabase/metabase/issues/47359,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2318561839, 'issue_id': 2492503709, 'author': 'camsaul', 'body': 'For whoever ends up working on this I left some notes in https://metaboat.slack.com/archives/C0645JP1W81/p1724954787377439?thread_ts=1724954478.743029&cid=C0645JP1W81', 'created_at': datetime.datetime(2024, 8, 29, 18, 20, 53, tzinfo=datetime.timezone.utc)}]","camsaul on (2024-08-29 18:20:53 UTC): For whoever ends up working on this I left some notes in https://metaboat.slack.com/archives/C0645JP1W81/p1724954787377439?thread_ts=1724954478.743029&cid=C0645JP1W81

"
2492087596,issue,closed,completed,Trend Lines are incorrect when a multiplier is in use,"### Describe the bug

Trend lines are incorrectly displayed when the Y-axis multiplier is in use.

### To Reproduce

1. Create a question: Sample database, Sum of Total, by Created At: Month
2. In Data / Y-axis: set multiplier to 0.001
![image](https://github.com/user-attachments/assets/529ebc10-c53a-4fd6-8d77-4b1de899c224)
3. In  options, enable trend line
![image](https://github.com/user-attachments/assets/2b023778-a679-4aed-9dc8-51ca28cfcd30)
4.(!) See the error that the trend line does not honor the multiplier
![image](https://github.com/user-attachments/assets/3a7b72a0-8359-41d9-92da-5a9a9ff12ede)



### Expected behavior

It should work as before.

### Logs

_No response_

### Information about your Metabase installation

```JSON
1.50.22
```


### Severity

P1 - regression / correctness, reported by a customer.

### Additional context

Working fine in `1.49.x`.",zbodi74,2024-08-28 13:30:03+00:00,['alxnddr'],2024-08-30 16:13:48+00:00,2024-08-30 14:50:46+00:00,https://github.com/metabase/metabase/issues/47351,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Correctness', ''), ('.Frontend', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2491987520,issue,closed,completed,Allow filtering types of entities in the entity picker of CreateQuestion component in the sdk,"Expose a prop that allows filtering types of entities (e.g. tables, models) in the entity picker of the CreateQuestion component in the SDK. This would be similar to the `visibleEntityTypes` prop we already have in the CollectionBrowser. Currently we can only search for `tables` in CreateQuestion.",heypoom,2024-08-28 12:48:12+00:00,['oisincoveney'],2024-09-23 12:52:19+00:00,2024-09-03 15:22:21+00:00,https://github.com/metabase/metabase/issues/47347,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2326804550, 'issue_id': 2491987520, 'author': 'heypoom', 'body': 'Duplicate of https://github.com/metabase/metabase/issues/47537', 'created_at': datetime.datetime(2024, 9, 3, 15, 22, 21, tzinfo=datetime.timezone.utc)}]","heypoom (Issue Creator) on (2024-09-03 15:22:21 UTC): Duplicate of https://github.com/metabase/metabase/issues/47537

"
2491980325,issue,closed,completed,Improve appearance of the save question modal for sdk's CreateQuestion component,"- We should make the save question modal a full-screen modal, similar to the current behaviour of the entity picker modal. The reason is that the current save question modal is dependent on the content's height, and looks jarring against a white background because of the modal backdrop. See the screenshots below.
- We should update the modal to follow the `background` theme colors. The white background does not work well in dark themes. [Private Loom.](https://www.loom.com/share/0db0a79b98de4902b6aa768156589284?sid=707e95e9-2bb5-4921-aded-ebc4be932eb7)

![Image](https://github.com/user-attachments/assets/74bcfed1-aeb3-4131-b410-7d54efd5479f)

![Image](https://github.com/user-attachments/assets/88425b1d-9b06-4e56-83a7-4eeac2432845)

",heypoom,2024-08-28 12:44:52+00:00,[],2024-10-08 16:15:16+00:00,2024-09-06 20:16:49+00:00,https://github.com/metabase/metabase/issues/47346,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2491775145,issue,closed,completed,Remove default borders from entity picker's button in the sdk's CreateQuestion component,"The entity picker in create question are dependent on CSS resets being available - the default button style with gray borders are appearing. If we add `appearance: none` and `border: none` to the button, it should get rid of the browser-default grey border.

This happens when you use `<CreateQuestion />` SDK component in a React application that does not have CSS resets for buttons.

![Image](https://github.com/user-attachments/assets/ae93971f-b938-412f-8f84-79192f9a568f)

",heypoom,2024-08-28 11:06:35+00:00,['npretto'],2024-10-08 16:14:03+00:00,2024-10-01 07:46:35+00:00,https://github.com/metabase/metabase/issues/47344,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2334539367, 'issue_id': 2491775145, 'author': 'npretto', 'body': ""I may be able to fix this too while working on https://github.com/metabase/metabase/issues/47624 so I'll temporarily assign it to myself so that people don't start working on this\r\n\r\nedit: the pr that may fix it https://github.com/metabase/metabase/pull/47764"", 'created_at': datetime.datetime(2024, 9, 6, 17, 41, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2379635205, 'issue_id': 2491775145, 'author': 'npretto', 'body': 'This particular issue seems to be fixed, ~but the modal is rendered outside of the portal so it has other styling issues~\r\n\r\nI\'m not sure what i\'m seeing anymore, some things are using the Arial font for some reason, and the css reset I made in the leak pr is more specific than some background-colors we put so this is happening:\r\n<img width=""1222"" alt=""image"" src=""https://github.com/user-attachments/assets/4fbff2c5-55cc-4b85-8a11-eeb188654c1d"">', 'created_at': datetime.datetime(2024, 9, 27, 16, 15, 53, tzinfo=datetime.timezone.utc)}]","npretto (Assginee) on (2024-09-06 17:41:51 UTC): I may be able to fix this too while working on https://github.com/metabase/metabase/issues/47624 so I'll temporarily assign it to myself so that people don't start working on this

edit: the pr that may fix it https://github.com/metabase/metabase/pull/47764

npretto (Assginee) on (2024-09-27 16:15:53 UTC): This particular issue seems to be fixed, ~but the modal is rendered outside of the portal so it has other styling issues~

I'm not sure what i'm seeing anymore, some things are using the Arial font for some reason, and the css reset I made in the leak pr is more specific than some background-colors we put so this is happening:
<img width=""1222"" alt=""image"" src=""https://github.com/user-attachments/assets/4fbff2c5-55cc-4b85-8a11-eeb188654c1d"">

"
2491751672,issue,closed,completed,Add the create question component to the generated components in the embedding CLI,We should add the `<CreateQuestion />` component to the generated React components in the embedding CLI,heypoom,2024-08-28 10:55:51+00:00,['heypoom'],2024-10-08 16:15:11+00:00,2024-09-09 09:48:25+00:00,https://github.com/metabase/metabase/issues/47343,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2491665308,issue,closed,completed,Metabase Users Changing to Default Permissions,"### Describe the bug

We have certain users, when they log in their MB permissions are changed to default.

This creates issues viewing certain MB queries and tables. As a result the MB admin team have had to set up certain users permissions from default back to their required role multiple times. This has been occurring across multiple MB instances / environments. 

We thought there may be an issue with LDAP that would be causing this, so we removed the users from the lists and it hasn't helped.

### To Reproduce

This is happening for certain users only, at least once a week across multiple MB instances.

1. Login to MB using username and password.
2. Unable to access query
3. MB Admin team change permissions to default
4. User can then view query
5. I believe the next time the user logs in on a new session it then causes an issue


### Expected behavior

The queries should be visible

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""sqlserver"",
      ""athena"",
      ""redshift""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-21"",
      ""tag"": ""v0.50.21"",
      ""hash"": ""ec9f5d7""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/London""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.10""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.5.0-1024-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

Medium

### Additional context

_No response_",vmoores-ds,2024-08-28 10:15:47+00:00,[],2024-08-29 10:09:17+00:00,2024-08-29 10:09:17+00:00,https://github.com/metabase/metabase/issues/47342,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Administration/Auth', 'Google Auth, LDAP, pw+email login'), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2314993761, 'issue_id': 2491665308, 'author': 'noahmoss', 'body': 'Hi @vmoores-ds, thanks for the report. Could you clarify what you mean by ""permissions are change to default""? Are the permissions in `/admin/permissions` being changed for specific groups or databases? Or are users being removed from the groups that they\'re expected to be in?\r\n\r\nIf you\'re using LDAP with group sync, this does sound like an issue there. What do you mean by ""we removed the users from the lists""?', 'created_at': datetime.datetime(2024, 8, 28, 10, 57, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2315496112, 'issue_id': 2491665308, 'author': 'vmoores-ds', 'body': ""hey, thanks for getting back to me so quickly.\r\n\r\nYes so to clarify, they had an existing group set up called 'Customer Success' assigned to them. When they log in on the next session, that group is dropped, so when I go to check on their user in Admin > People, the user will have 'Default' as the group next to their name. I will reassign 'Customer Success', which works until the next login session. I just tested this again with the user affected \r\n![2 Metabase User Default Group 2024-08-28 145802](https://github.com/user-attachments/assets/3cbee83d-2c30-4aae-aaeb-9c1434be212b)\r\n\r\nI don't think it's an issue with the MB with group itself as there are only a couple of users which have 'Customer Success' as their group who have this issue. There's a number of others who have never experienced this.\r\n\r\nFor the LDAP group sync, the users which were affected by this issue have been removed from LDAP. We wanted to confirm it was not related to LDAP before reaching out."", 'created_at': datetime.datetime(2024, 8, 28, 14, 28, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2315628862, 'issue_id': 2491665308, 'author': 'noahmoss', 'body': '@vmoores-ds Is there a \'Customer Success\' group in LDAP, and was this mapped properly to the corresponding Metabase group in the LDAP settings?\r\n\r\nThis definitely sounds like a LDAP group sync issue. Group sync runs only when a user logs in, and it updates the user\'s groups to match the groups returned from the LDAP server according to the predefined mappings. If something is configured slightly wrong it can lead to users being removed from groups unexpectedly. (Or there may be a bug, but I don\'t know where yet.)\r\n\r\nWhat do you mean exactly by ""the users have been removed from LDAP""?', 'created_at': datetime.datetime(2024, 8, 28, 15, 7, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2317207528, 'issue_id': 2491665308, 'author': 'vmoores-ds', 'body': 'we can close this ticket. There was an issue with the active directory and therefore the LDAP list which was causing this. We removed and readded the user and this is now resolved. Thank you for your help!', 'created_at': datetime.datetime(2024, 8, 29, 9, 58, 18, tzinfo=datetime.timezone.utc)}]","noahmoss on (2024-08-28 10:57:40 UTC): Hi @vmoores-ds, thanks for the report. Could you clarify what you mean by ""permissions are change to default""? Are the permissions in `/admin/permissions` being changed for specific groups or databases? Or are users being removed from the groups that they're expected to be in?

If you're using LDAP with group sync, this does sound like an issue there. What do you mean by ""we removed the users from the lists""?

vmoores-ds (Issue Creator) on (2024-08-28 14:28:41 UTC): hey, thanks for getting back to me so quickly.

Yes so to clarify, they had an existing group set up called 'Customer Success' assigned to them. When they log in on the next session, that group is dropped, so when I go to check on their user in Admin > People, the user will have 'Default' as the group next to their name. I will reassign 'Customer Success', which works until the next login session. I just tested this again with the user affected 
![2 Metabase User Default Group 2024-08-28 145802](https://github.com/user-attachments/assets/3cbee83d-2c30-4aae-aaeb-9c1434be212b)

I don't think it's an issue with the MB with group itself as there are only a couple of users which have 'Customer Success' as their group who have this issue. There's a number of others who have never experienced this.

For the LDAP group sync, the users which were affected by this issue have been removed from LDAP. We wanted to confirm it was not related to LDAP before reaching out.

noahmoss on (2024-08-28 15:07:35 UTC): @vmoores-ds Is there a 'Customer Success' group in LDAP, and was this mapped properly to the corresponding Metabase group in the LDAP settings?

This definitely sounds like a LDAP group sync issue. Group sync runs only when a user logs in, and it updates the user's groups to match the groups returned from the LDAP server according to the predefined mappings. If something is configured slightly wrong it can lead to users being removed from groups unexpectedly. (Or there may be a bug, but I don't know where yet.)

What do you mean exactly by ""the users have been removed from LDAP""?

vmoores-ds (Issue Creator) on (2024-08-29 09:58:18 UTC): we can close this ticket. There was an issue with the active directory and therefore the LDAP list which was causing this. We removed and readded the user and this is now resolved. Thank you for your help!

"
2491580102,issue,closed,completed,The custom datetime columns are automatically truncated by day when aggregated,"### Describe the bug

The custom datetime columns in MySQL and StarRocks are automatically truncated by day when aggregated whether using functions convertTimezone() or datetimeAdd().

![image](https://github.com/user-attachments/assets/7fb09ab7-30b7-47ea-a682-8f1b2bb82a77)

P.S.
The data types of columns are datetime in db and displayed on metabase like this:
![image](https://github.com/user-attachments/assets/f4c05680-1aa8-4cbc-b999-4314d31f814a)

### To Reproduce

-

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
* Browser: Chrome 128
* OS: CentOS 7
* Databases: MySQL, StarRocks
* Metabase version: v0.50.22
* Metabase hosting environment: Docker
* Metabase internal database: PostgreSQL
```


### Severity

Medium

### Additional context

_No response_",Jerrylovescoding,2024-08-28 09:37:41+00:00,['bshepherdson'],2024-10-01 22:14:55+00:00,2024-09-27 17:38:07+00:00,https://github.com/metabase/metabase/issues/47341,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Correctness', ''), ('.Backend', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('Querying/Notebook/Custom Column', ''), ('.Escalation', ''), ('.Team/Querying', '')]","[{'comment_id': 2317545043, 'issue_id': 2491580102, 'author': 'zbodi74', 'body': 'Replicated, and also happens on PostgreSQL. \r\nRaising priority as this is a regression in a common function.', 'created_at': datetime.datetime(2024, 8, 29, 12, 42, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2318160097, 'issue_id': 2491580102, 'author': 'bshepherdson', 'body': 'Some data points across versions for reference:\r\n\r\n| Version | Breakout on Field | Breakout on custom column |\r\n| :-- | :-- | :-- |\r\n| 0.49.20 | Explicitly bucketed, defaults to `day` | No bucketing visible; unbucketed output |\r\n| master | Explicitly bucketed, defaults to `month` | No bucketing visible; appears to silently bucket by `day` |\r\n\r\nIn both cases the breakout on the custom column is spelled `[:expression ""NY Date"" {:base-type :type/DateTime}]` and doesn\'t specify a `:unit`.\r\n\r\nI\'m debugging further to find out where the unit is coming from.', 'created_at': datetime.datetime(2024, 8, 29, 15, 32, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2334594575, 'issue_id': 2491580102, 'author': 'zbodi74', 'body': 'Reopening as it works properly when binning is specified, but there is still a `date` cast when the column is not binned. I checked this in `1.50.24.2`.\r\n\r\n<img width=""1112"" alt=""image"" src=""https://github.com/user-attachments/assets/5a6a6efc-72f3-4c41-b6c8-5222cb9452c1"">', 'created_at': datetime.datetime(2024, 9, 6, 18, 20, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338718250, 'issue_id': 2491580102, 'author': 'bshepherdson', 'body': 'This was an intended change, making breakouts on expressions work like breakouts on fields.\r\n\r\n## Background\r\n\r\nIn 0.49.20, breakouts directly on fields defaulted to bucketing by day. Even if you selected `Don\'t bin` it would still be forced to `:day` by the [`auto-bucket-datetimes` middleware](https://github.com/metabase/metabase/blob/release-x.49.x/src/metabase/query_processor/middleware/auto_bucket_datetimes.clj). If you didn\'t want to bucket it, you could create a basic expression instead, since those didn\'t support bucketing in 49.\r\n\r\nBucketing for `:type/Date` and `:type/DateTime` expressions was added to the BE by #45492 and FE by #47427. So as I say, this is an intentional change.\r\n\r\n## Intended?\r\n\r\nIn practice, there\'s no way to force bucketing off for a `Date(time)`-valued breakout. Both fields and expressions are auto-bucketed. We show a `Don\'t bin` option in the UI, but it gets represented by **omitting the `:temporal-unit` option**, which then gets defaulted to `:day`. There\'s no way for the BE to distinguish between ""unset"" and ""deliberately turned off"", right now; I think that is a bug but it\'s also been around forever (for fields).\r\n\r\nAs a workaround, you can bucket by `:second`, which is probably sufficiently unbucketed for most purposes.\r\n\r\n@zbodi74 and @mngr for comment.', 'created_at': datetime.datetime(2024, 9, 9, 17, 46, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338736363, 'issue_id': 2491580102, 'author': 'mngr', 'body': ""@ranquild Why don't we show explicitly the binning by day here? \r\n![image](https://github.com/user-attachments/assets/909e6b24-4bbb-4fd9-8cd1-703c36f8acaa)"", 'created_at': datetime.datetime(2024, 9, 9, 17, 56, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2340593514, 'issue_id': 2491580102, 'author': 'bshepherdson', 'body': ""@mngr That's an old screenshot, before #47427 . Now the bucketing is shown for expressions just like for fields."", 'created_at': datetime.datetime(2024, 9, 10, 12, 32, 9, tzinfo=datetime.timezone.utc)}, {'comment_id': 2387178462, 'issue_id': 2491580102, 'author': 'github-actions[bot]', 'body': '🚀 This should also be released by [v0.51](https://github.com/metabase/metabase/milestone/231)', 'created_at': datetime.datetime(2024, 10, 1, 22, 14, 55, tzinfo=datetime.timezone.utc)}]","zbodi74 on (2024-08-29 12:42:26 UTC): Replicated, and also happens on PostgreSQL. 
Raising priority as this is a regression in a common function.

bshepherdson (Assginee) on (2024-08-29 15:32:53 UTC): Some data points across versions for reference:

| Version | Breakout on Field | Breakout on custom column |
| :-- | :-- | :-- |
| 0.49.20 | Explicitly bucketed, defaults to `day` | No bucketing visible; unbucketed output |
| master | Explicitly bucketed, defaults to `month` | No bucketing visible; appears to silently bucket by `day` |

In both cases the breakout on the custom column is spelled `[:expression ""NY Date"" {:base-type :type/DateTime}]` and doesn't specify a `:unit`.

I'm debugging further to find out where the unit is coming from.

zbodi74 on (2024-09-06 18:20:45 UTC): Reopening as it works properly when binning is specified, but there is still a `date` cast when the column is not binned. I checked this in `1.50.24.2`.

<img width=""1112"" alt=""image"" src=""https://github.com/user-attachments/assets/5a6a6efc-72f3-4c41-b6c8-5222cb9452c1"">

bshepherdson (Assginee) on (2024-09-09 17:46:32 UTC): This was an intended change, making breakouts on expressions work like breakouts on fields.

## Background

In 0.49.20, breakouts directly on fields defaulted to bucketing by day. Even if you selected `Don't bin` it would still be forced to `:day` by the [`auto-bucket-datetimes` middleware](https://github.com/metabase/metabase/blob/release-x.49.x/src/metabase/query_processor/middleware/auto_bucket_datetimes.clj). If you didn't want to bucket it, you could create a basic expression instead, since those didn't support bucketing in 49.

Bucketing for `:type/Date` and `:type/DateTime` expressions was added to the BE by #45492 and FE by #47427. So as I say, this is an intentional change.

## Intended?

In practice, there's no way to force bucketing off for a `Date(time)`-valued breakout. Both fields and expressions are auto-bucketed. We show a `Don't bin` option in the UI, but it gets represented by **omitting the `:temporal-unit` option**, which then gets defaulted to `:day`. There's no way for the BE to distinguish between ""unset"" and ""deliberately turned off"", right now; I think that is a bug but it's also been around forever (for fields).

As a workaround, you can bucket by `:second`, which is probably sufficiently unbucketed for most purposes.

@zbodi74 and @mngr for comment.

mngr on (2024-09-09 17:56:28 UTC): @ranquild Why don't we show explicitly the binning by day here? 
![image](https://github.com/user-attachments/assets/909e6b24-4bbb-4fd9-8cd1-703c36f8acaa)

bshepherdson (Assginee) on (2024-09-10 12:32:09 UTC): @mngr That's an old screenshot, before #47427 . Now the bucketing is shown for expressions just like for fields.

github-actions[bot] on (2024-10-01 22:14:55 UTC): 🚀 This should also be released by [v0.51](https://github.com/metabase/metabase/milestone/231)

"
2491571348,issue,closed,completed,Tooltip shown for markdown when ellipsis is not applied,"### Describe the bug

![image](https://github.com/user-attachments/assets/02c66b08-248d-4743-be3b-adb9f9980541)


### To Reproduce

1. Create a model with description ""A model""
2. Go to `/browse/models`
3. Hover over the model description

Tooltip is shown.

### Expected behavior

Tooltip is not shown because ellipsis is not applied.

### Information about your Metabase installation

master, 1cf14d8c835062f425bc7f8ecca608f15c280bd5


### Severity

P3

### Additional info

It's a bug in `EllipsifiedWithMarkdownTooltip`.
The same bug will live on Metrics page once it's added (see #47277).",kamilmielnik,2024-08-28 09:33:38+00:00,[],2024-08-28 10:39:21+00:00,2024-08-28 10:39:16+00:00,https://github.com/metabase/metabase/issues/47340,[],"[{'comment_id': 2314956785, 'issue_id': 2491571348, 'author': 'kamilmielnik', 'body': ""It's an issue in a PR, not `master`."", 'created_at': datetime.datetime(2024, 8, 28, 10, 39, 16, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-08-28 10:39:16 UTC): It's an issue in a PR, not `master`.

"
2491513060,issue,closed,completed,"Bigquery question using external tables and returning 0 rows fails with ""Error running query""  due to ""Error reducing result rows: null"" from v0.50.12 until latest version v0.50.22","### Describe the bug

After upgrading to version `v0.50.22`, queries that are using external tables with Google sheet as source and returning 0 rows start to fail with `Error running query`, the logs says `Error reducing result rows: null`.
Metabase is supposed to return `No results!` , but instead it returns `Error running query`.
This bug doesn't exist in versions earlier than `v0.50.12`

### To Reproduce

1. Create BQ External table with Google sheet as the source
2. Run query against the external BQ table or joining to the external table that should return 0 rows

### Expected behavior

Query should return `No results` in metabase instead of failing with `Error running query`

### Logs

[6a1bded6-87b2-4886-bd20-042e8013c2a7] 2024-08-28T16:30:49+08:00 ERROR metabase.query-processor.middleware.catch-exceptions Error processing query: Error running query
{:database_id 2,
 :started_at #t ""2024-08-28T08:29:59.161116Z[GMT]"",
 :via
 [{:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error ""Error reducing result rows: null"",
   :stacktrace
   [""--> query_processor.pipeline$_STAR_reduce_STAR_$fn__56806.invoke(pipeline.clj:74)""
    ""query_processor.pipeline$_STAR_reduce_STAR_.invokeStatic(pipeline.clj:62)""
    ""query_processor.pipeline$_STAR_reduce_STAR_.invoke(pipeline.clj:49)""
    ""query_processor.pipeline$_STAR_run_STAR_$respond__56818.invoke(pipeline.clj:95)""
    ""driver.bigquery_cloud_sdk$post_process_native.invokeStatic(bigquery_cloud_sdk.clj:500)""
    ""driver.bigquery_cloud_sdk$post_process_native.invoke(bigquery_cloud_sdk.clj:483)""
    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_$thunk__120750.invoke(bigquery_cloud_sdk.clj:516)""
    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invokeStatic(bigquery_cloud_sdk.clj:529)""
    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invoke(bigquery_cloud_sdk.clj:506)""
    ""driver.bigquery_cloud_sdk$fn__120757.invokeStatic(bigquery_cloud_sdk.clj:545)""
    ""driver.bigquery_cloud_sdk$fn__120757.invoke(bigquery_cloud_sdk.clj:537)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)""
    ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)""
    ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)""
    ""query_processor.execute$run.invokeStatic(execute.clj:61)""
    ""query_processor.execute$run.invoke(execute.clj:55)""
    ""query_processor.execute$add_native_form_to_result_metadata$fn__69962.invoke(execute.clj:24)""
    ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__69967.invoke(execute.clj:35)""
    ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___69953.invoke(cache.clj:242)""
    ""query_processor.middleware.permissions$check_query_permissions$fn__63944.invoke(permissions.clj:118)""
    ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64542.invoke(enterprise.clj:51)""
    ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64552.invoke(enterprise.clj:64)""
    ""query_processor.execute$execute$fn__69994.invoke(execute.clj:93)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor.execute$execute.invokeStatic(execute.clj:92)""
    ""query_processor.execute$execute.invoke(execute.clj:88)""
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)""
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
    ""query_processor.middleware.enterprise$fn__64569$handle_audit_app_internal_queries__64570$fn__64572.invoke(enterprise.clj:96)""
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__64580.invoke(enterprise.clj:103)""
    ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__75815.invoke(process_userland_query.clj:182)""
    ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__75884.invoke(catch_exceptions.clj:128)""
    ""query_processor$process_query$fn__75921.invoke(query_processor.clj:78)""
    ""query_processor.setup$do_with_canceled_chan$fn__64984.invoke(setup.clj:189)""
    ""query_processor.setup$do_with_database_local_settings$fn__64979.invoke(setup.clj:181)""
    ""query_processor.setup$do_with_driver$fn__64974$fn__64975.invoke(setup.clj:166)""
    ""driver$do_with_driver.invokeStatic(driver.clj:104)""
    ""driver$do_with_driver.invoke(driver.clj:99)""
    ""query_processor.setup$do_with_driver$fn__64974.invoke(setup.clj:165)""
    ""query_processor.setup$do_with_metadata_provider$fn__64967$fn__64970.invoke(setup.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:171)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:160)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
    ""query_processor.setup$do_with_metadata_provider$fn__64967.invoke(setup.clj:150)""
    ""query_processor.setup$do_with_resolved_database$fn__64961.invoke(setup.clj:128)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
    ""query_processor$process_query.invoke(query_processor.clj:69)""
    ""query_processor.card$process_query_for_card_default_qp.invokeStatic(card.clj:170)""
    ""query_processor.card$process_query_for_card_default_qp.invoke(card.clj:166)""
    ""query_processor.card$process_query_for_card_default_run_fn$fn__81938$fn__81939.invoke(card.clj:177)""
    ""query_processor.streaming$_streaming_response$fn__68437$fn__68438$fn__68439.invoke(streaming.clj:175)""
    ""query_processor.streaming$_streaming_response$fn__68437$fn__68438.invoke(streaming.clj:174)""
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
    ""query_processor.streaming$_streaming_response$fn__68437.invoke(streaming.clj:171)""
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""
    ""async.streaming_response$do_f_async$task__52248.invoke(streaming_response.clj:87)""],
   :error_type :qp,
   :ex-data {:type :qp}}],
 :action_id nil,
 :error_type :qp,
 :json_query
 {:constraints {:max-results 10000, :max-results-bare-rows 2000},
  :type :native,
  :middleware
  {:js-int-to-string? true, :ignore-cached-results? false, :process-viz-settings? false, :userland-query? true},
  :cache-strategy nil,
  :native
  {:template-tags {},
   :query
   ""<REDACTED>""},
  :viz-settings {},
  :database 2,
  :parameters []},
 :status :failed,
 :class java.lang.NullPointerException,
 :stacktrace
 [""--> driver.bigquery_cloud_sdk$reducible_bigquery_results$reify__120516.reduce(bigquery_cloud_sdk.clj:106)""
  ""query_processor.pipeline$_STAR_reduce_STAR_$fn__56806.invoke(pipeline.clj:63)""
  ""query_processor.pipeline$_STAR_reduce_STAR_.invokeStatic(pipeline.clj:62)""
  ""query_processor.pipeline$_STAR_reduce_STAR_.invoke(pipeline.clj:49)""
  ""query_processor.pipeline$_STAR_run_STAR_$respond__56818.invoke(pipeline.clj:95)""
  ""driver.bigquery_cloud_sdk$post_process_native.invokeStatic(bigquery_cloud_sdk.clj:500)""
  ""driver.bigquery_cloud_sdk$post_process_native.invoke(bigquery_cloud_sdk.clj:483)""
  ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_$thunk__120750.invoke(bigquery_cloud_sdk.clj:516)""
  ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invokeStatic(bigquery_cloud_sdk.clj:529)""
  ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invoke(bigquery_cloud_sdk.clj:506)""
  ""driver.bigquery_cloud_sdk$fn__120757.invokeStatic(bigquery_cloud_sdk.clj:545)""
  ""driver.bigquery_cloud_sdk$fn__120757.invoke(bigquery_cloud_sdk.clj:537)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)""
  ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)""
  ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)""
  ""query_processor.execute$run.invokeStatic(execute.clj:61)""
  ""query_processor.execute$run.invoke(execute.clj:55)""
  ""query_processor.execute$add_native_form_to_result_metadata$fn__69962.invoke(execute.clj:24)""
  ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__69967.invoke(execute.clj:35)""
  ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___69953.invoke(cache.clj:242)""
  ""query_processor.middleware.permissions$check_query_permissions$fn__63944.invoke(permissions.clj:118)""
  ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64542.invoke(enterprise.clj:51)""
  ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64552.invoke(enterprise.clj:64)""
  ""query_processor.execute$execute$fn__69994.invoke(execute.clj:93)""
  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
  ""query_processor.execute$execute.invokeStatic(execute.clj:92)""
  ""query_processor.execute$execute.invoke(execute.clj:88)""
  ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)""
  ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
  ""query_processor.middleware.enterprise$fn__64569$handle_audit_app_internal_queries__64570$fn__64572.invoke(enterprise.clj:96)""
  ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__64580.invoke(enterprise.clj:103)""
  ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__75815.invoke(process_userland_query.clj:182)""
  ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__75884.invoke(catch_exceptions.clj:128)""
  ""query_processor$process_query$fn__75921.invoke(query_processor.clj:78)""
  ""query_processor.setup$do_with_canceled_chan$fn__64984.invoke(setup.clj:189)""
  ""query_processor.setup$do_with_database_local_settings$fn__64979.invoke(setup.clj:181)""
  ""query_processor.setup$do_with_driver$fn__64974$fn__64975.invoke(setup.clj:166)""
  ""driver$do_with_driver.invokeStatic(driver.clj:104)""
  ""driver$do_with_driver.invoke(driver.clj:99)""
  ""query_processor.setup$do_with_driver$fn__64974.invoke(setup.clj:165)""
  ""query_processor.setup$do_with_metadata_provider$fn__64967$fn__64970.invoke(setup.clj:151)""
  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:171)""
  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:160)""
  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
  ""query_processor.setup$do_with_metadata_provider$fn__64967.invoke(setup.clj:150)""
  ""query_processor.setup$do_with_resolved_database$fn__64961.invoke(setup.clj:128)""
  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
  ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
  ""query_processor$process_query.invoke(query_processor.clj:69)""
  ""query_processor.card$process_query_for_card_default_qp.invokeStatic(card.clj:170)""
  ""query_processor.card$process_query_for_card_default_qp.invoke(card.clj:166)""
  ""query_processor.card$process_query_for_card_default_run_fn$fn__81938$fn__81939.invoke(card.clj:177)""
  ""query_processor.streaming$_streaming_response$fn__68437$fn__68438$fn__68439.invoke(streaming.clj:175)""
  ""query_processor.streaming$_streaming_response$fn__68437$fn__68438.invoke(streaming.clj:174)""
  ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
  ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
  ""query_processor.streaming$_streaming_response$fn__68437.invoke(streaming.clj:171)""
  ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""
  ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""
  ""async.streaming_response$do_f_async$task__52248.invoke(streaming_response.clj:87)""],
 :card_id 28,
 :context :question,
 :error nil,
 :row_count 0,
 :running_time 0,
 :data {:rows [], :cols []}}

### Information about your Metabase installation

```JSON
[6a1bded6-87b2-4886-bd20-042e8013c2a7] 2024-08-28T16:23:38+08:00 INFO metabase.core 
Metabase v0.50.12 (86d4671) 

Copyright © 2024 Metabase, Inc. 

Metabase Enterprise Edition extensions are NOT PRESENT.
[6a1bded6-87b2-4886-bd20-042e8013c2a7] 2024-08-28T16:23:38+08:00 INFO metabase.core Starting Metabase in STANDALONE mode
[6a1bded6-87b2-4886-bd20-042e8013c2a7] 2024-08-28T16:23:38+08:00 INFO metabase.server Launching Embedded Jetty Webserver with config:
 {:port 3000, :host ""0.0.0.0""}

[6a1bded6-87b2-4886-bd20-042e8013c2a7] 2024-08-28T16:23:39+08:00 INFO metabase.core Starting Metabase version v0.50.12 (86d4671) ...
[6a1bded6-87b2-4886-bd20-042e8013c2a7] 2024-08-28T16:23:39+08:00 INFO metabase.core System info:
 {""file.encoding"" ""UTF-8"",
 ""java.runtime.name"" ""OpenJDK Runtime Environment"",
 ""java.runtime.version"" ""11.0.23+9"",
 ""java.vendor"" ""Eclipse Adoptium"",
 ""java.vendor.url"" ""https://adoptium.net/"",
 ""java.version"" ""11.0.23"",
 ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",
 ""java.vm.version"" ""11.0.23+9"",
 ""os.name"" ""Linux"",
 ""os.version"" ""6.1.55-0-virt"",
 ""user.language"" ""en"",
 ""user.timezone"" ""GMT""}
```


### Severity

Blocking some users

### Additional context

_No response_",mario-deriv,2024-08-28 09:07:14+00:00,['snoe'],2024-10-01 22:15:15+00:00,2024-09-09 15:47:29+00:00,https://github.com/metabase/metabase/issues/47339,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Database/BigQuery', ''), ('.Backend', ''), ('.Team/Drivers', '')]","[{'comment_id': 2317260274, 'issue_id': 2491513060, 'author': 'mario-deriv', 'body': 'Updated the issue description above as we further narrowed down the affected queries to those that are using external tables with google sheet as source and are supposed to return 0 rows or No Results.', 'created_at': datetime.datetime(2024, 8, 29, 10, 25, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2318520582, 'issue_id': 2491513060, 'author': 'oreststetsiak', 'body': 'same issue here:\r\n```\r\nERROR middleware.catch-exceptions :: Error processing query: Error running query\r\n{:database_id 138,\r\n :started_at #t ""2024-08-29T17:58:29.474649Z[GMT]"",\r\n :via\r\n [{:status :failed,\r\n   :class clojure.lang.ExceptionInfo,\r\n   :error ""Error reducing result rows: null"",\r\n   :stacktrace\r\n   [""--> query_processor.pipeline$_STAR_reduce_STAR_$fn__56763.invoke(pipeline.clj:74)""\r\n    ""query_processor.pipeline$_STAR_reduce_STAR_.invokeStatic(pipeline.clj:62)""\r\n    ""query_processor.pipeline$_STAR_reduce_STAR_.invoke(pipeline.clj:49)""\r\n```', 'created_at': datetime.datetime(2024, 8, 29, 18, 2, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2319405583, 'issue_id': 2491513060, 'author': 'snoe', 'body': '@mario-deriv I\'m having trouble reproducing this on `v1.50.22` although I have a suspicion why it\'s failing for you. \r\n\r\n> queries to those that are using external tables with google sheet as source and are supposed to return 0 rows\r\n\r\nWhat does ""supposed"" to return 0 rows mean exactly? I assumed it meant that no rows should be present in the google sheet but that doesn\'t seem to be the case. I thought maybe it had to do with skipped header rows, but that doesn\'t work either.\r\n\r\nI tried a sheet like this:\r\n<img width=""605"" alt=""image"" src=""https://github.com/user-attachments/assets/39e621db-7ff3-4f7f-ac0e-64f08ac0f1d5"">\r\nAnd a configuration like this:\r\n<img width=""429"" alt=""image"" src=""https://github.com/user-attachments/assets/15bcbec7-f0ab-4d86-a4c3-33117cb3dc8b"">\r\nAnd a defined schema like this:\r\n<img width=""774"" alt=""image"" src=""https://github.com/user-attachments/assets/5346fe45-c09c-4428-9b75-4da2f1b939fd"">\r\n\r\nAnd with or without filters I get No Results as expected.\r\n<img width=""1185"" alt=""image"" src=""https://github.com/user-attachments/assets/91443ddd-811c-42e8-8131-764f3817e76a"">\r\n\r\nDoes it look like you\'re doing anything differently on your side?', 'created_at': datetime.datetime(2024, 8, 29, 23, 23, 20, tzinfo=datetime.timezone.utc)}, {'comment_id': 2319488213, 'issue_id': 2491513060, 'author': 'oreststetsiak', 'body': 'Hi @snoe!\r\nThanks for looking into it!\r\nI am not very familiar with Metabase, just recently upgraded from 47.0 to the latest, and we have this issue.\r\nI will clarify with developers, but I think we do not have integration with google spreadsheet at all, but only big query, and error is very similar, like stack trace. We also have multiple reports built based on the same template, and some of them actually works and returns 1+ fields, but the other just crash like so, I assume there is no item returned from query\r\nhope it helps in some way\r\nregards!', 'created_at': datetime.datetime(2024, 8, 29, 23, 55, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2320607832, 'issue_id': 2491513060, 'author': 'mario-deriv', 'body': 'Hi @snoe, thanks for checking. What I mean is the external table has data, but in the query it is filtering out rows which should result to 0 rows.\r\n\r\nHere\'s an example query:\r\n```sql\r\nWITH raw as (\r\nSELECT txn.txn_time as dt\r\n     , ext.theo\r\n     , txn.actual\r\n  FROM dataset.base_table txn\r\n  LEFT JOIN dataset.external_table ext\r\n    ON ext.p_key = txn.f_key\r\n   AND DATE(txn.txn_time) >= ext.start_date\r\n   AND DATE(txn.txn_time) <= ext.end_date \r\n WHERE DATE(txn_time) >= date(current_date) - 1\r\n   AND DATE(txn_time) <  date(current_date)\r\n),\r\nt AS (\r\n  SELECT DATE(dt) AS dt, SUM(theo) AS theo\r\n   FROM raw\r\n   GROUP BY 1\r\n),\r\na AS (\r\n  SELECT DATE(dt) AS dt, SUM(actual) AS actual\r\n   FROM raw\r\n   GROUP BY 1\r\n),\r\ncompare AS (\r\n  SELECT t.dt, ((theo - actual) / theo) AS diff\r\n    FROM t\r\n    LEFT JOIN a\r\n      ON t.dt = a.dt\r\n)\r\nSELECT *\r\n FROM compare\r\n WHERE ABS(diff) > 10 -- filter will return 0 rows from compare CTE\r\n```\r\n\r\nHere\'s the external table configuration:\r\n<img width=""444"" alt=""image"" src=""https://github.com/user-attachments/assets/d11fe48c-ee08-480d-8fa3-14aa44aa4706"">', 'created_at': datetime.datetime(2024, 8, 30, 9, 16, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2322112861, 'issue_id': 2491513060, 'author': 'snoe', 'body': '@oreststetsiak and @mario-deriv thank you for the info, that helps narrow it down. About how many rows exist in the underlying tables? Are they highly transactional (lots of writes/deletes)? Are the failing questions consistently failing or do they sometimes work?\r\n\r\n@oreststetsiak Do you have the full stack trace, as was pasted in OP?', 'created_at': datetime.datetime(2024, 8, 30, 18, 27, 19, tzinfo=datetime.timezone.utc)}, {'comment_id': 2322178956, 'issue_id': 2491513060, 'author': 'oreststetsiak', 'body': 'Hi @snoe !\r\nthanks!\r\nnot sure how many rows exist in underlying tables unfortunately,\r\ni dont think its hightly transactional in terms of write and deletes, it just reports that mainly query database.\r\nIts failing consistently, in the same time, similar report, that returns data works 100% of the time.\r\nstackstrace (data is blured, but you can get an idea, sql query is big, yes)\r\n```\r\n\r\n{:database_id 138,\r\n :via\r\n [{:status :failed,\r\n   :class clojure.lang.ExceptionInfo,\r\n   :error ""Error reducing result rows: null"",\r\n   :stacktrace\r\n   [""--> query_processor.pipeline$_STAR_reduce_STAR_$fn__56763.invoke(pipeline.clj:74)""\r\n    ""query_processor.pipeline$_STAR_reduce_STAR_.invokeStatic(pipeline.clj:62)""\r\n    ""query_processor.pipeline$_STAR_reduce_STAR_.invoke(pipeline.clj:49)""\r\n    ""query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70504$fn__70505.invoke(cache.clj:211)""\r\n    ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)""\r\n    ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""\r\n    ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)""\r\n    ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""\r\n    ""query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70504.invoke(cache.clj:207)""\r\n    ""query_processor.pipeline$_STAR_run_STAR_$respond__56775.invoke(pipeline.clj:95)""\r\n    ""driver.bigquery_cloud_sdk$post_process_native.invokeStatic(bigquery_cloud_sdk.clj:500)""\r\n    ""driver.bigquery_cloud_sdk$post_process_native.invoke(bigquery_cloud_sdk.clj:483)""\r\n    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_$thunk__127208.invoke(bigquery_cloud_sdk.clj:516)""\r\n    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invokeStatic(bigquery_cloud_sdk.clj:529)""\r\n    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invoke(bigquery_cloud_sdk.clj:506)""\r\n    ""driver.bigquery_cloud_sdk$fn__127226.invokeStatic(bigquery_cloud_sdk.clj:545)""\r\n    ""driver.bigquery_cloud_sdk$fn__127226.invoke(bigquery_cloud_sdk.clj:537)""\r\n    ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)""\r\n    ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)""\r\n    ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)""\r\n    ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)""\r\n    ""query_processor.execute$run.invokeStatic(execute.clj:60)""\r\n    ""query_processor.execute$run.invoke(execute.clj:54)""\r\n    ""query_processor.middleware.update_used_cards$update_used_cards_BANG_$fn__70545.invoke(update_used_cards.clj:58)""\r\n    ""query_processor.execute$add_native_form_to_result_metadata$fn__70560.invoke(execute.clj:23)""\r\n    ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__70565.invoke(execute.clj:34)""\r\n    ""query_processor.middleware.cache$run_query_with_cache.invokeStatic(cache.clj:212)""\r\n    ""query_processor.middleware.cache$run_query_with_cache.invoke(cache.clj:185)""\r\n    ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___70518.invoke(cache.clj:238)""\r\n    ""query_processor.middleware.permissions$check_query_permissions$fn__64002.invoke(permissions.clj:119)""\r\n    ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64612.invoke(enterprise.clj:51)""\r\n    ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64622.invoke(enterprise.clj:64)""\r\n    ""query_processor.execute$execute$fn__70592.invoke(execute.clj:92)""\r\n    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""\r\n    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""\r\n    ""query_processor.execute$execute.invokeStatic(execute.clj:91)""\r\n    ""query_processor.execute$execute.invoke(execute.clj:87)""\r\n    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)""\r\n    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""\r\n    ""query_processor.middleware.enterprise$fn__64639$handle_audit_app_internal_queries__64640$fn__64642.invoke(enterprise.clj:96)""\r\n    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__64650.invoke(enterprise.clj:103)""\r\n    ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76333.invoke(process_userland_query.clj:198)""\r\n    ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__76402.invoke(catch_exceptions.clj:128)""\r\n    ""query_processor$process_query$fn__76439.invoke(query_processor.clj:78)""\r\n    ""query_processor.setup$do_with_canceled_chan$fn__65054.invoke(setup.clj:189)""\r\n    ""query_processor.setup$do_with_database_local_settings$fn__65049.invoke(setup.clj:181)""\r\n    ""query_processor.setup$do_with_driver$fn__65044$fn__65045.invoke(setup.clj:166)""\r\n    ""driver$do_with_driver.invokeStatic(driver.clj:104)""\r\n    ""driver$do_with_driver.invoke(driver.clj:99)""\r\n    ""query_processor.setup$do_with_driver$fn__65044.invoke(setup.clj:165)""\r\n    ""query_processor.setup$do_with_metadata_provider$fn__65037$fn__65040.invoke(setup.clj:151)""\r\n    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:170)""\r\n    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""\r\n    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:159)""\r\n    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""\r\n    ""query_processor.setup$do_with_metadata_provider$fn__65037.invoke(setup.clj:150)""\r\n    ""query_processor.setup$do_with_resolved_database$fn__65031.invoke(setup.clj:128)""\r\n    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""\r\n    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""\r\n    ""query_processor$process_query.invokeStatic(query_processor.clj:76)""\r\n    ""query_processor$process_query.invoke(query_processor.clj:69)""\r\n    ""query_processor.card$process_query_for_card_default_qp.invokeStatic(card.clj:170)""\r\n    ""query_processor.card$process_query_for_card_default_qp.invoke(card.clj:166)""\r\n    ""query_processor.card$process_query_for_card_default_run_fn$fn__82333$fn__82334.invoke(card.clj:177)""\r\n    ""query_processor.streaming$_streaming_response$fn__68548$fn__68549$fn__68550.invoke(streaming.clj:175)""\r\n    ""query_processor.streaming$_streaming_response$fn__68548$fn__68549.invoke(streaming.clj:174)""\r\n    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""\r\n    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""\r\n    ""query_processor.streaming$_streaming_response$fn__68548.invoke(streaming.clj:171)""\r\n    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""\r\n    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""\r\n    ""async.streaming_response$do_f_async$task__51863.invoke(streaming_response.clj:87)""],\r\n   :error_type :qp,\r\n   :ex-data {:type :qp}}],\r\n :action_id nil,\r\n :error_type :qp,\r\n :json_query\r\n {:constraints {:max-results 10000, :max-results-bare-rows 2000},\r\n  :type :query,\r\n  :middleware\r\n  {:js-int-to-string? true, :ignore-cached-results? false, :process-viz-settings? false, :userland-query? true},\r\n  :cache-strategy {:multiplier 10, :min_duration_ms 10, :type :ttl, :avg-execution-ms 17580},\r\n  :viz-settings\r\n  {:table.pivot_column ""qweqwe_id"",\r\n   :table.cell_column ""qweqwe"",\r\n   :column_settings\r\n   {""[\\""ref\\"",[\\""field\\"",600635,null]]"" {:column_title ""qweqwe Created Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600706,null]]"" {:column_title ""qweqwe Updated Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600632,null]]"" {:column_title ""qweqwe Created Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600661,null]]"" {:column_title ""qweqwe Start Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600628,null]]"" {:column_title ""qweqwe End Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600649,null]]"" {:column_title ""qweqwe Initial End Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600712,null]]"" {:column_title ""qweqwe Updated Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600693,null]]"" {:column_title ""qweqwe Canceled Date UTC""}}},\r\n  :database 138,\r\n  :query\r\n  {:source-table 92317,\r\n   :order-by [[:desc [:field 600666 {:base-type :type/DateTime}]]],\r\n   :expressions\r\n   {""qweqwe Detail Link""\r\n    [:concat ""https://qweqwe.qwe/sell/qweqwe/qweqwes/"" [:field 600718 nil] ""/details""]},\r\n   :filter\r\n   [:and\r\n    [:= [:field 600686 nil] ""QWEQWE qweqwe""]\r\n    [:= [:field 600640 nil] 0]\r\n    [:= [:field 600620 nil] false]\r\n    [:time-interval [:field 600666 nil] -1 :day {:include-current false}]\r\n    [:!= [:field 600707 nil] ""DRAFT""]]},\r\n  :parameters []},\r\n :native\r\n {:query\r\n  ""SELECT `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`original_id` AS `original_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`seller_name` AS `seller_name`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_date` AS `qweqwe_created_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_date_pacific` AS `qweqwe_created_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_updated_date` AS `qweqwe_updated_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_updated_date_pacific` AS `qweqwe_updated_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe1` AS `qweqwe1`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe2` AS `qweqwe2`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`city` AS `city`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_code` AS `qweqwe_code`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwe` AS `qwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_title` AS `qweqwe_title`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_description` AS `qweqwe_description`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe_local` AS `qwewqe_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe_usd` AS `qwewqe_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_currency_code` AS `qweqwe_currency_code`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_local` AS `qweqwe_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_usd` AS `qweqwe_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_local` AS `qweqwe_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_usd` AS `qweqwe_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_fee_local` AS `qweqwe_fee_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_fee_usd` AS `qweqwe_fee_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_breakdown` AS `qweqwe_breakdown`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`condition_quantity_breakdown` AS `condition_quantity_breakdown`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`manual_category` AS `manual_category`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`manual_item_condition` AS `manual_item_condition`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`manual_package_condition` AS `manual_package_condition`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`shipping_service_type` AS `shipping_service_type`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`pallet_ids` AS `pallet_ids`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`shipping_notes_pallet_count` AS `shipping_notes_pallet_count`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`title_pallet_count` AS `title_pallet_count`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`shipping_notes_pallet_spaces` AS `shipping_notes_pallet_spaces`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe` AS `qwewqe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_depth` AS `max_depth`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_width` AS `max_width`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_height` AS `max_height`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`weight` AS `weight`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`shipping_note` AS `shipping_note`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`inventory_source` AS `inventory_source`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe` AS `qwewqe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`cosmetic_condition` AS `cosmetic_condition`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`accessories` AS `accessories`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe` AS `qwewqe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`attributes_carrier` AS `attributes_carrier`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`functionality` AS `functionality`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`attributes_capacity` AS `attributes_capacity`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`custom_attributes` AS `custom_attributes`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`country_of_origin` AS `country_of_origin`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`min_expiration_date` AS `min_expiration_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`attributes_brand_name` AS `attributes_brand_name`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`attributes_is_locked` AS `attributes_is_locked`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_by` AS `qweqwe_created_by`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_status` AS `qweqwe_status`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`cancellation_reason` AS `cancellation_reason`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`lot_status` AS `lot_status`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`order_id` AS `order_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_date` AS `qweqwe_created_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_date_pacific` AS `qweqwe_created_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_start_date` AS `qweqwe_start_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_start_date_pacific` AS `qweqwe_start_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_end_date` AS `qweqwe_end_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_end_date_pacific` AS `qweqwe_end_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_initial_end_date` AS `qweqwe_initial_end_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_initial_end_date_pacific` AS `qweqwe_initial_end_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_updated_date` AS `qweqwe_updated_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_updated_date_pacific` AS `qweqwe_updated_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`start_price_local` AS `start_price_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`start_price_usd` AS `start_price_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`number_of_qweqweqwes` AS `number_of_qweqweqwes`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`canceled_qweqweqwes` AS `canceled_qweqweqwes`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqweqweders` AS `qweqweqweders`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`winning_qweqweqwe_amount_local` AS `winning_qweqweqwe_amount_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`winning_qweqweqwe_amount_usd` AS `winning_qweqweqwe_amount_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_qweqweqwe_amount_local` AS `max_qweqweqwe_amount_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_qweqweqwe_amount_usd` AS `max_qweqweqwe_amount_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_canceled` AS `qweqwe_is_canceled`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_canceled_date` AS `qweqwe_canceled_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_canceled_date_pacific` AS `qweqwe_canceled_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_closed` AS `qweqwe_is_closed`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_private` AS `qweqwe_is_private`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`view_count` AS `view_count`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_type` AS `qweqwe_type`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_relist` AS `qweqwe_is_relist`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`total_qweqwe` AS `total_qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_id` AS `prior_qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_end_time` AS `prior_qweqwe_end_time`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_end_time_pacific` AS `prior_qweqwe_end_time_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_start_price_local` AS `prior_start_price_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_start_price_usd` AS `prior_start_price_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_gmv_local` AS `prior_qweqwe_gmv_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_gmv_usd` AS `prior_qweqwe_gmv_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_is_sold_uncanceled` AS `prior_qweqwe_is_sold_uncanceled`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_is_qweqwe` AS `prior_qweqwe_is_qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_is_unsold` AS `prior_qweqwe_is_unsold`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_is_canceled` AS `prior_qweqwe_is_canceled`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`running_relist_count` AS `running_relist_count`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`is_relisted_with_lowered_start_price` AS `is_relisted_with_lowered_start_price`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`storefront_id` AS `storefront_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`storefront_name` AS `storefront_name`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`is_live_qweqwe` AS `is_live_qweqwe`, CONCAT(?, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id`, ?) AS `qweqwe_Detail_Link` FROM `qweqwe.qweqwe_qweqweqweqwedata_source` WHERE (`qweqwe.qweqwe_qweqweqweqwedata_source`.`seller_name` = ?) AND (`qweqwe.qweqwe_qweqweqweqwedata_source`.`number_of_qweqweqwes` = 0) AND (`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_canceled` = FALSE) AND (`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_end_date_pacific` >= DATETIME_TRUNC(DATETIME_ADD(CURRENT_DATETIME(\'UTC\'), INTERVAL -1 day), day)) AND (`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_end_date_pacific` < DATETIME_TRUNC(CURRENT_DATETIME(\'UTC\'), day)) AND ((`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_status` <> ?) OR (`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_status` IS NULL)) ORDER BY `qweqwe_end_date_pacific` DESC LIMIT 2000"",\r\n  :params (""https://qweqwe.qwe/sell/qweqwe/qweqwes/"" ""/details"" ""QWEQWE qweqwe"" ""DRAFT""),\r\n  :table-name ""qweqwe_qweqweqweqwedata_source"",\r\n  :mbql? true},\r\n :status :failed,\r\n :class java.lang.NullPointerException,\r\n :stacktrace\r\n [""--> driver.bigquery_cloud_sdk$values_iterator.invokeStatic(bigquery_cloud_sdk.clj:70)""\r\n  ""driver.bigquery_cloud_sdk$values_iterator.invoke(bigquery_cloud_sdk.clj:69)""\r\n  ""driver.bigquery_cloud_sdk$reducible_bigquery_results$reify__126465.reduce(bigquery_cloud_sdk.clj:111)""\r\n  ""query_processor.pipeline$_STAR_reduce_STAR_$fn__56763.invoke(pipeline.clj:63)""\r\n  ""query_processor.pipeline$_STAR_reduce_STAR_.invokeStatic(pipeline.clj:62)""\r\n  ""query_processor.pipeline$_STAR_reduce_STAR_.invoke(pipeline.clj:49)""\r\n  ""query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70504$fn__70505.invoke(cache.clj:211)""\r\n  ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)""\r\n  ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""\r\n  ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)""\r\n  ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""\r\n  ""query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70504.invoke(cache.clj:207)""\r\n  ""query_processor.pipeline$_STAR_run_STAR_$respond__56775.invoke(pipeline.clj:95)""\r\n  ""driver.bigquery_cloud_sdk$post_process_native.invokeStatic(bigquery_cloud_sdk.clj:500)""\r\n  ""driver.bigquery_cloud_sdk$post_process_native.invoke(bigquery_cloud_sdk.clj:483)""\r\n  ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_$thunk__127208.invoke(bigquery_cloud_sdk.clj:516)""\r\n  ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invokeStatic(bigquery_cloud_sdk.clj:529)""\r\n  ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invoke(bigquery_cloud_sdk.clj:506)""\r\n  ""driver.bigquery_cloud_sdk$fn__127226.invokeStatic(bigquery_cloud_sdk.clj:545)""\r\n  ""driver.bigquery_cloud_sdk$fn__127226.invoke(bigquery_cloud_sdk.clj:537)""\r\n  ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)""\r\n  ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)""\r\n  ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)""\r\n  ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)""\r\n  ""query_processor.execute$run.invokeStatic(execute.clj:60)""\r\n  ""query_processor.execute$run.invoke(execute.clj:54)""\r\n  ""query_processor.middleware.update_used_cards$update_used_cards_BANG_$fn__70545.invoke(update_used_cards.clj:58)""\r\n  ""query_processor.execute$add_native_form_to_result_metadata$fn__70560.invoke(execute.clj:23)""\r\n  ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__70565.invoke(execute.clj:34)""\r\n  ""query_processor.middleware.cache$run_query_with_cache.invokeStatic(cache.clj:212)""\r\n  ""query_processor.middleware.cache$run_query_with_cache.invoke(cache.clj:185)""\r\n  ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___70518.invoke(cache.clj:238)""\r\n  ""query_processor.middleware.permissions$check_query_permissions$fn__64002.invoke(permissions.clj:119)""\r\n  ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64612.invoke(enterprise.clj:51)""\r\n  ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64622.invoke(enterprise.clj:64)""\r\n  ""query_processor.execute$execute$fn__70592.invoke(execute.clj:92)""\r\n  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""\r\n  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""\r\n  ""query_processor.execute$execute.invokeStatic(execute.clj:91)""\r\n  ""query_processor.execute$execute.invoke(execute.clj:87)""\r\n  ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)""\r\n  ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""\r\n  ""query_processor.middleware.enterprise$fn__64639$handle_audit_app_internal_queries__64640$fn__64642.invoke(enterprise.clj:96)""\r\n  ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__64650.invoke(enterprise.clj:103)""\r\n  ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76333.invoke(process_userland_query.clj:198)""\r\n  ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__76402.invoke(catch_exceptions.clj:128)""\r\n  ""query_processor$process_query$fn__76439.invoke(query_processor.clj:78)""\r\n  ""query_processor.setup$do_with_canceled_chan$fn__65054.invoke(setup.clj:189)""\r\n  ""query_processor.setup$do_with_database_local_settings$fn__65049.invoke(setup.clj:181)""\r\n  ""query_processor.setup$do_with_driver$fn__65044$fn__65045.invoke(setup.clj:166)""\r\n  ""driver$do_with_driver.invokeStatic(driver.clj:104)""\r\n  ""driver$do_with_driver.invoke(driver.clj:99)""\r\n  ""query_processor.setup$do_with_driver$fn__65044.invoke(setup.clj:165)""\r\n  ""query_processor.setup$do_with_metadata_provider$fn__65037$fn__65040.invoke(setup.clj:151)""\r\n  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:170)""\r\n  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""\r\n  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:159)""\r\n  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""\r\n  ""query_processor.setup$do_with_metadata_provider$fn__65037.invoke(setup.clj:150)""\r\n  ""query_processor.setup$do_with_resolved_database$fn__65031.invoke(setup.clj:128)""\r\n  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""\r\n  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""\r\n  ""query_processor$process_query.invokeStatic(query_processor.clj:76)""\r\n  ""query_processor$process_query.invoke(query_processor.clj:69)""\r\n  ""query_processor.card$process_query_for_card_default_qp.invokeStatic(card.clj:170)""\r\n  ""query_processor.card$process_query_for_card_default_qp.invoke(card.clj:166)""\r\n  ""query_processor.card$process_query_for_card_default_run_fn$fn__82333$fn__82334.invoke(card.clj:177)""\r\n  ""query_processor.streaming$_streaming_response$fn__68548$fn__68549$fn__68550.invoke(streaming.clj:175)""\r\n  ""query_processor.streaming$_streaming_response$fn__68548$fn__68549.invoke(streaming.clj:174)""\r\n  ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""\r\n  ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""\r\n  ""query_processor.streaming$_streaming_response$fn__68548.invoke(streaming.clj:171)""\r\n  ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""\r\n  ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""\r\n  ""async.streaming_response$do_f_async$task__51863.invoke(streaming_response.clj:87)""],\r\n :card_id 8710,\r\n :context :question,\r\n :error nil,\r\n :row_count 0,\r\n :running_time 0,\r\n :preprocessed\r\n {:constraints {:max-results 10000, :max-results-bare-rows 2000},\r\n  :middleware\r\n  {:js-int-to-string? true, :ignore-cached-results? false, :process-viz-settings? false, :userland-query? true},\r\n  :cache-strategy {:multiplier 10, :min-duration-ms 10, :type :ttl, :avg-execution-ms 17580},\r\n  :viz-settings\r\n  {:table.pivot_column ""qweqwe_id"",\r\n   :table.cell_column ""qweqwe"",\r\n   :column_settings\r\n   {""[\\""ref\\"",[\\""field\\"",600635,null]]"" {:column_title ""qweqwe Created Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600706,null]]"" {:column_title ""qweqwe Updated Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600632,null]]"" {:column_title ""qweqwe Created Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600661,null]]"" {:column_title ""qweqwe Start Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600628,null]]"" {:column_title ""qweqwe End Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600649,null]]"" {:column_title ""qweqwe Initial End Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600712,null]]"" {:column_title ""qweqwe Updated Date UTC""},\r\n    ""[\\""ref\\"",[\\""field\\"",600693,null]]"" {:column_title ""qweqwe Canceled Date UTC""}}},\r\n  :info\r\n  {:executed-by 721,\r\n   :context :question,\r\n   :card-id 8710,\r\n   :card-name ""Alerts - QWEQWE"",\r\n   :visualization-settings\r\n   {:table.pivot_column ""qweqwe_id"",\r\n    :table.cell_column ""qweqwe"",\r\n    :column_settings\r\n    {""[\\""ref\\"",[\\""field\\"",600635,null]]"" {:column_title ""qweqwe Created Date UTC""},\r\n     ""[\\""ref\\"",[\\""field\\"",600706,null]]"" {:column_title ""qweqwe Updated Date UTC""},\r\n     ""[\\""ref\\"",[\\""field\\"",600632,null]]"" {:column_title ""qweqwe Created Date UTC""},\r\n     ""[\\""ref\\"",[\\""field\\"",600661,null]]"" {:column_title ""qweqwe Start Date UTC""},\r\n     ""[\\""ref\\"",[\\""field\\"",600628,null]]"" {:column_title ""qweqwe End Date UTC""},\r\n     ""[\\""ref\\"",[\\""field\\"",600649,null]]"" {:column_title ""qweqwe Initial End Date UTC""},\r\n     ""[\\""ref\\"",[\\""field\\"",600712,null]]"" {:column_title ""qweqwe Updated Date UTC""},\r\n     ""[\\""ref\\"",[\\""field\\"",600693,null]]"" {:column_title ""qweqwe Canceled Date UTC""}}}},\r\n  :database 138,\r\n  :type :query,\r\n  :query\r\n  {:source-table 92317,\r\n   :order-by [[:desc [:field 600666 {:base-type :type/DateTime, :temporal-unit :default}]]],\r\n   :expressions\r\n   {""qweqwe Detail Link""\r\n    [:concat ""https://qweqwe.qwe/sell/qweqwe/qweqwes/"" [:field 600718 nil] ""/details""]},\r\n   :filter\r\n   [:and\r\n    [:=\r\n     [:field 600686 nil]\r\n     [:value\r\n      ""QWEQWE qweqwe""\r\n      {:base_type :type/Text,\r\n       :effective_type :type/Text,\r\n       :coercion_strategy nil,\r\n       :semantic_type :type/Category,\r\n       :database_type ""STRING"",\r\n       :name ""seller_name""}]]\r\n    [:=\r\n     [:field 600640 nil]\r\n     [:value\r\n      0\r\n      {:base_type :type/Decimal,\r\n       :effective_type :type/Decimal,\r\n       :coercion_strategy nil,\r\n       :semantic_type nil,\r\n       :database_type ""NUMERIC"",\r\n       :name ""number_of_qweqweqwes""}]]\r\n    [:=\r\n     [:field 600620 nil]\r\n     [:value\r\n      false\r\n      {:base_type :type/Boolean,\r\n       :effective_type :type/Boolean,\r\n       :coercion_strategy nil,\r\n       :semantic_type :type/Category,\r\n       :database_type ""BOOLEAN"",\r\n       :name ""qweqwe_is_canceled""}]]\r\n    [:>= [:field 600666 {:temporal-unit :default}] [:relative-datetime -1 :day]]\r\n    [:< [:field 600666 {:temporal-unit :default}] [:relative-datetime 0 :day]]\r\n    [:!=\r\n     [:field 600707 nil]\r\n     [:value\r\n      ""DRAFT""\r\n      {:base_type :type/Text,\r\n       :effective_type :type/Text,\r\n       :coercion_strategy nil,\r\n       :semantic_type :type/Category,\r\n       :database_type ""STRING"",\r\n       :name ""qweqwe_status""}]]],\r\n   :fields\r\n   [[:field 600718 nil]\r\n    [:field 600631 nil]\r\n    [:field 600629 nil]\r\n    [:field 600686 nil]\r\n    [:field 600691 nil]\r\n    [:field 600635 {:temporal-unit :default}]\r\n    [:field 600669 {:temporal-unit :default}]\r\n    [:field 600706 {:temporal-unit :default}]\r\n    [:field 600638 {:temporal-unit :default}]\r\n    [:field 600690 nil]\r\n    [:field 600796 nil]\r\n    [:field 600795 nil]\r\n    [:field 600617 nil]\r\n    [:field 600655 nil]\r\n    [:field 600618 nil]\r\n    [:field 600659 nil]\r\n    [:field 600651 nil]\r\n    [:field 600704 nil]\r\n    [:field 600688 nil]\r\n    [:field 600615 nil]\r\n    [:field 600660 nil]\r\n    [:field 600644 nil]\r\n    [:field 600687 nil]\r\n    [:field 600619 nil]\r\n    [:field 600675 nil]\r\n    [:field 600679 nil]\r\n    [:field 600664 nil]\r\n    [:field 600671 nil]\r\n    [:field 600681 nil]\r\n    [:field 600719 nil]\r\n    [:field 600680 nil]\r\n    [:field 600663 nil]\r\n    [:field 614441 nil]\r\n    [:field 614439 nil]\r\n    [:field 614440 nil]\r\n    [:field 600684 nil]\r\n    [:field 600654 nil]\r\n    [:field 600702 nil]\r\n    [:field 600636 nil]\r\n    [:field 600624 nil]\r\n    [:field 600627 nil]\r\n    [:field 600616 nil]\r\n    [:field 600642 nil]\r\n    [:field 600637 nil]\r\n    [:field 600650 nil]\r\n    [:field 600626 nil]\r\n    [:field 600665 nil]\r\n    [:field 614442 nil]\r\n    [:field 600656 nil]\r\n    [:field 600689 nil]\r\n    [:field 600670 nil]\r\n    [:field 600699 nil]\r\n    [:field 600696 nil]\r\n    [:field 600622 nil]\r\n    [:field 600682 nil]\r\n    [:field 600685 nil]\r\n    [:field 600692 nil]\r\n    [:field 600621 nil]\r\n    [:field 600643 nil]\r\n    [:field 600710 nil]\r\n    [:field 600641 {:temporal-unit :default}]\r\n    [:field 600720 nil]\r\n    [:field 600657 nil]\r\n    [:field 600695 nil]\r\n    [:field 600707 nil]\r\n    [:field 600713 nil]\r\n    [:field 600634 nil]\r\n    [:field 600668 nil]\r\n    [:field 600717 nil]\r\n    [:field 600632 {:temporal-unit :default}]\r\n    [:field 600714 {:temporal-unit :default}]\r\n    [:field 600661 {:temporal-unit :default}]\r\n    [:field 600705 {:temporal-unit :default}]\r\n    [:field 600628 {:temporal-unit :default}]\r\n    [:field 600666 {:temporal-unit :default}]\r\n    [:field 600649 {:temporal-unit :default}]\r\n    [:field 600711 {:temporal-unit :default}]\r\n    [:field 600712 {:temporal-unit :default}]\r\n    [:field 600658 {:temporal-unit :default}]\r\n    [:field 600708 nil]\r\n    [:field 600716 nil]\r\n    [:field 600640 nil]\r\n    [:field 600709 nil]\r\n    [:field 600623 nil]\r\n    [:field 600662 nil]\r\n    [:field 600652 nil]\r\n    [:field 600683 nil]\r\n    [:field 600630 nil]\r\n    [:field 600620 nil]\r\n    [:field 600693 {:temporal-unit :default}]\r\n    [:field 600667 {:temporal-unit :default}]\r\n    [:field 600677 nil]\r\n    [:field 600676 nil]\r\n    [:field 600625 nil]\r\n    [:field 600647 nil]\r\n    [:field 600698 nil]\r\n    [:field 600639 nil]\r\n    [:field 600646 nil]\r\n    [:field 600674 {:temporal-unit :default}]\r\n    [:field 600633 {:temporal-unit :default}]\r\n    [:field 600694 nil]\r\n    [:field 600697 nil]\r\n    [:field 600648 nil]\r\n    [:field 600700 nil]\r\n    [:field 600703 nil]\r\n    [:field 600715 nil]\r\n    [:field 600678 nil]\r\n    [:field 600653 nil]\r\n    [:field 600701 nil]\r\n    [:field 600645 nil]\r\n    [:field 600673 nil]\r\n    [:field 600672 nil]\r\n    [:field 1173262 nil]\r\n    [:expression ""qweqwe Detail Link""]],\r\n   :limit 2000,\r\n   :metabase.query-processor.middleware.limit/original-limit nil}},\r\n :data {:rows [], :cols []}}\r\nGET2001.92 KB10 msChrome 128 https://metabase.qweqwe.com/api/database/138 \r\n\r\n```', 'created_at': datetime.datetime(2024, 8, 30, 19, 9, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2325717097, 'issue_id': 2491513060, 'author': 'mario-deriv', 'body': 'Hi @snoe  \r\n\r\n> About how many rows exist in the underlying tables? \r\n\r\nThe external table has 60k+ rows, the base table has 2M+ rows\r\n\r\n> Are they highly transactional (lots of writes/deletes)? \r\n\r\nThe external table, no. The base table has lots of writes/updates, but no deletes.\r\n\r\n> Are the failing questions consistently failing or do they sometimes work?\r\n\r\nThey consistently fail', 'created_at': datetime.datetime(2024, 9, 3, 6, 40, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2339318462, 'issue_id': 2491513060, 'author': 'oreststetsiak', 'body': 'still a case for me with v0.50.24.4, what about you @mario-deriv ?', 'created_at': datetime.datetime(2024, 9, 9, 23, 21, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2353377742, 'issue_id': 2491513060, 'author': 'paoliniluis', 'body': '@oreststetsiak can you check the latest 50.25?', 'created_at': datetime.datetime(2024, 9, 16, 16, 24, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2354136671, 'issue_id': 2491513060, 'author': 'oreststetsiak', 'body': 'Hi @paoliniluis !\r\njust deployed [v0.50.25.3]\r\nissue still persists, even though, introduced new problems with different reports,\r\nhad to rollback', 'created_at': datetime.datetime(2024, 9, 16, 22, 25, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2358330839, 'issue_id': 2491513060, 'author': 'paoliniluis', 'body': ""@oreststetsiak can you create a new issue? we have a customer that's reporting something similar to this so it might be the same issue"", 'created_at': datetime.datetime(2024, 9, 18, 12, 25, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2359370846, 'issue_id': 2491513060, 'author': 'oreststetsiak', 'body': '@paoliniluis i created a [new ticket](https://github.com/metabase/metabase/issues/48010), just in case you curious\r\nit is different,\r\ni see the current issue has completely gone with [v0.50.26.1], i see a pretty message ""No results!"" and no errors, thank you!', 'created_at': datetime.datetime(2024, 9, 18, 20, 44, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2362804703, 'issue_id': 2491513060, 'author': 'mario-deriv', 'body': 'I can confirm that the issue is fixed in [0.50.26](https://github.com/metabase/metabase/milestone/271), queries return `No results!` instead of `Error running query` . Thank you for fixing  this @snoe !', 'created_at': datetime.datetime(2024, 9, 20, 4, 39, 39, tzinfo=datetime.timezone.utc)}]","mario-deriv (Issue Creator) on (2024-08-29 10:25:02 UTC): Updated the issue description above as we further narrowed down the affected queries to those that are using external tables with google sheet as source and are supposed to return 0 rows or No Results.

oreststetsiak on (2024-08-29 18:02:40 UTC): same issue here:
```
ERROR middleware.catch-exceptions :: Error processing query: Error running query
{:database_id 138,
 :started_at #t ""2024-08-29T17:58:29.474649Z[GMT]"",
 :via
 [{:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error ""Error reducing result rows: null"",
   :stacktrace
   [""--> query_processor.pipeline$_STAR_reduce_STAR_$fn__56763.invoke(pipeline.clj:74)""
    ""query_processor.pipeline$_STAR_reduce_STAR_.invokeStatic(pipeline.clj:62)""
    ""query_processor.pipeline$_STAR_reduce_STAR_.invoke(pipeline.clj:49)""
```

snoe (Assginee) on (2024-08-29 23:23:20 UTC): @mario-deriv I'm having trouble reproducing this on `v1.50.22` although I have a suspicion why it's failing for you. 


What does ""supposed"" to return 0 rows mean exactly? I assumed it meant that no rows should be present in the google sheet but that doesn't seem to be the case. I thought maybe it had to do with skipped header rows, but that doesn't work either.

I tried a sheet like this:
<img width=""605"" alt=""image"" src=""https://github.com/user-attachments/assets/39e621db-7ff3-4f7f-ac0e-64f08ac0f1d5"">
And a configuration like this:
<img width=""429"" alt=""image"" src=""https://github.com/user-attachments/assets/15bcbec7-f0ab-4d86-a4c3-33117cb3dc8b"">
And a defined schema like this:
<img width=""774"" alt=""image"" src=""https://github.com/user-attachments/assets/5346fe45-c09c-4428-9b75-4da2f1b939fd"">

And with or without filters I get No Results as expected.
<img width=""1185"" alt=""image"" src=""https://github.com/user-attachments/assets/91443ddd-811c-42e8-8131-764f3817e76a"">

Does it look like you're doing anything differently on your side?

oreststetsiak on (2024-08-29 23:55:32 UTC): Hi @snoe!
Thanks for looking into it!
I am not very familiar with Metabase, just recently upgraded from 47.0 to the latest, and we have this issue.
I will clarify with developers, but I think we do not have integration with google spreadsheet at all, but only big query, and error is very similar, like stack trace. We also have multiple reports built based on the same template, and some of them actually works and returns 1+ fields, but the other just crash like so, I assume there is no item returned from query
hope it helps in some way
regards!

mario-deriv (Issue Creator) on (2024-08-30 09:16:08 UTC): Hi @snoe, thanks for checking. What I mean is the external table has data, but in the query it is filtering out rows which should result to 0 rows.

Here's an example query:
```sql
WITH raw as (
SELECT txn.txn_time as dt
     , ext.theo
     , txn.actual
  FROM dataset.base_table txn
  LEFT JOIN dataset.external_table ext
    ON ext.p_key = txn.f_key
   AND DATE(txn.txn_time) >= ext.start_date
   AND DATE(txn.txn_time) <= ext.end_date 
 WHERE DATE(txn_time) >= date(current_date) - 1
   AND DATE(txn_time) <  date(current_date)
),
t AS (
  SELECT DATE(dt) AS dt, SUM(theo) AS theo
   FROM raw
   GROUP BY 1
),
a AS (
  SELECT DATE(dt) AS dt, SUM(actual) AS actual
   FROM raw
   GROUP BY 1
),
compare AS (
  SELECT t.dt, ((theo - actual) / theo) AS diff
    FROM t
    LEFT JOIN a
      ON t.dt = a.dt
)
SELECT *
 FROM compare
 WHERE ABS(diff) > 10 -- filter will return 0 rows from compare CTE
```

Here's the external table configuration:
<img width=""444"" alt=""image"" src=""https://github.com/user-attachments/assets/d11fe48c-ee08-480d-8fa3-14aa44aa4706"">

snoe (Assginee) on (2024-08-30 18:27:19 UTC): @oreststetsiak and @mario-deriv thank you for the info, that helps narrow it down. About how many rows exist in the underlying tables? Are they highly transactional (lots of writes/deletes)? Are the failing questions consistently failing or do they sometimes work?

@oreststetsiak Do you have the full stack trace, as was pasted in OP?

oreststetsiak on (2024-08-30 19:09:21 UTC): Hi @snoe !
thanks!
not sure how many rows exist in underlying tables unfortunately,
i dont think its hightly transactional in terms of write and deletes, it just reports that mainly query database.
Its failing consistently, in the same time, similar report, that returns data works 100% of the time.
stackstrace (data is blured, but you can get an idea, sql query is big, yes)
```

{:database_id 138,
 :via
 [{:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error ""Error reducing result rows: null"",
   :stacktrace
   [""--> query_processor.pipeline$_STAR_reduce_STAR_$fn__56763.invoke(pipeline.clj:74)""
    ""query_processor.pipeline$_STAR_reduce_STAR_.invokeStatic(pipeline.clj:62)""
    ""query_processor.pipeline$_STAR_reduce_STAR_.invoke(pipeline.clj:49)""
    ""query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70504$fn__70505.invoke(cache.clj:211)""
    ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)""
    ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""
    ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)""
    ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""
    ""query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70504.invoke(cache.clj:207)""
    ""query_processor.pipeline$_STAR_run_STAR_$respond__56775.invoke(pipeline.clj:95)""
    ""driver.bigquery_cloud_sdk$post_process_native.invokeStatic(bigquery_cloud_sdk.clj:500)""
    ""driver.bigquery_cloud_sdk$post_process_native.invoke(bigquery_cloud_sdk.clj:483)""
    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_$thunk__127208.invoke(bigquery_cloud_sdk.clj:516)""
    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invokeStatic(bigquery_cloud_sdk.clj:529)""
    ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invoke(bigquery_cloud_sdk.clj:506)""
    ""driver.bigquery_cloud_sdk$fn__127226.invokeStatic(bigquery_cloud_sdk.clj:545)""
    ""driver.bigquery_cloud_sdk$fn__127226.invoke(bigquery_cloud_sdk.clj:537)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)""
    ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)""
    ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)""
    ""query_processor.execute$run.invokeStatic(execute.clj:60)""
    ""query_processor.execute$run.invoke(execute.clj:54)""
    ""query_processor.middleware.update_used_cards$update_used_cards_BANG_$fn__70545.invoke(update_used_cards.clj:58)""
    ""query_processor.execute$add_native_form_to_result_metadata$fn__70560.invoke(execute.clj:23)""
    ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__70565.invoke(execute.clj:34)""
    ""query_processor.middleware.cache$run_query_with_cache.invokeStatic(cache.clj:212)""
    ""query_processor.middleware.cache$run_query_with_cache.invoke(cache.clj:185)""
    ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___70518.invoke(cache.clj:238)""
    ""query_processor.middleware.permissions$check_query_permissions$fn__64002.invoke(permissions.clj:119)""
    ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64612.invoke(enterprise.clj:51)""
    ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64622.invoke(enterprise.clj:64)""
    ""query_processor.execute$execute$fn__70592.invoke(execute.clj:92)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor.execute$execute.invokeStatic(execute.clj:91)""
    ""query_processor.execute$execute.invoke(execute.clj:87)""
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)""
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
    ""query_processor.middleware.enterprise$fn__64639$handle_audit_app_internal_queries__64640$fn__64642.invoke(enterprise.clj:96)""
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__64650.invoke(enterprise.clj:103)""
    ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76333.invoke(process_userland_query.clj:198)""
    ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__76402.invoke(catch_exceptions.clj:128)""
    ""query_processor$process_query$fn__76439.invoke(query_processor.clj:78)""
    ""query_processor.setup$do_with_canceled_chan$fn__65054.invoke(setup.clj:189)""
    ""query_processor.setup$do_with_database_local_settings$fn__65049.invoke(setup.clj:181)""
    ""query_processor.setup$do_with_driver$fn__65044$fn__65045.invoke(setup.clj:166)""
    ""driver$do_with_driver.invokeStatic(driver.clj:104)""
    ""driver$do_with_driver.invoke(driver.clj:99)""
    ""query_processor.setup$do_with_driver$fn__65044.invoke(setup.clj:165)""
    ""query_processor.setup$do_with_metadata_provider$fn__65037$fn__65040.invoke(setup.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:170)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:159)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""
    ""query_processor.setup$do_with_metadata_provider$fn__65037.invoke(setup.clj:150)""
    ""query_processor.setup$do_with_resolved_database$fn__65031.invoke(setup.clj:128)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
    ""query_processor$process_query.invoke(query_processor.clj:69)""
    ""query_processor.card$process_query_for_card_default_qp.invokeStatic(card.clj:170)""
    ""query_processor.card$process_query_for_card_default_qp.invoke(card.clj:166)""
    ""query_processor.card$process_query_for_card_default_run_fn$fn__82333$fn__82334.invoke(card.clj:177)""
    ""query_processor.streaming$_streaming_response$fn__68548$fn__68549$fn__68550.invoke(streaming.clj:175)""
    ""query_processor.streaming$_streaming_response$fn__68548$fn__68549.invoke(streaming.clj:174)""
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
    ""query_processor.streaming$_streaming_response$fn__68548.invoke(streaming.clj:171)""
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""
    ""async.streaming_response$do_f_async$task__51863.invoke(streaming_response.clj:87)""],
   :error_type :qp,
   :ex-data {:type :qp}}],
 :action_id nil,
 :error_type :qp,
 :json_query
 {:constraints {:max-results 10000, :max-results-bare-rows 2000},
  :type :query,
  :middleware
  {:js-int-to-string? true, :ignore-cached-results? false, :process-viz-settings? false, :userland-query? true},
  :cache-strategy {:multiplier 10, :min_duration_ms 10, :type :ttl, :avg-execution-ms 17580},
  :viz-settings
  {:table.pivot_column ""qweqwe_id"",
   :table.cell_column ""qweqwe"",
   :column_settings
   {""[\""ref\"",[\""field\"",600635,null]]"" {:column_title ""qweqwe Created Date UTC""},
    ""[\""ref\"",[\""field\"",600706,null]]"" {:column_title ""qweqwe Updated Date UTC""},
    ""[\""ref\"",[\""field\"",600632,null]]"" {:column_title ""qweqwe Created Date UTC""},
    ""[\""ref\"",[\""field\"",600661,null]]"" {:column_title ""qweqwe Start Date UTC""},
    ""[\""ref\"",[\""field\"",600628,null]]"" {:column_title ""qweqwe End Date UTC""},
    ""[\""ref\"",[\""field\"",600649,null]]"" {:column_title ""qweqwe Initial End Date UTC""},
    ""[\""ref\"",[\""field\"",600712,null]]"" {:column_title ""qweqwe Updated Date UTC""},
    ""[\""ref\"",[\""field\"",600693,null]]"" {:column_title ""qweqwe Canceled Date UTC""}}},
  :database 138,
  :query
  {:source-table 92317,
   :order-by [[:desc [:field 600666 {:base-type :type/DateTime}]]],
   :expressions
   {""qweqwe Detail Link""
    [:concat ""https://qweqwe.qwe/sell/qweqwe/qweqwes/"" [:field 600718 nil] ""/details""]},
   :filter
   [:and
    [:= [:field 600686 nil] ""QWEQWE qweqwe""]
    [:= [:field 600640 nil] 0]
    [:= [:field 600620 nil] false]
    [:time-interval [:field 600666 nil] -1 :day {:include-current false}]
    [:!= [:field 600707 nil] ""DRAFT""]]},
  :parameters []},
 :native
 {:query
  ""SELECT `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`original_id` AS `original_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`seller_name` AS `seller_name`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_date` AS `qweqwe_created_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_date_pacific` AS `qweqwe_created_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_updated_date` AS `qweqwe_updated_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_updated_date_pacific` AS `qweqwe_updated_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe1` AS `qweqwe1`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe2` AS `qweqwe2`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`city` AS `city`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_code` AS `qweqwe_code`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwe` AS `qwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_title` AS `qweqwe_title`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_description` AS `qweqwe_description`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe_local` AS `qwewqe_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe_usd` AS `qwewqe_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_currency_code` AS `qweqwe_currency_code`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_local` AS `qweqwe_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_usd` AS `qweqwe_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_local` AS `qweqwe_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_usd` AS `qweqwe_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_fee_local` AS `qweqwe_fee_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_fee_usd` AS `qweqwe_fee_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_breakdown` AS `qweqwe_breakdown`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`condition_quantity_breakdown` AS `condition_quantity_breakdown`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`manual_category` AS `manual_category`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`manual_item_condition` AS `manual_item_condition`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`manual_package_condition` AS `manual_package_condition`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`shipping_service_type` AS `shipping_service_type`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`pallet_ids` AS `pallet_ids`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`shipping_notes_pallet_count` AS `shipping_notes_pallet_count`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`title_pallet_count` AS `title_pallet_count`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`shipping_notes_pallet_spaces` AS `shipping_notes_pallet_spaces`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe` AS `qwewqe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_depth` AS `max_depth`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_width` AS `max_width`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_height` AS `max_height`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`weight` AS `weight`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`shipping_note` AS `shipping_note`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`inventory_source` AS `inventory_source`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe` AS `qwewqe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`cosmetic_condition` AS `cosmetic_condition`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`accessories` AS `accessories`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qwewqe` AS `qwewqe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe` AS `qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`attributes_carrier` AS `attributes_carrier`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`functionality` AS `functionality`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`attributes_capacity` AS `attributes_capacity`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`custom_attributes` AS `custom_attributes`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`country_of_origin` AS `country_of_origin`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`min_expiration_date` AS `min_expiration_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`attributes_brand_name` AS `attributes_brand_name`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`attributes_is_locked` AS `attributes_is_locked`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_by` AS `qweqwe_created_by`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_status` AS `qweqwe_status`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`cancellation_reason` AS `cancellation_reason`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`lot_status` AS `lot_status`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id` AS `qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`order_id` AS `order_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_date` AS `qweqwe_created_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_created_date_pacific` AS `qweqwe_created_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_start_date` AS `qweqwe_start_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_start_date_pacific` AS `qweqwe_start_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_end_date` AS `qweqwe_end_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_end_date_pacific` AS `qweqwe_end_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_initial_end_date` AS `qweqwe_initial_end_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_initial_end_date_pacific` AS `qweqwe_initial_end_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_updated_date` AS `qweqwe_updated_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_updated_date_pacific` AS `qweqwe_updated_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`start_price_local` AS `start_price_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`start_price_usd` AS `start_price_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`number_of_qweqweqwes` AS `number_of_qweqweqwes`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`canceled_qweqweqwes` AS `canceled_qweqweqwes`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqweqweders` AS `qweqweqweders`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`winning_qweqweqwe_amount_local` AS `winning_qweqweqwe_amount_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`winning_qweqweqwe_amount_usd` AS `winning_qweqweqwe_amount_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_qweqweqwe_amount_local` AS `max_qweqweqwe_amount_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`max_qweqweqwe_amount_usd` AS `max_qweqweqwe_amount_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_canceled` AS `qweqwe_is_canceled`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_canceled_date` AS `qweqwe_canceled_date`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_canceled_date_pacific` AS `qweqwe_canceled_date_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_closed` AS `qweqwe_is_closed`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_private` AS `qweqwe_is_private`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`view_count` AS `view_count`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_type` AS `qweqwe_type`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_relist` AS `qweqwe_is_relist`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`total_qweqwe` AS `total_qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_id` AS `prior_qweqwe_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_end_time` AS `prior_qweqwe_end_time`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_end_time_pacific` AS `prior_qweqwe_end_time_pacific`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_start_price_local` AS `prior_start_price_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_start_price_usd` AS `prior_start_price_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_gmv_local` AS `prior_qweqwe_gmv_local`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_gmv_usd` AS `prior_qweqwe_gmv_usd`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_is_sold_uncanceled` AS `prior_qweqwe_is_sold_uncanceled`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_is_qweqwe` AS `prior_qweqwe_is_qweqwe`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_is_unsold` AS `prior_qweqwe_is_unsold`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`prior_qweqwe_is_canceled` AS `prior_qweqwe_is_canceled`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`running_relist_count` AS `running_relist_count`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`is_relisted_with_lowered_start_price` AS `is_relisted_with_lowered_start_price`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`storefront_id` AS `storefront_id`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`storefront_name` AS `storefront_name`, `qweqwe.qweqwe_qweqweqweqwedata_source`.`is_live_qweqwe` AS `is_live_qweqwe`, CONCAT(?, `qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_id`, ?) AS `qweqwe_Detail_Link` FROM `qweqwe.qweqwe_qweqweqweqwedata_source` WHERE (`qweqwe.qweqwe_qweqweqweqwedata_source`.`seller_name` = ?) AND (`qweqwe.qweqwe_qweqweqweqwedata_source`.`number_of_qweqweqwes` = 0) AND (`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_is_canceled` = FALSE) AND (`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_end_date_pacific` >= DATETIME_TRUNC(DATETIME_ADD(CURRENT_DATETIME('UTC'), INTERVAL -1 day), day)) AND (`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_end_date_pacific` < DATETIME_TRUNC(CURRENT_DATETIME('UTC'), day)) AND ((`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_status` <> ?) OR (`qweqwe.qweqwe_qweqweqweqwedata_source`.`qweqwe_status` IS NULL)) ORDER BY `qweqwe_end_date_pacific` DESC LIMIT 2000"",
  :params (""https://qweqwe.qwe/sell/qweqwe/qweqwes/"" ""/details"" ""QWEQWE qweqwe"" ""DRAFT""),
  :table-name ""qweqwe_qweqweqweqwedata_source"",
  :mbql? true},
 :status :failed,
 :class java.lang.NullPointerException,
 :stacktrace
 [""--> driver.bigquery_cloud_sdk$values_iterator.invokeStatic(bigquery_cloud_sdk.clj:70)""
  ""driver.bigquery_cloud_sdk$values_iterator.invoke(bigquery_cloud_sdk.clj:69)""
  ""driver.bigquery_cloud_sdk$reducible_bigquery_results$reify__126465.reduce(bigquery_cloud_sdk.clj:111)""
  ""query_processor.pipeline$_STAR_reduce_STAR_$fn__56763.invoke(pipeline.clj:63)""
  ""query_processor.pipeline$_STAR_reduce_STAR_.invokeStatic(pipeline.clj:62)""
  ""query_processor.pipeline$_STAR_reduce_STAR_.invoke(pipeline.clj:49)""
  ""query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70504$fn__70505.invoke(cache.clj:211)""
  ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)""
  ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""
  ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)""
  ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""
  ""query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70504.invoke(cache.clj:207)""
  ""query_processor.pipeline$_STAR_run_STAR_$respond__56775.invoke(pipeline.clj:95)""
  ""driver.bigquery_cloud_sdk$post_process_native.invokeStatic(bigquery_cloud_sdk.clj:500)""
  ""driver.bigquery_cloud_sdk$post_process_native.invoke(bigquery_cloud_sdk.clj:483)""
  ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_$thunk__127208.invoke(bigquery_cloud_sdk.clj:516)""
  ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invokeStatic(bigquery_cloud_sdk.clj:529)""
  ""driver.bigquery_cloud_sdk$_STAR_process_native_STAR_.invoke(bigquery_cloud_sdk.clj:506)""
  ""driver.bigquery_cloud_sdk$fn__127226.invokeStatic(bigquery_cloud_sdk.clj:545)""
  ""driver.bigquery_cloud_sdk$fn__127226.invoke(bigquery_cloud_sdk.clj:537)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)""
  ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)""
  ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)""
  ""query_processor.execute$run.invokeStatic(execute.clj:60)""
  ""query_processor.execute$run.invoke(execute.clj:54)""
  ""query_processor.middleware.update_used_cards$update_used_cards_BANG_$fn__70545.invoke(update_used_cards.clj:58)""
  ""query_processor.execute$add_native_form_to_result_metadata$fn__70560.invoke(execute.clj:23)""
  ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__70565.invoke(execute.clj:34)""
  ""query_processor.middleware.cache$run_query_with_cache.invokeStatic(cache.clj:212)""
  ""query_processor.middleware.cache$run_query_with_cache.invoke(cache.clj:185)""
  ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___70518.invoke(cache.clj:238)""
  ""query_processor.middleware.permissions$check_query_permissions$fn__64002.invoke(permissions.clj:119)""
  ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64612.invoke(enterprise.clj:51)""
  ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64622.invoke(enterprise.clj:64)""
  ""query_processor.execute$execute$fn__70592.invoke(execute.clj:92)""
  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
  ""query_processor.execute$execute.invokeStatic(execute.clj:91)""
  ""query_processor.execute$execute.invoke(execute.clj:87)""
  ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)""
  ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
  ""query_processor.middleware.enterprise$fn__64639$handle_audit_app_internal_queries__64640$fn__64642.invoke(enterprise.clj:96)""
  ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__64650.invoke(enterprise.clj:103)""
  ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76333.invoke(process_userland_query.clj:198)""
  ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__76402.invoke(catch_exceptions.clj:128)""
  ""query_processor$process_query$fn__76439.invoke(query_processor.clj:78)""
  ""query_processor.setup$do_with_canceled_chan$fn__65054.invoke(setup.clj:189)""
  ""query_processor.setup$do_with_database_local_settings$fn__65049.invoke(setup.clj:181)""
  ""query_processor.setup$do_with_driver$fn__65044$fn__65045.invoke(setup.clj:166)""
  ""driver$do_with_driver.invokeStatic(driver.clj:104)""
  ""driver$do_with_driver.invoke(driver.clj:99)""
  ""query_processor.setup$do_with_driver$fn__65044.invoke(setup.clj:165)""
  ""query_processor.setup$do_with_metadata_provider$fn__65037$fn__65040.invoke(setup.clj:151)""
  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:170)""
  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""
  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:159)""
  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:150)""
  ""query_processor.setup$do_with_metadata_provider$fn__65037.invoke(setup.clj:150)""
  ""query_processor.setup$do_with_resolved_database$fn__65031.invoke(setup.clj:128)""
  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
  ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
  ""query_processor$process_query.invoke(query_processor.clj:69)""
  ""query_processor.card$process_query_for_card_default_qp.invokeStatic(card.clj:170)""
  ""query_processor.card$process_query_for_card_default_qp.invoke(card.clj:166)""
  ""query_processor.card$process_query_for_card_default_run_fn$fn__82333$fn__82334.invoke(card.clj:177)""
  ""query_processor.streaming$_streaming_response$fn__68548$fn__68549$fn__68550.invoke(streaming.clj:175)""
  ""query_processor.streaming$_streaming_response$fn__68548$fn__68549.invoke(streaming.clj:174)""
  ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
  ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
  ""query_processor.streaming$_streaming_response$fn__68548.invoke(streaming.clj:171)""
  ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""
  ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""
  ""async.streaming_response$do_f_async$task__51863.invoke(streaming_response.clj:87)""],
 :card_id 8710,
 :context :question,
 :error nil,
 :row_count 0,
 :running_time 0,
 :preprocessed
 {:constraints {:max-results 10000, :max-results-bare-rows 2000},
  :middleware
  {:js-int-to-string? true, :ignore-cached-results? false, :process-viz-settings? false, :userland-query? true},
  :cache-strategy {:multiplier 10, :min-duration-ms 10, :type :ttl, :avg-execution-ms 17580},
  :viz-settings
  {:table.pivot_column ""qweqwe_id"",
   :table.cell_column ""qweqwe"",
   :column_settings
   {""[\""ref\"",[\""field\"",600635,null]]"" {:column_title ""qweqwe Created Date UTC""},
    ""[\""ref\"",[\""field\"",600706,null]]"" {:column_title ""qweqwe Updated Date UTC""},
    ""[\""ref\"",[\""field\"",600632,null]]"" {:column_title ""qweqwe Created Date UTC""},
    ""[\""ref\"",[\""field\"",600661,null]]"" {:column_title ""qweqwe Start Date UTC""},
    ""[\""ref\"",[\""field\"",600628,null]]"" {:column_title ""qweqwe End Date UTC""},
    ""[\""ref\"",[\""field\"",600649,null]]"" {:column_title ""qweqwe Initial End Date UTC""},
    ""[\""ref\"",[\""field\"",600712,null]]"" {:column_title ""qweqwe Updated Date UTC""},
    ""[\""ref\"",[\""field\"",600693,null]]"" {:column_title ""qweqwe Canceled Date UTC""}}},
  :info
  {:executed-by 721,
   :context :question,
   :card-id 8710,
   :card-name ""Alerts - QWEQWE"",
   :visualization-settings
   {:table.pivot_column ""qweqwe_id"",
    :table.cell_column ""qweqwe"",
    :column_settings
    {""[\""ref\"",[\""field\"",600635,null]]"" {:column_title ""qweqwe Created Date UTC""},
     ""[\""ref\"",[\""field\"",600706,null]]"" {:column_title ""qweqwe Updated Date UTC""},
     ""[\""ref\"",[\""field\"",600632,null]]"" {:column_title ""qweqwe Created Date UTC""},
     ""[\""ref\"",[\""field\"",600661,null]]"" {:column_title ""qweqwe Start Date UTC""},
     ""[\""ref\"",[\""field\"",600628,null]]"" {:column_title ""qweqwe End Date UTC""},
     ""[\""ref\"",[\""field\"",600649,null]]"" {:column_title ""qweqwe Initial End Date UTC""},
     ""[\""ref\"",[\""field\"",600712,null]]"" {:column_title ""qweqwe Updated Date UTC""},
     ""[\""ref\"",[\""field\"",600693,null]]"" {:column_title ""qweqwe Canceled Date UTC""}}}},
  :database 138,
  :type :query,
  :query
  {:source-table 92317,
   :order-by [[:desc [:field 600666 {:base-type :type/DateTime, :temporal-unit :default}]]],
   :expressions
   {""qweqwe Detail Link""
    [:concat ""https://qweqwe.qwe/sell/qweqwe/qweqwes/"" [:field 600718 nil] ""/details""]},
   :filter
   [:and
    [:=
     [:field 600686 nil]
     [:value
      ""QWEQWE qweqwe""
      {:base_type :type/Text,
       :effective_type :type/Text,
       :coercion_strategy nil,
       :semantic_type :type/Category,
       :database_type ""STRING"",
       :name ""seller_name""}]]
    [:=
     [:field 600640 nil]
     [:value
      0
      {:base_type :type/Decimal,
       :effective_type :type/Decimal,
       :coercion_strategy nil,
       :semantic_type nil,
       :database_type ""NUMERIC"",
       :name ""number_of_qweqweqwes""}]]
    [:=
     [:field 600620 nil]
     [:value
      false
      {:base_type :type/Boolean,
       :effective_type :type/Boolean,
       :coercion_strategy nil,
       :semantic_type :type/Category,
       :database_type ""BOOLEAN"",
       :name ""qweqwe_is_canceled""}]]
    [:>= [:field 600666 {:temporal-unit :default}] [:relative-datetime -1 :day]]
    [:< [:field 600666 {:temporal-unit :default}] [:relative-datetime 0 :day]]
    [:!=
     [:field 600707 nil]
     [:value
      ""DRAFT""
      {:base_type :type/Text,
       :effective_type :type/Text,
       :coercion_strategy nil,
       :semantic_type :type/Category,
       :database_type ""STRING"",
       :name ""qweqwe_status""}]]],
   :fields
   [[:field 600718 nil]
    [:field 600631 nil]
    [:field 600629 nil]
    [:field 600686 nil]
    [:field 600691 nil]
    [:field 600635 {:temporal-unit :default}]
    [:field 600669 {:temporal-unit :default}]
    [:field 600706 {:temporal-unit :default}]
    [:field 600638 {:temporal-unit :default}]
    [:field 600690 nil]
    [:field 600796 nil]
    [:field 600795 nil]
    [:field 600617 nil]
    [:field 600655 nil]
    [:field 600618 nil]
    [:field 600659 nil]
    [:field 600651 nil]
    [:field 600704 nil]
    [:field 600688 nil]
    [:field 600615 nil]
    [:field 600660 nil]
    [:field 600644 nil]
    [:field 600687 nil]
    [:field 600619 nil]
    [:field 600675 nil]
    [:field 600679 nil]
    [:field 600664 nil]
    [:field 600671 nil]
    [:field 600681 nil]
    [:field 600719 nil]
    [:field 600680 nil]
    [:field 600663 nil]
    [:field 614441 nil]
    [:field 614439 nil]
    [:field 614440 nil]
    [:field 600684 nil]
    [:field 600654 nil]
    [:field 600702 nil]
    [:field 600636 nil]
    [:field 600624 nil]
    [:field 600627 nil]
    [:field 600616 nil]
    [:field 600642 nil]
    [:field 600637 nil]
    [:field 600650 nil]
    [:field 600626 nil]
    [:field 600665 nil]
    [:field 614442 nil]
    [:field 600656 nil]
    [:field 600689 nil]
    [:field 600670 nil]
    [:field 600699 nil]
    [:field 600696 nil]
    [:field 600622 nil]
    [:field 600682 nil]
    [:field 600685 nil]
    [:field 600692 nil]
    [:field 600621 nil]
    [:field 600643 nil]
    [:field 600710 nil]
    [:field 600641 {:temporal-unit :default}]
    [:field 600720 nil]
    [:field 600657 nil]
    [:field 600695 nil]
    [:field 600707 nil]
    [:field 600713 nil]
    [:field 600634 nil]
    [:field 600668 nil]
    [:field 600717 nil]
    [:field 600632 {:temporal-unit :default}]
    [:field 600714 {:temporal-unit :default}]
    [:field 600661 {:temporal-unit :default}]
    [:field 600705 {:temporal-unit :default}]
    [:field 600628 {:temporal-unit :default}]
    [:field 600666 {:temporal-unit :default}]
    [:field 600649 {:temporal-unit :default}]
    [:field 600711 {:temporal-unit :default}]
    [:field 600712 {:temporal-unit :default}]
    [:field 600658 {:temporal-unit :default}]
    [:field 600708 nil]
    [:field 600716 nil]
    [:field 600640 nil]
    [:field 600709 nil]
    [:field 600623 nil]
    [:field 600662 nil]
    [:field 600652 nil]
    [:field 600683 nil]
    [:field 600630 nil]
    [:field 600620 nil]
    [:field 600693 {:temporal-unit :default}]
    [:field 600667 {:temporal-unit :default}]
    [:field 600677 nil]
    [:field 600676 nil]
    [:field 600625 nil]
    [:field 600647 nil]
    [:field 600698 nil]
    [:field 600639 nil]
    [:field 600646 nil]
    [:field 600674 {:temporal-unit :default}]
    [:field 600633 {:temporal-unit :default}]
    [:field 600694 nil]
    [:field 600697 nil]
    [:field 600648 nil]
    [:field 600700 nil]
    [:field 600703 nil]
    [:field 600715 nil]
    [:field 600678 nil]
    [:field 600653 nil]
    [:field 600701 nil]
    [:field 600645 nil]
    [:field 600673 nil]
    [:field 600672 nil]
    [:field 1173262 nil]
    [:expression ""qweqwe Detail Link""]],
   :limit 2000,
   :metabase.query-processor.middleware.limit/original-limit nil}},
 :data {:rows [], :cols []}}
GET2001.92 KB10 msChrome 128 https://metabase.qweqwe.com/api/database/138 

```

mario-deriv (Issue Creator) on (2024-09-03 06:40:35 UTC): Hi @snoe  


The external table has 60k+ rows, the base table has 2M+ rows


The external table, no. The base table has lots of writes/updates, but no deletes.


They consistently fail

oreststetsiak on (2024-09-09 23:21:10 UTC): still a case for me with v0.50.24.4, what about you @mario-deriv ?

paoliniluis on (2024-09-16 16:24:40 UTC): @oreststetsiak can you check the latest 50.25?

oreststetsiak on (2024-09-16 22:25:57 UTC): Hi @paoliniluis !
just deployed [v0.50.25.3]
issue still persists, even though, introduced new problems with different reports,
had to rollback

paoliniluis on (2024-09-18 12:25:21 UTC): @oreststetsiak can you create a new issue? we have a customer that's reporting something similar to this so it might be the same issue

oreststetsiak on (2024-09-18 20:44:10 UTC): @paoliniluis i created a [new ticket](https://github.com/metabase/metabase/issues/48010), just in case you curious
it is different,
i see the current issue has completely gone with [v0.50.26.1], i see a pretty message ""No results!"" and no errors, thank you!

mario-deriv (Issue Creator) on (2024-09-20 04:39:39 UTC): I can confirm that the issue is fixed in [0.50.26](https://github.com/metabase/metabase/milestone/271), queries return `No results!` instead of `Error running query` . Thank you for fixing  this @snoe !

"
2491480993,issue,closed,completed,CSV export does not download all the data,"### Describe the bug

In the old version, it was fully downloaded when I downloaded the data from a table. Now it is only downloading the first 2000 rows.
How can I download the full data.

### To Reproduce

1. Go to a dashboard table and download the results

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
v0.50.22
```


### Severity

Annoying

### Additional context

_No response_",jatorna,2024-08-28 08:53:06+00:00,[],2024-09-01 10:50:54+00:00,2024-09-01 10:50:37+00:00,https://github.com/metabase/metabase/issues/47338,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Export', ''), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2323283606, 'issue_id': 2491480993, 'author': 'jatorna', 'body': 'My fault, I have a limit in the SQL query.\r\nIt is working fine.', 'created_at': datetime.datetime(2024, 9, 1, 10, 50, 47, tzinfo=datetime.timezone.utc)}]","jatorna (Issue Creator) on (2024-09-01 10:50:47 UTC): My fault, I have a limit in the SQL query.
It is working fine.

"
2491455300,issue,open,,Metadata from table not found error,"**Describe the bug**
When using the table from a Redshift database (from Pennylane) (in a schema), whether I join it to another table, or I use it to join to another one, I have an error : ""Échec de la recherche de :metadata/table 218 : soit il n'existe pas, soit il appartient à une autre base de données."".

**Logs**
```[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:30:35+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 132.2 µs (0 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:30:50+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 211.4 µs (0 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:05+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 177.7 µs (0 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:18+02:00 DEBUG metabase.server.middleware.log POST /api/dataset/query_metadata 200 166.6 ms (13 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (3 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:19+02:00 DEBUG metabase.server.middleware.log POST /api/dataset/query_metadata 200 84.3 ms (11 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:20+02:00 DEBUG metabase.server.middleware.log GET /api/activity/recent_views 200 27.0 ms (8 appels de DB) Connexions App DB : 2/15 Threads Jetty : 6/50 (1 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:20+02:00 DEBUG metabase.server.middleware.log GET /api/database 200 39.1 ms (1 appels de DB) Connexions App DB : 4/15 Threads Jetty : 6/50 (0 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:20+02:00 DEBUG metabase.server.middleware.log GET /api/database/2/schemas 200 57.2 ms (2 appels de DB) Connexions App DB : 2/15 Threads Jetty : 5/50 (1 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:20+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 115.4 µs (0 appels de DB) Connexions App DB : 1/15 Threads Jetty : 5/50 (2 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:20+02:00 DEBUG metabase.server.middleware.log GET /api/database/2/schema/ 200 181.4 ms (4 appels de DB) Connexions App DB : 1/15 Threads Jetty : 4/50 (2 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:21+02:00 DEBUG metabase.server.middleware.log GET /api/search 200 219.7 ms (5 appels de DB) Connexions App DB : 0/15 Threads Jetty : 4/50 (2 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:22+02:00 DEBUG metabase.server.middleware.log GET /api/database/3/schemas 200 6.9 ms (2 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:24+02:00 DEBUG metabase.server.middleware.log GET /api/database/3/schema/pennylane 200 7.8 ms (2 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:29+02:00 DEBUG metabase.server.middleware.log GET /api/activity/recent_views 200 24.9 ms (8 appels de DB) Connexions App DB : 1/15 Threads Jetty : 4/50 (3 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:29+02:00 DEBUG metabase.server.middleware.log GET /api/search 200 133.1 ms (5 appels de DB) Connexions App DB : 1/15 Threads Jetty : 3/50 (3 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:36+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 134.6 µs (0 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:37+02:00 DEBUG metabase.server.middleware.log GET /api/activity/recent_views 200 13.5 ms (8 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:41+02:00 DEBUG metabase.server.middleware.log GET /api/table/394/query_metadata 200 36.7 ms (8 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:41+02:00 DEBUG metabase.server.middleware.log POST /api/dataset/query_metadata 200 67.1 ms (11 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:45+02:00 DEBUG metabase.server.middleware.log GET /api/activity/recent_views 200 33.8 ms (8 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:49+02:00 DEBUG metabase.server.middleware.log GET /api/collection/1 200 10.3 ms (4 appels de DB) Connexions App DB : 1/15 Threads Jetty : 6/50 (0 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:49+02:00 DEBUG metabase.server.middleware.log GET /api/collection/root 200 14.8 ms (2 appels de DB) Connexions App DB : 2/15 Threads Jetty : 5/50 (1 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:49+02:00 DEBUG metabase.server.middleware.log GET /api/collection/1/items 200 14.9 ms (5 appels de DB) Connexions App DB : 1/15 Threads Jetty : 4/50 (2 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:49+02:00 DEBUG metabase.server.middleware.log GET /api/collection/root/items 200 49.0 ms (7 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (3 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:51+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 117.0 µs (0 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:59+02:00 DEBUG metabase.server.middleware.log GET /api/database/1/schemas 200 9.2 ms (2 appels de DB) Connexions App DB : 0/15 Threads Jetty : 4/50 (3 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:31:59+02:00 DEBUG metabase.server.middleware.log GET /api/database/1/schema/PUBLIC 200 6.6 ms (2 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:03+02:00 DEBUG metabase.server.middleware.log GET /api/database/3/schema/etl 200 7.7 ms (2 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:06+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 119.5 µs (0 appels de DB) Connexions App DB : 1/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:17+02:00 DEBUG metabase.server.middleware.log GET /api/activity/recent_views 200 20.2 ms (8 appels de DB) Connexions App DB : 0/15 Threads Jetty : 4/50 (3 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:17+02:00 DEBUG metabase.server.middleware.log GET /api/search 200 42.3 ms (4 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (3 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:21+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 201.3 µs (0 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:22+02:00 DEBUG metabase.server.middleware.log GET /api/table/218/query_metadata 200 29.4 ms (8 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:36+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 132.4 µs (0 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:38+02:00 DEBUG metabase.server.middleware.log POST /api/dataset/query_metadata 200 72.7 ms (14 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:50+02:00 ERROR metabase.query-processor.middleware.catch-exceptions Error processing query: Échec de la recherche de :metadata/table 218 : soit il n'existe pas, soit il appartient à une autre base de données.
{:database_id 3,
 :started_at #t ""2024-08-28T08:32:50.657174Z[GMT]"",
 :via
 [{:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error
   ""Erreur de prétraitement de la requête dans metabase.query_processor.preprocess$ensure_pmbql$fn__65474@ddfb34a : Échec de la recherche de :metadata/table 218 : soit il n'existe pas, soit il appartient à une autre base de données."",
   :stacktrace
   [""--> query_processor.preprocess$preprocess$fn__65478$fn__65479.invoke(preprocess.clj:133)""
    ""query_processor.preprocess$preprocess$fn__65478.invoke(preprocess.clj:119)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor.preprocess$preprocess.invokeStatic(preprocess.clj:118)""
    ""query_processor.preprocess$preprocess.invoke(preprocess.clj:114)""
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:44)""
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
    ""query_processor.middleware.enterprise$fn__64570$handle_audit_app_internal_queries__64571$fn__64573.invoke(enterprise.clj:96)""
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__64581.invoke(enterprise.clj:103)""
    ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__75769.invoke(process_userland_query.clj:186)""
    ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__75838.invoke(catch_exceptions.clj:128)""
    ""query_processor$process_query$fn__75875.invoke(query_processor.clj:78)""
    ""query_processor.setup$do_with_canceled_chan$fn__64985.invoke(setup.clj:189)""
    ""query_processor.setup$do_with_database_local_settings$fn__64980.invoke(setup.clj:181)""
    ""query_processor.setup$do_with_driver$fn__64975$fn__64976.invoke(setup.clj:166)""
    ""driver$do_with_driver.invokeStatic(driver.clj:104)""
    ""driver$do_with_driver.invoke(driver.clj:99)""
    ""query_processor.setup$do_with_driver$fn__64975.invoke(setup.clj:165)""
    ""query_processor.setup$do_with_metadata_provider$fn__64968$fn__64971.invoke(setup.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:171)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:160)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
    ""query_processor.setup$do_with_metadata_provider$fn__64968.invoke(setup.clj:150)""
    ""query_processor.setup$do_with_resolved_database$fn__64962.invoke(setup.clj:128)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
    ""query_processor$process_query.invoke(query_processor.clj:69)""
    ""api.dataset$run_streaming_query$fn__97646.invoke(dataset.clj:84)""
    ""query_processor.streaming$_streaming_response$fn__68438$fn__68439$fn__68440.invoke(streaming.clj:175)""
    ""query_processor.streaming$_streaming_response$fn__68438$fn__68439.invoke(streaming.clj:174)""
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
    ""query_processor.streaming$_streaming_response$fn__68438.invoke(streaming.clj:171)""
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""
    ""async.streaming_response$do_f_async$task__52249.invoke(streaming_response.clj:87)""],
   :error_type :qp,
   :ex-data
   {:fn
    #object[metabase.query_processor.preprocess$ensure_pmbql$fn__65474 0xddfb34a ""metabase.query_processor.preprocess$ensure_pmbql$fn__65474@ddfb34a""],
    :query
    {:database 3,
     :middleware {:js-int-to-string? true, :userland-query? true, :add-default-userland-constraints? true},
     :info {:executed-by 1, :context :ad-hoc, :query-hash #object[""[B"" 0x4931d06 ""[B@4931d06""]},
     :constraints {:max-results 10000, :max-results-bare-rows 2000},
     :type :query,
     :query
     {:source-table 394,
      :joins
      [{:fields :all,
        :strategy :inner-join,
        :alias ""llx_entrepot - tag_label"",
        :condition
        [:=
         [:field 5235 {:base-type :type/Text}]
         [:field 2874 {:base-type :type/Text, :join-alias ""llx_entrepot - tag_label""}]],
        :source-table 218}],
      :limit 10}},
    :type :qp}}],
 :action_id nil,
 :error_type :qp,
 :json_query
 {:database 3,
  :type ""query"",
  :query
  {:source-table 394,
   :joins
   [{:fields ""all"",
     :strategy ""inner-join"",
     :alias ""llx_entrepot - tag_label"",
     :condition
     [""=""
      [""field"" 5235 {:base-type ""type/Text""}]
      [""field"" 2874 {:base-type ""type/Text"", :join-alias ""llx_entrepot - tag_label""}]],
     :source-table 218}],
   :limit 10},
  :parameters [],
  :middleware {:js-int-to-string? true, :userland-query? true, :add-default-userland-constraints? true}},
 :native nil,
 :status :failed,
 :class clojure.lang.ExceptionInfo,
 :stacktrace
 [""--> lib.metadata$missing_bulk_metadata_error.invokeStatic(metadata.cljc:188)""
  ""lib.metadata$missing_bulk_metadata_error.invoke(metadata.cljc:187)""
  ""lib.metadata$bulk_metadata_or_throw.invokeStatic(metadata.cljc:206)""
  ""lib.metadata$bulk_metadata_or_throw.invoke(metadata.cljc:195)""
  ""query_processor.middleware.resolve_source_table$resolve_source_tables.invokeStatic(resolve_source_table.clj:25)""
  ""query_processor.middleware.resolve_source_table$resolve_source_tables.invoke(resolve_source_table.clj:20)""
  ""query_processor.preprocess$ensure_pmbql$fn__65474.invoke(preprocess.clj:68)""
  ""query_processor.preprocess$preprocess$fn__65478$fn__65479.invoke(preprocess.clj:128)""
  ""query_processor.preprocess$preprocess$fn__65478.invoke(preprocess.clj:119)""
  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
  ""query_processor.preprocess$preprocess.invokeStatic(preprocess.clj:118)""
  ""query_processor.preprocess$preprocess.invoke(preprocess.clj:114)""
  ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:44)""
  ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
  ""query_processor.middleware.enterprise$fn__64570$handle_audit_app_internal_queries__64571$fn__64573.invoke(enterprise.clj:96)""
  ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__64581.invoke(enterprise.clj:103)""
  ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__75769.invoke(process_userland_query.clj:186)""
  ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__75838.invoke(catch_exceptions.clj:128)""
  ""query_processor$process_query$fn__75875.invoke(query_processor.clj:78)""
  ""query_processor.setup$do_with_canceled_chan$fn__64985.invoke(setup.clj:189)""
  ""query_processor.setup$do_with_database_local_settings$fn__64980.invoke(setup.clj:181)""
  ""query_processor.setup$do_with_driver$fn__64975$fn__64976.invoke(setup.clj:166)""
  ""driver$do_with_driver.invokeStatic(driver.clj:104)""
  ""driver$do_with_driver.invoke(driver.clj:99)""
  ""query_processor.setup$do_with_driver$fn__64975.invoke(setup.clj:165)""
  ""query_processor.setup$do_with_metadata_provider$fn__64968$fn__64971.invoke(setup.clj:151)""
  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:171)""
  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:160)""
  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
  ""query_processor.setup$do_with_metadata_provider$fn__64968.invoke(setup.clj:150)""
  ""query_processor.setup$do_with_resolved_database$fn__64962.invoke(setup.clj:128)""
  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
  ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
  ""query_processor$process_query.invoke(query_processor.clj:69)""
  ""api.dataset$run_streaming_query$fn__97646.invoke(dataset.clj:84)""
  ""query_processor.streaming$_streaming_response$fn__68438$fn__68439$fn__68440.invoke(streaming.clj:175)""
  ""query_processor.streaming$_streaming_response$fn__68438$fn__68439.invoke(streaming.clj:174)""
  ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
  ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
  ""query_processor.streaming$_streaming_response$fn__68438.invoke(streaming.clj:171)""
  ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""
  ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""
  ""async.streaming_response$do_f_async$task__52249.invoke(streaming_response.clj:87)""],
 :card_id nil,
 :context :ad-hoc,
 :error
 ""Échec de la recherche de :metadata/table 218 : soit il n'existe pas, soit il appartient à une autre base de données."",
 :row_count 0,
 :running_time 0,
 :preprocessed nil,
 :ex-data {:status-code 400, :metadata-type :metadata/table, :id 218},
 :data {:rows [], :cols []}}

[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:50+02:00 DEBUG metabase.server.middleware.log POST /api/dataset 202 [ASYNC: completed] 88.2 ms (29 appels de DB) Connexions App DB : 0/15 Threads Jetty : 2/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:32:51+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 187.3 µs (0 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (107 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:33:06+02:00 DEBUG metabase.server.middleware.log HEAD /api/health 200 269.3 µs (0 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (106 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id nil}
[f4f2d67c-a5c0-47c5-9352-219e2a6932cd] 2024-08-28T10:33:17+02:00 DEBUG metabase.server.middleware.log GET /api/util/bug_report_details 200 8.4 ms (1 appels de DB) Connexions App DB : 0/15 Threads Jetty : 3/50 (4 inactif, 0 en file d'attente) (106 total de threads actifs) Requêtes en cours : 0 (0 en file d'attente) {:metabase-user-id 1}```

**To Reproduce**
Steps to reproduce the behavior:
1. Go to a new question
2. Select the redshift table (from pennylane)
3. Join the table to a Mysql table
4. Check result, see the error : ""Échec de la recherche de :metadata/table 218 : soit il n'existe pas, soit il appartient à une autre base de données."".

**Expected behavior**
To do the join and select data

**Severity**
Blocking using of this database, then of use of the data

**Additional context**
I verified that the table is visible in admin.
The table is selectable in tables to query from in a question, but not in the selector of join tables (I can select it only if it's in the recent panel).

**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""fr-FR"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""4.19.0-27-cloud-amd64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""mysql"",
      ""redshift""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.3 (Debian 16.3-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-07-15"",
      ""tag"": ""v0.50.13"",
      ""hash"": ""2086968""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Paris""
    }
  }
}
```",TitCaz,2024-08-28 08:41:23+00:00,[],2024-08-28 08:48:33+00:00,,https://github.com/metabase/metabase/issues/47337,[],"[{'comment_id': 2314712997, 'issue_id': 2491455300, 'author': 'TitCaz', 'body': 'Update : Normal behavior because two tables are not from same database; But error should be more explicit', 'created_at': datetime.datetime(2024, 8, 28, 8, 48, 31, tzinfo=datetime.timezone.utc)}]","TitCaz (Issue Creator) on (2024-08-28 08:48:31 UTC): Update : Normal behavior because two tables are not from same database; But error should be more explicit

"
2491310960,issue,closed,completed,Identical migration in v50 and v51 causes exception,"If you start on v50, run `(dev/migrate!)`, then checkout master and run `(dev/migrate!)` again you'll encounter the following exception:

```
2024-08-28 06:46:00,097 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v51.2024-05-30T16:04:20::escherize encountered an exception.
liquibase.exception.DatabaseException: ERROR: column ""context"" of relation ""recent_views"" already exists [Failed SQL: (0) ALTER TABLE ""public"".""recent_views"" ADD ""context"" VARCHAR(256) DEFAULT 'view' NOT NULL]
```

Likewise, if you start on master and then checkout 50, you'll get similar exception:

```
2024-08-28 06:38:59,265 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v50.2024-05-30T16:04:20::escherize encountered an exception.
liquibase.exception.DatabaseException: ERROR: column ""context"" of relation ""recent_views"" already exists [Failed SQL: (0) ALTER TABLE ""public"".""recent_views"" ADD ""context"" VARCHAR(256) DEFAULT 'view' NOT NULL]
```

There is an identical migration in those branches, but it's id is different and so liquibase conflicts on that.

P.S. Would be nice to have a CI job to check that upgrades and downgrades work properly.",piranha,2024-08-28 07:33:17+00:00,['escherize'],2024-10-08 16:15:59+00:00,2024-08-29 22:46:07+00:00,https://github.com/metabase/metabase/issues/47336,"[('Type:Bug', 'Product defects'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2490291810,issue,closed,completed,Unable to Generate SQL Query with Contains Function Due to Data Type Mismatch,"### Describe the bug

I'm creating this issue as an addition to the https://github.com/metabase/metabase/issues/44431

Metabase fails to generate a query when the original schema data type is `type/*` and the contains function is used to filter. The question creation shows the following error:

```
Error generating the query.
```

Error details shows the following output:

```
Invalid query: {:stages [{:filters [[nil nil [""expression returning a string""]]]}]}
```

Please also see the attached log for the error details when the contains function is used for query generation.

A sample question is created:
![image](https://github.com/user-attachments/assets/bd2d24e5-ddab-495d-b6c5-2160654ed692)

A filter is added that uses the contains function on one of the columns:
![image](https://github.com/user-attachments/assets/42c2a3d0-b1a6-4824-a4fc-6d5db9c4609b)

Query generation fails which leads to no results being shown to the user:
![image](https://github.com/user-attachments/assets/8840222d-6d00-43bd-82ee-ba502c87fb4f)

The data type is being recognized as `type/*`:
![image](https://github.com/user-attachments/assets/d389c6a3-e8b0-4bd6-9b55-4af2cecb76c6)

Syncing the database schema, rescanning for values, or changing the type to Entity Name did not resolve the issue. The column is defined as VARCHAR(15).

Please let me know if I can provide any additional information. Thank you.


### To Reproduce

1. Find a table column where the underlying data type is text (e.g. varchar etc.) but recognized as `type/*` by Metabase.
2. Create a new question and select the source table. Open the SQL pane to see the statement created.
3. Add a filter for the selected column and select the contains function with a sample input.
4. SQL generation fails and the SQL pane shows an error.

### Expected behavior

Metabase should allow users to filter by string functions if the underlying data is string.

### Logs

```
2024-08-27 20:21:36,149 ERROR middleware.log :: POST /api/dataset/native 500 19.0 ms (3 DB calls) {:metabase-user-id 1} 
{:via
 [{:type clojure.lang.ExceptionInfo,
   :message
   ""Error preprocessing query in metabase.query_processor.preprocess$ensure_pmbql$fn__65774@17953c15: Invalid query: {:stages [{:filters [[nil nil [\""expression returning a string\""]]]}]}"",
   :data
   {:fn
    #object[metabase.query_processor.preprocess$ensure_pmbql$fn__65774 0x17953c15 ""metabase.query_processor.preprocess$ensure_pmbql$fn__65774@17953c15""],
    :query
    {:lib/type :mbql/query,
     :stages
     [{:lib/type :mbql.stage/mbql,
       :source-table 91,
       :filters
       [[:contains
         {:case-sensitive false, :lib/uuid ""f6da5ec1-7d3b-4d06-a88a-134d74a55060""}
         [:field {:base-type :type/*, :lib/uuid ""5cdb05f5-9aaf-468b-83ab-841f3c9777d9"", :effective-type :type/*} 1372]
         ""ABC""]]}],
     :database 2,
     :lib.convert/converted? true,
     :lib/metadata
     (metabase.lib.metadata.invocation-tracker/invocation-tracker-provider (metabase.lib.metadata.cached-provider/cached-metadata-provider (metabase.lib.metadata.jvm/->UncachedApplicationDatabaseMetadataProvider 2)))},
    :type :qp},
   :at [metabase.query_processor.preprocess$preprocess$fn__65778$fn__65779 invoke ""preprocess.clj"" 133]}
  {:type clojure.lang.ExceptionInfo,
   :message ""Invalid query: {:stages [{:filters [[nil nil [\""expression returning a string\""]]]}]}"",
   :data
   {:type :invalid-query,
    :error {:stages [{:filters [[nil nil [""expression returning a string""]]]}]},
    :original
    {:schema :metabase.lib.schema/query,
     :value
     {:lib/type :mbql/query,
      :stages
      [{:lib/type :mbql.stage/mbql,
        :source-table 91,
        :filters
        [[:contains
          {:case-sensitive false, :lib/uuid ""f6da5ec1-7d3b-4d06-a88a-134d74a55060""}
          [:field {:base-type :type/*, :lib/uuid ""5cdb05f5-9aaf-468b-83ab-841f3c9777d9"", :effective-type :type/*} 1372]
          ""ABC""]]}],
      :database 2,
      :lib.convert/converted? true,
      :lib/metadata
      (metabase.lib.metadata.invocation-tracker/invocation-tracker-provider (metabase.lib.metadata.cached-provider/cached-metadata-provider (metabase.lib.metadata.jvm/->UncachedApplicationDatabaseMetadataProvider 2)))},
     :errors
     ({:path [0 0 :stages 0 0 0 0 1 :mbql.stage/mbql 0 0 :filters 0 0 0 0 0 true 0 :contains 0 0 :args 0 0 1],
       :in [:stages 0 :filters 0 2],
       :schema
       [:fn {:error/message ""expression returning a string""} #object[metabase.lib.schema.expression$expression_schema$fn__14627 0x6a188d9b ""metabase.lib.schema.expression$expression_schema$fn__14627@6a188d9b""]],
       :value
       [:field
        {:base-type :type/*, :lib/uuid ""5cdb05f5-9aaf-468b-83ab-841f3c9777d9"", :effective-type :type/*}
        1372]})}},
   :at [metabase.query_processor.middleware.validate$validate_query invokeStatic ""validate.clj"" 16]}],
 :trace
 [[metabase.query_processor.middleware.validate$validate_query invokeStatic ""validate.clj"" 16]
  [metabase.query_processor.middleware.validate$validate_query invoke ""validate.clj"" 10]
  [clojure.lang.Var invoke ""Var.java"" 384]
  [metabase.query_processor.preprocess$ensure_pmbql$fn__65774 invoke ""preprocess.clj"" 68]
  [metabase.query_processor.preprocess$preprocess$fn__65778$fn__65779 invoke ""preprocess.clj"" 128]
  [clojure.lang.PersistentVector reduce ""PersistentVector.java"" 343]
  [clojure.core$transduce invokeStatic ""core.clj"" 6947]
  [clojure.core$transduce invoke ""core.clj"" 6934]
  [metabase.query_processor.preprocess$preprocess$fn__65778 invoke ""preprocess.clj"" 119]
  [metabase.query_processor.setup$do_with_qp_setup invokeStatic ""setup.clj"" 225]
  [metabase.query_processor.setup$do_with_qp_setup invoke ""setup.clj"" 216]
  [metabase.query_processor.preprocess$preprocess invokeStatic ""preprocess.clj"" 118]
  [metabase.query_processor.preprocess$preprocess invoke ""preprocess.clj"" 114]
  [metabase.query_processor.compile$compile$fn__66464 invoke ""compile.clj"" 33]
  [metabase.query_processor.setup$do_with_qp_setup invokeStatic ""setup.clj"" 225]
  [metabase.query_processor.setup$do_with_qp_setup invoke ""setup.clj"" 216]
  [metabase.query_processor.compile$compile invokeStatic ""compile.clj"" 32]
  [metabase.query_processor.compile$compile invoke ""compile.clj"" 29]
  [metabase.query_processor.compile$compile_and_splice_parameters$fn__66469 invoke ""compile.clj"" 54]
  [metabase.query_processor.setup$do_with_canceled_chan$fn__65263 invoke ""setup.clj"" 189]
  [metabase.query_processor.setup$do_with_database_local_settings$fn__65258 invoke ""setup.clj"" 181]
  [metabase.query_processor.setup$do_with_driver$fn__65253$fn__65254 invoke ""setup.clj"" 166]
  [metabase.driver$do_with_driver invokeStatic ""driver.clj"" 105]
  [metabase.driver$do_with_driver invoke ""driver.clj"" 100]
  [metabase.query_processor.setup$do_with_driver$fn__65253 invoke ""setup.clj"" 165]
  [metabase.query_processor.setup$do_with_metadata_provider$fn__65246$fn__65249 invoke ""setup.clj"" 151]
  [metabase.query_processor.store$do_with_metadata_provider invokeStatic ""store.clj"" 171]
  [metabase.query_processor.store$do_with_metadata_provider invoke ""store.clj"" 151]
  [metabase.query_processor.store$do_with_metadata_provider invokeStatic ""store.clj"" 160]
  [metabase.query_processor.store$do_with_metadata_provider invoke ""store.clj"" 151]
  [metabase.query_processor.setup$do_with_metadata_provider$fn__65246 invoke ""setup.clj"" 150]
  [metabase.query_processor.setup$do_with_resolved_database$fn__65240 invoke ""setup.clj"" 128]
  [metabase.query_processor.setup$do_with_qp_setup invokeStatic ""setup.clj"" 232]
  [metabase.query_processor.setup$do_with_qp_setup invoke ""setup.clj"" 216]
  [metabase.query_processor.compile$compile_and_splice_parameters invokeStatic ""compile.clj"" 53]
  [metabase.query_processor.compile$compile_and_splice_parameters invoke ""compile.clj"" 45]
  [metabase.api.dataset$fn__97235$fn__97238 invoke ""dataset.clj"" 175]
  [metabase.api.dataset$fn__97235 invokeStatic ""dataset.clj"" 171]
  [metabase.api.dataset$fn__97235 invoke ""dataset.clj"" 166]
  [compojure.core$wrap_response$fn__52960 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__52944 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__52949 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [metabase.server.middleware.auth$enforce_authentication$fn__97278 invoke ""auth.clj"" 18]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53000 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 300]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [metabase.api.routes$fn__104854$fn__104857 invoke ""routes.clj"" 73]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__105134$fn__105135 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53000 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53004 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52953 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972$f__52973$respond_SINGLEQUOTE___52974 invoke ""core.clj"" 197]
  [metabase.server.routes$fn__105117$fn__105119 invoke ""routes.clj"" 47]
  [compojure.core$routes$fn__52972$f__52973 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52972 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__101248 invoke ""exceptions.clj"" 107]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__101245 invoke ""exceptions.clj"" 96]
  [metabase.server.middleware.log$log_api_call$fn__105414$fn__105415$fn__105416 invoke ""log.clj"" 236]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__105414$fn__105415 invoke ""log.clj"" 227]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__105414 invoke ""log.clj"" 226]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__108684 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__101204 invoke ""security.clj"" 241]
  [ring.middleware.json$wrap_json_body$fn__108943 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__87451 invoke ""offset_paging.clj"" 43]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__54493 invoke ""json.clj"" 83]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__109032 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__109051 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__70595 invoke ""misc.clj"" 60]
  [metabase.server.middleware.session$reset_session_timeout$fn__77725 invoke ""session.clj"" 552]
  [metabase.server.middleware.session$bind_current_user$fn__77691$fn__77692 invoke ""session.clj"" 446]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 425]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 408]
  [metabase.server.middleware.session$bind_current_user$fn__77691 invoke ""session.clj"" 445]
  [metabase.server.middleware.session$wrap_current_user_info$fn__77670 invoke ""session.clj"" 383]
  [metabase.server.middleware.session$wrap_session_id$fn__77642 invoke ""session.clj"" 259]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__97286 invoke ""auth.clj"" 32]
  [ring.middleware.cookies$wrap_cookies$fn__108871 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__70577 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__70603 invoke ""misc.clj"" 77]
  [ring.middleware.gzip$wrap_gzip$fn__108913 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.misc$bind_request$fn__70606 invoke ""misc.clj"" 94]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__108700 invoke ""ssl.clj"" 41]
  [metabase.server$async_proxy_handler$fn__70941 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run nil -1]],
 :cause ""Invalid query: {:stages [{:filters [[nil nil [\""expression returning a string\""]]]}]}"",
 :data
 {:type :invalid-query,
  :error {:stages [{:filters [[nil nil [""expression returning a string""]]]}]},
  :original
  {:schema :metabase.lib.schema/query,
   :value
   {:lib/type :mbql/query,
    :stages
    [{:lib/type :mbql.stage/mbql,
      :source-table 91,
      :filters
      [[:contains
        {:case-sensitive false, :lib/uuid ""f6da5ec1-7d3b-4d06-a88a-134d74a55060""}
        [:field {:base-type :type/*, :lib/uuid ""5cdb05f5-9aaf-468b-83ab-841f3c9777d9"", :effective-type :type/*} 1372]
        ""ABC""]]}],
    :database 2,
    :lib.convert/converted? true,
    :lib/metadata
    (metabase.lib.metadata.invocation-tracker/invocation-tracker-provider (metabase.lib.metadata.cached-provider/cached-metadata-provider (metabase.lib.metadata.jvm/->UncachedApplicationDatabaseMetadataProvider 2)))},
   :errors
   ({:path [0 0 :stages 0 0 0 0 1 :mbql.stage/mbql 0 0 :filters 0 0 0 0 0 true 0 :contains 0 0 :args 0 0 1],
     :in [:stages 0 :filters 0 2],
     :schema
     [:fn {:error/message ""expression returning a string""} #object[metabase.lib.schema.expression$expression_schema$fn__14627 0x6a188d9b ""metabase.lib.schema.expression$expression_schema$fn__14627@6a188d9b""]],
     :value
     [:field {:base-type :type/*, :lib/uuid ""5cdb05f5-9aaf-468b-83ab-841f3c9777d9"", :effective-type :type/*} 1372]})}},
 :message
 ""Error preprocessing query in metabase.query_processor.preprocess$ensure_pmbql$fn__65774@17953c15: Invalid query: {:stages [{:filters [[nil nil [\""expression returning a string\""]]]}]}"",
 :fn
 #object[metabase.query_processor.preprocess$ensure_pmbql$fn__65774 0x17953c15 ""metabase.query_processor.preprocess$ensure_pmbql$fn__65774@17953c15""],
 :query
 {:lib/type :mbql/query,
  :stages
  [{:lib/type :mbql.stage/mbql,
    :source-table 91,
    :filters
    [[:contains
      {:case-sensitive false, :lib/uuid ""f6da5ec1-7d3b-4d06-a88a-134d74a55060""}
      [:field {:base-type :type/*, :lib/uuid ""5cdb05f5-9aaf-468b-83ab-841f3c9777d9"", :effective-type :type/*} 1372]
      ""ABC""]]}],
  :database 2,
  :lib.convert/converted? true,
  :lib/metadata
  (metabase.lib.metadata.invocation-tracker/invocation-tracker-provider (metabase.lib.metadata.cached-provider/cached-metadata-provider (metabase.lib.metadata.jvm/->UncachedApplicationDatabaseMetadataProvider 2)))}}


```

### Information about your Metabase installation

```JSON
Client Browser: Chrome v128
Host OS: Debian Bookworm
Host Database: Postgres
Host Metabase: v0.50.20
Host Environment: Docker
```


### Severity

Medium - Blocking Access to Some Filtered Questions

### Additional context

Updated from Metabase v49 to v50.
Roughly 10% of questions failed.
Some questions could be fixed by reapplying the existing filters.
",MarleTangible,2024-08-27 20:35:26+00:00,[],2024-08-28 10:04:41+00:00,2024-08-27 21:39:36+00:00,https://github.com/metabase/metabase/issues/47329,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2313518458, 'issue_id': 2490291810, 'author': 'ranquild', 'body': '@MarleTangible please upgrade to 50.22 where the issue is solved', 'created_at': datetime.datetime(2024, 8, 27, 20, 54, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2313627367, 'issue_id': 2490291810, 'author': 'alxnddr', 'body': 'Closing the issue as it has already been fixed', 'created_at': datetime.datetime(2024, 8, 27, 21, 39, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2314886141, 'issue_id': 2490291810, 'author': 'MarleTangible', 'body': 'Upgrading to v50.22 resolved the issue.', 'created_at': datetime.datetime(2024, 8, 28, 10, 4, 40, tzinfo=datetime.timezone.utc)}]","ranquild on (2024-08-27 20:54:45 UTC): @MarleTangible please upgrade to 50.22 where the issue is solved

alxnddr on (2024-08-27 21:39:36 UTC): Closing the issue as it has already been fixed

MarleTangible (Issue Creator) on (2024-08-28 10:04:40 UTC): Upgrading to v50.22 resolved the issue.

"
2490151534,issue,closed,completed,Questions in dashboards,"## Description
Most people just create questions in order to put them in dashboards. Let's make that faster and easier and in the process, declutter collections. 🥳 

## Links
- [product doc](https://www.notion.so/metabase/Enable-saving-questions-directly-to-dashboards-and-make-this-the-default-path-a84be6e0540241189b251401fb35ca91?pvs=4)
- [eng doc](https://www.notion.so/metabase/Cards-in-Dashboards-39c889612c094ff2be3c7c8e291a738b?pvs=4)
- [testing plan](https://www.notion.so/metabase/Cards-in-Dashboards-testing-plan-14269354c90180ecabb9fe5cbb092d93)









",sloansparger,2024-08-27 19:17:39+00:00,"['npfitz', 'johnswanson', 'sloansparger', 'iethree']",2025-01-15 19:26:30+00:00,2025-01-15 19:26:30+00:00,https://github.com/metabase/metabase/issues/47326,"[('.Epic', 'Feature Implementation or Project'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2490060221,issue,closed,completed,"Add ""..."" context menu to items on the metrics page","Add a ""..."" menu to the metrics items on the Browse Metrics page to show a context menu with the following items:
- bookmark
- move to trash
- open collection",romeovs,2024-08-27 18:25:24+00:00,['romeovs'],2024-10-08 16:15:04+00:00,2024-09-10 14:14:04+00:00,https://github.com/metabase/metabase/issues/47322,"[('Type:New Feature', '')]",[],
2490045194,issue,closed,completed,browse models is slow,"### Describe the bug

browse models on a large instance took 18 seconds

### To Reproduce

browse models

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
master
```


### Severity

p1

### Additional context

_No response_",dpsutton,2024-08-27 18:16:05+00:00,['johnswanson'],2024-08-28 12:23:50+00:00,2024-08-28 12:23:50+00:00,https://github.com/metabase/metabase/issues/47320,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2489378401,issue,open,,Metabase query history message is not right when just moving a query into a new folder,"### Describe the bug

Hi! So i just moved a query to a new folder and the metabase history query reads ""You edited this. a few seconds ago. changed the filters, enabled collection review, changed the filter mapping and moved it to 2023 revenue by state/city."" However, all i did was move it into a new folder, so i believe the error message should just be ""moved it to 2023 revenue by state/city"". This is misleading bcos people will ask why i made these changes- i didnt add any filters. I want it to be known that i just MOVED the query. Can someone help fix this history message?
![image](https://github.com/user-attachments/assets/9601772a-516e-4080-b671-cbf42805d2cf)


### To Reproduce

1. Pick up an old query from 2 years ago
2. Hit the ""move"" button to move it into a folder
3. View history messages and see the error message read more than what was done

### Expected behavior

If i moved a query, the history message should just be ""moved it to X folder""



### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.22+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.22"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.22+7"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.220-209.869.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""snowflake"",
      ""redshift""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.6.0""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-03-04"",
      ""tag"": ""v0.48.8"",
      ""hash"": ""a900c85""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

Bug

### Additional context

![image](https://github.com/user-attachments/assets/33c73471-1098-4ebb-8fbd-8b99fa634a67)
",aarthi-subramanian,2024-08-27 13:29:47+00:00,[],2025-02-05 19:16:55+00:00,,https://github.com/metabase/metabase/issues/47306,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2489259340,issue,closed,completed,Unit of time parameter does not work when used together with another filter,"CI run with failure: https://github.com/metabase/metabase/actions/runs/10578852932/job/29310334408?pr=46958

1. `git checkout 46527-dashboard-filters-tests`
2. Run e2e test called `should not overwrite parameter mappings for a card when doing auto-wiring`

The test will fail because unit of time parameter won't be applied by BE when calling POST `/api/dashboard/:id/dashcard/:id/card/:id/query`

----


I think the discrepancy comes from the fact that FE does not call `Lib.ensureFilterStage` for unit of time parameters (see [code](https://github.com/metabase/metabase/blob/37d993b4e555ec0beff2185d9d67050171f79fbf/frontend/src/metabase-lib/v1/parameters/utils/targets.ts#L172-L182)). The reason is that unit of time is a parameter, not a filter (i.e. it does not produce a filter clause). We don't want to change how unit of parameters work as a part of this epic, although enabling passing unit of filter parameter at other query stages than the last one has been discussed ([see bottom of product doc](https://www.notion.so/metabase/Allow-to-use-both-pre-and-post-last-aggregation-columns-in-dashboard-filters-b32a6bb5cebc4723b8b9b81870217a79?pvs=4#38f1f3f47d98427eaa8994ad7cfc8289)).

I already adjusted FE to not send `stage-number` option with unit of time parameters (37d993b4e555ec0beff2185d9d67050171f79fbf).
Now BE needs to figure out which stage to apply the unit of time parameter to.",kamilmielnik,2024-08-27 12:45:56+00:00,['metamben'],2024-09-02 08:58:20+00:00,2024-09-02 08:58:20+00:00,https://github.com/metabase/metabase/issues/47304,"[('Type:Bug', 'Product defects'), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2324196030, 'issue_id': 2489259340, 'author': 'kamilmielnik', 'body': 'Closed by #46958', 'created_at': datetime.datetime(2024, 9, 2, 8, 58, 20, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-09-02 08:58:20 UTC): Closed by #46958

"
2489110207,issue,open,,Inconsistent bookmark tooltip placement in sidebar,"### Describe the bug

Tooltip for bookmark title goes up: [image](https://github.com/user-attachments/assets/145ceded-fdd8-48fd-9c20-86965cfd0f93)
Tooltip for remove bookmark button goes down: [image](https://github.com/user-attachments/assets/cb806631-a04c-466f-b7c2-18342c22c769)


### To Reproduce

1. Bookmark a question with a very long name
2. Open sidebar
3. Hover bookmark title
:heavy_check_mark:  tooltip goes up
4. Hover remove bookmark button 
:x: tooltip goes down
:x: tooltip is not horizontally centered against the button


### Information about your Metabase installation

master, 2ba5c4d93e4c0732c7c302cb1693b1832761ffae

### Severity

P3
",kamilmielnik,2024-08-27 11:49:29+00:00,[],2025-02-04 20:26:39+00:00,,https://github.com/metabase/metabase/issues/47301,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Organization/', ''), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('Design System', 'Overall UI patterns and components, not specific to a single part of the product')]",[],
2488903237,issue,open,,Support for setting multiple roles at once with connection impersonation,"### Describe the bug

We experience this bug when using Impersonation in Metabase Enterprise (see below how to reproduce more exactly):
```
class clojure.lang.PersistentVector cannot be cast to class java.lang.CharSequence (clojure.lang.PersistentVector is in unnamed module of loader 'app'; java.lang.CharSequence is in module java.base of loader 'bootstrap')
...
metabase_enterprise.advanced_permissions.driver.impersonation$connection_impersonation_role.invokeStatic(impersonation.clj:73)
```
This means that [this line of Metabase Enterprise code crashes](https://github.com/metabase/metabase/blob/6bf7bfca9aa8a71ba8e155a2c90713d0d9999951/enterprise/backend/src/metabase_enterprise/advanced_permissions/driver/impersonation.clj#L73).

**I delivered a solution proposal in PR** #47246  

### To Reproduce

1. Set up impersonation - more or less as described [here](https://www.metabase.com/learn/metabase-basics/administration/permissions/impersonation#:~:text=Impersonation%20is%20a%20permissions%20setting,your%20database%20executes%20the%20query)
2. Obtain the database role user attribute from SSO/Keycloak/JWT JSONs attributes like {""groups"": [""myFirstGroup"", ""mySecondGroup""]}
3. See error
```
class clojure.lang.PersistentVector cannot be cast to class java.lang.CharSequence (clojure.lang.PersistentVector is in unnamed module of loader 'app'; java.lang.CharSequence is in module java.base of loader 'bootstrap')
...
metabase_enterprise.advanced_permissions.driver.impersonation$connection_impersonation_role.invokeStatic(impersonation.clj:73)
```
This means that [this line of Metabase Enterprise code crashes](https://github.com/metabase/metabase/blob/6bf7bfca9aa8a71ba8e155a2c90713d0d9999951/enterprise/backend/src/metabase_enterprise/advanced_permissions/driver/impersonation.clj#L73).

### Expected behavior

**Expected result** would be at least a reasonable error, which data(type) is expected and at which point exactly input data is considered to be bad.

**An even nicer and customer friendly solution** would be to check the type of the role variable, and convert it as necessary. 

### Logs

```
class clojure.lang.PersistentVector cannot be cast to class java.lang.CharSequence (clojure.lang.PersistentVector is in unnamed module of loader 'app'; java.lang.CharSequence is in module java.base of loader 'bootstrap')
...
metabase_enterprise.advanced_permissions.driver.impersonation$connection_impersonation_role.invokeStatic(impersonation.clj:73)
```

### Information about your Metabase installation

```JSON
- Metabase version v1.50.21
- SSO via JWT/Keycloak/OIDC

Rather less relevant information:
- Metabase Hosting-Environment: OpenShift
- Metabase internal Database: MySQL
- Tested with metabase-clickhouse-driver
```


### Severity

blocking

### Additional context

_No response_",s-huk,2024-08-27 10:16:38+00:00,[],2025-02-04 20:30:55+00:00,,https://github.com/metabase/metabase/issues/47296,"[('Priority:P2', 'Average run of the mill bug'), ('Type:New Feature', ''), ('.Backend', ''), ('Administration/Impersonation', 'Role level security'), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2312417308, 'issue_id': 2488903237, 'author': 'paoliniluis', 'body': ""Hi there, we should be reviewing and shipping the fix soon, but I wanted to check the use case here as I'm not fully getting why you would like to pass 2 roles to a database. What's the use case here?"", 'created_at': datetime.datetime(2024, 8, 27, 12, 22, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2313004368, 'issue_id': 2488903237, 'author': 's-huk', 'body': 'Hi, we use impersonation as described [in this article](https://www.metabase.com/learn/metabase-basics/administration/permissions/impersonation#:~:text=Impersonation%20is%20a%20permissions%20setting,your%20database%20executes%20the%20query) (esp. ""Impersonation sets permissions for questions written in both the SQL editor and the query builder"").\r\n\r\nOur Tables/Databases are partitioned into various domains or project groups. More precisely, this setup resembles a hypergraph where each hyperedge represents a role or project group. Depending on a user\'s participation in a project group, they are assigned the corresponding role, and users can hold multiple roles simultaneously. This approach helps us avoid the combinatorial explosion of database connections, while facilitating data joins across multiple project groups with proper authorization - regardless of whether users are utilizing the Metabase query builder or query editor.', 'created_at': datetime.datetime(2024, 8, 27, 16, 19, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2313082546, 'issue_id': 2488903237, 'author': 'paoliniluis', 'body': ""@s-huk you're using clickhouse as the DW is that correct?"", 'created_at': datetime.datetime(2024, 8, 27, 16, 59, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2314611189, 'issue_id': 2488903237, 'author': 's-huk', 'body': '@paoliniluis yes, and we have already taken a look at the [metabase-clickhouse-driver](https://github.com/ClickHouse/metabase-clickhouse-driver/blob/master/src/metabase/driver/clickhouse.clj#L274-L299)', 'created_at': datetime.datetime(2024, 8, 28, 8, 3, 7, tzinfo=datetime.timezone.utc)}, {'comment_id': 2322039544, 'issue_id': 2488903237, 'author': 'noahmoss', 'body': 'Relabeled as feature request after discussion with product.', 'created_at': datetime.datetime(2024, 8, 30, 17, 36, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2322869423, 'issue_id': 2488903237, 'author': 's-huk', 'body': 'Once again, I suggested a sound and very easy solution in PR #47246 (then you wouldn\'t have to create a separate issue for the bug and solve that one).\r\n\r\nSo, why don\'t we just merge this PR, and add this description to your role impersonation documentation: \r\n```\r\nIf the database role attribute is not a string but a collection of strings (like a JSON array), then it will automatically be reduced to a comma-separated String. For exmaple, collections like [""a"", ""b"", ""c""] will automatically be reduced to ""a,b,c"".\r\n```\r\n\r\nThis would make all of us happy, because...\r\n\r\n- You wouldn\'t have to fix the bug anymore.\r\n- Databases that can activate only one role\r\n  - ...could work with text (as currently) or singleton collections as well\r\n  - ...should return the most reasonable error message in case of multiple comma-separated values\r\n- Databases which can activate more than one role...\r\n  - ...could work with text (as currently) or comma-separated input as well\r\n\r\nAnd existing drivers wouldn\'t have to be modified nor bothered, because reducing a collection of roles to a comma-separated role string aligns with the SQL syntax of every possible driver\'s SQL dialect.\r\n\r\n**Under the bottom line**: Roughly nothing would have to be done, and you wouldn\'t have to impair the quality of your software. Or am I missing something?', 'created_at': datetime.datetime(2024, 8, 31, 11, 35, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2327323320, 'issue_id': 2488903237, 'author': 'noahmoss', 'body': ""@s-huk As I noted previously, concatenation of strings using commas is a driver implementation detail. Even _if_ every driver does this in the same way, they may have different rules around quoting individual roles, or other syntax differences. For instance, our Postgres driver already will [quote a role](https://github.com/metabase/metabase/blob/master/src/metabase/driver/postgres.clj#L968-L969) if it includes non-alphanumeric characters. \r\n\r\nIt's plausible that a future driver could have both requirements—multiple roles and special quoting rules—in which case your proposed implementation would not work. Or a future might have a different syntax for multiple roles altogether.\r\n\r\nI'm open to the idea of updating `driver/set-role!` and `driver/set-role-statement!` to take a list of strings in place of a single string. If you'd like to submit a new PR with this approach (or another approach which doesn't have the issue above) I'm happy to review it."", 'created_at': datetime.datetime(2024, 9, 3, 19, 57, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2329573652, 'issue_id': 2488903237, 'author': 's-huk', 'body': 'I will consult with my team to determine whether to participate here, comparing it to other possible solutions.\r\n\r\nIt sounds like you want to change the type, i.e., first overload the set-role-statement method somehow and then gradually phase out the non-set method from every possible driver.', 'created_at': datetime.datetime(2024, 9, 4, 17, 2, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2333652804, 'issue_id': 2488903237, 'author': 's-huk', 'body': ""@noahmoss\r\nBefore I contribute vainly to unnecessarily impairing the simplicity and clarity of the driver interface, I need to ask you again: **Are you really sure you want to change the type of the role variable from a string to a collection of strings?**\r\n\r\nTo reconsider this more clearly, let's focus on the following role input scenarios which can occur:\r\n\r\n1. The role attribute is a string consisting of exactly one role.\r\n2. The role attribute is a string consisting of multiple roles, comma-separated by the user.\r\n3. The role attribute is a collection.\r\n\r\nInstead of changing/extending the type of your interface's `role` variable, I would suggest simplifying scenario 3 into scenario 2.\r\n\r\nAs you point out, Metabase can't validate or transform input from scenario 2. Only the drivers can transform such strings according to their underlying database syntax, as you already mentioned. And why wouldn’t the drivers be able to handle this with, e.g., regular expressions instead of collections?\r\n\r\nTherefore, I still recommend merging PR #47246 (which already maps scenario 3 into 2). Upon closer inspection, it still seems to be the most straightforward and less complicated solution. It works with all possible drivers as long as there is no more than one role involved (role input scenarios 1-3 would all be supported). It also already supports multiple roles in drivers like Clickhouse. As for Postgres, this system doesn't seem to support multiple roles anyway.\r\n\r\nIf there is a database with special quoting rules that supports multiple roles, we would simply need to adapt its driver to handle comma-separated strings - so what? (because this would have to be done anyways, to be able to handle input scenario 2)"", 'created_at': datetime.datetime(2024, 9, 6, 9, 31, tzinfo=datetime.timezone.utc)}, {'comment_id': 2334416628, 'issue_id': 2488903237, 'author': 'dpsutton', 'body': 'Hi @s-huk \r\n\r\nI\'ve setup a user with the following login_attributes  `{:email ""sandbox@metabase.com"", :id 2, :login_attributes {""id"" ""1""}}` and setup sandboxing on that attribute, i see the following\r\n<img width=""1370"" alt=""image"" src=""https://github.com/user-attachments/assets/c295cb61-1826-44ff-a7c7-230edc409be5"">\r\n\r\n\r\nIf I update the login attributes to mirror the proposed allowable shape here, `{:email ""sandbox@metabase.com"", :id 2, :login_attributes {""id"" [""1"" ""2""]}}` the sandboxing breaks with an invalid shape.\r\n<img width=""1370"" alt=""image"" src=""https://github.com/user-attachments/assets/53199363-3270-48da-beac-4cba82d51ea4"">\r\n\r\nWe have logs that complain about the invalid shape\r\n\r\n```\r\n2024-09-06 11:21:43,499 WARN lib.normalize :: Error normalizing pMBQL:\r\n...\r\n2024-09-06 11:21:43,507 WARN lib.convert :: Clean: Removing bad clause in [:filters 0 2 3] due to error {:filters [[nil nil [nil nil nil [""should be nil"" ""should be a boolean"" ""should be a string"" ""should be an integer"" ""should be a double"" ""instance of java.lang.Float"" ""instance of java.math.BigDecimal"" ""instance of java.time.LocalDate"" ""date string literal"" ""local time string literal"" ""offset time string literal"" ""instance of java.time.LocalTime"" ""instance of java.time.OffsetTime"" ""local date time string literal"" ""offset date time string literal"" ""instance of java.time.LocalDateTime"" ""instance of java.time.OffsetDateTime"" ""instance of java.time.ZonedDateTime""]]]]}:\r\n{:filters [[nil nil [nil nil nil :1]]]}\r\n\r\n2024-09-06 11:21:43,508 WARN lib.convert :: Clean: Removing bad clause in [:filters 0 2 3] due to error :malli.core/end-of-input:\r\n{:filters\r\n [[nil\r\n   nil\r\n   [nil {:lib/uuid ""2c859dba-33cb-4e97-9a23-92eb8868b4b0""} [nil {:lib/uuid ""1ff83655-552a-45bd-958e-0ee67e6764aa""}]]\r\n   [:=\r\n    {:lib/uuid ""acfbd23b-c4b6-472e-aea4-15c09b5df9f2""}\r\n    [:field {:base-type :type/BigInteger, :lib/uuid ""c5c77b10-c3fb-44ed-91ae-7dbabea7a36f""} 62]\r\n    2]]]}\r\n\r\n2024-09-06 11:21:43,508 WARN lib.convert :: Clean: Removing bad clause in [:filters 0 3] due to error :malli.core/end-of-input:\r\n{:filters\r\n [[:or\r\n   {:lib/uuid ""9fe2e75c-3b6f-4d8d-8596-722f5b68d79f""}\r\n   [:=\r\n    {:lib/uuid ""acfbd23b-c4b6-472e-aea4-15c09b5df9f2""}\r\n    [:field {:base-type :type/BigInteger, :lib/uuid ""c5c77b10-c3fb-44ed-91ae-7dbabea7a36f""} 62]\r\n    2]]]}\r\n\r\n2024-09-06 11:21:43,508 WARN lib.convert :: Clean: Removing bad clause in [:filters] due to error :malli.core/limits:\r\n{:filters []}\r\n```\r\n\r\nAnd I think we have to decline the mechanism you are proposing. It is changing a data shape that flows throughout our system and you are only thinking of the consequences of it in one 3rd party driver.  As per your statement ""Do you really insist on spaghettifying type insecurity into all possible drivers?"", I think we are carefully considering the changes we allow to the product and a change letting a string randomly be a collection would actually spagettify type insecurity into a lot of code paths.\r\n\r\nAgain, I appreciate you engaging with a PR and we will consider how to land this feature. But we will not do so at the expense of silently breaking sandboxing.', 'created_at': datetime.datetime(2024, 9, 6, 16, 27, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2337342886, 'issue_id': 2488903237, 'author': 's-huk', 'body': '@dpsutton Hi, I didnt suggest ""letting a string randomly be a collection"" (just @noahmoss seems to think in this direction). PR #47246 solely proposes to homogenize it to a string if it accidentally turns out to be a collection. So sticking with your example, I would rather suggest to transform something like `{:email ""sandbox@metabase.com"", :id 2, :login_attributes {""id"" [""1"" ""2""]}}` to `{:email ""sandbox@metabase.com"", :id 2, :login_attributes {""id"" ""1,2""}}`.', 'created_at': datetime.datetime(2024, 9, 9, 7, 30, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338186978, 'issue_id': 2488903237, 'author': 'Gerrit-K', 'body': ""Chiming in from a different company, but with a very similar setup as @s-huk: we use Metabase Enterprise behind Keycloak to query data from ClickHouse. This bug (/ missing feature, if you like) is currently blocking our rollout of Connection Impersonation, which was one of the key features for us to buy the Enterprise license in the first place.\r\n\r\nIt's a pity that the existence of multiple roles was not considered for the first concept of this feature, because I think it's a rather common case. Users often have not just one distinct but many different, potentially even overlapping roles set via their IdP and all the DBMS I've come across support users with multiple roles, so IMO Metabase should support that, too.\r\n\r\nRegarding the history of this ticket and the associated discussions, I can understand the arguments on both sides. I agree that joining the roles by a comma should be the responsibility of the specific driver instead of Metabase itself, but I also don't see that this (temporary?) bugfix would significantly impair functionality or pose a risk. The method was designed with one input role and one output string in mind, so it was never expected to work with a vector of roles anyways. Thus, I would not expect that changing the (unintended) vector output back to a string output breaks anything. Of course, this should be properly documented and tracked with an according cleanup task once the design plan is revised for multi-role scenarios. \r\n\r\nBut for now, we would really appreciate a short-term fix to unblock our transition to Metabase Enterprise w/ Connection Impersonation. Regarding the workaround as recommended on [this PR comment](https://github.com/metabase/metabase/pull/47246#issuecomment-2322037240):\r\n> Until we support this use case officially, you may be able to work around this by storing the concatenated list of roles as a string directly in the user attributes.\r\n\r\nTo my knowledge, this is not easily doable in Keycloak. It would require us to implement a custom User Attribute Mapper or a Script Mapper because Keycloak does not provide this functionality out of the box with its standard mappers."", 'created_at': datetime.datetime(2024, 9, 9, 13, 51, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338776287, 'issue_id': 2488903237, 'author': 'paoliniluis', 'body': '@Gerrit-K please contact our helpdesk', 'created_at': datetime.datetime(2024, 9, 9, 18, 10, 6, tzinfo=datetime.timezone.utc)}, {'comment_id': 2342823274, 'issue_id': 2488903237, 'author': 's-huk', 'body': '@Gerrit-K Thank you for pointing this out (exactly my thoughts too):\r\n> The method was designed with one input role and one output string in mind, so it was never expected to work with a vector of roles anyways. Thus, I would not expect that changing the (unintended) vector output back to a string output breaks anything. Of course, this should be properly documented and tracked with an according cleanup task once the design plan is revised for multi-role scenarios.\r\n\r\n@dpsutton @noahmoss \r\nSounds like a good plan to proceed, doesnt it?\r\n\r\nAnd, yes, this is exactly what we have to deal with too:\r\n> To my knowledge, this is not easily doable in Keycloak. It would require us to implement a custom User Attribute Mapper or a Script Mapper because Keycloak does not provide this functionality out of the box with its standard mappers.', 'created_at': datetime.datetime(2024, 9, 11, 7, 2, 57, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-08-27 12:22:42 UTC): Hi there, we should be reviewing and shipping the fix soon, but I wanted to check the use case here as I'm not fully getting why you would like to pass 2 roles to a database. What's the use case here?

s-huk (Issue Creator) on (2024-08-27 16:19:54 UTC): Hi, we use impersonation as described [in this article](https://www.metabase.com/learn/metabase-basics/administration/permissions/impersonation#:~:text=Impersonation%20is%20a%20permissions%20setting,your%20database%20executes%20the%20query) (esp. ""Impersonation sets permissions for questions written in both the SQL editor and the query builder"").

Our Tables/Databases are partitioned into various domains or project groups. More precisely, this setup resembles a hypergraph where each hyperedge represents a role or project group. Depending on a user's participation in a project group, they are assigned the corresponding role, and users can hold multiple roles simultaneously. This approach helps us avoid the combinatorial explosion of database connections, while facilitating data joins across multiple project groups with proper authorization - regardless of whether users are utilizing the Metabase query builder or query editor.

paoliniluis on (2024-08-27 16:59:14 UTC): @s-huk you're using clickhouse as the DW is that correct?

s-huk (Issue Creator) on (2024-08-28 08:03:07 UTC): @paoliniluis yes, and we have already taken a look at the [metabase-clickhouse-driver](https://github.com/ClickHouse/metabase-clickhouse-driver/blob/master/src/metabase/driver/clickhouse.clj#L274-L299)

noahmoss on (2024-08-30 17:36:38 UTC): Relabeled as feature request after discussion with product.

s-huk (Issue Creator) on (2024-08-31 11:35:21 UTC): Once again, I suggested a sound and very easy solution in PR #47246 (then you wouldn't have to create a separate issue for the bug and solve that one).

So, why don't we just merge this PR, and add this description to your role impersonation documentation: 
```
If the database role attribute is not a string but a collection of strings (like a JSON array), then it will automatically be reduced to a comma-separated String. For exmaple, collections like [""a"", ""b"", ""c""] will automatically be reduced to ""a,b,c"".
```

This would make all of us happy, because...

- You wouldn't have to fix the bug anymore.
- Databases that can activate only one role
  - ...could work with text (as currently) or singleton collections as well
  - ...should return the most reasonable error message in case of multiple comma-separated values
- Databases which can activate more than one role...
  - ...could work with text (as currently) or comma-separated input as well

And existing drivers wouldn't have to be modified nor bothered, because reducing a collection of roles to a comma-separated role string aligns with the SQL syntax of every possible driver's SQL dialect.

**Under the bottom line**: Roughly nothing would have to be done, and you wouldn't have to impair the quality of your software. Or am I missing something?

noahmoss on (2024-09-03 19:57:52 UTC): @s-huk As I noted previously, concatenation of strings using commas is a driver implementation detail. Even _if_ every driver does this in the same way, they may have different rules around quoting individual roles, or other syntax differences. For instance, our Postgres driver already will [quote a role](https://github.com/metabase/metabase/blob/master/src/metabase/driver/postgres.clj#L968-L969) if it includes non-alphanumeric characters. 

It's plausible that a future driver could have both requirements—multiple roles and special quoting rules—in which case your proposed implementation would not work. Or a future might have a different syntax for multiple roles altogether.

I'm open to the idea of updating `driver/set-role!` and `driver/set-role-statement!` to take a list of strings in place of a single string. If you'd like to submit a new PR with this approach (or another approach which doesn't have the issue above) I'm happy to review it.

s-huk (Issue Creator) on (2024-09-04 17:02:47 UTC): I will consult with my team to determine whether to participate here, comparing it to other possible solutions.

It sounds like you want to change the type, i.e., first overload the set-role-statement method somehow and then gradually phase out the non-set method from every possible driver.

s-huk (Issue Creator) on (2024-09-06 09:31:00 UTC): @noahmoss
Before I contribute vainly to unnecessarily impairing the simplicity and clarity of the driver interface, I need to ask you again: **Are you really sure you want to change the type of the role variable from a string to a collection of strings?**

To reconsider this more clearly, let's focus on the following role input scenarios which can occur:

1. The role attribute is a string consisting of exactly one role.
2. The role attribute is a string consisting of multiple roles, comma-separated by the user.
3. The role attribute is a collection.

Instead of changing/extending the type of your interface's `role` variable, I would suggest simplifying scenario 3 into scenario 2.

As you point out, Metabase can't validate or transform input from scenario 2. Only the drivers can transform such strings according to their underlying database syntax, as you already mentioned. And why wouldn’t the drivers be able to handle this with, e.g., regular expressions instead of collections?

Therefore, I still recommend merging PR #47246 (which already maps scenario 3 into 2). Upon closer inspection, it still seems to be the most straightforward and less complicated solution. It works with all possible drivers as long as there is no more than one role involved (role input scenarios 1-3 would all be supported). It also already supports multiple roles in drivers like Clickhouse. As for Postgres, this system doesn't seem to support multiple roles anyway.

If there is a database with special quoting rules that supports multiple roles, we would simply need to adapt its driver to handle comma-separated strings - so what? (because this would have to be done anyways, to be able to handle input scenario 2)

dpsutton on (2024-09-06 16:27:52 UTC): Hi @s-huk 

I've setup a user with the following login_attributes  `{:email ""sandbox@metabase.com"", :id 2, :login_attributes {""id"" ""1""}}` and setup sandboxing on that attribute, i see the following
<img width=""1370"" alt=""image"" src=""https://github.com/user-attachments/assets/c295cb61-1826-44ff-a7c7-230edc409be5"">


If I update the login attributes to mirror the proposed allowable shape here, `{:email ""sandbox@metabase.com"", :id 2, :login_attributes {""id"" [""1"" ""2""]}}` the sandboxing breaks with an invalid shape.
<img width=""1370"" alt=""image"" src=""https://github.com/user-attachments/assets/53199363-3270-48da-beac-4cba82d51ea4"">

We have logs that complain about the invalid shape

```
2024-09-06 11:21:43,499 WARN lib.normalize :: Error normalizing pMBQL:
...
2024-09-06 11:21:43,507 WARN lib.convert :: Clean: Removing bad clause in [:filters 0 2 3] due to error {:filters [[nil nil [nil nil nil [""should be nil"" ""should be a boolean"" ""should be a string"" ""should be an integer"" ""should be a double"" ""instance of java.lang.Float"" ""instance of java.math.BigDecimal"" ""instance of java.time.LocalDate"" ""date string literal"" ""local time string literal"" ""offset time string literal"" ""instance of java.time.LocalTime"" ""instance of java.time.OffsetTime"" ""local date time string literal"" ""offset date time string literal"" ""instance of java.time.LocalDateTime"" ""instance of java.time.OffsetDateTime"" ""instance of java.time.ZonedDateTime""]]]]}:
{:filters [[nil nil [nil nil nil :1]]]}

2024-09-06 11:21:43,508 WARN lib.convert :: Clean: Removing bad clause in [:filters 0 2 3] due to error :malli.core/end-of-input:
{:filters
 [[nil
   nil
   [nil {:lib/uuid ""2c859dba-33cb-4e97-9a23-92eb8868b4b0""} [nil {:lib/uuid ""1ff83655-552a-45bd-958e-0ee67e6764aa""}]]
   [:=
    {:lib/uuid ""acfbd23b-c4b6-472e-aea4-15c09b5df9f2""}
    [:field {:base-type :type/BigInteger, :lib/uuid ""c5c77b10-c3fb-44ed-91ae-7dbabea7a36f""} 62]
    2]]]}

2024-09-06 11:21:43,508 WARN lib.convert :: Clean: Removing bad clause in [:filters 0 3] due to error :malli.core/end-of-input:
{:filters
 [[:or
   {:lib/uuid ""9fe2e75c-3b6f-4d8d-8596-722f5b68d79f""}
   [:=
    {:lib/uuid ""acfbd23b-c4b6-472e-aea4-15c09b5df9f2""}
    [:field {:base-type :type/BigInteger, :lib/uuid ""c5c77b10-c3fb-44ed-91ae-7dbabea7a36f""} 62]
    2]]]}

2024-09-06 11:21:43,508 WARN lib.convert :: Clean: Removing bad clause in [:filters] due to error :malli.core/limits:
{:filters []}
```

And I think we have to decline the mechanism you are proposing. It is changing a data shape that flows throughout our system and you are only thinking of the consequences of it in one 3rd party driver.  As per your statement ""Do you really insist on spaghettifying type insecurity into all possible drivers?"", I think we are carefully considering the changes we allow to the product and a change letting a string randomly be a collection would actually spagettify type insecurity into a lot of code paths.

Again, I appreciate you engaging with a PR and we will consider how to land this feature. But we will not do so at the expense of silently breaking sandboxing.

s-huk (Issue Creator) on (2024-09-09 07:30:59 UTC): @dpsutton Hi, I didnt suggest ""letting a string randomly be a collection"" (just @noahmoss seems to think in this direction). PR #47246 solely proposes to homogenize it to a string if it accidentally turns out to be a collection. So sticking with your example, I would rather suggest to transform something like `{:email ""sandbox@metabase.com"", :id 2, :login_attributes {""id"" [""1"" ""2""]}}` to `{:email ""sandbox@metabase.com"", :id 2, :login_attributes {""id"" ""1,2""}}`.

Gerrit-K on (2024-09-09 13:51:42 UTC): Chiming in from a different company, but with a very similar setup as @s-huk: we use Metabase Enterprise behind Keycloak to query data from ClickHouse. This bug (/ missing feature, if you like) is currently blocking our rollout of Connection Impersonation, which was one of the key features for us to buy the Enterprise license in the first place.

It's a pity that the existence of multiple roles was not considered for the first concept of this feature, because I think it's a rather common case. Users often have not just one distinct but many different, potentially even overlapping roles set via their IdP and all the DBMS I've come across support users with multiple roles, so IMO Metabase should support that, too.

Regarding the history of this ticket and the associated discussions, I can understand the arguments on both sides. I agree that joining the roles by a comma should be the responsibility of the specific driver instead of Metabase itself, but I also don't see that this (temporary?) bugfix would significantly impair functionality or pose a risk. The method was designed with one input role and one output string in mind, so it was never expected to work with a vector of roles anyways. Thus, I would not expect that changing the (unintended) vector output back to a string output breaks anything. Of course, this should be properly documented and tracked with an according cleanup task once the design plan is revised for multi-role scenarios. 

But for now, we would really appreciate a short-term fix to unblock our transition to Metabase Enterprise w/ Connection Impersonation. Regarding the workaround as recommended on [this PR comment](https://github.com/metabase/metabase/pull/47246#issuecomment-2322037240):

To my knowledge, this is not easily doable in Keycloak. It would require us to implement a custom User Attribute Mapper or a Script Mapper because Keycloak does not provide this functionality out of the box with its standard mappers.

paoliniluis on (2024-09-09 18:10:06 UTC): @Gerrit-K please contact our helpdesk

s-huk (Issue Creator) on (2024-09-11 07:02:57 UTC): @Gerrit-K Thank you for pointing this out (exactly my thoughts too):

@dpsutton @noahmoss 
Sounds like a good plan to proceed, doesnt it?

And, yes, this is exactly what we have to deal with too:

"
2488815164,issue,closed,completed,Cover scoped search in Entity Picker with e2e tests,,kamilmielnik,2024-08-27 09:42:26+00:00,[],2024-10-02 13:12:23+00:00,2024-10-02 13:12:23+00:00,https://github.com/metabase/metabase/issues/47294,"[('.CI & Tests', ''), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2388611661, 'issue_id': 2488815164, 'author': 'kamilmielnik', 'body': 'Superseded by #48122', 'created_at': datetime.datetime(2024, 10, 2, 13, 12, 23, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-10-02 13:12:23 UTC): Superseded by #48122

"
2488815043,issue,closed,completed,Cover scoped search in Entity Picker with unit tests (remaining),Placeholder issue. Might not be necessary as I will aim to add new tests together with product changes.,kamilmielnik,2024-08-27 09:42:23+00:00,[],2024-08-27 14:11:46+00:00,2024-08-27 14:11:21+00:00,https://github.com/metabase/metabase/issues/47293,[],[],
2488814934,issue,closed,completed,Use database instead of schema when database only has 1 schema,,kamilmielnik,2024-08-27 09:42:20+00:00,['kamilmielnik'],2024-09-11 07:32:48+00:00,2024-09-11 07:32:48+00:00,https://github.com/metabase/metabase/issues/47292,"[('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2342878338, 'issue_id': 2488814934, 'author': 'kamilmielnik', 'body': 'Closed by #47801', 'created_at': datetime.datetime(2024, 9, 11, 7, 32, 48, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-09-11 07:32:48 UTC): Closed by #47801

"
2488814806,issue,closed,completed,Add scoped search in the Search tab in Entity Picker,,kamilmielnik,2024-08-27 09:42:18+00:00,['kamilmielnik'],2024-09-13 20:36:10+00:00,2024-09-13 20:36:10+00:00,https://github.com/metabase/metabase/issues/47291,"[('.Frontend', ''), ('.Team/Querying', '')]",[],
2488814712,issue,closed,completed,Change search input placeholder depending on selected folder & tab in Entity Picker,,kamilmielnik,2024-08-27 09:42:15+00:00,['kamilmielnik'],2024-09-11 07:32:43+00:00,2024-09-11 07:32:43+00:00,https://github.com/metabase/metabase/issues/47290,"[('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2342878153, 'issue_id': 2488814712, 'author': 'kamilmielnik', 'body': 'Closed by #47801', 'created_at': datetime.datetime(2024, 9, 11, 7, 32, 43, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-09-11 07:32:43 UTC): Closed by #47801

"
2488814612,issue,closed,completed,Return to previously opened tab when search input is cleared in Entity Picker,,kamilmielnik,2024-08-27 09:42:13+00:00,['kamilmielnik'],2024-09-10 14:45:20+00:00,2024-09-10 14:45:20+00:00,https://github.com/metabase/metabase/issues/47289,"[('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2341079173, 'issue_id': 2488814612, 'author': 'kamilmielnik', 'body': 'Closed by #47798', 'created_at': datetime.datetime(2024, 9, 10, 14, 45, 20, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-09-10 14:45:20 UTC): Closed by #47798

"
2488814502,issue,closed,completed,Maintain selected folder state in Entity Picker,,kamilmielnik,2024-08-27 09:42:10+00:00,['kamilmielnik'],2024-09-02 09:32:37+00:00,2024-09-02 09:32:37+00:00,https://github.com/metabase/metabase/issues/47288,"[('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2324272345, 'issue_id': 2488814502, 'author': 'kamilmielnik', 'body': 'Closed by #47309', 'created_at': datetime.datetime(2024, 9, 2, 9, 32, 37, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-09-02 09:32:37 UTC): Closed by #47309

"
2488707481,issue,closed,completed,Dropdown filters display as text fields once embedded,"### Describe the bug

We're experiencing and issue where filters that are set as dropdowns in the Metabse UI are displaying as text fields when embedded in our app.

This is happening to multiple filters, but not to all of them. Additionally, one of the dropdown filters shows one option when there should be four.

Here are screenshots of the two scenarios:
![image](https://github.com/user-attachments/assets/3b1fea82-7190-4812-9493-7c5ef1bc68a0)
![image](https://github.com/user-attachments/assets/c8e6569b-62c6-4dc9-abb6-12fc8ecaf29a)

We have tried:

- Clearing the field caches in Admin > Table Metadata
- Adding custom values to the dropdown list
- Changing the table type to ENUM instead of Category
- Unlocking the Locked filter

Further details:

Database: Postgres
Embedding method: Python

Strangely it seems that the API actually returns an empty array for the filter values:
![image](https://github.com/user-attachments/assets/df446874-f971-4e8f-a408-f53e8a8938a4)

Entering a value that exists into the filter does work and results are filtered accordingly.

We also made a very basic dashboard with a basic query and only two filters to replicate this issue in the least complex scenario.

Here is the Metabase dash showing the two filters and the status filter correctly populated:
![image](https://github.com/user-attachments/assets/399bd20d-7841-4803-872e-18f9eb52392c)

Here is the embedded view showing the status filter with only one of three options (in other cases this shows as a text field):
![image](https://github.com/user-attachments/assets/ca105c30-cfd6-4848-9035-eada90e2d2e6)

I think we have narrowed it down to a specific scenario though.

Our app is a 'multi-tenanted' app with multiple organisations and we pre-filter results per org by dynamically passing in the org param via the backend. We make the org filter a locked param in the embed settings (screenshot below).

![image](https://github.com/user-attachments/assets/f76a1a7b-c71e-473c-bb6d-d9d733cf1595)

Making the org filter Editable in the embed settings doesn't make any difference.

If we remove the org filter from the query then the embedded version gets all the dropdown options.

Here is how we are handling the param injection via the backend:
![image](https://github.com/user-attachments/assets/5ff23757-3207-4ae3-8d3f-66a86db17217)

### To Reproduce

1. Create a dashboard with drop down (list of values) filters
2. Embed dashboard and inject params via backend (Python)
3. Drop downs are not populated fully or display as text fields - value route returns empty array

![image](https://github.com/user-attachments/assets/2ea4cd49-fe33-4787-b519-7046a6b759b9)



### Expected behavior

The value route should return the array of values and the drop downs should work as expected. 

### Logs

{"" values"" : [], ""has more values"": false}

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-ZA"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-1053-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.1 (Debian 16.1-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-13"",
      ""tag"": ""v0.50.20"",
      ""hash"": ""df82d58""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

It's a relatively big impact on the end user. 

### Additional context

_No response_",lonelyviking,2024-08-27 08:57:00+00:00,[],2025-01-22 07:46:20+00:00,2025-01-21 18:17:37+00:00,https://github.com/metabase/metabase/issues/47286,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2323101292, 'issue_id': 2488707481, 'author': 'paoliniluis', 'body': ""@lonelyviking when you embed, all filters behave as if they were linked together, to avoid data leakage. If you embed locking a filter, then all the other filters (no matter if they're linked or not) will be linked to the value you pass"", 'created_at': datetime.datetime(2024, 9, 1, 1, 16, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2328072114, 'issue_id': 2488707481, 'author': 'lonelyviking', 'body': '@paoliniluis Thanks for the feedback. That makes total sense. In this case all the other filters are supposed to be linked to the locked Org filter and should always return data (as they do outside of the embedded scenario and when the filter is not locked).', 'created_at': datetime.datetime(2024, 9, 4, 7, 1, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2397225153, 'issue_id': 2488707481, 'author': 'akshayhubilo', 'body': 'Any update here?', 'created_at': datetime.datetime(2024, 10, 7, 15, 18, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2397405935, 'issue_id': 2488707481, 'author': 'lonelyviking', 'body': '> Any update here?\n\n@akshayhubilo No, nothing new. All of the values we were dealing with happened to be enums that will always be the same no matter the Org filter value so we ended up just adding them as custom values to the dropdown filter element which has worked for us. Not ideal, but the dash is working for the users at least.', 'created_at': datetime.datetime(2024, 10, 7, 16, 38, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2426782861, 'issue_id': 2488707481, 'author': 'ranquild', 'body': ""Looks like a BE only bug since the FE requests field values and the BE (incorrectly) returns an empty list. While the author of the issue doesn't mention it, I expect that there is a complex permission setup here."", 'created_at': datetime.datetime(2024, 10, 21, 14, 4, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2443000744, 'issue_id': 2488707481, 'author': 'paoliniluis', 'body': '@lonelyviking so the data type of all fields in the database are enums, is that correct? I would love to try to provide a clear reproduction here so we can fix it', 'created_at': datetime.datetime(2024, 10, 29, 1, 52, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2445370399, 'issue_id': 2488707481, 'author': 'heypoom', 'body': 'I tried to reproduce this issue by static embedding a dashboard, setting one of the parameters to ""Locked"" and other parameters to ""Editable"" in the embedding settings, then pass the values from the backend (using the Node.js script as-is, which should be equivalent to the Python script present in this ticket from what I can see)\n\n![Image](https://github.com/user-attachments/assets/e0769434-f53d-4216-b1f1-fa71b898ccd5)\n\nI\'m still getting a correctly-filtered result, and I couldn\'t get the parameters to become text.\n\n![Image](https://github.com/user-attachments/assets/252b0752-f14b-4f2b-a748-a8cc4cf768f2)\n\nAs Alex mentioned, I also suspect that this is partially caused by sandboxing or permissions setup in the instance. It would be great if we can see the sandboxing or permissions setup, so we can try to replicate that.', 'created_at': datetime.datetime(2024, 10, 29, 21, 32, 55, tzinfo=datetime.timezone.utc)}, {'comment_id': 2455101545, 'issue_id': 2488707481, 'author': 'LauraPumarejo', 'body': '@heypoom  I have had this same problem as described by @lonelyviking  since version 0.49 and the reproduction of the scenario is when **tabs** are used. If you look at it, it has tabs but in your example presented there are no **tabs**.', 'created_at': datetime.datetime(2024, 11, 4, 16, 2, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2477134354, 'issue_id': 2488707481, 'author': 'noahmoss', 'body': ""I'm also unable to reproduce. @lonelyviking or @LauraPumarejo — could you provide information about the permissions setup on your instance? If you have access to the app DB used by Metabase, I'd also be interested in seeing the value stored in `metabase_database.embedding_params` for the dashboard in question (you can find the ID in the dashboard URL, and then run a query like `select embedding_params from report_dashboard where id = <id>;`)"", 'created_at': datetime.datetime(2024, 11, 14, 18, 28, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2481320743, 'issue_id': 2488707481, 'author': 'perivamsi', 'body': 'Moving this to P2 while we gather more details around this', 'created_at': datetime.datetime(2024, 11, 17, 15, 40, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2593130981, 'issue_id': 2488707481, 'author': 'amandaflotelime', 'body': ""Is there any update on this issue? My customer is having a lot of trouble with this bug and they really need the filter features. Otherwise we'll have to create 200+ dashboards for them. Our filters work when we use a public share link but it only works from time to time once it's embedded."", 'created_at': datetime.datetime(2025, 1, 15, 15, 12, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2594390730, 'issue_id': 2488707481, 'author': 'perivamsi', 'body': '@amandaflotelime if you have steps to reproduce this issue, that will be very helpful', 'created_at': datetime.datetime(2025, 1, 16, 3, 16, 20, tzinfo=datetime.timezone.utc)}, {'comment_id': 2598283135, 'issue_id': 2488707481, 'author': 'amandaflotelime', 'body': ""@perivamsi I don't really have steps to reproduce it. BU ti could show you exemples if we book a meeting"", 'created_at': datetime.datetime(2025, 1, 17, 12, 41, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2598764456, 'issue_id': 2488707481, 'author': 'perivamsi', 'body': ""@amandaflotelime I'll have someone reach out to you to book a meeting"", 'created_at': datetime.datetime(2025, 1, 17, 16, 44, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2598848166, 'issue_id': 2488707481, 'author': 'paoliniluis', 'body': '@amandaflotelime Luis here from the Success team. I met with your team several times and we would need you to upgrade Metabase as we have a very strong belief that this issue is already fixed by now', 'created_at': datetime.datetime(2025, 1, 17, 17, 26, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2605437826, 'issue_id': 2488707481, 'author': 'paoliniluis', 'body': 'Closing due to no response', 'created_at': datetime.datetime(2025, 1, 21, 18, 17, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2606510505, 'issue_id': 2488707481, 'author': 'amandaflotelime', 'body': ""Hello again, i checked with our developers and they're asking in which version this is fixed? :)"", 'created_at': datetime.datetime(2025, 1, 22, 7, 46, 18, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-09-01 01:16:25 UTC): @lonelyviking when you embed, all filters behave as if they were linked together, to avoid data leakage. If you embed locking a filter, then all the other filters (no matter if they're linked or not) will be linked to the value you pass

lonelyviking (Issue Creator) on (2024-09-04 07:01:57 UTC): @paoliniluis Thanks for the feedback. That makes total sense. In this case all the other filters are supposed to be linked to the locked Org filter and should always return data (as they do outside of the embedded scenario and when the filter is not locked).

akshayhubilo on (2024-10-07 15:18:15 UTC): Any update here?

lonelyviking (Issue Creator) on (2024-10-07 16:38:24 UTC): @akshayhubilo No, nothing new. All of the values we were dealing with happened to be enums that will always be the same no matter the Org filter value so we ended up just adding them as custom values to the dropdown filter element which has worked for us. Not ideal, but the dash is working for the users at least.

ranquild on (2024-10-21 14:04:10 UTC): Looks like a BE only bug since the FE requests field values and the BE (incorrectly) returns an empty list. While the author of the issue doesn't mention it, I expect that there is a complex permission setup here.

paoliniluis on (2024-10-29 01:52:34 UTC): @lonelyviking so the data type of all fields in the database are enums, is that correct? I would love to try to provide a clear reproduction here so we can fix it

heypoom on (2024-10-29 21:32:55 UTC): I tried to reproduce this issue by static embedding a dashboard, setting one of the parameters to ""Locked"" and other parameters to ""Editable"" in the embedding settings, then pass the values from the backend (using the Node.js script as-is, which should be equivalent to the Python script present in this ticket from what I can see)

![Image](https://github.com/user-attachments/assets/e0769434-f53d-4216-b1f1-fa71b898ccd5)

I'm still getting a correctly-filtered result, and I couldn't get the parameters to become text.

![Image](https://github.com/user-attachments/assets/252b0752-f14b-4f2b-a748-a8cc4cf768f2)

As Alex mentioned, I also suspect that this is partially caused by sandboxing or permissions setup in the instance. It would be great if we can see the sandboxing or permissions setup, so we can try to replicate that.

LauraPumarejo on (2024-11-04 16:02:52 UTC): @heypoom  I have had this same problem as described by @lonelyviking  since version 0.49 and the reproduction of the scenario is when **tabs** are used. If you look at it, it has tabs but in your example presented there are no **tabs**.

noahmoss on (2024-11-14 18:28:45 UTC): I'm also unable to reproduce. @lonelyviking or @LauraPumarejo — could you provide information about the permissions setup on your instance? If you have access to the app DB used by Metabase, I'd also be interested in seeing the value stored in `metabase_database.embedding_params` for the dashboard in question (you can find the ID in the dashboard URL, and then run a query like `select embedding_params from report_dashboard where id = <id>;`)

perivamsi on (2024-11-17 15:40:43 UTC): Moving this to P2 while we gather more details around this

amandaflotelime on (2025-01-15 15:12:02 UTC): Is there any update on this issue? My customer is having a lot of trouble with this bug and they really need the filter features. Otherwise we'll have to create 200+ dashboards for them. Our filters work when we use a public share link but it only works from time to time once it's embedded.

perivamsi on (2025-01-16 03:16:20 UTC): @amandaflotelime if you have steps to reproduce this issue, that will be very helpful

amandaflotelime on (2025-01-17 12:41:14 UTC): @perivamsi I don't really have steps to reproduce it. BU ti could show you exemples if we book a meeting

perivamsi on (2025-01-17 16:44:10 UTC): @amandaflotelime I'll have someone reach out to you to book a meeting

paoliniluis on (2025-01-17 17:26:40 UTC): @amandaflotelime Luis here from the Success team. I met with your team several times and we would need you to upgrade Metabase as we have a very strong belief that this issue is already fixed by now

paoliniluis on (2025-01-21 18:17:37 UTC): Closing due to no response

amandaflotelime on (2025-01-22 07:46:18 UTC): Hello again, i checked with our developers and they're asking in which version this is fixed? :)

"
2488691889,issue,closed,completed,Error saving query results to cache: Unfreezable type: class clojure.lang.Atom,"### Describe the bug

In the logs, I have this error which is not related to a question.

### To Reproduce

nothing

### Expected behavior

_No response_

### Logs

```
août 27 10:44:58 xxxx metabase[60372]: 2024-08-27 10:44:58,345 INFO middleware.cache :: Query 14ca91ae took 1,1 s to run; minimum for cache eligibility is 20,0 ms; eligible
août 27 10:44:58 xxxx metabase[60372]: 2024-08-27 10:44:58,347 INFO middleware.cache :: Caching results for next time for query with hash ""14ca91ae"".
août 27 10:44:58 xxxx metabase[60372]: 2024-08-27 10:44:58,348 ERROR middleware.cache :: Error saving query results to cache: Unfreezable type: class clojure.lang.Atom
août 27 10:44:58 xxxx metabase[60372]: clojure.lang.ExceptionInfo: Unfreezable type: class clojure.lang.Atom {:type clojure.lang.Atom, :as-str ""#object[clojure.lang.Atom 0x7f2cde94 {:status :ready, :val {:metadata/card [153 153 153 153 153]}}]""}
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$throw_unfreezable.invokeStatic(nippy.clj:953)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$throw_unfreezable.invoke(nippy.clj:950)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38683.invokeStatic(nippy.clj:1188)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38683.invoke(nippy.clj:1170)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38347$G__38331__38354.invoke(nippy.clj:580)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38655$fn__38662$fn__38663$fn__38664.invoke(nippy.clj:1146)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38655$fn__38662$fn__38663.invoke(nippy.clj:1143)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentVector.reduce(PersistentVector.java:343)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$reduce.invokeStatic(core.clj:6886)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$reduce.invoke(core.clj:6869)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38655$fn__38662.invoke(nippy.clj:1143)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38347$G__38331__38354.invoke(nippy.clj:580)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38384.invokeStatic(nippy.clj:605)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38384.invoke(nippy.clj:596)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38365$G__38360__38372.invoke(nippy.clj:587)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$write_map$fn__38460$fn__38461.invoke(nippy.clj:862)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$write_map$fn__38460.invoke(nippy.clj:850)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap$NodeSeq.kvreduce(PersistentHashMap.java:1307)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap$BitmapIndexedNode.kvreduce(PersistentHashMap.java:802)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap$NodeSeq.kvreduce(PersistentHashMap.java:1312)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap$BitmapIndexedNode.kvreduce(PersistentHashMap.java:802)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap.kvreduce(PersistentHashMap.java:236)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$fn__8525.invokeStatic(core.clj:6909)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$fn__8525.invoke(core.clj:6889)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core.protocols$fn__8257$G__8252__8266.invoke(protocols.clj:175)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$reduce_kv.invokeStatic(core.clj:6920)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$reduce_kv.invoke(core.clj:6911)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$write_map.invokeStatic(nippy.clj:850)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$write_map.invoke(nippy.clj:839)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38636.invokeStatic(nippy.clj:1115)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38636.invoke(nippy.clj:1115)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38347$G__38331__38354.invoke(nippy.clj:580)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38379.invokeStatic(nippy.clj:602)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38379.invoke(nippy.clj:596)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38365$G__38360__38372.invoke(nippy.clj:587)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$write_map$fn__38460$fn__38461.invoke(nippy.clj:862)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$write_map$fn__38460.invoke(nippy.clj:850)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap$NodeSeq.kvreduce(PersistentHashMap.java:1307)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap$BitmapIndexedNode.kvreduce(PersistentHashMap.java:802)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap$NodeSeq.kvreduce(PersistentHashMap.java:1312)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap$BitmapIndexedNode.kvreduce(PersistentHashMap.java:802)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.PersistentHashMap.kvreduce(PersistentHashMap.java:236)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$fn__8525.invokeStatic(core.clj:6909)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$fn__8525.invoke(core.clj:6889)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core.protocols$fn__8257$G__8252__8266.invoke(protocols.clj:175)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$reduce_kv.invokeStatic(core.clj:6920)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$reduce_kv.invoke(core.clj:6911)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$write_map.invokeStatic(nippy.clj:850)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$write_map.invoke(nippy.clj:839)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38636.invokeStatic(nippy.clj:1115)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38636.invoke(nippy.clj:1115)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38347$G__38331__38354.invoke(nippy.clj:580)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38379.invokeStatic(nippy.clj:602)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38379.invoke(nippy.clj:596)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$fn__38365$G__38360__38372.invoke(nippy.clj:587)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$freeze_to_out_BANG_.invokeStatic(nippy.clj:961)
août 27 10:44:58 xxxx metabase[60372]:         at taoensso.nippy$freeze_to_out_BANG_.invoke(nippy.clj:958)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$freeze_BANG_.invokeStatic(impl.clj:51)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$freeze_BANG_.invoke(impl.clj:48)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization$in_STAR___70363$fn__70364.invoke(impl.clj:86)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization$in_STAR___70363.invoke(impl.clj:85)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$add_object_to_cache_BANG_.invokeStatic(cache.clj:61)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$add_object_to_cache_BANG_.invoke(cache.clj:57)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$save_results_xform$fn__70461.invoke(cache.clj:100)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$transduce.invokeStatic(core.clj:6949)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$transduce.invokeStatic(core.clj:6943)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$transduce.invoke(core.clj:6934)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$append_queries_reduce_fn$multiple_reducing__81551$fn__81555.invoke(pivot.clj:312)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70508$fn__70509.invoke(cache.clj:214)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70508.invoke(cache.clj:210)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pipeline$_STAR_run_STAR_$respond__57147.invoke(pipeline.clj:95)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$execute_reducible_query$fn__82217.invoke(execute.clj:724)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$fn__82010$fn__82011.invoke(execute.clj:397)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$do_with_resolved_connection.invokeStatic(execute.clj:337)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$do_with_resolved_connection.invoke(execute.clj:320)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$fn__82010.invokeStatic(execute.clj:391)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$fn__82010.invoke(execute.clj:389)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.MultiFn.invoke(MultiFn.java:244)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:707)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:693)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:704)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:693)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc$fn__110077.invokeStatic(sql_jdbc.clj:78)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver.sql_jdbc$fn__110077.invoke(sql_jdbc.clj:76)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.MultiFn.invoke(MultiFn.java:244)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$run.invokeStatic(execute.clj:60)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$run.invoke(execute.clj:54)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.update_used_cards$update_used_cards_BANG_$fn__70549.invoke(update_used_cards.clj:58)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$add_native_form_to_result_metadata$fn__70564.invoke(execute.clj:23)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__70569.invoke(execute.clj:34)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$run_query_with_cache.invokeStatic(cache.clj:215)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$run_query_with_cache.invoke(cache.clj:188)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___70522.invoke(cache.clj:241)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.permissions$check_query_permissions$fn__64370.invoke(permissions.clj:119)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64980.invoke(enterprise.clj:51)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64990.invoke(enterprise.clj:64)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$execute$fn__70596.invoke(execute.clj:92)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$execute.invokeStatic(execute.clj:91)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$execute.invoke(execute.clj:87)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.enterprise$fn__65007$handle_audit_app_internal_queries__65008$fn__65010.invoke(enterprise.clj:96)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__65018.invoke(enterprise.clj:103)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76360.invoke(process_userland_query.clj:202)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.catch_exceptions$catch_exceptions$fn__76429.invoke(catch_exceptions.clj:128)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query$fn__76466.invoke(query_processor.clj:78)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query.invokeStatic(query_processor.clj:76)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query.invoke(query_processor.clj:69)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$process_query_append_results.invokeStatic(pivot.clj:244)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$process_query_append_results.invoke(pivot.clj:225)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$process_queries_append_results$fn__81541.invoke(pivot.clj:259)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core.protocols$fn__8249.invokeStatic(protocols.clj:168)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core.protocols$fn__8249.invoke(protocols.clj:124)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core.protocols$fn__8204$G__8199__8213.invoke(protocols.clj:19)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core.protocols$seq_reduce.invokeStatic(protocols.clj:31)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core.protocols$fn__8234.invokeStatic(protocols.clj:75)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core.protocols$fn__8234.invoke(protocols.clj:75)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core.protocols$fn__8178$G__8173__8191.invoke(protocols.clj:13)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$reduce.invokeStatic(core.clj:6887)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$reduce.invoke(core.clj:6869)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$process_queries_append_results.invokeStatic(pivot.clj:256)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$process_queries_append_results.invoke(pivot.clj:249)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$append_queries_reduce_fn$multiple_reducing__81551$fn__81557.invoke(pivot.clj:314)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$append_queries_reduce_fn$multiple_reducing__81551.invoke(pivot.clj:309)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70508$fn__70509.invoke(cache.clj:214)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$run_query_with_cache$reduce_SINGLEQUOTE___70508.invoke(cache.clj:210)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pipeline$_STAR_run_STAR_$respond__57147.invoke(pipeline.clj:95)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$append_queries_execute_fn$multiple_execute__81547.invoke(pivot.clj:280)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$run.invokeStatic(execute.clj:60)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$run.invoke(execute.clj:54)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.update_used_cards$update_used_cards_BANG_$fn__70549.invoke(update_used_cards.clj:58)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$add_native_form_to_result_metadata$fn__70564.invoke(execute.clj:23)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__70569.invoke(execute.clj:34)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$run_query_with_cache.invokeStatic(cache.clj:215)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$run_query_with_cache.invoke(cache.clj:188)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___70522.invoke(cache.clj:241)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.permissions$check_query_permissions$fn__64370.invoke(permissions.clj:119)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64980.invoke(enterprise.clj:51)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64990.invoke(enterprise.clj:64)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$execute$fn__70596.invoke(execute.clj:92)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$execute.invokeStatic(execute.clj:91)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.execute$execute.invoke(execute.clj:87)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.enterprise$fn__65007$handle_audit_app_internal_queries__65008$fn__65010.invoke(enterprise.clj:96)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__65018.invoke(enterprise.clj:103)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76360.invoke(process_userland_query.clj:202)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.middleware.catch_exceptions$catch_exceptions$fn__76429.invoke(catch_exceptions.clj:128)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query$fn__76466.invoke(query_processor.clj:78)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query.invokeStatic(query_processor.clj:76)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor$process_query.invoke(query_processor.clj:69)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$process_multiple_queries.invokeStatic(pivot.clj:339)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$process_multiple_queries.invoke(pivot.clj:329)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$run_pivot_query$fn__81598.invoke(pivot.clj:469)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_canceled_chan$fn__65422.invoke(setup.clj:189)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_database_local_settings$fn__65417.invoke(setup.clj:181)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_driver$fn__65412$fn__65413.invoke(setup.clj:166)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver$do_with_driver.invokeStatic(driver.clj:105)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.driver$do_with_driver.invoke(driver.clj:100)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_driver$fn__65412.invoke(setup.clj:165)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_metadata_provider$fn__65405$fn__65408.invoke(setup.clj:151)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:171)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.store$do_with_metadata_provider.invoke(store.clj:151)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:160)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.store$do_with_metadata_provider.invoke(store.clj:151)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_metadata_provider$fn__65405.invoke(setup.clj:150)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_resolved_database$fn__65399.invoke(setup.clj:128)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$run_pivot_query.invokeStatic(pivot.clj:460)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.pivot$run_pivot_query.invoke(pivot.clj:450)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.api.public$process_query_for_card_with_id_run_fn$run__98855$fn__98856$fn__98857.invoke(public.clj:140)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.server.middleware.session$do_with_current_user.invokeStatic(session.clj:425)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.server.middleware.session$do_with_current_user.invoke(session.clj:408)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.api.public$process_query_for_card_with_id_run_fn$run__98855$fn__98856.invoke(public.clj:139)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.streaming$_streaming_response$fn__68924$fn__68925$fn__68926.invoke(streaming.clj:175)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.streaming$_streaming_response$fn__68924$fn__68925.invoke(streaming.clj:174)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.query_processor.streaming$_streaming_response$fn__68924.invoke(streaming.clj:171)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.AFn.applyToHelper(AFn.java:156)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.AFn.applyTo(AFn.java:144)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$apply.invokeStatic(core.clj:667)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1990)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1990)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.RestFn.applyTo(RestFn.java:142)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$apply.invokeStatic(core.clj:671)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.core$bound_fn_STAR_$fn__5818.doInvoke(core.clj:2020)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.RestFn.invoke(RestFn.java:421)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)
août 27 10:44:58 xxxx metabase[60372]:         at metabase.async.streaming_response$do_f_async$task__52241.invoke(streaming_response.clj:87)
août 27 10:44:58 xxxx metabase[60372]:         at clojure.lang.AFn.run(AFn.java:22)
août 27 10:44:58 xxxx metabase[60372]:         at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
août 27 10:44:58 xxxx metabase[60372]:         at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
août 27 10:44:58 xxxx metabase[60372]:         at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
août 27 10:44:58 xxxx metabase[60372]:         at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
août 27 10:44:58 xxxx metabase[60372]:         at java.base/java.lang.Thread.run(Thread.java:829)
```


### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""fr"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64; rv:129.0) Gecko/20100101 Firefox/129.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-21"",
      ""tag"": ""v0.50.21"",
      ""hash"": ""ec9f5d7""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Paris""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MariaDB"",
        ""version"": ""10.5.15-MariaDB-0+deb11u1""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.15+10-post-Debian-1deb11u1"",
    ""java.vendor"": ""Debian"",
    ""java.vendor.url"": ""https://tracker.debian.org/openjdk-11"",
    ""java.version"": ""11.0.15"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.15+10-post-Debian-1deb11u1"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.0-14-amd64"",
    ""user.language"": ""fr"",
    ""user.timezone"": ""Europe/Paris""
  }
}
```


### Severity

annoying

### Additional context

_No response_",Philippe-M,2024-08-27 08:50:20+00:00,['bshepherdson'],2024-10-30 14:55:34+00:00,2024-10-23 11:40:27+00:00,https://github.com/metabase/metabase/issues/47284,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('Querying/Cache', ''), ('.Escalation', ''), ('.Team/Querying', ''), ('Frequency:Often', 'Something users bump into often')]","[{'comment_id': 2313045768, 'issue_id': 2488691889, 'author': 'alxnddr', 'body': 'Moving to the webapp team since the caching ownership has been [transferred](https://metaboat.slack.com/archives/C05NXACAG1G/p1724765896056579?thread_ts=1724748634.973379&cid=C05NXACAG1G)', 'created_at': datetime.datetime(2024, 8, 27, 16, 40, 9, tzinfo=datetime.timezone.utc)}, {'comment_id': 2341988755, 'issue_id': 2488691889, 'author': 'ixipixi', 'body': 'Reproduction steps:\r\n\r\n- Turn on question cache\r\n- Create a pivot table on the Sample orders table\r\n- Refresh the pivot\r\n- Observe logs for error', 'created_at': datetime.datetime(2024, 9, 10, 20, 51, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2342811288, 'issue_id': 2488691889, 'author': 'Philippe-M', 'body': 'Hello, same problem with 0.50.24', 'created_at': datetime.datetime(2024, 9, 11, 6, 55, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2425640375, 'issue_id': 2488691889, 'author': 'Philippe-M', 'body': '#48873', 'created_at': datetime.datetime(2024, 10, 21, 5, 43, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2447422631, 'issue_id': 2488691889, 'author': 'github-actions[bot]', 'body': '🚀 This should also be released by [v0.51.1](https://github.com/metabase/metabase/milestone/231)', 'created_at': datetime.datetime(2024, 10, 30, 14, 55, 33, tzinfo=datetime.timezone.utc)}]","alxnddr on (2024-08-27 16:40:09 UTC): Moving to the webapp team since the caching ownership has been [transferred](https://metaboat.slack.com/archives/C05NXACAG1G/p1724765896056579?thread_ts=1724748634.973379&cid=C05NXACAG1G)

ixipixi on (2024-09-10 20:51:37 UTC): Reproduction steps:

- Turn on question cache
- Create a pivot table on the Sample orders table
- Refresh the pivot
- Observe logs for error

Philippe-M (Issue Creator) on (2024-09-11 06:55:38 UTC): Hello, same problem with 0.50.24

Philippe-M (Issue Creator) on (2024-10-21 05:43:29 UTC): #48873

github-actions[bot] on (2024-10-30 14:55:33 UTC): 🚀 This should also be released by [v0.51.1](https://github.com/metabase/metabase/milestone/231)

"
2488628231,issue,closed,completed,[Testing plan] Search in selection in entity picker,"Testing plan for #47281

### Dimensions

- [x] Entity Picker component
  - [x] Collection picker _(e.g. add question to collection)_
  - [x] Dashboard picker _(e.g. add new question to dashboard)_
  - [x] Data picker _(e.g. choose question data source)_
  - [x] Question picker _(e.g. add question to dashboard)_
- [x] Entity type
  - [x] Saved Questions
  - [x] Models
  - [x] Metrics
  - [x] Tables
  - [x] Collections
  - [x] Dashboards
- [x] Entity Picker tabs (All entity types + Recents + Search)
- [x] ""Folder"" type
  - [x] Collection
  - [x] Database
  - [x] Schema
- [x] Nesting (direct or indirect ""folder"" descendant)
- [x] Number of schemas in database
- [x] Root collection being available or not
- [x] Permissions
- [x] Tables - name vs display_name
- [x] Schema-less databases - MySQL

### E2e tests
- [x] preserves tab state (selected ""folder"") when navigating to a different tab
- [x] when opening a new tab, automatically select the first item in the first column
  - [x] account for case when ""Our analytics"" is not there
- [x] returns to previous tab when search input is cleared
- [x] changes search input placeholder depending on which folder and tab is selected
- [x] for each entity type (various entity picker components):
  - [x] shows locally filtered results when given ""folder"" is selected
    - [x] assert results counter value
  - [x] shows global results when using the ""Everywhere"" toggle in search tab
    - [x] assert results counter value
- [x] shows global results when coming from recents tab
  - [x] assert results counter value
  - [x] new toggle in Search tab is not displayed
- [x] tables
  - [x] uses schema as a ""folder"" if database is multi-schema
  - [x] uses database as a ""folder"" if database only has 1 schema
  - [x] uses database as a ""folder"" if database has no schemas
- [x] test for root collection not being available",kamilmielnik,2024-08-27 08:21:22+00:00,['kamilmielnik'],2024-10-31 10:46:08+00:00,2024-10-31 10:46:07+00:00,https://github.com/metabase/metabase/issues/47282,"[('.TestingStrategy/FE', '')]","[{'comment_id': 2449556288, 'issue_id': 2488628231, 'author': 'kamilmielnik', 'body': 'Implemented, closing', 'created_at': datetime.datetime(2024, 10, 31, 10, 46, 7, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-10-31 10:46:07 UTC): Implemented, closing

"
2488627060,issue,closed,completed,[Epic] Search in selection in entity picker,"### Links
- [Product doc](https://www.notion.so/metabase/Search-in-selection-in-entity-picker-e4d830a6a35a416abb135e103de1d452)
- [Figma](https://www.figma.com/design/06jovUhXOrsRO8FYZi7G1d/Data-picker-improvements?node-id=6337-13756&t=ZNdlYTiiKu4u3CCl-0)
- Testing plan: #47282
- Feature branch: `entity-picker-scoped-search`
  - PR: #47755
- Links:
  - Prototype: #46518
  - [Slack (design exploration & prototype)](https://metaboat.slack.com/archives/C0645JP1W81/p1722430559770769)
  - [Slack (alternative suggestion)](https://metaboat.slack.com/archives/C0645JP1W81/p1724169658897609)
  - #47182

### Milestone 1

```[tasklist]
### Frontend
- [ ] https://github.com/metabase/metabase/issues/47288
- [ ] https://github.com/metabase/metabase/issues/47502
- [ ] https://github.com/metabase/metabase/issues/47454
- [ ] https://github.com/metabase/metabase/issues/47289
- [ ] https://github.com/metabase/metabase/issues/47290
- [ ] https://github.com/metabase/metabase/issues/47292
- [ ] https://github.com/metabase/metabase/issues/47291
- [ ] https://github.com/metabase/metabase/pull/48122
- [ ] https://github.com/metabase/metabase/issues/47182
```",kamilmielnik,2024-08-27 08:20:48+00:00,"['kamilmielnik', 'ranquild']",2024-10-10 07:21:12+00:00,2024-10-08 08:05:10+00:00,https://github.com/metabase/metabase/issues/47281,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2488571537,issue,closed,completed,Analytics event for newsletter subscription opt-in/opt-out during the setup,,npretto,2024-08-27 07:52:27+00:00,['npretto'],2024-10-01 22:18:22+00:00,2024-09-05 13:06:18+00:00,https://github.com/metabase/metabase/issues/47280,"[('.Team/Embedding', '')]",[],
2488568588,issue,closed,completed,Non-ASCII Characters in CSV Column Names Cause SQL Syntax Error in Metabase Upload,"### Describe the bug

When uploading a CSV file to Metabase where the column names contain non-ASCII characters (e.g., Japanese characters), the upload fails with an SQL syntax error. This issue occurs despite the fact that rows containing non-ASCII text are handled correctly when column names are in English.

### To Reproduce

1. Create a CSV file with non-ASCII characters (e.g., Japanese) in the column names.
   - Example CSV content:

   ```csv
   ID,名前,年齢,職業,都市
   1,佐藤太郎,25,エンジニア,東京
   2,鈴木花子,30,デザイナー,大阪
   3,田中一郎,28,マーケター,名古屋
   4,山田次郎,35,プロジェクトマネージャー,福岡
   5,中村美咲,32,データサイエンティスト,札幌
   ```

2. Attempt to upload the CSV file to Metabase.

3. Observe the error message:

   ```
   (conn=20363649) You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '%90%8D%E5%89%8D(), E5%B9%B4%E9%BD%A2(), E8%81%B7%E6%A5%AD(), E9%83%BD%E5%B8%82()' at line 1
   ```

### Expected behavior

The CSV file should be uploaded without errors, with non-ASCII characters in column names correctly interpreted and stored.

### Logs

(conn=20363649) You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '%90%8D%E5%89%8D(), E5%B9%B4%E9%BD%A2(), E8%81%B7%E6%A5%AD(), E9%83%BD%E5%B8%82()' at line 1


### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.6 Safari/605.1.15"",
    ""vendor"": ""Apple Computer, Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.38-59.109.amzn2023.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""postgres""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.37""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-06-19"",
      ""tag"": ""v0.50.6"",
      ""hash"": ""a5fbebf""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Tokyo""
    }
  }
}
```


### Severity

moderate

### Additional context

_No response_",jobins-devs,2024-08-27 07:51:10+00:00,['crisptrutski'],2024-08-30 14:22:29+00:00,2024-08-28 21:59:59+00:00,https://github.com/metabase/metabase/issues/47279,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Team/Workflows', 'aka BEC'), ('Organization/Uploads', 'Direct data upload (CSV)')]","[{'comment_id': 2312290731, 'issue_id': 2488568588, 'author': 'crisptrutski', 'body': ""Thanks for the report. \r\n\r\nIt turns out that the issue is only triggered if there are columns that start with a non-ASCII character, so you can work around it by adding a prefix to the relevant headers, e.g. \r\n\r\n```\r\nID,_名前,_年齢,_職業,_都市\r\n```\r\n\r\nWe're working on a fix and it should land in the next patch and minor releases.\r\n\r\nNote that the column names will also be encoded, so you will need to configure display names manually for now. We plan to improve this in the future."", 'created_at': datetime.datetime(2024, 8, 27, 11, 22, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2313945746, 'issue_id': 2488568588, 'author': 'jobins-devs', 'body': '@crisptrutski Thank you for prompt response, will do use workaround as possible.', 'created_at': datetime.datetime(2024, 8, 28, 2, 6, 37, tzinfo=datetime.timezone.utc)}]","crisptrutski (Assginee) on (2024-08-27 11:22:15 UTC): Thanks for the report. 

It turns out that the issue is only triggered if there are columns that start with a non-ASCII character, so you can work around it by adding a prefix to the relevant headers, e.g. 

```
ID,_名前,_年齢,_職業,_都市
```

We're working on a fix and it should land in the next patch and minor releases.

Note that the column names will also be encoded, so you will need to configure display names manually for now. We plan to improve this in the future.

jobins-devs (Issue Creator) on (2024-08-28 02:06:37 UTC): @crisptrutski Thank you for prompt response, will do use workaround as possible.

"
2488442761,issue,closed,completed,Very Large performance difference for regular users vs Admins,"### Describe the bug

Regular users of metabase have been reporting that their dashboards are loading super slowly. This isn't the case for users with admin privileges indicating permissions related slowdowns.

This was initially flagged [here](https://github.com/metabase/metabase/issues/44359#issuecomment-2304769175) where the conclusion was to open a separate issue. Relevant information from there:


```
select count(*) from data_permissions -> 113,541

select count(*), active from metabase_table group by active
count | active
15,388 | false
1,287 | true

```


### To Reproduce

Assuming that to reproduce this there's a need to a decently large amount of data permissions.



### Expected behavior

Dashboards should load fast for all users regardless of permissions

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""clickhouse"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-21"",
      ""tag"": ""v0.50.21"",
      ""hash"": ""ec9f5d7""
    },
    ""settings"": {
      ""report-timezone"": ""UTC""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.10 (Ubuntu 13.10-1.pgdg22.04+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.219-208.866.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```


### Severity

High, preventing metabase usage by end users.

### Additional context

_No response_",apostoltego,2024-08-27 06:46:15+00:00,['noahmoss'],2024-10-17 07:16:39+00:00,2024-09-03 18:57:07+00:00,https://github.com/metabase/metabase/issues/47276,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Performance', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2312082772, 'issue_id': 2488442761, 'author': 'perivamsi', 'body': 'How much time is the dashboard taking for regular user and how much time is it taking for an admin? Are you able to look at the `/api/dashboard/:id` and the `/api/dashboard/:id/query_metadata` endpoints in browser tools and see the response time?', 'created_at': datetime.datetime(2024, 8, 27, 9, 57, 46, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312256577, 'issue_id': 2488442761, 'author': 'apostoltego', 'body': 'As an admin:\r\n- query_metadata 2s\r\n- dashboard 1s\r\n\r\nNon-Admin about ~5s each. \r\n\r\nThese are with admin priveleges:\r\n![Screenshot 2024-08-27 at 12 05 06](https://github.com/user-attachments/assets/4187eab4-cdbf-4ae7-a16c-aafe0dc659cf)\r\n![Screenshot 2024-08-27 at 12 05 12](https://github.com/user-attachments/assets/51ea5107-f0fa-453c-ae56-cf61823b5ac4)\r\n\r\n\r\nRegular permissions:\r\n\r\n![Screenshot 2024-08-27 at 12 07 47](https://github.com/user-attachments/assets/e9597929-2ab9-4b5a-aab1-4e87b4acea81)\r\n![Screenshot 2024-08-27 at 12 07 53](https://github.com/user-attachments/assets/cd03933c-5686-4f1d-85b6-fe980a4d1fa2)', 'created_at': datetime.datetime(2024, 8, 27, 11, 10, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312570145, 'issue_id': 2488442761, 'author': 'bshepherdson', 'body': 'This might be caused by #46181.', 'created_at': datetime.datetime(2024, 8, 27, 13, 30, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2313295703, 'issue_id': 2488442761, 'author': 'noahmoss', 'body': '@apostoltego How many databases do you have, and what is the distribution of tables across the databases? The output of this would be helpful to see:\r\n```\r\nselect count(*), db_id from metabase_table group by db_id;\r\n```\r\n\r\nI have a solution in mind involving finer-grained caching but this would help me verify that this will work for your use case.', 'created_at': datetime.datetime(2024, 8, 27, 18, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2313402103, 'issue_id': 2488442761, 'author': 'apostoltego', 'body': '<img width=""277"" alt=""Screenshot 2024-08-27 at 21 56 17"" src=""https://github.com/user-attachments/assets/5888c184-e228-4e1f-9769-0080f47e4769"">\r\nI\'ve added the active flag as well as tons of the table listed aren\'t active. \r\nThere\'s loads of reasons but primarily older stuff that was present during the years and potentially metabase schema scans conflicting with dbt runs. Another big reason are Airbyte runs and schemas that were being scanned in the past that aren\'t now.\r\n\r\nFurthermore, of all the databases there, only 2 of them are used by non-admins.', 'created_at': datetime.datetime(2024, 8, 27, 20, 1, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2322511952, 'issue_id': 2488442761, 'author': 'FilmonK', 'body': ""Hey Team\r\nHave a cloud customer on 1.50.23 running into something similar with admin and non-admin/sandboxed users.\r\nI have a couple of their dashboards I can reference but we've been primarily looking at one.\r\n\r\n<br>\r\n\r\nGeneral stats\r\nTables - 4,046 | 1,261-active | 2,785 - not active\r\nCollections - 419\r\n\r\n<br>\r\n\r\nAdmin user - 5 seconds\r\n![admin_user](https://github.com/user-attachments/assets/33bc85f9-f702-405d-bae7-85cf07261d4b)\r\n\r\n<br>\r\n\r\nNon-admin user - 58 seconds\r\n![non-admin_user](https://github.com/user-attachments/assets/9eee5b07-8477-40dc-9065-d9b23e424a38)"", 'created_at': datetime.datetime(2024, 8, 30, 22, 44, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2327208582, 'issue_id': 2488442761, 'author': 'noahmoss', 'body': 'Closing in favor of https://github.com/metabase/metabase/issues/47582 for the issue reported above', 'created_at': datetime.datetime(2024, 9, 3, 18, 57, 7, tzinfo=datetime.timezone.utc)}, {'comment_id': 2416539266, 'issue_id': 2488442761, 'author': 'csp33', 'body': 'hi, this is still happening\nhttps://github.com/metabase/metabase/issues/36442#issuecomment-2416530002', 'created_at': datetime.datetime(2024, 10, 16, 11, 31, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2417301447, 'issue_id': 2488442761, 'author': 'paoliniluis', 'body': '@csp33 please send us version and a reproduction so we can track this down', 'created_at': datetime.datetime(2024, 10, 16, 16, 16, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2418747459, 'issue_id': 2488442761, 'author': 'csp33', 'body': 'Hi @paoliniluis \nI think https://github.com/metabase/metabase/issues/36442#issuecomment-2416530002 is related. I believe the root cause is that admin user permissions take much less time to evaluate than users who have multiple groups', 'created_at': datetime.datetime(2024, 10, 17, 7, 14, 44, tzinfo=datetime.timezone.utc)}]","perivamsi on (2024-08-27 09:57:46 UTC): How much time is the dashboard taking for regular user and how much time is it taking for an admin? Are you able to look at the `/api/dashboard/:id` and the `/api/dashboard/:id/query_metadata` endpoints in browser tools and see the response time?

apostoltego (Issue Creator) on (2024-08-27 11:10:51 UTC): As an admin:
- query_metadata 2s
- dashboard 1s

Non-Admin about ~5s each. 

These are with admin priveleges:
![Screenshot 2024-08-27 at 12 05 06](https://github.com/user-attachments/assets/4187eab4-cdbf-4ae7-a16c-aafe0dc659cf)
![Screenshot 2024-08-27 at 12 05 12](https://github.com/user-attachments/assets/51ea5107-f0fa-453c-ae56-cf61823b5ac4)


Regular permissions:

![Screenshot 2024-08-27 at 12 07 47](https://github.com/user-attachments/assets/e9597929-2ab9-4b5a-aab1-4e87b4acea81)
![Screenshot 2024-08-27 at 12 07 53](https://github.com/user-attachments/assets/cd03933c-5686-4f1d-85b6-fe980a4d1fa2)

bshepherdson on (2024-08-27 13:30:02 UTC): This might be caused by #46181.

noahmoss (Assginee) on (2024-08-27 18:58:00 UTC): @apostoltego How many databases do you have, and what is the distribution of tables across the databases? The output of this would be helpful to see:
```
select count(*), db_id from metabase_table group by db_id;
```

I have a solution in mind involving finer-grained caching but this would help me verify that this will work for your use case.

apostoltego (Issue Creator) on (2024-08-27 20:01:08 UTC): <img width=""277"" alt=""Screenshot 2024-08-27 at 21 56 17"" src=""https://github.com/user-attachments/assets/5888c184-e228-4e1f-9769-0080f47e4769"">
I've added the active flag as well as tons of the table listed aren't active. 
There's loads of reasons but primarily older stuff that was present during the years and potentially metabase schema scans conflicting with dbt runs. Another big reason are Airbyte runs and schemas that were being scanned in the past that aren't now.

Furthermore, of all the databases there, only 2 of them are used by non-admins.

FilmonK on (2024-08-30 22:44:26 UTC): Hey Team
Have a cloud customer on 1.50.23 running into something similar with admin and non-admin/sandboxed users.
I have a couple of their dashboards I can reference but we've been primarily looking at one.

<br>

General stats
Tables - 4,046 | 1,261-active | 2,785 - not active
Collections - 419

<br>

Admin user - 5 seconds
![admin_user](https://github.com/user-attachments/assets/33bc85f9-f702-405d-bae7-85cf07261d4b)

<br>

Non-admin user - 58 seconds
![non-admin_user](https://github.com/user-attachments/assets/9eee5b07-8477-40dc-9065-d9b23e424a38)

noahmoss (Assginee) on (2024-09-03 18:57:07 UTC): Closing in favor of https://github.com/metabase/metabase/issues/47582 for the issue reported above

csp33 on (2024-10-16 11:31:52 UTC): hi, this is still happening
https://github.com/metabase/metabase/issues/36442#issuecomment-2416530002

paoliniluis on (2024-10-16 16:16:43 UTC): @csp33 please send us version and a reproduction so we can track this down

csp33 on (2024-10-17 07:14:44 UTC): Hi @paoliniluis 
I think https://github.com/metabase/metabase/issues/36442#issuecomment-2416530002 is related. I believe the root cause is that admin user permissions take much less time to evaluate than users who have multiple groups

"
2487975114,issue,closed,completed,Ability to reload the user when the login session changes in embedding sdk,We should have an ability to manually reload the user when the login session changes in the embedding sdk.,heypoom,2024-08-26 23:41:24+00:00,['heypoom'],2024-08-27 21:46:58+00:00,2024-08-27 21:46:56+00:00,https://github.com/metabase/metabase/issues/47272,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2313636583, 'issue_id': 2487975114, 'author': 'heypoom', 'body': ""Closing this per [this feedback](https://metaboat.slack.com/archives/C063Q3F1HPF/p1724784214484189?thread_ts=1724751130.585409&cid=C063Q3F1HPF)\n\n> I think this is ok. This is just PoC code, once the customer changes it to use proper login it's not an issue. If it is an issue, hopefully people will tell us."", 'created_at': datetime.datetime(2024, 8, 27, 21, 46, 57, tzinfo=datetime.timezone.utc)}]","heypoom (Issue Creator) on (2024-08-27 21:46:57 UTC): Closing this per [this feedback](https://metaboat.slack.com/archives/C063Q3F1HPF/p1724784214484189?thread_ts=1724751130.585409&cid=C063Q3F1HPF)

"
2487907324,issue,closed,completed,Make static embed API endpoints `/embed/dashboard/` and `/embed/question/` accept a JWT with `entity_id`s (and/or `id`s) for dashboards or questions.,"Milestone 2 of https://github.com/metabase/metabase/issues/47042

We need to accept ids and entity-ids for questions and dashboards *in tokens* on the following endpoints.

Note: we are NOT accepting entity ids in *Route Params*. The entity id translation service covers that use-case.

## Endpoints

- [x] GET api/embed/card/:token
- [x] GET api/embed/card/:token/field/:field-id/remapping/:remapped-id
- [x] GET api/embed/card/:token/field/:field-id/search/:search-field-id
- [x] GET api/embed/card/:token/field/:field-id/values
- [x] GET api/embed/card/:token/params/:param-key/search/:prefix
- [x] GET api/embed/card/:token/params/:param-key/values
- [x] GET api/embed/card/:token/query
- [x] GET api/embed/card/:token/query/:export-format
- [x] GET api/embed/dashboard/:token
- [x] GET api/embed/dashboard/:token/dashcard/:dashcard-id/card/:card-id
- [x] GET api/embed/dashboard/:token/dashcard/:dashcard-id/card/:card-id/:export-format
- [x] GET api/embed/dashboard/:token/field/:field-id/remapping/:remapped-id
- [x] GET api/embed/dashboard/:token/field/:field-id/search/:search-field-id
- [x] GET api/embed/dashboard/:token/field/:field-id/values
- [x] GET api/embed/dashboard/:token/params/:param-key/search/:prefix
- [x] GET api/embed/dashboard/:token/params/:param-key/values
- [x] GET api/embed/pivot/card/:token/query
- [x] GET api/embed/pivot/dashboard/:token/dashcard/:dashcard-id/card/:card-id",escherize,2024-08-26 22:36:40+00:00,['escherize'],2024-09-06 20:10:53+00:00,2024-08-29 22:09:12+00:00,https://github.com/metabase/metabase/issues/47267,"[('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('.Backend', '')]",[],
2487889688,issue,open,,Driver: Actions: Athena,"Allow users to use actions when using Athena as a driver
",psalinasy,2024-08-26 22:22:13+00:00,[],2025-02-04 20:30:35+00:00,,https://github.com/metabase/metabase/issues/47266,"[('Type:New Feature', ''), ('Querying/Actions', ''), ('Database/Athena', '')]",[],
2487829196,issue,closed,completed,MB_DOWNLOAD_ROW_LIMIT isn't Applied to Subscription Attachments,"### Describe the bug

The environment variable ""MB_DOWNLOAD_ROW_LIMIT"" applies to files generated at download from the GUI but does not apply to file attachments sent in subscriptions. 

### To Reproduce

1. Run version 49.23 with MB_DOWNLOAD_ROW_LIMIT set to 5000
2. Create a simple question with the ""Orders"" table - note it shows 2000 records in the GUI
3. Download it - note it shows 5000 records in the download
4. Add it to a dashboard and send a test subscription with this table attached
5. Note the file attached to the email only has 2000 records in it


### Expected behavior

The limits set in the environment variable should apply to downloads and subscriptions. 

### Logs

_No response_

### Information about your Metabase installation

```JSON
-v49.23
```


### Severity

Annoying

### Additional context

https://github.com/metabase/metabase/pull/46401",ixipixi,2024-08-26 21:36:01+00:00,[],2024-08-27 19:12:44+00:00,2024-08-27 19:12:44+00:00,https://github.com/metabase/metabase/issues/47263,"[('Type:Bug', 'Product defects'), ('Reporting/Export', ''), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2487754994,issue,open,,Make bars with a value of 0 hoverable somehow,"**Is your feature request related to a problem? Please describe.**

In a bar visualization, if the displayed value is 0 then there is no way to access a tool tip.

**Describe the solution you'd like**

Add some sort of bar artifact that is hoverable so that a tooltip can be displayed when the value of the bar is 0.

**Describe alternatives you've considered**

* Add a small value so that the bar is not exactly 0, but this alters the true value and is not desirable.
* Use a line visualization, but this implies there is ordinality in the x axis, which is not desired when they are purely categorical.

**How important is this feature to you?**

We use Metabase for customer facing analytics and have ran into this issue many times. We need to be able to access the additional information that would be in the tooltip.

**Additional context**

![Screenshot 2024-08-26 at 4 47 16 PM](https://github.com/user-attachments/assets/2173dd9b-9985-487f-9c9f-c911117bc0b3)
",achawkins,2024-08-26 20:48:37+00:00,[],2025-02-04 20:31:46+00:00,,https://github.com/metabase/metabase/issues/47260,"[('Type:New Feature', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team'), ('Visualization/Tooltips', '')]",[],
2487654877,issue,closed,not_planned,Cannot evaluate binary expression with types Timestamp,"**Describe the bug**
I have a question that works completely fine until I add dashboard filters onto it. If I use normal filters of any type then it works, but for some reason any type of dashboard filter doesn't, while it does for all other questions in the dashboard. The error details say it's a DataFusion bug and to report it.

**The Question**
![CleanShot 2024-08-26 at 12  30 01@2x](https://github.com/user-attachments/assets/46dbac18-00fc-4dee-ba48-0eeb554bc847)
Out of Stock Time is a custom column with the expression `substring(concat([Max of LastPurchaseTime: Minute], """"), 12, 5)`

**Screenshots**
Error shown:
![CleanShot 2024-08-26 at 12  24 11@2x](https://github.com/user-attachments/assets/fe906ef1-2d78-426e-8b8c-af0e7d93a3f1)


**Omniloy Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.4.0-189-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.6""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-26"",
      ""tag"": ""v0.1"",
      ""hash"": ""93380e0""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```",lara-bellatin,2024-08-26 19:55:01+00:00,[],2025-01-08 20:59:56+00:00,2025-01-08 20:59:55+00:00,https://github.com/metabase/metabase/issues/47254,[],"[{'comment_id': 2578655781, 'issue_id': 2487654877, 'author': 'paoliniluis', 'body': ""There's no tag or version there. Please correct the version tag"", 'created_at': datetime.datetime(2025, 1, 8, 20, 59, 55, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2025-01-08 20:59:55 UTC): There's no tag or version there. Please correct the version tag

"
2487202548,issue,closed,completed,[Epic] Sidesheets,"

```[tasklist]
### Tasks
- [ ] Basic sidesheet components (#47100)
- [ ] Question info sidesheet
- [ ] Question settings sidesheet
- [ ] Dashboard settings sidesheet
- [ ] Dashboard info sidesheet
```
",rafpaf,2024-08-26 16:00:00+00:00,"['rafpaf', 'iethree']",2024-08-28 14:03:17+00:00,2024-08-28 14:03:16+00:00,https://github.com/metabase/metabase/issues/47243,"[('.Epic', 'Feature Implementation or Project')]","[{'comment_id': 2315412636, 'issue_id': 2487202548, 'author': 'iethree', 'body': 'duplicate of https://github.com/metabase/metabase/issues/42527', 'created_at': datetime.datetime(2024, 8, 28, 14, 3, 16, tzinfo=datetime.timezone.utc)}]","iethree (Assginee) on (2024-08-28 14:03:16 UTC): duplicate of https://github.com/metabase/metabase/issues/42527

"
2487183379,issue,open,,Support Serialization between versions,"**Is your feature request related to a problem? Please describe.**
Currently we don't support cross version serializaiton and we should find a way to support it.

1.46 (Source) --> export locally using 1.47 jar (and pointing jar to source Database) --> import locally to target --> 1.47 (target)

This will break the 1.47 target instance since we imported 1.46 data into a 1.47

**Describe the solution you'd like**
Support Importing YAML files which where exported from a different version than the target instance 

**Describe alternatives you've considered**
None. Apart from upgrading the instance before exporting the YAML fils.

**Additional context**
A usecase for this is metabase provisioning. If you have a default setup something like:

--> Default Dashboard (an exported YAML)
--> config file
--> env file
--> metabase version

You will always have to update the Default Dashboard to match the metabase version. So it makes this lack of support between versions an issue for provisioning metabase instances. If it's part of the flow",Tony-metabase,2024-08-26 15:50:37+00:00,[],2025-02-04 20:30:56+00:00,,https://github.com/metabase/metabase/issues/47241,"[('Type:New Feature', ''), ('Operation/Serialization', 'Enterprise contents migration')]","[{'comment_id': 2574089223, 'issue_id': 2487183379, 'author': 'david-ape', 'body': ""We don't currently use serialisation for test fixtures because they are tied to the version they were created with. We need our tests to continue to work when we upgrade Metabase. It would certainly be nice to be able to use serialization (as opposed to using the API which we have unfortunately found to be cumbersome, poorly documented and unstable, but that is a separate issue ;-)."", 'created_at': datetime.datetime(2025, 1, 6, 23, 12, 50, tzinfo=datetime.timezone.utc)}]","david-ape on (2025-01-06 23:12:50 UTC): We don't currently use serialisation for test fixtures because they are tied to the version they were created with. We need our tests to continue to work when we upgrade Metabase. It would certainly be nice to be able to use serialization (as opposed to using the API which we have unfortunately found to be cumbersome, poorly documented and unstable, but that is a separate issue ;-).

"
2487126339,issue,open,,Support partial grants,"**Is your feature request related to a problem? Please describe.**
If you use create a user with partial grants in postgres your queries will fail. The reason is simple: we sync the tables by querying the information schema and we get all the columns of the tables, instead of just checking which ones the user has access to

Repro:
1) use the sample db
2) create a user with partial grants
```
create user metabase2 with password 'test'
grant select (name, email) on people to metabase2
```
3) add the database to metabase with the new user
4) see all the queries failing as it's trying to build a query with all the fields

**Describe the solution you'd like**
We should check information_schema.role_column_grants when we do the db operations

**Describe alternatives you've considered**
You can use sandboxing

**How important is this feature to you?**
requested by a customer

**Additional context**
NA
",paoliniluis,2024-08-26 15:20:22+00:00,[],2025-02-04 20:30:35+00:00,,https://github.com/metabase/metabase/issues/47238,"[('Database/Postgres', None), ('Type:New Feature', '')]",[],
2487080452,issue,open,,We try several times to connect to the DB unsuccessfully before failing,"### Describe the bug

If the user doesn't exist then we'll try to authenticate several times before failing, when it should be just a single attempt

### To Reproduce

1) start a postgres server (the metabase-qa postgres is fine)
2) add a new user to the db with access to all the tables
3) add the db to Metabase, do a sync
4) then remove the user from the db and click on any table, see that it will take a long time to fail

### Expected behavior

We should fail immediately

### Logs

2024-08-26 14:54:53.724 UTC [9640] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:53.724 UTC [9640] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:53.724 UTC [9641] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:53.724 UTC [9641] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:54.727 UTC [9642] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:54.727 UTC [9642] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:54.728 UTC [9643] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:54.728 UTC [9643] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:55.732 UTC [9644] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:55.732 UTC [9644] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:55.732 UTC [9645] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:55.732 UTC [9645] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:56.737 UTC [9646] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:56.737 UTC [9646] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:56.737 UTC [9647] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:56.737 UTC [9647] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:57.741 UTC [9657] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:57.741 UTC [9657] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:57.741 UTC [9656] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:57.741 UTC [9656] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:58.746 UTC [9659] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:58.746 UTC [9659] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""
2024-08-26 14:54:58.746 UTC [9658] FATAL:  password authentication failed for user ""metabase2""
2024-08-26 14:54:58.746 UTC [9658] DETAIL:  Role ""metabase2"" does not exist.
	Connection matched pg_hba.conf line 100: ""host all all all scram-sha-256""

### Information about your Metabase installation

```JSON
v50, but probably this comes from before
```


### Severity

P3

### Additional context

_No response_",paoliniluis,2024-08-26 14:58:08+00:00,[],2025-02-04 20:27:37+00:00,,https://github.com/metabase/metabase/issues/47236,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Backend', ''), ('Querying/', ''), ('.Team/Querying', '')]","[{'comment_id': 2310430778, 'issue_id': 2487080452, 'author': 'paoliniluis', 'body': '@alxnddr I just removed the metadata flag, this happens after tables have sync and it triggers when you click on the table name (like doing a select .... from ...', 'created_at': datetime.datetime(2024, 8, 26, 15, 1, 31, tzinfo=datetime.timezone.utc)}]","paoliniluis (Issue Creator) on (2024-08-26 15:01:31 UTC): @alxnddr I just removed the metadata flag, this happens after tables have sync and it triggers when you click on the table name (like doing a select .... from ...

"
2487049294,issue,closed,completed,Verify how filtering on questions with pivot visualization currently works,,kamilmielnik,2024-08-26 14:43:37+00:00,[],2024-10-18 08:25:58+00:00,2024-10-18 08:25:56+00:00,https://github.com/metabase/metabase/issues/47235,"[('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2421815086, 'issue_id': 2487049294, 'author': 'kamilmielnik', 'body': ""I'll close this issue. Problems with pivot tables will be tracked in #48787.\nAlso see Slack discussion: https://metaboat.slack.com/archives/C0645JP1W81/p1729213440034179"", 'created_at': datetime.datetime(2024, 10, 18, 8, 25, 56, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-10-18 08:25:56 UTC): I'll close this issue. Problems with pivot tables will be tracked in #48787.
Also see Slack discussion: https://metaboat.slack.com/archives/C0645JP1W81/p1729213440034179

"
2486951623,issue,closed,completed,FE - e2e - Cover public & embedded dashboards with tests,,kamilmielnik,2024-08-26 13:59:47+00:00,['kamilmielnik'],2024-10-30 07:53:33+00:00,2024-10-30 07:53:31+00:00,https://github.com/metabase/metabase/issues/47234,"[('.CI & Tests', ''), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2446095894, 'issue_id': 2486951623, 'author': 'kamilmielnik', 'body': 'Closed by #49280', 'created_at': datetime.datetime(2024, 10, 30, 7, 53, 31, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-10-30 07:53:31 UTC): Closed by #49280

"
2486779290,issue,closed,completed,Migrating down from 48 to 47 reruns all the migrations from the beginning,"### Describe the bug

Seems that we're trying to re-run all migrations when downgrading

### To Reproduce

1) Start in staging a v50
2) then migrate down to v47
3) see that the core_user table wants to be re-created (since it's running from the beginning

### Expected behavior

It should work and not try to re-create all the tables

### Logs

Check the logs of cynthiastaging47 in staging

### Information about your Metabase installation

```JSON
v50
```


### Severity

P1

### Additional context

_No response_",paoliniluis,2024-08-26 12:44:18+00:00,[],2024-10-23 08:18:41+00:00,2024-10-23 08:18:41+00:00,https://github.com/metabase/metabase/issues/47232,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Operation/Database Migrations', 'Issues with application DB migrations when launching Metabase'), ('.Backend', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2311914941, 'issue_id': 2486779290, 'author': 'qnkhuat', 'body': '#caused by #34400\n\nThis broke 48->47, **but** only if the instance starts from >= 48.\nSo if you go 47->48->47 then it’s not a problem.\n\nThe reason for this is that #34400 was introduced in 48, and from that point, any new instance will run an “init” migration “00.00-000"" where its contents basically are migration from v0 -> v45.\nSo if you downgrade from 48 to 47, these v0->v45 migrations does not exist, so that’s why it was trying to run all of them again.\n\nTo fix this, we’ll need to and make sure the  databasechangelog for instances from >=48 to have databasechangelog records for all the migrations from v0->v45 that we skipped.', 'created_at': datetime.datetime(2024, 8, 27, 8, 40, 44, tzinfo=datetime.timezone.utc)}]","qnkhuat on (2024-08-27 08:40:44 UTC): #caused by #34400

This broke 48->47, **but** only if the instance starts from >= 48.
So if you go 47->48->47 then it’s not a problem.

The reason for this is that #34400 was introduced in 48, and from that point, any new instance will run an “init” migration “00.00-000"" where its contents basically are migration from v0 -> v45.
So if you downgrade from 48 to 47, these v0->v45 migrations does not exist, so that’s why it was trying to run all of them again.

To fix this, we’ll need to and make sure the  databasechangelog for instances from >=48 to have databasechangelog records for all the migrations from v0->v45 that we skipped.

"
2486761393,issue,closed,completed,Flake deserializing query action,"**Context**

Test fails on database not being loaded - this is triggered by `dataset_query` being serialized (before it was just dumped/loaded). This issue happened if `serdes/dependencies` did not return correct dependencies, but this was updated, so... a flake.

[Example](https://github.com/metabase/metabase/actions/runs/10558393234/job/29249801339?pr=47225#step:4:1447)

",piranha,2024-08-26 12:35:55+00:00,[],2024-08-27 12:41:02+00:00,2024-08-27 08:52:45+00:00,https://github.com/metabase/metabase/issues/47230,"[('flaky-test-fix', ''), ('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Workflows', 'aka BEC')]",[],
2486678278,issue,closed,completed,Dashcard titles look and act interactive when editing dashboard filter mapping,"### Describe the bug

When editing dashboard filter mapping, dashcard titles look and act interactive but they really aren't.
I can't say how many times I clicked it expecting to be navigated.


https://github.com/user-attachments/assets/b05077c1-3782-4b4b-9bf6-550acb8747d4



### To Reproduce

1. Create a question (any) and add it to a new dashboard
2. Edit the dashboard
3. Add a filter and click to edit it
4. Hover over dashcard title

:x: Cursor changes to pointer
:x: Title color changes to blue

5. Click the dashcard title

:x: There's error in JS console

```
TypeError: onClick is not a function
```

### Information about your Metabase installation

master, 2bb3eedecb55d6ba247d859b2c1b0205e35bf220


### Severity

P3
",kamilmielnik,2024-08-26 11:54:37+00:00,[],2025-02-06 13:04:17+00:00,2025-02-06 09:52:59+00:00,https://github.com/metabase/metabase/issues/47228,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Reporting/Dashboards', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2486656321,issue,closed,completed,move storybook to optional dependencies,"storybook deps can be moved to `optionalDependencies`, so CI will not spend time on installing it (in 90% of cases it's unnecessary)",uladzimirdev,2024-08-26 11:42:51+00:00,['uladzimirdev'],2024-08-26 12:31:50+00:00,2024-08-26 12:24:01+00:00,https://github.com/metabase/metabase/issues/47227,[],"[{'comment_id': 2310082325, 'issue_id': 2486656321, 'author': 'uladzimirdev', 'body': ""based on my tests, with storybook packages in optionalDependencies section, installation time at CI is 1:28, when normal installation is ~1:47s, so we can win 20s once when we change yarn.lock, which is not bad, but not a win having a more complicated configuration which we'll require to support and update if needed. \r\n\r\nAnother downside: when we pass a flag `--ignore-optional`, all optional dependencies will be ignored, one example is jspdf, which has html2canvas specified as an optional dependency, who knows which edge cases we can stumble upon\r\n\r\nTL;DR abandoned"", 'created_at': datetime.datetime(2024, 8, 26, 12, 24, 1, tzinfo=datetime.timezone.utc)}]","uladzimirdev (Issue Creator) on (2024-08-26 12:24:01 UTC): based on my tests, with storybook packages in optionalDependencies section, installation time at CI is 1:28, when normal installation is ~1:47s, so we can win 20s once when we change yarn.lock, which is not bad, but not a win having a more complicated configuration which we'll require to support and update if needed. 

Another downside: when we pass a flag `--ignore-optional`, all optional dependencies will be ignored, one example is jspdf, which has html2canvas specified as an optional dependency, who knows which edge cases we can stumble upon

TL;DR abandoned

"
2486577044,issue,closed,completed,[serdes] Transfer Collection to use spec,,piranha,2024-08-26 10:58:50+00:00,['crisptrutski'],2024-08-29 09:12:34+00:00,2024-08-27 09:05:58+00:00,https://github.com/metabase/metabase/issues/47226,"[('.Team/Workflows', 'aka BEC')]",[],
2486535341,issue,closed,completed,extract-and-log-one should become extract-one,"After every model transferred to using serialization spec, `extract-one` should become an internal detail, and `log-and-extract-one` should be renamed to `extract-one` to encapsulate proper behavior/error handling.",piranha,2024-08-26 10:35:18+00:00,['crisptrutski'],2024-09-02 06:56:08+00:00,2024-08-27 14:00:23+00:00,https://github.com/metabase/metabase/issues/47223,[],"[{'comment_id': 2311276389, 'issue_id': 2486535341, 'author': 'crisptrutski', 'body': ""@piranha I'm a bit concerned at how much logging it will add to the tests, as we have tons calling the existing method. Is the idea that those would call `extract-by-spec` directly, and that we'd delete `extract-one-basics`?\r\n\r\nI would prefer to rather replace `extract-one` with `extract-by-spec` itself."", 'created_at': datetime.datetime(2024, 8, 26, 23, 21, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312139751, 'issue_id': 2486535341, 'author': 'piranha', 'body': ""@crisptrutski hmmm haven't considered that. I've just looked at it and there are 14 calls to `extract-one` in `extract-test`, do you think it's a lot? I've already replaced some of them with `ts/extract-one` (so that `extract-nested` and try/catch are executed), so... IDK how much worse will that be. 😁\r\n\r\nI felt like the logic in `log-and-extract-one` was exactly meant for public interface, so maybe it should `extract-one` and the older one should become like `-extract-one` (or some other name and is private function?)\r\n\r\nI'm also not sure that keeping `-by-spec` suffix makes sense, if everything is done by spec, then that way it becomes serialization itself, right?"", 'created_at': datetime.datetime(2024, 8, 27, 10, 23, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312498781, 'issue_id': 2486535341, 'author': 'crisptrutski', 'body': 'I feel like the amount of logs in our tests is already way OTT. Using a private method seems fine.', 'created_at': datetime.datetime(2024, 8, 27, 13, 0, 22, tzinfo=datetime.timezone.utc)}]","crisptrutski (Assginee) on (2024-08-26 23:21:23 UTC): @piranha I'm a bit concerned at how much logging it will add to the tests, as we have tons calling the existing method. Is the idea that those would call `extract-by-spec` directly, and that we'd delete `extract-one-basics`?

I would prefer to rather replace `extract-one` with `extract-by-spec` itself.

piranha (Issue Creator) on (2024-08-27 10:23:51 UTC): @crisptrutski hmmm haven't considered that. I've just looked at it and there are 14 calls to `extract-one` in `extract-test`, do you think it's a lot? I've already replaced some of them with `ts/extract-one` (so that `extract-nested` and try/catch are executed), so... IDK how much worse will that be. 😁

I felt like the logic in `log-and-extract-one` was exactly meant for public interface, so maybe it should `extract-one` and the older one should become like `-extract-one` (or some other name and is private function?)

I'm also not sure that keeping `-by-spec` suffix makes sense, if everything is done by spec, then that way it becomes serialization itself, right?

crisptrutski (Assginee) on (2024-08-27 13:00:22 UTC): I feel like the amount of logs in our tests is already way OTT. Using a private method seems fine.

"
2486532242,issue,closed,completed,Proper E2E round-trip test (with on-disk YAMLs),"We don't have any full e2e tests (with files to test against already stored on disk) and we need even if just to see that serialization format is not changed much after every change.

It would also catch bug like #47220, since they main reason it happened - data wasn't read from disk, but used from memory.",piranha,2024-08-26 10:33:30+00:00,['crisptrutski'],2024-08-30 09:52:11+00:00,2024-08-30 08:57:15+00:00,https://github.com/metabase/metabase/issues/47222,"[('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2315241834, 'issue_id': 2486532242, 'author': 'crisptrutski', 'body': ""The e2e tests already do write to disk, but the issue is that they diff a subset of the properties in memory only.\r\n\r\nRather than more `db -> yaml -> db` testing, we're going to do `yaml -> db -> yaml`, and do an (almost) exhaustive cross-check."", 'created_at': datetime.datetime(2024, 8, 28, 12, 54, 12, tzinfo=datetime.timezone.utc)}]","crisptrutski (Assginee) on (2024-08-28 12:54:12 UTC): The e2e tests already do write to disk, but the issue is that they diff a subset of the properties in memory only.

Rather than more `db -> yaml -> db` testing, we're going to do `yaml -> db -> yaml`, and do an (almost) exhaustive cross-check.

"
2486501341,issue,closed,completed,[Epic] Serialization fixes,"It's a result of working on many serialization issues and a [post-mortem](https://www.notion.so/metabase/Serialization-too-many-bugs-over-time-17598bd6e30a4bf1929e9b13c3d8ea5a) on those.

```[tasklist]
### More transparent execution
- [x] #43068 (sub-epic)
- [ ] #45371
- [ ] #45225
- [ ] https://github.com/metabase/metabase/issues/47223
- [ ] https://github.com/metabase/metabase/issues/47222
- [ ] #46039
- [ ] https://github.com/metabase/metabase/issues/47467
```",piranha,2024-08-26 10:18:05+00:00,['piranha'],2024-09-02 12:01:02+00:00,2024-09-02 09:57:41+00:00,https://github.com/metabase/metabase/issues/47221,"[('Type:Tech Debt', 'or Refactoring'), ('.Epic', 'Feature Implementation or Project'), ('.Team/Workflows', 'aka BEC')]",[],
2486476860,issue,closed,completed,FE - e2e - Cover dashboard drills with tests,,kamilmielnik,2024-08-26 10:06:20+00:00,['kamilmielnik'],2024-10-14 10:59:29+00:00,2024-10-14 10:59:28+00:00,https://github.com/metabase/metabase/issues/47219,"[('.CI & Tests', ''), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2410865100, 'issue_id': 2486476860, 'author': 'kamilmielnik', 'body': 'Closed by #48289 + #48610', 'created_at': datetime.datetime(2024, 10, 14, 10, 59, 28, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-10-14 10:59:28 UTC): Closed by #48289 + #48610

"
2486455198,issue,open,,Empty section title rendered in dashboard filter column mapping,"### Describe the bug

![image](https://github.com/user-attachments/assets/cbfddb1c-0b05-4a10-8b9e-351496f11c25)


### To Reproduce

1. New > Question > Orders > Save
2. New > Model > Notebook > Use question from step (1) as data source > Join Reviews on Product ID = Product ID > Count > Breakout by Orders: Created At > Breakout by User: Created At > Save
3. New Dashboard > Add new date filter
4. Add model from step 2 to dashboard 
5. Try to connect the date filter to the model

There are 3 elements with `data-element-id=""list-section""` in the popover.

### Expected behavior

Double-check this with the product team.

Either one should be correct:
- Empty section item is not rendered at all
- Section title is ""Summaries"" (if we do this, then we should also do this in the filter modal)


### Information about your Metabase installation

master, 2bb3eedecb55d6ba247d859b2c1b0205e35bf220


### Severity

P3
",kamilmielnik,2024-08-26 09:56:11+00:00,[],2025-02-04 20:29:07+00:00,,https://github.com/metabase/metabase/issues/47218,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Reporting/Dashboards', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2309850623, 'issue_id': 2486455198, 'author': 'kamilmielnik', 'body': 'This issue makes test assertions difficult to reason about', 'created_at': datetime.datetime(2024, 8, 26, 10, 11, 55, tzinfo=datetime.timezone.utc)}, {'comment_id': 2446700754, 'issue_id': 2486455198, 'author': 'kamilmielnik', 'body': ""`ParameterTargetList` component uses ☠ `AccordionList` ☠ under the hood.\nFixing this issue requires modifying ☠ `AccordionList` ☠.\nAdding more logic to [`AccordionList.prototype.getRowsCached`](https://github.com/metabase/metabase/blob/92d615073a3ba31710e26be9f2e83141352d1d1c/frontend/src/metabase/core/components/AccordionList/AccordionList.jsx#L387-L524) or [`AccordionListCell`](https://github.com/metabase/metabase/blob/b4dc27a4bd2b5af1950a64ec777b74b2e7fd1356/frontend/src/metabase/core/components/AccordionList/AccordionListCell.jsx#L66-L320) is not safe and not wise.\n\nWe should fix it by getting rid of ☠ `AccordionList` ☠ component.\n\nWe're better off living with this P3 issue for a while.\nThere's a stub product doc for a new component: https://www.notion.so/metabase/Use-Mantine-list-with-search-component-7e00b534d5794aa2b677958033f1db75\n\nRelated Slack conversations:\n- https://metaboat.slack.com/archives/C01MS7DQKR6/p1722507111570469?thread_ts=1722288411.811539&cid=C01MS7DQKR6\n- https://metaboat.slack.com/archives/C02H619CJ8K/p1720716877275439?thread_ts=1720697241.917639&cid=C02H619CJ8K\n\n----\n\nI'm removing this issue from this epic: #48681"", 'created_at': datetime.datetime(2024, 10, 30, 11, 24, 1, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-08-26 10:11:55 UTC): This issue makes test assertions difficult to reason about

kamilmielnik (Issue Creator) on (2024-10-30 11:24:01 UTC): `ParameterTargetList` component uses ☠ `AccordionList` ☠ under the hood.
Fixing this issue requires modifying ☠ `AccordionList` ☠.
Adding more logic to [`AccordionList.prototype.getRowsCached`](https://github.com/metabase/metabase/blob/92d615073a3ba31710e26be9f2e83141352d1d1c/frontend/src/metabase/core/components/AccordionList/AccordionList.jsx#L387-L524) or [`AccordionListCell`](https://github.com/metabase/metabase/blob/b4dc27a4bd2b5af1950a64ec777b74b2e7fd1356/frontend/src/metabase/core/components/AccordionList/AccordionListCell.jsx#L66-L320) is not safe and not wise.

We should fix it by getting rid of ☠ `AccordionList` ☠ component.

We're better off living with this P3 issue for a while.
There's a stub product doc for a new component: https://www.notion.so/metabase/Use-Mantine-list-with-search-component-7e00b534d5794aa2b677958033f1db75

Related Slack conversations:
- https://metaboat.slack.com/archives/C01MS7DQKR6/p1722507111570469?thread_ts=1722288411.811539&cid=C01MS7DQKR6
- https://metaboat.slack.com/archives/C02H619CJ8K/p1720716877275439?thread_ts=1720697241.917639&cid=C02H619CJ8K

----

I'm removing this issue from this epic: #48681

"
2486213542,issue,open,,Visual regression tests for PDF dashboard export in embedding context,"**Context**

With [poc of using loki to test png/pdf exports (+79 −16)](https://github.com/metabase/metabase/pull/45650) we have a very basic way of testing the png exports with loki, but we didn't manage to fit the pdf export in the timebox due to issues.

856c76ef63b648a02826807078e50d20493caa38 removes the code that attempted to do it in case we want to start from that
",npretto,2024-08-26 08:01:09+00:00,[],2025-02-04 20:23:53+00:00,,https://github.com/metabase/metabase/issues/47211,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Embedding', '')]",[],
2485709579,issue,closed,completed,[Epic] Multi-dimensional / Sunburst Pie chart,"**Links**
- product doc: [Offer new viz type: Multi-dimensional / Sunburst Pie chart](https://www.notion.so/metabase/Offer-new-viz-type-Multi-dimensional-Sunburst-Pie-chart-1bf26a2d04064f45ba8918c8f87d15ac)
- feature branch:  add-sunburst-to-pie-chart
- pr: https://github.com/metabase/metabase/pull/47208

Total estimate: 20 days / 4 weeks

### ECharts Data Layer (`chartModel`) [1-2 days]
- [x] add middle ring slices to `chartModel.slices`
- [x] render basic middle ring in option
- [x] add outer ring slices to `chartModel.slices`
- [x] render basic outer ring in option
- [x] ~update `isNonPositive` to account for middle and outer ring slices~
- [x] only show unaggregated warning if last ring has unaggregated values
- [x] aggregate slices into `other` in middle and outer rings

### ECharts Viz Layer (option object, rendering viz settings, styles)

**Labels** [2-3 days]
- [x] conditionally combine slice name with percent in label
    - [x] add viz setting for this, compute a sensible default
- [x] update label rotation (might depend on ring level)
- [x] re-introduce dimension formatting to echarts code for middle & outer slices
- [x] dynamic font sizing (depends on canvas size, rings)
- [x] update `getIsLabelVisible` to account for label rotation, number of rings

**Colors** [1 day]
- [x] get light/dark variants from brand color to use in middle & outer slices
- [x] ~alternative logic for white-labeled / embedded colors?~

**Styles** [1-2 days]
- [x] update inner/outer radius logic (depends on rings)
- [x] apply minimum slice size adjust to middle & outer rings
- [x] update slice border width logic

**Total** [1-2 days]
- [x] only show sub-total for sub-slice on hover
- [x] ~dynamic font size depending on rings + canvas size~

**Tooltip/Hover/Click** [2-3 days]
- [x] update hover chart events so tooltip knows which slices to use
- [x] update tooltip UI
- [x] update legend hover events
- [x] update click event to return correct value
- [x] update tooltip UI for ""other"" slices

### Viz Settings Sidebar UI [3 days]
- [x] move measure to top
- [x] create parent component to handle all of `pie.dimension`, `pie.middle_dimension`, `pie.outer_dimension`, `pie.rows`, & `pie.sort_rows` settings
    - [x] render dropdown menus for selecting `pie.dimension`, `pie.middle_dimension`, `pie.outer_dimension`
        - [x] render `Add ring` button and modify settings/UI appropriately
    - [x] rerender/re-wire `ChartSettingOrderedSimple` and `SliceNameWidget` components for `pie.rows` setting 
    - [x] use dnd-kit to support re-ordering rings, update settings appropriately
    
### Viz Settings Computations  [1 day]
- [x] compute suitable defaults based on query results, re-use in static viz
- [x] update definition of when pie/sunburst is sensible (collab with Conor on this)

### Testing [2-3 days]
- [x] loki static viz tests
- [x] e2e tests

### Bugs
- [x] #47869
- [x] #47776
- [x] #47867
- [x] #47775
- [x] #47931
- [x] field name remapping from admin settings doesn’t work for non-inner slice
- [x] metric value should be aggregated for click actions
- [x] minimum slice percentage setting should be based on parent slice
- [x] total value text should be truncated or hidden
- [x] ~latitude/longitude don't work as metric values~
",EmmadUsmani,2024-08-26 02:27:12+00:00,['EmmadUsmani'],2024-10-08 16:13:45+00:00,2024-10-02 22:39:19+00:00,https://github.com/metabase/metabase/issues/47209,"[('.Epic', 'Feature Implementation or Project')]",[],
2485429212,issue,open,reopened,"JDBC connection setup on startup, but fail to run SQL with overflow call to c3p0 checkoutResource","### Describe the bug

Hi there, I am developing/updating a custom driver https://github.com/timeplus-io/metabase-proton-driver. The https://github.com/timeplus-io/metabase-proton-driver/releases/tag/v0.50.4 works with metabase 0.50.x but doesn't work with our latest database. After I upgraded the database jar file, I got overflow of `BasicResourcePool.checkoutResource`
```
	at com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:594) ~[metabase.jar:?]
	at com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:594) ~[metabase.jar:?]
	at com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:594) ~[metabase.jar:?]
	at com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:594) ~[metabase.jar:?]
```
However, if I define a database connection, restart the metabase server, from the server log, I can tell the JDBC connection was setup
```
2024-08-25 12:00:53,664 [main] INFO com.mchange.v2.c3p0.C3P0Registry - Initializing c3p0-0.9.5.5 [built 11-December-2019 22:18:33 -0800; debug? true; trace: 10]
2024-08-25 12:00:57,555 [main] INFO metabase.core - Starting Metabase version v0.50.21 (ec9f5d7) ...
2024-08-25 12:00:57,558 [main] INFO metabase.core - System info:
 {""file.encoding"" ""UTF-8"",
 ""java.runtime.name"" ""OpenJDK Runtime Environment"",
 ""java.runtime.version"" ""17.0.12+7"",
 ""java.vendor"" ""Eclipse Adoptium"",
 ""java.vendor.url"" ""https://adoptium.net/"",
 ""java.version"" ""17.0.12"",
 ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",
 ""java.vm.version"" ""17.0.12+7"",
 ""os.name"" ""Mac OS X"",
 ""os.version"" ""14.6.1"",
 ""user.language"" ""en"",
 ""user.timezone"" ""America/Vancouver""}
2024-08-25 12:00:57,988 [main] DEBUGcom.mchange.v2.resourcepool.BasicResourcePool - acquire test -- pool size: 0; target_pool_size: 1; desired target? 1
2024-08-25 12:00:57,988 [main] DEBUGcom.mchange.v2.resourcepool.BasicResourcePool - awaitAvailable(): [unknown]
2024-08-25 12:00:57,997 [C3P0PooledConnectionPoolManager[identityToken->z8kfltb512jk5qxyxbuky|75332dcf, dataSourceName->metabase-h2-app-db]-HelperThread-#0] DEBUGcom.timeplus.proton.jdbc.ProtonDriver - Proton Driver 0.7.1.0(JDBC: 4.2.0.0) registered
2024-08-25 12:00:59,238 [clojure-agent-send-off-pool-1] INFO metabase.driver.impl - [33mInitializing driver :proton...[0m
2024-08-25 12:00:59,238 [clojure-agent-send-off-pool-1] INFO metabase.plugins.classloader - Added URL file:/Users/jove/Dev/metabase_0.50.21/plugins/proton-driver-0.50.5.jar to classpath
2024-08-25 12:00:59,433 [clojure-agent-send-off-pool-1] TRACEmetabase.driver.proton - connection-details->spec* called with details: {:host localhost, :port 8123}
2024-08-25 12:00:59,439 [clojure-agent-send-off-pool-1] DEBUGcom.timeplus.proton.jdbc.internal.ProtonConnectionImpl - Creating a new connection to jdbc:proton:http://localhost:8123/default
2024-08-25 12:00:59,451 [clojure-agent-send-off-pool-1] DEBUGcom.timeplus.proton.client.AbstractClient - Connection established: com.timeplus.proton.client.http.HttpUrlConnectionImpl@6056d88b
```

But when I run a query say `select 95` with this data source in metabase, I got a lot of stack traces, keeping calling `BasicResourcePool.checkoutResource`

```
2024-08-25 12:01:32,422 [streaming-response-thread-pool-1] DEBUGcom.timeplus.proton.client.AbstractClient - Connecting to: ProtonNode(addr=http:localhost/<unresolved>:8123, db=default)@394117274
2024-08-25 12:01:32,423 [streaming-response-thread-pool-1] DEBUGcom.timeplus.proton.client.AbstractClient - Connection established: com.timeplus.proton.client.http.HttpUrlConnectionImpl@7fdd053e
2024-08-25 12:01:32,423 [streaming-response-thread-pool-1] DEBUGcom.mchange.v2.resourcepool.BasicResourcePool - A resource could not be refurbished for checkout. [com.mchange.v2.c3p0.impl.NewPooledConnection@62113eb]
java.sql.SQLException: Connection is invalid
	at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.testPooledConnection(C3P0PooledConnectionPool.java:573) ~[metabase.jar:?]
	at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.testPooledConnection(C3P0PooledConnectionPool.java:464) ~[metabase.jar:?]
	at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.refurbishResourceOnCheckout(C3P0PooledConnectionPool.java:339) ~[metabase.jar:?]
	at com.mchange.v2.resourcepool.BasicResourcePool.attemptRefurbishResourceOnCheckout(BasicResourcePool.java:1771) [metabase.jar:?]
	at com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:558) [metabase.jar:?]
	at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool.checkoutAndMarkConnectionInUse(C3P0PooledConnectionPool.java:758) [metabase.jar:?]
	at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool.checkoutPooledConnection(C3P0PooledConnectionPool.java:685) [metabase.jar:?]
	at com.mchange.v2.c3p0.impl.AbstractPoolBackedDataSource.getConnection(AbstractPoolBackedDataSource.java:140) [metabase.jar:?]
	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection.invokeStatic(execute.clj:336) [metabase.jar:?]
	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection.invoke(execute.clj:320) [metabase.jar:?]
	at metabase.driver.proton$eval1448$fn__1450.invoke(proton.clj:78) [?:?]
	at clojure.lang.MultiFn.invoke(MultiFn.java:244) [metabase.jar:?]
	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:707) [metabase.jar:?]
	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:693) [metabase.jar:?]
	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:704) [metabase.jar:?]
	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:693) [metabase.jar:?]
	at metabase.driver.sql_jdbc$fn__110077.invokeStatic(sql_jdbc.clj:78) [metabase.jar:?]
	at metabase.driver.sql_jdbc$fn__110077.invoke(sql_jdbc.clj:76) [metabase.jar:?]
	at clojure.lang.MultiFn.invoke(MultiFn.java:244) [metabase.jar:?]
	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47) [metabase.jar:?]
	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34) [metabase.jar:?]
	at metabase.query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97) [metabase.jar:?]
	at metabase.query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90) [metabase.jar:?]
	at metabase.query_processor.execute$run.invokeStatic(execute.clj:60) [metabase.jar:?]
	at metabase.query_processor.execute$run.invoke(execute.clj:54) [metabase.jar:?]
	at metabase.query_processor.middleware.update_used_cards$update_used_cards_BANG_$fn__70549.invoke(update_used_cards.clj:58) [metabase.jar:?]
	at metabase.query_processor.execute$add_native_form_to_result_metadata$fn__70564.invoke(execute.clj:23) [metabase.jar:?]
	at metabase.query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__70569.invoke(execute.clj:34) [metabase.jar:?]
	at metabase.query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___70522.invoke(cache.clj:242) [metabase.jar:?]
	at metabase.query_processor.middleware.permissions$check_query_permissions$fn__64370.invoke(permissions.clj:119) [metabase.jar:?]
	at metabase.query_processor.middleware.enterprise$check_download_permissions_middleware$fn__64980.invoke(enterprise.clj:51) [metabase.jar:?]
	at metabase.query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__64990.invoke(enterprise.clj:64) [metabase.jar:?]
	at metabase.query_processor.execute$execute$fn__70596.invoke(execute.clj:92) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_qp_setup.invoke(setup.clj:216) [metabase.jar:?]
	at metabase.query_processor.execute$execute.invokeStatic(execute.clj:91) [metabase.jar:?]
	at metabase.query_processor.execute$execute.invoke(execute.clj:87) [metabase.jar:?]
	at metabase.query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:47) [metabase.jar:?]
	at metabase.query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43) [metabase.jar:?]
	at metabase.query_processor.middleware.enterprise$fn__65007$handle_audit_app_internal_queries__65008$fn__65010.invoke(enterprise.clj:96) [metabase.jar:?]
	at metabase.query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__65018.invoke(enterprise.clj:103) [metabase.jar:?]
	at metabase.query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76360.invoke(process_userland_query.clj:202) [metabase.jar:?]
	at metabase.query_processor.middleware.catch_exceptions$catch_exceptions$fn__76429.invoke(catch_exceptions.clj:128) [metabase.jar:?]
	at metabase.query_processor$process_query$fn__76466.invoke(query_processor.clj:78) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_canceled_chan$fn__65422.invoke(setup.clj:189) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_database_local_settings$fn__65417.invoke(setup.clj:181) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_driver$fn__65412$fn__65413.invoke(setup.clj:166) [metabase.jar:?]
	at metabase.driver$do_with_driver.invokeStatic(driver.clj:105) [metabase.jar:?]
	at metabase.driver$do_with_driver.invoke(driver.clj:100) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_driver$fn__65412.invoke(setup.clj:165) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_metadata_provider$fn__65405$fn__65408.invoke(setup.clj:151) [metabase.jar:?]
	at metabase.query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:171) [metabase.jar:?]
	at metabase.query_processor.store$do_with_metadata_provider.invoke(store.clj:151) [metabase.jar:?]
	at metabase.query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:160) [metabase.jar:?]
	at metabase.query_processor.store$do_with_metadata_provider.invoke(store.clj:151) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_metadata_provider$fn__65405.invoke(setup.clj:150) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_resolved_database$fn__65399.invoke(setup.clj:128) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232) [metabase.jar:?]
	at metabase.query_processor.setup$do_with_qp_setup.invoke(setup.clj:216) [metabase.jar:?]
	at metabase.query_processor$process_query.invokeStatic(query_processor.clj:76) [metabase.jar:?]
	at metabase.query_processor$process_query.invoke(query_processor.clj:69) [metabase.jar:?]
	at metabase.api.dataset$run_streaming_query$fn__97277.invoke(dataset.clj:84) [metabase.jar:?]
	at metabase.query_processor.streaming$_streaming_response$fn__68924$fn__68925$fn__68926.invoke(streaming.clj:175) [metabase.jar:?]
	at metabase.query_processor.streaming$_streaming_response$fn__68924$fn__68925.invoke(streaming.clj:174) [metabase.jar:?]
	at metabase.query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165) [metabase.jar:?]
	at metabase.query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152) [metabase.jar:?]
	at metabase.query_processor.streaming$_streaming_response$fn__68924.invoke(streaming.clj:171) [metabase.jar:?]
	at clojure.lang.AFn.applyToHelper(AFn.java:156) [metabase.jar:?]
	at clojure.lang.AFn.applyTo(AFn.java:144) [metabase.jar:?]
	at clojure.core$apply.invokeStatic(core.clj:667) [metabase.jar:?]
	at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1990) [metabase.jar:?]
	at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1990) [metabase.jar:?]
	at clojure.lang.RestFn.applyTo(RestFn.java:142) [metabase.jar:?]
	at clojure.core$apply.invokeStatic(core.clj:671) [metabase.jar:?]
	at clojure.core$bound_fn_STAR_$fn__5818.doInvoke(core.clj:2020) [metabase.jar:?]
	at clojure.lang.RestFn.invoke(RestFn.java:421) [metabase.jar:?]
	at metabase.async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68) [metabase.jar:?]
	at metabase.async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66) [metabase.jar:?]
	at metabase.async.streaming_response$do_f_async$task__52241.invoke(streaming_response.clj:87) [metabase.jar:?]
	at clojure.lang.AFn.run(AFn.java:22) [metabase.jar:?]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539) [?:?]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) [?:?]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) [?:?]
	at java.base/java.lang.Thread.run(Thread.java:840) [?:?]
```

### To Reproduce

1. have 0.50.21 metabase.jar in a folder
2. put the `proton-driver-0.50.5.jar` and `proton-jdbc-0.7.1-shaded.jar` in the plugins folder
3. set the log4j2.xml as following

```xml
<?xml version=""1.0"" encoding=""UTF-8""?>
<Configuration>
  <Appenders>
    <Console name=""STDOUT"" target=""SYSTEM_OUT"" follow=""true"">
      <PatternLayout pattern=""%date %level %logger{2} :: %message%n%throwable"">
        <replace regex="":basic-auth \\[.*\\]"" replacement="":basic-auth [redacted]""/>
      </PatternLayout>
    </Console>

    <!-- This file appender is provided as an example -->
    <RollingFile name=""FILE"" fileName=""${logfile.path}/metabase.log"" filePattern=""${logfile.path}/metabase.log.%i"">
      <Policies>
        <SizeBasedTriggeringPolicy size=""500 MB""/>
      </Policies>
      <DefaultRolloverStrategy max=""2""/>
      <PatternLayout pattern=""%d [%t] %-5p %c - %m%n"">
        <replace regex="":basic-auth \\[.*\\]"" replacement="":basic-auth [redacted]""/>
      </PatternLayout>
    </RollingFile>
  </Appenders>

  <Loggers>
    <Logger name=""com.mchange"" level=""INFO""/>
    <Logger name=""liquibase"" level=""ERROR""/>
    <Logger name=""metabase"" level=""INFO""/>
    <Logger name=""metabase-enterprise"" level=""INFO""/>
    <Logger name=""metabase.metabot"" level=""DEBUG""/>
    <Logger name=""metabase.plugins"" level=""DEBUG""/>

    <Logger name=""metabase.driver.sql"" level=""TRACE""/>
    <Logger name=""metabase.driver.sql-jdbc"" level=""TRACE""/>
    <Logger name=""metabase.driver.sql_jdbc"" level=""TRACE""/>
    <Logger name=""metabase.driver.proton"" level=""TRACE""/>
    <Logger name=""metabase.driver.proton_introspection"" level=""TRACE""/>
    <Logger name=""metabase.driver.proton_qp"" level=""TRACE""/>
    <Logger name=""metabase.driver.proton_version"" level=""TRACE""/>
    <Logger name=""com.timeplus.proton"" level=""TRACE""/>
    <Logger name=""com.mchange.v2.resourcepool.BasicResourcePool"" level=""DEBUG""/>

    <Logger name=""sun.net.www.protocol.http"" level=""ERROR""/>

    <Logger name=""metabase.query-processor.async"" level=""DEBUG""/>
    <Logger name=""metabase.server.middleware"" level=""DEBUG""/>
    <Logger name=""org.quartz"" level=""INFO""/>
    <Logger name=""net.snowflake.client.jdbc.SnowflakeConnectString"" level=""ERROR""/>

    <Root level=""WARN"">
      <AppenderRef ref=""STDOUT""/>
      <AppenderRef ref=""FILE""/>
    </Root>
  </Loggers>
</Configuration>

```

Get the Timeplus proton via `https://install.timeplus.com/oss | sh`, run it with `./proton server`

### Expected behavior

Able to run SQL

### Logs

[metabase.log](https://github.com/user-attachments/files/16741665/metabase.log)


### Information about your Metabase installation

```JSON
c3p0-0.9.5.5
Metabase v0.50.21 (ec9f5d7)
JDK 17.0.12+7
[Timeplus Proton 1.5.16](https://github.com/timeplus-io/proton)
```


### Severity

Medium

### Additional context

_No response_",jovezhong,2024-08-25 19:26:17+00:00,[],2025-02-04 20:24:18+00:00,,https://github.com/metabase/metabase/issues/47207,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('.Team/Drivers', '')]","[{'comment_id': 2308965767, 'issue_id': 2485429212, 'author': 'jovezhong', 'body': 'The related c3p0 code is https://github.com/swaldman/c3p0/blob/5640dcc2e3e216953325c9ed7059626e735e5032/src/java/com/mchange/v2/c3p0/impl/C3P0PooledConnectionPool.java#L758 I am not sure what the reason behind `Connection is invalid`', 'created_at': datetime.datetime(2024, 8, 25, 19, 28, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2309931552, 'issue_id': 2485429212, 'author': 'paoliniluis', 'body': 'Hi @jovezhong, first of all I wanted to thank you for developing a driver for Metabase. A few things that come to my mind:\r\n1) please remember to always use Java 11, as we don\'t support Java 17 yet and you might run into some issues\r\n2) c3p0 performs a check on every connection checkout. I\'m seeing that you\'re doing ""SELECT count(*) > 0 FROM system.databases WHERE name = ?"" on your driver, does that query returns something? https://github.com/timeplus-io/metabase-proton-driver/blob/b007cb3c0bde6ae7d19bb4f341f66e50b83a0333/src/metabase/driver/proton.clj#L145', 'created_at': datetime.datetime(2024, 8, 26, 10, 59, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2311505945, 'issue_id': 2485429212, 'author': 'jovezhong', 'body': ""Hi @paoliniluis , thanks for the comment.  I did switch to JDK 11 (`sdk use java 11.0.24-tem`) But I hit the same issue.\r\n\r\nAccording to the log, this `(defmethod driver/can-connect? :proton` is not called. I don't see either `can-connect` tracing message or the SQL statement.\r\n\r\nI am attaching the log, at line 1857, the Proton JDBC connection established, but then C3P0PooledConnectionPool failed to test the connection on CHECKOUT\r\n```\r\n2024-08-26 20:33:42,011 [streaming-response-thread-pool-1] DEBUG com.timeplus.proton.client.AbstractClient - Connection established: com.timeplus.proton.client.http.HttpUrlConnectionImpl@1488b00e\r\n2024-08-26 20:33:42,012 [streaming-response-thread-pool-1] DEBUG com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool - Test of PooledConnection [com.mchange.v2.c3p0.impl.NewPooledConnection@798dd782] on CHECKOUT has FAILED.\r\njava.sql.SQLException: Connection is invalid\r\n\tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.testPooledConnection(C3P0PooledConnectionPool.java:573) ~[metabase.jar:?]\r\n```\r\n[metabase5.log.zip](https://github.com/user-attachments/files/16756148/metabase5.log.zip)"", 'created_at': datetime.datetime(2024, 8, 27, 3, 38, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2345024864, 'issue_id': 2485429212, 'author': 'snoe', 'body': ""Hi @jovezhong, it looks like you're using `sql-jdbc.execute/do-with-connection-with-options` in your `can-connect?` implementation. Unfortunately that functions requires an already established connection pool, and so you're seeing these repeated calls and failures.\r\n\r\n[You can see](https://github.com/metabase/metabase/blob/master/src/metabase/driver/sql_jdbc/connection.clj#L356) that `sql-jdbc/can-connect?` uses `sql-jdbc.conn/with-connection-spec-for-testing-connection` which gives you a connection that is not pooled for this purpose.."", 'created_at': datetime.datetime(2024, 9, 12, 0, 31, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2345075661, 'issue_id': 2485429212, 'author': 'jovezhong', 'body': 'Hi @snoe , thanks for looking into this. Really appreciate your help.\r\n\r\nIn this commit https://github.com/timeplus-io/metabase-proton-driver/commit/fee9ebe2ef7351cfe32e1108bb563a7381de5d08 I changed `sql-jdbc.execute/do-with-connection-with-options` to `sql-jdbc.conn/do-with-connection-spec-for-testing-connection` but still got similar error.\r\n\r\nNot sure whether I should update `(defmethod sql-jdbc.execute/do-with-connection-with-options :proton` to avoid using `sql-jdbc.execute/do-with-resolved-connection`\r\n\r\nError Log\r\n\r\n> 2024-09-11 18:16:54,713 [C3P0PooledConnectionPoolManager[identityToken->z8kfltb51r7dnwb11x0ops|560a04ca, dataSourceName->db-2-proton-null]-HelperThread-#2] TRACE com.mchange.v2.c3p0.impl.NewPooledConnection - com.mchange.v2.c3p0.impl.NewPooledConnection@5a769501 closed by a client.\r\n> java.lang.Exception: DEBUG -- CLOSE BY CLIENT STACK TRACE\r\n> \tat com.mchange.v2.c3p0.impl.NewPooledConnection.close(NewPooledConnection.java:659) [metabase.jar:?]\r\n> \tat com.mchange.v2.c3p0.impl.NewPooledConnection.closeMaybeCheckedOut(NewPooledConnection.java:255) [metabase.jar:?]\r\n> \tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.destroyResource(C3P0PooledConnectionPool.java:622) [metabase.jar:?]\r\n> \tat com.mchange.v2.resourcepool.BasicResourcePool$1DestroyResourceTask.run(BasicResourcePool.java:1114) [metabase.jar:?]\r\n> \tat com.mchange.v2.async.ThreadPoolAsynchronousRunner$PoolThread.run(ThreadPoolAsynchronousRunner.java:696) [metabase.jar:?]\r\n> 2024-09-11 18:16:54,692 [streaming-response-thread-pool-1] DEBUG com.mchange.v2.resourcepool.BasicResourcePool - A resource could not be refurbished for checkout. [com.mchange.v2.c3p0.impl.NewPooledConnection@53c95052]\r\n> java.sql.SQLException: Connection is invalid\r\n> \tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.finerLoggingTestPooledConnection(C3P0PooledConnectionPool.java:458) ~[metabase.jar:?]\r\n> \tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.finerLoggingTestPooledConnection(C3P0PooledConnectionPool.java:444) ~[metabase.jar:?]\r\n> \tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.refurbishResourceOnCheckout(C3P0PooledConnectionPool.java:337) ~[metabase.jar:?]\r\n> \tat com.mchange.v2.resourcepool.BasicResourcePool.attemptRefurbishResourceOnCheckout(BasicResourcePool.java:1771) [metabase.jar:?]\r\n> \tat com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:558)\r\n> \tat com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:594) [metabase.jar:?]\r\n> \tat com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:594) [metabase.jar:?]\r\n> \tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool.checkoutAndMarkConnectionInUse(C3P0PooledConnectionPool.java:758) [metabase.jar:?]\r\n> \tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool.checkoutPooledConnection(C3P0PooledConnectionPool.java:685) [metabase.jar:?]\r\n> \tat com.mchange.v2.c3p0.impl.AbstractPoolBackedDataSource.getConnection(AbstractPoolBackedDataSource.java:140) [metabase.jar:?]\r\n> \tat metabase.driver.sql_jdbc.execute$do_with_resolved_connection.invokeStatic(execute.clj:336) [metabase.jar:?]\r\n> \tat metabase.driver.sql_jdbc.execute$do_with_resolved_connection.invoke(execute.clj:320) [metabase.jar:?]\r\n> \tat metabase.driver.proton$eval1956$fn__1958.invoke(proton.clj:78) [?:?]', 'created_at': datetime.datetime(2024, 9, 12, 1, 29, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2345087593, 'issue_id': 2485429212, 'author': 'jovezhong', 'body': ""Here is the first 1000 lines of log [head1000.log](https://github.com/user-attachments/files/16972149/head1000.log) for your reference.\r\n\r\nThere are a quite a few SQL have been executed when the server started(I created the data source last startup) But when I ran a `select now()` testing query in the sql editor, it failed to validate the connection\r\n\r\n> 2024-09-11 18:33:48,682 [clojure-agent-send-off-pool-1] DEBUG com.timeplus.proton.client.http.ProtonHttpClient - Query: select current_user(), timezone(), version(), if_null((select to_uint8(value) from system.settings where name='readonly'), 0) AS readonly FORMAT RowBinaryWithNamesAndTypes\r\n> \r\n> 2024-09-11 18:33:48,711 [clojure-agent-send-off-pool-1] DEBUG com.timeplus.proton.client.http.ProtonHttpClient - Query: SELECT value='1' FROM system.settings WHERE name='cloud_mode'\r\n> \r\n> 2024-09-11 18:33:48,719 [clojure-agent-send-off-pool-1] DEBUG com.timeplus.proton.client.http.ProtonHttpClient - Query: select current_user(), timezone(), version(), if_null((select to_uint8(value) from system.settings where name='readonly'), 0) AS readonly FORMAT RowBinaryWithNamesAndTypes\r\n> \r\n> 2024-09-11 18:33:48,721 [clojure-agent-send-off-pool-1] DEBUG com.timeplus.proton.client.http.ProtonHttpClient - Query: WITH s AS (SELECT version() AS ver, split_by_char('.', ver) AS verSplit) SELECT s.ver, to_int32(verSplit[1]), to_int32(verSplit[2]) FROM s\r\n> \r\n> 2024-09-11 18:33:48,729 [clojure-agent-send-off-pool-1] DEBUG com.timeplus.proton.client.http.ProtonHttpClient - Query: SELECT value='1' FROM system.settings WHERE name='cloud_mode'\r\n> \r\n> 2024-09-11 18:33:48,733 [clojure-agent-send-off-pool-1] DEBUG com.timeplus.proton.client.http.ProtonHttpClient - Query: WITH s AS (SELECT version() AS ver, split_by_char('.', ver) AS verSplit) SELECT s.ver, to_int32(verSplit[1]), to_int32(verSplit[2]) FROM s"", 'created_at': datetime.datetime(2024, 9, 12, 1, 42, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2581267443, 'issue_id': 2485429212, 'author': 'paoliniluis', 'body': 'Can you check again in 52.5?', 'created_at': datetime.datetime(2025, 1, 9, 21, 20, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2581282906, 'issue_id': 2485429212, 'author': 'jovezhong', 'body': 'Thanks for the comment, we plan to try to use latest metabase later this month', 'created_at': datetime.datetime(2025, 1, 9, 21, 30, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2585051958, 'issue_id': 2485429212, 'author': 'jovezhong', 'body': 'Hi @luizarakaki , thanks for reopening this.\n\nToday I spent some time updating our metabase driver. Since our upstream is https://github.com/ClickHouse/metabase-clickhouse-driver and their latest version is based on `METABASE_VERSION=v0.51.1.2`, so I am using their codebase to support our system, basically a set of function and data type renaming. You can refer to https://github.com/timeplus-io/metabase-proton-driver/blob/mb.51/RELEASE.md, or check the change history in the `mb.51` branch.\n\nIt passed the `lein check` static check. I setup a local metabase with the compiled plugin and start it. After login and go to the admin page to create a data. I chose Proton and set the host/username/password. Click on the Save button will hit the connection pool issue again:\n\n>  at com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:594)\n\tat com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:594)', 'created_at': datetime.datetime(2025, 1, 11, 3, 54, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2585069488, 'issue_id': 2485429212, 'author': 'jovezhong', 'body': 'Here is the log file(4.5MB after compression, 280MB raw)\n\n[metabase.log.zip](https://github.com/user-attachments/files/18384278/metabase.log.zip)\n\nLine 291, I sent a query `select 1`\n\nLine 317\n\n> 2025-01-11 04:47:34,917 [streaming-response-thread-pool-1] DEBUG com.timeplus.proton.client.AbstractClient - Connection established: com.timeplus.proton.client.http.HttpUrlConnectionImpl@1bd56092\n\nBut in the next few lines\n\n> 2025-01-11 04:47:34,918 [streaming-response-thread-pool-1] DEBUG com.mchange.v2.resourcepool.BasicResourcePool - A resource could not be refurbished for checkout. [com.mchange.v2.c3p0.impl.NewPooledConnection@31d6ddd5]\njava.sql.SQLException: Connection is invalid\n\tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.testPooledConnection(C3P0PooledConnectionPool.java:573) ~[metabase.jar:?]\n\nthen keep repeating the process: Connection established -> A resource could not be refurbished for checkout -> Connection is invalid\n\nPlease help. Many thanks.', 'created_at': datetime.datetime(2025, 1, 11, 4, 57, 8, tzinfo=datetime.timezone.utc)}]","jovezhong (Issue Creator) on (2024-08-25 19:28:15 UTC): The related c3p0 code is https://github.com/swaldman/c3p0/blob/5640dcc2e3e216953325c9ed7059626e735e5032/src/java/com/mchange/v2/c3p0/impl/C3P0PooledConnectionPool.java#L758 I am not sure what the reason behind `Connection is invalid`

paoliniluis on (2024-08-26 10:59:08 UTC): Hi @jovezhong, first of all I wanted to thank you for developing a driver for Metabase. A few things that come to my mind:
1) please remember to always use Java 11, as we don't support Java 17 yet and you might run into some issues
2) c3p0 performs a check on every connection checkout. I'm seeing that you're doing ""SELECT count(*) > 0 FROM system.databases WHERE name = ?"" on your driver, does that query returns something? https://github.com/timeplus-io/metabase-proton-driver/blob/b007cb3c0bde6ae7d19bb4f341f66e50b83a0333/src/metabase/driver/proton.clj#L145

jovezhong (Issue Creator) on (2024-08-27 03:38:54 UTC): Hi @paoliniluis , thanks for the comment.  I did switch to JDK 11 (`sdk use java 11.0.24-tem`) But I hit the same issue.

According to the log, this `(defmethod driver/can-connect? :proton` is not called. I don't see either `can-connect` tracing message or the SQL statement.

I am attaching the log, at line 1857, the Proton JDBC connection established, but then C3P0PooledConnectionPool failed to test the connection on CHECKOUT
```
2024-08-26 20:33:42,011 [streaming-response-thread-pool-1] DEBUG com.timeplus.proton.client.AbstractClient - Connection established: com.timeplus.proton.client.http.HttpUrlConnectionImpl@1488b00e
2024-08-26 20:33:42,012 [streaming-response-thread-pool-1] DEBUG com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool - Test of PooledConnection [com.mchange.v2.c3p0.impl.NewPooledConnection@798dd782] on CHECKOUT has FAILED.
java.sql.SQLException: Connection is invalid
	at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.testPooledConnection(C3P0PooledConnectionPool.java:573) ~[metabase.jar:?]
```
[metabase5.log.zip](https://github.com/user-attachments/files/16756148/metabase5.log.zip)

snoe on (2024-09-12 00:31:03 UTC): Hi @jovezhong, it looks like you're using `sql-jdbc.execute/do-with-connection-with-options` in your `can-connect?` implementation. Unfortunately that functions requires an already established connection pool, and so you're seeing these repeated calls and failures.

[You can see](https://github.com/metabase/metabase/blob/master/src/metabase/driver/sql_jdbc/connection.clj#L356) that `sql-jdbc/can-connect?` uses `sql-jdbc.conn/with-connection-spec-for-testing-connection` which gives you a connection that is not pooled for this purpose..

jovezhong (Issue Creator) on (2024-09-12 01:29:58 UTC): Hi @snoe , thanks for looking into this. Really appreciate your help.

In this commit https://github.com/timeplus-io/metabase-proton-driver/commit/fee9ebe2ef7351cfe32e1108bb563a7381de5d08 I changed `sql-jdbc.execute/do-with-connection-with-options` to `sql-jdbc.conn/do-with-connection-spec-for-testing-connection` but still got similar error.

Not sure whether I should update `(defmethod sql-jdbc.execute/do-with-connection-with-options :proton` to avoid using `sql-jdbc.execute/do-with-resolved-connection`

Error Log

jovezhong (Issue Creator) on (2024-09-12 01:42:51 UTC): Here is the first 1000 lines of log [head1000.log](https://github.com/user-attachments/files/16972149/head1000.log) for your reference.

There are a quite a few SQL have been executed when the server started(I created the data source last startup) But when I ran a `select now()` testing query in the sql editor, it failed to validate the connection

paoliniluis on (2025-01-09 21:20:05 UTC): Can you check again in 52.5?

jovezhong (Issue Creator) on (2025-01-09 21:30:14 UTC): Thanks for the comment, we plan to try to use latest metabase later this month

jovezhong (Issue Creator) on (2025-01-11 03:54:59 UTC): Hi @luizarakaki , thanks for reopening this.

Today I spent some time updating our metabase driver. Since our upstream is https://github.com/ClickHouse/metabase-clickhouse-driver and their latest version is based on `METABASE_VERSION=v0.51.1.2`, so I am using their codebase to support our system, basically a set of function and data type renaming. You can refer to https://github.com/timeplus-io/metabase-proton-driver/blob/mb.51/RELEASE.md, or check the change history in the `mb.51` branch.

It passed the `lein check` static check. I setup a local metabase with the compiled plugin and start it. After login and go to the admin page to create a data. I chose Proton and set the host/username/password. Click on the Save button will hit the connection pool issue again:

	at com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:594)

jovezhong (Issue Creator) on (2025-01-11 04:57:08 UTC): Here is the log file(4.5MB after compression, 280MB raw)

[metabase.log.zip](https://github.com/user-attachments/files/18384278/metabase.log.zip)

Line 291, I sent a query `select 1`

Line 317


But in the next few lines

java.sql.SQLException: Connection is invalid
	at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.testPooledConnection(C3P0PooledConnectionPool.java:573) ~[metabase.jar:?]

then keep repeating the process: Connection established -> A resource could not be refurbished for checkout -> Connection is invalid

Please help. Many thanks.

"
2483700069,issue,open,,Using Azure Workload Identities to Rotate Database Credentials,"**Is your feature request related to a problem? Please describe.**
Rotating database credentials using Azure.

**Describe the solution you'd like**
We have a customer that utilizes Azure Entra ID and [Workload Identities](https://learn.microsoft.com/en-us/azure/aks/workload-identity-overview?tabs=dotnet) for managing credentials. The workflow would involve providing customers with Kubernetes pods and a service account that uses [OIDC](https://www.microsoft.com/en-us/security/business/security-101/what-is-openid-connect-oidc) to securely obtain database credentials that would also be used in Metabase to connect to the database.

Another idea they had based on their experience with other applications is rather than use a username and password for database authentication, there would be an argument to accept a script/redirect uri.
The logic for handling database credentials would then be handled either through this script or services like Workload Identities.

**Describe alternatives you've considered**
N/A
Continue using current username and password method for authentication.

**How important is this feature to you?**
Not a deal breaker but something that would help in multi-tenant enterprise environments.

**Additional context**
N/A
",FilmonK,2024-08-23 18:55:00+00:00,[],2025-02-04 20:31:04+00:00,,https://github.com/metabase/metabase/issues/47198,"[('Type:New Feature', ''), ('Administration/Auth', 'Google Auth, LDAP, pw+email login'), ('Administration/Databases', '')]",[],
2483590010,issue,open,,Basic calculations on table selections in the front-end,"**Is your feature request related to a problem? Please describe.**
We need a way to click and sum cells across a page simply and quickly, like you can do in Tableau and Excel.

**Describe the solution you'd like**
When you Ctrl or Cmd-click on a cell, it should start totaling and show this in some area of the screen.

**Describe alternatives you've considered**
We implemented a hack to demonstrate what we want and for our use while we wait for it to be implemented upstream. The sum/average is shown in a tooltip.

**How important is this feature to you?**
Very important, otherwise we are copying numbers to a calculator.

**Additional context**
The attached file can be included by <script src=""custom.js""></script> after renaming custom.js.txt to custom.js
Then ctrl-click (or cmd-click on a mac) to select cells.
[custom.js.txt](https://github.com/user-attachments/files/16732047/custom.js.txt)

",chrisyokum,2024-08-23 17:39:40+00:00,[],2025-02-04 20:31:57+00:00,,https://github.com/metabase/metabase/issues/47197,"[('Querying/MBQL', ''), ('Type:New Feature', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('Visualization/Tables', 'raw, summarized and tabular visualizations')]",[],
2483572237,issue,open,,X-raying a Date field in an X-ray is broken,"### Describe the bug

X-raying a Date field in an X-ray gives gives an error  

### To Reproduce

1. X-ray the Analytics table in Sample Database 
3. Scroll down to the ""Events over time"" section
4. Click on a column of the ""Events per day of the week"" cart, Click ""Automatic Insights"" and ""Xray"".
5. See that it breaks <img width=""498"" alt=""Screenshot 2024-08-23 at 2 25 55 PM"" src=""https://github.com/user-attachments/assets/f5868c98-73bb-4690-8e85-4ba44c9d49a0"">


Oddly, if you try to X-ray a date chart in the ""These Reviews across time"" section, you will get x-rays working in date fields. Seems to be happening only with bar charts


### Expected behavior

Should not break

### Logs

Assert failed: ((some-fn string? nil?) s)

### Information about your Metabase installation

```JSON
- 50.x
```


### Severity

P2

### Additional context

_No response_",ignacio-mb,2024-08-23 17:27:47+00:00,[],2025-02-04 20:31:19+00:00,,https://github.com/metabase/metabase/issues/47196,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/X-rays', ''), ('.Backend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/Querying', '')]",[],
2483539163,issue,open,,Wrong entity names and headings when X-raying Custom Expressions,"### Describe the bug

If you X-ray a chart with a custom expression, the display name will be wrong whenever that custom expression is mentioned.
<img width=""980"" alt=""Screenshot 2024-08-23 at 1 59 49 PM"" src=""https://github.com/user-attachments/assets/6a8a560d-5346-4c07-b327-3baade2e3422"">


### To Reproduce

1. Create a GUI query from Orders
2. Create a Custom expression, example: Distinct([User ID]), and add a summarization, Total
3. Save and click on some column of the chart. Select ""Automatic Insights"" and then ""X-ray""
4.  See the titles and entity names named incorrectly <img width=""980"" alt=""Screenshot 2024-08-23 at 1 59 49 PM"" src=""https://github.com/user-attachments/assets/6a8a560d-5346-4c07-b327-3baade2e3422"">

### Expected behavior

Should bring the correct name: ""Distinct Values""

### Logs

_No response_

### Information about your Metabase installation

```JSON
-50.x
```


### Severity

p3 but annoying

### Additional context

_No response_",ignacio-mb,2024-08-23 17:07:18+00:00,[],2025-02-04 20:28:56+00:00,,https://github.com/metabase/metabase/issues/47193,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Querying/X-rays', ''), ('.Backend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('Querying/Notebook/Custom Expression', ''), ('.Team/Querying', '')]",[],
2483313442,issue,open,,[Epic] Simple Metrics Overview Page,"**Links**
- [product doc](https://www.notion.so/metabase/Allow-users-to-view-all-metrics-in-one-place-de5ca5fcc8a24d8499d167a74137feac)

As part of [Allow users to view all metrics in one place](https://www.notion.so/metabase/Allow-users-to-view-all-metrics-in-one-place-de5ca5fcc8a24d8499d167a74137feac) we want to show a simple bare-bones table of metrics.

**Implementation Plan**

***Milestone 1***

```[tasklist]
- [ ] Add simple Browse metrics page like the /browser/models page
- [ ] Implement row actions (…) on the “Browse metrics” page
- [ ] Implement pagination on the “Browse metrics” page
```
<!--
***Milestone 2***
```[tasklist]
- [ ] Make “recents” work for metrics
- [ ] Add ""recents"" section to the browse metrics page
```
-->",romeovs,2024-08-23 14:48:13+00:00,[],2024-10-03 01:27:59+00:00,,https://github.com/metabase/metabase/issues/47187,"[('.Epic', 'Feature Implementation or Project')]",[],
2483254761,issue,closed,completed,Add a new SDK card setting,Epic https://github.com/metabase/metabase/issues/46970,WiNloSt,2024-08-23 14:17:55+00:00,['WiNloSt'],2024-09-05 15:19:46+00:00,2024-09-05 15:19:46+00:00,https://github.com/metabase/metabase/issues/47185,[],[],
2483244724,issue,closed,completed,`Lib.isNumber` returns `false` for aggregation-based columns after join is removed,"### Describe the bug

https://github.com/user-attachments/assets/0fdad69e-ef03-4de4-9084-6c24748402d8



### To Reproduce

_this might not be the optimal path to reproduce and certainly isn't the only possible one_

1. New > Question > Orders > Save
2. New > Model > Notebook > Use question from step (1) as data source > Join Reviews on Product ID = Product ID > Count > Save
3. New Dashboard > Add new number filter
4. Add model from step 2 to dashboard 
5. Try to connect the number filter to the model - notice that you can choose ""Count"" column
6. Save dashboard
7. Open model
8. Edit query definition
9. Remove join
10. Save
11. Go back to dashboard
12. Try to connect the number filter to the model

### Expected behavior

It should be possible to connect the ""Count"" column to the number filter

### Information about your Metabase installation

master, 743ae09aca

### Severity

P2

### Additional info

This `Lib.isNumber` check gives unexpected result for the ""Count"" column: https://github.com/metabase/metabase/blob/bcd1a90cb67e4aa10da252aa296b00f06496a74f/frontend/src/metabase-lib/v1/parameters/utils/filters.ts#L52
",kamilmielnik,2024-08-23 14:12:27+00:00,['metamben'],2024-09-16 16:16:12+00:00,2024-09-13 22:15:33+00:00,https://github.com/metabase/metabase/issues/47184,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Dashboards', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2310056353, 'issue_id': 2483244724, 'author': 'kamilmielnik', 'body': 'TODO: When working on this issue, please search for `https://github.com/metabase/metabase/issues/47184` in `e2e/test/scenarios/dashboard-filters/dashboard-filters-query-stages.cy.spec.ts` and uncomment related blocks.\r\nThese tests provide alternative reproduction paths (i.e. without the step to remove the join clause)\r\n\r\n_This suite will be added in #46958 and will go to an integration branch (#47167) before landing in `master`._', 'created_at': datetime.datetime(2024, 8, 26, 12, 11, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2347091408, 'issue_id': 2483244724, 'author': 'metamben', 'body': ""@kamilmielnik, my [repro](https://www.loom.com/share/60636d9a96e5410e8631dd7285f42f16?sid=6046a021-614d-4cd7-b6b0-9c134aaac73f) fails already at step 5. Am I not following the steps properly?\n\nThis is because `:effective-type` is missing from the column. I've tried the easy fix of setting `:effective-type` to the value of `:base-type` if it's missing and that solved the problem. I still want to understand why it's missing in the first place (it's present in the card's metadata), so a bit more digging is needed."", 'created_at': datetime.datetime(2024, 9, 12, 19, 35, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2347280567, 'issue_id': 2483244724, 'author': 'kamilmielnik', 'body': '> Am I not following the steps properly?\r\n\r\n@metamben  I think you are.\r\nIn my original video steps 3 and 4 are done in reverse order but that should not matter though.\r\n\r\nIt seems that something else must have gotten broken since this issue was reported.', 'created_at': datetime.datetime(2024, 9, 12, 21, 29, 7, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-08-26 12:11:12 UTC): TODO: When working on this issue, please search for `https://github.com/metabase/metabase/issues/47184` in `e2e/test/scenarios/dashboard-filters/dashboard-filters-query-stages.cy.spec.ts` and uncomment related blocks.
These tests provide alternative reproduction paths (i.e. without the step to remove the join clause)

_This suite will be added in #46958 and will go to an integration branch (#47167) before landing in `master`._

metamben (Assginee) on (2024-09-12 19:35:29 UTC): @kamilmielnik, my [repro](https://www.loom.com/share/60636d9a96e5410e8631dd7285f42f16?sid=6046a021-614d-4cd7-b6b0-9c134aaac73f) fails already at step 5. Am I not following the steps properly?

This is because `:effective-type` is missing from the column. I've tried the easy fix of setting `:effective-type` to the value of `:base-type` if it's missing and that solved the problem. I still want to understand why it's missing in the first place (it's present in the card's metadata), so a bit more digging is needed.

kamilmielnik (Issue Creator) on (2024-09-12 21:29:07 UTC): @metamben  I think you are.
In my original video steps 3 and 4 are done in reverse order but that should not matter though.

It seems that something else must have gotten broken since this issue was reported.

"
2483231650,issue,closed,completed,"Cannot search within tables in ""Pick your starting data"" modal","### Describe the bug

During the creation of a question, using the search bar when picking the starting data not only tables but questions and dashboards are being returned, which makes searching extremely difficult if one does not remember the exact table name.

### To Reproduce

1. Add a question with a name similar to that of a table available in metabase, e.g. table name: `yoy_table`, question name: `yoy_question`.
2. From the Home page, click on `+ New` > `* Question`, opening the `Pick your starting data` modal.
3. Click on `Tables`.
4. In the `Search` text field, type the part of the table name that is shared with the name of the question (in this example, `yoy`).
5. The search results shown contain **both** tables and questions.

### Expected behavior

We should only be seeing tables matching the search text `yoy`, nothing else.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.0-17-amd64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""redshift"",
      ""postgres"",
      ""oracle""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""11.10""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-07-04"",
      ""tag"": ""v0.50.10"",
      ""hash"": ""49d9e46""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

Blocking some users, disrupting most

### Additional context

Here is the feedback from some of our users who faced this issue:

```
Hey team

We at Skroutz are a big fan of Metabase, with dozens of daily users accessing
millions of data points. In your latest update you tried to improve your search
function and you introduced a new modal screen with the search bar on the top
right and tabs for types of data structures to pick our data from.

Yet, one thing has gone very wrong. As a result our teams are complaining for
reduced productivity and constant frustration.

The search function doesn't work per structure (ie. Search only in Tables or only
in Saved questions) as it used to. Since we have hundreds of saved questions,
dashboards, etc. with no strict naming conventions, tables have become extremely
hard to find and use, both when starting a new question, as well as when you want
to join data within a question. You have to browse the whole list and make sure
you remember each table's name correctly to find it. Dreadful.

Please help us gain our working speed and love for Metabase back. Fix the search.

Thank you.

PS. Several team members have also reported that previously accessible database
tables have disappeared from the SQL editor's data reference feature following
the recent update. Any clue why?
```",ioanniswd,2024-08-23 14:05:49+00:00,['kamilmielnik'],2024-10-10 07:21:28+00:00,2024-10-08 08:05:11+00:00,https://github.com/metabase/metabase/issues/47182,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', ''), ('Frequency:Often', 'Something users bump into often')]",[],
2483175503,issue,open,,Set all namespaces to INFO and allow the admin to change the log level at runtime,"**Is your feature request related to a problem? Please describe.**
There are 2 problems here I want to tackle:
1) the application has DEBUG log levels set up in several places which should not be enabled when the app runs in production: https://github.com/metabase/metabase/blob/master/resources/log4j2.xml, or should be set to INFO
2) logging takes cpu time, and if we log massive objects, that's some decent cpu time

**Describe the solution you'd like**
We should allow admins to set the log level at runtime via the admin console, while setting all log level to INFO. If we need to debug or the admin sees something wrong, they should be able to enable custom logging from a toggle and set the namespaces needed to DEBUG (or we can give them some pre-defined ones)

**Describe alternatives you've considered**
None, currently doing this in containerized environments is a pain

**How important is this feature to you?**
Important to reduce the resource consumption of the app

**Additional context**
NA
",paoliniluis,2024-08-23 13:38:01+00:00,[],2025-02-04 20:31:05+00:00,,https://github.com/metabase/metabase/issues/47181,"[('Type:New Feature', ''), ('Operation/Logging', ""Related to what and how we log things to log files/SDOUT (don't confuse with Usage Analytics/Audit)"")]",[],
2483148290,issue,closed,completed,Add setting to make query analysis synchronous on card updates,"By default, we use a queue with a single consumer to asynchronously analyze cards when they change. This is to avoid adding latency to the UI or strain to the server.

The idea is to add a new setting which can toggle between the current async behavior and a fully synchronous mode, where analysis is done as part of the API calls to update cards.

In particular, this setting will be useful for our e2e tests, to avoid complexity and flakes due to task scheduling in-determinism. We've recently done a fair amount of optimization to the analysis, and its not too expensive, especially for deployments with few cards and a low mutation rate, so exposing this to customers as well should be fine - although please run that past @luizarakaki.

Note that this *should not* use `analyze-sync!`, which synchronously waits for the analysis worker to receive the job, and does not wait for it to complete it. This method is poorly named, and should only be used by the sweeper task. What we want instead is for the analyze to be performed immediately as part of the card mutation hook, i.e. we want to call`analyze-card!`.

Feel free to improve the naming in this area as part of the task, naming was hard. 
Note that merely overriding `execution` will have the unwanted side effect of removing our rate limiting back pressure from the sweeper job, so we'll need to do something a bit different. The whole structure around the `execution` dispatch key is up for rework, if necessary.",crisptrutski,2024-08-23 13:24:36+00:00,['tsmacdonald'],2024-08-27 14:38:55+00:00,2024-08-27 14:38:54+00:00,https://github.com/metabase/metabase/issues/47180,"[('.Backend', ''), ('.Team/Workflows', 'aka BEC'), ('Querying/Native/Parser', '')]","[{'comment_id': 2312142837, 'issue_id': 2483148290, 'author': 'tsmacdonald', 'body': 'We decided to make it synchronous on update all the time (not toggled by a setting). Will be fixed in #47231', 'created_at': datetime.datetime(2024, 8, 27, 10, 25, 21, tzinfo=datetime.timezone.utc)}]","tsmacdonald (Assginee) on (2024-08-27 10:25:21 UTC): We decided to make it synchronous on update all the time (not toggled by a setting). Will be fixed in #47231

"
2482860731,issue,closed,completed,Application data not loaded after successful upgrade and migration with Postgres RDS,"### Describe the bug

After successfully backing up and migrating my Postgres RDS application database for Metabase from `v0.45.3` to `v0.50.20` using docker (connection string passed as env variables), Metabase doesn't load up the data from the migrated database. It creates fallback H2 database and starts the application on boarding process afresh.

### To Reproduce

1. Backup up your RDS Postgres DB while on Metabase `v0.45.3`
2. Perform docker migration to Metabase `v0.51.20` with connections string from backeup RDS Postgres DB

### Expected behavior

What I expect: To have the same application data loaded from my previous Metabase version


### Logs


```
2024-08-23 02:38:43 
2024-08-23 02:38:43 Copyright © 2024 Metabase, Inc. 
2024-08-23 02:38:43 
2024-08-23 02:38:43 Metabase Enterprise Edition extensions are NOT PRESENT.
2024-08-23 02:38:43 2024-08-23 01:38:43,968 INFO metabase.core :: Starting Metabase in STANDALONE mode
2024-08-23 02:38:44 2024-08-23 01:38:44,092 INFO metabase.server :: Launching Embedded Jetty Webserver with config:
2024-08-23 02:38:44  {:port 3000, :host ""0.0.0.0""}
2024-08-23 02:38:44 
2024-08-23 02:38:44 2024-08-23 01:38:44,176 INFO metabase.core :: Starting Metabase version v0.50.21 (ec9f5d7) ...
2024-08-23 02:38:44 2024-08-23 01:38:44,182 INFO metabase.core :: System info:
2024-08-23 02:38:44  {""file.encoding"" ""UTF-8"",
2024-08-23 02:38:44  ""java.runtime.name"" ""OpenJDK Runtime Environment"",
2024-08-23 02:38:44  ""java.runtime.version"" ""11.0.24+8"",
2024-08-23 02:38:44  ""java.vendor"" ""Eclipse Adoptium"",
2024-08-23 02:38:44  ""java.vendor.url"" ""https://adoptium.net/"",
2024-08-23 02:38:44  ""java.version"" ""11.0.24"",
2024-08-23 02:38:44  ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",
2024-08-23 02:38:44  ""java.vm.version"" ""11.0.24+8"",
2024-08-23 02:38:44  ""os.name"" ""Linux"",
2024-08-23 02:38:44  ""os.version"" ""6.6.31-linuxkit"",
2024-08-23 02:38:44  ""user.language"" ""en"",
2024-08-23 02:38:44  ""user.timezone"" ""GMT""}
2024-08-23 02:38:44 
2024-08-23 02:38:44 2024-08-23 01:38:44,186 INFO metabase.plugins :: Loading plugins in /plugins...
2024-08-23 02:38:44 2024-08-23 01:38:44,371 INFO util.files :: Extract file /modules/sqlserver.metabase-driver.jar -> /plugins/sqlserver.metabase-driver.jar
2024-08-23 02:38:44 2024-08-23 01:38:44,395 INFO util.files :: Extract file /modules/redshift.metabase-driver.jar -> /plugins/redshift.metabase-driver.jar
2024-08-23 02:38:44 2024-08-23 01:38:44,412 INFO util.files :: Extract file /modules/snowflake.metabase-driver.jar -> /plugins/snowflake.metabase-driver.jar
2024-08-23 02:38:44 2024-08-23 01:38:44,872 INFO util.files :: Extract file /modules/sqlite.metabase-driver.jar -> /plugins/sqlite.metabase-driver.jar
2024-08-23 02:38:44 2024-08-23 01:38:44,957 INFO util.files :: Extract file /modules/athena.metabase-driver.jar -> /plugins/athena.metabase-driver.jar
2024-08-23 02:38:45 2024-08-23 01:38:45,089 INFO util.files :: Extract file /modules/druid.metabase-driver.jar -> /plugins/druid.metabase-driver.jar
2024-08-23 02:38:45 2024-08-23 01:38:45,094 INFO util.files :: Extract file /modules/mongo.metabase-driver.jar -> /plugins/mongo.metabase-driver.jar
2024-08-23 02:38:45 2024-08-23 01:38:45,119 INFO util.files :: Extract file /modules/presto-jdbc.metabase-driver.jar -> /plugins/presto-jdbc.metabase-driver.jar
2024-08-23 02:38:45 2024-08-23 01:38:45,206 INFO util.files :: Extract file /modules/vertica.metabase-driver.jar -> /plugins/vertica.metabase-driver.jar
2024-08-23 02:38:45 2024-08-23 01:38:45,208 INFO util.files :: Extract file /modules/sparksql.metabase-driver.jar -> /plugins/sparksql.metabase-driver.jar
2024-08-23 02:38:45 2024-08-23 01:38:45,306 INFO util.files :: Extract file /modules/druid-jdbc.metabase-driver.jar -> /plugins/druid-jdbc.metabase-driver.jar
2024-08-23 02:38:45 2024-08-23 01:38:45,372 INFO util.files :: Extract file /modules/bigquery-cloud-sdk.metabase-driver.jar -> /plugins/bigquery-cloud-sdk.metabase-driver.jar
2024-08-23 02:38:45 2024-08-23 01:38:45,742 INFO util.files :: Extract file /modules/oracle.metabase-driver.jar -> /plugins/oracle.metabase-driver.jar
2024-08-23 02:38:46 2024-08-23 01:38:46,070 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :bigquery-cloud-sdk...
2024-08-23 02:38:46 2024-08-23 01:38:46,078 INFO driver.impl :: Registered driver :bigquery-cloud-sdk (parents: [:sql]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,099 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :mongo...
2024-08-23 02:38:46 2024-08-23 01:38:46,100 INFO driver.impl :: Registered driver :mongo  🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,142 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :athena...
2024-08-23 02:38:46 2024-08-23 01:38:46,143 INFO driver.impl :: Registered driver :athena (parents: [:sql-jdbc]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,239 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlite...
2024-08-23 02:38:46 2024-08-23 01:38:46,248 INFO driver.impl :: Registered driver :sqlite (parents: [:sql-jdbc]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,272 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlserver...
2024-08-23 02:38:46 2024-08-23 01:38:46,272 INFO driver.impl :: Registered driver :sqlserver (parents: [:sql-jdbc]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,301 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Vertica Driver due to required dependencies. Metabase requires the Vertica JDBC driver in order to connect to Vertica databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/vertica.html for more details.
2024-08-23 02:38:46 
2024-08-23 02:38:46 2024-08-23 01:38:46,307 INFO plugins.dependencies :: Metabase Vertica Driver dependency {:class com.vertica.jdbc.Driver} satisfied? false
2024-08-23 02:38:46 2024-08-23 01:38:46,309 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Vertica Driver""]
2024-08-23 02:38:46 2024-08-23 01:38:46,332 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto-jdbc...
2024-08-23 02:38:46 2024-08-23 01:38:46,332 INFO driver.impl :: Registered driver :presto-jdbc (parents: [:sql-jdbc]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,339 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :redshift...
2024-08-23 02:38:46 2024-08-23 01:38:46,340 INFO driver.impl :: Registered driver :redshift (parents: [:postgres]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,353 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Oracle Driver due to required dependencies. Metabase requires the Oracle JDBC driver in order to connect to Oracle databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/oracle.html for more details.
2024-08-23 02:38:46 
2024-08-23 02:38:46 2024-08-23 01:38:46,354 INFO plugins.dependencies :: Metabase Oracle Driver dependency {:class oracle.jdbc.OracleDriver} satisfied? false
2024-08-23 02:38:46 2024-08-23 01:38:46,356 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Vertica Driver"" ""Metabase Oracle Driver""]
2024-08-23 02:38:46 2024-08-23 01:38:46,366 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :hive-like...
2024-08-23 02:38:46 2024-08-23 01:38:46,367 INFO driver.impl :: Registered abstract driver :hive-like (parents: [:sql-jdbc]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,368 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sparksql...
2024-08-23 02:38:46 2024-08-23 01:38:46,368 INFO driver.impl :: Registered driver :sparksql (parents: [:hive-like]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,376 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid...
2024-08-23 02:38:46 2024-08-23 01:38:46,376 INFO driver.impl :: Registered driver :druid  🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,439 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :snowflake...
2024-08-23 02:38:46 2024-08-23 01:38:46,445 INFO driver.impl :: Registered driver :snowflake (parents: [:sql-jdbc]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,461 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid-jdbc...
2024-08-23 02:38:46 2024-08-23 01:38:46,462 INFO driver.impl :: Registered driver :druid-jdbc (parents: [:sql-jdbc]) 🚚
2024-08-23 02:38:46 2024-08-23 01:38:46,479 INFO metabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...
2024-08-23 02:38:46 2024-08-23 01:38:46,484 INFO db.setup :: Verifying postgres Database Connection ...
2024-08-23 02:38:49 2024-08-23 01:38:49,895 INFO db.setup :: Successfully verified PostgreSQL 14.10 application database connection. ✅
2024-08-23 02:38:49 2024-08-23 01:38:49,899 INFO db.setup :: Checking if a database downgrade is required...
2024-08-23 02:38:53 2024-08-23 01:38:53,749 INFO db.setup :: Running Database Migrations...
2024-08-23 02:38:53 2024-08-23 01:38:53,751 INFO db.setup :: Setting up Liquibase...
2024-08-23 02:38:56 2024-08-23 01:38:56,502 INFO db.liquibase :: Updating liquibase table to reflect consolidated changeset filenames
2024-08-23 02:38:58 2024-08-23 01:38:58,075 INFO db.liquibase :: No migration lock found.
2024-08-23 02:38:58 2024-08-23 01:38:58,078 INFO db.liquibase :: Migration lock acquired.
2024-08-23 02:38:59 2024-08-23 01:38:59,361 INFO db.setup :: Liquibase is ready.
2024-08-23 02:38:59 2024-08-23 01:38:59,368 INFO db.liquibase :: Checking if Database has unrun migrations...
2024-08-23 02:39:04 2024-08-23 01:39:04,247 INFO db.liquibase :: No unrun migrations found.
2024-08-23 02:39:04 2024-08-23 01:39:04,409 INFO db.setup :: Database Migrations Current ... ✅
2024-08-23 02:39:04 2024-08-23 01:39:04,456 INFO metabase.util :: Database setup took 18.0 s
2024-08-23 02:39:07 2024-08-23 01:39:07,015 INFO driver.impl :: Initializing driver :sql...
2024-08-23 02:39:07 2024-08-23 01:39:07,021 INFO driver.impl :: Initializing driver :sql-jdbc...
2024-08-23 02:39:07 2024-08-23 01:39:07,021 INFO driver.impl :: Initializing driver :h2...
2024-08-23 02:39:07 2024-08-23 01:39:07,141 INFO util.files :: Extract file /sample-database.db.mv.db -> /plugins/sample-database.db.mv.db
2024-08-23 02:39:08 2024-08-23 01:39:08,508 INFO impl.StdSchedulerFactory :: Using default implementation for ThreadExecutor
2024-08-23 02:39:08 2024-08-23 01:39:08,524 INFO core.SchedulerSignalerImpl :: Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2024-08-23 02:39:08 2024-08-23 01:39:08,524 INFO core.QuartzScheduler :: Quartz Scheduler v.2.3.2 created.
2024-08-23 02:39:08 2024-08-23 01:39:08,525 INFO jdbcjobstore.JobStoreTX :: Using db table-based data access locking (synchronization).
2024-08-23 02:39:08 2024-08-23 01:39:08,527 INFO jdbcjobstore.JobStoreTX :: JobStoreTX initialized.
2024-08-23 02:39:08 2024-08-23 01:39:08,528 INFO core.QuartzScheduler :: Scheduler meta-data: Quartz Scheduler (v2.3.2) 'MetabaseScheduler' with instanceId '5f266bcbc86d1724377148513'
2024-08-23 02:39:08   Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
2024-08-23 02:39:08   NOT STARTED.
2024-08-23 02:39:08   Currently in standby mode.
2024-08-23 02:39:08   Number of jobs executed: 0
2024-08-23 02:39:08   Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
2024-08-23 02:39:08   Using job-store 'org.quartz.impl.jdbcjobstore.JobStoreTX' - which supports persistence. and is clustered.
2024-08-23 02:39:08 
2024-08-23 02:39:08 2024-08-23 01:39:08,528 INFO impl.StdSchedulerFactory :: Quartz scheduler 'MetabaseScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2024-08-23 02:39:08 2024-08-23 01:39:08,528 INFO impl.StdSchedulerFactory :: Quartz scheduler version: 2.3.2
2024-08-23 02:39:08 2024-08-23 01:39:08,722 INFO core.QuartzScheduler :: Scheduler MetabaseScheduler_$_5f266bcbc86d1724377148513 paused.
2024-08-23 02:39:08 2024-08-23 01:39:08,724 INFO metabase.task :: Task scheduler initialized into standby mode.
2024-08-23 02:39:14 2024-08-23 01:39:14,975 INFO metabase.task :: Initializing task Cache 📆
2024-08-23 02:39:14 2024-08-23 01:39:14,990 INFO metabase.task :: Initializing task SyncDatabases 📆
2024-08-23 02:39:16 2024-08-23 01:39:16,870 INFO task.sync-databases :: Updated default schedules for 0 databases
2024-08-23 02:39:16 2024-08-23 01:39:16,874 INFO metabase.task :: Initializing task PersistRefresh 📆
2024-08-23 02:39:18 2024-08-23 01:39:18,757 INFO metabase.task :: Initializing task CheckForNewVersions 📆
2024-08-23 02:39:22 2024-08-23 01:39:22,719 INFO metabase.task :: Initializing task PersistPrune 📆
2024-08-23 02:39:23 2024-08-23 01:39:23,430 INFO metabase.task :: Initializing task SendAnonymousUsageStats 📆
2024-08-23 02:39:27 2024-08-23 01:39:27,379 INFO metabase.task :: Initializing task ModelIndexValues 📆
2024-08-23 02:39:28 2024-08-23 01:39:28,069 INFO metabase.task :: Initializing task RefreshSlackChannelsAndUsers 📆
2024-08-23 02:39:33 2024-08-23 01:39:33,670 INFO metabase.task :: Initializing task TruncateAuditTables 📆
2024-08-23 02:39:37 2024-08-23 01:39:37,526 INFO metabase.task :: Initializing task SendPulses 📆
2024-08-23 02:39:39 2024-08-23 01:39:39,138 INFO metabase.task :: Initializing task SendFollowUpEmails 📆
2024-08-23 02:39:42 2024-08-23 01:39:42,841 INFO metabase.task :: Initializing task SendCreatorSentimentEmails 📆
2024-08-23 02:39:46 2024-08-23 01:39:46,402 INFO metabase.task :: Initializing task SendLegacyNoSelfServiceEmail 📆
2024-08-23 02:39:47 2024-08-23 01:39:47,362 INFO metabase.task :: Initializing task TaskHistoryCleanup 📆
2024-08-23 02:39:51 2024-08-23 01:39:51,254 INFO metabase.task :: Initializing task SendWarnPulseRemovalEmail 📆
2024-08-23 02:39:53 2024-08-23 01:39:53,184 INFO jdbcjobstore.JobStoreTX :: ClusterManager: detected 1 failed or restarted instances.
2024-08-23 02:39:53 2024-08-23 01:39:53,187 INFO jdbcjobstore.JobStoreTX :: ClusterManager: Scanning for instance ""c47fc46e72961724244632978""'s failed in-progress jobs.
2024-08-23 02:39:53 2024-08-23 01:39:53,887 INFO core.QuartzScheduler :: Scheduler MetabaseScheduler_$_5f266bcbc86d1724377148513 started.
2024-08-23 02:39:53 2024-08-23 01:39:53,895 INFO metabase.task :: Task scheduler started
2024-08-23 02:39:53 2024-08-23 01:39:53,917 INFO metabase.core :: Metabase Initialization COMPLETE in 1.5 mins
2024-08-23 02:39:56 2024-08-23 01:39:56,578 INFO task.refresh-slack-channel-user-cache :: Slack is not configured, not refreshing slack user/channel cache.
2024-08-23 03:27:08 2024-08-23 02:27:08,567 INFO driver.impl :: Initializing driver :postgres...
2024-08-23 03:27:09 2024-08-23 02:27:09,367 INFO i18n.impl :: Reading available locales from locales.clj...
2024-08-23 03:27:09 2024-08-23 02:27:09,592 INFO util.fonts :: Reading available fonts from /frontend_client/app/fonts
2024-08-23 03:27:09 2024-08-23 02:27:09,870 INFO middleware.exceptions :: Request canceled before finishing.
2024-08-23 03:27:26 2024-08-23 02:27:26,394 DEBUG middleware.log :: GET /api/user/current 200 4.0 s (10 DB calls) App DB connections: 1/13 Jetty threads: 6/50 (5 idle, 0 queued) (41 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
2024-08-23 03:27:27 2024-08-23 02:27:27,188 DEBUG middleware.log :: GET /api/database 200 404.4 ms (1 DB calls) App DB connections: 5/13 Jetty threads: 10/50 (4 idle, 0 queued) (41 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
2024-08-23 03:27:27 2024-08-23 02:27:27,322 DEBUG middleware.log :: GET /api/bookmark 200 538.6 ms (1 DB calls) App DB connections: 5/13 Jetty threads: 10/50 (4 idle, 0 queued) (41 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
2024-08-23 03:27:27 2024-08-23 02:27:27,508 DEBUG middleware.log :: GET /api/session/properties 200 5.1 s (13 DB calls) App DB connections: 3/13 Jetty threads: 9/50 (4 idle, 0 queued) (41 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
2024-08-23 03:27:27 2024-08-23 02:27:27,714 DEBUG middleware.log :: GET /api/collection/root 200 874.0 ms (2 DB calls) App DB connections: 2/13 Jetty threads: 8/50 (4 idle, 0 queued) (41 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
2024-08-23 03:27:29 2024-08-23 02:27:29,317 DEBUG middleware.log :: GET /api/search 200 2.6 s (5 DB calls) App DB connections: 2/13 Jetty threads: 7/50 (4 idle, 0 queued) (41 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
2024-08-23 03:27:29 2024-08-23 02:27:29,476 DEBUG middleware.log :: GET /api/collection/tree 200 2.5 s (6 DB calls) App DB connections: 1/13 Jetty threads: 6/50 (4 idle, 0 queued) (41 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
2024-08-23 03:27:32 2024-08-23 02:27:32,176 DEBUG middleware.log :: GET /api/search 200 2.4 s (11 DB calls) App DB connections: 1/13 Jetty threads: 6/50 (5 idle, 0 queued) (41 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
2024-08-23 03:27:36 2024-08-23 02:27:36,907 INFO metabase.events :: Loading events namespace: metabase.events.audit-log 👂
2024-08-23 03:27:37 2024-08-23 02:27:37,009 INFO metabase.events :: Loading events namespace: metabase.events.driver-notifications 👂
2024-08-23 03:27:37 2024-08-23 02:27:37,027 INFO metabase.events :: Loading events namespace: metabase.events.last-login 👂
2024-08-23 03:27:37 2024-08-23 02:27:37,042 INFO metabase.events :: Loading events namespace: metabase.events.persisted-info 👂
2024-08-23 03:27:37 2024-08-23 02:27:37,054 INFO metabase.events :: Loading events namespace: metabase.events.recent-views 👂
2024-08-23 03:27:37 2024-08-23 02:27:37,070 INFO metabase.events :: Loading events namespace: metabase.events.revision 👂
2024-08-23 03:27:37 2024-08-23 02:27:37,095 INFO metabase.events :: Loading events namespace: metabase.events.schema 👂
2024-08-23 03:27:37 2024-08-23 02:27:37,096 INFO metabase.events :: Loading events namespace: metabase.events.sync-database 👂
2024-08-23 03:27:37 2024-08-23 02:27:37,104 INFO metabase.events :: Loading events namespace: metabase.events.view-log 👂

```

### Information about your Metabase installation

```JSON
- Browser: (Brave [Version 1.65.126 Chromium: 124.0.6367.118 (Official Build) (arm64)](https://brave.com/latest/))
- OS: macOS Sonoma - Version 14.4.1 (23E224)
- Metabase version: 0.51.20
- Metabase internal database: RDS Postgres
```


### Severity

annoying

### Additional context

_No response_",chukwuma-azubuike,2024-08-23 10:42:34+00:00,[],2024-08-27 22:06:11+00:00,2024-08-27 22:06:11+00:00,https://github.com/metabase/metabase/issues/47173,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Operation/Database Migrations', 'Issues with application DB migrations when launching Metabase'), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2306822110, 'issue_id': 2482860731, 'author': 'paoliniluis', 'body': 'Please mention which env vars you used', 'created_at': datetime.datetime(2024, 8, 23, 10, 44, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2307080551, 'issue_id': 2482860731, 'author': 'dpsutton', 'body': ""```\r\nmetabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...\r\ndb.setup      :: Verifying postgres Database Connection ...\r\ndb.setup      :: Successfully verified PostgreSQL 14.10 application database connection. ✅\r\ndb.setup      :: Checking if a database downgrade is required...\r\ndb.setup      :: Running Database Migrations...\r\ndb.setup      :: Setting up Liquibase...\r\ndb.liquibase  :: Updating liquibase table to reflect consolidated changeset filenames\r\ndb.liquibase  :: No migration lock found.\r\ndb.liquibase  :: Migration lock acquired.\r\ndb.setup      :: Liquibase is ready.\r\ndb.liquibase  :: Checking if Database has unrun migrations...\r\ndb.liquibase  :: No unrun migrations found.\r\ndb.setup      :: Database Migrations Current ... ✅\r\nmetabase.util :: Database setup took 18.0 s\r\n```\r\n\r\nFrom this it seems\r\n1. Metabase recognizes you have a postgres app-db not h2 (Verifying postgres Database Connection ...)\r\n2. and it's up to date and doesn't need to migrate anything (No unrun migrations found.)\r\n\r\nIt is creating an h2 db for the sample database but not the application db."", 'created_at': datetime.datetime(2024, 8, 23, 13, 19, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2307115278, 'issue_id': 2482860731, 'author': 'chukwuma-azubuike', 'body': ""> ```\r\n> metabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...\r\n> db.setup      :: Verifying postgres Database Connection ...\r\n> db.setup      :: Successfully verified PostgreSQL 14.10 application database connection. ✅\r\n> db.setup      :: Checking if a database downgrade is required...\r\n> db.setup      :: Running Database Migrations...\r\n> db.setup      :: Setting up Liquibase...\r\n> db.liquibase  :: Updating liquibase table to reflect consolidated changeset filenames\r\n> db.liquibase  :: No migration lock found.\r\n> db.liquibase  :: Migration lock acquired.\r\n> db.setup      :: Liquibase is ready.\r\n> db.liquibase  :: Checking if Database has unrun migrations...\r\n> db.liquibase  :: No unrun migrations found.\r\n> db.setup      :: Database Migrations Current ... ✅\r\n> metabase.util :: Database setup took 18.0 s\r\n> ```\r\n> \r\n> From this it seems\r\n> \r\n> 1. Metabase recognizes you have a postgres app-db not h2 (Verifying postgres Database Connection ...)\r\n> 2. and it's up to date and doesn't need to migrate anything (No unrun migrations found.)\r\n> \r\n> It is creating an h2 db for the sample database but not the application db.\r\n\r\n@dpsutton so how come the application started a fresh onboarding session? I expect that I would be able to login and continue work with previous accounts created before the upgrade and migration."", 'created_at': datetime.datetime(2024, 8, 23, 13, 37, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2307121972, 'issue_id': 2482860731, 'author': 'chukwuma-azubuike', 'body': '> Please mention which env vars you used\r\n\r\n@paoliniluis see the env vars below:\r\n\r\n```\r\ndocker run -d -p 8080:3000 \\\r\n  -e ""MB_DB_TYPE=postgres"" \\\r\n  -e ""MB_DB_DBNAME=postgres"" \\\r\n  -e ""MB_DB_PORT=5432"" \\\r\n  -e ""MB_DB_USER=****_admin"" \\\r\n  -e ""MB_DB_PASS=********************"" \\\r\n  -e ""MB_DB_HOST=*********.************.eu-west-1.rds.amazonaws.com"" \\\r\n  --name metabase-ajocard-test metabase/metabase:latest\r\n```', 'created_at': datetime.datetime(2024, 8, 23, 13, 41, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2309567895, 'issue_id': 2482860731, 'author': 'chukwuma-azubuike', 'body': '@paoliniluis @dpsutton any update on this please?', 'created_at': datetime.datetime(2024, 8, 26, 7, 49, tzinfo=datetime.timezone.utc)}, {'comment_id': 2309911405, 'issue_id': 2482860731, 'author': 'paoliniluis', 'body': '@chukwuma-azubuike if you connect to that RDS, do you see the old data?', 'created_at': datetime.datetime(2024, 8, 26, 10, 46, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2310330050, 'issue_id': 2482860731, 'author': 'chukwuma-azubuike', 'body': '@paoliniluis yes I still do.', 'created_at': datetime.datetime(2024, 8, 26, 14, 17, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312594812, 'issue_id': 2482860731, 'author': 'chukwuma-azubuike', 'body': '@paoliniluis @dpsutton following up on updates please.', 'created_at': datetime.datetime(2024, 8, 27, 13, 39, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312801954, 'issue_id': 2482860731, 'author': 'paoliniluis', 'body': ""So, in the RDS you see the old data, but when you connect Metabase to the exact same RDS Metabase shows nothing (no cards, no dashboards, absolutely nothing). Are you 100% sure that:\r\n1) the RDS HAS data (please go to core_users table, or report_card, ensure that you see the old data there)\r\n2) you're connecting Metabase to that database via the environment variables and that Metabase is actually using those"", 'created_at': datetime.datetime(2024, 8, 27, 14, 57, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312823851, 'issue_id': 2482860731, 'author': 'chukwuma-azubuike', 'body': '@paoliniluis I am certain of this, I have 32 users. see screenshot below:\r\n\r\n<img width=""1221"" alt=""Screenshot 2024-08-27 at 16 01 37"" src=""https://github.com/user-attachments/assets/d498a927-8e11-41d1-83de-c52a159d1f82"">', 'created_at': datetime.datetime(2024, 8, 27, 15, 5, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312965510, 'issue_id': 2482860731, 'author': 'paoliniluis', 'body': 'Cool, and in your Metabase you see zero users?', 'created_at': datetime.datetime(2024, 8, 27, 16, 3, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312969463, 'issue_id': 2482860731, 'author': 'paoliniluis', 'body': 'By the way in your screenshot the database is named “metabase” while you use an env var naming the database “Postgres”:\r\n""MB_DB_DBNAME=postgres""', 'created_at': datetime.datetime(2024, 8, 27, 16, 5, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2313311053, 'issue_id': 2482860731, 'author': 'chukwuma-azubuike', 'body': ""@paoliniluis yes, I have zero users apart from the new one I had to create during the fresh onboarding. Note: I don't see this new user in the `core_users` table."", 'created_at': datetime.datetime(2024, 8, 27, 19, 6, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2313618934, 'issue_id': 2482860731, 'author': 'paoliniluis', 'body': 'Check my previous comment please about the db name', 'created_at': datetime.datetime(2024, 8, 27, 21, 33, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2313657612, 'issue_id': 2482860731, 'author': 'chukwuma-azubuike', 'body': '> Check my previous comment please about the db name\r\n@paoliniluis thanks a lot. Thank was the missing piece.', 'created_at': datetime.datetime(2024, 8, 27, 22, 5, 33, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-08-23 10:44:47 UTC): Please mention which env vars you used

dpsutton on (2024-08-23 13:19:03 UTC): ```
metabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...
db.setup      :: Verifying postgres Database Connection ...
db.setup      :: Successfully verified PostgreSQL 14.10 application database connection. ✅
db.setup      :: Checking if a database downgrade is required...
db.setup      :: Running Database Migrations...
db.setup      :: Setting up Liquibase...
db.liquibase  :: Updating liquibase table to reflect consolidated changeset filenames
db.liquibase  :: No migration lock found.
db.liquibase  :: Migration lock acquired.
db.setup      :: Liquibase is ready.
db.liquibase  :: Checking if Database has unrun migrations...
db.liquibase  :: No unrun migrations found.
db.setup      :: Database Migrations Current ... ✅
metabase.util :: Database setup took 18.0 s
```

From this it seems
1. Metabase recognizes you have a postgres app-db not h2 (Verifying postgres Database Connection ...)
2. and it's up to date and doesn't need to migrate anything (No unrun migrations found.)

It is creating an h2 db for the sample database but not the application db.

chukwuma-azubuike (Issue Creator) on (2024-08-23 13:37:39 UTC): @dpsutton so how come the application started a fresh onboarding session? I expect that I would be able to login and continue work with previous accounts created before the upgrade and migration.

chukwuma-azubuike (Issue Creator) on (2024-08-23 13:41:04 UTC): @paoliniluis see the env vars below:

```
docker run -d -p 8080:3000 \
  -e ""MB_DB_TYPE=postgres"" \
  -e ""MB_DB_DBNAME=postgres"" \
  -e ""MB_DB_PORT=5432"" \
  -e ""MB_DB_USER=****_admin"" \
  -e ""MB_DB_PASS=********************"" \
  -e ""MB_DB_HOST=*********.************.eu-west-1.rds.amazonaws.com"" \
  --name metabase-ajocard-test metabase/metabase:latest
```

chukwuma-azubuike (Issue Creator) on (2024-08-26 07:49:00 UTC): @paoliniluis @dpsutton any update on this please?

paoliniluis on (2024-08-26 10:46:58 UTC): @chukwuma-azubuike if you connect to that RDS, do you see the old data?

chukwuma-azubuike (Issue Creator) on (2024-08-26 14:17:04 UTC): @paoliniluis yes I still do.

chukwuma-azubuike (Issue Creator) on (2024-08-27 13:39:32 UTC): @paoliniluis @dpsutton following up on updates please.

paoliniluis on (2024-08-27 14:57:44 UTC): So, in the RDS you see the old data, but when you connect Metabase to the exact same RDS Metabase shows nothing (no cards, no dashboards, absolutely nothing). Are you 100% sure that:
1) the RDS HAS data (please go to core_users table, or report_card, ensure that you see the old data there)
2) you're connecting Metabase to that database via the environment variables and that Metabase is actually using those

chukwuma-azubuike (Issue Creator) on (2024-08-27 15:05:48 UTC): @paoliniluis I am certain of this, I have 32 users. see screenshot below:

<img width=""1221"" alt=""Screenshot 2024-08-27 at 16 01 37"" src=""https://github.com/user-attachments/assets/d498a927-8e11-41d1-83de-c52a159d1f82"">

paoliniluis on (2024-08-27 16:03:41 UTC): Cool, and in your Metabase you see zero users?

paoliniluis on (2024-08-27 16:05:13 UTC): By the way in your screenshot the database is named “metabase” while you use an env var naming the database “Postgres”:
""MB_DB_DBNAME=postgres""

chukwuma-azubuike (Issue Creator) on (2024-08-27 19:06:30 UTC): @paoliniluis yes, I have zero users apart from the new one I had to create during the fresh onboarding. Note: I don't see this new user in the `core_users` table.

paoliniluis on (2024-08-27 21:33:52 UTC): Check my previous comment please about the db name

chukwuma-azubuike (Issue Creator) on (2024-08-27 22:05:33 UTC): @paoliniluis thanks a lot. Thank was the missing piece.

"
2482816710,issue,closed,completed,Date field filter broken when choosing after/before a date,"### Describe the bug

Since our update to Metabase v0.50.19 we fail to be able to filter 'after' or 'before' a specific date through a field filter.

We have the following error: Don't know how to parse null nil as a temporal literal. Since it's a field filter problem, it's very hard to debug

### To Reproduce

1. Go to Sample Database, Copy paste the following SQL query: Select * from ACCOUNTS where True [[AND {{date}}]]
2. Click on variables, add a field filter on created_at (from the Account table)
3. choose date filter, specific dates and either before or after a date
![Screenshot 2024-08-23 121118](https://github.com/user-attachments/assets/8961cdb8-9733-4170-b331-5d3f48e2c852)



### Expected behavior

_No response_

### Logs

{:database_id 1,
 :started_at #t ""2024-08-23T10:14:56.839314Z[GMT]"",
 :via
 [{:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error ""Unable to substitute parameters: Don't know how to parse null nil as a temporal literal"",
   :stacktrace
   [""--> driver.sql.parameters.substitute$substitute$fn__84169.invoke(substitute.clj:91)""
    ""driver.sql.parameters.substitute$substitute.invokeStatic(substitute.clj:88)""
    ""driver.sql.parameters.substitute$substitute.invoke(substitute.clj:78)""
    ""driver.sql$fn__84214$_AMPERSAND_f__84216.invoke(sql.clj:64)""
    ""driver.sql$fn__84214$fn__84223.invoke(sql.clj:58)""
    ""query_processor.middleware.parameters.native$expand_inner.invokeStatic(native.clj:43)""
    ""query_processor.middleware.parameters.native$expand_inner.invoke(native.clj:34)""
    ""query_processor.middleware.parameters$expand_one.invokeStatic(parameters.clj:51)""
    ""query_processor.middleware.parameters$expand_one.invoke(parameters.clj:42)""
    ""query_processor.middleware.parameters$expand_all$replace_64561__64562.invoke(parameters.clj:60)""
    ""lib.util.match.impl$replace_in_collection$iter__15653__15657$fn__15658.invoke(impl.cljc:45)""
    ""lib.util.match.impl$replace_in_collection.invokeStatic(impl.cljc:44)""
    ""lib.util.match.impl$replace_in_collection.invoke(impl.cljc:39)""
    ""query_processor.middleware.parameters$expand_all$replace_64561__64562.invoke(parameters.clj:60)""
    ""query_processor.middleware.parameters$expand_all.invokeStatic(parameters.clj:60)""
    ""query_processor.middleware.parameters$expand_all.invoke(parameters.clj:54)""
    ""query_processor.middleware.parameters$expand_all.invokeStatic(parameters.clj:57)""
    ""query_processor.middleware.parameters$expand_all.invoke(parameters.clj:54)""
    ""query_processor.middleware.parameters$expand_parameters.invokeStatic(parameters.clj:84)""
    ""query_processor.middleware.parameters$expand_parameters.invoke(parameters.clj:79)""
    ""query_processor.middleware.parameters$substitute_parameters_STAR_.invokeStatic(parameters.clj:93)""
    ""query_processor.middleware.parameters$substitute_parameters_STAR_.invoke(parameters.clj:90)""
    ""query_processor.middleware.parameters$substitute_parameters.invokeStatic(parameters.clj:120)""
    ""query_processor.middleware.parameters$substitute_parameters.invoke(parameters.clj:111)""
    ""query_processor.preprocess$ensure_legacy$fn__65929.invoke(preprocess.clj:62)""
    ""query_processor.preprocess$preprocess$fn__65937$fn__65938.invoke(preprocess.clj:128)""
    ""query_processor.preprocess$preprocess$fn__65937.invoke(preprocess.clj:119)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor.preprocess$preprocess.invokeStatic(preprocess.clj:118)""
    ""query_processor.preprocess$preprocess.invoke(preprocess.clj:114)""
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:44)""
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
    ""query_processor.middleware.enterprise$fn__65007$handle_audit_app_internal_queries__65008$fn__65010.invoke(enterprise.clj:96)""
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__65018.invoke(enterprise.clj:103)""
    ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76360.invoke(process_userland_query.clj:202)""
    ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__76429.invoke(catch_exceptions.clj:128)""
    ""query_processor$process_query$fn__76466.invoke(query_processor.clj:78)""
    ""query_processor.setup$do_with_canceled_chan$fn__65422.invoke(setup.clj:189)""
    ""query_processor.setup$do_with_database_local_settings$fn__65417.invoke(setup.clj:181)""
    ""query_processor.setup$do_with_driver$fn__65412$fn__65413.invoke(setup.clj:166)""
    ""driver$do_with_driver.invokeStatic(driver.clj:105)""
    ""driver$do_with_driver.invoke(driver.clj:100)""
    ""query_processor.setup$do_with_driver$fn__65412.invoke(setup.clj:165)""
    ""query_processor.setup$do_with_metadata_provider$fn__65405$fn__65408.invoke(setup.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:171)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:160)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
    ""query_processor.setup$do_with_metadata_provider$fn__65405.invoke(setup.clj:150)""
    ""query_processor.setup$do_with_resolved_database$fn__65399.invoke(setup.clj:128)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
    ""query_processor$process_query.invoke(query_processor.clj:69)""
    ""api.dataset$run_streaming_query$fn__97277.invoke(dataset.clj:84)""
    ""query_processor.streaming$_streaming_response$fn__68924$fn__68925$fn__68926.invoke(streaming.clj:175)""
    ""query_processor.streaming$_streaming_response$fn__68924$fn__68925.invoke(streaming.clj:174)""
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
    ""query_processor.streaming$_streaming_response$fn__68924.invoke(streaming.clj:171)""
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""
    ""async.streaming_response$do_f_async$task__52241.invoke(streaming_response.clj:87)""],
   :error_type :invalid-parameter,
   :ex-data
   {:type :invalid-parameter,
    :params
    {""date""
     #metabase.driver.common.parameters.FieldFilter{:field
                                                    {:description nil,
                                                     :lib/type :metadata/column,
                                                     :base-type :type/DateTime,
                                                     :semantic-type :type/CreationTimestamp,
                                                     :table-id 4802,
                                                     :name ""CREATED_AT"",
                                                     :coercion-strategy nil,
                                                     :settings nil,
                                                     :nfc-path nil,
                                                     :database-type ""TIMESTAMP"",
                                                     :effective-type :type/DateTime,
                                                     :fk-target-field-id nil,
                                                     :id 116319,
                                                     :parent-id nil,
                                                     :visibility-type :normal,
                                                     :display-name ""CREATED_AT"",
                                                     :position 7,
                                                     :fingerprint
                                                     {:global {:distinct-count 2495, :nil% 0.0},
                                                      :type
                                                      {:type/DateTime
                                                       {:earliest ""2020-09-15T16:11:50Z"",
                                                        :latest ""2031-10-10T19:14:48Z""}}}},
                                                    :value
                                                    {:value ""~2024-08-23"",
                                                     :id ""527fab6d-d2e1-4835-aaaa-b981a7d4c756"",
                                                     :type :date/all-options}}},
    :parsed-query
    (""Select * from ACCOUNTS where True ""
     #metabase.driver.common.parameters.Optional{:args (""AND "" #metabase.driver.common.parameters.Param{:k ""date""})})}}
  {:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error
   ""Error preprocessing query in metabase.query_processor.preprocess$ensure_legacy$fn__65929@4c3dc1b7: Unable to substitute parameters: Don't know how to parse null nil as a temporal literal"",
   :stacktrace
   [""--> query_processor.preprocess$preprocess$fn__65937$fn__65938.invoke(preprocess.clj:133)""
    ""query_processor.preprocess$preprocess$fn__65937.invoke(preprocess.clj:119)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor.preprocess$preprocess.invokeStatic(preprocess.clj:118)""
    ""query_processor.preprocess$preprocess.invoke(preprocess.clj:114)""
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:44)""
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
    ""query_processor.middleware.enterprise$fn__65007$handle_audit_app_internal_queries__65008$fn__65010.invoke(enterprise.clj:96)""
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__65018.invoke(enterprise.clj:103)""
    ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76360.invoke(process_userland_query.clj:202)""
    ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__76429.invoke(catch_exceptions.clj:128)""
    ""query_processor$process_query$fn__76466.invoke(query_processor.clj:78)""
    ""query_processor.setup$do_with_canceled_chan$fn__65422.invoke(setup.clj:189)""
    ""query_processor.setup$do_with_database_local_settings$fn__65417.invoke(setup.clj:181)""
    ""query_processor.setup$do_with_driver$fn__65412$fn__65413.invoke(setup.clj:166)""
    ""driver$do_with_driver.invokeStatic(driver.clj:105)""
    ""driver$do_with_driver.invoke(driver.clj:100)""
    ""query_processor.setup$do_with_driver$fn__65412.invoke(setup.clj:165)""
    ""query_processor.setup$do_with_metadata_provider$fn__65405$fn__65408.invoke(setup.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:171)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
    ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:160)""
    ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
    ""query_processor.setup$do_with_metadata_provider$fn__65405.invoke(setup.clj:150)""
    ""query_processor.setup$do_with_resolved_database$fn__65399.invoke(setup.clj:128)""
    ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
    ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
    ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
    ""query_processor$process_query.invoke(query_processor.clj:69)""
    ""api.dataset$run_streaming_query$fn__97277.invoke(dataset.clj:84)""
    ""query_processor.streaming$_streaming_response$fn__68924$fn__68925$fn__68926.invoke(streaming.clj:175)""
    ""query_processor.streaming$_streaming_response$fn__68924$fn__68925.invoke(streaming.clj:174)""
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
    ""query_processor.streaming$_streaming_response$fn__68924.invoke(streaming.clj:171)""
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""
    ""async.streaming_response$do_f_async$task__52241.invoke(streaming_response.clj:87)""],
   :error_type :qp,
   :ex-data
   {:fn
    #object[metabase.query_processor.preprocess$ensure_legacy$fn__65929 0x4c3dc1b7 ""metabase.query_processor.preprocess$ensure_legacy$fn__65929@4c3dc1b7""],
    :query
    {:constraints {:max-results 10000, :max-results-bare-rows 2000},
     :lib/type :mbql/query,
     :lib/metadata
     (metabase.lib.metadata.invocation-tracker/invocation-tracker-provider (metabase.lib.metadata.cached-provider/cached-metadata-provider (metabase.lib.metadata.jvm/->UncachedApplicationDatabaseMetadataProvider 1))),
     :stages
     [{:lib/type :mbql.stage/native,
       :template-tags
       {""date""
        {:type :dimension,
         :name ""date"",
         :id ""527fab6d-d2e1-4835-aaaa-b981a7d4c756"",
         :display-name ""Date"",
         :default nil,
         :dimension
         [:field
          {:lib/uuid ""8b0abff2-be10-4618-8d4b-b0374139769a"",
           :metabase.lib.query/transformation-added-base-type true,
           :base-type :type/DateTime,
           :effective-type :type/DateTime}
          116319],
         :widget-type :date/all-options}},
       :native ""Select * from ACCOUNTS where True [[AND {{date}}]]""}],
     :middleware {:js-int-to-string? true, :userland-query? true, :add-default-userland-constraints? true},
     :lib.convert/converted? true,
     :info {:executed-by 248, :context :ad-hoc, :query-hash #object[""[B"" 0x39db8e7 ""[B@39db8e7""]},
     :database 1,
     :parameters
     [{:value ""~2024-08-23"",
       :id ""527fab6d-d2e1-4835-aaaa-b981a7d4c756"",
       :type :date/all-options,
       :target [:dimension [:template-tag ""date""]]}]},
    :type :qp}}],
 :action_id nil,
 :error_type :invalid-parameter,
 :json_query
 {:native
  {:template-tags
   {:date
    {:type ""dimension"",
     :name ""date"",
     :id ""527fab6d-d2e1-4835-aaaa-b981a7d4c756"",
     :display-name ""Date"",
     :default nil,
     :dimension [""field"" 116319 nil],
     :widget-type ""date/all-options""}},
   :query ""Select * from ACCOUNTS where True [[AND {{date}}]]""},
  :type ""native"",
  :database 1,
  :parameters
  [{:id ""527fab6d-d2e1-4835-aaaa-b981a7d4c756"",
    :type ""date/all-options"",
    :value ""~2024-08-23"",
    :target [""dimension"" [""template-tag"" ""date""]]}],
  :middleware {:js-int-to-string? true, :userland-query? true, :add-default-userland-constraints? true}},
 :status :failed,
 :class clojure.lang.ExceptionInfo,
 :stacktrace
 [""--> driver.sql.parameters.substitution$maybe_parse_temporal_literal.invokeStatic(substitution.clj:182)""
  ""driver.sql.parameters.substitution$maybe_parse_temporal_literal.invoke(substitution.clj:177)""
  ""driver.sql.parameters.substitution$fn__83993$fn__84001.invoke(substitution.clj:219)""
  ""driver.sql.parameters.substitution$fn__83993.invokeStatic(substitution.clj:218)""
  ""driver.sql.parameters.substitution$fn__83993.doInvoke(substitution.clj:216)""
  ""driver.sql.parameters.substitution$field_filter__GT_replacement_snippet_for_datetime_field$__GT_datetime_replacement_snippet_info__84017.invoke(substitution.clj:292)""
  ""driver.sql.parameters.substitution$field_filter__GT_replacement_snippet_for_datetime_field.invokeStatic(substitution.clj:293)""
  ""driver.sql.parameters.substitution$field_filter__GT_replacement_snippet_for_datetime_field.invoke(substitution.clj:286)""
  ""driver.sql.parameters.substitution$field_filter__GT_replacement_snippet_info.invokeStatic(substitution.clj:326)""
  ""driver.sql.parameters.substitution$field_filter__GT_replacement_snippet_info.invoke(substitution.clj:297)""
  ""driver.sql.parameters.substitution$fn__84031$_AMPERSAND_f__84033.invoke(substitution.clj:359)""
  ""driver.sql.parameters.substitution$fn__84031$fn__84050.invoke(substitution.clj:342)""
  ""driver.sql.parameters.substitute$substitute_field_filter.invokeStatic(substitute.clj:19)""
  ""driver.sql.parameters.substitute$substitute_field_filter.invoke(substitute.clj:13)""
  ""driver.sql.parameters.substitute$substitute_param.invokeStatic(substitute.clj:37)""
  ""driver.sql.parameters.substitute$substitute_param.invoke(substitute.clj:31)""
  ""driver.sql.parameters.substitute$substitute_STAR_$fn__84160.invoke(substitute.clj:71)""
  ""driver.sql.parameters.substitute$substitute_STAR_.invokeStatic(substitute.clj:64)""
  ""driver.sql.parameters.substitute$substitute_STAR_.invoke(substitute.clj:61)""
  ""driver.sql.parameters.substitute$substitute_optional.invokeStatic(substitute.clj:56)""
  ""driver.sql.parameters.substitute$substitute_optional.invoke(substitute.clj:55)""
  ""driver.sql.parameters.substitute$substitute_STAR_$fn__84160.invoke(substitute.clj:74)""
  ""driver.sql.parameters.substitute$substitute_STAR_.invokeStatic(substitute.clj:64)""
  ""driver.sql.parameters.substitute$substitute_STAR_.invoke(substitute.clj:61)""
  ""driver.sql.parameters.substitute$substitute$fn__84169.invoke(substitute.clj:89)""
  ""driver.sql.parameters.substitute$substitute.invokeStatic(substitute.clj:88)""
  ""driver.sql.parameters.substitute$substitute.invoke(substitute.clj:78)""
  ""driver.sql$fn__84214$_AMPERSAND_f__84216.invoke(sql.clj:64)""
  ""driver.sql$fn__84214$fn__84223.invoke(sql.clj:58)""
  ""query_processor.middleware.parameters.native$expand_inner.invokeStatic(native.clj:43)""
  ""query_processor.middleware.parameters.native$expand_inner.invoke(native.clj:34)""
  ""query_processor.middleware.parameters$expand_one.invokeStatic(parameters.clj:51)""
  ""query_processor.middleware.parameters$expand_one.invoke(parameters.clj:42)""
  ""query_processor.middleware.parameters$expand_all$replace_64561__64562.invoke(parameters.clj:60)""
  ""lib.util.match.impl$replace_in_collection$iter__15653__15657$fn__15658.invoke(impl.cljc:45)""
  ""lib.util.match.impl$replace_in_collection.invokeStatic(impl.cljc:44)""
  ""lib.util.match.impl$replace_in_collection.invoke(impl.cljc:39)""
  ""query_processor.middleware.parameters$expand_all$replace_64561__64562.invoke(parameters.clj:60)""
  ""query_processor.middleware.parameters$expand_all.invokeStatic(parameters.clj:60)""
  ""query_processor.middleware.parameters$expand_all.invoke(parameters.clj:54)""
  ""query_processor.middleware.parameters$expand_all.invokeStatic(parameters.clj:57)""
  ""query_processor.middleware.parameters$expand_all.invoke(parameters.clj:54)""
  ""query_processor.middleware.parameters$expand_parameters.invokeStatic(parameters.clj:84)""
  ""query_processor.middleware.parameters$expand_parameters.invoke(parameters.clj:79)""
  ""query_processor.middleware.parameters$substitute_parameters_STAR_.invokeStatic(parameters.clj:93)""
  ""query_processor.middleware.parameters$substitute_parameters_STAR_.invoke(parameters.clj:90)""
  ""query_processor.middleware.parameters$substitute_parameters.invokeStatic(parameters.clj:120)""
  ""query_processor.middleware.parameters$substitute_parameters.invoke(parameters.clj:111)""
  ""query_processor.preprocess$ensure_legacy$fn__65929.invoke(preprocess.clj:62)""
  ""query_processor.preprocess$preprocess$fn__65937$fn__65938.invoke(preprocess.clj:128)""
  ""query_processor.preprocess$preprocess$fn__65937.invoke(preprocess.clj:119)""
  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:225)""
  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
  ""query_processor.preprocess$preprocess.invokeStatic(preprocess.clj:118)""
  ""query_processor.preprocess$preprocess.invoke(preprocess.clj:114)""
  ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:44)""
  ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:43)""
  ""query_processor.middleware.enterprise$fn__65007$handle_audit_app_internal_queries__65008$fn__65010.invoke(enterprise.clj:96)""
  ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__65018.invoke(enterprise.clj:103)""
  ""query_processor.middleware.process_userland_query$process_userland_query_middleware$fn__76360.invoke(process_userland_query.clj:202)""
  ""query_processor.middleware.catch_exceptions$catch_exceptions$fn__76429.invoke(catch_exceptions.clj:128)""
  ""query_processor$process_query$fn__76466.invoke(query_processor.clj:78)""
  ""query_processor.setup$do_with_canceled_chan$fn__65422.invoke(setup.clj:189)""
  ""query_processor.setup$do_with_database_local_settings$fn__65417.invoke(setup.clj:181)""
  ""query_processor.setup$do_with_driver$fn__65412$fn__65413.invoke(setup.clj:166)""
  ""driver$do_with_driver.invokeStatic(driver.clj:105)""
  ""driver$do_with_driver.invoke(driver.clj:100)""
  ""query_processor.setup$do_with_driver$fn__65412.invoke(setup.clj:165)""
  ""query_processor.setup$do_with_metadata_provider$fn__65405$fn__65408.invoke(setup.clj:151)""
  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:171)""
  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
  ""query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:160)""
  ""query_processor.store$do_with_metadata_provider.invoke(store.clj:151)""
  ""query_processor.setup$do_with_metadata_provider$fn__65405.invoke(setup.clj:150)""
  ""query_processor.setup$do_with_resolved_database$fn__65399.invoke(setup.clj:128)""
  ""query_processor.setup$do_with_qp_setup.invokeStatic(setup.clj:232)""
  ""query_processor.setup$do_with_qp_setup.invoke(setup.clj:216)""
  ""query_processor$process_query.invokeStatic(query_processor.clj:76)""
  ""query_processor$process_query.invoke(query_processor.clj:69)""
  ""api.dataset$run_streaming_query$fn__97277.invoke(dataset.clj:84)""
  ""query_processor.streaming$_streaming_response$fn__68924$fn__68925$fn__68926.invoke(streaming.clj:175)""
  ""query_processor.streaming$_streaming_response$fn__68924$fn__68925.invoke(streaming.clj:174)""
  ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
  ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
  ""query_processor.streaming$_streaming_response$fn__68924.invoke(streaming.clj:171)""
  ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:68)""
  ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:66)""
  ""async.streaming_response$do_f_async$task__52241.invoke(streaming_response.clj:87)""],
 :card_id nil,
 :context :ad-hoc,
 :error ""Don't know how to parse null nil as a temporal literal"",
 :row_count 0,
 :running_time 0,
 :ex-data {:type :invalid-parameter, :parameter nil},
 :data {:rows [], :cols []}}

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""bigquery-cloud-sdk"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-21"",
      ""tag"": ""v0.50.21"",
      ""hash"": ""ec9f5d7""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.85+"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

Medium, as it's blocking all our users on some analytics/reviews linked to date

### Additional context

_No response_",GautMauf,2024-08-23 10:17:17+00:00,['lbrdnk'],2024-08-26 17:34:53+00:00,2024-08-26 12:51:46+00:00,https://github.com/metabase/metabase/issues/47172,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Processor', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('Querying/Native', 'The SQL/native query editor'), ('.Backend', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Team/Querying', '')]",[],
2482802394,issue,closed,completed,App crashes when navigating between dashboards,"### Describe the bug

https://github.com/user-attachments/assets/6c802894-d0f9-405b-ae14-acd2dbc65cb8

Error in JS console:
```
Error: {status: 0, data: '', isCancelled: true}
```

### To Reproduce

1. Create and bookmark 2 dashboards 
2. Open app sidebar
3. Throttle your network (or use stats instance) or be quick with the next steps
4. Navigate to 1st dashboard
5. Open app sidebar
6. Navigate to 2nd dashboard

### Information about your Metabase installation

master, 743ae09aca


### Severity

P2
",kamilmielnik,2024-08-23 10:10:00+00:00,['kulyk'],2024-08-28 16:34:16+00:00,2024-08-28 16:00:34+00:00,https://github.com/metabase/metabase/issues/47170,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Reporting/Dashboards', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2482568103,issue,closed,completed,Add more e2e tests and testing plan for offset function,"**Context**
https://metaboat.slack.com/archives/C0645JP1W81/p1724089773297749

",NevRA,2024-08-23 08:06:08+00:00,[],2024-10-08 16:14:42+00:00,2024-09-13 17:23:33+00:00,https://github.com/metabase/metabase/issues/47168,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2482522585,issue,closed,completed,Use ensure-filter-stage from MLv2,"Blocked by #46935

https://github.com/metabase/metabase/pull/46670#discussion_r1728520246

https://github.com/metabase/metabase/pull/46935/files#diff-1b359acd6d8c0cdfd4d02ed5cca5a646e31d9a184fc0364d922cf92486ed4d05R73-R75",kamilmielnik,2024-08-23 07:39:09+00:00,['kamilmielnik'],2024-09-12 07:53:16+00:00,2024-09-12 07:53:15+00:00,https://github.com/metabase/metabase/issues/47166,"[('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2345522465, 'issue_id': 2482522585, 'author': 'kamilmielnik', 'body': 'Closed by merging `master` and fixing conflicts some time ago', 'created_at': datetime.datetime(2024, 9, 12, 7, 53, 16, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-09-12 07:53:16 UTC): Closed by merging `master` and fixing conflicts some time ago

"
2482455154,issue,open,,Drop barrel files,"https://tkdodo.eu/blog/please-stop-using-barrel-files
https://marvinh.dev/blog/speeding-up-javascript-ecosystem-part-7/

https://github.com/thepassle/eslint-plugin-barrel-files

it would be nice to find a happy mean betwen module encapsulation and no barrel files at all",uladzimirdev,2024-08-23 06:58:41+00:00,[],2024-08-26 11:47:49+00:00,,https://github.com/metabase/metabase/issues/47165,[],[],
2481784893,issue,open,,We show all columns of the table in the GUI editor when the user is sandboxed,"### Describe the bug

If you create a SQL question to do column level security, then all columns appear in the GUI editor for the sandboxed user, which shouldn't happen

### To Reproduce

1) create a SQL question like ""select name, email from people where state = {{state}}""
2) use it to sandbox the people table (you need to create a user, a group, and then do the sandboxing config)
3) authenticate as the sandboxed user and create a question on the people table... you'll see all the columns in the table when you should be able to see just 2

### Expected behavior

You should see the columns you have access to

### Logs

NA

### Information about your Metabase installation

```JSON
it has always been like that
```


### Severity

P3

### Additional context

_No response_",paoliniluis,2024-08-22 21:27:11+00:00,[],2025-02-04 20:28:42+00:00,,https://github.com/metabase/metabase/issues/47158,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Querying/Native', 'The SQL/native query editor'), ('.Backend', ''), ('Administration/Data Sandboxes', 'Enterprise Sandboxing'), ('.Team/Querying', '')]",[],
2481564196,issue,closed,completed,[FE] Notebook step restrictions,,ranquild,2024-08-22 19:33:36+00:00,['ranquild'],2024-10-08 16:15:24+00:00,2024-09-05 19:23:51+00:00,https://github.com/metabase/metabase/issues/47152,[],[],
2481564101,issue,closed,completed,[FE] Add docs link,Figma https://www.figma.com/design/Elev9KzNuxxtAG586dLqYO/Metrics-V2-in-0.51?node-id=8530-2143&node-type=FRAME&t=yKb29BzN6PaDAeXR-0,ranquild,2024-08-22 19:33:33+00:00,['ranquild'],2024-10-08 16:15:17+00:00,2024-09-06 17:49:02+00:00,https://github.com/metabase/metabase/issues/47151,[],[],
2481564017,issue,closed,not_planned,[FE] Automatically open the summarize step,,ranquild,2024-08-22 19:33:30+00:00,['ranquild'],2024-09-05 19:52:26+00:00,2024-09-05 19:52:26+00:00,https://github.com/metabase/metabase/issues/47150,[],[],
2481563938,issue,closed,completed,[BE] can-run/can-save metric constraints,"New constraints:
- 0-1 breakouts
- Breakouts can be on date or datetime columns only

Note - the FE uses `is-date-or-datetime?` helper for type checks. The BE needs to be consistent and do the same.",ranquild,2024-08-22 19:33:27+00:00,['ranquild'],2024-10-08 16:15:22+00:00,2024-09-05 20:54:15+00:00,https://github.com/metabase/metabase/issues/47149,[],[],
2481563870,issue,closed,completed,[FE] Summarize step copy changes,,ranquild,2024-08-22 19:33:25+00:00,['ranquild'],2024-10-08 16:16:18+00:00,2024-08-27 19:25:51+00:00,https://github.com/metabase/metabase/issues/47148,[],[],
2481554387,issue,closed,completed,[Epic] Explain usage and restrictions for metrics,"Product doc https://www.notion.so/metabase/Explain-usage-and-restrictions-for-metrics-3909b6db9fbb4707b4f823a904721096

```[tasklist]
- [ ] https://github.com/metabase/metabase/issues/47148
- [ ] https://github.com/metabase/metabase/issues/47152
- [ ] https://github.com/metabase/metabase/issues/47149
- [ ] https://github.com/metabase/metabase/issues/47588
- [ ] https://github.com/metabase/metabase/issues/47151
- [ ] https://github.com/metabase/metabase/issues/47701
- [ ] https://github.com/metabase/metabase/issues/47600
```
",ranquild,2024-08-22 19:26:55+00:00,['ranquild'],2024-10-03 09:05:59+00:00,2024-10-03 09:05:59+00:00,https://github.com/metabase/metabase/issues/47147,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2481532895,issue,open,,Querying :all fields on tables with nested (json) fields return only non-nested fields while the UI shows all fields.,"### Describe the bug

`:all` fields on tables with nested fields is expected to work like this:
- show all nested fields
- hide the top-level parsed fields

This was reproduced on Mongo and BigQuery (that we are working on now) https://github.com/metabase/metabase/pull/47106

### To Reproduce

1. Browse data > Table with nested fieds (like [this](https://stats.metabase.com/question#eyJkYXRhc2V0X3F1ZXJ5Ijp7ImRhdGFiYXNlIjoxNjYsInF1ZXJ5Ijp7InNvdXJjZS10YWJsZSI6NTIyMjh9LCJ0eXBlIjoicXVlcnkifSwiZGlzcGxheSI6InRhYmxlIiwidmlzdWFsaXphdGlvbl9zZXR0aW5ncyI6e319))
2. It shows that all fields are selected, but nested fields are not in the query


### Expected behavior

![image](https://github.com/user-attachments/assets/29caf327-17cb-4410-bae6-2e05bb8a98cb)

In this case, it should hide the `Host` and `Address` field and expand all nested fields in the query.
At the very least, the UI should be consistent with the generated query.

Unselecting a single field makes the query consistent with the UI.

### Logs

_No response_

### Information about your Metabase installation

```JSON
- v50.20
```


### Severity

P2

### Additional context

_No response_",luizarakaki,2024-08-22 19:12:05+00:00,[],2025-02-04 20:27:56+00:00,,https://github.com/metabase/metabase/issues/47146,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('Querying/MBQL', ''), ('.Backend', ''), ('.Team/Querying', '')]",[],
2481384100,issue,open,,Persisting of dashboard filters doesn't work with sandboxing,"### Describe the bug

The new persisting of dashboard filters is causing issues when sandboxed. When navigating to a different tenant, the filters from the previous tenant persist and cause dashboards to be incorrect

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
0.50
```


### Severity

P2

### Additional context

https://metaboat.slack.com/archives/C079BJHAH2T/p1724257601069299",NevRA,2024-08-22 17:45:57+00:00,[],2025-02-04 20:29:06+00:00,,https://github.com/metabase/metabase/issues/47140,"[('Priority:P2', 'Average run of the mill bug'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Backend', ''), ('Administration/Data Sandboxes', 'Enterprise Sandboxing'), ('.Team/Querying', '')]",[],
2481245848,issue,closed,completed,Basic actions do not work for models with a UUID primary key,"### Describe the bug

Basic actions do not work for models with a UUID type primary key.

### To Reproduce

1. Create a table with an UUID primary key. For example:
```
CREATE TABLE public.fuel_ean (
   id UUID PRIMARY KEY,
   npi_class TEXT,
   fuel_family TEXT
);

INSERT INTO public.fuel_ean (id, npi_class, fuel_family) VALUES
('df87adec-f142-4547-8866-3e05fe0991f5', 'Car', 'Gasoline'),
('e38d48f2-3a4e-4b1f-b2e9-8d77ec8f42bf', 'Truck', 'Diesel'),
('b1d4c5e2-8fc4-4297-94d6-9a847c2f0b45', 'SUV', 'Hybrid');
```
2. Scan the table, and ensure the `id` column is set as a primary key, and filter type is drop down in the table metadata.
3. Create a simple model and enable basic actions for it
4. Open the model, click on an id to view an individual record
5. Select `...` / Update, and try to update the record.
6. (!)It fails with an error message: 
```
Missing primary key parameter: ""id""
```
<img width=""488"" alt=""image"" src=""https://github.com/user-attachments/assets/ad86dd99-54d1-472f-8eaa-e8061e0b8804"">

7. Go to the model, enter Model details / Actions, try to trigger an action from there
8.(!)The action fails with the following error:
```
ERROR: operator does not exist: uuid = character varying 
Hint: No operator matches the given name and argument types. You might need to add explicit type casts. 
```

<img width=""478"" alt=""image"" src=""https://github.com/user-attachments/assets/cbc1aea2-0539-40a7-95f0-a07f2ca5f579"">


### Expected behavior

Actions should work on uuid fields.

### Logs

```
postgres-sample-15-1    | 2024-08-22 16:13:21.912 UTC [262] ERROR:  operator does not exist: uuid = character varying at character 65                                                                                 
postgres-sample-15-1    | 2024-08-22 16:13:21.912 UTC [262] HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.                                                  
postgres-sample-15-1    | 2024-08-22 16:13:21.912 UTC [262] STATEMENT:  DELETE  FROM ""public"".""fuel_ean"" WHERE ""public"".""fuel_ean"".""id"" = $1                                                                          
postgres-sample-15-1    | 2024-08-22 16:13:21.914 UTC [262] ERROR:  current transaction is aborted, commands ignored until end of transaction block                                                                   

                                                                                                                                     
metabase-v1.50.21-ee-1  | 2024-08-22 16:13:21,920 DEBUG middleware.log :: POST /api/action/4/execute 400 193.0 ms (21 DB calls) {:metabase-user-id 1}                                                                 
metabase-v1.50.21-ee-1  | {:via                                                                                                                                                                                       
metabase-v1.50.21-ee-1  |  [{:type clojure.lang.ExceptionInfo,                                                                                                                                                        
metabase-v1.50.21-ee-1  |    :message                                                                                                                                                                                 
metabase-v1.50.21-ee-1  |    ""Batch entry 0 DELETE  FROM \""public\"".\""fuel_ean\"" WHERE \""public\"".\""fuel_ean\"".\""id\"" = ('123') was aborted: ERROR: operator does not exist: uuid = character varying\n  Hint: No oper
ator matches the given name and argument types. You might need to add explicit type casts.\n  Position: 65  Call getNextException to see other errors in the batch."",                                                 
metabase-v1.50.21-ee-1  |    :data                                                                                                                                                                                    
metabase-v1.50.21-ee-1  |    {:message                                                                                                                                                                                
metabase-v1.50.21-ee-1  |     ""Batch entry 0 DELETE  FROM \""public\"".\""fuel_ean\"" WHERE \""public\"".\""fuel_ean\"".\""id\"" = ('123') was aborted: ERROR: operator does not exist: uuid = character varying\n  Hint: No ope
rator matches the given name and argument types. You might need to add explicit type casts.\n  Position: 65  Call getNextException to see other errors in the batch."",                                                
metabase-v1.50.21-ee-1  |     :status-code 400},                                                                                                                                                                      
metabase-v1.50.21-ee-1  |    :at [metabase.driver.sql_jdbc.actions$do_with_auto_parse_sql_error invokeStatic ""actions.clj"" 73]}],                               
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mongo"",
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-08-21"",
      ""tag"": ""v1.50.21"",
      ""hash"": ""ec9f5d7""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.19 (Debian 12.19-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.75-0-virt"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```


### Severity

Reported by a customer

### Additional context

The issue was reported and replicated while using PostgreSQL. I haven't tried with other databases.",zbodi74,2024-08-22 16:24:06+00:00,['wzimrin'],2025-01-09 00:45:37+00:00,2025-01-08 23:52:46+00:00,https://github.com/metabase/metabase/issues/47139,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Database/Postgres', None), ('.Backend', ''), ('Querying/Actions', ''), ('.Team/Querying', '')]","[{'comment_id': 2550806547, 'issue_id': 2481245848, 'author': 'joeledwardson', 'body': 'hi, any update on this?', 'created_at': datetime.datetime(2024, 12, 18, 9, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2559666206, 'issue_id': 2481245848, 'author': 'joeledwardson', 'body': 'I\'m not sure if this should be in a separate issue, but in the docs for creating a CRUD app it shows the ID dropdown at the top. i tried adding a click behaviour from the table so that the filter can be set by clicking the ID column.\n\nWhen the row ID is clicked the filter correctly updates the table, however when an update/delete basic action is used, the ID is not passed correctly to the action (`Missing primary key parameter: ""id""`)\n\nHowever, if I click the row ID and pick an ID manually and click update filter like in the docs [here](https://www.metabase.com/learn/metabase-basics/querying-and-dashboards/actions-crud) it works fine\n\n![Image](https://github.com/user-attachments/assets/8503eee0-b4f4-48aa-b06e-021769d3719f)\n![Image](https://github.com/user-attachments/assets/84f068f4-7c5d-4033-a1ae-ba3374b7e2df)\n![Image](https://github.com/user-attachments/assets/840e7886-5510-42ae-80d7-a334310e90fd)', 'created_at': datetime.datetime(2024, 12, 23, 12, 59, 49, tzinfo=datetime.timezone.utc)}]","joeledwardson on (2024-12-18 09:23:00 UTC): hi, any update on this?

joeledwardson on (2024-12-23 12:59:49 UTC): I'm not sure if this should be in a separate issue, but in the docs for creating a CRUD app it shows the ID dropdown at the top. i tried adding a click behaviour from the table so that the filter can be set by clicking the ID column.

When the row ID is clicked the filter correctly updates the table, however when an update/delete basic action is used, the ID is not passed correctly to the action (`Missing primary key parameter: ""id""`)

However, if I click the row ID and pick an ID manually and click update filter like in the docs [here](https://www.metabase.com/learn/metabase-basics/querying-and-dashboards/actions-crud) it works fine

![Image](https://github.com/user-attachments/assets/8503eee0-b4f4-48aa-b06e-021769d3719f)
![Image](https://github.com/user-attachments/assets/84f068f4-7c5d-4033-a1ae-ba3374b7e2df)
![Image](https://github.com/user-attachments/assets/840e7886-5510-42ae-80d7-a334310e90fd)

"
2480936430,issue,closed,completed,Add tests for timeline permissions checks,"We should ensure we don't have a regression for the Timeline API - it needs to check permissions on the containing collection before returning anything.

Basically we want to test this: https://github.com/metabase/metabase/pull/46863",johnswanson,2024-08-22 14:27:15+00:00,['johnswanson'],2024-10-08 16:15:23+00:00,2024-09-05 20:16:26+00:00,https://github.com/metabase/metabase/issues/47135,"[('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2480919952,issue,closed,completed,Question/Model Settings Sidesheet,"https://www.figma.com/design/NOCVfjRaqkVhNqNq8jL9mX/Rework-the-info-sidebar-and-entity-actions?node-id=5657-51454&t=BEZuzEX2s247EG54-4

![Screen Shot 2024-09-04 at 12 33 23 PM](https://github.com/user-attachments/assets/303a1655-8d5d-46d3-9a99-045ab390e38d)


![Screen Shot 2024-09-04 at 12 34 01 PM](https://github.com/user-attachments/assets/f8b82f20-1183-4e96-9a88-6678042916f9)

",iethree,2024-08-22 14:20:07+00:00,['iethree'],2024-09-13 12:42:00+00:00,2024-09-13 12:42:00+00:00,https://github.com/metabase/metabase/issues/47133,[],[],
2480919758,issue,closed,completed,Question/Model/Metric Info Sidesheet,"- [x] Convert current sidebar to sidesheet
- [ ] Create settings sidebar and move settings from info to settings sidesheet
- [ ] Beef up info displayed in info sidebar",iethree,2024-08-22 14:20:03+00:00,['iethree'],2024-10-08 16:15:05+00:00,2024-09-09 18:24:50+00:00,https://github.com/metabase/metabase/issues/47132,[],[],
2480919605,issue,closed,completed,Dashboard Settings Sidesheet,,iethree,2024-08-22 14:19:58+00:00,[],2024-10-08 16:14:32+00:00,2024-09-24 13:16:21+00:00,https://github.com/metabase/metabase/issues/47131,[],[],
2480919414,issue,closed,completed,Dashboard Info Sidesheet,,iethree,2024-08-22 14:19:54+00:00,['rafpaf'],2024-10-08 16:14:44+00:00,2024-09-13 17:11:07+00:00,https://github.com/metabase/metabase/issues/47130,[],[],
2480694783,issue,open,,The login from new device notification does't always matches the Device location.,"### Describe the bug

We have occasions when there is a new login from a new device the location doesn't match the actual location of the user. For example a user in Oklahoma got the location of Texas 

<img width=""917"" alt=""image"" src=""https://github.com/user-attachments/assets/8aa4d932-5f30-428d-a1db-1f59c750266c"">

Another user which lives in Texas got the following notification his location was in Miami Florida

<img width=""209"" alt=""image"" src=""https://github.com/user-attachments/assets/1c35284a-3fa8-4ec3-984e-87da9a7be05d"">


### To Reproduce

No idea how to properly reproduce this. Tried to test with a VPN but didn't manage to replicate but there is something wrong with our location.

The users I mentioned above had his IDP logs IP correctly pointing to Texas where the user lives. Only Metabase notification was wrong.

I am not sure how to consistently replicate.

### Expected behavior

The Device location matches the notification

### Logs

None that are relevant

### Information about your Metabase installation

```JSON
Happened both in stats and in a version 50
```


### Severity

Depends how important is security. 

### Additional context

_No response_",Tony-metabase,2024-08-22 12:42:25+00:00,[],2025-02-04 20:26:03+00:00,,https://github.com/metabase/metabase/issues/47124,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('Misc/Emails', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2396993315, 'issue_id': 2480694783, 'author': 'crisptrutski', 'body': ""If the IDP logs' IP address was correct, the issue might have come from the get.geojs.io service we delegate to."", 'created_at': datetime.datetime(2024, 10, 7, 13, 50, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572859114, 'issue_id': 2480694783, 'author': 'piranha', 'body': 'it seems like geojs.io is really inaccurate (based on my non-scientific testing), maybe we should switch to something more accurate. ip-api.com seems way more accurate.', 'created_at': datetime.datetime(2025, 1, 6, 10, 51, 43, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-10-07 13:50:08 UTC): If the IDP logs' IP address was correct, the issue might have come from the get.geojs.io service we delegate to.

piranha on (2025-01-06 10:51:43 UTC): it seems like geojs.io is really inaccurate (based on my non-scientific testing), maybe we should switch to something more accurate. ip-api.com seems way more accurate.

"
2480675248,issue,closed,completed,Clearing filters causes the whole page to close,"### Describe the bug

If you send someone a dashboard link, such as https://metabase.maishameds.org/dashboard/98-digital-wallets-mvp-malaria-negative if you clear one of the filters the entire page closes. This doesn't happen if you open the dashboard by finding it on Metabase. 



### To Reproduce

1. Click on the above link
2. Change on of the filters


### Expected behavior

The filter should change the page should not close. 

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.5.0-1023-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""snowflake"",
      ""mysql"",
      ""h2""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.13""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-06"",
      ""tag"": ""v0.50.19"",
      ""hash"": ""0b97bf8""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

Making it difficult to share dashboards across the org

### Additional context

_No response_",natashamathur,2024-08-22 12:33:02+00:00,[],2024-08-22 12:35:06+00:00,2024-08-22 12:35:06+00:00,https://github.com/metabase/metabase/issues/47123,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2304561457, 'issue_id': 2480675248, 'author': 'kamilmielnik', 'body': ""It's been fixed in 0.50.20.\r\nDuplicate of https://github.com/metabase/metabase/issues/46570.\r\nClosing."", 'created_at': datetime.datetime(2024, 8, 22, 12, 35, 6, tzinfo=datetime.timezone.utc)}]","kamilmielnik on (2024-08-22 12:35:06 UTC): It's been fixed in 0.50.20.
Duplicate of https://github.com/metabase/metabase/issues/46570.
Closing.

"
2480524527,issue,closed,completed,Add bundle size check at CI,,uladzimirdev,2024-08-22 11:16:34+00:00,['uladzimirdev'],2025-02-03 08:51:41+00:00,2025-02-03 08:51:41+00:00,https://github.com/metabase/metabase/issues/47118,[],[],
2479058496,issue,closed,completed,Improve the story for encryption of settings,We added the ability to never-encrypt certain settings. We should go through the existing settings and decide which ones can safely be never-encrypted. This probably includes all booleans.,johnswanson,2024-08-21 20:37:23+00:00,['johnswanson'],2024-10-01 12:49:37+00:00,2024-09-25 19:26:22+00:00,https://github.com/metabase/metabase/issues/47101,"[('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2316363570, 'issue_id': 2479058496, 'author': 'dpsutton', 'body': ""reopening because we should be a bit more comprehensive. I'm trying to see the values of `'query-caching-min-ttl'` and `'query-caching-ttl-ratio'` but many of them are encrypted. These are non-sensitive numbers."", 'created_at': datetime.datetime(2024, 8, 28, 22, 41, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2385694987, 'issue_id': 2479058496, 'author': 'github-actions[bot]', 'body': '🚀 This should also be released by [v0.50.28](https://github.com/metabase/metabase/milestone/273)', 'created_at': datetime.datetime(2024, 10, 1, 12, 49, 35, tzinfo=datetime.timezone.utc)}]","dpsutton on (2024-08-28 22:41:30 UTC): reopening because we should be a bit more comprehensive. I'm trying to see the values of `'query-caching-min-ttl'` and `'query-caching-ttl-ratio'` but many of them are encrypted. These are non-sensitive numbers.

github-actions[bot] on (2024-10-01 12:49:35 UTC): 🚀 This should also be released by [v0.50.28](https://github.com/metabase/metabase/milestone/273)

"
2478932652,issue,open,,Filtering on questions when you land from a dashboard expose filters that you can't use when you don't have self service perms,"### Describe the bug

Seems like a tautology but it's not

### To Reproduce

As an admin
1) create a user and a group, add this user to the group you created
2) set block to the permissions of all users to data, and also don't allow all users to create questions
3) set ""can view"" but not create queries to the group you created
![image](https://github.com/user-attachments/assets/f25395c3-bc1f-45f8-8aa6-5de5f6acf878)
4) then build a question (e.g. count of orders per product category), and add the question to a dashboard, connect the category filter to the question

As the new user:
1) go to the dashboard, see that you can use the filter
![image](https://github.com/user-attachments/assets/4be1a67f-aad3-4ecc-a2e0-cf5635b02c3a)

(we're hitting GET https://localhost:8443/api/dashboard/<dashboard_id>/params/<param_id>/values here)

2) but once you click the question, you don't get the values in the filter
![image](https://github.com/user-attachments/assets/cc344b17-9f22-4009-b4cd-4f35dc85020d)

(we're hitting POST https://localhost:8443/api/dataset/parameter/values here, and that might be the reason)

### Expected behavior

if you could filter the values in the first screen, you should be able to hit them when you moved to the question... or we should remove the filtering there altogether

### Logs

NA

### Information about your Metabase installation

```JSON
v50.21
```


### Severity

P3

### Additional context

_No response_",paoliniluis,2024-08-21 19:44:14+00:00,[],2025-02-04 20:29:06+00:00,,https://github.com/metabase/metabase/issues/47097,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Backend', ''), ('.Team/Querying', ''), ('Frequency:Rare', 'Something users bump into rarely')]",[],
2478826882,issue,closed,completed,E2E Sandboxing Test Fixes/Improvements,"Some sandboxing E2E tests are giving us false positives. There's two major issues that led to this being possible:
- E2E sandboxing setup was broken during the split permissions migration that happened from v49 -> v50
- Assertions in our sandbox tests aren't strict enough and generally make no assertions that the underlying data is actually sandboxed.

For a more eloquent explanation and history of this problem, read @nemanjaglumac's message here:
https://metaboat.slack.com/archives/C505ZNNH4/p1724187422396359

```[tasklist]
### Tasks
- [x] add assertions that tests are working with sandboxed data (test for `is_sandboxed` on results data, add assertions that certain data should not be visible, and add assertions that results are limited)
- [x] add helpers for modifying the default group's permissions to allow for setting up sandboxing using `default` snapshot + port tests to new utils
- [x] remove the` default-ee` snapshot
```
",sloansparger,2024-08-21 19:05:52+00:00,['nemanjaglumac'],2024-09-25 14:09:37+00:00,2024-09-23 21:27:55+00:00,https://github.com/metabase/metabase/issues/47095,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2478543646,issue,closed,completed,Summarizing by minute will drop the day in the CSV,"### Describe the bug

Seems like in the CSV export code we're eating the day in some way as the exports end up with ""MMM, YYYY, minute""

### To Reproduce

1) set up metabase with postgres
2) build a query like
![image](https://github.com/user-attachments/assets/4fc64a68-211b-43b9-8638-951c91e26926)

3) export it, see that the file doesn't have the day number, while the question does

### Expected behavior

it should be exactly like the question

### Logs

NA

### Information about your Metabase installation

```JSON
v50.21
```


### Severity

P1

### Additional context

regression",paoliniluis,2024-08-21 17:03:32+00:00,[],2024-08-21 23:41:06+00:00,2024-08-21 22:48:07+00:00,https://github.com/metabase/metabase/issues/47090,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Export', ''), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2478527301,issue,closed,completed,Get rid of selectors warnings from browser console,,uladzimirdev,2024-08-21 16:55:47+00:00,['uladzimirdev'],2024-08-22 11:56:59+00:00,2024-08-22 11:22:43+00:00,https://github.com/metabase/metabase/issues/47087,[],[],
2478491216,issue,closed,completed,"""readOnly=true"" in additional JDBC options is ignored (?)","### Describe the bug

Seems that for some reason the ""readOnly=true"" parameter in the JDBC additional options is completely ignored

### To Reproduce

1) set up a postgres DB (use the metabase-qa container image)
2) add it to Metabase, use readOnly=true https://jdbc.postgresql.org/documentation/use/
3) do an INSERT on any table

see that the insert will be commited to disk, when it shouldn't

### Expected behavior

it shouldn't be flushed to disk, as it should be readonly

### Logs

NA

### Information about your Metabase installation

```JSON
v50.21
```


### Severity

P2

### Additional context

This is what reaches the DB:
![image](https://github.com/user-attachments/assets/0dc6bb97-fee7-41eb-85db-4fbecad2ea82)

```
2024-08-21 16:36:49.519 UTC [94714] LOG:  execute <unnamed>: SET SESSION CHARACTERISTICS AS TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
2024-08-21 16:36:49.520 UTC [94714] LOG:  execute <unnamed>: SET ROLE NONE
2024-08-21 16:36:49.520 UTC [94714] LOG:  execute <unnamed>: -- Metabase:: userID: 1 queryType: native queryHash: aedc58a20861c8c09aabe77ef0ce96be35c7159211e66869d02f106e9492c34e
	insert into people values (11113, 1, 1)
2024-08-21 16:36:49.522 UTC [94714] LOG:  execute <unnamed>: SET SESSION CHARACTERISTICS AS TRANSACTION ISOLATION LEVEL READ COMMITTED
```",paoliniluis,2024-08-21 16:37:53+00:00,[],2024-08-21 18:00:23+00:00,2024-08-21 18:00:23+00:00,https://github.com/metabase/metabase/issues/47084,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2302525220, 'issue_id': 2478491216, 'author': 'paoliniluis', 'body': ""BTW @bahaa this is what you were seeing in your instance, we'll check this out. In the meantime please change the user in the database to be able to do SELECT statements only, this has been like this since v47.7"", 'created_at': datetime.datetime(2024, 8, 21, 16, 40, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2302556287, 'issue_id': 2478491216, 'author': 'bahaa', 'body': ""@paoliniluis Yes, it's related. We already created  a user with SELECT only privileges. Thank you."", 'created_at': datetime.datetime(2024, 8, 21, 16, 57, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2302661919, 'issue_id': 2478491216, 'author': 'paoliniluis', 'body': 'nah, it\'s not ignored, it\'s me missing the ""readOnlyMode=always"". For posterity, want a read only postgres? add readOnlyMode=always&readOnly=true to the connection string cc @abdhabli @jeff-bruemmer @alexyarosh', 'created_at': datetime.datetime(2024, 8, 21, 18, 0, 21, tzinfo=datetime.timezone.utc)}]","paoliniluis (Issue Creator) on (2024-08-21 16:40:28 UTC): BTW @bahaa this is what you were seeing in your instance, we'll check this out. In the meantime please change the user in the database to be able to do SELECT statements only, this has been like this since v47.7

bahaa on (2024-08-21 16:57:40 UTC): @paoliniluis Yes, it's related. We already created  a user with SELECT only privileges. Thank you.

paoliniluis (Issue Creator) on (2024-08-21 18:00:21 UTC): nah, it's not ignored, it's me missing the ""readOnlyMode=always"". For posterity, want a read only postgres? add readOnlyMode=always&readOnly=true to the connection string cc @abdhabli @jeff-bruemmer @alexyarosh

"
2478452428,issue,open,,sync eslint configs between main and enterprise apps,"**Context**

https://github.com/metabase/metabase/pull/47056#discussion_r1725216128


",uladzimirdev,2024-08-21 16:19:20+00:00,[],2025-02-04 20:23:47+00:00,,https://github.com/metabase/metabase/issues/47083,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2478401623,issue,closed,completed,Downgrading from 50 to 49 makes sandboxed tables not appear as sandboxed in permissions editor.,"### Describe the bug

When sandboxing is configured in v50 of the app (first screenshot) then you downgrade to v49 via the CLI, it appears we lose sandboxing permissions (second screenshot)
![image (3)](https://github.com/user-attachments/assets/de878def-9cd4-4bb3-828d-8d07fc0a170a)
![image (4)](https://github.com/user-attachments/assets/0983e824-3304-44d1-98eb-9ad20e47a644)
Sandboxes are still enforced, but the UI makes it seem like it's not going to be. It appears the permissions graph sent to the client contains no sandboxing data. However, upgrading back to v50 shows sandbox data.

### To Reproduce

- On v50, set up a sandboxed table (I specifically use v50.20)
- Downgrade to v49 (I used v49.18)
- See that table is no longer set to sandboxed

### Expected behavior

Tables should remain sandboxed

### Logs

_No response_

### Information about your Metabase installation

```JSON
Multi-version issue. Using v50.20 and v49.18.
```


### Severity

likely to scare users, but ultimately annoying

### Additional context

_No response_",sloansparger,2024-08-21 15:53:57+00:00,"['sloansparger', 'noahmoss']",2024-08-22 02:19:31+00:00,2024-08-21 21:43:39+00:00,https://github.com/metabase/metabase/issues/47082,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2478347955,issue,open,,mt/with-temp for :model/User does not create an entity id,"### Describe the bug

Even though the `User` model derives :hook/entity-id, there is no entity id created:

I don't think this is a toucan bug, but some config issue in metabase/metabase.

```
(t2.with-temp/with-temp
  [:model/User {id :id}]
  (t2/select-one :model/User id))
;; => (toucan2.instance/instance :model/User {:email ""ufabuotsulskondwdazf@metabase.com"", :first_name ""JXVJVWGXYUJHYKXTRXAO"", :last_login nil, :is_qbnewb true, :is_superuser false, :id 39, :last_name ""ZDUIPDMCYEBXAMCJIXCU"", :date_joined #t ""2024-08-21T15:23:37.659342Z"", :common_name ""JXVJVWGXYUJHYKXTRXAO ZDUIPDMCYEBXAMCJIXCU""})
```

Even instructing with-temp to add an entity_id by hand doesn't work:

```
(t2.with-temp/with-temp
  [:model/User {id :id} {:entity_id (u/generate-nano-id)}]
  (t2/select-one :model/User id))
;;=> (toucan2.instance/instance :model/User {:email ""xyqvasoeksysvuvspxmi@metabase.com"", :first_name ""OWPRVPKNSBMOPWTNXEHB"", :last_login nil, :is_qbnewb true, :is_superuser false, :id 40, :last_name ""EJZOWECCYQPLGUPOZEOQ"", :date_joined #t ""2024-08-21T15:24:53.158795Z"", :common_name ""OWPRVPKNSBMOPWTNXEHB EJZOWECCYQPLGUPOZEOQ""})
```


### To Reproduce

1. Run provided forms in the repl
2. See no entity_id on the temp user

### Expected behavior

There should be an entity_id on the temporary user

### Logs

_No response_

### Information about your Metabase installation

```JSON
- irrelevant
```


### Severity

P3

### Additional context

_No response_",escherize,2024-08-21 15:26:49+00:00,[],2025-02-04 20:26:39+00:00,,https://github.com/metabase/metabase/issues/47081,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Organization/', ''), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2478028376,issue,open,,Support datashares on Redshift,"**Is your feature request related to a problem? Please describe.**
Redshift database offers the functionality to define datashares, more info here:

https://docs.aws.amazon.com/redshift/latest/mgmt/query-editor-v2-datashare-using.html

You are able to access this datashare via SQL when using  the Native Query Editor and running `<shareddatabase>.<schema>.<object>`. So the jdbc driver knows about this datashare and how to fetch data. However when you go to create a question using a field filter, you can not see the schema/table from the data share to select the column. Also there are no Tables in the Admin -> Table Metadata.

Metabase simply doesn't know about this datashare since it doesn't run the proper queries to get the metadata for it.

**Describe the solution you'd like**
It would be nice to have a setting in the Database Settings, something like this:

<img width=""1511"" alt=""image"" src=""https://github.com/user-attachments/assets/1c5a8322-d4ba-4008-aef2-696490f9cfe9"">

In which if you enable Metabase will support Redshift datashares and run sync and scan queries accordingly.

**Describe alternatives you've considered**
Nothing just use the SQL but you end up very limited in functionality
",Tony-metabase,2024-08-21 13:19:32+00:00,[],2025-02-04 20:31:03+00:00,,https://github.com/metabase/metabase/issues/47070,"[('Database/Redshift', None), ('Administration/Metadata & Sync', ''), ('Type:New Feature', ''), ('.Team/Drivers', '')]","[{'comment_id': 2309986375, 'issue_id': 2478028376, 'author': 'brunobergher', 'body': 'I guess this effectively means including datashares as part of the entities enumerated during sync, right?', 'created_at': datetime.datetime(2024, 8, 26, 11, 32, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2310014593, 'issue_id': 2478028376, 'author': 'Tony-metabase', 'body': ""Yes correct. Right now during sync metabase doesn't know about//what datashares are ... Now we can either have this by default or give the option enable/disable it so metabase knows when and when not to access datashares"", 'created_at': datetime.datetime(2024, 8, 26, 11, 48, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2376874269, 'issue_id': 2478028376, 'author': 'fvianamo-ttl', 'body': ""I am also interested! We rely a lot on data sharing and just starting to work with Metabase. While we do not have this native integration with Redshift external databases, if you create external schemas on Metabase's connected database your relations will appear on the next sync.\r\n```\r\nCREATE EXTERNAL SCHEMA <schema_name>\r\n    FROM REDSHIFT DATABASE <external database created from datashare>\r\n    SCHEMA <schema_name on datashare>;\r\n```"", 'created_at': datetime.datetime(2024, 9, 26, 12, 54, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2447578018, 'issue_id': 2478028376, 'author': 'marshallm94', 'body': 'Is there any update on this?\n\n@fvianamo-ttl did you run your command in RedShift?', 'created_at': datetime.datetime(2024, 10, 30, 15, 37, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2447751318, 'issue_id': 2478028376, 'author': 'fvianamo-ttl', 'body': '@marshallm94 yes!', 'created_at': datetime.datetime(2024, 10, 30, 16, 36, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2447860242, 'issue_id': 2478028376, 'author': 'marshallm94', 'body': '@fvianamo-ttl did you run that in the _consumer_ redshift cluster/namespace, or the _producer_ redshift cluster?', 'created_at': datetime.datetime(2024, 10, 30, 17, 18, 9, tzinfo=datetime.timezone.utc)}, {'comment_id': 2448661431, 'issue_id': 2478028376, 'author': 'fvianamo-ttl', 'body': '@marshallm94 you run it at consumer side. I am assuming that you have already created a database on your consumer cluster, based on a datashare. Then, you have to mirror schemas that you introduced with your shared database by creating those proposed external schemas on the database you connect Metabase on.', 'created_at': datetime.datetime(2024, 10, 30, 23, 26, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2450709796, 'issue_id': 2478028376, 'author': 'marshallm94', 'body': '@fvianamo-ttl worked great - thanks!\n\nFor anyone else that stumbles here from Google:\n\nAssumptions:\n- 1. A datashare has been created from the producer cluster/namespace to the consumer cluster/namespace.\n- 2. A database has been created in the consumer cluster/namespace from the datashare.\n\n- Steps:\n  - 1. In the consumer cluster/namespace, run the following (making necessary substitutions):\n    ```sql\n    CREATE EXTERNAL SCHEMA {schema name for consumer cluster/namespace} FROM REDSHIFT DATABASE {external database created from datashare} SCHEMA {schema name in datashare};\n    ```\n  - 2. Grant usage on the external schema **to the user that is used to connect to the DB in Metabase**:\n    ```sql\n    GRANT USAGE ON SCHEMA {schema name for consumer cluster/namespace} TO GROUP {group that is used to connect to consumer cluster/namespace in Metabase};\n    ```\n\nThis worked for me on Metabase Version: v0.46.6.4 using RedShift Serverless', 'created_at': datetime.datetime(2024, 10, 31, 19, 58, 34, tzinfo=datetime.timezone.utc)}]","brunobergher on (2024-08-26 11:32:23 UTC): I guess this effectively means including datashares as part of the entities enumerated during sync, right?

Tony-metabase (Issue Creator) on (2024-08-26 11:48:41 UTC): Yes correct. Right now during sync metabase doesn't know about//what datashares are ... Now we can either have this by default or give the option enable/disable it so metabase knows when and when not to access datashares

fvianamo-ttl on (2024-09-26 12:54:40 UTC): I am also interested! We rely a lot on data sharing and just starting to work with Metabase. While we do not have this native integration with Redshift external databases, if you create external schemas on Metabase's connected database your relations will appear on the next sync.
```
CREATE EXTERNAL SCHEMA <schema_name>
    FROM REDSHIFT DATABASE <external database created from datashare>
    SCHEMA <schema_name on datashare>;
```

marshallm94 on (2024-10-30 15:37:59 UTC): Is there any update on this?

@fvianamo-ttl did you run your command in RedShift?

fvianamo-ttl on (2024-10-30 16:36:44 UTC): @marshallm94 yes!

marshallm94 on (2024-10-30 17:18:09 UTC): @fvianamo-ttl did you run that in the _consumer_ redshift cluster/namespace, or the _producer_ redshift cluster?

fvianamo-ttl on (2024-10-30 23:26:57 UTC): @marshallm94 you run it at consumer side. I am assuming that you have already created a database on your consumer cluster, based on a datashare. Then, you have to mirror schemas that you introduced with your shared database by creating those proposed external schemas on the database you connect Metabase on.

marshallm94 on (2024-10-31 19:58:34 UTC): @fvianamo-ttl worked great - thanks!

For anyone else that stumbles here from Google:

Assumptions:
- 1. A datashare has been created from the producer cluster/namespace to the consumer cluster/namespace.
- 2. A database has been created in the consumer cluster/namespace from the datashare.

- Steps:
  - 1. In the consumer cluster/namespace, run the following (making necessary substitutions):
    ```sql
    CREATE EXTERNAL SCHEMA {schema name for consumer cluster/namespace} FROM REDSHIFT DATABASE {external database created from datashare} SCHEMA {schema name in datashare};
    ```
  - 2. Grant usage on the external schema **to the user that is used to connect to the DB in Metabase**:
    ```sql
    GRANT USAGE ON SCHEMA {schema name for consumer cluster/namespace} TO GROUP {group that is used to connect to consumer cluster/namespace in Metabase};
    ```

This worked for me on Metabase Version: v0.46.6.4 using RedShift Serverless

"
2477816370,issue,closed,completed,[Epic] Test title ,"**Links**
- product doc: _link to product doc_
- eng doc: _link to technical design doc, if any_
- feature branch: `branch-name` _this should be the feature branch where this work will be done in. PRs will be delivered against this branch_
- issue links: _related issues if any_

**Implementation Plan**


***Milestone 1***
_insert tasklist here_

***Milestone 2***

",NevRA,2024-08-21 11:39:46+00:00,[],2024-08-21 11:39:51+00:00,2024-08-21 11:39:51+00:00,https://github.com/metabase/metabase/issues/47066,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2477685161,issue,closed,completed,iFrameResizer doesn't work on master (v51),"### Describe the bug

iFrameResizer doesn't work anymore on master

#### master (1b9a267551a1f192436935f3de31c706cbc7f316)
![Screenshot 2024-08-21 at 5 30 25 PM](https://github.com/user-attachments/assets/6f079997-8e84-48a6-aa14-39f271d7c608)

#### release-x.50.x (5ac95a7e4a07f156a54f1b36b2b0c982a0bcee19)
![Screenshot 2024-08-21 at 5 28 27 PM](https://github.com/user-attachments/assets/77178a60-a72b-4644-bb96-3c1f14bb3c4b)




### To Reproduce

1. Embed a dashboard.
2. Follow [this step](https://www.metabase.com/docs/latest/embedding/static-embedding#resizing-dashboards-to-fit-their-content) to trigger `iFrameResizer`

### Expected behavior

The dashboard content is resized correctly.

### Logs

_No response_

### Information about your Metabase installation

```JSON
master @ 1b9a267551a1f192436935f3de31c706cbc7f316
```


### Severity

P1 this blocks customers that are using iframe resizer from using our embeds

### Additional context

_No response_",WiNloSt,2024-08-21 10:33:49+00:00,['WiNloSt'],2024-10-08 16:16:43+00:00,2024-08-22 10:49:03+00:00,https://github.com/metabase/metabase/issues/47061,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('.Regression/master', 'Regression that is only present on master, or bug in new upcoming feature'), ('.Team/Embedding', '')]","[{'comment_id': 2303946862, 'issue_id': 2477685161, 'author': 'WiNloSt', 'body': ""e02589a386814a83aaf330db61d4377e129eeb95 started breaking the iframe-resizer because it somehow prevents https://github.com/metabase/metabase/blob/00ff56e8eebc47e35c7827c7ec3580c04bf28b8b/frontend/src/metabase/lib/dom.js#L512-L514\r\n\r\nfrom being loaded. This breaks `onReady` because it wasn't called. Changing this to just `import()` fixes the problem.\r\n\r\n~This is only a part of all the problems though.~\r\n\r\nThis ended up being the whole reason why it didn't work. Which is great, so I don't have to fix anything else 😄"", 'created_at': datetime.datetime(2024, 8, 22, 7, 12, 46, tzinfo=datetime.timezone.utc)}]","WiNloSt (Issue Creator) on (2024-08-22 07:12:46 UTC): e02589a386814a83aaf330db61d4377e129eeb95 started breaking the iframe-resizer because it somehow prevents https://github.com/metabase/metabase/blob/00ff56e8eebc47e35c7827c7ec3580c04bf28b8b/frontend/src/metabase/lib/dom.js#L512-L514

from being loaded. This breaks `onReady` because it wasn't called. Changing this to just `import()` fixes the problem.

~This is only a part of all the problems though.~

This ended up being the whole reason why it didn't work. Which is great, so I don't have to fix anything else 😄

"
2477626896,issue,closed,completed,Generate sample Express.js server and React components for user switching via the CLI,Refer to the [product docs here](https://www.notion.so/metabase/CLI-sets-permissions-and-a-mock-SSO-implementation-2cdce524908140a394a528e035e4c6b1?pvs=4).,heypoom,2024-08-21 10:06:48+00:00,['heypoom'],2024-10-08 16:16:11+00:00,2024-08-28 17:05:11+00:00,https://github.com/metabase/metabase/issues/47059,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2477625245,issue,closed,completed,App crashes when editing custom expression referencing metric when dependent metadata is not loaded,"### Describe the bug

Original report: https://metaboat.slack.com/archives/C5XHN8GLW/p1724161690436689
Got a failure in CI: https://github.com/metabase/metabase/actions/runs/10471883147/job/29000500799?pr=47009
The failure is ""correct"", test is not flaky.

![image](https://github.com/user-attachments/assets/0be412fd-bebf-4c48-858e-f662150ec5bf)

```
app-main.hot.bundle.js:714521 Error: metric with ID: 5 does not exist
    at formatMetric (app-main.hot.bundle.js:235066:15)
    at format (app-main.hot.bundle.js:235019:16)
    at transformPropsToState (app-main.hot.bundle.js:533945:95)
    at new ExpressionEditorTextfield (app-main.hot.bundle.js:534216:22)
    at constructClassInstance (vendor.hot.bundle.js:267178:18)
    at updateClassComponent (vendor.hot.bundle.js:272538:5)
    at beginWork (vendor.hot.bundle.js:274461:16)
    at beginWork$1 (vendor.hot.bundle.js:280276:14)
    at performUnitOfWork (vendor.hot.bundle.js:279407:12)
    at workLoopSync (vendor.hot.bundle.js:279316:5)
```


### To Reproduce

1. New > Metric > Orders > Count > Save
2. New > Question > Orders > Summarize by metric created in previous step > Save > Stay in notebook editor
3. Throttle your network or block `/api/card/:id/query_metadata` URL in network tab in developer tools
4. Refresh the page
5. Before GET `/api/card/:id/query_metadata` request completes, try to edit the aggregation's custom expression

App crashes


### Information about your Metabase installation

master, 63c074d2a226c459141be5ed548ee464a5267806


### Severity

P2
",kamilmielnik,2024-08-21 10:06:00+00:00,['romeovs'],2024-10-14 15:59:20+00:00,2024-10-11 10:22:58+00:00,https://github.com/metabase/metabase/issues/47058,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Querying/Notebook', 'Items specific to the Custom/Notebook query builder'), ('.Team/Querying', ''), ('Querying/Metrics', 'v2'), ('Frequency:Rare', 'Something users bump into rarely')]","[{'comment_id': 2404479571, 'issue_id': 2477625245, 'author': 'romeovs', 'body': ""AFAICT I can no longer reproduce this issue. When I throttle the `/api/card/:id/query_metadata` query and refresh, the Notebook editor just stays in the loading state until the request to that URL resolves.\n\nThere is no intermediate state where I could edit the custom expression and cause a crash.\n\nCompletely blocking the call to `/api/card/:id/query_metadata` _does_ crash the editor but I think that is acceptable.\n\nI can't see the failed test runs so I don't have full context, so @kamilmielnik can you confirm this can be closed if what I said above is true?"", 'created_at': datetime.datetime(2024, 10, 10, 8, 45, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2404530744, 'issue_id': 2477625245, 'author': 'kamilmielnik', 'body': '> AFAICT I can no longer reproduce this issue. When I throttle the /api/card/:id/query_metadata query and refresh, the Notebook editor just stays in the loading state until the request to that URL resolves.\n\nLooks fixed 👍 \n\n> Completely blocking the call to `/api/card/:id/query_metadata` _does_ crash the editor but I think that is acceptable.\n\nI\'m not sure if this is acceptable.\nThe entire page crashes but I\'m pretty sure we could still show the visualization and the [header](https://github.com/user-attachments/assets/8ede6c1f-1b89-47db-b4cf-d2082f7a2b42) to let users inspect question history, edit sharing, move it to trash, etc.\n\nNotebook editor itself is the only thing that would be allowed to crash here.\n\nTry this patch to see for yourself:\n```patch\ndiff --git a/frontend/src/metabase/api/card.ts b/frontend/src/metabase/api/card.ts\nindex f0f6d3bf64..4db387509b 100644\n--- a/frontend/src/metabase/api/card.ts\n+++ b/frontend/src/metabase/api/card.ts\n@@ -48,6 +48,13 @@ export const cardApi = Api.injectEndpoints({\n         method: ""GET"",\n         url: `/api/card/${id}/query_metadata`,\n       }),\n+      transformResponse: () => {\n+        return {\n+          databases: [],\n+          tables: [],\n+          fields: [],\n+        };\n+      },\n       providesTags: (metadata, error, id) =>\n         metadata ? provideCardQueryMetadataTags(id, metadata) : [],\n     }),\n```\n\n\n\n> can you confirm this can be closed if what I said above is true?\n\nIt can be closed when we have a repro for it 🙏', 'created_at': datetime.datetime(2024, 10, 10, 9, 7, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2404691531, 'issue_id': 2477625245, 'author': 'uladzimirdev', 'body': '@romeovs can you please try a commit before native drills?', 'created_at': datetime.datetime(2024, 10, 10, 10, 19, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2404776987, 'issue_id': 2477625245, 'author': 'romeovs', 'body': '> @kamilmielnik \n> The entire page crashes but I\'m pretty sure we could still show the visualization and the header\n\nApplying that patch works to show the query editor, but interacting with the custom expression makes it crash either way.\n\nWe don\'t but guardrails around other pages/components like this (eg. the `/question/:id` page also completely crashes when `/api/card/:id/query_metadata` is blocked), and doing so would be quite the undertaking, since the fetching of this data is built deeply into redux AFAICT and handling exceptions there is not that straightforward.\n\nWe could start adding:\n```tsx\ntransformErrorResponse() {\n  return { databases: [] }, // or whatever ""empty"" state\n}\n```\nto all the api requests but I don\'t think that would make things more stable or predictable, but just shifts the issue to the users of the data.\n\nMaybe we just need to add an `ErrorBoundary` around the notebook editor itself?\n\n> @kamilmielnik \n> It can be closed when we have a repro for it 🙏\n\nIs the fact that the flake is fixed not enough in this case?\n\nThe way the page currently works, the bug no longer exists because it shows the loading state before the metadata resolves. I can add a test for that but it [will be trivial](https://github.com/metabase/metabase/commit/4471b5562080ea4f6815d21fdb3cc02425ceb5ee).', 'created_at': datetime.datetime(2024, 10, 10, 10, 59, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2404816310, 'issue_id': 2477625245, 'author': 'kamilmielnik', 'body': '> Applying that patch works to show the query editor, but interacting with the custom expression makes it crash either way.\n\n> We don\'t but guardrails around other pages/components like this (eg. the /question/:id page also completely crashes when /api/card/:id/query_metadata is blocked), \n\nWith this patch you can navigate to `/question/:id` and see the visualization.\nWithout it - page crashes.\n\n\n> We could start adding: (...) to all the api requests but I don\'t think that would make things more stable or predictable, but just shifts the issue to the users of the data.\n\nIf we were to use the Null Object Pattern to address this, `transformErrorResponse` would not be the right place for it. We should do it ""higher"" up the stack.\n\n> Maybe we just need to add an ErrorBoundary around the notebook editor itself?\n\nThat\'s one way out. I\'m not sure if it will be enough though. Definitely worth trying 👍 \n\n> Is the fact that the flake is fixed not enough in this case?\n\nThat was not a flake, see 3rd sentence in original issue report.\nIt randomly caught this issue that happened due to a race condition.\n\n> I can add a test for that but it [will be trivial](https://github.com/metabase/metabase/commit/4471b5562080ea4f6815d21fdb3cc02425ceb5ee).\n\nThis test is incorrect, we need to simulate the race condition, e.g. like this: https://github.com/metabase/metabase/blob/205f2239bd3286a9a5a0c29ffafa68d7bbeb3169/e2e/test/scenarios/dashboard/dashboard-reproductions.cy.spec.js#L1580', 'created_at': datetime.datetime(2024, 10, 10, 11, 18, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2404978114, 'issue_id': 2477625245, 'author': 'romeovs', 'body': ""I've updated the test to test the actual race condition (or the sidestepping of it really): https://github.com/metabase/metabase/pull/48560.\n\nI think we can make the page load better when certain requests fail but that is out of scope for this issue IMHO, so I've set up an issue to track it: https://github.com/metabase/metabase/issues/48562."", 'created_at': datetime.datetime(2024, 10, 10, 12, 38, 55, tzinfo=datetime.timezone.utc)}]","romeovs (Assginee) on (2024-10-10 08:45:41 UTC): AFAICT I can no longer reproduce this issue. When I throttle the `/api/card/:id/query_metadata` query and refresh, the Notebook editor just stays in the loading state until the request to that URL resolves.

There is no intermediate state where I could edit the custom expression and cause a crash.

Completely blocking the call to `/api/card/:id/query_metadata` _does_ crash the editor but I think that is acceptable.

I can't see the failed test runs so I don't have full context, so @kamilmielnik can you confirm this can be closed if what I said above is true?

kamilmielnik (Issue Creator) on (2024-10-10 09:07:10 UTC): Looks fixed 👍 


I'm not sure if this is acceptable.
The entire page crashes but I'm pretty sure we could still show the visualization and the [header](https://github.com/user-attachments/assets/8ede6c1f-1b89-47db-b4cf-d2082f7a2b42) to let users inspect question history, edit sharing, move it to trash, etc.

Notebook editor itself is the only thing that would be allowed to crash here.

Try this patch to see for yourself:
```patch
diff --git a/frontend/src/metabase/api/card.ts b/frontend/src/metabase/api/card.ts
index f0f6d3bf64..4db387509b 100644
--- a/frontend/src/metabase/api/card.ts
+++ b/frontend/src/metabase/api/card.ts
@@ -48,6 +48,13 @@ export const cardApi = Api.injectEndpoints({
         method: ""GET"",
         url: `/api/card/${id}/query_metadata`,
       }),
+      transformResponse: () => {
+        return {
+          databases: [],
+          tables: [],
+          fields: [],
+        };
+      },
       providesTags: (metadata, error, id) =>
         metadata ? provideCardQueryMetadataTags(id, metadata) : [],
     }),
```




It can be closed when we have a repro for it 🙏

uladzimirdev on (2024-10-10 10:19:47 UTC): @romeovs can you please try a commit before native drills?

romeovs (Assginee) on (2024-10-10 10:59:21 UTC): Applying that patch works to show the query editor, but interacting with the custom expression makes it crash either way.

We don't but guardrails around other pages/components like this (eg. the `/question/:id` page also completely crashes when `/api/card/:id/query_metadata` is blocked), and doing so would be quite the undertaking, since the fetching of this data is built deeply into redux AFAICT and handling exceptions there is not that straightforward.

We could start adding:
```tsx
transformErrorResponse() {
  return { databases: [] }, // or whatever ""empty"" state
}
```
to all the api requests but I don't think that would make things more stable or predictable, but just shifts the issue to the users of the data.

Maybe we just need to add an `ErrorBoundary` around the notebook editor itself?


Is the fact that the flake is fixed not enough in this case?

The way the page currently works, the bug no longer exists because it shows the loading state before the metadata resolves. I can add a test for that but it [will be trivial](https://github.com/metabase/metabase/commit/4471b5562080ea4f6815d21fdb3cc02425ceb5ee).

kamilmielnik (Issue Creator) on (2024-10-10 11:18:26 UTC): With this patch you can navigate to `/question/:id` and see the visualization.
Without it - page crashes.



If we were to use the Null Object Pattern to address this, `transformErrorResponse` would not be the right place for it. We should do it ""higher"" up the stack.


That's one way out. I'm not sure if it will be enough though. Definitely worth trying 👍 


That was not a flake, see 3rd sentence in original issue report.
It randomly caught this issue that happened due to a race condition.


This test is incorrect, we need to simulate the race condition, e.g. like this: https://github.com/metabase/metabase/blob/205f2239bd3286a9a5a0c29ffafa68d7bbeb3169/e2e/test/scenarios/dashboard/dashboard-reproductions.cy.spec.js#L1580

romeovs (Assginee) on (2024-10-10 12:38:55 UTC): I've updated the test to test the actual race condition (or the sidestepping of it really): https://github.com/metabase/metabase/pull/48560.

I think we can make the page load better when certain requests fail but that is out of scope for this issue IMHO, so I've set up an issue to track it: https://github.com/metabase/metabase/issues/48562.

"
2477538834,issue,closed,completed,Upgrading from 48 -> 49 with PostgreSQL backends fails because user is not superuser,"### Describe the bug

I'm trying to upgrade Metabase from version 48 to version 49. This does not work, as some of the SQL migrations run the command `ALTER TABLE ... DISABLE TRIGGER ALL` which is [an action which can only be executed by a PostgreSQL superuser](https://stackoverflow.com/questions/67371661/postgresql-permissions-for-disable-enable-trigger-all). As it is bad practice to connect to the database as a superuser when not strictly necessary, this should be treated as a bug.

The solution is also quite simple: don't be lazy and don't rely on `.. DISABLE TRIGGER ALL` but disable the triggers that should be disabled. As it is now, it also disables FK checks (as they, internally in PostgreSQL, are triggers).

A temporary work-around (confirmed to work) is to **temporarily** set the metabase storage user in PostgreSQL to superuser and then disable it. This works, but is a (small) security risk and prevents sensible automatic upgrades if you manage a whole bunch of Metabase installations. __However__, this does not work if you're PostgreSQL is hosted in the cloud (e.g. Azure), as you're not allowed to be a superuser, so this only fixes the issue for some, not all.

### To Reproduce

1. Have a working installation of Metabase 48 with a PostgreSQL storage backend
2. Attempt to install Metabase 49 and run it
3. See it fail on the error as copied below in the logs.

### Expected behavior

Being able to upgrade without depending on superuser privileges. 

### Logs

dl-co-metabase.1.l359jeziub6w@server    | 2024-08-21 11:13:12,243 INFO db.liquibase :: Checking if Database has unrun migrations...
dl-co-metabase.1.l359jeziub6w@server    | 2024-08-21 11:13:13,323 INFO db.liquibase :: Database has unrun migrations. Checking if migration lock is taken...
dl-co-metabase.1.l359jeziub6w@server    | 2024-08-21 11:13:13,347 INFO db.liquibase :: No migration lock found.
dl-co-metabase.1.l359jeziub6w@server    | 2024-08-21 11:13:13,348 INFO db.liquibase :: Migration lock acquired.
dl-co-metabase.1.l359jeziub6w@server    | 2024-08-21 11:13:13,717 INFO db.liquibase :: Running 66 migrations ...
dl-co-metabase.1.l359jeziub6w@server    | 2024-08-21 11:13:14,146 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss encountered an exception.
dl-co-metabase.1.l359jeziub6w@server    | liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_365022"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.lambda$child$0(Scope.java:186)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:195)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:185)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:164)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.lambda$child$0(Scope.java:186)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:195)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:185)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:164)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:252)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:256)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.lambda$child$0(Scope.java:186)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:195)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:185)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:164)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.command.CommandScope.execute(CommandScope.java:217)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.lambda$child$0(Scope.java:186)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:195)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:185)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:164)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Liquibase.runInScope(Liquibase.java:1419)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Liquibase.update(Liquibase.java:234)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Liquibase.update(Liquibase.java:212)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Liquibase.update(Liquibase.java:194)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__44483.invoke(liquibase.clj:360)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.liquibase$run_in_scope_locked$reify__44479.run(liquibase.clj:325)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.lambda$child$0(Scope.java:186)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:195)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:185)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.Scope.child(Scope.java:164)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:318)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:301)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:349)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:342)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.setup$migrate_BANG_$fn__53428.invoke(setup.clj:84)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.liquibase$do_with_liquibase$f_STAR___44420.invoke(liquibase.clj:140)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.liquibase$do_with_liquibase.invokeStatic(liquibase.clj:143)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.liquibase$do_with_liquibase.invoke(liquibase.clj:131)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.setup$migrate_BANG_.invokeStatic(setup.clj:73)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.setup$migrate_BANG_.doInvoke(setup.clj:55)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.lang.RestFn.invoke(RestFn.java:425)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.setup$run_schema_migrations_BANG_.invokeStatic(setup.clj:149)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.setup$run_schema_migrations_BANG_.invoke(setup.clj:144)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.setup$setup_db_BANG_$fn__53456$fn__53457.invoke(setup.clj:167)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.setup$setup_db_BANG_$fn__53456.invoke(setup.clj:161)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db$setup_db_BANG_$fn__53481.invoke(db.clj:86)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.lang.RestFn.invoke(RestFn.java:421)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:117)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.core$init_BANG__STAR_.invoke(core.clj:98)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.core$init_BANG_.invokeStatic(core.clj:170)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.core$init_BANG_.invoke(core.clj:165)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.core$start_normally.invokeStatic(core.clj:182)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.core$start_normally.invoke(core.clj:176)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.core$entrypoint.invokeStatic(core.clj:215)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.core$entrypoint.doInvoke(core.clj:209)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.lang.RestFn.invoke(RestFn.java:397)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.lang.AFn.applyToHelper(AFn.java:152)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.lang.RestFn.applyTo(RestFn.java:132)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.lang.Var.applyTo(Var.java:705)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.core$apply.invokeStatic(core.clj:667)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.core$apply.invoke(core.clj:662)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.lang.RestFn.invoke(RestFn.java:397)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.lang.AFn.applyToHelper(AFn.java:152)
dl-co-metabase.1.l359jeziub6w@server    | 	at clojure.lang.RestFn.applyTo(RestFn.java:132)
dl-co-metabase.1.l359jeziub6w@server    | 	at metabase.bootstrap.main(Unknown Source)
dl-co-metabase.1.l359jeziub6w@server    | Caused by: org.postgresql.util.PSQLException: ERROR: permission denied: ""RI_ConstraintTrigger_c_365022"" is a system trigger
dl-co-metabase.1.l359jeziub6w@server    | 	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
dl-co-metabase.1.l359jeziub6w@server    | 	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
dl-co-metabase.1.l359jeziub6w@server    | 	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
dl-co-metabase.1.l359jeziub6w@server    | 	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
dl-co-metabase.1.l359jeziub6w@server    | 	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
dl-co-metabase.1.l359jeziub6w@server    | 	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
dl-co-metabase.1.l359jeziub6w@server    | 	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
dl-co-metabase.1.l359jeziub6w@server    | 	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
dl-co-metabase.1.l359jeziub6w@server    | 	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
dl-co-metabase.1.l359jeziub6w@server    | 	at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
dl-co-metabase.1.l359jeziub6w@server    | 	at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
dl-co-metabase.1.l359jeziub6w@server    | 	... 86 more
dl-co-metabase.1.l359jeziub6w@server    | 
dl-co-metabase.1.l359jeziub6w@server    | UPDATE SUMMARY
dl-co-metabase.1.l359jeziub6w@server    | Run:                         66
dl-co-metabase.1.l359jeziub6w@server    | Previously run:             287
dl-co-metabase.1.l359jeziub6w@server    | Filtered out:                50
dl-co-metabase.1.l359jeziub6w@server    | -------------------------------
dl-co-metabase.1.l359jeziub6w@server    | Total change sets:          403
dl-co-metabase.1.l359jeziub6w@server    | 
dl-co-metabase.1.l359jeziub6w@server    | 
dl-co-metabase.1.l359jeziub6w@server    | FILTERED CHANGE SETS SUMMARY
dl-co-metabase.1.l359jeziub6w@server    | DBMS mismatch:               50


### Information about your Metabase installation

```JSON
Version 49 (updgrading from version 48)
```


### Severity

High: blocking safe & sane upgrades, thus potential security issues for security fixes in Metabase

### Additional context

_No response_",veer0318,2024-08-21 09:25:25+00:00,[],2024-08-28 07:24:48+00:00,2024-08-21 13:30:16+00:00,https://github.com/metabase/metabase/issues/47057,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Operation/Database Migrations', 'Issues with application DB migrations when launching Metabase'), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2301837491, 'issue_id': 2477538834, 'author': 'crisptrutski', 'body': 'We have [retracted the disabling of triggers](https://github.com/metabase/metabase/pull/46826) in newer releases, so you can try updating to v50.20.7 instead.', 'created_at': datetime.datetime(2024, 8, 21, 11, 36, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2301873208, 'issue_id': 2477538834, 'author': 'veer0318', 'body': ""Never mind my previous comment here. \r\nI saw that the current Docker image is older than v50.20.7 (by one day), so I'll just have to wait for the new Docker image build. Will check if it works and close the issue if everything is fine."", 'created_at': datetime.datetime(2024, 8, 21, 11, 57, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2302183466, 'issue_id': 2477538834, 'author': 'crisptrutski', 'body': '@veer0318 the docker image for 50.21 has just been released', 'created_at': datetime.datetime(2024, 8, 21, 14, 24, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2314520155, 'issue_id': 2477538834, 'author': 'veer0318', 'body': 'Just to confirm: as expected, everything works again with version 50.21 (tested via the Docker image). Great work!', 'created_at': datetime.datetime(2024, 8, 28, 7, 24, 47, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-08-21 11:36:51 UTC): We have [retracted the disabling of triggers](https://github.com/metabase/metabase/pull/46826) in newer releases, so you can try updating to v50.20.7 instead.

veer0318 (Issue Creator) on (2024-08-21 11:57:02 UTC): Never mind my previous comment here. 
I saw that the current Docker image is older than v50.20.7 (by one day), so I'll just have to wait for the new Docker image build. Will check if it works and close the issue if everything is fine.

crisptrutski on (2024-08-21 14:24:40 UTC): @veer0318 the docker image for 50.21 has just been released

veer0318 (Issue Creator) on (2024-08-28 07:24:47 UTC): Just to confirm: as expected, everything works again with version 50.21 (tested via the Docker image). Great work!

"
2477334692,issue,open,,Metabase cannot search and find the fields of tables,"**Describe the bug**
A clear and concise description of what the bug is.
There was a problem with your question
Most of the time this is caused by an invalid selection or bad input value. Double check your inputs and retry your query.

Hide error details
Here's the full error message
No fields found for table ""table name"".
**Logs**
Please include javascript console and server logs around the time this bug occurred. For information about how to get these, consult our [bug troubleshooting guide](https://metabase.com/docs/latest/troubleshooting-guide/bugs.html)

**To Reproduce**
Steps to reproduce the behavior:
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

**Expected behavior**
A clear and concise description of what you expected to happen.
metabase should list all fields of tables for me when I click on table name.

**Screenshots**
If applicable, add screenshots to help explain your problem.
![image](https://github.com/user-attachments/assets/0da7ee52-1b94-4c73-b182-1976467bf262)

**Severity**
How severe an issue is this bug to you? Is this annoying, blocking some users, blocking an upgrade or blocking your usage of Metabase entirely?
Note: the more honest and specific you are here the more we will take you seriously.

**Additional context**
Add any other context about the problem here.

**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""Cp1252"",
    ""java.runtime.name"": ""Java(TM) SE Runtime Environment"",
    ""java.runtime.version"": ""11.0.7+8-LTS"",
    ""java.vendor"": ""Oracle Corporation"",
    ""java.vendor.url"": ""https://openjdk.java.net/"",
    ""java.version"": ""11.0.7"",
    ""java.vm.name"": ""Java HotSpot(TM) 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.7+8-LTS"",
    ""os.name"": ""Windows 10"",
    ""os.version"": ""10.0"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Bangkok""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""presto-jdbc"",
      ""oracle"",
      ""h2""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.4.2""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-13"",
      ""tag"": ""v0.50.20"",
      ""hash"": ""df82d58""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Bangkok""
    }
  }
}
```",Mimaem,2024-08-21 07:53:17+00:00,[],2025-02-04 20:24:42+00:00,,https://github.com/metabase/metabase/issues/47052,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Metadata & Sync', ''), ('.Backend', ''), ('.Team/Querying', ''), ('.Needs Clarification', 'Issue is incomplete or missing actionable information.')]","[{'comment_id': 2302289354, 'issue_id': 2477334692, 'author': 'TLazarevic', 'body': 'Note: I am NOT from the Metabase team but you would get help faster if you shared info on the database and tables you are trying to query, query type (GUI, native), etc\r\n\r\nTry checking:\r\n- Are the permissions for the database correctly set: [similar question](https://discourse.metabase.com/t/no-fields-detected-with-athena-database-on-self-hosted-metabase/25541/5) permissions needed can be found here https://www.metabase.com/docs/latest/databases/connections/athena\r\n- Is the table queryable from athena\r\n- Has the schema been synced recently', 'created_at': datetime.datetime(2024, 8, 21, 15, 3, 22, tzinfo=datetime.timezone.utc)}]","TLazarevic on (2024-08-21 15:03:22 UTC): Note: I am NOT from the Metabase team but you would get help faster if you shared info on the database and tables you are trying to query, query type (GUI, native), etc

Try checking:
- Are the permissions for the database correctly set: [similar question](https://discourse.metabase.com/t/no-fields-detected-with-athena-database-on-self-hosted-metabase/25541/5) permissions needed can be found here https://www.metabase.com/docs/latest/databases/connections/athena
- Is the table queryable from athena
- Has the schema been synced recently

"
2477131839,issue,open,,Driver: Connection Impersonation: SparkSQL,"**Is your feature request related to a problem? Please describe.**
Hive and sparksql are often governed by other tools like ranger or OPA, impersonation becomes important to keep the existing governance in place. 

**Describe the solution you'd like**
User impersonation (proxyUser)

**Describe alternatives you've considered**
Couldn't find any existing alternative, 

**How important is this feature to you?**
This feature will be very important to alot of people, who chooses THRIFT protocol for their connection. 
We use trino through a gateway (Kyuubi), but the connection to kyuubi is on THRIFT protocol.

",vijay-jangir,2024-08-21 06:00:09+00:00,[],2025-02-04 20:31:03+00:00,,https://github.com/metabase/metabase/issues/47048,"[('Type:New Feature', ''), ('Database/Spark', '')]","[{'comment_id': 2302166038, 'issue_id': 2477131839, 'author': 'paoliniluis', 'body': ""Hey Vijay, the Trino driver allows impersonation, but in this case you're asking the impersonation for our Spark driver, is that correct? I would like to have more details about what you say here, maybe docs and some diagrams to understand the whole picture"", 'created_at': datetime.datetime(2024, 8, 21, 14, 16, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312753110, 'issue_id': 2477131839, 'author': 'vijay-jangir', 'body': 'Yes, i want sparkSql impersonation similar to trino. \r\n\r\nif i create a connection with sparkSql using user ""sparkAdmin"" let\'s say.. all my queries will run with that user.. \r\n\r\nBut i would like queries to run with the current logged in user (similar to what trino does)', 'created_at': datetime.datetime(2024, 8, 27, 14, 37, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312765782, 'issue_id': 2477131839, 'author': 'paoliniluis', 'body': '@vijay-jangir any documentation about how spark can handle roles?', 'created_at': datetime.datetime(2024, 8, 27, 14, 42, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312765878, 'issue_id': 2477131839, 'author': 'vijay-jangir', 'body': '<img width=""377"" alt=""image"" src=""https://github.com/user-attachments/assets/aef42518-df2e-40dc-8269-86631f7f3753"">\r\nsomething like this.. \r\n\r\nif i\'m logged in as testuser.. my query should also run with priveleges ""testuser"" has, not sparkAdmin', 'created_at': datetime.datetime(2024, 8, 27, 14, 43, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2312771232, 'issue_id': 2477131839, 'author': 'vijay-jangir', 'body': '> @vijay-jangir any documentation about how spark can handle roles?\r\n\r\n@paoliniluis \r\n\r\nsparksql connector can be used to connect both hive and spark as both operate on thrift protocol. \r\n\r\nhive have extensive ranger support, spark also have support in ranger using Authz plugin. \r\n\r\nhttps://community.cloudera.com/t5/Support-Questions/Ranger-Hive-Plugin/m-p/314244\r\nhttps://kyuubi.readthedocs.io/en/master/security/authorization/spark/index.html', 'created_at': datetime.datetime(2024, 8, 27, 14, 45, 16, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-08-21 14:16:53 UTC): Hey Vijay, the Trino driver allows impersonation, but in this case you're asking the impersonation for our Spark driver, is that correct? I would like to have more details about what you say here, maybe docs and some diagrams to understand the whole picture

vijay-jangir (Issue Creator) on (2024-08-27 14:37:40 UTC): Yes, i want sparkSql impersonation similar to trino. 

if i create a connection with sparkSql using user ""sparkAdmin"" let's say.. all my queries will run with that user.. 

But i would like queries to run with the current logged in user (similar to what trino does)

paoliniluis on (2024-08-27 14:42:59 UTC): @vijay-jangir any documentation about how spark can handle roles?

vijay-jangir (Issue Creator) on (2024-08-27 14:43:02 UTC): <img width=""377"" alt=""image"" src=""https://github.com/user-attachments/assets/aef42518-df2e-40dc-8269-86631f7f3753"">
something like this.. 

if i'm logged in as testuser.. my query should also run with priveleges ""testuser"" has, not sparkAdmin

vijay-jangir (Issue Creator) on (2024-08-27 14:45:16 UTC): @paoliniluis 

sparksql connector can be used to connect both hive and spark as both operate on thrift protocol. 

hive have extensive ranger support, spark also have support in ranger using Authz plugin. 

https://community.cloudera.com/t5/Support-Questions/Ranger-Hive-Plugin/m-p/314244
https://kyuubi.readthedocs.io/en/master/security/authorization/spark/index.html

"
2476670089,issue,closed,completed,Implement a translation endpoint to convert entity IDs to sequential IDs.,Milestone 1 of https://github.com/metabase/metabase/issues/47042,escherize,2024-08-20 22:54:18+00:00,['escherize'],2024-09-04 21:10:03+00:00,2024-08-27 13:45:43+00:00,https://github.com/metabase/metabase/issues/47043,[],[],
2476669946,issue,closed,completed,[Epic] Stable IDs across MB instances,"**Links**
- product doc: https://www.notion.so/metabase/Stable-IDs-across-MB-instances-minimal-implementation-a22f44c02f02452aa28a3ad0c172c543#d4b986c38df14d938b6c7ac1ebbfc127
- feature branch: `entity-id-translation-service`

### Description:

#### Links
- **Product Doc:** [Stable IDs across Metabase instances - Minimal Implementation](https://www.notion.so/metabase/Stable-IDs-across-MB-instances-minimal-implementation-a22f44c02f02452aa28a3ad0c172c543#d4b986c38df14d938b6c7ac1ebbfc127)
- **Feature Branch:** `entity-id-translation-service`

#### Why This? Why Now?
1. Dependency for Other Components: The frontend, SDK, and API endpoints will all rely on the translation service to convert stable entity IDs to sequential IDs. Implementing this service first allows other components to leverage it without duplicating logic.

2. Performance Considerations: The translation service needs to handle potentially large volumes of ID lookups efficiently. By implementing and optimizing this service early, we can ensure that the performance meets the required standards before building additional features that depend on it.

3. Scalability and Reusability: Once the translation service is implemented, it can be used across multiple parts of the system, such as frontend routing, the SDK, and static embedding. The functions that eventually handle redirecting to sequential ids will be able to use the underlying tech too. A modular approach allows for easier maintenance and future expansion.

4. Risk Mitigation: Starting with the translation service helps identify any potential challenges early in the project. If there are issues with mapping IDs or performance concerns, they can be addressed before integrating the service with other components, reducing the risk of complications later in the development process.

#### Goals
1. Support entity IDs in various embedding scenarios (static embedding, interactive embedding, SDK embedding).
2. Maintain backward compatibility with sequential IDs.
3. Ergonomic and easy to use

#### Non-Goals
- Introducing entity IDs to more models.
- Dropping support for sequential IDs.

#### Related Issues

- https://github.com/metabase/metabase/issues/33057
- https://github.com/metabase/metabase/issues/9441

---

### Implementation Plan

#### **Milestone 1**
- [x] #47043
  - Requires `entity` → `metabase_table` mapping.
  - Ensure performance is optimized.

#### **Milestone 2**
- [x] #47267

#### **Milestone 3**
- [x] #47360
    - a daily aggregate count instead of sending an update for individual lookups
    - potentially for `/embed/dashboard/` and `/embed/question/` as well

#### **Milestone 4** _(rolled into Milestone 1)_
- [x] Improved error reporting
    - add a key in the response for any unfound entity ids

### Appendix
- Include any old or non-immediate content to keep the top of the issue clean. For example:
  - [Kick off Stable IDs minimal implementation](https://www.notion.so/Kick-off-Stable-IDs-minimal-implementation-04b410ff80154149a4aa7edb57affd69?pvs=21)
  - [Stable IDs - Minimal implementation](https://www.notion.so/Stable-IDs-Minimal-implementation-168698173a8c4e80bbe17e98e298cbd1?pvs=21)",escherize,2024-08-20 22:54:06+00:00,['escherize'],2024-09-06 19:55:30+00:00,2024-09-06 19:55:30+00:00,https://github.com/metabase/metabase/issues/47042,"[('.Epic', 'Feature Implementation or Project')]",[],
2476637765,issue,open,,`isObjectDetail` unused prop in `HeaderBreadcrumbs`,"Just a heads up that `isObjectDetail` is most likely not used anymore in `HeaderBreadcrumbs`.
I discussed this with @iethree who confirmed this suspicion.

You can see it in https://github.com/metabase/metabase/blob/master/frontend/src/metabase/query_builder/components/view/ViewHeader/components/QuestionDataSource/QuestionDataSource.jsx and then follow the trail from there.",nemanjaglumac,2024-08-20 22:27:44+00:00,[],2025-02-04 20:29:50+00:00,,https://github.com/metabase/metabase/issues/47040,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2476536425,issue,closed,not_planned,Links that share domain with metabase result in incorrect URLs,"### Describe the bug

If metabase is hosted on a sub-path (related to #30895?), for example ""https://www.mydomain.com/metabase"", then if you render links in your question that go to a different path on the same domain, for example ""https://www.mydomain.com/otherapp"", the end-result is an HTTP link that actually takes you to ""https://www.mydomain.com/metabase/otherapp"" which is incorrect and will likely result in a 404. 

The desired result is that the final HTTP link respects what was written in the raw sql, in this case ""https://www.mydomain.com/otherapp"". 

Similar to what was described in #25350  except it only applies to links on the same domain (links on a completely different domain will work correctly).

### To Reproduce

1. Set metabase's site URL to a sub-path, like ""https://www.mydomain.com/metabase"". 
2. Create a raw sql question with the following query:
`   select 'https://www.google.com' as external_url, 'https://www.mydomain.com/otherapp' as shared_domain_url;`
3. Click the ""external url"" link and see that it works correctly, but click the ""shared_domain_url"" and see that it was manipulated in an incorrect way.

### Expected behavior

The ""shared_domain_url"" should take the user to ""https://www.mydomain.com/otherapp"".

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-19"",
      ""tag"": ""v0.50.20.6"",
      ""hash"": ""dac50d0""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.13""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.20.1+1-LTS"",
    ""java.vendor"": ""Red Hat, Inc."",
    ""java.vendor.url"": ""https://www.redhat.com/"",
    ""java.version"": ""11.0.20.1"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.20.1+1-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.14.0-340.el9.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Edmonton""
  }
}
```


### Severity

Broken questions and blocking an upgrade

### Additional context

I recently upgraded from 0.41.5 and this problem didn't used to occur on that old version. Only after upgrading to 0.50.20.6 was the problem identified.",mbosecke,2024-08-20 21:03:26+00:00,[],2024-08-22 22:49:35+00:00,2024-08-22 22:49:35+00:00,https://github.com/metabase/metabase/issues/47036,"[('Type:Bug', 'Product defects'), ('.Needs Triage', ''), ('.Needs Clarification', 'Issue is incomplete or missing actionable information.')]","[{'comment_id': 2299792048, 'issue_id': 2476536425, 'author': 'paoliniluis', 'body': 'We never supported running Metabase on sub paths. This is something that you need to fix via redirection', 'created_at': datetime.datetime(2024, 8, 20, 21, 24, 31, tzinfo=datetime.timezone.utc)}, {'comment_id': 2299823126, 'issue_id': 2476536425, 'author': 'mbosecke', 'body': ""I'd understand if this is not a scenario that you support and therefore want to close this ticket. \r\n\r\nHowever, I will comment on your second point there just to make sure there isn't confusion. This is not a reverse proxy-rule or redirection issue, but a deficiency with how metabase is constructing/manipulating URLs. The SQL query has a working URL hardcoded into it but then metabase manipulates it into an incorrect URL. This bug would have to be overcome by metabase as a prerequisite to supporting sub-paths (if that was something this project desired to support in the future). It's not a user-error but if it's out-of-scope for this project than so be it."", 'created_at': datetime.datetime(2024, 8, 20, 21, 49, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2299826025, 'issue_id': 2476536425, 'author': 'mbosecke', 'body': ""Theoretically I _could_ resolve this by using a redirection rule, but that rule would be to effectively undo what metabase is doing with it's url transformation. It would be a workaround, not a great permanent solution."", 'created_at': datetime.datetime(2024, 8, 20, 21, 51, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2305193480, 'issue_id': 2476536425, 'author': 'mbosecke', 'body': 'If anyone else is hitting this bug you can workaround it by making your link _origins_ differ from your metabase ""Site URL"" _origin_ just slightly by either changing the protocol or the subdomain (whichever might work for your setup). The metabase code will no longer detect that the link has the same origin as the ""Site URL"" and will stop mangling the URL and leave it as-is. For example:\r\n\r\nIf metabase site URL is `https://www.mydomain.com/metabase` and you want to create a link to `https://www.mydomain.com/otherapp` then either of the following will bypass the metabase url mangling code:\r\n\r\n- `http://www.mydomain.com/otherapp` (differs by protocol)\r\n- `https://mydomain.com/otherapp` (differs by subdomain)\r\n\r\nIn my particular case, neither would work because of our cookie-handling setup so I ended up hosting metabase on a dedicated subdomain which is the ""official"" way. Not what we wanted but c\'est la via!', 'created_at': datetime.datetime(2024, 8, 22, 16, 37, 39, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-08-20 21:24:31 UTC): We never supported running Metabase on sub paths. This is something that you need to fix via redirection

mbosecke (Issue Creator) on (2024-08-20 21:49:18 UTC): I'd understand if this is not a scenario that you support and therefore want to close this ticket. 

However, I will comment on your second point there just to make sure there isn't confusion. This is not a reverse proxy-rule or redirection issue, but a deficiency with how metabase is constructing/manipulating URLs. The SQL query has a working URL hardcoded into it but then metabase manipulates it into an incorrect URL. This bug would have to be overcome by metabase as a prerequisite to supporting sub-paths (if that was something this project desired to support in the future). It's not a user-error but if it's out-of-scope for this project than so be it.

mbosecke (Issue Creator) on (2024-08-20 21:51:51 UTC): Theoretically I _could_ resolve this by using a redirection rule, but that rule would be to effectively undo what metabase is doing with it's url transformation. It would be a workaround, not a great permanent solution.

mbosecke (Issue Creator) on (2024-08-22 16:37:39 UTC): If anyone else is hitting this bug you can workaround it by making your link _origins_ differ from your metabase ""Site URL"" _origin_ just slightly by either changing the protocol or the subdomain (whichever might work for your setup). The metabase code will no longer detect that the link has the same origin as the ""Site URL"" and will stop mangling the URL and leave it as-is. For example:

If metabase site URL is `https://www.mydomain.com/metabase` and you want to create a link to `https://www.mydomain.com/otherapp` then either of the following will bypass the metabase url mangling code:

- `http://www.mydomain.com/otherapp` (differs by protocol)
- `https://mydomain.com/otherapp` (differs by subdomain)

In my particular case, neither would work because of our cookie-handling setup so I ended up hosting metabase on a dedicated subdomain which is the ""official"" way. Not what we wanted but c'est la via!

"
2476500085,issue,closed,completed,Document MB_DOWNLOAD_ROW_LIMIT,"**Is your feature request related to a problem? Please describe.**
Now that we decoupled the csv download from the api, we should document the env var. https://github.com/metabase/metabase/pull/46401",paoliniluis,2024-08-20 20:36:40+00:00,[],2024-10-08 16:16:38+00:00,2024-08-23 12:49:13+00:00,https://github.com/metabase/metabase/issues/47034,"[('Type:Documentation', ''), ('Type:New Feature', '')]",[],
2476328672,issue,open,,Enable Efficient Date Filtering on String-Partitioned Athena Tables,"**Is your feature request related to a problem? Please describe.**

We need to be able to leverage field filters on dates stored as strings in Athena. AWS recommends storing dates as strings for optimizing partition performance:

- [Athena Notable Limitations](https://docs.aws.amazon.com/athena/latest/ug/other-notable-limitations.html)
- [Athena Data Types](https://docs.aws.amazon.com/athena/latest/ug/data-types.html)

In Athena you can simply query the dates like so:

```
WHERE ""s3-data-source"".""partition_test"".""col2"" BETWEEN '2023-11-01'
   AND '2024-01-01'
```

If you follow this recommendation then you must cast the string to a temporal type in order to leverage field filters in Metabase.  As the data volume grows and you leverage partitions - some partition pruning can still occur while the strings are cast (depending on how the tables and partitions are set up). However, as the volume of partitions grow the query execution plan time starts to increase because it take so long for metadata to come back from Glue.

Athena offers [partition indexes in Glue ](https://docs.aws.amazon.com/glue/latest/dg/partition-indexes.html) to speed up metadata retrieval. This works great in Athena but these indexes aren't being leveraged by the queries from Metabase due to the datetime coercion.  This means that queries run in Metabase with field filters are much much slower than those in run directly in Athena without the date coercion.


**Describe the solution you'd like**

Some option (such as a special coercion type) that allows the use of field filters on these string columns so that we can retain the use of the ""All Options"" date picker without having to modify the entire configuration of the Athena DW (or add a bunch of operational overhead for manual maintenance of partition projection).

Like the above example or by casting on the right:

```
WHERE ""s3-data-source"".""partition_test"".""date_hour"" BETWEEN CAST(timestamp '2024-08-09 09:00:00.000' AS string) AND CAST(timestamp '2024-08-09 10:00:00.000' AS string)
```


**Describe alternatives you've considered**

**1. Athena offers [partition projection]**(https://docs.aws.amazon.com/athena/latest/ug/partition-projection.html) which allows you to set up definitions for partition metadata directly on the tables. This allows you to skip the Glue or Hive metadata catalogues completely. It sounds like a potential solution but it requires a lot of manual work and added maintenance overhead to go this route.

**2. Using SQL variables in the native question and leveraging multiple filters date filters:** 

We could set up the SQL in the native editor like so:

```
where ""created at"" >= DATE_FORMAT({{startDate}}, '%Y-%m-%d %H:%i:%s')
and ""created at"" <= DATE_FORMAT({{endDate}}, '%Y-%m-%d %H:%i:%s')
```

The user experience here is not good, though. Also, users have grown accustom to the ""All Options"" date picker and to move to a solution like this we would have to walk back this functionality on all dashboards for all users.


**How important is this feature to you?**

Very important. Right now partition projection seems to be the only option that could get us to the solution we need (retaining the full date picker user experience) - but this is a big lift operationally and we haven't yet been able to validate that it will work. If it does, as the data structure changes the partitions have to be manually updated on the individual tables. We lose the automated detection of new partitions that Glue provides. There are considerations for data retention policies that can impact performance by leaving empty partitions, etc. So the active maintenance of this creates significant operational overhead. 

It would be great if we could just query these with field filters the way we can query them in Athena.

**Additional context**
[Internal slack convo](https://metaboat.slack.com/archives/C64DB8QH2/p1723220360350049)
",ixipixi,2024-08-20 18:57:06+00:00,[],2025-02-04 20:31:04+00:00,,https://github.com/metabase/metabase/issues/47026,"[('Type:New Feature', ''), ('.Team/Drivers', '')]","[{'comment_id': 2315790349, 'issue_id': 2476328672, 'author': 'ixipixi', 'body': 'This feature is also relevant to any distributed SQL engine that may leverage Hive or Glue metastores (Presto, Spark, Trino, etc).', 'created_at': datetime.datetime(2024, 8, 28, 16, 25, 32, tzinfo=datetime.timezone.utc)}]","ixipixi (Issue Creator) on (2024-08-28 16:25:32 UTC): This feature is also relevant to any distributed SQL engine that may leverage Hive or Glue metastores (Presto, Spark, Trino, etc).

"
2476216955,issue,closed,completed,migrate to rspack,,uladzimirdev,2024-08-20 17:55:30+00:00,[],2024-10-08 16:16:16+00:00,2024-08-28 09:22:29+00:00,https://github.com/metabase/metabase/issues/47025,[],[],
2475880068,issue,closed,completed,Pivot scrollbars show in dashboard edit mode and can glitch out when interacted with,"### Context
* Scrollbars show on small enough pivot tables in edit mode. We don't show scrollbars in edit mode for tables, and should not either for pivot tables.
* Because of this, if you try dragging or interacting with the scrollbar, you can get some really glitchy feeling outcomes.

![Image](https://github.com/user-attachments/assets/ea7d4a81-fc39-4bfa-8093-59c6698d0a10)

",cdeweyx,2024-08-20 15:00:56+00:00,['alxnddr'],2024-08-22 16:34:44+00:00,2024-08-22 15:55:49+00:00,https://github.com/metabase/metabase/issues/47019,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations'), ('.Reproduced', 'Issues reproduced in test (usually Cypress)'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2475879557,issue,closed,completed,Flicker when clicking on column heading in table,"### Describe the bug

If you click on a column heading in a table you get a strange flickering effect as it switches between two different components.

https://www.loom.com/share/940e9ad0c3e548f3b57b054eee2e4747

### To Reproduce

See loom

### Expected behavior

Unsure, but shouldn't flicker	

### Logs

_No response_

### Information about your Metabase installation

```JSON
Current master - `92d6150`
```


### Severity

P3

### Additional context

_No response_",noahmoss,2024-08-20 15:00:44+00:00,[],2024-08-20 15:56:35+00:00,2024-08-20 15:56:35+00:00,https://github.com/metabase/metabase/issues/47018,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2299197511, 'issue_id': 2475879557, 'author': 'noahmoss', 'body': 'Dupe of https://github.com/metabase/metabase/issues/45473', 'created_at': datetime.datetime(2024, 8, 20, 15, 56, 35, tzinfo=datetime.timezone.utc)}]","noahmoss (Issue Creator) on (2024-08-20 15:56:35 UTC): Dupe of https://github.com/metabase/metabase/issues/45473

"
2475859003,issue,closed,not_planned,Filters from previous dashboard are being re-applied on subsequent dashboards ,"### Describe the bug

Hi there,

I have three almost identical dashboards, two with a different default filter applied and a third with no default filter applied
After opening the first one, the filters are applied and all is fine.
I then open the either of the other two and the same set of filters are applied, overriding the default.

I have seen this occur in other places where filters I would not expect to be set are being applied, but this example is more obvious.

![filter test](https://github.com/user-attachments/assets/e2d6064f-649d-4ebb-951e-c93435482b6f)


### To Reproduce

Create a dashboard with a filter, set a default and enable Require a Value (so you can reset the filters when testing)
Duplicate dashboard and set a different default
Load dashboard 1
Load dashboard 2

### Expected behavior

I suspect this is a hangover from tabs and filters should only carry over between tabbed dashboard tabs, not dashboards.


### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36 Edg/127.0.0.0"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-112-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Europe/London""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""sqlserver""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MariaDB"",
        ""version"": ""10.11.8-MariaDB-log""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-06-15"",
      ""tag"": ""v0.50.5"",
      ""hash"": ""48f6978""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

Pretty annoying and filters now have to be manually reset

### Additional context

_No response_",scott-malyon,2024-08-20 14:51:38+00:00,[],2024-08-20 15:44:57+00:00,2024-08-20 15:12:52+00:00,https://github.com/metabase/metabase/issues/47017,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2299075973, 'issue_id': 2475859003, 'author': 'scott-malyon', 'body': 'Sorry, just searched through again all the release notes and this may be fixed by 0.50.19\r\nUpdating to check.', 'created_at': datetime.datetime(2024, 8, 20, 14, 59, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2299106110, 'issue_id': 2475859003, 'author': 'scott-malyon', 'body': 'Apologies, it was fixed by 0.50.19 and all is good now\r\nI did search the issues first honest, only saw it up when trawling release notes', 'created_at': datetime.datetime(2024, 8, 20, 15, 12, 52, tzinfo=datetime.timezone.utc)}]","scott-malyon (Issue Creator) on (2024-08-20 14:59:41 UTC): Sorry, just searched through again all the release notes and this may be fixed by 0.50.19
Updating to check.

scott-malyon (Issue Creator) on (2024-08-20 15:12:52 UTC): Apologies, it was fixed by 0.50.19 and all is good now
I did search the issues first honest, only saw it up when trawling release notes

"
2475628392,issue,closed,duplicate,Conditional Formatting for cartesian charts (including time series),"**Is your feature request related to a problem? Please describe.**
Creating the request on behalf of a customer.
In a given bar chart, add a vertical line similar to events, but bars on the right side of that line will have a different color. We want to show the usage of the customers before and after their subscription start date in different colors.

**Describe the solution you'd like**
The current timeline or event definitions do not work for us as we would like to create a vertical line when a customer switched to our service so it would have a different value for each customer (we would refer to ""created_at"" column value). The event definitions seem to be static dates. ""

**Describe alternatives you've considered**
Having two different cards/questions on a dashboard alongside each other.

**How important is this feature to you?**
N/A


",FilmonK,2024-08-20 13:17:26+00:00,[],2025-01-02 17:30:38+00:00,2025-01-02 17:29:59+00:00,https://github.com/metabase/metabase/issues/47013,"[('Type:New Feature', ''), ('Visualization/Chart Settings', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('Visualization/Conditional Formatting', '')]","[{'comment_id': 2568119262, 'issue_id': 2475628392, 'author': 'brunobergher', 'body': 'Filmon, I renamed this to what I believe is the slightly more generic ask. Is that ok?', 'created_at': datetime.datetime(2025, 1, 2, 17, 26, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2568123297, 'issue_id': 2475628392, 'author': 'brunobergher', 'body': ""Actually I think this is a duplicate of #11461, so closing by default (happy to open if it's something else)"", 'created_at': datetime.datetime(2025, 1, 2, 17, 29, 59, tzinfo=datetime.timezone.utc)}]","brunobergher on (2025-01-02 17:26:35 UTC): Filmon, I renamed this to what I believe is the slightly more generic ask. Is that ok?

brunobergher on (2025-01-02 17:29:59 UTC): Actually I think this is a duplicate of #11461, so closing by default (happy to open if it's something else)

"
2475532471,issue,closed,completed,Simple metrics page,,romeovs,2024-08-20 12:32:35+00:00,['romeovs'],2024-10-08 16:15:12+00:00,2024-09-09 09:39:24+00:00,https://github.com/metabase/metabase/issues/47011,[],[],
2475378658,issue,closed,completed,CSV uploads broken for Clickhouse when data contains datetime with offset,"### Describe the bug

When uploading CSV files to the new Cloud datawarehouse,  the upload fails if there are dates with timezone offsets in them.

### To Reproduce

1. Go to a Collection page.
2. Drag and drop a file containing an offset datetime in it onto the page.
3. Pick ""create a new model"" if prompted.
4. See toast message for error about type cast error.


### Expected behavior

The upload should succeed, and the relevant column should be treated as text.

### Logs

_No response_

### Information about your Metabase installation

```JSON
- Metabase version: master (65ac2f18ca8a0b6620ded4a0c5db5964dd44fd20)
- Clickhouse driver version: 1.50.3 (01ecc5fbcc53d007b9a7357bd358428a4f3bc738)
```


### Severity

P1 

### Additional context

_No response_",crisptrutski,2024-08-20 11:13:52+00:00,['crisptrutski'],2024-08-20 16:37:13+00:00,2024-08-20 16:37:13+00:00,https://github.com/metabase/metabase/issues/47007,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Team/Workflows', 'aka BEC'), ('Organization/Uploads', 'Direct data upload (CSV)')]",[],
2475308177,issue,closed,completed,Wrong breadbrumbs when opening a metric,"### Describe the bug

We decided to not show metrics as datasources
But when opening a metric we still show the breadcrumbs like for tables and models (collection and title), we don't show database and table links in the breadcrumbs

### To Reproduce

1. Open any saved metric from collections
2. See Collection / Metric as breadcrumbs and no link on top

### Expected behavior

We should show:
1.  the link to the collection the metric belongs to on top
2. breadcrumbs for the data source it's based on
3. editable title separately

### Logs

_No response_

### Information about your Metabase installation

```JSON
06d1ba2ae111e66253209c01c244d6379acfc6dcb1911fa9ab6012cec9ce52e5
```


### Severity

minor

### Additional context

_No response_",mngr,2024-08-20 10:37:40+00:00,['ranquild'],2025-02-04 17:29:32+00:00,2025-01-28 21:41:54+00:00,https://github.com/metabase/metabase/issues/47006,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Already Fixed', 'will apear in ""Already Fixed"" in the release notes (not ""Bug Fixes"" that we actively fixed)'), ('.Team/Querying', ''), ('Querying/Metrics', 'v2'), ('Semantic Model', ''), ('Semantic Model/Metrics', '')]","[{'comment_id': 2298783406, 'issue_id': 2475308177, 'author': 'nemanjaglumac', 'body': 'Reassigned to admin/webapp because (1) it is their scope and (2) they are working on redesigning and unifying all breadcrumbs right now.', 'created_at': datetime.datetime(2024, 8, 20, 12, 50, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2301581811, 'issue_id': 2475308177, 'author': 'nemanjaglumac', 'body': '> 1. the link to the collection the metric belongs to on top\r\n\r\n#47051 enables the collection link in the app bar.', 'created_at': datetime.datetime(2024, 8, 21, 9, 23, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2620114306, 'issue_id': 2475308177, 'author': 'ranquild', 'body': 'This was already fixed and tested', 'created_at': datetime.datetime(2025, 1, 28, 21, 41, 54, tzinfo=datetime.timezone.utc)}]","nemanjaglumac on (2024-08-20 12:50:21 UTC): Reassigned to admin/webapp because (1) it is their scope and (2) they are working on redesigning and unifying all breadcrumbs right now.

nemanjaglumac on (2024-08-21 09:23:43 UTC): #47051 enables the collection link in the app bar.

ranquild (Assginee) on (2025-01-28 21:41:54 UTC): This was already fixed and tested

"
2475280580,issue,open,,Wrong breadcrumbs for questions based on questions,"### Describe the bug

When starting a new visual question if saved question is chosen as a data source we show database link in the breadcrumbs

### To Reproduce

1. Click + New question
2. Choose saved question as a data source
3. Save this new question
4. There is a link to a database on which the saved question is defined in the breadcrumbs

![Image](https://github.com/user-attachments/assets/c3b27ed1-00a8-4783-8b54-e41d4f9be187)

### Expected behavior

Breadcrumbs should link to a collection in which the data source question is saved

### Logs

_No response_

### Information about your Metabase installation

```JSON
06d1ba2ae111e66253209c01c244d6379acfc6dcb1911fa9ab6012cec9ce52e5
```


### Severity

Minor

### Additional context

Now there is a simple workaround, you can cmd+click on the data source to open it in a new tab where the link to a collection where it sits in will be shown",mngr,2024-08-20 10:24:21+00:00,[],2025-02-05 18:54:30+00:00,,https://github.com/metabase/metabase/issues/47005,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Product Input Needed', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2298783818, 'issue_id': 2475280580, 'author': 'nemanjaglumac', 'body': 'Reassigned to admin/webapp because (1) it is their scope and (2) they are working on redesigning and unifying all breadcrumbs right now.', 'created_at': datetime.datetime(2024, 8, 20, 12, 50, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2637763039, 'issue_id': 2475280580, 'author': 'luizarakaki', 'body': 'This will be reworked when we improve breadcrumbs', 'created_at': datetime.datetime(2025, 2, 5, 18, 54, 29, tzinfo=datetime.timezone.utc)}]","nemanjaglumac on (2024-08-20 12:50:33 UTC): Reassigned to admin/webapp because (1) it is their scope and (2) they are working on redesigning and unifying all breadcrumbs right now.

luizarakaki on (2025-02-05 18:54:29 UTC): This will be reworked when we improve breadcrumbs

"
2475220512,issue,open,,Feature: easy to duplicate dashboards etc for another identical database,"**Is your feature request related to a problem? Please describe.**
I have been using Metabase to create well-designed dashboards, along with translations and metrics, to make queries easily understandable. Setting everything up took a considerable amount of time, but it was definitely worth it. However, I recently faced a frustrating issue: I needed to replicate the exact same setup (translations, dashboards, metrics, etc.) for an identical database that contains different data. To my surprise, there was no easy way to copy or duplicate this setup. What felt like a straightforward ""Ctrl+C, Ctrl+V"" task ended up consuming an entire day.

Although Metabase offers a ""duplicate dashboard"" feature, it didn’t fully solve the problem. When switching the database or table in a query, the entire query resets, forcing me to recreate all queries from scratch. This added unnecessary complexity and time to what should have been a simple operation.

**Describe the solution you'd like**
It would be incredibly useful to have a feature that allows for a seamless migration or duplication of dashboards, translations, and metrics across databases. Ideally, this feature would allow users to:
* Duplicate dashboards and retain all queries, metrics, and translations.
* Change the database or table in a query without resetting the query to its initial state.
* Apply this process across similar database structures with different data, streamlining the transition between environments.

**Describe alternatives you've considered**
Duplicating the Metabase database and running a second Metabase instance where I could point to the new database location. However, this would require maintaining two separate web servers, which is not ideal for performance and resource management.
",sbarreze,2024-08-20 09:54:32+00:00,[],2025-02-04 20:30:23+00:00,,https://github.com/metabase/metabase/issues/47004,"[('Type:New Feature', ''), ('Operation/', ''), ('Organization/', ''), ('Operation/Serialization', 'Enterprise contents migration'), ('Administration/Data Sandboxes', 'Enterprise Sandboxing')]","[{'comment_id': 2374315166, 'issue_id': 2475220512, 'author': 'ngm', 'body': 'See also https://github.com/metabase/metabase/issues/6496.', 'created_at': datetime.datetime(2024, 9, 25, 14, 48, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2426214096, 'issue_id': 2475220512, 'author': 'brunobergher', 'body': ""In case you're interested, we're currently working on an alternative path for solving this problem, which is allowing admins to configure users to be served from different databases depending on user attributes, as an extension of our sandboxing feature (which currently supports co-mingled data + connection impersonation on the DB side).\n\nIn this approach you'd only need to create a single dashboard, no need for duplication."", 'created_at': datetime.datetime(2024, 10, 21, 10, 3, 59, tzinfo=datetime.timezone.utc)}]","ngm on (2024-09-25 14:48:21 UTC): See also https://github.com/metabase/metabase/issues/6496.

brunobergher on (2024-10-21 10:03:59 UTC): In case you're interested, we're currently working on an alternative path for solving this problem, which is allowing admins to configure users to be served from different databases depending on user attributes, as an extension of our sandboxing feature (which currently supports co-mingled data + connection impersonation on the DB side).

In this approach you'd only need to create a single dashboard, no need for duplication.

"
2475127082,issue,open,,There was a field matching error when using the field filter of Metabase to query Athena's data,"### Describe the bug

When I use Metabase's variable filter to select fields from an Athena table, the field mapping works correctly due to the nested data structure. However, when I execute the query, I discover that Metabase's parameter is missing one level of nesting, resulting in no data being retrieved.
![image](https://github.com/user-attachments/assets/1cbc0a7e-22d9-4c9a-a41e-5f3d5b8ba84a)


### To Reproduce

1.This is one of my data：{""project"": ""ScrapingInstagramPostsFromTagsSearch"", ""taskid"": ""00799b2e54742822cca04270b6626f22"", ""url"": ""data:,on_message?tag=banana&id=3435415062162709246"", ""result"": {""tag_name"": ""banana"", ""post"": {""post_id"": ""3435415062162709246"", ""shortcode"": ""C-tC8wkPBr-"", ""url"": ""https://www.instagram.com/p/C-tC8wkPBr-/"", ""thumbnail"": ""https://scontent-lax3-2.cdninstagram.com/v/t51.29350-15/455816674_3733006713588552_4087020744170563399_n.heic?stp=dst-jpg_e35_s150x150&efg=eyJ2ZW5jb2RlX3RhZyI6ImltYWdlX3VybGdlbi4zMjB4MzIwLnNkci5mMjkzNTAuZGVmYXVsdF9pbWFnZSJ9&_nc_ht=scontentlax32.cdninstagram.com&_nc_cat=100&_nc_ohc=_28RN1aSYyUQ7kNvgGI2BuH&edm=AA0rjkIBAAAA&ccb=7-5&oh=00_AYAvoJvNnnN-PiuuBVDM0Q4MZKR0T3HBu-yfpWDRTvyG9w&oe=66C9CE08&_nc_sid=49ed71"", ""caption"": ""Banana #banana #ballzbanana #batman #art"", ""owner"": {""user_id"": ""60784577547""}, ""display_url"": ""https://scontent-lax2.cdninstagram.com/v/t51.293515/455816674_3733006713588552_4087020744170563399_n.heic?stp=dstjpg_e35&_nc_ht=scontent2.cdninstagram.com&_nc_cat=100&_nc_ohc=_28RN1aSYyUQ7kNvgGI2BuH&edm=AA0rjkIBAAAA&ccb=7-5&oh=00_AYDgPaINV7EII4BDWKTYLCoRv1c9ZN4V-YIa6NERrvh6ZA&oe=66C9CE08&_nc_sid=49ed71"", ""is_video"": false, ""likes_count"": 0, ""comments_count"": 0, ""published_time"": 1723753410}, ""scraped_time"": 1724120799807}, ""createTime"": 1724123022.4007459}

2.this is my DDL: CREATE EXTERNAL TABLE scrapinginstagrampostsfromtagssearch(
taskid string COMMENT 'from deserializer',
url string COMMENT 'from deserializer',
result struct<tag_name:string,post:struct<post_id:string,shortcode:string,url:string,thumbnail:string,caption:string,owner:struct<user_id:string>,display_url:string,is_video:boolean,video_view_count:int,likes_count:int,comments_count:int,published_time:timestamp>, createTime:timestamp> COMMENT 'from deserializer',
updatetime timestamp COMMENT 'from deserializer')
ROW FORMAT SERDE
'org.openx.data.jsonserde.JsonSerDe'
STORED AS INPUTFORMAT
'org.apache.hadoop.mapred.TextInputFormat'
OUTPUTFORMAT
'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'
LOCATION
's3://****/'
TBLPROPERTIES (
'classification'='json')

3.Connect Athena using Metabase and then use variable filters

### Expected behavior

_No response_

### Logs

[Simba][AthenaJDBC](https://github.com/metabase/metabase/issues/100071) An error has been thrown from the AWS Athena client. COLUMN_NOT_FOUND: line 4:8: Column 'pyspider.scrapinginstagrampostsfromtagssearch.tag_name' cannot be resolved or requester is not authorized to access requested resources [Execution ID: d3b4c9bd-937c-4254-ba22-d0c65152df13]

### Information about your Metabase installation

```JSON
v0.49.14
```


### Severity

P2

### Additional context

_No response_",YYyp99,2024-08-20 09:12:26+00:00,[],2025-02-04 20:27:54+00:00,,https://github.com/metabase/metabase/issues/47003,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Backend', ''), ('Database/Athena', ''), ('.Team/Drivers', '')]",[],
2475097098,issue,closed,completed,There was a field matching error when using the field filter of Metabase to query Athena's data,,YYyp99,2024-08-20 08:59:49+00:00,[],2024-08-20 09:12:58+00:00,2024-08-20 09:05:51+00:00,https://github.com/metabase/metabase/issues/47002,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]",[],
2475023925,issue,open,,Summaries from multiple stages cannot be distinguished,"### Describe the bug

![filter modal](https://github.com/user-attachments/assets/d4a7b2bb-4f0e-4312-977d-f169abce7320)
![dashboard parameter mapping](https://github.com/user-attachments/assets/18a946e0-ca1e-40f3-820d-a8de16381f97)
![click behavior - question - parameter mapping](https://github.com/user-attachments/assets/60b6463c-cf5b-461d-9e06-b03d70577525)


### To Reproduce

1. New > Question > Orders > Summarize by Count > Breakout by Created At: Month > New Summarize stage > Summarize by Sum of Count > Breakout by Count ([image](https://github.com/user-attachments/assets/8d74abeb-33fe-45f5-a6b2-9f237271280a))
2. Visualize
3. Filter

Summaries sections cannot be distinguished

### Information about your Metabase installation

master, 07c1e2549a


### Severity

P2

### Additional context

Original report: https://github.com/metabase/metabase/pull/46670#discussion_r1719876477

Similar to #46845",kamilmielnik,2024-08-20 08:23:50+00:00,[],2025-02-04 20:27:15+00:00,,https://github.com/metabase/metabase/issues/47001,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/MBQL', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2302882404, 'issue_id': 2475023925, 'author': 'ranquild', 'body': 'We show `Summaries` when `displayInfo` for a column group from `groupColumns` return an empty string. Ideally MBQL lib should return the correct name itself.', 'created_at': datetime.datetime(2024, 8, 21, 19, 42, 13, tzinfo=datetime.timezone.utc)}]","ranquild on (2024-08-21 19:42:13 UTC): We show `Summaries` when `displayInfo` for a column group from `groupColumns` return an empty string. Ideally MBQL lib should return the correct name itself.

"
2474884508,issue,closed,completed,New dashboard not shown in the Entity Picker,"### Describe the bug

_Apologies for nothing happening in the video from 0:14 to 0:22_

https://github.com/user-attachments/assets/b3ebcaeb-7cb1-419f-af29-2fbe8b97c323



### To Reproduce

0. Start a fresh Metabase instance
1. New > Question > Orders > Save > Save
2. When asked if add to dashboard click ""Yes please!""
3. Entity picker modal opens
4. Click Dashboards tab
5. Click Create a new dashboard
6. Enter a name, hit Enter
7. Notice you can see the new dashboard in the picker
8. Click Create a new dashboard
9. Enter a name, hit Enter

New dashboard is not visible, but the ""Select"" button is active.
You need to open ""Our analytics"" collection to see it.



### Expected behavior

The collection with new dashboard should have been opened automatically.


### Information about your Metabase installation

master, ee25e763e3


### Severity

P2

### Additional context

I also hit the issue on a non-fresh Metabase instance, and without having to create 2 dashboards in a row (1 was enough), but I could not come up with reliable reproduction steps for these cases.",kamilmielnik,2024-08-20 07:09:22+00:00,['npfitz'],2024-09-13 15:57:59+00:00,2024-09-13 15:24:18+00:00,https://github.com/metabase/metabase/issues/47000,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Organization/', ''), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2474345624,issue,closed,completed,Sorting the question in the table view will add a second sort in the same field breaking the query,"### Describe the bug

This seems to be SQL server specific but I'm not 100% sure (tested on H2 and I'm not able to trigger it)

### To Reproduce

1) set up a Metabase with a SQL server
2) build a question like 
![image](https://github.com/user-attachments/assets/b9713ed3-3976-4daa-ac4f-4a4db2737eb3)
3) then click on visualize and later on sort by the created at field  (use the table view)
![image](https://github.com/user-attachments/assets/aa219566-b919-4f26-9d49-74aa4fbecf6b)

see what just happened (a double sort making the query invalid)
![image](https://github.com/user-attachments/assets/55754a3f-67fd-4d3e-83c0-d9d23b492591)


### Expected behavior

We shouldn't inject a sort twice in the query

### Logs

NA

### Information about your Metabase installation

```JSON
this has been around for ages
```


### Severity

P1

### Additional context

reported by an enterprise customer",paoliniluis,2024-08-19 22:28:02+00:00,['bshepherdson'],2024-08-28 14:12:12+00:00,2024-08-28 13:18:11+00:00,https://github.com/metabase/metabase/issues/46992,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Database/SQLServer', None), ('Querying/Processor', ''), ('.Backend', ''), ('.Escalation', ''), ('.Team/Querying', '')]","[{'comment_id': 2305301644, 'issue_id': 2474345624, 'author': 'bshepherdson', 'body': ""I was able to reproduce this, but only on SQL Server.\r\n\r\nThe proximal cause is that while adding the implicit `ORDER BY` clauses for breakouts, we fail to recognize that there's already a sort order for Created At.\r\n\r\nThe breakout is spelled\r\n```clojure\r\n[:field 123 {:base-type :type/DateTime, :temporal-unit :month}]\r\n```\r\nwhereas the `:order-by` is spelled\r\n```clojure\r\n[:desc [:field 123 {:base-type :type/Date, :temporal-unit :month}]]\r\n```\r\n\r\nThat is, the breakout has the correct `:base-type :type/DateTime` while the sort order was added with a (halfway-correct due to the truncation) `:type/Date`. This matching code uses direct set matching, so it does not allow for any differences.\r\n\r\nI'm continuing to investigate for the root cause. It seems that on H2 and Postgres the sort order has `:base-type :type/DateTime` and this issue does not appear."", 'created_at': datetime.datetime(2024, 8, 22, 17, 39, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2305634482, 'issue_id': 2474345624, 'author': 'bshepherdson', 'body': ""I've got the root cause and a PR will be out tomorrow (Friday); it needs some unit tests."", 'created_at': datetime.datetime(2024, 8, 22, 21, 4, 37, tzinfo=datetime.timezone.utc)}]","bshepherdson (Assginee) on (2024-08-22 17:39:02 UTC): I was able to reproduce this, but only on SQL Server.

The proximal cause is that while adding the implicit `ORDER BY` clauses for breakouts, we fail to recognize that there's already a sort order for Created At.

The breakout is spelled
```clojure
[:field 123 {:base-type :type/DateTime, :temporal-unit :month}]
```
whereas the `:order-by` is spelled
```clojure
[:desc [:field 123 {:base-type :type/Date, :temporal-unit :month}]]
```

That is, the breakout has the correct `:base-type :type/DateTime` while the sort order was added with a (halfway-correct due to the truncation) `:type/Date`. This matching code uses direct set matching, so it does not allow for any differences.

I'm continuing to investigate for the root cause. It seems that on H2 and Postgres the sort order has `:base-type :type/DateTime` and this issue does not appear.

bshepherdson (Assginee) on (2024-08-22 21:04:37 UTC): I've got the root cause and a PR will be out tomorrow (Friday); it needs some unit tests.

"
2474318614,issue,closed,completed,"Summarized ad-hoc question makes the ""Save"" button jump visually","### Describe the bug

When opening an ad-hoc question and then adding summarization, the ""Save"" button jumps visually.

### To Reproduce

1. New > Question > Choose any table
2. Summarize > Count of rows (or any other metric you want)
3. Notice how the whole Notebook UI shifts a little bit and the ""Save"" button moves vertically
4. Remove the summarization and you'll see it jump again

https://github.com/user-attachments/assets/16aa9a78-bc8f-4890-9a0c-43d953f90185

### Expected behavior

There should be no vertical movement when summarizing an ad-hoc question.

### Logs

_No response_

### Information about your Metabase installation

```JSON
local dev, `master`, 2bbcf74, H2, Sample Database
```


### Severity

P3

### Additional context

_No response_",nemanjaglumac,2024-08-19 22:16:55+00:00,['nemanjaglumac'],2024-10-03 22:22:50+00:00,2024-08-20 07:01:21+00:00,https://github.com/metabase/metabase/issues/46991,"[('Type:Bug', 'Product defects'), ('Type:UX', ''), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('Querying/Notebook', 'Items specific to the Custom/Notebook query builder'), ('.Team/Querying', '')]",[],
2474285482,issue,open,,`AdminEmbedMenu` console error,"```
console.js:13 Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?

Check the render method of `@mantine/core/PopoverTarget`.
    at ViewFooterSharingButton (http://localhost:8080/app/dist/app-main.hot.bundle.js:580151:99)
    at http://localhost:8080/app/dist/vendor.hot.bundle.js:24539:87
    at http://localhost:8080/app/dist/vendor.hot.bundle.js:21084:87
    at Provider (http://localhost:8080/app/dist/vendor.hot.bundle.js:39951:23)
    at Popover (http://localhost:8080/app/dist/vendor.hot.bundle.js:24134:65)
    at Provider (http://localhost:8080/app/dist/vendor.hot.bundle.js:39951:23)
    at Menu (http://localhost:8080/app/dist/vendor.hot.bundle.js:20410:87)
    at Menu
    at AdminEmbedMenu (http://localhost:8080/app/dist/app-main.hot.bundle.js:465500:11)
    at EmbedMenu (http://localhost:8080/app/dist/app-main.hot.bundle.js:465750:84)
    ```",nemanjaglumac,2024-08-19 21:59:13+00:00,[],2025-02-04 20:29:49+00:00,,https://github.com/metabase/metabase/issues/46990,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('.DX', 'Developer experience and QoL related.')]",[],
2473793120,issue,closed,completed,We don't support Snowflake variants on subscriptions,"### Describe the bug

Seems that if you have a variant (https://docs.snowflake.com/en/sql-reference/data-types-semistructured) in the data, then the subscriptions fail

### To Reproduce

1) set up a table in snowflake like
CREATE OR REPLACE TABLE variant_insert (id integer autoincrement, v VARIANT);
INSERT INTO variant_insert (v)
  SELECT PARSE_JSON('{""key3"": ""value3"", ""key4"": ""value4""}');
INSERT INTO variant_insert (v)
  SELECT PARSE_JSON('{""key3"": ""value3"", ""key4"": ""value4""}');
INSERT INTO variant_insert (v)
  SELECT PARSE_JSON('{""key3"": ""value3"", ""key4"": ""value4""}');
INSERT INTO variant_insert (v)
  SELECT PARSE_JSON('{""key3"": ""value3"", ""key4"": ""value4""}');
INSERT INTO variant_insert (v)
  SELECT PARSE_JSON('{""key3"": ""value3"", ""key4"": ""value4""}');
2) add it to Metabase
3) create a question that uses this table, add it to a dashboard
4) make a subcription out of this dashboard, send it and see the error

### Expected behavior

It should work

### Logs

```
2024-08-19 16:53:04,617 ERROR middleware.log :: POST /api/pulse/test 500 2.0 s (45 DB calls) {:metabase-user-id 1} 
{:via
 [{:type java.lang.IllegalArgumentException,
   :message
   ""Multiple methods in multimethod 'global-type-settings' match dispatch value: :type/SnowflakeVariant -> :type/Temporal and :type/Number, and neither is preferred"",
   :at [clojure.lang.MultiFn findAndCacheBestMethod ""MultiFn.java"" 179]}],
 :trace
 [[clojure.lang.MultiFn findAndCacheBestMethod ""MultiFn.java"" 179]
  [clojure.lang.MultiFn getMethod ""MultiFn.java"" 150]
  [clojure.lang.MultiFn getFn ""MultiFn.java"" 154]
  [clojure.lang.MultiFn invoke ""MultiFn.java"" 233]
  [metabase.query_processor.streaming.common$viz_settings_for_col invokeStatic ""common.clj"" 194]
  [metabase.query_processor.streaming.common$viz_settings_for_col invoke ""common.clj"" 179]
  [metabase.formatter.datetime$format_temporal_str invokeStatic ""datetime.clj"" 239]
  [metabase.formatter.datetime$format_temporal_str invoke ""datetime.clj"" 232]
  [metabase.formatter$create_formatter$fn__67698 invoke ""formatter.clj"" 232]
  [metabase.pulse.render.body$query_results__GT_row_seq$iter__73928__73932$fn__73933$iter__73967__73971$fn__73972
   invoke
   ""body.clj""
   154]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.Cons next ""Cons.java"" 39]
  [clojure.lang.RT countFrom ""RT.java"" 653]
  [clojure.lang.RT count ""RT.java"" 643]
  [metabase.pulse.render.table$render_table_body$iter__73784__73788$fn__73789$iter__73823__73827$fn__73828
   invoke
   ""table.clj""
   137]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2763]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2772]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.core$map$fn__5935 invoke ""core.clj"" 2770]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$apply invokeStatic ""core.clj"" 662]
  [clojure.core$apply invoke ""core.clj"" 662]
  [hiccup.compiler$fn__69448 invokeStatic ""compiler.clj"" 88]
  [hiccup.compiler$fn__69448 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [hiccup.compiler$render_element invokeStatic ""compiler.clj"" 78]
  [hiccup.compiler$render_element invoke ""compiler.clj"" 72]
  [hiccup.compiler$fn__69446 invokeStatic ""compiler.clj"" 85]
  [hiccup.compiler$fn__69446 invoke ""compiler.clj"" 82]
  [hiccup.compiler$fn__69431$G__69426__69436 invoke ""compiler.clj"" 68]
  [clojure.lang.Var invoke ""Var.java"" 384]
  [metabase.email.messages$render_message_body invokeStatic ""messages.clj"" 502]
  [metabase.email.messages$render_message_body invoke ""messages.clj"" 492]
  [metabase.email.messages$render_pulse_email invokeStatic ""messages.clj"" 521]
  [metabase.email.messages$render_pulse_email invoke ""messages.clj"" 518]
  [metabase.pulse$fn__102257 invokeStatic ""pulse.clj"" 408]
  [metabase.pulse$fn__102257 invoke ""pulse.clj"" 397]
  [clojure.lang.MultiFn invoke ""MultiFn.java"" 239]
  [metabase.pulse$parts__GT_notifications$iter__102332__102336$fn__102337$fn__102338 invoke ""pulse.clj"" 479]
  [metabase.pulse$parts__GT_notifications$iter__102332__102336$fn__102337 invoke ""pulse.clj"" 477]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.RT seq ""RT.java"" 535]
  [clojure.core$seq__5467 invokeStatic ""core.clj"" 139]
  [clojure.core$seq__5467 invoke ""core.clj"" 139]
  [metabase.pulse$send_notifications_BANG_ invokeStatic ""pulse.clj"" 532]
  [metabase.pulse$send_notifications_BANG_ invoke ""pulse.clj"" 531]
  [metabase.pulse$send_pulse_BANG_ invokeStatic ""pulse.clj"" 560]
  [metabase.pulse$send_pulse_BANG_ doInvoke ""pulse.clj"" 540]
  [clojure.lang.RestFn invoke ""RestFn.java"" 410]
  [metabase.api.pulse$fn__104652 invokeStatic ""pulse.clj"" 349]
  [metabase.api.pulse$fn__104652 invoke ""pulse.clj"" 331]
  [compojure.core$wrap_response$fn__53096 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__53080 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__53085 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [metabase.pulse.preview$style_tag_nonce_middleware$fn__102679 invoke ""preview.clj"" 165]
  [metabase.server.middleware.auth$enforce_authentication$fn__97696 invoke ""auth.clj"" 18]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53136 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 300]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [metabase.api.routes$fn__105263$fn__105264 invoke ""routes.clj"" 70]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__105543$fn__105544 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53136 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53089 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 199]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53136 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108$f__53109$respond_SINGLEQUOTE___53110 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53140 invoke ""core.clj"" 301]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [compojure.core$routes$fn__53108$f__53109 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53108 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__101677 invoke ""exceptions.clj"" 107]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__101674 invoke ""exceptions.clj"" 96]
  [metabase.server.middleware.log$log_api_call$fn__107892$fn__107893$fn__107894 invoke ""log.clj"" 236]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__107892$fn__107893 invoke ""log.clj"" 227]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__107892 invoke ""log.clj"" 226]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__114018 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__101633 invoke ""security.clj"" 240]
  [ring.middleware.json$wrap_json_body$fn__114277 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__87888 invoke ""offset_paging.clj"" 43]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__54628 invoke ""json.clj"" 83]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__114366 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__114385 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__70358 invoke ""misc.clj"" 60]
  [metabase.server.middleware.session$reset_session_timeout$fn__77478 invoke ""session.clj"" 552]
  [metabase.server.middleware.session$bind_current_user$fn__77444$fn__77445 invoke ""session.clj"" 446]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 425]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 408]
  [metabase.server.middleware.session$bind_current_user$fn__77444 invoke ""session.clj"" 445]
  [metabase.server.middleware.session$wrap_current_user_info$fn__77423 invoke ""session.clj"" 383]
  [metabase.server.middleware.session$wrap_session_id$fn__77395 invoke ""session.clj"" 259]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__97704 invoke ""auth.clj"" 32]
  [ring.middleware.cookies$wrap_cookies$fn__114205 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__70340 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__70366 invoke ""misc.clj"" 77]
  [ring.middleware.gzip$wrap_gzip$fn__114247 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.misc$bind_request$fn__70369 invoke ""misc.clj"" 94]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__114034 invoke ""ssl.clj"" 41]
  [metabase.server$async_proxy_handler$fn__70704 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run nil -1]],
 :cause
 ""Multiple methods in multimethod 'global-type-settings' match dispatch value: :type/SnowflakeVariant -> :type/Temporal and :type/Number, and neither is preferred"",
 :message
 ""Multiple methods in multimethod 'global-type-settings' match dispatch value: :type/SnowflakeVariant -> :type/Temporal and :type/Number, and neither is preferred""}


```

### Information about your Metabase installation

```JSON
tested on v1.50.18
```


### Severity

P2?

### Additional context

NA",paoliniluis,2024-08-19 16:56:33+00:00,['adam-james-v'],2024-08-30 17:08:56+00:00,2024-08-30 16:12:43+00:00,https://github.com/metabase/metabase/issues/46981,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Dashboards', ''), ('Database/Snowflake', ''), ('.Backend', ''), ('.Escalation', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2318585402, 'issue_id': 2473793120, 'author': 'paoliniluis', 'body': 'now this is affecting exports', 'created_at': datetime.datetime(2024, 8, 29, 18, 32, 27, tzinfo=datetime.timezone.utc)}]","paoliniluis (Issue Creator) on (2024-08-29 18:32:27 UTC): now this is affecting exports

"
2473721065,issue,closed,not_planned,Enable querying BigQuery nested fields,- [ ] QP can process BigQuery nested fields as any other field,luizarakaki,2024-08-19 16:12:09+00:00,[],2024-08-21 15:51:28+00:00,2024-08-21 15:51:28+00:00,https://github.com/metabase/metabase/issues/46978,[],[],
2473715095,issue,closed,not_planned,Sync BigQuery nested fields,- [ ] nested fields in `metabase_field`,luizarakaki,2024-08-19 16:08:57+00:00,[],2024-08-21 15:51:22+00:00,2024-08-21 15:51:22+00:00,https://github.com/metabase/metabase/issues/46977,[],[],
2473517637,issue,closed,completed,[Epic] Feature flag and settings for SDK,">[!CAUTION]
> Do not merge the feature branch `46970-sdk-feature-flag-and-settings` unless we are ready to launch the SDK publicly as a whole.


**Links**
- [Product doc](https://www.notion.so/metabase/Feature-flag-and-settings-for-SDK-8ed424c776194528b6332c5fc2510a0c)
- [Eng doc](https://www.notion.so/metabase/Tech-Split-the-admin-settings-for-iframe-and-SDK-embedding-9945e76d7e80404fa79b7d5b93049978)
- [Testing plan](https://www.notion.so/metabase/Testing-plan-Split-the-admin-settings-for-iframe-and-SDK-embedding-c11a850f05254fa28133ed616546dfa0)
- [Figma file](https://www.figma.com/design/W1TfzdrR8ldzp4vdjP1z36/SDK-Embedding%3A-admin-settings-%2B-embed-flow?node-id=10563-15285&node-type=section&t=i9w041BGBjMvF49p-0)
- feature branch:
    ```
    46970-sdk-feature-flag-and-settings
    ```

Milestone 0 branch (BE)
```
46970-milestone-0
```
```[tasklist]
### Milestone 0: BE
- [ ] https://github.com/metabase/metabase/issues/47521
- [ ] https://github.com/metabase/metabase/issues/47522
- [ ] https://github.com/metabase/metabase/issues/47525
- [ ] https://github.com/metabase/metabase/issues/47526
- [ ] https://github.com/metabase/metabase/issues/47528
- [ ] https://github.com/metabase/metabase/issues/47524
- [ ] https://github.com/metabase/metabase/issues/47527
- [ ] https://github.com/metabase/metabase/issues/47906
```


Milestone 1 branch
```
46970-milestone-1
```

```[tasklist]
### Milestone 1
- [ ] https://github.com/metabase/metabase/issues/47185
- [ ] https://github.com/metabase/metabase/issues/47501
- [ ] https://github.com/metabase/metabase/issues/47682
- [x] Add an SDK setting page with CORS setting similar to the one for interactive embedding
- [x] Wire the new setting on BE and implement BE setting logic (will be implemented in milestone 0)
- [ ] https://github.com/metabase/metabase/issues/47754
```


Milestone 2 branch
```
46970-milestone-2
```
```[tasklist]
### Milestone 2
- [ ] https://github.com/metabase/metabase/issues/47766
- [ ] https://github.com/metabase/metabase/issues/47881
- [ ] https://github.com/metabase/metabase/issues/47767
- [ ] https://github.com/metabase/metabase/issues/47768
- [x] make sure https://github.com/metabase/metabase/commit/0888589d373d694a715582da2c30f8bed2abb8cb is reverted before merging to master
```
",WiNloSt,2024-08-19 14:33:30+00:00,"['escherize', 'WiNloSt']",2024-10-08 12:41:48+00:00,2024-10-08 12:41:48+00:00,https://github.com/metabase/metabase/issues/46970,"[('Administration/Settings', ''), ('.Epic', 'Feature Implementation or Project'), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2473219356,issue,open,,"Allow Setting so that Dashboard ""auto apply filters"" toggle is off by default","
Is your feature request related to a problem? Please describe.
For customers that want ""auto apply filters"" toggle is off they are updating this on every dashboard they create.

Describe the solution you'd like
An option in Settings (General, Appearance or anywhere that makes sense) to choose the global default for the dashboard ""auto apply filters"" toggle",Tony-metabase,2024-08-19 12:17:46+00:00,[],2025-02-04 20:29:43+00:00,,https://github.com/metabase/metabase/issues/46964,"[('Administration/Settings', ''), ('Reporting/Dashboards/Filters & Parameters', 'Related to the setup and use of filters and parameters in dashboards only')]",[],
2473169445,issue,closed,completed,add import sorting inside destructuring,[context](https://github.com/metabase/metabase/pull/46959#discussion_r1721587001),uladzimirdev,2024-08-19 11:51:14+00:00,['uladzimirdev'],2024-08-20 18:12:08+00:00,2024-08-20 14:29:10+00:00,https://github.com/metabase/metabase/issues/46962,[],"[{'comment_id': 2296433302, 'issue_id': 2473169445, 'author': 'kamilmielnik', 'body': 'I think it\'s about all files in the project. We now have correct sorting of lines by import path, but the destructed references list is not ordered, e.g.\r\n\r\nThis passes, but should not (throughout all codebase, not only e2e tests):\r\n```ts\r\nimport { b, a } from ""./x"";\r\n```', 'created_at': datetime.datetime(2024, 8, 19, 12, 15, 46, tzinfo=datetime.timezone.utc)}]","kamilmielnik on (2024-08-19 12:15:46 UTC): I think it's about all files in the project. We now have correct sorting of lines by import path, but the destructed references list is not ordered, e.g.

This passes, but should not (throughout all codebase, not only e2e tests):
```ts
import { b, a } from ""./x"";
```

"
2472971324,issue,closed,completed,Add Sparkline component,"From the design doc:

<img width=""284"" alt=""Screenshot 2024-08-19 at 12 06 28"" src=""https://github.com/user-attachments/assets/97eac813-eb6f-4e8a-88c6-86f1ff13968a"">

The sparklines have consistent x-axes across the table, but the y-axis varies.

The lowest y-value of each sparkline is at the bottom of the rectangle indicated in pink above, with the highest value being at the top of the rectangle. This works the same in case of some values being below 0.

In the occasion of a flat trend, the line is located in the middle of the rectangle (third example above).

If there are more than 30 data points for the selected period, we should show the trend as an aggregated line with ~30 data points (the second example above has 30). E.g., group by day for monthly trend, group by 2 weeks for yearly trends.

Given the small size, there’s no particular hover state or tooltips on the sparklines. Clicking on them should open the full visualization.
",romeovs,2024-08-19 10:06:11+00:00,['romeovs'],2024-10-29 05:10:06+00:00,2024-10-29 05:10:05+00:00,https://github.com/metabase/metabase/issues/46957,"[('Type:New Feature', ''), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2443227079, 'issue_id': 2472971324, 'author': 'romeovs', 'body': 'Closing this for now as we are not using the component anywhere yey', 'created_at': datetime.datetime(2024, 10, 29, 5, 10, 5, tzinfo=datetime.timezone.utc)}]","romeovs (Issue Creator) on (2024-10-29 05:10:05 UTC): Closing this for now as we are not using the component anywhere yey

"
2472970876,issue,closed,completed,[Epic] Allow users to view all metrics in one place (part 1),"### Links
- [product doc](https://www.notion.so/metabase/Allow-users-to-view-all-metrics-in-one-place-part-1-83f6a01454e6460cbdc7c86f57fd6a88)

### Implementation Plan

### Milestone 1: Metrics page
```[tasklist]
- [ ] https://github.com/metabase/metabase/issues/47011
- [ ] https://github.com/metabase/metabase/issues/47322
- [ ] https://github.com/metabase/metabase/issues/47796
- [ ] https://github.com/metabase/metabase/issues/47797
- [ ] https://github.com/metabase/metabase/issues/47803
- [ ] https://github.com/metabase/metabase/issues/47713
```
",romeovs,2024-08-19 10:06:01+00:00,['romeovs'],2024-09-27 20:54:40+00:00,2024-09-25 09:24:11+00:00,https://github.com/metabase/metabase/issues/46956,"[('.Frontend', ''), ('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2472945571,issue,closed,completed,Audit structured query field references against compiled native ones,"Basically the idea here is that we can build confidence in the 3 different code paths for `query-analysis` by comparing the results for both direct analysis of structured queries (both legacy and pMBQL), and the macaw analysis of their compiled form.

Unfortunately this is blocked by https://github.com/metabase/metabase/issues/46929 at the moment - we can't know which fields in the compiled form are only implicit.",crisptrutski,2024-08-19 09:54:19+00:00,[],2024-11-21 14:19:02+00:00,2024-11-21 14:19:02+00:00,https://github.com/metabase/metabase/issues/46955,"[('.Team/Workflows', 'aka BEC'), ('Querying/Native/Parser', '')]",[],
2472894326,issue,closed,completed,cleanup logs from cypress at CI ,"we have two kinds of mess that makes search of the failing test complicated:
- cypress testing library prints whole DOM into logs (we don't need it, it's not useful in any way)
- cypress terminal report pollutes logs with debug info, but it also makes search more complicated, so we'll keep such logs only in mocha reports",uladzimirdev,2024-08-19 09:28:56+00:00,['uladzimirdev'],2024-10-08 16:17:04+00:00,2024-08-20 12:50:23+00:00,https://github.com/metabase/metabase/issues/46954,[],[],
2472878570,issue,closed,not_planned,Enable drills for the same columns that are exposed for filtering in the filter modal,"See [Slack](https://metaboat.slack.com/archives/C07BWMG9C8M/p1723817912822269)

This should also fix #46932",kamilmielnik,2024-08-19 09:21:00+00:00,[],2024-10-10 16:22:55+00:00,2024-10-10 16:22:55+00:00,https://github.com/metabase/metabase/issues/46953,"[('.Frontend', ''), ('.Team/Querying', '')]",[],
2472204097,issue,closed,completed,Clearing filter causes page to close.,"### Describe the bug

Filter clear attempts to close the webpage.

### To Reproduce

1. Go to native sql query with field filters
2. Click on field filter and select a value
3. Generate the filtered report
4. Click to clear filter
5. See error - ""This page is asking you to confirm that you want to leave — information you’ve entered may not be saved.""
6. Need to click stay on page in order to clear the filter.


### Expected behavior

Filter would clear.

### Logs

![image](https://github.com/user-attachments/assets/f7c149a7-3713-4be2-ae36-b0b0602b922d)

[f11f6183-f5c3-469d-80e8-a570e7616e38] 2024-08-19T09:22:05+09:30 DEBUG metabase.server.middleware.log GET /api/collection/tree 200 30.6 ms (6 DB calls) App DB connections: 4/13 Jetty threads: 9/50 (1 idle, 0 queued) (121 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 2}
[f11f6183-f5c3-469d-80e8-a570e7616e38] 2024-08-19T09:22:05+09:30 DEBUG metabase.server.middleware.log GET /api/setting 200 60.5 ms (16 DB calls) App DB connections: 3/13 Jetty threads: 9/50 (1 idle, 0 queued) (123 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 2}
[f11f6183-f5c3-469d-80e8-a570e7616e38] 2024-08-19T09:22:05+09:30 DEBUG metabase.server.middleware.log GET /api/search 200 111.8 ms (5 DB calls) App DB connections: 2/13 Jetty threads: 9/50 (1 idle, 0 queued) (123 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 2}
[f11f6183-f5c3-469d-80e8-a570e7616e38] 2024-08-19T09:22:05+09:30 DEBUG metabase.server.middleware.log GET /api/session/properties 200 73.7 ms (12 DB calls) App DB connections: 1/13 Jetty threads: 7/50 (1 idle, 0 queued) (125 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 2}
[f11f6183-f5c3-469d-80e8-a570e7616e38] 2024-08-19T09:22:05+09:30 DEBUG metabase.server.middleware.log GET /api/session/properties 200 51.4 ms (12 DB calls) App DB connections: 0/13 Jetty threads: 7/50 (1 idle, 0 queued) (125 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 2}
[f11f6183-f5c3-469d-80e8-a570e7616e38] 2024-08-19T09:22:05+09:30 DEBUG metabase.server.middleware.log GET /api/setup/admin_checklist 200 42.3 ms (10 DB calls) App DB connections: 0/13 Jetty threads: 4/50 (3 idle, 0 queued) (127 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 2}
[f11f6183-f5c3-469d-80e8-a570e7616e38] 2024-08-19T09:22:05+09:30 INFO metabase.server.middleware.exceptions Request canceled before finishing.
[f11f6183-f5c3-469d-80e8-a570e7616e38] 2024-08-19T09:22:07+09:30 DEBUG metabase.server.middleware.log GET /api/util/bug_report_details 200 10.6 ms (1 DB calls) App DB connections: 0/13 Jetty threads: 4/50 (4 idle, 0 queued) (127 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 2}


### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:129.0) Gecko/20100101 Firefox/129.0"",
    ""vendor"": """"
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.158.2-1.cm2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.19""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-06"",
      ""tag"": ""v0.50.19"",
      ""hash"": ""0b97bf8""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

Annoying

### Additional context

![image](https://github.com/user-attachments/assets/543a2db3-55b7-438e-beb8-1b95d423f91b)
",MelUniSA,2024-08-18 23:55:18+00:00,[],2024-08-19 07:45:56+00:00,2024-08-19 07:45:50+00:00,https://github.com/metabase/metabase/issues/46949,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2295884440, 'issue_id': 2472204097, 'author': 'kamilmielnik', 'body': ""It's been fixed in 0.50.20.\r\nDuplicate of #46570.\r\nClosing."", 'created_at': datetime.datetime(2024, 8, 19, 7, 45, 50, tzinfo=datetime.timezone.utc)}]","kamilmielnik on (2024-08-19 07:45:50 UTC): It's been fixed in 0.50.20.
Duplicate of #46570.
Closing.

"
2471580838,issue,closed,not_planned,Metabase v0.50.20 fails both setup new DB and migration on PostgreSQL 16.3 on RDS,"### Describe the bug

I tried upgrading from Metabase 44 to 50, and it failed. So I decided to see what happened on a fresh DB and it fails with basically the same errors.

### To Reproduce

Install Metabase 50, migrations fail

### Expected behavior

_No response_

### Logs

Aug 17 12:07:12 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:12,457 INFO metabase.util :: Maximum memory available to JVM: 256.0 MB
Aug 17 12:07:19 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:19,839 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance.
Aug 17 12:07:19 ip-172-30-1-73 metabase[3228979]:  For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html
Aug 17 12:07:36 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:36,623 INFO driver.impl :: Registered abstract driver :sql
Aug 17 12:07:36 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:36,706 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql])
Aug 17 12:07:36 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:36,730 INFO metabase.util :: Load driver :sql-jdbc took 36.6 ms
Aug 17 12:07:36 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:36,731 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc])
Aug 17 12:07:37 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:37,541 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc])
Aug 17 12:07:37 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:37,667 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc])
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:45,346 INFO metabase.core ::
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]: Metabase v0.50.20 (df82d58)
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]: Copyright © 2024 Metabase, Inc.
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]: Metabase Enterprise Edition extensions are NOT PRESENT.
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:45,365 INFO metabase.core :: Starting Metabase in STANDALONE mode
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:45,555 INFO metabase.server :: Launching Embedded Jetty Webserver with config:
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  {:port 7654, :host ""127.0.0.1""}
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:45,889 INFO metabase.core :: Starting Metabase version v0.50.20 (df82d58) ...
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:45,930 INFO metabase.core :: System info:
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  {""file.encoding"" ""UTF-8"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""java.runtime.name"" ""OpenJDK Runtime Environment"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""java.runtime.version"" ""11.0.11+9"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""java.vendor"" ""AdoptOpenJDK"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""java.vendor.url"" ""https://adoptopenjdk.net/"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""java.version"" ""11.0.11"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""java.vm.version"" ""11.0.11+9"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""os.name"" ""Linux"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""os.version"" ""6.8.0-1013-aws"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""user.language"" ""en"",
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]:  ""user.timezone"" ""America/New_York""}
Aug 17 12:07:45 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:45,933 INFO metabase.plugins :: Loading plugins in /home/metabase/plugins...
Aug 17 12:07:48 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:48,882 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Vertica Driver due to required dependencies. Metabase requires the Vertica JDBC driver in order to connect to Vertica databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/vertica.html for more details.
Aug 17 12:07:48 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:48,889 INFO plugins.dependencies :: Metabase Vertica Driver dependency {:class com.vertica.jdbc.Driver} satisfied? false
Aug 17 12:07:48 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:48,890 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Vertica Driver""]
Aug 17 12:07:48 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:48,930 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :google...
Aug 17 12:07:48 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:48,933 INFO driver.impl :: Registered abstract driver :google
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,184 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :snowflake...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,187 INFO driver.impl :: Registered driver :snowflake (parents: [:sql-jdbc])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,247 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :athena...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,248 INFO driver.impl :: Registered driver :athena (parents: [:sql-jdbc])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,287 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,292 INFO driver.impl :: Registered driver :druid
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,320 INFO plugins.dependencies :: Plugin 'Metabase BigQuery Driver' depends on plugin 'Metabase Google Drivers Shared Dependencies'
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,323 INFO plugins.dependencies :: Metabase BigQuery Driver dependency {:plugin Metabase Google Drivers Shared Dependencies} satisfied? true
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,330 WARN plugins.lazy-loaded-driver :: Warning: plugin manifest for :bigquery does not include connection properties
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,332 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :bigquery...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,335 INFO driver.impl :: Registered driver :bigquery (parents: [:sql :google])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,372 INFO plugins.dependencies :: Plugin 'Metabase Presto Driver' depends on plugin 'Presto Common Driver'
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,379 INFO plugins.dependencies :: Metabase Presto Driver dependency {:plugin Presto Common Driver} satisfied? false
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,380 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Vertica Driver"" ""Metabase Presto Driver""]
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,403 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlite...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,405 INFO driver.impl :: Registered driver :sqlite (parents: [:sql-jdbc])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,445 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :redshift...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,450 INFO driver.impl :: Registered driver :redshift (parents: [:postgres])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,612 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :bigquery-cloud-sdk...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,613 INFO driver.impl :: Registered driver :bigquery-cloud-sdk (parents: [:sql])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,617 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto-common...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,618 INFO driver.impl :: Registered abstract driver :presto-common
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,623 INFO plugins.dependencies :: Metabase Presto Driver dependency {:plugin Presto Common Driver} satisfied? true
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,638 DEBUG plugins.initialize :: Dependencies satisfied; these plugins will now be loaded: [""Metabase Presto Driver""]
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,639 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,643 INFO driver.impl :: Registered driver :presto (parents: [:presto-common])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,676 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid-jdbc...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,679 INFO driver.impl :: Registered driver :druid-jdbc (parents: [:sql-jdbc])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,726 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :mongo...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,726 INFO driver.impl :: Registered driver :mongo
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,750 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Oracle Driver due to required dependencies. Metabase requires the Oracle JDBC driver in order to connect to Oracle databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/oracle.html for more details.
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,752 INFO plugins.dependencies :: Metabase Oracle Driver dependency {:class oracle.jdbc.OracleDriver} satisfied? false
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,756 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Vertica Driver"" ""Metabase Oracle Driver""]
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,829 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto-jdbc...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,829 INFO driver.impl :: Registered driver :presto-jdbc (parents: [:sql-jdbc])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,853 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :googleanalytics...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,857 INFO driver.impl :: Registered driver :googleanalytics
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,882 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :hive-like...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,886 INFO driver.impl :: Registered abstract driver :hive-like (parents: [:sql-jdbc])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,887 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sparksql...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,890 INFO driver.impl :: Registered driver :sparksql (parents: [:hive-like])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,906 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlserver...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,906 INFO driver.impl :: Registered driver :sqlserver (parents: [:sql-jdbc])
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,949 INFO metabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...
Aug 17 12:07:49 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:49,952 INFO db.setup :: Verifying postgres Database Connection ...
Aug 17 12:07:51 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:51,645 INFO db.setup :: Successfully verified PostgreSQL 16.3 application database connection.
Aug 17 12:07:51 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:51,649 INFO db.setup :: Checking if a database downgrade is required...
Aug 17 12:07:53 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:53,995 INFO db.setup :: Running Database Migrations...
Aug 17 12:07:53 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:53,997 INFO db.setup :: Setting up Liquibase...
Aug 17 12:07:54 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:54,799 INFO db.liquibase :: Updating liquibase table to reflect consolidated changeset filenames
Aug 17 12:07:54 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:54,856 INFO db.liquibase :: No migration lock found.
Aug 17 12:07:54 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:54,857 INFO db.liquibase :: Migration lock acquired.
Aug 17 12:07:54 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:54,895 INFO db.setup :: Liquibase is ready.
Aug 17 12:07:54 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:54,898 INFO db.liquibase :: Checking if Database has unrun migrations...
Aug 17 12:07:56 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:56,876 INFO db.liquibase :: Database has unrun migrations. Checking if migration lock is taken...
Aug 17 12:07:56 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:56,897 INFO db.liquibase :: No migration lock found.
Aug 17 12:07:56 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:56,897 INFO db.liquibase :: Migration lock acquired.
Aug 17 12:07:57 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:07:57,833 INFO db.liquibase :: Running 353 migrations ...
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,422 INFO impl.StdSchedulerFactory :: Using default implementation for ThreadExecutor
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,448 INFO core.SchedulerSignalerImpl :: Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,450 INFO core.QuartzScheduler :: Quartz Scheduler v.2.3.2 created.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,452 INFO jdbcjobstore.JobStoreTX :: Using db table-based data access locking (synchronization).
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,456 INFO jdbcjobstore.JobStoreTX :: JobStoreTX initialized.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,458 INFO core.QuartzScheduler :: Scheduler meta-data: Quartz Scheduler (v2.3.2) 'MetabaseScheduler' with instanceId 'ip-172-30-1-731723910885426'
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]:   Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]:   NOT STARTED.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]:   Currently in standby mode.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]:   Number of jobs executed: 0
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]:   Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]:   Using job-store 'org.quartz.impl.jdbcjobstore.JobStoreTX' - which supports persistence. and is clustered.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,458 INFO impl.StdSchedulerFactory :: Quartz scheduler 'MetabaseScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,458 INFO impl.StdSchedulerFactory :: Quartz scheduler version: 2.3.2
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,599 INFO core.QuartzScheduler :: Scheduler MetabaseScheduler_$_ip-172-30-1-731723910885426 started.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,676 INFO core.QuartzScheduler :: Scheduler MetabaseScheduler_$_ip-172-30-1-731723910885426 shutting down.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,677 INFO core.QuartzScheduler :: Scheduler MetabaseScheduler_$_ip-172-30-1-731723910885426 paused.
Aug 17 12:08:05 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:05,680 INFO core.QuartzScheduler :: Scheduler MetabaseScheduler_$_ip-172-30-1-731723910885426 shutdown complete.
Aug 17 12:08:08 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:08,021 INFO db.custom-migrations :: No forward migration for DowngradeDashboardTab
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:11,273 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss encountered an exception.
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1901867"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:252)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:256)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.command.CommandScope.execute(CommandScope.java:217)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.runInScope(Liquibase.java:1419)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.update(Liquibase.java:234)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.update(Liquibase.java:212)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.update(Liquibase.java:194)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__44483.invoke(liquibase.clj:360)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$run_in_scope_locked$reify__44479.run(liquibase.clj:325)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:318)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:301)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:349)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:342)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$migrate_BANG_$fn__53428.invoke(setup.clj:84)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$do_with_liquibase$f_STAR___44420.invoke(liquibase.clj:140)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$do_with_liquibase.invokeStatic(liquibase.clj:143)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$do_with_liquibase.invoke(liquibase.clj:131)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$migrate_BANG_.invokeStatic(setup.clj:73)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$migrate_BANG_.doInvoke(setup.clj:55)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.invoke(RestFn.java:425)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$run_schema_migrations_BANG_.invokeStatic(setup.clj:149)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$run_schema_migrations_BANG_.invoke(setup.clj:144)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$setup_db_BANG_$fn__53456$fn__53457.invoke(setup.clj:167)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$setup_db_BANG_$fn__53456.invoke(setup.clj:161)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db$setup_db_BANG_$fn__53481.invoke(db.clj:86)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.invoke(RestFn.java:421)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:117)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$init_BANG__STAR_.invoke(core.clj:98)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$init_BANG_.invokeStatic(core.clj:170)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$init_BANG_.invoke(core.clj:165)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$start_normally.invokeStatic(core.clj:182)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$start_normally.invoke(core.clj:176)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$entrypoint.invokeStatic(core.clj:215)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$entrypoint.doInvoke(core.clj:209)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.invoke(RestFn.java:397)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.Var.applyTo(Var.java:705)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.core$apply.invokeStatic(core.clj:667)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.core$apply.invoke(core.clj:662)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.invoke(RestFn.java:397)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.bootstrap.main(Unknown Source)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: Caused by: org.postgresql.util.PSQLException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1901867"" is a system trigger
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         ... 86 more
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: UPDATE SUMMARY
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: Run:                        353
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: Previously run:               0
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: Filtered out:                50
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: -------------------------------
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: Total change sets:          403
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: FILTERED CHANGE SETS SUMMARY
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: DBMS mismatch:               50
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:11,448 ERROR metabase.core :: Metabase Initialization FAILED
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: liquibase.exception.CommandExecutionException: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss:
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:      Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1901867"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.command.CommandScope.execute(CommandScope.java:253)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.runInScope(Liquibase.java:1419)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.update(Liquibase.java:234)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.update(Liquibase.java:212)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Liquibase.update(Liquibase.java:194)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__44483.invoke(liquibase.clj:360)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$run_in_scope_locked$reify__44479.run(liquibase.clj:325)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:318)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:301)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:349)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:342)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$migrate_BANG_$fn__53428.invoke(setup.clj:84)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$do_with_liquibase$f_STAR___44420.invoke(liquibase.clj:140)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$do_with_liquibase.invokeStatic(liquibase.clj:143)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.liquibase$do_with_liquibase.invoke(liquibase.clj:131)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$migrate_BANG_.invokeStatic(setup.clj:73)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$migrate_BANG_.doInvoke(setup.clj:55)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.invoke(RestFn.java:425)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$run_schema_migrations_BANG_.invokeStatic(setup.clj:149)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$run_schema_migrations_BANG_.invoke(setup.clj:144)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$setup_db_BANG_$fn__53456$fn__53457.invoke(setup.clj:167)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$setup_db_BANG_$fn__53456.invoke(setup.clj:161)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db$setup_db_BANG_$fn__53481.invoke(db.clj:86)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.invoke(RestFn.java:421)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:117)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$init_BANG__STAR_.invoke(core.clj:98)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$init_BANG_.invokeStatic(core.clj:170)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$init_BANG_.invoke(core.clj:165)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$start_normally.invokeStatic(core.clj:182)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$start_normally.invoke(core.clj:176)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$entrypoint.invokeStatic(core.clj:215)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.core$entrypoint.doInvoke(core.clj:209)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.invoke(RestFn.java:397)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.Var.applyTo(Var.java:705)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.core$apply.invokeStatic(core.clj:667)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.core$apply.invoke(core.clj:662)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.invoke(RestFn.java:397)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at metabase.bootstrap.main(Unknown Source)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: Caused by: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss:
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:      Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1901867"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:151)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.command.CommandScope.execute(CommandScope.java:217)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         ... 58 more
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: Caused by: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss:
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:      Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1901867"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeSet.execute(ChangeSet.java:797)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:252)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.Scope.child(Scope.java:256)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         ... 66 more
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: Caused by: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1901867"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         ... 81 more
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: Caused by: org.postgresql.util.PSQLException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1901867"" is a system trigger
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]:         ... 86 more
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:11,461 INFO metabase.core :: Metabase Shutting Down ...
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:11,463 INFO metabase.server :: Shutting Down Embedded Jetty Webserver
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:11,503 WARN db.liquibase :: ()
Aug 17 12:08:11 ip-172-30-1-73 metabase[3228979]: 2024-08-17 12:08:11,515 INFO metabase.core :: Metabase Shutdown COMPLETE
Aug 17 12:08:12 ip-172-30-1-73 systemd[1]: metabase.service: Main process exited, code=exited, status=1/FAILURE
░░ Subject: Unit process exited

### Information about your Metabase installation

```JSON
See logs
```


### Severity

breaking change

### Additional context

_No response_",jonmarkgo,2024-08-17 16:12:15+00:00,[],2024-08-18 14:58:01+00:00,2024-08-18 11:33:38+00:00,https://github.com/metabase/metabase/issues/46948,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2294902690, 'issue_id': 2471580838, 'author': 'jonmarkgo', 'body': 'Alternate log for upgrading existing Metabase install (rather than fresh install):\r\nAug 17 12:03:44 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:03:44,574 INFO metabase.util :: Maximum memory available to JVM: 256.0 MB\r\nAug 17 12:03:51 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:03:51,414 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance.\r\nAug 17 12:03:51 ip-172-30-1-73 metabase[3222565]:  For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html\r\nAug 17 12:04:07 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:07,631 INFO driver.impl :: Registered abstract driver :sql\r\nAug 17 12:04:07 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:07,705 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql])\r\nAug 17 12:04:07 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:07,719 INFO metabase.util :: Load driver :sql-jdbc took 24.3 ms\r\nAug 17 12:04:07 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:07,721 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc])\r\nAug 17 12:04:08 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:08,482 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc])\r\nAug 17 12:04:08 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:08,589 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc])\r\nAug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:12,870 INFO metabase.core ::\r\nAug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: Metabase v0.50.20 (df82d58)\r\nAug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: Copyright © 2024 Metabase, Inc.\r\nAug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: Metabase Enterprise Edition extensions are NOT PRESENT.\r\nAug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:12,906 INFO metabase.core :: Starting Metabase in STANDALONE mode\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:13,059 INFO metabase.server :: Launching Embedded Jetty Webserver with config:\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  {:port 7654, :host ""127.0.0.1""}\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:13,193 INFO metabase.core :: Starting Metabase version v0.50.20 (df82d58) ...\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:13,209 INFO metabase.core :: System info:\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  {""file.encoding"" ""UTF-8"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.runtime.name"" ""OpenJDK Runtime Environment"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.runtime.version"" ""11.0.11+9"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.vendor"" ""AdoptOpenJDK"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.vendor.url"" ""https://adoptopenjdk.net/"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.version"" ""11.0.11"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.vm.version"" ""11.0.11+9"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""os.name"" ""Linux"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""os.version"" ""6.8.0-1013-aws"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""user.language"" ""en"",\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""user.timezone"" ""America/New_York""}\r\nAug 17 12:04:13 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:13,217 INFO metabase.plugins :: Loading plugins in /home/metabase/plugins...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,066 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Vertica Driver due to required dependencies. Metabase requires the Vertica JDBC driver in order to connect to Vertica databases, but we can\'t ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/vertica.html for more details.\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,075 INFO plugins.dependencies :: Metabase Vertica Driver dependency {:class com.vertica.jdbc.Driver} satisfied? false\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,078 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Vertica Driver""]\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,096 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :google...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,097 INFO driver.impl :: Registered abstract driver :google\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,207 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :snowflake...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,207 INFO driver.impl :: Registered driver :snowflake (parents: [:sql-jdbc])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,262 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :athena...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,264 INFO driver.impl :: Registered driver :athena (parents: [:sql-jdbc])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,293 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,294 INFO driver.impl :: Registered driver :druid\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,300 INFO plugins.dependencies :: Plugin \'Metabase BigQuery Driver\' depends on plugin \'Metabase Google Drivers Shared Dependencies\'\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,301 INFO plugins.dependencies :: Metabase BigQuery Driver dependency {:plugin Metabase Google Drivers Shared Dependencies} satisfied? true\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,302 WARN plugins.lazy-loaded-driver :: Warning: plugin manifest for :bigquery does not include connection properties\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,303 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :bigquery...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,303 INFO driver.impl :: Registered driver :bigquery (parents: [:sql :google])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,311 INFO plugins.dependencies :: Plugin \'Metabase Presto Driver\' depends on plugin \'Presto Common Driver\'\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,312 INFO plugins.dependencies :: Metabase Presto Driver dependency {:plugin Presto Common Driver} satisfied? false\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,313 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Presto Driver"" ""Metabase Vertica Driver""]\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,319 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlite...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,320 INFO driver.impl :: Registered driver :sqlite (parents: [:sql-jdbc])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,330 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :redshift...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,331 INFO driver.impl :: Registered driver :redshift (parents: [:postgres])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,374 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :bigquery-cloud-sdk...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,378 INFO driver.impl :: Registered driver :bigquery-cloud-sdk (parents: [:sql])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,392 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto-common...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,395 INFO driver.impl :: Registered abstract driver :presto-common\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,398 INFO plugins.dependencies :: Metabase Presto Driver dependency {:plugin Presto Common Driver} satisfied? true\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,404 DEBUG plugins.initialize :: Dependencies satisfied; these plugins will now be loaded: [""Metabase Presto Driver""]\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,405 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,407 INFO driver.impl :: Registered driver :presto (parents: [:presto-common])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,443 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid-jdbc...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,444 INFO driver.impl :: Registered driver :druid-jdbc (parents: [:sql-jdbc])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,471 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :mongo...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,473 INFO driver.impl :: Registered driver :mongo\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,491 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Oracle Driver due to required dependencies. Metabase requires the Oracle JDBC driver in order to connect to Oracle databases, but we can\'t ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/oracle.html for more details.\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,494 INFO plugins.dependencies :: Metabase Oracle Driver dependency {:class oracle.jdbc.OracleDriver} satisfied? false\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,496 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Oracle Driver"" ""Metabase Vertica Driver""]\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,549 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto-jdbc...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,550 INFO driver.impl :: Registered driver :presto-jdbc (parents: [:sql-jdbc])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,625 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :googleanalytics...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,626 INFO driver.impl :: Registered driver :googleanalytics\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,639 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :hive-like...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,640 INFO driver.impl :: Registered abstract driver :hive-like (parents: [:sql-jdbc])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,641 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sparksql...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,641 INFO driver.impl :: Registered driver :sparksql (parents: [:hive-like])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,649 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlserver...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,651 INFO driver.impl :: Registered driver :sqlserver (parents: [:sql-jdbc])\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,687 INFO metabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...\r\nAug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,691 INFO db.setup :: Verifying postgres Database Connection ...\r\nAug 17 12:04:17 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:17,070 INFO db.setup :: Successfully verified PostgreSQL 16.3 application database connection.\r\nAug 17 12:04:17 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:17,073 INFO db.setup :: Checking if a database downgrade is required...\r\nAug 17 12:04:20 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:20,483 INFO db.setup :: Running Database Migrations...\r\nAug 17 12:04:20 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:20,488 INFO db.setup :: Setting up Liquibase...\r\nAug 17 12:04:21 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:21,614 INFO db.setup :: Liquibase is ready.\r\nAug 17 12:04:21 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:21,614 INFO db.liquibase :: Checking if Database has unrun migrations...\r\nAug 17 12:04:24 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:24,068 INFO db.liquibase :: Database has unrun migrations. Checking if migration lock is taken...\r\nAug 17 12:04:24 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:24,170 INFO db.liquibase :: No migration lock found.\r\nAug 17 12:04:24 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:24,171 INFO db.liquibase :: Migration lock acquired.\r\nAug 17 12:04:25 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:25,406 INFO db.liquibase :: Running 66 migrations ...\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,095 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss encountered an exception.\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:252)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:256)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.CommandScope.execute(CommandScope.java:217)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.runInScope(Liquibase.java:1419)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:234)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:212)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:194)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__44483.invoke(liquibase.clj:360)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked$reify__44479.run(liquibase.clj:325)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:318)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:301)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:349)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:342)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_$fn__53428.invoke(setup.clj:84)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase$f_STAR___44420.invoke(liquibase.clj:140)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase.invokeStatic(liquibase.clj:143)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase.invoke(liquibase.clj:131)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_.invokeStatic(setup.clj:73)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_.doInvoke(setup.clj:55)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:425)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$run_schema_migrations_BANG_.invokeStatic(setup.clj:149)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$run_schema_migrations_BANG_.invoke(setup.clj:144)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_$fn__53456$fn__53457.invoke(setup.clj:167)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_$fn__53456.invoke(setup.clj:161)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_$fn__53481.invoke(db.clj:86)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:421)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:117)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG__STAR_.invoke(core.clj:98)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG_.invokeStatic(core.clj:170)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG_.invoke(core.clj:165)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$start_normally.invokeStatic(core.clj:182)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$start_normally.invoke(core.clj:176)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$entrypoint.invokeStatic(core.clj:215)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$entrypoint.doInvoke(core.clj:209)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:397)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.Var.applyTo(Var.java:705)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.core$apply.invokeStatic(core.clj:667)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.core$apply.invoke(core.clj:662)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:397)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap.main(Unknown Source)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: org.postgresql.util.PSQLException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 86 more\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: UPDATE SUMMARY\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Run:                         66\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Previously run:             287\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Filtered out:                50\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: -------------------------------\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Total change sets:          403\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: FILTERED CHANGE SETS SUMMARY\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: DBMS mismatch:               50\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,373 ERROR metabase.core :: Metabase Initialization FAILED\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: liquibase.exception.CommandExecutionException: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss:\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:      Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.CommandScope.execute(CommandScope.java:253)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.runInScope(Liquibase.java:1419)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:234)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:212)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:194)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__44483.invoke(liquibase.clj:360)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked$reify__44479.run(liquibase.clj:325)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:318)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:301)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:349)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:342)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_$fn__53428.invoke(setup.clj:84)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase$f_STAR___44420.invoke(liquibase.clj:140)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase.invokeStatic(liquibase.clj:143)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase.invoke(liquibase.clj:131)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_.invokeStatic(setup.clj:73)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_.doInvoke(setup.clj:55)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:425)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$run_schema_migrations_BANG_.invokeStatic(setup.clj:149)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$run_schema_migrations_BANG_.invoke(setup.clj:144)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_$fn__53456$fn__53457.invoke(setup.clj:167)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_$fn__53456.invoke(setup.clj:161)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_$fn__53481.invoke(db.clj:86)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:421)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:117)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG__STAR_.invoke(core.clj:98)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG_.invokeStatic(core.clj:170)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG_.invoke(core.clj:165)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$start_normally.invokeStatic(core.clj:182)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$start_normally.invoke(core.clj:176)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$entrypoint.invokeStatic(core.clj:215)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$entrypoint.doInvoke(core.clj:209)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:397)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.Var.applyTo(Var.java:705)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.core$apply.invokeStatic(core.clj:667)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.core$apply.invoke(core.clj:662)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:397)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap.main(Unknown Source)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss:\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:      Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:151)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.CommandScope.execute(CommandScope.java:217)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 58 more\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss:\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:      Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeSet.execute(ChangeSet.java:797)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:252)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:256)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 66 more\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 81 more\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: org.postgresql.util.PSQLException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 86 more\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,384 INFO metabase.core :: Metabase Shutting Down ...\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,389 INFO metabase.server :: Shutting Down Embedded Jetty Webserver\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,421 WARN db.liquibase :: ()\r\nAug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,426 INFO metabase.core :: Metabase Shutdown COMPLETE\r\nAug 17 12:04:27 ip-172-30-1-73 systemd[1]: metabase.service: Main process exited, code=exited, status=1/FAILURE\r\n░░ Subject: Unit process exited\r\n░░ Defined-By: systemd', 'created_at': datetime.datetime(2024, 8, 17, 16, 13, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2295228827, 'issue_id': 2471580838, 'author': 'paoliniluis', 'body': 'Use 50.20.3', 'created_at': datetime.datetime(2024, 8, 18, 11, 33, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2295233667, 'issue_id': 2471580838, 'author': 'perivamsi', 'body': 'We currently are not publishing links to patch releases. We should change that @iethree \r\n\r\nMeanwhile, @jonmarkgo please use this link to download the latest version which fixes this issue\r\n\r\n https://downloads.metabase.com/v0.50.20.5/metabase.jar', 'created_at': datetime.datetime(2024, 8, 18, 11, 51, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2295291005, 'issue_id': 2471580838, 'author': 'jonmarkgo', 'body': 'Thank you, that patch did indeed fix it!', 'created_at': datetime.datetime(2024, 8, 18, 14, 58, tzinfo=datetime.timezone.utc)}]","jonmarkgo (Issue Creator) on (2024-08-17 16:13:11 UTC): Alternate log for upgrading existing Metabase install (rather than fresh install):
Aug 17 12:03:44 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:03:44,574 INFO metabase.util :: Maximum memory available to JVM: 256.0 MB
Aug 17 12:03:51 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:03:51,414 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance.
Aug 17 12:03:51 ip-172-30-1-73 metabase[3222565]:  For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html
Aug 17 12:04:07 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:07,631 INFO driver.impl :: Registered abstract driver :sql
Aug 17 12:04:07 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:07,705 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql])
Aug 17 12:04:07 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:07,719 INFO metabase.util :: Load driver :sql-jdbc took 24.3 ms
Aug 17 12:04:07 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:07,721 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc])
Aug 17 12:04:08 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:08,482 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc])
Aug 17 12:04:08 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:08,589 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc])
Aug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:12,870 INFO metabase.core ::
Aug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: Metabase v0.50.20 (df82d58)
Aug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: Copyright © 2024 Metabase, Inc.
Aug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: Metabase Enterprise Edition extensions are NOT PRESENT.
Aug 17 12:04:12 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:12,906 INFO metabase.core :: Starting Metabase in STANDALONE mode
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:13,059 INFO metabase.server :: Launching Embedded Jetty Webserver with config:
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  {:port 7654, :host ""127.0.0.1""}
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:13,193 INFO metabase.core :: Starting Metabase version v0.50.20 (df82d58) ...
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:13,209 INFO metabase.core :: System info:
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  {""file.encoding"" ""UTF-8"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.runtime.name"" ""OpenJDK Runtime Environment"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.runtime.version"" ""11.0.11+9"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.vendor"" ""AdoptOpenJDK"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.vendor.url"" ""https://adoptopenjdk.net/"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.version"" ""11.0.11"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""java.vm.version"" ""11.0.11+9"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""os.name"" ""Linux"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""os.version"" ""6.8.0-1013-aws"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""user.language"" ""en"",
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]:  ""user.timezone"" ""America/New_York""}
Aug 17 12:04:13 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:13,217 INFO metabase.plugins :: Loading plugins in /home/metabase/plugins...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,066 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Vertica Driver due to required dependencies. Metabase requires the Vertica JDBC driver in order to connect to Vertica databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/vertica.html for more details.
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,075 INFO plugins.dependencies :: Metabase Vertica Driver dependency {:class com.vertica.jdbc.Driver} satisfied? false
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,078 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Vertica Driver""]
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,096 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :google...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,097 INFO driver.impl :: Registered abstract driver :google
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,207 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :snowflake...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,207 INFO driver.impl :: Registered driver :snowflake (parents: [:sql-jdbc])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,262 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :athena...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,264 INFO driver.impl :: Registered driver :athena (parents: [:sql-jdbc])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,293 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,294 INFO driver.impl :: Registered driver :druid
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,300 INFO plugins.dependencies :: Plugin 'Metabase BigQuery Driver' depends on plugin 'Metabase Google Drivers Shared Dependencies'
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,301 INFO plugins.dependencies :: Metabase BigQuery Driver dependency {:plugin Metabase Google Drivers Shared Dependencies} satisfied? true
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,302 WARN plugins.lazy-loaded-driver :: Warning: plugin manifest for :bigquery does not include connection properties
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,303 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :bigquery...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,303 INFO driver.impl :: Registered driver :bigquery (parents: [:sql :google])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,311 INFO plugins.dependencies :: Plugin 'Metabase Presto Driver' depends on plugin 'Presto Common Driver'
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,312 INFO plugins.dependencies :: Metabase Presto Driver dependency {:plugin Presto Common Driver} satisfied? false
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,313 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Presto Driver"" ""Metabase Vertica Driver""]
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,319 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlite...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,320 INFO driver.impl :: Registered driver :sqlite (parents: [:sql-jdbc])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,330 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :redshift...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,331 INFO driver.impl :: Registered driver :redshift (parents: [:postgres])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,374 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :bigquery-cloud-sdk...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,378 INFO driver.impl :: Registered driver :bigquery-cloud-sdk (parents: [:sql])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,392 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto-common...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,395 INFO driver.impl :: Registered abstract driver :presto-common
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,398 INFO plugins.dependencies :: Metabase Presto Driver dependency {:plugin Presto Common Driver} satisfied? true
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,404 DEBUG plugins.initialize :: Dependencies satisfied; these plugins will now be loaded: [""Metabase Presto Driver""]
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,405 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,407 INFO driver.impl :: Registered driver :presto (parents: [:presto-common])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,443 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid-jdbc...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,444 INFO driver.impl :: Registered driver :druid-jdbc (parents: [:sql-jdbc])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,471 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :mongo...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,473 INFO driver.impl :: Registered driver :mongo
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,491 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Oracle Driver due to required dependencies. Metabase requires the Oracle JDBC driver in order to connect to Oracle databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/oracle.html for more details.
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,494 INFO plugins.dependencies :: Metabase Oracle Driver dependency {:class oracle.jdbc.OracleDriver} satisfied? false
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,496 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Oracle Driver"" ""Metabase Vertica Driver""]
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,549 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto-jdbc...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,550 INFO driver.impl :: Registered driver :presto-jdbc (parents: [:sql-jdbc])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,625 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :googleanalytics...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,626 INFO driver.impl :: Registered driver :googleanalytics
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,639 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :hive-like...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,640 INFO driver.impl :: Registered abstract driver :hive-like (parents: [:sql-jdbc])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,641 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sparksql...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,641 INFO driver.impl :: Registered driver :sparksql (parents: [:hive-like])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,649 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlserver...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,651 INFO driver.impl :: Registered driver :sqlserver (parents: [:sql-jdbc])
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,687 INFO metabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...
Aug 17 12:04:15 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:15,691 INFO db.setup :: Verifying postgres Database Connection ...
Aug 17 12:04:17 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:17,070 INFO db.setup :: Successfully verified PostgreSQL 16.3 application database connection.
Aug 17 12:04:17 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:17,073 INFO db.setup :: Checking if a database downgrade is required...
Aug 17 12:04:20 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:20,483 INFO db.setup :: Running Database Migrations...
Aug 17 12:04:20 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:20,488 INFO db.setup :: Setting up Liquibase...
Aug 17 12:04:21 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:21,614 INFO db.setup :: Liquibase is ready.
Aug 17 12:04:21 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:21,614 INFO db.liquibase :: Checking if Database has unrun migrations...
Aug 17 12:04:24 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:24,068 INFO db.liquibase :: Database has unrun migrations. Checking if migration lock is taken...
Aug 17 12:04:24 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:24,170 INFO db.liquibase :: No migration lock found.
Aug 17 12:04:24 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:24,171 INFO db.liquibase :: Migration lock acquired.
Aug 17 12:04:25 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:25,406 INFO db.liquibase :: Running 66 migrations ...
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,095 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss encountered an exception.
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:252)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:256)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.CommandScope.execute(CommandScope.java:217)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.runInScope(Liquibase.java:1419)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:234)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:212)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:194)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__44483.invoke(liquibase.clj:360)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked$reify__44479.run(liquibase.clj:325)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:318)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:301)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:349)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:342)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_$fn__53428.invoke(setup.clj:84)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase$f_STAR___44420.invoke(liquibase.clj:140)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase.invokeStatic(liquibase.clj:143)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase.invoke(liquibase.clj:131)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_.invokeStatic(setup.clj:73)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_.doInvoke(setup.clj:55)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:425)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$run_schema_migrations_BANG_.invokeStatic(setup.clj:149)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$run_schema_migrations_BANG_.invoke(setup.clj:144)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_$fn__53456$fn__53457.invoke(setup.clj:167)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_$fn__53456.invoke(setup.clj:161)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_$fn__53481.invoke(db.clj:86)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:421)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:117)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG__STAR_.invoke(core.clj:98)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG_.invokeStatic(core.clj:170)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG_.invoke(core.clj:165)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$start_normally.invokeStatic(core.clj:182)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$start_normally.invoke(core.clj:176)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$entrypoint.invokeStatic(core.clj:215)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$entrypoint.doInvoke(core.clj:209)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:397)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.Var.applyTo(Var.java:705)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.core$apply.invokeStatic(core.clj:667)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.core$apply.invoke(core.clj:662)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:397)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap.main(Unknown Source)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: org.postgresql.util.PSQLException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 86 more
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: UPDATE SUMMARY
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Run:                         66
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Previously run:             287
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Filtered out:                50
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: -------------------------------
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Total change sets:          403
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: FILTERED CHANGE SETS SUMMARY
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: DBMS mismatch:               50
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,373 ERROR metabase.core :: Metabase Initialization FAILED
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: liquibase.exception.CommandExecutionException: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss:
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:      Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.CommandScope.execute(CommandScope.java:253)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.runInScope(Liquibase.java:1419)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:234)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:212)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Liquibase.update(Liquibase.java:194)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__44483.invoke(liquibase.clj:360)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked$reify__44479.run(liquibase.clj:325)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:318)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:301)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:349)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:342)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_$fn__53428.invoke(setup.clj:84)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase$f_STAR___44420.invoke(liquibase.clj:140)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase.invokeStatic(liquibase.clj:143)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.liquibase$do_with_liquibase.invoke(liquibase.clj:131)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_.invokeStatic(setup.clj:73)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$migrate_BANG_.doInvoke(setup.clj:55)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:425)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$run_schema_migrations_BANG_.invokeStatic(setup.clj:149)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$run_schema_migrations_BANG_.invoke(setup.clj:144)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_$fn__53456$fn__53457.invoke(setup.clj:167)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_$fn__53456.invoke(setup.clj:161)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_$fn__53481.invoke(db.clj:86)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:421)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:117)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG__STAR_.invoke(core.clj:98)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG_.invokeStatic(core.clj:170)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$init_BANG_.invoke(core.clj:165)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$start_normally.invokeStatic(core.clj:182)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$start_normally.invoke(core.clj:176)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$entrypoint.invokeStatic(core.clj:215)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.core$entrypoint.doInvoke(core.clj:209)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:397)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.Var.applyTo(Var.java:705)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.core$apply.invokeStatic(core.clj:667)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.core$apply.invoke(core.clj:662)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.invoke(RestFn.java:397)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.AFn.applyToHelper(AFn.java:152)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at clojure.lang.RestFn.applyTo(RestFn.java:132)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at metabase.bootstrap.main(Unknown Source)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss:
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:      Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:151)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.command.CommandScope.execute(CommandScope.java:217)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 58 more
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss:
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:      Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeSet.execute(ChangeSet.java:797)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.lambda$child$0(Scope.java:186)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:195)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:185)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:164)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:252)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.Scope.child(Scope.java:256)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 66 more
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 81 more
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: Caused by: org.postgresql.util.PSQLException: ERROR: permission denied: ""RI_ConstraintTrigger_c_1889113"" is a system trigger
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]:         ... 86 more
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,384 INFO metabase.core :: Metabase Shutting Down ...
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,389 INFO metabase.server :: Shutting Down Embedded Jetty Webserver
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,421 WARN db.liquibase :: ()
Aug 17 12:04:27 ip-172-30-1-73 metabase[3222565]: 2024-08-17 12:04:27,426 INFO metabase.core :: Metabase Shutdown COMPLETE
Aug 17 12:04:27 ip-172-30-1-73 systemd[1]: metabase.service: Main process exited, code=exited, status=1/FAILURE
░░ Subject: Unit process exited
░░ Defined-By: systemd

paoliniluis on (2024-08-18 11:33:38 UTC): Use 50.20.3

perivamsi on (2024-08-18 11:51:43 UTC): We currently are not publishing links to patch releases. We should change that @iethree 

Meanwhile, @jonmarkgo please use this link to download the latest version which fixes this issue

 https://downloads.metabase.com/v0.50.20.5/metabase.jar

jonmarkgo (Issue Creator) on (2024-08-18 14:58:00 UTC): Thank you, that patch did indeed fix it!

"
2471428806,issue,closed,not_planned,"0.50.20: on MariaDB 10.3, upgrade migration fails with `Mixing of GROUP columns (MIN(),MAX(),COUNT(),...) with no GROUP columns is illegal if there is no GROUP BY clause`","### Describe the bug

Attempted upgrading from 0.49.8 -> 0.50.20.

### To Reproduce

Unclear for now whether this is a general or my database state-specific bug.

### Expected behavior

Migrations complete successfully.

### Logs

```
θ74° 1d [leho@crdy:~]└2 $ ./metabase.sh                                                                                                                                                                                                   
Warning: environ value /etc/java-config-2/current-system-vm for key :java-home has been overwritten with /opt/openjdk-jre-bin-17                                                                                                                                                                                                                                                            
2024-08-17 11:05:00,165 INFO metabase.util :: Maximum memory available to JVM: 15,6 GB                                                  
2024-08-17 11:05:01,566 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance. 🔓                                                                                                                                                                                                                                                                     
 For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html                                                                         
2024-08-17 11:05:04,806 INFO driver.impl :: Registered abstract driver :sql  🚚                                                                                                                                                                                                 
2024-08-17 11:05:04,825 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql]) 🚚                                                                                         
2024-08-17 11:05:04,829 INFO metabase.util :: Load driver :sql-jdbc took 7,6 ms                                                         
2024-08-17 11:05:04,829 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc]) 🚚                                             
2024-08-17 11:05:04,984 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc]) 🚚                                          
2024-08-17 11:05:05,007 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc]) 🚚                                       
2024-08-17 11:05:06,088 INFO metabase.core ::                                                                                           
Metabase v0.50.20 (df82d58)                                                                                                             
                                                                                                                                        
Copyright © 2024 Metabase, Inc.                                                                                                         
                                                                                                                                        
Metabase Enterprise Edition extensions are NOT PRESENT.             
2024-08-17 11:05:06,094 INFO metabase.core :: Starting Metabase in STANDALONE mode                                                                                                            
2024-08-17 11:05:06,119 INFO metabase.server :: Launching Embedded Jetty Webserver with config:                                                                                               
 {:port 3301}                                                                  
                                                                                                                                                              
2024-08-17 11:05:06,148 INFO metabase.core :: Starting Metabase version v0.50.20 (df82d58) ...                                                                                                
2024-08-17 11:05:06,152 INFO metabase.core :: System info:                     
 {""file.encoding"" ""UTF-8"",                                                     
 ""java.runtime.name"" ""OpenJDK Runtime Environment"",                            
 ""java.runtime.version"" ""17.0.8.1+1"",                                          
 ""java.vendor"" ""Eclipse Adoptium"",                                             
 ""java.vendor.url"" ""https://adoptium.net/"",                                                                                                                   
 ""java.version"" ""17.0.8.1"",                                                                                                                                   
 ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",                                    
 ""java.vm.version"" ""17.0.8.1+1"",                                                               
 ""os.name"" ""Linux"",                                                                            
 ""os.version"" ""5.15.107-gentoo+"",                                                              
 ""user.language"" ""en"",                                                                                                                                                                        
 ""user.timezone"" ""Europe/Tallinn""}

...

2024-08-17 11:05:07,297 INFO db.setup :: Verifying mysql Database Connection ...                                                                                                                                                              
2024-08-17 11:05:08,265 INFO db.setup :: Successfully verified MariaDB 10.3.27-MariaDB-log application database connection. ✅                                                                                                                
2024-08-17 11:05:08,265 INFO db.setup :: Checking if a database downgrade is required...                                                                                                                                                      
2024-08-17 11:05:13,295 INFO db.setup :: Running Database Migrations...                                                
2024-08-17 11:05:13,460 INFO db.setup :: Setting up Liquibase...                                                                                                                                                                              
2024-08-17 11:05:17,668 INFO db.setup :: Liquibase is ready.                                                                                                                                                                                  
2024-08-17 11:05:17,669 INFO
 db.liquibase :: Checking if Database has unrun migrations...                                                                                                                                                     
2024-08-17 11:05:23,376 INFO db.liquibase :: Database has unrun migrations. Checking if migration lock is taken...                                                                                                                            
2024-08-17 11:05:24,333 INFO db.liquibase :: No migration lock found.                                                  
2024-08-17 11:05:24,333 INFO db.liquibase :: Migration lock acquired.                                                                                                                                                                         
2024-08-17 11:05:30,273 INFO db.liquibase :: Running 118 migrations ...                                                                                                                                                                       
2024-08-17 11:05:36,028 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v49.2024-05-07T10:00:00::qnkhuat encountered an exception.                                                                              
liquibase.exception.DatabaseException: (conn=17246455) Mixing of GROUP columns (MIN(),MAX(),COUNT(),...) with no GROUP columns is illegal if there is no GROUP BY clause [Failed SQL: (1140) UPDATE revision AS r JOIN (                      
    SELECT inner_revision.id,                                                                                                                                                                                                                 
          ROW_NUMBER() OVER (PARTITION BY inner_revision.model, inner_revision.model_id ORDER BY inner_revision.timestamp DESC, inner_revision.id DESC) AS row_num                                                                            
      FROM revision AS inner_revision                                                                                                                                                                                                         
      JOIN (                                                                                                                                                                                                                                  
            SELECT model, model_id                                                                                                                                                                                                            
            FROM revision                                                                                                                                                                                                                                                                                                                                                                   
            WHERE most_recent = true                                                                                                    
            GROUP BY model, model_id                                                                                                                                                                                                                                                                                                                                                        
            HAVING count(*) > 1                                                                                                                                                               
          ) AS infected_revision ON inner_revision.model = infected_revision.model AND inner_revision.model_id = infected_revision.model_id
) AS n ON r.id = n.id SET r.most_recent = (n.row_num = 1)]                                                                                                                                    
        at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)                            
        at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)                                                            
        at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)                                                           
        at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)                                                       
        at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)                                    
        at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)                                                                    
        at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)                                      
        at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)                                                       
        at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)                                             
        at liquibase.Scope.lambda$child$0(Scope.java:186)           
        at liquibase.Scope.child(Scope.java:195)                                                                                                                                              
        at liquibase.Scope.child(Scope.java:185)                                                                                                                                              
        at liquibase.Scope.child(Scope.java:164)                               
        at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)                                                                            
        at liquibase.Scope.lambda$child$0(Scope.java:186)                                                                                                                                     
        at liquibase.Scope.child(Scope.java:195)                               
        at liquibase.Scope.child(Scope.java:185)                               
        at liquibase.Scope.child(Scope.java:164)                               
        at liquibase.Scope.child(Scope.java:252)                               
        at liquibase.Scope.child(Scope.java:256)                               
        at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)                                                                               
        at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)                                                  
        at liquibase.Scope.lambda$child$0(Scope.java:186)                      
        at liquibase.Scope.child(Scope.java:195)                                               
        at liquibase.Scope.child(Scope.java:185)                                               
        at liquibase.Scope.child(Scope.java:164)                                               
        at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)                                                                                           
        at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)                                                                                                           
        at liquibase.command.CommandScope.execute(CommandScope.java:217)                                                                                                                      
        at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)                                                                                                                            
        at liquibase.Scope.lambda$child$0(Scope.java:186)                                                                                                                                                                                                                                                                                                                                   
        at liquibase.Scope.child(Scope.java:195)                                                                                                                                                                                                                                                                                                                                            
        at liquibase.Scope.child(Scope.java:185)                                                                                                                                                                                                                                                                                                                                            
        at liquibase.Scope.child(Scope.java:164)                                                                                                                                                                                                                                                                                                                                            
        at liquibase.Liquibase.runInScope(Liquibase.java:1419)                                                                                                                                                                                                                                                                                                                              
        at liquibase.Liquibase.update(Liquibase.java:234)                                                                                                                                                                                                                                                                                                                                   
        at liquibase.Liquibase.update(Liquibase.java:212)                                                                                                                                                                                                                                                                                                                                   
        at liquibase.Liquibase.update(Liquibase.java:194)                                                                                                                                                                                                                                                                                                                                   
        at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__44483.invoke(liquibase.clj:360)                                                                                                                                                                                                                                                                                             
        at metabase.db.liquibase$run_in_scope_locked$reify__44479.run(liquibase.clj:325)                                                                                                                                                                                                                                                                                                    
        at liquibase.Scope.lambda$child$0(Scope.java:186)                                                                                                                                                                                                                                                                                                                                   
        at liquibase.Scope.child(Scope.java:195)                                               
        at liquibase.Scope.child(Scope.java:185)                                               
        at liquibase.Scope.child(Scope.java:164)                                               
        at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:318)                                                                                                          
        at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:301)                                                                                                                
        at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:349)                                                                                                   
        at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:342)                                                                                                         
        at metabase.db.setup$migrate_BANG_$fn__53428.invoke(setup.clj:84)                                                                                                                     
        at metabase.db.liquibase$do_with_liquibase$f_STAR___44420.invoke(liquibase.clj:140)                                                                                                   
        at metabase.db.liquibase$do_with_liquibase.invokeStatic(liquibase.clj:143)                                                                                                            
        at metabase.db.liquibase$do_with_liquibase.invoke(liquibase.clj:131)                                                                                                                  
        at metabase.db.setup$migrate_BANG_.invokeStatic(setup.clj:73)                                                                                                                         
        at metabase.db.setup$migrate_BANG_.doInvoke(setup.clj:55)                                                                                                                             
        at clojure.lang.RestFn.invoke(RestFn.java:425)                                         
        at metabase.db.setup$run_schema_migrations_BANG_.invokeStatic(setup.clj:149)                                                                                                          
        at metabase.db.setup$run_schema_migrations_BANG_.invoke(setup.clj:144)                                                                                                                
        at metabase.db.setup$setup_db_BANG_$fn__53456$fn__53457.invoke(setup.clj:167)                                                                                                         
        at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)                                                                                                                      
        at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)                                                                                                                            
        at metabase.db.setup$setup_db_BANG_$fn__53456.invoke(setup.clj:161)                                                                                                                   
        at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:160)                                                                                                                       
        at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)                                                                                                                             
        at metabase.db$setup_db_BANG_$fn__53481.invoke(db.clj:86)                                                                                                                             
        at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)                                                                                                                                 
        at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)                                      
        at clojure.lang.RestFn.invoke(RestFn.java:421)                                         
        at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:117)                                                                                                                          
        at metabase.core$init_BANG__STAR_.invoke(core.clj:98)                                                                                                                                 
        at metabase.core$init_BANG_.invokeStatic(core.clj:170)                                                                                                                                
        at metabase.core$init_BANG_.invoke(core.clj:165)                                       
        at metabase.core$start_normally.invokeStatic(core.clj:182)                                                                                                                            
        at metabase.core$start_normally.invoke(core.clj:176)                                                                                                                                  
        at metabase.core$entrypoint.invokeStatic(core.clj:215)                                                                                                                                
        at metabase.core$entrypoint.doInvoke(core.clj:209)                                     
        at clojure.lang.RestFn.invoke(RestFn.java:397)                                         
        at clojure.lang.AFn.applyToHelper(AFn.java:152)                                        
        at clojure.lang.RestFn.applyTo(RestFn.java:132)                                        
        at clojure.lang.Var.applyTo(Var.java:705)                                              
        at clojure.core$apply.invokeStatic(core.clj:667)                                       
        at clojure.core$apply.invoke(core.clj:662)                                             
        at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)                                                                                                                            
        at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)                                                                                                                                
        at clojure.lang.RestFn.invoke(RestFn.java:397)                                         
        at clojure.lang.AFn.applyToHelper(AFn.java:152)                                        
        at clojure.lang.RestFn.applyTo(RestFn.java:132)                                        
        at metabase.bootstrap.main(Unknown Source)                                             
Caused by: java.sql.SQLSyntaxErrorException: (conn=17246455) Mixing of GROUP columns (MIN(),MAX(),COUNT(),...) with no GROUP columns is illegal if there is no GROUP BY clause                                                                                                                                                                                                              
        at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)                                                                               
        at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.create(ExceptionFactory.java:158)                                                                                       
        at org.mariadb.jdbc.MariaDbStatement.executeExceptionEpilogue(MariaDbStatement.java:262)                                                                                              
        at org.mariadb.jdbc.MariaDbStatement.executeInternal(MariaDbStatement.java:362)                                                                                                       
        at org.mariadb.jdbc.MariaDbStatement.execute(MariaDbStatement.java:500)                                                                                                               
        at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)                                                                                                      
        at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)                                                                                  
        ... 86 more
Caused by: org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException: Mixing of GROUP columns (MIN(),MAX(),COUNT(),...) with no GROUP columns is illegal if there is no GROUP BY clause                                                                                                                                                                                                 
        at org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException.of(MariaDbSqlException.java:34)                                                                                      
        at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.exceptionWithQuery(AbstractQueryProtocol.java:195)                                                                        
        at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:263)                                                                              
        at org.mariadb.jdbc.MariaDbStatement.executeInternal(MariaDbStatement.java:356)                                                                                                       
        ... 89 more                                                                            
Caused by: java.sql.SQLException: Mixing of GROUP columns (MIN(),MAX(),COUNT(),...) with no GROUP columns is illegal if there is no GROUP BY clause                                                                                                                                                                                                                                         
        at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readErrorPacket(AbstractQueryProtocol.java:1693)                                                                          
        at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readPacket(AbstractQueryProtocol.java:1555)                                                                               
        at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.getResult(AbstractQueryProtocol.java:1518)                                                                                
        at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:257)                                                                              
        ... 90 more                                                                            

UPDATE SUMMARY                                                                                 
Run:                        118                                                                
Previously run:             280                                                                
Filtered out:                 5                                                                
-------------------------------                                                                
Total change sets:          403                                                                


FILTERED CHANGE SETS SUMMARY                                                                   
DBMS mismatch:                5

...

2024-08-17 11:05:40,916 INFO metabase.core :: Metabase Shutting Down ...
2024-08-17 11:05:40,917 INFO metabase.server :: Shutting Down Embedded Jetty Webserver
2024-08-17 11:05:40,921 WARN db.liquibase :: ()
2024-08-17 11:05:40,921 INFO metabase.core :: Metabase Shutdown COMPLETE
```

### Information about your Metabase installation

```JSON
- Gentoo Linux
- Metabase 0.50.20
- Metabase internal database: MariaDB
```


### Severity

Blocking an upgrade

### Additional context

I'm unclear whether it's safe to re-run 0.49.8 jar now, while this bug report is triaged?",lkraav,2024-08-17 08:25:25+00:00,[],2024-08-19 07:49:38+00:00,2024-08-18 13:40:52+00:00,https://github.com/metabase/metabase/issues/46947,"[('Type:Bug', 'Product defects')]","[{'comment_id': 2295267971, 'issue_id': 2471428806, 'author': 'paoliniluis', 'body': ""you can't go back unless you restore a backup of your database. MariaDB 10.3 is not compatible with Metabase, as we dropped compatibility of MySQL 5.7 a while ago. You need to move to the latest MariaDB version and then migrate Metabase to v50"", 'created_at': datetime.datetime(2024, 8, 18, 13, 40, 46, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-08-18 13:40:46 UTC): you can't go back unless you restore a backup of your database. MariaDB 10.3 is not compatible with Metabase, as we dropped compatibility of MySQL 5.7 a while ago. You need to move to the latest MariaDB version and then migrate Metabase to v50

"
2470828049,issue,open,,"Custom or more SQL styles for ""format query button"" (starting with Holywell)","**Is your feature request related to a problem? Please describe.**
Our team formats our SQL in a [Simon Holywell-style format](https://sqlstyle.guide).  We'd like a way to format our SQL in that way when hitting the Format button in the editor.

**Describe the solution you'd like**
* Add a Formatting selector in the Admin panel with the following options
  * ""Default style"" (the current Metabase styling)
  * ""Holywell style"" (or something akin to it)
* When the user clicks on the ""Format query"" button in the editor, it uses the formatter selected in the Admin panel

**Describe alternatives you've considered**
Right now we format our SQL by hand as we write it.
There are online formatters, but we are uncomfortable about pasting our queries into an external site

**How important is this feature to you?**
Kinda important - We can still format our SQL by hand

**Additional context**
It'd ideally be nice to have a way to define whatever style you like (tabs, spacing, caps, alignment, etc) and have pre-loaded options for Metabase style and Holywell-style
",anoakie,2024-08-16 19:19:20+00:00,[],2025-02-04 20:30:28+00:00,,https://github.com/metabase/metabase/issues/46941,"[('Type:New Feature', ''), ('Querying/Native', 'The SQL/native query editor')]",[],
2470597773,issue,closed,completed,Unclear error message when attempting to edit user email to an email that already exists in Metabase,"### Describe the bug

If you try to edit a user and put an email that belongs to someone who is already a user in Metabase, the error message that Metabase gives you is very unclear (`n.user is undefined`):
![image](https://github.com/user-attachments/assets/2912e2cf-7111-4a29-bf68-08841582c94e)
I imagine in orgs with hundreds of users, it'll be difficult to figure out what the actual error is.

### To Reproduce

1. Add at least two users by email 
2. Edit one of the users to have the same email as an already existing user
3. Click update



### Expected behavior

A clear error message, like the one you get when _adding_ (instead of updating) a user with an already existing email:
![image](https://github.com/user-attachments/assets/c0b84416-589b-400b-8d31-d219d24cf703)


### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:129.0) Gecko/20100101 Firefox/129.0"",
    ""vendor"": """"
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.6.12-linuxkit"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.1 (Debian 16.1-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-08-13"",
      ""tag"": ""v1.50.20"",
      ""hash"": ""df82d58""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

P3

### Additional context


https://github.com/user-attachments/assets/19e55718-f54c-4e59-8b2a-426829583c14

",alexyarosh,2024-08-16 16:39:36+00:00,[],2024-08-19 07:41:20+00:00,2024-08-19 07:40:58+00:00,https://github.com/metabase/metabase/issues/46938,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Administration/People', 'and Groups. Also user Account Settings'), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2295875609, 'issue_id': 2470597773, 'author': 'kamilmielnik', 'body': 'Duplicate of #46449, closing.', 'created_at': datetime.datetime(2024, 8, 19, 7, 40, 58, tzinfo=datetime.timezone.utc)}]","kamilmielnik on (2024-08-19 07:40:58 UTC): Duplicate of #46449, closing.

"
2470355040,issue,closed,completed,"When there's a filter after Summarize, you lose drill in on tables","### Describe the bug

When there's a filter after summarize, you lose drill in 

### To Reproduce

1.  Using Sample Database create this question:
<img width=""877"" alt=""image"" src=""https://github.com/user-attachments/assets/fd451bce-bdfd-4a8f-9af2-d8980169ac67"">
2.  Run it.  Try to drill into the records.  You can't 
Question works fine without the filter

### Expected behavior

I should be able to drill in

### Logs

_No response_

### Information about your Metabase installation

```JSON
on stats on Aug 16

Built on 2024-08-16

Hash: b9ba40d
```


### Severity

P1.  Incredibly annoying.  I'm now having to create a second question to get the data I need to answer a question for product

### Additional context

Here's an already done for you sample on stats:  https://stats.metabase.com/question/19194-cant-drill-in-when-theres-a-filter-after-summarization

And here's my real-life situation where I was trying to do this:  https://stats.metabase.com/question/19189-bugs-and-features-mentioned-by-enterprise-customers
and a loom showing you how I can't drill in:  https://www.loom.com/share/1e9dbc36f2254357967c8f75ad16f69f?sid=cc795db7-9a1b-44ee-a04e-441102a4b0af",cbalusek,2024-08-16 14:09:38+00:00,['appleby'],2025-01-15 19:08:24+00:00,2025-01-15 16:02:00+00:00,https://github.com/metabase/metabase/issues/46932,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/MBQL', ''), ('.Backend', ''), ('Querying/Drill Thrus', 'Refining existing queries with Drill Thrus'), ('.Team/Querying', '')]","[{'comment_id': 2298198537, 'issue_id': 2470355040, 'author': 'kamilmielnik', 'body': '> Question works fine without the filter\r\n\r\nAdding the filter adds 2nd stage to the query. With that extra stage `Lib.availableDrillThrus` does not return the drill anymore. \r\nI removed the Frontend label.\r\n\r\nIt probably always worked like that (at least since 0.46).', 'created_at': datetime.datetime(2024, 8, 20, 7, 49, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2321325101, 'issue_id': 2470355040, 'author': 'mngr', 'body': ""We discussed that fixing all the possible drills would require a lot of work and this never worked I suppose, so it's a new feature and we'll describe and plan it properly"", 'created_at': datetime.datetime(2024, 8, 30, 13, 49, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2321369067, 'issue_id': 2470355040, 'author': 'cbalusek', 'body': ""I spent more time testing this. Drill in works fine if it's a bar chart but not when it's a table.  If it works for some visualization types and not others, it's a bug.\r\n\r\nHere's a duplicate of question I linked to before in stats, but now it's a bar chart.  https://stats.metabase.com/question/19399-cant-drill-in-when-theres-a-filter-after-summarization-if-its-a-table-but-works-in-bar"", 'created_at': datetime.datetime(2024, 8, 30, 14, 4, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2324908061, 'issue_id': 2470355040, 'author': 'NevRA', 'body': '@ranquild wdyt is it BE or FE?', 'created_at': datetime.datetime(2024, 9, 2, 14, 43, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2338947899, 'issue_id': 2470355040, 'author': 'ranquild', 'body': 'So the problem is that `underlying-records` drill works in this case for line/area/bar charts but not for the raw table. The question on stats where it can be confirmed https://stats.metabase.com/question/19399-cant-drill-in-when-theres-a-filter-after-summarization-if-its-a-table-but-works-in-bar.\r\n\r\nThe underlying problem seems to be in how we check for `:lib/source` https://github.com/metabase/metabase/blob/d9961ef0bb775e6eab66c5fd7794c56eedb73f74/src/metabase/lib/drill_thru/underlying_records.cljc#L76. We should try to find the corresponding `:source/aggregations` column in the previous stage as well. Presumably there are similar issues with other drills that rely on `:lib/source`.', 'created_at': datetime.datetime(2024, 9, 9, 19, 47, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2455662478, 'issue_id': 2470355040, 'author': 'PetroKudriavtsev', 'body': 'It is an important topic for us to', 'created_at': datetime.datetime(2024, 11, 4, 20, 42, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2557935441, 'issue_id': 2470355040, 'author': 'appleby', 'body': 'Status update on the affected drills:\n\n(edit: updated with currrent status)\n\n- Fixed\n  - #50556\n  - #51247\n  - #50970\n  - #51553\n  - #51489\n  - #51608\n  - #51807\n  - #51891\n  - #51950\n- Follow ons\n  - #52129', 'created_at': datetime.datetime(2024, 12, 21, 1, 20, tzinfo=datetime.timezone.utc)}]","kamilmielnik on (2024-08-20 07:49:44 UTC): Adding the filter adds 2nd stage to the query. With that extra stage `Lib.availableDrillThrus` does not return the drill anymore. 
I removed the Frontend label.

It probably always worked like that (at least since 0.46).

mngr on (2024-08-30 13:49:45 UTC): We discussed that fixing all the possible drills would require a lot of work and this never worked I suppose, so it's a new feature and we'll describe and plan it properly

cbalusek (Issue Creator) on (2024-08-30 14:04:01 UTC): I spent more time testing this. Drill in works fine if it's a bar chart but not when it's a table.  If it works for some visualization types and not others, it's a bug.

Here's a duplicate of question I linked to before in stats, but now it's a bar chart.  https://stats.metabase.com/question/19399-cant-drill-in-when-theres-a-filter-after-summarization-if-its-a-table-but-works-in-bar

NevRA on (2024-09-02 14:43:02 UTC): @ranquild wdyt is it BE or FE?

ranquild on (2024-09-09 19:47:22 UTC): So the problem is that `underlying-records` drill works in this case for line/area/bar charts but not for the raw table. The question on stats where it can be confirmed https://stats.metabase.com/question/19399-cant-drill-in-when-theres-a-filter-after-summarization-if-its-a-table-but-works-in-bar.

The underlying problem seems to be in how we check for `:lib/source` https://github.com/metabase/metabase/blob/d9961ef0bb775e6eab66c5fd7794c56eedb73f74/src/metabase/lib/drill_thru/underlying_records.cljc#L76. We should try to find the corresponding `:source/aggregations` column in the previous stage as well. Presumably there are similar issues with other drills that rely on `:lib/source`.

PetroKudriavtsev on (2024-11-04 20:42:25 UTC): It is an important topic for us to

appleby (Assginee) on (2024-12-21 01:20:00 UTC): Status update on the affected drills:

(edit: updated with currrent status)

- Fixed
  - #50556
  - #51247
  - #50970
  - #51553
  - #51489
  - #51608
  - #51807
  - #51891
  - #51950
- Follow ons
  - #52129

"
2470320276,issue,open,,Track QueryTable dependencies for wildcards in structured queries,"### Description

Currently we do not track implicit field dependencies for ""all"" selects (the default) in structured queries. This means we are not detecting the corresponding table dependencies. This means that we will not detect the associated bad references.

Currently we use `mbql.u/referenced-field-ids` and `lib.util/referenced-field-ids` to get the explicit field dependencies. We either need a new API to let us know which tables we're selecting everything from. 

Here are some suggestions for what that the new MBQL interface function could look like:

```clojure
;; consistent API with native query analyzer
(defn implicit-field-ids [query]
  [table-1-field-1-id
   table-1-field-2-id
   table-2-field-1-id
   ...])

;; all the tables (incl joins, referenced models, etc) for which we read every field. 
;; we are going to end up querying all the fields again anyway, so perhaps its more efficient to have this
(defn wildcard-table-ids [query]
  [table-1-id table-2-id ...])

;; a bit more comprehensive, although the ""false"" records will be redundant with the `referenced-field-ids`.
(defn table-references [query]
  [{:id table-1-id, :select-all true}
   {:id table-2-id, :select-all false}
   ...])
```",crisptrutski,2024-08-16 13:50:22+00:00,[],2025-02-04 20:27:14+00:00,,https://github.com/metabase/metabase/issues/46929,"[('Querying/MBQL', '')]",[],
2470317706,issue,closed,completed,"To view scrollbars in pivot viz in dashboard you must first scroll ""outer"" scrollbars","### Describe the bug

When I put a pivot in a dashboard, I can't scroll columns and rows normally (verified in Chrome)
There are in fact an horizontal and a vertical scrollbar, which I must scroll (respectively) right and down, to see the ""real"" pivot scrollbars.
The two ""outer"" scrollbars get generated even if the pivot doesn't need scrolling.
![image](https://github.com/user-attachments/assets/6369231e-f368-41c5-a132-2db2167ee65d)
![image](https://github.com/user-attachments/assets/b11bfc95-b3a1-4f79-b38e-0c8ae41c98fb)


### To Reproduce

1. Go to dashboard
2. Click on edit dashboard, add questions -> examples -> orders according to sources per quarter
4. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
Browsing on Chrome 127.0.6533.120 (Windows 11)
Metabase v0.50.20 on Docker container running on Ubuntu 24.04
Metabase internal DB: Postgres on Docker container running on Ubuntu 24.04
Database: Citus on Docker container running on Ubuntu 24.04
```


### Severity

Can't show dashboard with pivot viz to customers

### Additional context

_No response_",ilvenini,2024-08-16 13:48:53+00:00,['alxnddr'],2024-08-22 16:34:43+00:00,2024-08-22 15:55:49+00:00,https://github.com/metabase/metabase/issues/46928,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/Tables', 'raw, summarized and tabular visualizations'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2299062899, 'issue_id': 2470317706, 'author': 'cdeweyx', 'body': ""Can't repro on Mac [here](https://stats.metabase.com/dashboard/644-email-subscriptions-all-the-charts?month_and_year=&tab=576-tab-1), seems specific to Linux"", 'created_at': datetime.datetime(2024, 8, 20, 14, 54, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2299082127, 'issue_id': 2470317706, 'author': 'cdeweyx', 'body': 'Not closely related but found this as well during repro: https://github.com/metabase/metabase/issues/47019', 'created_at': datetime.datetime(2024, 8, 20, 15, 2, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2301832063, 'issue_id': 2470317706, 'author': 'ilvenini', 'body': ""Tried downgrading to v.0.49.0 (using the same setup) and I didn't encounter the bug: pivot was working as expected.\r\nThen went back again to v0.50.20 and the bug came back."", 'created_at': datetime.datetime(2024, 8, 21, 11, 33, 45, tzinfo=datetime.timezone.utc)}]","cdeweyx on (2024-08-20 14:54:52 UTC): Can't repro on Mac [here](https://stats.metabase.com/dashboard/644-email-subscriptions-all-the-charts?month_and_year=&tab=576-tab-1), seems specific to Linux

cdeweyx on (2024-08-20 15:02:18 UTC): Not closely related but found this as well during repro: https://github.com/metabase/metabase/issues/47019

ilvenini (Issue Creator) on (2024-08-21 11:33:45 UTC): Tried downgrading to v.0.49.0 (using the same setup) and I didn't encounter the bug: pivot was working as expected.
Then went back again to v0.50.20 and the bug came back.

"
2470280685,issue,closed,completed,Date filters don't cast correct timezone type when filtering by Snowflake timestamp_tz columns,"### Describe the bug

Date filters don't cast correct timezone type when filtering by Snowflake timestamp_tz columns
Happening on 1.50.20

### To Reproduce




Using a Snowflake table such as the following:
```
CREATE TABLE user_travel (
    user_id INTEGER,
    travel_start_time_tz TIMESTAMP_TZ,
    travel_end_time_tz TIMESTAMP_TZ,
    travel_start_time TIMESTAMP,
    travel_end_time TIMESTAMP,
    destination VARCHAR,
    travel_mode VARCHAR
);
```


Filtering **travel_start_time_tz** by a specific date would generate the following:

<img width=""1433"" alt=""Screenshot 2024-08-16 at 7 45 08 AM"" src=""https://github.com/user-attachments/assets/3f37227c-6b85-43e8-8e1a-645c29fb74df"">



<br>
<br>

Filtering **travel_start_time_tz** by “Yesterday” would generate the following:

<img width=""1433"" alt=""Screenshot 2024-08-16 at 7 45 33 AM"" src=""https://github.com/user-attachments/assets/30875ef7-4fa4-4483-a5e7-3704de0412ea"">



Which can cause unintended data to appear or be missing depending on the timestamp value.



### Expected behavior

For Snowflake columns that are of TIMESTAMP_TZ type to be casted as such in Metabase.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.22+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.22"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.22+7"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""14.5"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Chicago""
  },
  ""metabase-info"": {
    ""databases"": [
      ""snowflake"",
      ""h2"",
      ""postgres"",
      ""bigquery-cloud-sdk"",
      ""athena"",
      ""sqlserver"",
      ""mysql""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.3""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-08-13"",
      ""tag"": ""v1.50.20"",
      ""hash"": ""df82d58""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

P1 - data correctness

### Additional context

_No response_",FilmonK,2024-08-16 13:28:40+00:00,['lbrdnk'],2024-08-26 12:10:04+00:00,2024-08-26 10:36:16+00:00,https://github.com/metabase/metabase/issues/46924,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Correctness', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('Database/Snowflake', ''), ('.Backend', ''), ('.Escalation', ''), ('.Team/Querying', '')]","[{'comment_id': 2295974746, 'issue_id': 2470280685, 'author': 'lbrdnk', 'body': ""I think we'd need adjust cast in [`maybe-cacheable-relative-datetime-honeysql`](https://github.com/metabase/metabase/blob/23725b4e9dcde164294b34966d3246ea3a909d08/src/metabase/query_processor/util/relative_datetime.clj#L24). That function transforms `:relative-datetime` to honeysql. `:relative-datetime` just generates timestamp and has no information about the type of the column used in comparison.\r\n\r\nYesterday filter is sent as `[:time-interval <field> <amount> <unit>]` from FE, where the required type information is available."", 'created_at': datetime.datetime(2024, 8, 19, 8, 28, tzinfo=datetime.timezone.utc)}]","lbrdnk (Assginee) on (2024-08-19 08:28:00 UTC): I think we'd need adjust cast in [`maybe-cacheable-relative-datetime-honeysql`](https://github.com/metabase/metabase/blob/23725b4e9dcde164294b34966d3246ea3a909d08/src/metabase/query_processor/util/relative_datetime.clj#L24). That function transforms `:relative-datetime` to honeysql. `:relative-datetime` just generates timestamp and has no information about the type of the column used in comparison.

Yesterday filter is sent as `[:time-interval <field> <amount> <unit>]` from FE, where the required type information is available.

"
2470266058,issue,open,,Incomplete type for `User`,"We have a `BaseUser` and `User` interfaces defined in:
https://github.com/metabase/metabase/blob/master/frontend/src/metabase-types/api/user.ts

Neither are matching the actual schema for the user.
One crucial key that's missing is `group_ids`. There might be more.

Call `GET /api/user` and check the schema.",nemanjaglumac,2024-08-16 13:20:14+00:00,[],2025-02-04 20:29:49+00:00,,https://github.com/metabase/metabase/issues/46923,"[('Type:Tech Debt', 'or Refactoring'), ('Misc/API', ''), ('.Frontend', ''), (':broom:', 'no-brainer cleanup issues to clear out when you have an hour left until EoD or something'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2470194840,issue,closed,completed,Pivot table totals broken when grouping by foreign key with display value,"### Describe the bug

When a question groups values by a foreign key column and that column has `Use foreign key` selected in the `Display values` setting of the field settings in `Table metadata`, the question will no longer correctly work when visualized as `Pivot Table` . 

The grand totals will be missing from the first column making them wrong on questions with multiple columns or leaving them completely empty if only a single column exists.  


### To Reproduce

1. Open the admin
2. Click on Table Metadata
3. Select the Sample Database
4. Select ""Orders""
5. Scroll to ""Product ID""
6. Click on the gear icon to the right
7. Scroll to ""Display values""
8. Select ""Use foreign key"" > ""Title""
9. Create a new question
10. Use ""Sample Database"" -> ""Orders""
11. Under ""Summarize"" select ""Sum of"", then ""total""
12. Under ""pick column to group by"" select ""Product ID"" below the ""Order"" heading. **Take care not to use Product directly, this will not trigger the bug**
13. Click ""row limit"", Enter ""3"". This isn't required, but otherwise you'll have to scroll a lot to see the bug.
14. Click ""Visualize""
15. Click ""Visualization""
16. Select ""Pivot table""
17. Observe the Grand totals row being completely empty.


### Expected behavior

The total should be visible

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8-post-Debian-2deb11u1"",
    ""java.vendor"": ""Debian"",
    ""java.vendor.url"": ""https://tracker.debian.org/openjdk-11"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8-post-Debian-2deb11u1"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.0-31-amd64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.8 (Debian 15.8-0+deb12u1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-13"",
      ""tag"": ""v0.50.20"",
      ""hash"": ""df82d58""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

blocking some users, a lot of existing pivot tables are now broken

### Additional context

_No response_",RaphaelKimmig,2024-08-16 12:37:24+00:00,['metamben'],2024-10-01 22:17:28+00:00,2024-09-05 17:55:49+00:00,https://github.com/metabase/metabase/issues/46919,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations'), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Team/Querying', '')]","[{'comment_id': 2302887653, 'issue_id': 2470194840, 'author': 'ranquild', 'body': 'Marking as FE to investigate. Most likely BE in the end', 'created_at': datetime.datetime(2024, 8, 21, 19, 45, 18, tzinfo=datetime.timezone.utc)}]","ranquild on (2024-08-21 19:45:18 UTC): Marking as FE to investigate. Most likely BE in the end

"
2469987673,issue,closed,completed,Custom Map loading fails with Exception,"### Describe the bug

Loading a custom Map in GeoJSON format throws a NullPointerException.

I tried to reference the json file in several ways:
- by an online accessible url
- by a separate webserver in my reverse dns environment
- by a webserver in the same compose project, so directly accessible via the container hostname

All of the above ways have been verified by using either the browser or curl in the metabase container directly. All the files are accessible and valid geoJSON. I have created them using geojson.io. 

<details>
  <summary>Here is the content of the geoJSON file for reference.</summary>

```JSON
{
  ""type"": ""FeatureCollection"",
  ""features"": [
    {
      ""type"": ""Feature"",
      ""properties"": {
        ""query"": ""Alsterplatz 1, 38120 Braunschweig""
      },
      ""geometry"": {
        ""coordinates"": [
          [
            [
              10.477572287272466,
              52.25098587259771
            ],
            [
              10.477572287272466,
              52.25087881058326
            ],
            [
              10.477856466493336,
              52.25087881058326
            ],
            [
              10.477856466493336,
              52.25098587259771
            ],
            [
              10.477572287272466,
              52.25098587259771
            ]
          ]
        ],
        ""type"": ""Polygon""
      },
      ""id"": 0
    }
  ]
}
```

</details>

When I click `Load` in the respective modal the interface gives `An error occured` and the log shows a `NullPointerException`with a long trace.

<details>
<summary>Click to expand full exception trace.</summary>

```Java
type java.lang.NullPointerException, 
:at 
[clojure.string$starts_with_QMARK_ invokeStatic ""string.clj"" 365]
[clojure.string$starts_with_QMARK_ invokeStatic ""string.clj"" 365]
[clojure.string$starts_with_QMARK_ invoke ""string.clj"" 361]
[metabase.api.geojson$url__GT_geojson$fn__86890 invoke ""geojson.clj"" 143]
[clojure.core$some invokeStatic ""core.clj"" 2718]
[clojure.core$some invoke ""core.clj"" 2709]
[metabase.api.geojson$url__GT_geojson invokeStatic ""geojson.clj"" 143]
[metabase.api.geojson$url__GT_geojson invoke ""geojson.clj"" 129]
[metabase.api.geojson$url__GT_reader invokeStatic ""geojson.clj"" 157]
[metabase.api.geojson$url__GT_reader invoke ""geojson.clj"" 154]
[metabase.api.geojson$read_url_and_respond invokeStatic ""geojson.clj"" 162]
[metabase.api.geojson$read_url_and_respond invoke ""geojson.clj"" 159]
[metabase.api.geojson$fn__86905$fn__86907 invoke ""geojson.clj"" 193]
[compojure.response$fn__52195 invokeStatic ""response.clj"" 70]
[compojure.response$fn__52195 invoke ""response.clj"" 67]
[compojure.response$fn__52153$G__52148__52164 invoke ""response.clj"" 17]
[compojure.response$send invokeStatic ""response.clj"" 27]
[compojure.response$send invoke ""response.clj"" 22]
[compojure.core$wrap_response$fn__52963 invoke ""core.clj"" 160]
[compojure.core$wrap_route_middleware$fn__52947 invoke ""core.clj"" 132]
[compojure.core$wrap_route_info$fn__52952 invoke ""core.clj"" 139]
[compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 151]
[clojure.lang.Var invoke ""Var.java"" 393]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
[clojure.lang.Var invoke ""Var.java"" 393]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
[compojure.core$make_context$handler__53003 invoke ""core.clj"" 290]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 300]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
[clojure.lang.Var invoke ""Var.java"" 393]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[metabase.api.routes$fn__104860$fn__104863 invoke ""routes.clj"" 73]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
[clojure.lang.AFn applyToHelper ""AFn.java"" 160]
[clojure.lang.AFn applyTo ""AFn.java"" 144]
[clojure.core$apply invokeStatic ""core.clj"" 667]
[clojure.core$apply invoke ""core.clj"" 662]
[metabase.server.routes$fn__105140$fn__105141 doInvoke ""routes.clj"" 73]
[clojure.lang.RestFn invoke ""RestFn.java"" 436]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
[compojure.core$make_context$handler__53003 invoke ""core.clj"" 290]
[compojure.core$make_context$fn__53007 invoke ""core.clj"" 300]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 153]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
[metabase.server.routes$fn__105123$fn__105125 invoke ""routes.clj"" 47]
[compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
[compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
[metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__101254 invoke ""exceptions.clj"" 107]
[metabase.server.middleware.exceptions$catch_api_exceptions$fn__101251 invoke ""exceptions.clj"" 96]
[metabase.server.middleware.log$log_api_call$fn__105420$fn__105421$fn__105422 invoke ""log.clj"" 236]
[metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]
[metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
[metabase.server.middleware.log$log_api_call$fn__105420$fn__105421 invoke ""log.clj"" 227]
[toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
[toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
[metabase.server.middleware.log$log_api_call$fn__105420 invoke ""log.clj"" 226]
[metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__108690 invoke ""browser_cookie.clj"" 40]
[metabase.server.middleware.security$add_security_headers$fn__101210 invoke ""security.clj"" 241]
[ring.middleware.json$wrap_json_body$fn__108949 invoke ""json.clj"" 64]
[metabase.server.middleware.offset_paging$handle_paging$fn__87456 invoke ""offset_paging.clj"" 43]
[metabase.server.middleware.json$wrap_streamed_json_response$fn__54570 invoke ""json.clj"" 83]
[ring.middleware.keyword_params$wrap_keyword_params$fn__109038 invoke ""keyword_params.clj"" 55]
[ring.middleware.params$wrap_params$fn__109057 invoke ""params.clj"" 77]
[metabase.server.middleware.misc$maybe_set_site_url$fn__70690 invoke ""misc.clj"" 60]
[metabase.server.middleware.session$reset_session_timeout$fn__77777 invoke ""session.clj"" 552]
[metabase.server.middleware.session$bind_current_user$fn__77743$fn__77744 invoke ""session.clj"" 446]
[metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 425]
[metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 408]
[metabase.server.middleware.session$bind_current_user$fn__77743 invoke ""session.clj"" 445]
[metabase.server.middleware.session$wrap_current_user_info$fn__77722 invoke ""session.clj"" 383]
[metabase.server.middleware.session$wrap_session_id$fn__77694 invoke ""session.clj"" 259]
[metabase.server.middleware.auth$wrap_static_api_key$fn__97292 invoke ""auth.clj"" 32]
[ring.middleware.cookies$wrap_cookies$fn__108877 invoke ""cookies.clj"" 200]
[metabase.server.middleware.misc$add_content_type$fn__70672 invoke ""misc.clj"" 28]
[metabase.server.middleware.misc$disable_streaming_buffering$fn__70698 invoke ""misc.clj"" 77]
[ring.middleware.gzip$wrap_gzip$fn__108919 invoke ""gzip.clj"" 86]
[metabase.server.middleware.misc$bind_request$fn__70701 invoke ""misc.clj"" 94]
[metabase.server.middleware.ssl$redirect_to_https_middleware$fn__108706 invoke ""ssl.clj"" 41]
[metabase.server$async_proxy_handler$fn__71036 invoke ""server.clj"" 77]
[metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
[org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
[org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
[org.eclipse.jetty.server.Server handle ""Server.java"" 563]
[org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
[org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
[org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
[org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
[org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
[org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
[org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
[org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
[org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
[org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
[org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
[org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
[org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
[org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
[org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
[java.lang.Thread run nil -1]
```
</details>

### To Reproduce

1. Go to Admin > Maps
2. Click on ""Add a Map""
3. Enter name and URL
4. Click on ""Load""
5. See error

<img width=""1553"" alt=""image"" src=""https://github.com/user-attachments/assets/5e861027-fb03-4992-9b44-e65ceecefcdf"">

### Expected behavior

The map should load

### Logs

### Browser Logs:

```
[Error] Failed to load resource: the server responded with a status of 500 (Internal Server Error) (geojson, line 0)
```

### Metabase Logs

```
[b28fdb68-0fd9-4825-a073-44c8ad8b28d9] 2024-08-16T12:28:30+02:00 ERROR metabase.server.middleware.log GET /api/geojson 500 26.8 ms (0 DB calls) {:metabase-user-id 1} 
{:via [{:type java.lang.NullPointerException, :at [clojure.string$starts_with_QMARK_ invokeStatic ""string.clj"" 365]}],
 :trace
 [[clojure.string$starts_with_QMARK_ invokeStatic ""string.clj"" 365]
  [clojure.string$starts_with_QMARK_ invoke ""string.clj"" 361]
  [metabase.api.geojson$url__GT_geojson$fn__86890 invoke ""geojson.clj"" 143]
  [clojure.core$some invokeStatic ""core.clj"" 2718]
  [clojure.core$some invoke ""core.clj"" 2709]
  [metabase.api.geojson$url__GT_geojson invokeStatic ""geojson.clj"" 143]
  [metabase.api.geojson$url__GT_geojson invoke ""geojson.clj"" 129]
  [metabase.api.geojson$url__GT_reader invokeStatic ""geojson.clj"" 157]
  [metabase.api.geojson$url__GT_reader invoke ""geojson.clj"" 154]
  [metabase.api.geojson$read_url_and_respond invokeStatic ""geojson.clj"" 162]
  [metabase.api.geojson$read_url_and_respond invoke ""geojson.clj"" 159]
  [metabase.api.geojson$fn__86905$fn__86907 invoke ""geojson.clj"" 193]
  [compojure.response$fn__52195 invokeStatic ""response.clj"" 70]
  [compojure.response$fn__52195 invoke ""response.clj"" 67]
  [compojure.response$fn__52153$G__52148__52164 invoke ""response.clj"" 17]
  [compojure.response$send invokeStatic ""response.clj"" 27]
  [compojure.response$send invoke ""response.clj"" 22]
  [compojure.core$wrap_response$fn__52963 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__52947 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__52952 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53003 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 300]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 31]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [metabase.api.routes$fn__104860$fn__104863 invoke ""routes.clj"" 73]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__105140$fn__105141 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53003 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [metabase.server.routes$fn__105123$fn__105125 invoke ""routes.clj"" 47]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__101254 invoke ""exceptions.clj"" 107]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__101251 invoke ""exceptions.clj"" 96]
  [metabase.server.middleware.log$log_api_call$fn__105420$fn__105421$fn__105422 invoke ""log.clj"" 236]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__105420$fn__105421 invoke ""log.clj"" 227]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__105420 invoke ""log.clj"" 226]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__108690 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__101210 invoke ""security.clj"" 241]
  [ring.middleware.json$wrap_json_body$fn__108949 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__87456 invoke ""offset_paging.clj"" 43]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__54570 invoke ""json.clj"" 83]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__109038 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__109057 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__70690 invoke ""misc.clj"" 60]
  [metabase.server.middleware.session$reset_session_timeout$fn__77777 invoke ""session.clj"" 552]
  [metabase.server.middleware.session$bind_current_user$fn__77743$fn__77744 invoke ""session.clj"" 446]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 425]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 408]
  [metabase.server.middleware.session$bind_current_user$fn__77743 invoke ""session.clj"" 445]
  [metabase.server.middleware.session$wrap_current_user_info$fn__77722 invoke ""session.clj"" 383]
  [metabase.server.middleware.session$wrap_session_id$fn__77694 invoke ""session.clj"" 259]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__97292 invoke ""auth.clj"" 32]
  [ring.middleware.cookies$wrap_cookies$fn__108877 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__70672 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__70698 invoke ""misc.clj"" 77]
  [ring.middleware.gzip$wrap_gzip$fn__108919 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.misc$bind_request$fn__70701 invoke ""misc.clj"" 94]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__108706 invoke ""ssl.clj"" 41]
  [metabase.server$async_proxy_handler$fn__71036 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run nil -1]],
 :message nil}
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""de-DE"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.6 Safari/605.1.15"",
    ""vendor"": ""Apple Computer, Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-08-15"",
      ""tag"": ""v0.50.20.4"",
      ""hash"": ""64d1a8a""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.4 (Debian 16.4-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-118-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```


### Severity

blocking usage of map feature

### Additional context

_No response_",MrApe,2024-08-16 10:31:45+00:00,[],2024-08-19 16:46:42+00:00,2024-08-19 15:53:07+00:00,https://github.com/metabase/metabase/issues/46918,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Misc/API', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2293372030, 'issue_id': 2469987673, 'author': 'crisptrutski', 'body': 'It looks like the issue has to do with the headers returned by the server - we expect a content-type header. Is it possible that your webservers are not returning one?', 'created_at': datetime.datetime(2024, 8, 16, 11, 55, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2293540563, 'issue_id': 2469987673, 'author': 'MrApe', 'body': ""Yes, it's just a busybox httpd that I usally use when testing things. But it actually doesn't send any content headers. I switched to another http-server and voilà: it just works. \r\n\r\n... well almost. Now the map does not display my features. There are there as SVG paths in the source and do highlight when inspecting the page with developer tools but the map area is simply white. Strangely the network tag in inspector shows all map tiles loaded correctly. But I guess that's another issue to open..."", 'created_at': datetime.datetime(2024, 8, 16, 13, 44, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2294096610, 'issue_id': 2469987673, 'author': 'paoliniluis', 'body': 'related to https://github.com/metabase/metabase/issues/19725 and https://github.com/metabase/metabase/issues/37715', 'created_at': datetime.datetime(2024, 8, 16, 19, 34, 41, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-08-16 11:55:38 UTC): It looks like the issue has to do with the headers returned by the server - we expect a content-type header. Is it possible that your webservers are not returning one?

MrApe (Issue Creator) on (2024-08-16 13:44:36 UTC): Yes, it's just a busybox httpd that I usally use when testing things. But it actually doesn't send any content headers. I switched to another http-server and voilà: it just works. 

... well almost. Now the map does not display my features. There are there as SVG paths in the source and do highlight when inspecting the page with developer tools but the map area is simply white. Strangely the network tag in inspector shows all map tiles loaded correctly. But I guess that's another issue to open...

paoliniluis on (2024-08-16 19:34:41 UTC): related to https://github.com/metabase/metabase/issues/19725 and https://github.com/metabase/metabase/issues/37715

"
2469952012,issue,open,,Grid map zoom in feature is broken,"### Describe the bug

When looking at the [docs](https://www.metabase.com/learn/metabase-basics/querying-and-dashboards/visualization/maps) for Grid map, zoom in click on a tile is supposed to break down into smaller tiles on the clicked area. However, attempting it on custom dataset gives out weird filter breakdown only on one coordinate dimension

<img width=""809"" alt=""Screenshot 2024-08-16 at 12 03 08"" src=""https://github.com/user-attachments/assets/25eabc12-7084-4dc0-b1be-2f06a11ed3b3"">

<img width=""1372"" alt=""Screenshot 2024-08-16 at 12 03 25"" src=""https://github.com/user-attachments/assets/163acff5-0905-4b2e-98ca-c104c3ffaafc"">


### To Reproduce

1. Go to Grid Map Visualised question
2. Click on a tile
3. Click on 'Zoom In'
5. See only Latitude filtered, revealing odd one-dimension filtered map


### Expected behavior

Both coordinates are filtered, map is zoomed in to display lower-level tiles

### Logs

_No response_

### Information about your Metabase installation

```JSON
- Metabase v0.50.19.1
```


### Severity

Renders Grid Map almost unusable

### Additional context

_No response_",TLazarevic,2024-08-16 10:10:19+00:00,[],2025-02-04 20:31:55+00:00,,https://github.com/metabase/metabase/issues/46916,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/MBQL', ''), ('.Backend', ''), ('Visualization/Maps', ''), ('.Reproduced', 'Issues reproduced in test (usually Cypress)'), ('Querying/Drill Thrus', 'Refining existing queries with Drill Thrus'), ('.Team/Querying', '')]","[{'comment_id': 2293479165, 'issue_id': 2469952012, 'author': 'cdeweyx', 'body': 'Can repro [here](https://stats.metabase.com/question#eyJkYXRhc2V0X3F1ZXJ5Ijp7ImRhdGFiYXNlIjoxLCJ0eXBlIjoicXVlcnkiLCJxdWVyeSI6eyJzb3VyY2UtdGFibGUiOjQsImFnZ3JlZ2F0aW9uIjpbWyJjb3VudCJdXSwiYnJlYWtvdXQiOltbImZpZWxkIiwzMSx7ImJhc2UtdHlwZSI6InR5cGUvRmxvYXQiLCJiaW5uaW5nIjp7InN0cmF0ZWd5IjoiZGVmYXVsdCJ9fV0sWyJmaWVsZCIsMjEseyJiYXNlLXR5cGUiOiJ0eXBlL0Zsb2F0IiwiYmlubmluZyI6eyJzdHJhdGVneSI6ImRlZmF1bHQifX1dXX19LCJkaXNwbGF5IjoibWFwIiwidmlzdWFsaXphdGlvbl9zZXR0aW5ncyI6eyJtYXAudHlwZSI6ImdyaWQifSwidHlwZSI6InF1ZXN0aW9uIn0=) on the sample db as well, so this is not just a custom map thing.', 'created_at': datetime.datetime(2024, 8, 16, 13, 7, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2298462293, 'issue_id': 2469952012, 'author': 'TLazarevic', 'body': 'Is it planned to be fixed any time soon?', 'created_at': datetime.datetime(2024, 8, 20, 9, 58, 3, tzinfo=datetime.timezone.utc)}]","cdeweyx on (2024-08-16 13:07:39 UTC): Can repro [here](https://stats.metabase.com/question#eyJkYXRhc2V0X3F1ZXJ5Ijp7ImRhdGFiYXNlIjoxLCJ0eXBlIjoicXVlcnkiLCJxdWVyeSI6eyJzb3VyY2UtdGFibGUiOjQsImFnZ3JlZ2F0aW9uIjpbWyJjb3VudCJdXSwiYnJlYWtvdXQiOltbImZpZWxkIiwzMSx7ImJhc2UtdHlwZSI6InR5cGUvRmxvYXQiLCJiaW5uaW5nIjp7InN0cmF0ZWd5IjoiZGVmYXVsdCJ9fV0sWyJmaWVsZCIsMjEseyJiYXNlLXR5cGUiOiJ0eXBlL0Zsb2F0IiwiYmlubmluZyI6eyJzdHJhdGVneSI6ImRlZmF1bHQifX1dXX19LCJkaXNwbGF5IjoibWFwIiwidmlzdWFsaXphdGlvbl9zZXR0aW5ncyI6eyJtYXAudHlwZSI6ImdyaWQifSwidHlwZSI6InF1ZXN0aW9uIn0=) on the sample db as well, so this is not just a custom map thing.

TLazarevic (Issue Creator) on (2024-08-20 09:58:03 UTC): Is it planned to be fixed any time soon?

"
2469946867,issue,closed,completed,"Integrate ""stage-number"" option in dashboard parameter target","- [Tech doc](https://www.notion.so/metabase/Tech-Allow-to-use-both-pre-and-post-last-aggregation-columns-in-dashboard-filters-1f8c3309aa824463827a38bedcd47ac6)
- [Slack](https://metaboat.slack.com/archives/C06P22KS4JH/p1723692282645819?thread_ts=1723554209.279159&cid=C06P22KS4JH)
- [BE task](https://github.com/metabase/metabase/issues/46914)",kamilmielnik,2024-08-16 10:07:03+00:00,['kamilmielnik'],2024-08-23 07:52:46+00:00,2024-08-23 07:52:46+00:00,https://github.com/metabase/metabase/issues/46915,"[('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2306506487, 'issue_id': 2469946867, 'author': 'kamilmielnik', 'body': 'Closed by #46670', 'created_at': datetime.datetime(2024, 8, 23, 7, 52, 46, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-08-23 07:52:46 UTC): Closed by #46670

"
2469939446,issue,closed,completed,"Add ""stage-number"" option in dashboard parameter target","- [Tech doc](https://www.notion.so/metabase/Tech-Allow-to-use-both-pre-and-post-last-aggregation-columns-in-dashboard-filters-1f8c3309aa824463827a38bedcd47ac6)
- [Slack](https://metaboat.slack.com/archives/C06P22KS4JH/p1723692282645819?thread_ts=1723554209.279159&cid=C06P22KS4JH)
- [FE task](https://github.com/metabase/metabase/issues/46915)",kamilmielnik,2024-08-16 10:02:49+00:00,['metamben'],2024-10-08 16:16:28+00:00,2024-08-26 17:16:01+00:00,https://github.com/metabase/metabase/issues/46914,"[('.Backend', ''), ('.Team/Querying', '')]",[],
2469121140,issue,open,,Browser back button doesn't return you to modified query after visualization,"### Describe the bug

If you edit a GUI question and visualize you can't go back with the browser back button

### To Reproduce

1. Open any saved GUI question
2. Open the notebook editor
3. Edit anything 
4. Click Visualize to see the changes
5. Click browser back button
6. Modal Discard your changes? is shown


### Expected behavior

It should move you back to the notebook editor

### Logs

_No response_

### Information about your Metabase installation

```JSON
06d1ba2ae111e66253209c01c244d6379acfc6dcb1911fa9ab6012cec9ce52e5
```


### Severity

It's a no-no to lose the work

### Additional context

_No response_",mngr,2024-08-15 22:59:16+00:00,[],2025-02-04 20:30:56+00:00,,https://github.com/metabase/metabase/issues/46906,"[('Type:New Feature', ''), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('Querying/Notebook', 'Items specific to the Custom/Notebook query builder'), ('.Team/Querying', '')]","[{'comment_id': 2292925878, 'issue_id': 2469121140, 'author': 'nemanjaglumac', 'body': 'We should probably display the warning modal in this scenario as well.\r\nI would maybe call this P3 since there are two other ways you can go back without losing your work.\r\n\r\nYou have two ""workarounds"".\r\n1. Click preview just next to the step you\'re on in the Notebook editor instead of clicking ""Visualize""\r\n<img width=""1110"" alt=""image"" src=""https://github.com/user-attachments/assets/90baddf4-7f8e-4690-b99d-f4d9a1993bdb"">\r\n\r\n2. Click ""Show Notebook"" instead of going back\r\n<img width=""1108"" alt=""image"" src=""https://github.com/user-attachments/assets/a760f4dd-d033-479f-8505-00e5125980a5"">', 'created_at': datetime.datetime(2024, 8, 16, 6, 49, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2302601938, 'issue_id': 2469121140, 'author': 'nemanjaglumac', 'body': '> We should probably display the warning modal in this scenario as well.\r\n\r\nI misread the repro steps or I confused this with the other related issue. We **ARE** displaying the discard warning modal.\r\n\r\nWhich makes this a desired behavior and not a bug, IMO.\r\nThis is how history should work, and we\'re preventing you from losing the data.\r\n\r\nLike I said in the comment above, the way to go back to the editor is to click ""Show Editor"" button.', 'created_at': datetime.datetime(2024, 8, 21, 17, 24, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2302630667, 'issue_id': 2469121140, 'author': 'nemanjaglumac', 'body': ""Not a bug: [Slack context](https://metaboat.slack.com/archives/C0645JP1W81/p1724261675440449).\r\nRe-labeling it as a feature request, but it should be closed, imo.\r\n\r\n> It's a no-no to lose the work\r\n\r\nWarning modal prevents one from losing the work."", 'created_at': datetime.datetime(2024, 8, 21, 17, 42, 11, tzinfo=datetime.timezone.utc)}]","nemanjaglumac on (2024-08-16 06:49:15 UTC): We should probably display the warning modal in this scenario as well.
I would maybe call this P3 since there are two other ways you can go back without losing your work.

You have two ""workarounds"".
1. Click preview just next to the step you're on in the Notebook editor instead of clicking ""Visualize""
<img width=""1110"" alt=""image"" src=""https://github.com/user-attachments/assets/90baddf4-7f8e-4690-b99d-f4d9a1993bdb"">

2. Click ""Show Notebook"" instead of going back
<img width=""1108"" alt=""image"" src=""https://github.com/user-attachments/assets/a760f4dd-d033-479f-8505-00e5125980a5"">

nemanjaglumac on (2024-08-21 17:24:30 UTC): I misread the repro steps or I confused this with the other related issue. We **ARE** displaying the discard warning modal.

Which makes this a desired behavior and not a bug, IMO.
This is how history should work, and we're preventing you from losing the data.

Like I said in the comment above, the way to go back to the editor is to click ""Show Editor"" button.

nemanjaglumac on (2024-08-21 17:42:11 UTC): Not a bug: [Slack context](https://metaboat.slack.com/archives/C0645JP1W81/p1724261675440449).
Re-labeling it as a feature request, but it should be closed, imo.


Warning modal prevents one from losing the work.

"
2469105518,issue,closed,completed,Lots of linked filters will peg the cpu to 100%,"### Describe the bug

Linking lots of filters one after another will lead to Metabase taking a lot of CPU time to build a very simple query:
```
SELECT ""soccer"".""dim_venue"".""venue_name"" AS ""venue_name"" FROM ""soccer"".""dim_venue"" LEFT JOIN ""soccer"".""fact_match_statistics"" AS ""table_234"" ON ""soccer"".""dim_venue"".""venue_id"" = ""table_234"".""venue_id"" LEFT JOIN ""soccer"".""dim_weather_condition"" AS ""table_240"" ON ""table_234"".""climate"" = ""table_240"".""weather_id"" LEFT JOIN ""soccer"".""dim_match_pitch_condition"" AS ""table_235"" ON ""table_234"".""pitch_condition_id"" = ""table_235"".""pitch_condition_id"" LEFT JOIN ""soccer"".""dim_match_type"" AS ""table_243"" ON ""table_234"".""match_type"" = ""table_243"".""match_type_id"" LEFT JOIN ""soccer"".""dim_referee"" AS ""table_231"" ON ""table_234"".""referee_id"" = ""table_231"".""referee_id"" LEFT JOIN ""soccer"".""dim_match_time_of_day"" AS ""table_228"" ON ""table_234"".""time_of_day_id"" = ""table_228"".""time_of_day_id"" LEFT JOIN ""soccer"".""dim_match_outcome_type"" AS ""table_236"" ON ""table_234"".""outcome_type_id"" = ""table_236"".""outcome_type_id"" WHERE (""table_234"".""goals_conceded"" = 1) AND (""table_235"".""pitch_condition_description"" = $1) AND (""table_240"".""condition_description"" = $2) AND (""table_228"".""time_of_day_description"" = $3) AND (""table_236"".""outcome_type_description"" = $4) AND (""table_231"".""referee_name"" = $5) AND (""table_243"".""match_type_description"" = $6) GROUP BY ""soccer"".""dim_venue"".""venue_name"" ORDER BY ""soccer"".""dim_venue"".""venue_name"" ASC LIMIT 1000
2024-08-15 22:24:42.000 UTC [39928] DETAIL:  parameters: $1 = 'Moist', $2 = 'Clear sky', $3 = 'Morning', $4 = 'Regulation time', $5 = 'Emily Taylor', $6 = 'Cup final'
```
![image](https://github.com/user-attachments/assets/3fbe2da6-314f-43b2-a59b-dca491015fe9)

![image](https://github.com/user-attachments/assets/bcda9df3-5d7d-48b7-bf7c-e2de4788a42c)


### To Reproduce

1) use the dimensional model https://github.com/metabase/metabase-qa/blob/master/dbs/postgres/data/dimensional_model.sql
2) create a question of the fact table, save it on a dashboard
3) now start creating filters, each of the filters use a table that is linked to the fact table. Create like 8 filters. First filter is not linked, second filter is linked to the first one, third filter is linked to the second and the first... and so on and so forth
4) you'll end up with the eight filter like 
![image](https://github.com/user-attachments/assets/74de1ff0-972b-4c7f-906a-f8afa0d1fe3a)


5) now start selecting values in the first filter, second filter, third filter... observe that Metabase takes more and more time on each request, which doesn't make sense since the data is super small. What's really interesting is that when you reach the 6th or 7th filter, you'll see the spinner for a very long time, and the query will not reach the database till 20-30 seconds later

### Expected behavior

This should be fast

### Logs

2024-08-15 22:24:42,005 DEBUG middleware.log :: GET /api/dashboard/16/params/e2b7f238/values 200 2.2 mins (30 DB calls) App DB connections: 0/346 Jetty threads: 4/50 (34 idle, 0 queued) (175 total active threads) Queries in flight: 0 (0 queued); postgres DB 2 connections: 0/1 (0 threads blocked) {:metabase-user-id 1}

(2.2 minutes to get filter values)

### Information about your Metabase installation

```JSON
v50.20.3
```


### Severity

P1

### Additional context

Trace of the API call
![image](https://github.com/user-attachments/assets/71a4eca0-9d53-40af-b640-dcf6362c6f7a)

CPU time
![image](https://github.com/user-attachments/assets/94b96f22-38b1-468e-ab94-2157e08a2b4b)
![image](https://github.com/user-attachments/assets/dff4aab6-e5f8-4cd0-81b8-80c9d9e70fd7)


This is super important since static embeddings act make filters to act as linked, so we need to fix this ASAP",paoliniluis,2024-08-15 22:39:44+00:00,['metamben'],2024-09-03 19:04:10+00:00,2024-09-02 22:34:12+00:00,https://github.com/metabase/metabase/issues/46905,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Performance', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2292430230, 'issue_id': 2469105518, 'author': 'paoliniluis', 'body': 'ok so this was in v49... so de-escalating', 'created_at': datetime.datetime(2024, 8, 15, 23, 5, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2292483873, 'issue_id': 2469105518, 'author': 'dpsutton', 'body': 'This dates back to at least 0.39.4 from June 16, 2021.\r\n\r\nRepro:\r\n\r\n```clojure\r\ndedupe-joins=> (let [source-id 47\r\n                     keep-ids #{72 85 32 5 14}\r\n                     in-joins [{:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}\r\n                               {:lhs {:table 40, :field 546}, :rhs {:table 72, :field 751}}\r\n                               {:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}\r\n                               {:lhs {:table 40, :field 527}, :rhs {:table 85, :field 898}}\r\n                               {:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}\r\n                               {:lhs {:table 40, :field 526}, :rhs {:table 32, :field 451}}\r\n                               {:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}\r\n                               {:lhs {:table 40, :field 547}, :rhs {:table 5, :field 37}}\r\n                               {:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}\r\n                               {:lhs {:table 40, :field 532}, :rhs {:table 14, :field 106}}]]\r\n                 (time\r\n                   (let [keep-ids (set/intersection (set keep-ids)\r\n                                                    (set (map #(get-in % [:rhs :table]) in-joins)))]\r\n                     (first\r\n                       (some\r\n                         seq\r\n                         (for [num-joins (range (count keep-ids) (inc (count in-joins)))]\r\n                           (let [out-joins (vec (l/lvars num-joins))]\r\n                             (l/run 1 [q]\r\n                               (l/== q out-joins)\r\n                               ;; every join in out-joins must be present in the original non-deduped set of joins\r\n                               (l/everyg (fn [join]\r\n                                           (l/membero join in-joins))\r\n                                         out-joins)\r\n                               ;; no duplicate joins (this is mostly for optimization since we also deduplicate RHSes below)\r\n                               (l/distincto out-joins)\r\n                               ;; a join for every rhs must be present\r\n                               (l/everyg (fn [id]\r\n                                           (has-joino out-joins id))\r\n                                         keep-ids)\r\n                               ;; no duplicate rhses\r\n                               (distinct-rhso out-joins)\r\n                               ;; joins must be in order (e.g. parent join must come first)\r\n                               (l/everyg (fn [join]\r\n                                           (l/conda\r\n                                             ;; either the LHS is the source Table...\r\n                                             ((lhso join source-id))\r\n                                             ;; or its LHS must have already been joined\r\n                                             ((parent-beforeo out-joins join))))\r\n                                         out-joins)))))))))\r\n""Elapsed time: 13021.499125 msecs""\r\n[{:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}\r\n {:lhs {:table 40, :field 546}, :rhs {:table 72, :field 751}}\r\n {:lhs {:table 40, :field 527}, :rhs {:table 85, :field 898}}\r\n {:lhs {:table 40, :field 526}, :rhs {:table 32, :field 451}}\r\n {:lhs {:table 40, :field 547}, :rhs {:table 5, :field 37}}\r\n {:lhs {:table 40, :field 532}, :rhs {:table 14, :field 106}}]\r\n```\r\n\r\nIf you add one more join to this it balloons from the 13 seconds here to\r\n> GET /api/dashboard/2/params/e76d8620/values 200 6.3 mins\r\n\r\n```clojure\r\ndedupe-joins=> (let [source-id 83\r\n                     keep-ids #{72 85 32 47 5 14}\r\n                     in-joins [{:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}\r\n                               {:lhs {:table 40, :field 546}, :rhs {:table 72, :field 751}}\r\n                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}\r\n                               {:lhs {:table 40, :field 527}, :rhs {:table 85, :field 898}}\r\n                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}\r\n                               {:lhs {:table 40, :field 526}, :rhs {:table 32, :field 451}}\r\n                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}\r\n                               {:lhs {:table 40, :field 524}, :rhs {:table 47, :field 600}}\r\n                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}\r\n                               {:lhs {:table 40, :field 547}, :rhs {:table 5, :field 37}}\r\n                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}\r\n                               {:lhs {:table 40, :field 532}, :rhs {:table 14, :field 106}}]]\r\n                 (time\r\n                   (let [keep-ids (set/intersection (set keep-ids)\r\n                                                    (set (map #(get-in % [:rhs :table]) in-joins)))]\r\n                     (first\r\n                       (some\r\n                         seq\r\n                         (for [num-joins (range (count keep-ids) (inc (count in-joins)))]\r\n                           (let [out-joins (vec (l/lvars num-joins))]\r\n                             (l/run 1 [q]\r\n                               (l/== q out-joins)\r\n                               ;; every join in out-joins must be present in the original non-deduped set of joins\r\n                               (l/everyg (fn [join]\r\n                                           (l/membero join in-joins))\r\n                                         out-joins)\r\n                               ;; no duplicate joins (this is mostly for optimization since we also deduplicate RHSes below)\r\n                               (l/distincto out-joins)\r\n                               ;; a join for every rhs must be present\r\n                               (l/everyg (fn [id]\r\n                                           (has-joino out-joins id))\r\n                                         keep-ids)\r\n                               ;; no duplicate rhses\r\n                               (distinct-rhso out-joins)\r\n                               ;; joins must be in order (e.g. parent join must come first)\r\n                               (l/everyg (fn [join]\r\n                                           (l/conda\r\n                                             ;; either the LHS is the source Table...\r\n                                             ((lhso join source-id))\r\n                                             ;; or its LHS must have already been joined\r\n                                             ((parent-beforeo out-joins join))))\r\n                                         out-joins)))))))))\r\n""Elapsed time: 382654.691416 msecs"" ;; 6.3 min\r\n[{:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}\r\n {:lhs {:table 40, :field 546}, :rhs {:table 72, :field 751}}\r\n {:lhs {:table 40, :field 527}, :rhs {:table 85, :field 898}}\r\n {:lhs {:table 40, :field 526}, :rhs {:table 32, :field 451}}\r\n {:lhs {:table 40, :field 524}, :rhs {:table 47, :field 600}}\r\n {:lhs {:table 40, :field 547}, :rhs {:table 5, :field 37}}\r\n {:lhs {:table 40, :field 532}, :rhs {:table 14, :field 106}}]\r\n```\r\n\r\nwhich makes the mbql query\r\n\r\n```clojure\r\n{:database 2,\r\n :type     :query,\r\n :query    {:source-table 83,\r\n            :breakout     [[:field 885 nil]],\r\n            :limit        1000,\r\n            :joins        ({:source-table 40,\r\n                            :condition    [:= [:field 876 nil] [:field 539 {:join-alias ""table_40""}]],\r\n                            :alias        ""table_40""}\r\n                           {:source-table 72,\r\n                            :condition    [:= [:field 546 {:join-alias ""table_40""}] [:field 751 {:join-alias ""table_72""}]],\r\n                            :alias        ""table_72""}\r\n                           {:source-table 85,\r\n                            :condition    [:= [:field 527 {:join-alias ""table_40""}] [:field 898 {:join-alias ""table_85""}]],\r\n                            :alias        ""table_85""}\r\n                           {:source-table 32,\r\n                            :condition    [:= [:field 526 {:join-alias ""table_40""}] [:field 451 {:join-alias ""table_32""}]],\r\n                            :alias        ""table_32""}\r\n                           {:source-table 47,\r\n                            :condition    [:= [:field 524 {:join-alias ""table_40""}] [:field 600 {:join-alias ""table_47""}]],\r\n                            :alias        ""table_47""}\r\n                           {:source-table 5,\r\n                            :condition    [:= [:field 547 {:join-alias ""table_40""}] [:field 37 {:join-alias ""table_5""}]],\r\n                            :alias        ""table_5""}\r\n                           {:source-table 14,\r\n                            :condition    [:= [:field 532 {:join-alias ""table_40""}] [:field 106 {:join-alias ""table_14""}]],\r\n                            :alias        ""table_14""}),\r\n            :filter       [:and\r\n                           [:= [:field 109 {:join-alias ""table_14""}] ""Excellent""]\r\n                           [:= [:field 897 {:join-alias ""table_85""}] ""Electric""]\r\n                           [:= [:field 749 {:join-alias ""table_72""}] ""None""]\r\n                           [:= [:field 41 {:join-alias ""table_5""}] ""Daylight""]\r\n                           [:= [:field 453 {:join-alias ""table_32""}] ""Medium""]\r\n                           [:= [:field 599 {:join-alias ""table_47""}] ""2018-2019""]]}}\r\n```', 'created_at': datetime.datetime(2024, 8, 16, 0, 5, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2293023888, 'issue_id': 2469105518, 'author': 'crisptrutski', 'body': ""Very uncertain of the team / area routing here, apologies if it's way off"", 'created_at': datetime.datetime(2024, 8, 16, 8, 0, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2294135789, 'issue_id': 2469105518, 'author': 'camsaul', 'body': ""The fix here is probably to rewrite this so it doesn't use core.logic anymore. No matter how cool it is in theory once we start reworking all the rules so it performs decently it just ends up being hairier than if we wrote that same code without core.logic"", 'created_at': datetime.datetime(2024, 8, 16, 19, 52, 39, tzinfo=datetime.timezone.utc)}]","paoliniluis (Issue Creator) on (2024-08-15 23:05:22 UTC): ok so this was in v49... so de-escalating

dpsutton on (2024-08-16 00:05:26 UTC): This dates back to at least 0.39.4 from June 16, 2021.

Repro:

```clojure
dedupe-joins=> (let [source-id 47
                     keep-ids #{72 85 32 5 14}
                     in-joins [{:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}
                               {:lhs {:table 40, :field 546}, :rhs {:table 72, :field 751}}
                               {:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}
                               {:lhs {:table 40, :field 527}, :rhs {:table 85, :field 898}}
                               {:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}
                               {:lhs {:table 40, :field 526}, :rhs {:table 32, :field 451}}
                               {:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}
                               {:lhs {:table 40, :field 547}, :rhs {:table 5, :field 37}}
                               {:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}
                               {:lhs {:table 40, :field 532}, :rhs {:table 14, :field 106}}]]
                 (time
                   (let [keep-ids (set/intersection (set keep-ids)
                                                    (set (map #(get-in % [:rhs :table]) in-joins)))]
                     (first
                       (some
                         seq
                         (for [num-joins (range (count keep-ids) (inc (count in-joins)))]
                           (let [out-joins (vec (l/lvars num-joins))]
                             (l/run 1 [q]
                               (l/== q out-joins)
                               ;; every join in out-joins must be present in the original non-deduped set of joins
                               (l/everyg (fn [join]
                                           (l/membero join in-joins))
                                         out-joins)
                               ;; no duplicate joins (this is mostly for optimization since we also deduplicate RHSes below)
                               (l/distincto out-joins)
                               ;; a join for every rhs must be present
                               (l/everyg (fn [id]
                                           (has-joino out-joins id))
                                         keep-ids)
                               ;; no duplicate rhses
                               (distinct-rhso out-joins)
                               ;; joins must be in order (e.g. parent join must come first)
                               (l/everyg (fn [join]
                                           (l/conda
                                             ;; either the LHS is the source Table...
                                             ((lhso join source-id))
                                             ;; or its LHS must have already been joined
                                             ((parent-beforeo out-joins join))))
                                         out-joins)))))))))
""Elapsed time: 13021.499125 msecs""
[{:lhs {:table 47, :field 600}, :rhs {:table 40, :field 524}}
 {:lhs {:table 40, :field 546}, :rhs {:table 72, :field 751}}
 {:lhs {:table 40, :field 527}, :rhs {:table 85, :field 898}}
 {:lhs {:table 40, :field 526}, :rhs {:table 32, :field 451}}
 {:lhs {:table 40, :field 547}, :rhs {:table 5, :field 37}}
 {:lhs {:table 40, :field 532}, :rhs {:table 14, :field 106}}]
```

If you add one more join to this it balloons from the 13 seconds here to

```clojure
dedupe-joins=> (let [source-id 83
                     keep-ids #{72 85 32 47 5 14}
                     in-joins [{:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}
                               {:lhs {:table 40, :field 546}, :rhs {:table 72, :field 751}}
                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}
                               {:lhs {:table 40, :field 527}, :rhs {:table 85, :field 898}}
                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}
                               {:lhs {:table 40, :field 526}, :rhs {:table 32, :field 451}}
                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}
                               {:lhs {:table 40, :field 524}, :rhs {:table 47, :field 600}}
                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}
                               {:lhs {:table 40, :field 547}, :rhs {:table 5, :field 37}}
                               {:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}
                               {:lhs {:table 40, :field 532}, :rhs {:table 14, :field 106}}]]
                 (time
                   (let [keep-ids (set/intersection (set keep-ids)
                                                    (set (map #(get-in % [:rhs :table]) in-joins)))]
                     (first
                       (some
                         seq
                         (for [num-joins (range (count keep-ids) (inc (count in-joins)))]
                           (let [out-joins (vec (l/lvars num-joins))]
                             (l/run 1 [q]
                               (l/== q out-joins)
                               ;; every join in out-joins must be present in the original non-deduped set of joins
                               (l/everyg (fn [join]
                                           (l/membero join in-joins))
                                         out-joins)
                               ;; no duplicate joins (this is mostly for optimization since we also deduplicate RHSes below)
                               (l/distincto out-joins)
                               ;; a join for every rhs must be present
                               (l/everyg (fn [id]
                                           (has-joino out-joins id))
                                         keep-ids)
                               ;; no duplicate rhses
                               (distinct-rhso out-joins)
                               ;; joins must be in order (e.g. parent join must come first)
                               (l/everyg (fn [join]
                                           (l/conda
                                             ;; either the LHS is the source Table...
                                             ((lhso join source-id))
                                             ;; or its LHS must have already been joined
                                             ((parent-beforeo out-joins join))))
                                         out-joins)))))))))
""Elapsed time: 382654.691416 msecs"" ;; 6.3 min
[{:lhs {:table 83, :field 876}, :rhs {:table 40, :field 539}}
 {:lhs {:table 40, :field 546}, :rhs {:table 72, :field 751}}
 {:lhs {:table 40, :field 527}, :rhs {:table 85, :field 898}}
 {:lhs {:table 40, :field 526}, :rhs {:table 32, :field 451}}
 {:lhs {:table 40, :field 524}, :rhs {:table 47, :field 600}}
 {:lhs {:table 40, :field 547}, :rhs {:table 5, :field 37}}
 {:lhs {:table 40, :field 532}, :rhs {:table 14, :field 106}}]
```

which makes the mbql query

```clojure
{:database 2,
 :type     :query,
 :query    {:source-table 83,
            :breakout     [[:field 885 nil]],
            :limit        1000,
            :joins        ({:source-table 40,
                            :condition    [:= [:field 876 nil] [:field 539 {:join-alias ""table_40""}]],
                            :alias        ""table_40""}
                           {:source-table 72,
                            :condition    [:= [:field 546 {:join-alias ""table_40""}] [:field 751 {:join-alias ""table_72""}]],
                            :alias        ""table_72""}
                           {:source-table 85,
                            :condition    [:= [:field 527 {:join-alias ""table_40""}] [:field 898 {:join-alias ""table_85""}]],
                            :alias        ""table_85""}
                           {:source-table 32,
                            :condition    [:= [:field 526 {:join-alias ""table_40""}] [:field 451 {:join-alias ""table_32""}]],
                            :alias        ""table_32""}
                           {:source-table 47,
                            :condition    [:= [:field 524 {:join-alias ""table_40""}] [:field 600 {:join-alias ""table_47""}]],
                            :alias        ""table_47""}
                           {:source-table 5,
                            :condition    [:= [:field 547 {:join-alias ""table_40""}] [:field 37 {:join-alias ""table_5""}]],
                            :alias        ""table_5""}
                           {:source-table 14,
                            :condition    [:= [:field 532 {:join-alias ""table_40""}] [:field 106 {:join-alias ""table_14""}]],
                            :alias        ""table_14""}),
            :filter       [:and
                           [:= [:field 109 {:join-alias ""table_14""}] ""Excellent""]
                           [:= [:field 897 {:join-alias ""table_85""}] ""Electric""]
                           [:= [:field 749 {:join-alias ""table_72""}] ""None""]
                           [:= [:field 41 {:join-alias ""table_5""}] ""Daylight""]
                           [:= [:field 453 {:join-alias ""table_32""}] ""Medium""]
                           [:= [:field 599 {:join-alias ""table_47""}] ""2018-2019""]]}}
```

crisptrutski on (2024-08-16 08:00:28 UTC): Very uncertain of the team / area routing here, apologies if it's way off

camsaul on (2024-08-16 19:52:39 UTC): The fix here is probably to rewrite this so it doesn't use core.logic anymore. No matter how cool it is in theory once we start reworking all the rules so it performs decently it just ends up being hairier than if we wrote that same code without core.logic

"
2469050479,issue,closed,not_planned,System permission on application database: RI_ConstraintTrigger,"### Describe the bug

I am installing Metabase with [latest](https://hub.docker.com/layers/metabase/metabase/latest/images/sha256-f7b5dc52c21aaa2dca910a450e7e6119a975090ce9fc80726aa0742882ca176c?context=explore) docker image using an application database on Google Cloud SQL Postgresql.
The connection works and all the metabase table are created but metabase fail to start with the following error:

```
Reason: liquibase.exception.DatabaseException: ERROR: permission denied: ""RI_ConstraintTrigger_c_83876"" is a system trigger [Failed SQL: (0) ALTER TABLE data_permissions DISABLE TRIGGER ALL]
```
Since it is not possible to provide metabase with superuser permissions on GCP I am unable to finalize the deployment.

**Reverting to metabase/metabase:v0.49.23 solve the problem. This is a regression on the latest**

### To Reproduce

Deploy latest docker image with a postgresql application database with no superuser permissions.

### Expected behavior

Metabase should start.

### Logs

_No response_

### Information about your Metabase installation

```JSON
- Metabase latest (August 15th 2024)
- Cloudrun GCP
- Google Cloud SQL with PostgresQL 15
```


### Severity

prevent deployment

### Additional context

_No response_",xavierraffin,2024-08-15 21:58:08+00:00,[],2024-08-16 07:31:51+00:00,2024-08-15 22:01:58+00:00,https://github.com/metabase/metabase/issues/46902,"[('Type:Bug', 'Product defects')]","[{'comment_id': 2292350458, 'issue_id': 2469050479, 'author': 'paoliniluis', 'body': 'please use v50.20.3', 'created_at': datetime.datetime(2024, 8, 15, 22, 1, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2292397159, 'issue_id': 2469050479, 'author': 'xavierraffin', 'body': 'It works with v0.50.20.3.\r\nWhy does it fail with `latest` ? This is the version mentioned by the documentation and it is nice to auto update.\r\n\r\nThank you @paoliniluis', 'created_at': datetime.datetime(2024, 8, 15, 22, 27, 9, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-08-15 22:01:58 UTC): please use v50.20.3

xavierraffin (Issue Creator) on (2024-08-15 22:27:09 UTC): It works with v0.50.20.3.
Why does it fail with `latest` ? This is the version mentioned by the documentation and it is nice to auto update.

Thank you @paoliniluis

"
2469006352,issue,closed,completed,Rapidocs are broken for API,"### Describe the bug

The Rapidocs page for the `/api/docs` endpoint is breaking due to a 500 error from the server. We recently upgraded to using Metabase v1.50.19.4 and suspecting that this might have came from the version upgrade.

<img width=""1067"" alt=""Screenshot 2024-08-15 at 2 52 59 PM"" src=""https://github.com/user-attachments/assets/41b1b9de-295a-457e-a42b-7719390d3500"">

<img width=""655"" alt=""Screenshot 2024-08-15 at 2 53 06 PM"" src=""https://github.com/user-attachments/assets/5e30e6cd-b1cf-4c3a-8d53-2f81c9713dbd"">

<img width=""934"" alt=""Screenshot 2024-08-15 at 2 53 32 PM"" src=""https://github.com/user-attachments/assets/2a4d841b-af8a-4a3f-82e2-5814f6c16c4d"">

### To Reproduce

1. Ensure the metabase version is set to `v1.50.19.4`
2. Visit `{your metabase instance ur}/api/docs`
3. Validate the docs error with a 500 response from the server

### Expected behavior

The rapidocs should load correctly and allow me to see information about the api endpoints and easily test the result of the queries.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.220-209.869.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""snowflake"",
      ""h2"",
      ""postgres""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.13""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-self-hosted-yearly"",
    ""version"": {
      ""date"": ""2024-08-12"",
      ""tag"": ""v1.50.19.4"",
      ""hash"": ""e05a1ea""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

Mild

### Additional context

_No response_",taytestokes-aumni,2024-08-15 21:33:18+00:00,['piranha'],2024-08-26 16:30:12+00:00,2024-08-26 13:59:16+00:00,https://github.com/metabase/metabase/issues/46901,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Type:Documentation', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2293264547, 'issue_id': 2469006352, 'author': 'piranha', 'body': ""@taytestokes-aumni if you could post full JSON of that error somewhere that would be helpful, since I can't reproduce this locally..."", 'created_at': datetime.datetime(2024, 8, 16, 10, 35, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2296825425, 'issue_id': 2469006352, 'author': 'taytestokes-aumni', 'body': '@piranha sorry about that, here\'s the json!\r\n\r\n```json\r\n{\r\n    ""via"": [\r\n        {\r\n            ""type"": ""clojure.lang.ExceptionInfo"",\r\n            ""message"": ""Exception at /dashboard/{id}/params/{param-key}/search/{query}"",\r\n            ""data"": {},\r\n            ""at"": [\r\n                ""metabase.api.common.openapi$openapi_object$iter__45361__45365$fn__45366$fn__45373"",\r\n                ""invoke"",\r\n                ""openapi.clj"",\r\n                199\r\n            ]\r\n        },\r\n        {\r\n            ""type"": ""java.lang.IllegalArgumentException"",\r\n            ""message"": ""Don\'t know how to create ISeq from: clojure.lang.Symbol"",\r\n            ""at"": [\r\n                ""clojure.lang.RT"",\r\n                ""seqFrom"",\r\n                ""RT.java"",\r\n                557\r\n            ]\r\n        }\r\n    ],\r\n    ""trace"": [\r\n        [\r\n            ""clojure.lang.RT"",\r\n            ""seqFrom"",\r\n            ""RT.java"",\r\n            557\r\n        ],\r\n        [\r\n            ""clojure.lang.RT"",\r\n            ""seq"",\r\n            ""RT.java"",\r\n            537\r\n        ],\r\n        [\r\n            ""clojure.lang.RT"",\r\n            ""vals"",\r\n            ""RT.java"",\r\n            631\r\n        ],\r\n        [\r\n            ""clojure.core$vals"",\r\n            ""invokeStatic"",\r\n            ""core.clj"",\r\n            1580\r\n        ],\r\n        [\r\n            ""clojure.core$vals"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            1576\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$compojure_query_params"",\r\n            ""invokeStatic"",\r\n            ""openapi.clj"",\r\n            128\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$compojure_query_params"",\r\n            ""invoke"",\r\n            ""openapi.clj"",\r\n            111\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$schema__GT_params"",\r\n            ""invokeStatic"",\r\n            ""openapi.clj"",\r\n            149\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$schema__GT_params"",\r\n            ""invoke"",\r\n            ""openapi.clj"",\r\n            143\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$defendpoint__GT_path_item"",\r\n            ""invokeStatic"",\r\n            ""openapi.clj"",\r\n            167\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$defendpoint__GT_path_item"",\r\n            ""invoke"",\r\n            ""openapi.clj"",\r\n            161\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$openapi_object$iter__45361__45365$fn__45366$fn__45373"",\r\n            ""invoke"",\r\n            ""openapi.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$openapi_object$iter__45361__45365$fn__45366"",\r\n            ""invoke"",\r\n            ""openapi.clj"",\r\n            196\r\n        ],\r\n        [\r\n            ""clojure.lang.LazySeq"",\r\n            ""sval"",\r\n            ""LazySeq.java"",\r\n            42\r\n        ],\r\n        [\r\n            ""clojure.lang.LazySeq"",\r\n            ""seq"",\r\n            ""LazySeq.java"",\r\n            51\r\n        ],\r\n        [\r\n            ""clojure.lang.Cons"",\r\n            ""next"",\r\n            ""Cons.java"",\r\n            39\r\n        ],\r\n        [\r\n            ""clojure.lang.RT"",\r\n            ""next"",\r\n            ""RT.java"",\r\n            713\r\n        ],\r\n        [\r\n            ""clojure.core$next__5451"",\r\n            ""invokeStatic"",\r\n            ""core.clj"",\r\n            64\r\n        ],\r\n        [\r\n            ""clojure.core.protocols$fn__8249"",\r\n            ""invokeStatic"",\r\n            ""protocols.clj"",\r\n            169\r\n        ],\r\n        [\r\n            ""clojure.core.protocols$fn__8249"",\r\n            ""invoke"",\r\n            ""protocols.clj"",\r\n            124\r\n        ],\r\n        [\r\n            ""clojure.core.protocols$fn__8204$G__8199__8213"",\r\n            ""invoke"",\r\n            ""protocols.clj"",\r\n            19\r\n        ],\r\n        [\r\n            ""clojure.core.protocols$seq_reduce"",\r\n            ""invokeStatic"",\r\n            ""protocols.clj"",\r\n            31\r\n        ],\r\n        [\r\n            ""clojure.core.protocols$fn__8236"",\r\n            ""invokeStatic"",\r\n            ""protocols.clj"",\r\n            75\r\n        ],\r\n        [\r\n            ""clojure.core.protocols$fn__8236"",\r\n            ""invoke"",\r\n            ""protocols.clj"",\r\n            75\r\n        ],\r\n        [\r\n            ""clojure.core.protocols$fn__8178$G__8173__8191"",\r\n            ""invoke"",\r\n            ""protocols.clj"",\r\n            13\r\n        ],\r\n        [\r\n            ""clojure.core$reduce"",\r\n            ""invokeStatic"",\r\n            ""core.clj"",\r\n            6887\r\n        ],\r\n        [\r\n            ""clojure.core$reduce"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            6869\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$openapi_object"",\r\n            ""invokeStatic"",\r\n            ""openapi.clj"",\r\n            192\r\n        ],\r\n        [\r\n            ""metabase.api.common.openapi$openapi_object"",\r\n            ""invoke"",\r\n            ""openapi.clj"",\r\n            185\r\n        ],\r\n        [\r\n            ""metabase.api.routes$fn__105553"",\r\n            ""invokeStatic"",\r\n            ""routes.clj"",\r\n            94\r\n        ],\r\n        [\r\n            ""metabase.api.routes$fn__105553"",\r\n            ""invoke"",\r\n            ""routes.clj"",\r\n            75\r\n        ],\r\n        [\r\n            ""compojure.core$wrap_response$fn__52963"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            160\r\n        ],\r\n        [\r\n            ""compojure.core$wrap_route_middleware$fn__52947"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            132\r\n        ],\r\n        [\r\n            ""compojure.core$wrap_route_info$fn__52952"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            139\r\n        ],\r\n        [\r\n            ""compojure.core$wrap_route_matches$fn__52956"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            151\r\n        ],\r\n        [\r\n            ""clojure.lang.Var"",\r\n            ""invoke"",\r\n            ""Var.java"",\r\n            393\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            199\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$fn__53007"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            301\r\n        ],\r\n        [\r\n            ""clojure.lang.AFn"",\r\n            ""applyToHelper"",\r\n            ""AFn.java"",\r\n            160\r\n        ],\r\n        [\r\n            ""clojure.lang.AFn"",\r\n            ""applyTo"",\r\n            ""AFn.java"",\r\n            144\r\n        ],\r\n        [\r\n            ""clojure.lang.AFunction$1"",\r\n            ""doInvoke"",\r\n            ""AFunction.java"",\r\n            31\r\n        ],\r\n        [\r\n            ""clojure.lang.RestFn"",\r\n            ""invoke"",\r\n            ""RestFn.java"",\r\n            436\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            199\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$fn__53007"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            301\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$fn__53007"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            301\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            199\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$fn__53007"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            301\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""metabase.api.routes$fn__105546$fn__105547"",\r\n            ""invoke"",\r\n            ""routes.clj"",\r\n            70\r\n        ],\r\n        [\r\n            ""clojure.lang.AFn"",\r\n            ""applyToHelper"",\r\n            ""AFn.java"",\r\n            160\r\n        ],\r\n        [\r\n            ""clojure.lang.AFn"",\r\n            ""applyTo"",\r\n            ""AFn.java"",\r\n            144\r\n        ],\r\n        [\r\n            ""clojure.lang.AFunction$1"",\r\n            ""doInvoke"",\r\n            ""AFunction.java"",\r\n            31\r\n        ],\r\n        [\r\n            ""clojure.lang.RestFn"",\r\n            ""invoke"",\r\n            ""RestFn.java"",\r\n            436\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""clojure.lang.AFn"",\r\n            ""applyToHelper"",\r\n            ""AFn.java"",\r\n            160\r\n        ],\r\n        [\r\n            ""clojure.lang.AFn"",\r\n            ""applyTo"",\r\n            ""AFn.java"",\r\n            144\r\n        ],\r\n        [\r\n            ""clojure.core$apply"",\r\n            ""invokeStatic"",\r\n            ""core.clj"",\r\n            667\r\n        ],\r\n        [\r\n            ""clojure.core$apply"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            662\r\n        ],\r\n        [\r\n            ""metabase.server.routes$fn__105826$fn__105827"",\r\n            ""doInvoke"",\r\n            ""routes.clj"",\r\n            73\r\n        ],\r\n        [\r\n            ""clojure.lang.RestFn"",\r\n            ""invoke"",\r\n            ""RestFn.java"",\r\n            436\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$handler__53003"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            290\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$fn__53007"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            300\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$wrap_route_matches$fn__52956"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            153\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$wrap_route_matches$fn__52956"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            152\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$wrap_route_matches$fn__52956"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            152\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$wrap_route_matches$fn__52956"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            152\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            199\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            199\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            199\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$fn__53007"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            301\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$handler__53003"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            290\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$fn__53007"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            300\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            197\r\n        ],\r\n        [\r\n            ""compojure.core$make_context$fn__53007"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            301\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975$f__52976"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            198\r\n        ],\r\n        [\r\n            ""compojure.core$routes$fn__52975"",\r\n            ""invoke"",\r\n            ""core.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__101940"",\r\n            ""invoke"",\r\n            ""exceptions.clj"",\r\n            107\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.exceptions$catch_api_exceptions$fn__101937"",\r\n            ""invoke"",\r\n            ""exceptions.clj"",\r\n            96\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.log$log_api_call$fn__108175$fn__108176$fn__108177"",\r\n            ""invoke"",\r\n            ""log.clj"",\r\n            236\r\n        ],\r\n        [\r\n            ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",\r\n            ""invokeStatic"",\r\n            ""diagnostic.clj"",\r\n            18\r\n        ],\r\n        [\r\n            ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",\r\n            ""invoke"",\r\n            ""diagnostic.clj"",\r\n            12\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.log$log_api_call$fn__108175$fn__108176"",\r\n            ""invoke"",\r\n            ""log.clj"",\r\n            227\r\n        ],\r\n        [\r\n            ""toucan2.execute$do_with_call_counts"",\r\n            ""invokeStatic"",\r\n            ""execute.clj"",\r\n            112\r\n        ],\r\n        [\r\n            ""toucan2.execute$do_with_call_counts"",\r\n            ""invoke"",\r\n            ""execute.clj"",\r\n            103\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.log$log_api_call$fn__108175"",\r\n            ""invoke"",\r\n            ""log.clj"",\r\n            226\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__114334"",\r\n            ""invoke"",\r\n            ""browser_cookie.clj"",\r\n            40\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.security$add_security_headers$fn__101896"",\r\n            ""invoke"",\r\n            ""security.clj"",\r\n            240\r\n        ],\r\n        [\r\n            ""ring.middleware.json$wrap_json_body$fn__114593"",\r\n            ""invoke"",\r\n            ""json.clj"",\r\n            64\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.offset_paging$handle_paging$fn__88143"",\r\n            ""invoke"",\r\n            ""offset_paging.clj"",\r\n            43\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.json$wrap_streamed_json_response$fn__54496"",\r\n            ""invoke"",\r\n            ""json.clj"",\r\n            83\r\n        ],\r\n        [\r\n            ""ring.middleware.keyword_params$wrap_keyword_params$fn__114682"",\r\n            ""invoke"",\r\n            ""keyword_params.clj"",\r\n            55\r\n        ],\r\n        [\r\n            ""ring.middleware.params$wrap_params$fn__114701"",\r\n            ""invoke"",\r\n            ""params.clj"",\r\n            77\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.misc$maybe_set_site_url$fn__70589"",\r\n            ""invoke"",\r\n            ""misc.clj"",\r\n            60\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.session$reset_session_timeout$fn__77719"",\r\n            ""invoke"",\r\n            ""session.clj"",\r\n            552\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.session$bind_current_user$fn__77685$fn__77686"",\r\n            ""invoke"",\r\n            ""session.clj"",\r\n            446\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.session$do_with_current_user"",\r\n            ""invokeStatic"",\r\n            ""session.clj"",\r\n            425\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.session$do_with_current_user"",\r\n            ""invoke"",\r\n            ""session.clj"",\r\n            408\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.session$bind_current_user$fn__77685"",\r\n            ""invoke"",\r\n            ""session.clj"",\r\n            445\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.session$wrap_current_user_info$fn__77664"",\r\n            ""invoke"",\r\n            ""session.clj"",\r\n            383\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.session$wrap_session_id$fn__77636"",\r\n            ""invoke"",\r\n            ""session.clj"",\r\n            259\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.auth$wrap_static_api_key$fn__97978"",\r\n            ""invoke"",\r\n            ""auth.clj"",\r\n            32\r\n        ],\r\n        [\r\n            ""ring.middleware.cookies$wrap_cookies$fn__114521"",\r\n            ""invoke"",\r\n            ""cookies.clj"",\r\n            200\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.misc$add_content_type$fn__70571"",\r\n            ""invoke"",\r\n            ""misc.clj"",\r\n            28\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.misc$disable_streaming_buffering$fn__70597"",\r\n            ""invoke"",\r\n            ""misc.clj"",\r\n            77\r\n        ],\r\n        [\r\n            ""ring.middleware.gzip$wrap_gzip$fn__114563"",\r\n            ""invoke"",\r\n            ""gzip.clj"",\r\n            86\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.misc$bind_request$fn__70600"",\r\n            ""invoke"",\r\n            ""misc.clj"",\r\n            94\r\n        ],\r\n        [\r\n            ""metabase.server.middleware.ssl$redirect_to_https_middleware$fn__114350"",\r\n            ""invoke"",\r\n            ""ssl.clj"",\r\n            51\r\n        ],\r\n        [\r\n            ""metabase.server$async_proxy_handler$fn__70935"",\r\n            ""invoke"",\r\n            ""server.clj"",\r\n            77\r\n        ],\r\n        [\r\n            ""metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a"",\r\n            ""handle"",\r\n            null,\r\n            -1\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.server.handler.StatisticsHandler"",\r\n            ""handle"",\r\n            ""StatisticsHandler.java"",\r\n            173\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.server.handler.HandlerWrapper"",\r\n            ""handle"",\r\n            ""HandlerWrapper.java"",\r\n            122\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.server.Server"",\r\n            ""handle"",\r\n            ""Server.java"",\r\n            563\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.server.HttpChannel$RequestDispatchable"",\r\n            ""dispatch"",\r\n            ""HttpChannel.java"",\r\n            1598\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.server.HttpChannel"",\r\n            ""dispatch"",\r\n            ""HttpChannel.java"",\r\n            753\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.server.HttpChannel"",\r\n            ""handle"",\r\n            ""HttpChannel.java"",\r\n            501\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.server.HttpConnection"",\r\n            ""onFillable"",\r\n            ""HttpConnection.java"",\r\n            287\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.io.AbstractConnection$ReadCallback"",\r\n            ""succeeded"",\r\n            ""AbstractConnection.java"",\r\n            314\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.io.FillInterest"",\r\n            ""fillable"",\r\n            ""FillInterest.java"",\r\n            100\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.io.SelectableChannelEndPoint$1"",\r\n            ""run"",\r\n            ""SelectableChannelEndPoint.java"",\r\n            53\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\r\n            ""runTask"",\r\n            ""AdaptiveExecutionStrategy.java"",\r\n            421\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\r\n            ""consumeTask"",\r\n            ""AdaptiveExecutionStrategy.java"",\r\n            390\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\r\n            ""tryProduce"",\r\n            ""AdaptiveExecutionStrategy.java"",\r\n            277\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\r\n            ""run"",\r\n            ""AdaptiveExecutionStrategy.java"",\r\n            199\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread"",\r\n            ""run"",\r\n            ""ReservedThreadExecutor.java"",\r\n            411\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.util.thread.QueuedThreadPool"",\r\n            ""runJob"",\r\n            ""QueuedThreadPool.java"",\r\n            969\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",\r\n            ""doRunJob"",\r\n            ""QueuedThreadPool.java"",\r\n            1194\r\n        ],\r\n        [\r\n            ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",\r\n            ""run"",\r\n            ""QueuedThreadPool.java"",\r\n            1149\r\n        ],\r\n        [\r\n            ""java.lang.Thread"",\r\n            ""run"",\r\n            null,\r\n            -1\r\n        ]\r\n    ],\r\n    ""cause"": ""Don\'t know how to create ISeq from: clojure.lang.Symbol"",\r\n    ""message"": ""Exception at /dashboard/{id}/params/{param-key}/search/{query}""\r\n}\r\n```', 'created_at': datetime.datetime(2024, 8, 19, 15, 14, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2301288419, 'issue_id': 2469006352, 'author': '0t3dWCE', 'body': 'Same issue here\r\nmetabase/metabase:v0.50.20.3\r\n\r\nlogs from container\r\n```\r\n2024-08-21 07:00:51,976 ERROR middleware.log :: GET /api/docs/openapi.json 500 52.1 ms (0 DB calls) {:metabase-user-id 106}\r\n{:via\r\n [{:type clojure.lang.ExceptionInfo,\r\n   :message ""Exception at /dashboard/{id}/params/{param-key}/search/{query}"",\r\n   :data {},\r\n   :at [metabase.api.common.openapi$openapi_object$iter__45360__45364$fn__45365$fn__45372 invoke ""openapi.clj"" 199]}\r\n  {:type java.lang.IllegalArgumentException,\r\n   :message ""Don\'t know how to create ISeq from: clojure.lang.Symbol"",\r\n   :at [clojure.lang.RT seqFrom ""RT.java"" 557]}],\r\n :trace\r\n [[clojure.lang.RT seqFrom ""RT.java"" 557]\r\n  [clojure.lang.RT seq ""RT.java"" 537]\r\n  [clojure.lang.RT vals ""RT.java"" 631]\r\n  [clojure.core$vals invokeStatic ""core.clj"" 1580]\r\n  [clojure.core$vals invoke ""core.clj"" 1576]\r\n  [metabase.api.common.openapi$compojure_query_params invokeStatic ""openapi.clj"" 128]\r\n  [metabase.api.common.openapi$compojure_query_params invoke ""openapi.clj"" 111]\r\n  [metabase.api.common.openapi$schema__GT_params invokeStatic ""openapi.clj"" 149]\r\n  [metabase.api.common.openapi$schema__GT_params invoke ""openapi.clj"" 143]\r\n  [metabase.api.common.openapi$defendpoint__GT_path_item invokeStatic ""openapi.clj"" 167]\r\n  [metabase.api.common.openapi$defendpoint__GT_path_item invoke ""openapi.clj"" 161]\r\n  [metabase.api.common.openapi$openapi_object$iter__45360__45364$fn__45365$fn__45372 invoke ""openapi.clj"" 197]\r\n  [metabase.api.common.openapi$openapi_object$iter__45360__45364$fn__45365 invoke ""openapi.clj"" 196]\r\n  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]\r\n  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]\r\n  [clojure.lang.Cons next ""Cons.java"" 39]\r\n  [clojure.lang.RT next ""RT.java"" 713]\r\n  [clojure.core$next__5451 invokeStatic ""core.clj"" 64]\r\n  [clojure.core.protocols$fn__8249 invokeStatic ""protocols.clj"" 169]\r\n  [clojure.core.protocols$fn__8249 invoke ""protocols.clj"" 124]\r\n  [clojure.core.protocols$fn__8204$G__8199__8213 invoke ""protocols.clj"" 19]\r\n  [clojure.core.protocols$seq_reduce invokeStatic ""protocols.clj"" 31]\r\n  [clojure.core.protocols$fn__8236 invokeStatic ""protocols.clj"" 75]\r\n  [clojure.core.protocols$fn__8236 invoke ""protocols.clj"" 75]\r\n  [clojure.core.protocols$fn__8178$G__8173__8191 invoke ""protocols.clj"" 13]\r\n  [clojure.core$reduce invokeStatic ""core.clj"" 6887]\r\n  [clojure.core$reduce invoke ""core.clj"" 6869]\r\n  [metabase.api.common.openapi$openapi_object invokeStatic ""openapi.clj"" 192]\r\n  [metabase.api.common.openapi$openapi_object invoke ""openapi.clj"" 185]\r\n  [metabase.api.routes$fn__104836 invokeStatic ""routes.clj"" 94]\r\n  [metabase.api.routes$fn__104836 invoke ""routes.clj"" 75]\r\n  [compojure.core$wrap_response$fn__52963 invoke ""core.clj"" 160]\r\n  [compojure.core$wrap_route_middleware$fn__52947 invoke ""core.clj"" 132]\r\n  [compojure.core$wrap_route_info$fn__52952 invoke ""core.clj"" 139]\r\n  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 151]\r\n  [clojure.lang.Var invoke ""Var.java"" 393]\r\n  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]\r\n  [metabase.api.routes$fn__104829$fn__104832 invoke ""routes.clj"" 73]\r\n  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]\r\n  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]\r\n  [clojure.lang.AFn applyTo ""AFn.java"" 144]\r\n  [clojure.core$apply invokeStatic ""core.clj"" 667]\r\n  [clojure.core$apply invoke ""core.clj"" 662]\r\n  [metabase.server.routes$fn__105109$fn__105110 doInvoke ""routes.clj"" 73]\r\n  [clojure.lang.RestFn invoke ""RestFn.java"" 436]\r\n  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]\r\n  [compojure.core$make_context$handler__53003 invoke ""core.clj"" 290]\r\n  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 300]\r\n  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]\r\n  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 153]\r\n  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]\r\n  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]\r\n  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]\r\n  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]\r\n  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]\r\n  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]\r\n  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]\r\n  [metabase.server.routes$fn__105092$fn__105094 invoke ""routes.clj"" 47]\r\n  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]\r\n  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]\r\n  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__101223 invoke ""exceptions.clj"" 107]\r\n  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__101220 invoke ""exceptions.clj"" 96]\r\n  [metabase.server.middleware.log$log_api_call$fn__105389$fn__105390$fn__105391 invoke ""log.clj"" 236]\r\n  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]\r\n  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]\r\n  [metabase.server.middleware.log$log_api_call$fn__105389$fn__105390 invoke ""log.clj"" 227]\r\n  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]\r\n  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]\r\n  [metabase.server.middleware.log$log_api_call$fn__105389 invoke ""log.clj"" 226]\r\n  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__108659 invoke ""browser_cookie.clj"" 40]\r\n  [metabase.server.middleware.security$add_security_headers$fn__101179 invoke ""security.clj"" 241]\r\n  [ring.middleware.json$wrap_json_body$fn__108918 invoke ""json.clj"" 64]\r\n  [metabase.server.middleware.offset_paging$handle_paging$fn__87426 invoke ""offset_paging.clj"" 43]\r\n  [metabase.server.middleware.json$wrap_streamed_json_response$fn__54570 invoke ""json.clj"" 83]\r\n  [ring.middleware.keyword_params$wrap_keyword_params$fn__109007 invoke ""keyword_params.clj"" 55]\r\n  [ring.middleware.params$wrap_params$fn__109026 invoke ""params.clj"" 77]\r\n  [metabase.server.middleware.misc$maybe_set_site_url$fn__70659 invoke ""misc.clj"" 60]\r\n  [metabase.server.middleware.session$reset_session_timeout$fn__77747 invoke ""session.clj"" 552]\r\n  [metabase.server.middleware.session$bind_current_user$fn__77713$fn__77714 invoke ""session.clj"" 446]\r\n  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 425]\r\n  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 408]\r\n  [metabase.server.middleware.session$bind_current_user$fn__77713 invoke ""session.clj"" 445]\r\n  [metabase.server.middleware.session$wrap_current_user_info$fn__77692 invoke ""session.clj"" 383]\r\n  [metabase.server.middleware.session$wrap_session_id$fn__77664 invoke ""session.clj"" 259]\r\n  [metabase.server.middleware.auth$wrap_static_api_key$fn__97261 invoke ""auth.clj"" 32]\r\n  [ring.middleware.cookies$wrap_cookies$fn__108846 invoke ""cookies.clj"" 200]\r\n  [metabase.server.middleware.misc$add_content_type$fn__70641 invoke ""misc.clj"" 28]\r\n  [metabase.server.middleware.misc$disable_streaming_buffering$fn__70667 invoke ""misc.clj"" 77]\r\n  [ring.middleware.gzip$wrap_gzip$fn__108888 invoke ""gzip.clj"" 86]\r\n  [metabase.server.middleware.misc$bind_request$fn__70670 invoke ""misc.clj"" 94]\r\n  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__108675 invoke ""ssl.clj"" 41]\r\n  [metabase.server$async_proxy_handler$fn__71005 invoke ""server.clj"" 77]\r\n  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]\r\n  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]\r\n  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]\r\n  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]\r\n  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]\r\n  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]\r\n  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]\r\n  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]\r\n  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]\r\n  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]\r\n  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]\r\n  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]\r\n  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]\r\n  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]\r\n  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]\r\n  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]\r\n  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]\r\n  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]\r\n  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]\r\n  [java.lang.Thread run nil -1]],\r\n :cause ""Don\'t know how to create ISeq from: clojure.lang.Symbol"",\r\n :message ""Exception at /dashboard/{id}/params/{param-key}/search/{query}""}\r\n```', 'created_at': datetime.datetime(2024, 8, 21, 7, 3, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2302975660, 'issue_id': 2469006352, 'author': 'ASRodrigo1', 'body': ""Hi, @taytestokes-aumni \r\nIt didn't work."", 'created_at': datetime.datetime(2024, 8, 21, 20, 40, 37, tzinfo=datetime.timezone.utc)}]","piranha (Assginee) on (2024-08-16 10:35:15 UTC): @taytestokes-aumni if you could post full JSON of that error somewhere that would be helpful, since I can't reproduce this locally...

taytestokes-aumni (Issue Creator) on (2024-08-19 15:14:54 UTC): @piranha sorry about that, here's the json!

```json
{
    ""via"": [
        {
            ""type"": ""clojure.lang.ExceptionInfo"",
            ""message"": ""Exception at /dashboard/{id}/params/{param-key}/search/{query}"",
            ""data"": {},
            ""at"": [
                ""metabase.api.common.openapi$openapi_object$iter__45361__45365$fn__45366$fn__45373"",
                ""invoke"",
                ""openapi.clj"",
                199
            ]
        },
        {
            ""type"": ""java.lang.IllegalArgumentException"",
            ""message"": ""Don't know how to create ISeq from: clojure.lang.Symbol"",
            ""at"": [
                ""clojure.lang.RT"",
                ""seqFrom"",
                ""RT.java"",
                557
            ]
        }
    ],
    ""trace"": [
        [
            ""clojure.lang.RT"",
            ""seqFrom"",
            ""RT.java"",
            557
        ],
        [
            ""clojure.lang.RT"",
            ""seq"",
            ""RT.java"",
            537
        ],
        [
            ""clojure.lang.RT"",
            ""vals"",
            ""RT.java"",
            631
        ],
        [
            ""clojure.core$vals"",
            ""invokeStatic"",
            ""core.clj"",
            1580
        ],
        [
            ""clojure.core$vals"",
            ""invoke"",
            ""core.clj"",
            1576
        ],
        [
            ""metabase.api.common.openapi$compojure_query_params"",
            ""invokeStatic"",
            ""openapi.clj"",
            128
        ],
        [
            ""metabase.api.common.openapi$compojure_query_params"",
            ""invoke"",
            ""openapi.clj"",
            111
        ],
        [
            ""metabase.api.common.openapi$schema__GT_params"",
            ""invokeStatic"",
            ""openapi.clj"",
            149
        ],
        [
            ""metabase.api.common.openapi$schema__GT_params"",
            ""invoke"",
            ""openapi.clj"",
            143
        ],
        [
            ""metabase.api.common.openapi$defendpoint__GT_path_item"",
            ""invokeStatic"",
            ""openapi.clj"",
            167
        ],
        [
            ""metabase.api.common.openapi$defendpoint__GT_path_item"",
            ""invoke"",
            ""openapi.clj"",
            161
        ],
        [
            ""metabase.api.common.openapi$openapi_object$iter__45361__45365$fn__45366$fn__45373"",
            ""invoke"",
            ""openapi.clj"",
            197
        ],
        [
            ""metabase.api.common.openapi$openapi_object$iter__45361__45365$fn__45366"",
            ""invoke"",
            ""openapi.clj"",
            196
        ],
        [
            ""clojure.lang.LazySeq"",
            ""sval"",
            ""LazySeq.java"",
            42
        ],
        [
            ""clojure.lang.LazySeq"",
            ""seq"",
            ""LazySeq.java"",
            51
        ],
        [
            ""clojure.lang.Cons"",
            ""next"",
            ""Cons.java"",
            39
        ],
        [
            ""clojure.lang.RT"",
            ""next"",
            ""RT.java"",
            713
        ],
        [
            ""clojure.core$next__5451"",
            ""invokeStatic"",
            ""core.clj"",
            64
        ],
        [
            ""clojure.core.protocols$fn__8249"",
            ""invokeStatic"",
            ""protocols.clj"",
            169
        ],
        [
            ""clojure.core.protocols$fn__8249"",
            ""invoke"",
            ""protocols.clj"",
            124
        ],
        [
            ""clojure.core.protocols$fn__8204$G__8199__8213"",
            ""invoke"",
            ""protocols.clj"",
            19
        ],
        [
            ""clojure.core.protocols$seq_reduce"",
            ""invokeStatic"",
            ""protocols.clj"",
            31
        ],
        [
            ""clojure.core.protocols$fn__8236"",
            ""invokeStatic"",
            ""protocols.clj"",
            75
        ],
        [
            ""clojure.core.protocols$fn__8236"",
            ""invoke"",
            ""protocols.clj"",
            75
        ],
        [
            ""clojure.core.protocols$fn__8178$G__8173__8191"",
            ""invoke"",
            ""protocols.clj"",
            13
        ],
        [
            ""clojure.core$reduce"",
            ""invokeStatic"",
            ""core.clj"",
            6887
        ],
        [
            ""clojure.core$reduce"",
            ""invoke"",
            ""core.clj"",
            6869
        ],
        [
            ""metabase.api.common.openapi$openapi_object"",
            ""invokeStatic"",
            ""openapi.clj"",
            192
        ],
        [
            ""metabase.api.common.openapi$openapi_object"",
            ""invoke"",
            ""openapi.clj"",
            185
        ],
        [
            ""metabase.api.routes$fn__105553"",
            ""invokeStatic"",
            ""routes.clj"",
            94
        ],
        [
            ""metabase.api.routes$fn__105553"",
            ""invoke"",
            ""routes.clj"",
            75
        ],
        [
            ""compojure.core$wrap_response$fn__52963"",
            ""invoke"",
            ""core.clj"",
            160
        ],
        [
            ""compojure.core$wrap_route_middleware$fn__52947"",
            ""invoke"",
            ""core.clj"",
            132
        ],
        [
            ""compojure.core$wrap_route_info$fn__52952"",
            ""invoke"",
            ""core.clj"",
            139
        ],
        [
            ""compojure.core$wrap_route_matches$fn__52956"",
            ""invoke"",
            ""core.clj"",
            151
        ],
        [
            ""clojure.lang.Var"",
            ""invoke"",
            ""Var.java"",
            393
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            199
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__53007"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            31
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            436
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            199
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__53007"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__53007"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            199
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__53007"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""metabase.api.routes$fn__105546$fn__105547"",
            ""invoke"",
            ""routes.clj"",
            70
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            31
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            436
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.core$apply"",
            ""invokeStatic"",
            ""core.clj"",
            667
        ],
        [
            ""clojure.core$apply"",
            ""invoke"",
            ""core.clj"",
            662
        ],
        [
            ""metabase.server.routes$fn__105826$fn__105827"",
            ""doInvoke"",
            ""routes.clj"",
            73
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            436
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""compojure.core$make_context$handler__53003"",
            ""invoke"",
            ""core.clj"",
            290
        ],
        [
            ""compojure.core$make_context$fn__53007"",
            ""invoke"",
            ""core.clj"",
            300
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$wrap_route_matches$fn__52956"",
            ""invoke"",
            ""core.clj"",
            153
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$wrap_route_matches$fn__52956"",
            ""invoke"",
            ""core.clj"",
            152
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$wrap_route_matches$fn__52956"",
            ""invoke"",
            ""core.clj"",
            152
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$wrap_route_matches$fn__52956"",
            ""invoke"",
            ""core.clj"",
            152
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            199
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            199
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            199
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__53007"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""compojure.core$make_context$handler__53003"",
            ""invoke"",
            ""core.clj"",
            290
        ],
        [
            ""compojure.core$make_context$fn__53007"",
            ""invoke"",
            ""core.clj"",
            300
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__53007"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""compojure.core$routes$fn__52975$f__52976"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__52975"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__101940"",
            ""invoke"",
            ""exceptions.clj"",
            107
        ],
        [
            ""metabase.server.middleware.exceptions$catch_api_exceptions$fn__101937"",
            ""invoke"",
            ""exceptions.clj"",
            96
        ],
        [
            ""metabase.server.middleware.log$log_api_call$fn__108175$fn__108176$fn__108177"",
            ""invoke"",
            ""log.clj"",
            236
        ],
        [
            ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",
            ""invokeStatic"",
            ""diagnostic.clj"",
            18
        ],
        [
            ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",
            ""invoke"",
            ""diagnostic.clj"",
            12
        ],
        [
            ""metabase.server.middleware.log$log_api_call$fn__108175$fn__108176"",
            ""invoke"",
            ""log.clj"",
            227
        ],
        [
            ""toucan2.execute$do_with_call_counts"",
            ""invokeStatic"",
            ""execute.clj"",
            112
        ],
        [
            ""toucan2.execute$do_with_call_counts"",
            ""invoke"",
            ""execute.clj"",
            103
        ],
        [
            ""metabase.server.middleware.log$log_api_call$fn__108175"",
            ""invoke"",
            ""log.clj"",
            226
        ],
        [
            ""metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__114334"",
            ""invoke"",
            ""browser_cookie.clj"",
            40
        ],
        [
            ""metabase.server.middleware.security$add_security_headers$fn__101896"",
            ""invoke"",
            ""security.clj"",
            240
        ],
        [
            ""ring.middleware.json$wrap_json_body$fn__114593"",
            ""invoke"",
            ""json.clj"",
            64
        ],
        [
            ""metabase.server.middleware.offset_paging$handle_paging$fn__88143"",
            ""invoke"",
            ""offset_paging.clj"",
            43
        ],
        [
            ""metabase.server.middleware.json$wrap_streamed_json_response$fn__54496"",
            ""invoke"",
            ""json.clj"",
            83
        ],
        [
            ""ring.middleware.keyword_params$wrap_keyword_params$fn__114682"",
            ""invoke"",
            ""keyword_params.clj"",
            55
        ],
        [
            ""ring.middleware.params$wrap_params$fn__114701"",
            ""invoke"",
            ""params.clj"",
            77
        ],
        [
            ""metabase.server.middleware.misc$maybe_set_site_url$fn__70589"",
            ""invoke"",
            ""misc.clj"",
            60
        ],
        [
            ""metabase.server.middleware.session$reset_session_timeout$fn__77719"",
            ""invoke"",
            ""session.clj"",
            552
        ],
        [
            ""metabase.server.middleware.session$bind_current_user$fn__77685$fn__77686"",
            ""invoke"",
            ""session.clj"",
            446
        ],
        [
            ""metabase.server.middleware.session$do_with_current_user"",
            ""invokeStatic"",
            ""session.clj"",
            425
        ],
        [
            ""metabase.server.middleware.session$do_with_current_user"",
            ""invoke"",
            ""session.clj"",
            408
        ],
        [
            ""metabase.server.middleware.session$bind_current_user$fn__77685"",
            ""invoke"",
            ""session.clj"",
            445
        ],
        [
            ""metabase.server.middleware.session$wrap_current_user_info$fn__77664"",
            ""invoke"",
            ""session.clj"",
            383
        ],
        [
            ""metabase.server.middleware.session$wrap_session_id$fn__77636"",
            ""invoke"",
            ""session.clj"",
            259
        ],
        [
            ""metabase.server.middleware.auth$wrap_static_api_key$fn__97978"",
            ""invoke"",
            ""auth.clj"",
            32
        ],
        [
            ""ring.middleware.cookies$wrap_cookies$fn__114521"",
            ""invoke"",
            ""cookies.clj"",
            200
        ],
        [
            ""metabase.server.middleware.misc$add_content_type$fn__70571"",
            ""invoke"",
            ""misc.clj"",
            28
        ],
        [
            ""metabase.server.middleware.misc$disable_streaming_buffering$fn__70597"",
            ""invoke"",
            ""misc.clj"",
            77
        ],
        [
            ""ring.middleware.gzip$wrap_gzip$fn__114563"",
            ""invoke"",
            ""gzip.clj"",
            86
        ],
        [
            ""metabase.server.middleware.misc$bind_request$fn__70600"",
            ""invoke"",
            ""misc.clj"",
            94
        ],
        [
            ""metabase.server.middleware.ssl$redirect_to_https_middleware$fn__114350"",
            ""invoke"",
            ""ssl.clj"",
            51
        ],
        [
            ""metabase.server$async_proxy_handler$fn__70935"",
            ""invoke"",
            ""server.clj"",
            77
        ],
        [
            ""metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a"",
            ""handle"",
            null,
            -1
        ],
        [
            ""org.eclipse.jetty.server.handler.StatisticsHandler"",
            ""handle"",
            ""StatisticsHandler.java"",
            173
        ],
        [
            ""org.eclipse.jetty.server.handler.HandlerWrapper"",
            ""handle"",
            ""HandlerWrapper.java"",
            122
        ],
        [
            ""org.eclipse.jetty.server.Server"",
            ""handle"",
            ""Server.java"",
            563
        ],
        [
            ""org.eclipse.jetty.server.HttpChannel$RequestDispatchable"",
            ""dispatch"",
            ""HttpChannel.java"",
            1598
        ],
        [
            ""org.eclipse.jetty.server.HttpChannel"",
            ""dispatch"",
            ""HttpChannel.java"",
            753
        ],
        [
            ""org.eclipse.jetty.server.HttpChannel"",
            ""handle"",
            ""HttpChannel.java"",
            501
        ],
        [
            ""org.eclipse.jetty.server.HttpConnection"",
            ""onFillable"",
            ""HttpConnection.java"",
            287
        ],
        [
            ""org.eclipse.jetty.io.AbstractConnection$ReadCallback"",
            ""succeeded"",
            ""AbstractConnection.java"",
            314
        ],
        [
            ""org.eclipse.jetty.io.FillInterest"",
            ""fillable"",
            ""FillInterest.java"",
            100
        ],
        [
            ""org.eclipse.jetty.io.SelectableChannelEndPoint$1"",
            ""run"",
            ""SelectableChannelEndPoint.java"",
            53
        ],
        [
            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
            ""runTask"",
            ""AdaptiveExecutionStrategy.java"",
            421
        ],
        [
            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
            ""consumeTask"",
            ""AdaptiveExecutionStrategy.java"",
            390
        ],
        [
            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
            ""tryProduce"",
            ""AdaptiveExecutionStrategy.java"",
            277
        ],
        [
            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
            ""run"",
            ""AdaptiveExecutionStrategy.java"",
            199
        ],
        [
            ""org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread"",
            ""run"",
            ""ReservedThreadExecutor.java"",
            411
        ],
        [
            ""org.eclipse.jetty.util.thread.QueuedThreadPool"",
            ""runJob"",
            ""QueuedThreadPool.java"",
            969
        ],
        [
            ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",
            ""doRunJob"",
            ""QueuedThreadPool.java"",
            1194
        ],
        [
            ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",
            ""run"",
            ""QueuedThreadPool.java"",
            1149
        ],
        [
            ""java.lang.Thread"",
            ""run"",
            null,
            -1
        ]
    ],
    ""cause"": ""Don't know how to create ISeq from: clojure.lang.Symbol"",
    ""message"": ""Exception at /dashboard/{id}/params/{param-key}/search/{query}""
}
```

0t3dWCE on (2024-08-21 07:03:45 UTC): Same issue here
metabase/metabase:v0.50.20.3

logs from container
```
2024-08-21 07:00:51,976 ERROR middleware.log :: GET /api/docs/openapi.json 500 52.1 ms (0 DB calls) {:metabase-user-id 106}
{:via
 [{:type clojure.lang.ExceptionInfo,
   :message ""Exception at /dashboard/{id}/params/{param-key}/search/{query}"",
   :data {},
   :at [metabase.api.common.openapi$openapi_object$iter__45360__45364$fn__45365$fn__45372 invoke ""openapi.clj"" 199]}
  {:type java.lang.IllegalArgumentException,
   :message ""Don't know how to create ISeq from: clojure.lang.Symbol"",
   :at [clojure.lang.RT seqFrom ""RT.java"" 557]}],
 :trace
 [[clojure.lang.RT seqFrom ""RT.java"" 557]
  [clojure.lang.RT seq ""RT.java"" 537]
  [clojure.lang.RT vals ""RT.java"" 631]
  [clojure.core$vals invokeStatic ""core.clj"" 1580]
  [clojure.core$vals invoke ""core.clj"" 1576]
  [metabase.api.common.openapi$compojure_query_params invokeStatic ""openapi.clj"" 128]
  [metabase.api.common.openapi$compojure_query_params invoke ""openapi.clj"" 111]
  [metabase.api.common.openapi$schema__GT_params invokeStatic ""openapi.clj"" 149]
  [metabase.api.common.openapi$schema__GT_params invoke ""openapi.clj"" 143]
  [metabase.api.common.openapi$defendpoint__GT_path_item invokeStatic ""openapi.clj"" 167]
  [metabase.api.common.openapi$defendpoint__GT_path_item invoke ""openapi.clj"" 161]
  [metabase.api.common.openapi$openapi_object$iter__45360__45364$fn__45365$fn__45372 invoke ""openapi.clj"" 197]
  [metabase.api.common.openapi$openapi_object$iter__45360__45364$fn__45365 invoke ""openapi.clj"" 196]
  [clojure.lang.LazySeq sval ""LazySeq.java"" 42]
  [clojure.lang.LazySeq seq ""LazySeq.java"" 51]
  [clojure.lang.Cons next ""Cons.java"" 39]
  [clojure.lang.RT next ""RT.java"" 713]
  [clojure.core$next__5451 invokeStatic ""core.clj"" 64]
  [clojure.core.protocols$fn__8249 invokeStatic ""protocols.clj"" 169]
  [clojure.core.protocols$fn__8249 invoke ""protocols.clj"" 124]
  [clojure.core.protocols$fn__8204$G__8199__8213 invoke ""protocols.clj"" 19]
  [clojure.core.protocols$seq_reduce invokeStatic ""protocols.clj"" 31]
  [clojure.core.protocols$fn__8236 invokeStatic ""protocols.clj"" 75]
  [clojure.core.protocols$fn__8236 invoke ""protocols.clj"" 75]
  [clojure.core.protocols$fn__8178$G__8173__8191 invoke ""protocols.clj"" 13]
  [clojure.core$reduce invokeStatic ""core.clj"" 6887]
  [clojure.core$reduce invoke ""core.clj"" 6869]
  [metabase.api.common.openapi$openapi_object invokeStatic ""openapi.clj"" 192]
  [metabase.api.common.openapi$openapi_object invoke ""openapi.clj"" 185]
  [metabase.api.routes$fn__104836 invokeStatic ""routes.clj"" 94]
  [metabase.api.routes$fn__104836 invoke ""routes.clj"" 75]
  [compojure.core$wrap_response$fn__52963 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__52947 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__52952 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 393]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [metabase.api.routes$fn__104829$fn__104832 invoke ""routes.clj"" 73]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__105109$fn__105110 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 436]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53003 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53007 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__52956 invoke ""core.clj"" 152]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975$f__52976$respond_SINGLEQUOTE___52977 invoke ""core.clj"" 197]
  [metabase.server.routes$fn__105092$fn__105094 invoke ""routes.clj"" 47]
  [compojure.core$routes$fn__52975$f__52976 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__52975 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__101223 invoke ""exceptions.clj"" 107]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__101220 invoke ""exceptions.clj"" 96]
  [metabase.server.middleware.log$log_api_call$fn__105389$fn__105390$fn__105391 invoke ""log.clj"" 236]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 18]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__105389$fn__105390 invoke ""log.clj"" 227]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__105389 invoke ""log.clj"" 226]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__108659 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__101179 invoke ""security.clj"" 241]
  [ring.middleware.json$wrap_json_body$fn__108918 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__87426 invoke ""offset_paging.clj"" 43]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__54570 invoke ""json.clj"" 83]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__109007 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__109026 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__70659 invoke ""misc.clj"" 60]
  [metabase.server.middleware.session$reset_session_timeout$fn__77747 invoke ""session.clj"" 552]
  [metabase.server.middleware.session$bind_current_user$fn__77713$fn__77714 invoke ""session.clj"" 446]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 425]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 408]
  [metabase.server.middleware.session$bind_current_user$fn__77713 invoke ""session.clj"" 445]
  [metabase.server.middleware.session$wrap_current_user_info$fn__77692 invoke ""session.clj"" 383]
  [metabase.server.middleware.session$wrap_session_id$fn__77664 invoke ""session.clj"" 259]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__97261 invoke ""auth.clj"" 32]
  [ring.middleware.cookies$wrap_cookies$fn__108846 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__70641 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__70667 invoke ""misc.clj"" 77]
  [ring.middleware.gzip$wrap_gzip$fn__108888 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.misc$bind_request$fn__70670 invoke ""misc.clj"" 94]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__108675 invoke ""ssl.clj"" 41]
  [metabase.server$async_proxy_handler$fn__71005 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run nil -1]],
 :cause ""Don't know how to create ISeq from: clojure.lang.Symbol"",
 :message ""Exception at /dashboard/{id}/params/{param-key}/search/{query}""}
```

ASRodrigo1 on (2024-08-21 20:40:37 UTC): Hi, @taytestokes-aumni 
It didn't work.

"
2468489770,issue,closed,completed,Editing the Title in Dashboard Visualizations May Remove 3-Dot Edit Menu,"### Describe the bug

It appears that editing the Title for a card from the dashboard’s visualization options could remove the 3-dot edit menu for that card afterwards.
I haven’t tested all visualizations, just Bar, Line, and Combo.
This doesn’t happen with the Table visualization.

I'm testing this on 1.50.20 where it is happening.
This does NOT happen on 1.49.22.




### To Reproduce


1. Create question, summarize by a value, and visualize using bar chart.
2. Add to dashboard
3. Edit dashboard → click on Visualization Options for the card, clear the contents within the Title field → Save.
4. 3-dot menu for the card to Edit the question and Download the results is no longer there.


Here's a Loom
https://www.loom.com/share/6089f9ce608148c5b23fdbcf5b5e36a5


### Expected behavior

For non Table visualizations to maintain the 3-dot menu in this circumstance

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.22+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.22"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.22+7"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""14.5"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Chicago""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres"",
      ""bigquery-cloud-sdk"",
      ""athena"",
      ""sqlserver""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.3""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-08-13"",
      ""tag"": ""v1.50.20"",
      ""hash"": ""df82d58""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

P3 - An issue if you remove titles from your cards and want to easily edit or download from the question

### Additional context

_No response_",FilmonK,2024-08-15 16:59:07+00:00,[],2025-01-22 10:10:02+00:00,2025-01-22 09:37:32+00:00,https://github.com/metabase/metabase/issues/46897,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Reporting/Dashboards', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Reproduced', 'Issues reproduced in test (usually Cypress)'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2297128395, 'issue_id': 2468489770, 'author': 'cdeweyx', 'body': 'Able to repro on master but only when title is fully removed', 'created_at': datetime.datetime(2024, 8, 19, 17, 58, 32, tzinfo=datetime.timezone.utc)}]","cdeweyx on (2024-08-19 17:58:32 UTC): Able to repro on master but only when title is fully removed

"
2468445352,issue,open,,Subtotals for Column Dimensions in Pivot Table,"**Is your feature request related to a problem? Please describe.**
Currently in pivots you can turn on totals for rows or columns. For dimensions in the rows you get subtotals but for dimensions in columns you do not.

**Describe the solution you'd like**
We would like to be able to add subtotals for both row and column dimensions. Granular control over which dimensions have subtotals would be preferred.

**Describe alternatives you've considered**
Using pivots in Excel

**How important is this feature to you?**
This can be done in many other tools - it's a common feature of pivot tables and it feels weird to not be able to do it.

",ixipixi,2024-08-15 16:33:39+00:00,[],2025-02-04 20:31:54+00:00,,https://github.com/metabase/metabase/issues/46896,"[('Type:New Feature', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations')]","[{'comment_id': 2450875276, 'issue_id': 2468445352, 'author': 'ixipixi', 'body': ""A more explicit use case for granular control over totals and subtotals:\n\nOne of our users is dealing with multiple currencies across a single column. Essentially they have a base currency column and a local currency column (dollars, euros, etc). It makes sense for totals to be displayed for the base currency because it's all the same currency. However, it makes no sense for the totals to be displayed for the column that houses a variety of different currencies."", 'created_at': datetime.datetime(2024, 10, 31, 21, 54, 18, tzinfo=datetime.timezone.utc)}]","ixipixi (Issue Creator) on (2024-10-31 21:54:18 UTC): A more explicit use case for granular control over totals and subtotals:

One of our users is dealing with multiple currencies across a single column. Essentially they have a base currency column and a local currency column (dollars, euros, etc). It makes sense for totals to be displayed for the base currency because it's all the same currency. However, it makes no sense for the totals to be displayed for the column that houses a variety of different currencies.

"
2468286524,issue,closed,completed,Question sharing modal appears in top left of screen,"### Context
Clicking on the ""Sharing"" icon in the bottom right of a saved question makes the modal appear far far away in the top left of the screen. Reproducible on master.



![Image](https://github.com/user-attachments/assets/77a317cf-7749-44b1-9c4c-37547c4ddcf1)
![Image](https://github.com/user-attachments/assets/a9eb148d-b3c0-4eda-be8f-aeb983cb27fc)

",cdeweyx,2024-08-15 15:20:12+00:00,['oisincoveney'],2024-10-08 16:16:51+00:00,2024-08-21 14:36:14+00:00,https://github.com/metabase/metabase/issues/46893,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', ''), ('Sharing/Public', '')]",[],
2468286280,issue,closed,completed,"Combined card fails on scheduled subscription (not on the ""send now"" test)","### Describe the bug

Combining 2 cards make the subscription to fail, but only if the subscription is scheduled, not when you click the ""send now"" button

### To Reproduce

1) create 2 questions: sum of total per month and sum of subtotal per month
2) combine those on the dashboard
3) create a subscription, but schedule it, don't send it with the send now button

### Expected behavior

It should work both on the send now and the scheduled subscription

### Logs

```
2024-08-15 15:00:00,080 ERROR pulse.render :: Pulse card render error
clojure.lang.ExceptionInfo: You don't have permissions to do that. {:status-code 403}
	at metabase.api.common$check_one.invokeStatic(common.clj:106)
	at metabase.api.common$check_one.invoke(common.clj:100)
	at metabase.api.common$check.invokeStatic(common.clj:136)
	at metabase.api.common$check.doInvoke(common.clj:109)
	at clojure.lang.RestFn.invoke(RestFn.java:423)
	at metabase.api.common$check_403.invokeStatic(common.clj:238)
	at metabase.api.common$check_403.invoke(common.clj:235)
	at metabase.api.common$read_check$fn__53247.invoke(common.clj:461)
	at metabase.api.common$read_check.invokeStatic(common.clj:460)
	at metabase.api.common$read_check.invoke(common.clj:453)
	at metabase.api.common$read_check.invokeStatic(common.clj:470)
	at metabase.api.common$read_check.invoke(common.clj:453)
	at metabase.query_processor.dashboard$process_query_for_dashcard.invokeStatic(dashboard.clj:180)
	at metabase.query_processor.dashboard$process_query_for_dashcard.doInvoke(dashboard.clj:163)
	at clojure.lang.RestFn.invoke(RestFn.java:2088)
	at metabase.pulse.util$execute_dashboard_subscription_card$result_fn__102112.invoke(util.clj:76)
	at clojure.core$comp$fn__5876.invoke(core.clj:2586)
	at clojure.core$map$fn__5935.invoke(core.clj:2770)
	at clojure.lang.LazySeq.sval(LazySeq.java:42)
	at clojure.lang.LazySeq.seq(LazySeq.java:51)
	at clojure.lang.RT.seq(RT.java:535)
	at clojure.core$seq__5467.invokeStatic(core.clj:139)
	at clojure.core$map$fn__5935.invoke(core.clj:2763)
	at clojure.lang.LazySeq.sval(LazySeq.java:42)
	at clojure.lang.LazySeq.seq(LazySeq.java:51)
	at clojure.lang.RT.seq(RT.java:535)
	at clojure.core$seq__5467.invokeStatic(core.clj:139)
	at clojure.core$map$fn__5935.invoke(core.clj:2763)
	at clojure.lang.LazySeq.sval(LazySeq.java:42)
	at clojure.lang.LazySeq.seq(LazySeq.java:51)
	at clojure.lang.RT.seq(RT.java:535)
	at clojure.lang.RT.nthFrom(RT.java:982)
	at clojure.lang.RT.nth(RT.java:940)
	at medley.core$distinct_by$step__10981$fn__10982$fn__10984.invoke(core.cljc:294)
	at medley.core$distinct_by$step__10981$fn__10982.invoke(core.cljc:294)
	at clojure.lang.LazySeq.sval(LazySeq.java:42)
	at clojure.lang.LazySeq.seq(LazySeq.java:51)
	at clojure.lang.Cons.next(Cons.java:39)
	at clojure.lang.RT.next(RT.java:713)
	at clojure.core$next__5451.invokeStatic(core.clj:64)
	at clojure.core.protocols$fn__8249.invokeStatic(protocols.clj:169)
	at clojure.core.protocols$fn__8249.invoke(protocols.clj:124)
	at clojure.core.protocols$fn__8204$G__8199__8213.invoke(protocols.clj:19)
	at clojure.core.protocols$seq_reduce.invokeStatic(protocols.clj:31)
	at clojure.core.protocols$fn__8236.invokeStatic(protocols.clj:75)
	at clojure.core.protocols$fn__8236.invoke(protocols.clj:75)
	at clojure.core.protocols$fn__8178$G__8173__8191.invoke(protocols.clj:13)
	at clojure.core$reduce.invokeStatic(core.clj:6887)
	at clojure.core$reduce.invoke(core.clj:6869)
	at cheshire.generate$generate.invokeStatic(generate.clj:133)
	at cheshire.generate$generate.invoke(generate.clj:119)
	at cheshire.core$generate_string.invokeStatic(core.clj:74)
	at cheshire.core$generate_string.invoke(core.clj:49)
	at cheshire.core$generate_string.invokeStatic(core.clj:55)
	at cheshire.core$generate_string.invoke(core.clj:49)
	at metabase.pulse.render.js_svg$javascript_visualization.invokeStatic(js_svg.clj:152)
	at metabase.pulse.render.js_svg$javascript_visualization.invoke(js_svg.clj:148)
	at metabase.pulse.render.body$fn__74253$_AMPERSAND_f__74254.invoke(body.clj:555)
	at metabase.pulse.render.body$fn__74253$fn__74261.invoke(body.clj:545)
	at clojure.lang.MultiFn.invoke(MultiFn.java:261)
	at metabase.pulse.render$render_pulse_card_body.invokeStatic(render.clj:144)
	at metabase.pulse.render$render_pulse_card_body.invoke(render.clj:130)
	at metabase.pulse.render$render_pulse_card.invokeStatic(render.clj:171)
	at metabase.pulse.render$render_pulse_card.invoke(render.clj:154)
	at metabase.pulse.render$render_pulse_section$fn__74649.invoke(render.clj:207)
	at metabase.pulse.render$render_pulse_section.invokeStatic(render.clj:205)
	at metabase.pulse.render$render_pulse_section.invoke(render.clj:201)
	at metabase.email.messages$render_part.invokeStatic(messages.clj:442)
	at metabase.email.messages$render_part.invoke(messages.clj:438)
	at metabase.email.messages$render_message_body$fn__75617$fn__75618.invoke(messages.clj:495)
	at clojure.core$mapv$fn__8535.invoke(core.clj:6980)
	at clojure.core.protocols$fn__8249.invokeStatic(protocols.clj:168)
	at clojure.core.protocols$fn__8249.invoke(protocols.clj:124)
	at clojure.core.protocols$fn__8204$G__8199__8213.invoke(protocols.clj:19)
	at clojure.core.protocols$seq_reduce.invokeStatic(protocols.clj:31)
	at clojure.core.protocols$fn__8236.invokeStatic(protocols.clj:75)
	at clojure.core.protocols$fn__8236.invoke(protocols.clj:75)
	at clojure.core.protocols$fn__8178$G__8173__8191.invoke(protocols.clj:13)
	at clojure.core$reduce.invokeStatic(core.clj:6887)
	at clojure.core$mapv.invokeStatic(core.clj:6971)
	at clojure.core$mapv.invoke(core.clj:6971)
	at metabase.email.messages$render_message_body$fn__75617.invoke(messages.clj:495)
	at metabase.email.messages$render_message_body.invokeStatic(messages.clj:494)
	at metabase.email.messages$render_message_body.invoke(messages.clj:492)
	at metabase.email.messages$render_pulse_email.invokeStatic(messages.clj:521)
	at metabase.email.messages$render_pulse_email.invoke(messages.clj:518)
	at metabase.pulse$fn__102307.invokeStatic(pulse.clj:414)
	at metabase.pulse$fn__102307.invoke(pulse.clj:403)
	at clojure.lang.MultiFn.invoke(MultiFn.java:239)
	at metabase.pulse$parts__GT_notifications$iter__102382__102386$fn__102387$fn__102388.invoke(pulse.clj:485)
	at metabase.pulse$parts__GT_notifications$iter__102382__102386$fn__102387.invoke(pulse.clj:483)
	at clojure.lang.LazySeq.sval(LazySeq.java:42)
	at clojure.lang.LazySeq.seq(LazySeq.java:51)
	at clojure.lang.RT.seq(RT.java:535)
	at clojure.core$seq__5467.invokeStatic(core.clj:139)
	at clojure.core$seq__5467.invoke(core.clj:139)
	at metabase.pulse$send_notifications_BANG_.invokeStatic(pulse.clj:538)
	at metabase.pulse$send_notifications_BANG_.invoke(pulse.clj:537)
	at metabase.pulse$send_pulse_BANG_.invokeStatic(pulse.clj:566)
	at metabase.pulse$send_pulse_BANG_.doInvoke(pulse.clj:546)
	at clojure.lang.RestFn.invoke(RestFn.java:439)
	at metabase.task.send_pulses$send_pulse_BANG_$fn__111696.invoke(send_pulses.clj:57)
	at metabase.models.task_history$do_with_task_history.invokeStatic(task_history.clj:116)
	at metabase.models.task_history$do_with_task_history.invoke(task_history.clj:105)
	at metabase.task.send_pulses$send_pulse_BANG_.invokeStatic(send_pulses.clj:52)
	at metabase.task.send_pulses$send_pulse_BANG_.invoke(send_pulses.clj:49)
	at metabase.task.send_pulses$send_pulse_BANG__STAR_.invokeStatic(send_pulses.clj:125)
	at metabase.task.send_pulses$send_pulse_BANG__STAR_.invoke(send_pulses.clj:116)
	at metabase.task.send_pulses.SendPulse.execute(send_pulses.clj:147)
	at org.quartz.core.JobRunShell.run(JobRunShell.java:202)
	at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:573)
```

### Information about your Metabase installation

```JSON
v50.19
```


### Severity

P1

### Additional context

Regression maybe?",paoliniluis,2024-08-15 15:20:05+00:00,['qnkhuat'],2024-08-19 08:39:41+00:00,2024-08-16 06:59:12+00:00,https://github.com/metabase/metabase/issues/46892,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Reporting/Pulses', 'Now called Subscriptions'), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2292846794, 'issue_id': 2468286280, 'author': 'qnkhuat', 'body': 'Regression introduced in https://github.com/metabase/metabase/pull/43428', 'created_at': datetime.datetime(2024, 8, 16, 5, 39, 26, tzinfo=datetime.timezone.utc)}]","qnkhuat (Assginee) on (2024-08-16 05:39:26 UTC): Regression introduced in https://github.com/metabase/metabase/pull/43428

"
2468018504,issue,closed,completed,fix CSP error in new Question at stats,,uladzimirdev,2024-08-15 13:05:17+00:00,['uladzimirdev'],2024-10-08 16:17:24+00:00,2024-08-16 08:42:30+00:00,https://github.com/metabase/metabase/issues/46889,[],[],
2467979473,issue,closed,completed,We should show what's the query going to the DW on linked filters,"**Is your feature request related to a problem? Please describe.**
The way that Metabase works is magical, but sometimes it's neat to know the inner workings of the tricks of the magician in complex scenarios. E.g. linked filters can really drive someone crazy if they don't render the results you're expecting or it simply doesn't work. The reality is that linked filters will send a query to the DW but the only way to see it is by profiling the DW, which many times is useless due to the amount of queries being sent

**Describe the solution you'd like**
A feature that can show me the queries being sent to the DW when using linked filters, only for admins

**Describe alternatives you've considered**
Profiling the DW, which is cumbersome

**How important is this feature to you?**
Well... it could have saved me endless debugging hours and probably a few thousand hairs

**Additional context**
NA
",paoliniluis,2024-08-15 12:43:17+00:00,['lbrdnk'],2024-12-20 20:33:22+00:00,2024-12-20 19:51:26+00:00,https://github.com/metabase/metabase/issues/46888,"[('Type:New Feature', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.')]","[{'comment_id': 2482814876, 'issue_id': 2467979473, 'author': 'thebiglabasky', 'body': 'Could we at least ensure these are logged so accessible through the logs (maybe with a label allowing to quickly search for them)? That seems like a 1 liner which could indeed save a ton of time...', 'created_at': datetime.datetime(2024, 11, 18, 11, 48, 12, tzinfo=datetime.timezone.utc)}]","thebiglabasky on (2024-11-18 11:48:12 UTC): Could we at least ensure these are logged so accessible through the logs (maybe with a label allowing to quickly search for them)? That seems like a 1 liner which could indeed save a ton of time...

"
2467901336,issue,closed,completed,/admin/databases/:id with unknown ID shows 500 Internal Server Error,"### Describe the bug

I open `/admin/databases/:id` on a Metabase instance, where `:id` is any integer that does not correspond to an existing database, and see raw HTML for a 500 Internal Server Error.

### To Reproduce

1. Go to `/admin/databases` and check what database IDs exist (on a pristine system only ID 1 would exist)
2. Go to `/admin/databases/100` (assuming ID 100 does not correspond to an existing database; any other non-existent ID also works)
3. See the literal text `<html> <head><title>500 Internal Server Error</title></head> <body> <center><h1>500 Internal Server Error</h1></center> <hr><center>nginx</center> </body> </html>` (see screenshot below)
4. In browser dev tools, see that this is the raw response from a `GET /api/database/100` HTTP request

### Expected behavior

I would expect to get a 404 Not Found page instead, similar to what I get when I go to `/admin/gobbledegook`.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64; rv:129.0) Gecko/20100101 Firefox/129.0"",
    ""vendor"": """"
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.220-209.869.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.10""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    },
    ""run-mode"": ""prod"",
    ""plan-alias"": ""starter"",
    ""version"": {
      ""date"": ""2024-08-14"",
      ""tag"": ""v1.50.20.3"",
      ""hash"": ""3fb0cf2""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```


### Severity

Annoying

### Additional context

![screenshot](https://github.com/user-attachments/assets/cffe266d-039a-4d27-83c4-6524029e5317)
",devurandom,2024-08-15 11:46:22+00:00,[],2024-10-24 18:10:21+00:00,2024-10-24 18:10:19+00:00,https://github.com/metabase/metabase/issues/46886,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Administration/Databases', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2291515393, 'issue_id': 2467901336, 'author': 'crisptrutski', 'body': 'Interestingly I\'m seeing something slightly different on master (stats), but it\'s still not ideal - text returned for a JSON request.\r\n\r\n<img width=""543"" alt=""Screenshot 2024-08-15 at 17 22 09"" src=""https://github.com/user-attachments/assets/244df664-a4f8-4e4a-91df-6b6855b48727"">', 'created_at': datetime.datetime(2024, 8, 15, 15, 23, 50, tzinfo=datetime.timezone.utc)}, {'comment_id': 2291522456, 'issue_id': 2467901336, 'author': 'crisptrutski', 'body': 'It\'s also slightly different running master on my dev machine 🤷 \r\n\r\n<img width=""461"" alt=""Screenshot 2024-08-15 at 17 26 37"" src=""https://github.com/user-attachments/assets/e4ac2cc6-43c6-42e5-8f7f-738c0b32e6b3"">', 'created_at': datetime.datetime(2024, 8, 15, 15, 27, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2436042083, 'issue_id': 2467901336, 'author': 'rafpaf', 'body': 'This is solved', 'created_at': datetime.datetime(2024, 10, 24, 18, 10, 19, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-08-15 15:23:50 UTC): Interestingly I'm seeing something slightly different on master (stats), but it's still not ideal - text returned for a JSON request.

<img width=""543"" alt=""Screenshot 2024-08-15 at 17 22 09"" src=""https://github.com/user-attachments/assets/244df664-a4f8-4e4a-91df-6b6855b48727"">

crisptrutski on (2024-08-15 15:27:33 UTC): It's also slightly different running master on my dev machine 🤷 

<img width=""461"" alt=""Screenshot 2024-08-15 at 17 26 37"" src=""https://github.com/user-attachments/assets/e4ac2cc6-43c6-42e5-8f7f-738c0b32e6b3"">

rafpaf on (2024-10-24 18:10:19 UTC): This is solved

"
2467863341,issue,open,,Duplicate option in dashboard filter for number with,"### Description

When creating a dashboard filter for a numeric field with only a single value currently in the database, we get an unfortunate rendering of the value picker.

<img width=""340"" alt=""Screenshot 2024-08-15 at 11 23 18"" src=""https://github.com/user-attachments/assets/4b42acbf-9fe1-4efd-a603-7a821b5c9280"">


Version: master pre-v51 (acf87c0cdba69e1ed520f09a97aa2bb4a3c13869)",crisptrutski,2024-08-15 11:14:05+00:00,[],2025-02-04 20:28:43+00:00,,https://github.com/metabase/metabase/issues/46885,"[('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Reporting/Dashboards', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2467764421,issue,closed,not_planned,Track dashboard filters using wildcards in structured queries,"### Description

Currently when analyzing the table and field dependencies of MBQL cards, we only track explicit references, so if ""All"" is selected we will not track the dependency at all.

The issue comes when we connect a dashboard filter to an output of an MBQL question - at that point there is actually a hard dependency for the card to render in that context, and we should track this. Notably, the Query Reference Validation tool should analyze these dependencies.

The easiest solution is to track *all* the outputs as explicit references. While inconsistent with `*` references in Native queries, at worst this would add some noise in the validation tool, and perhaps wasted work in find and replace. It might cause more serious issues for later work on top of the analysis however.

A more nuanced approach would be to query all the **dashcards* when we are creating the `query_field` rows in the query analyzer, and use the `parameter_mapping` to augment the rows.    
",crisptrutski,2024-08-15 09:55:42+00:00,[],2024-11-21 14:21:39+00:00,2024-11-21 14:20:08+00:00,https://github.com/metabase/metabase/issues/46881,"[('Querying/MBQL', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2293591453, 'issue_id': 2467764421, 'author': 'crisptrutski', 'body': 'It may be better to actually track these as a new type of reference, which preserves the relevant dashboard ids. This way the validator tool can link back to the relevant dashboard(s). This is significantly more complex than the previous two methods, and requires some technical design to nail down the right format for this new appdb data, and how to populate it.', 'created_at': datetime.datetime(2024, 8, 16, 14, 14, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2296541563, 'issue_id': 2467764421, 'author': 'crisptrutski', 'body': 'Wrote up a [short doc](https://www.notion.so/metabase/Validate-Dashboard-Filter-References-1c27adcb09ad41ca9d82a5e5329a9ee9) about the various options.', 'created_at': datetime.datetime(2024, 8, 19, 13, 9, 15, tzinfo=datetime.timezone.utc)}]","crisptrutski (Issue Creator) on (2024-08-16 14:14:43 UTC): It may be better to actually track these as a new type of reference, which preserves the relevant dashboard ids. This way the validator tool can link back to the relevant dashboard(s). This is significantly more complex than the previous two methods, and requires some technical design to nail down the right format for this new appdb data, and how to populate it.

crisptrutski (Issue Creator) on (2024-08-19 13:09:15 UTC): Wrote up a [short doc](https://www.notion.so/metabase/Validate-Dashboard-Filter-References-1c27adcb09ad41ca9d82a5e5329a9ee9) about the various options.

"
2467754406,issue,open,,Bigger browsing tiles for long table name,"**Is your feature request related to a problem? Please describe.**
When browsing tables in the ""Browse"" tab of Metabase, we have a grid of 3 column tiles with folders and table names. Currently those tiles are too short for table or folder names longer than 22-26 characters (depending on the characters used since the font is not monospaced) thus cutting some long names if they overflow this limit.
On the other hand on a 16:9 screen with a descent resolution/scaling, those 3 columns look quite thin compared to the width of the screen, letting lot of empty space around those tiles as shown below:

<img width=""2560"" alt=""Screenshot 2024-08-15 at 11 36 37"" src=""https://github.com/user-attachments/assets/12031ef4-3e8c-411d-9808-e23d8d768be6"">

**Describe the solution you'd like**
If we can make some divs and tiles larger, we would keep the 3 column grid design and make enough horizontal space for long table or folder names making things more readable and easy to find for users while keeping the design idea of this page.

Below are the changes I can suggest based on v0.50.20:

```css
/* Page title ""Database"" & ""Learn about our data"" */
.emotion-1wuz3h3 {
    max-width: 80rem; /* Currently 64rem */
    margin: 0px auto;
    width: 100%;
    display: flex;
}

/* Grid container */
.emotion-nb29dk {
    max-width: 80rem;  /* Currently 64rem */
    margin: 0px auto;
    width: 100%;
    display: flex;
    flex-direction: column;
}

/* Grid */
.emotion-gxd7v6 {
    flex-wrap: wrap;
    margin-left: -0.5rem;
    margin-right: -0.5rem;
    width: 100%;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(24rem, 1fr));  /* Currently repeat(auto-fill, minmax(18rem, 1fr)) */
}
```

The responsiveness of those design changes seem to be ok from what I can see in my browser at different window widths:
<img width=""2560"" alt=""Screenshot 2024-08-15 at 11 43 52"" src=""https://github.com/user-attachments/assets/bc6826a4-a6cb-45dc-b791-9ba51112e632"">
<img width=""1460"" alt=""Screenshot 2024-08-15 at 11 44 19"" src=""https://github.com/user-attachments/assets/f1a9e1b3-3016-4570-a09d-b68a3c372404"">
<img width=""1052"" alt=""Screenshot 2024-08-15 at 11 44 37"" src=""https://github.com/user-attachments/assets/c9125656-2313-40f4-b649-7baea78037f4"">


**Describe alternatives you've considered**
For now what I do is using an extension to manually override the CSS style of those divs to make them larger, not ideal solution especially between upgrades if div class names change.

**How important is this feature to you?**
It's a low effort, medium/high win feature in my opinion. Even if some user won't notice it they'll feel it's easier to find the table they want.

**Additional context**
Screenshots are given above to describe the situation",Timelessprod,2024-08-15 09:48:50+00:00,[],2025-02-04 20:30:36+00:00,,https://github.com/metabase/metabase/issues/46880,"[('Type:New Feature', ''), ('.Design Needed', '')]","[{'comment_id': 2445534469, 'issue_id': 2467754406, 'author': 'paoliniluis', 'body': '@Timelessprod feel free to open a PR for this', 'created_at': datetime.datetime(2024, 10, 29, 23, 58, 7, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-10-29 23:58:07 UTC): @Timelessprod feel free to open a PR for this

"
2467488702,issue,closed,completed,Migrations `DISABLE TRIGGER ALL;` on Google Cloud SQL db instance lead to error,"### Describe the bug

In some migrations there is a line that run operation `DISABLE TRIGGER ALL` /  `ENABLE TRIGGER ALL`
 e.g.
```
-- Changeset migrations/001_update_migrations.yaml::v50.2024-01-10T03:27:30::noahmoss
-- Migrate data-access permissions from `permissions` to `data_permissions`
SET SEARCH_PATH TO public, ""$user"",""public"";

ALTER TABLE data_permissions DISABLE TRIGGER ALL;
```

This operation requires `superuser` rights (because system trigger exists) from Postgresql user, which is impossible to get with managed google cloud sql instance.

Happily, it can be replaced with `DISABLE TRIGGER USER` or ignored, seems there is no user triggers or Foreign keys mismatch. But need to spend some time to check and run manual migrations.



### To Reproduce

1. Take db with user without superuser rights
2. Run `DISABLE TRIGGER ALL` migrations

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
Migrating metabase from 0.47 to 0.50
Google cloud SQL, Postgresql 14.2
```


### Severity

annoying

### Additional context

_No response_",Kulikovpavel,2024-08-15 06:19:52+00:00,[],2024-08-21 14:22:55+00:00,2024-08-15 10:51:07+00:00,https://github.com/metabase/metabase/issues/46874,"[('Type:Bug', 'Product defects')]","[{'comment_id': 2291064076, 'issue_id': 2467488702, 'author': 'crisptrutski', 'body': ""We're retracted this command in v50.21, see https://github.com/metabase/metabase/pull/46826"", 'created_at': datetime.datetime(2024, 8, 15, 10, 51, 7, tzinfo=datetime.timezone.utc)}, {'comment_id': 2299003604, 'issue_id': 2467488702, 'author': 'chukwuma-azubuike', 'body': '@crisptrutski, I noticed the docker image for v50.21 has not been pushed. Is there a timeline for this?', 'created_at': datetime.datetime(2024, 8, 20, 14, 28, 31, tzinfo=datetime.timezone.utc)}, {'comment_id': 2302179443, 'issue_id': 2467488702, 'author': 'crisptrutski', 'body': '@chukwuma-azubuike we have just released it', 'created_at': datetime.datetime(2024, 8, 21, 14, 22, 54, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-08-15 10:51:07 UTC): We're retracted this command in v50.21, see https://github.com/metabase/metabase/pull/46826

chukwuma-azubuike on (2024-08-20 14:28:31 UTC): @crisptrutski, I noticed the docker image for v50.21 has not been pushed. Is there a timeline for this?

crisptrutski on (2024-08-21 14:22:54 UTC): @chukwuma-azubuike we have just released it

"
2466920027,issue,closed,not_planned,Static Embed Preview Dropdown Menus Broken Until Published,"### Describe the bug

If you create a new dashboard with dropdown filters on it and set up a static embed - the dropdown menus don't work in preview mode until after you publish the dashboard.

### To Reproduce

1. Set up version 49+ (didn't test older than that)
2. Enable embedding
3. Create a dashboard
4. Create a simple question with the People table & add it to the dashboard
5. Add a text filter and wire it to ""Source""
6. See that the dashboard filter has a drop down menu
7. When setting up the static embed set the parameter to ""Editable"" 
8. Look at the preview and note that the param is an input box instead of a menu
9. Publish the embed
10. Check the param in the preview again and note that it works

https://www.loom.com/share/bb9f8e531e5d448c911a0aa9b1823e31

### Expected behavior

The preview should mirror what the published dashboard will look like

### Logs

_No response_

### Information about your Metabase installation

```JSON
testing in 49.23 and 50.13
```


### Severity

Very confusing to users

### Additional context

_No response_",ixipixi,2024-08-14 22:07:52+00:00,[],2024-08-15 13:58:18+00:00,2024-08-15 13:58:18+00:00,https://github.com/metabase/metabase/issues/46872,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Reporting/Dashboards', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2291317897, 'issue_id': 2466920027, 'author': 'kulyk', 'body': 'Should be fixed in x.50.14 by #45447', 'created_at': datetime.datetime(2024, 8, 15, 13, 58, 18, tzinfo=datetime.timezone.utc)}]","kulyk on (2024-08-15 13:58:18 UTC): Should be fixed in x.50.14 by #45447

"
2466871040,issue,closed,completed,do not run cypress-terminal-report during local run,,uladzimirdev,2024-08-14 21:27:41+00:00,[],2024-10-08 16:17:26+00:00,2024-08-15 17:26:05+00:00,https://github.com/metabase/metabase/issues/46870,[],[],
2466870792,issue,closed,completed,fix manual backport script failure,,uladzimirdev,2024-08-14 21:27:29+00:00,['uladzimirdev'],2024-08-22 11:16:18+00:00,2024-08-15 13:03:30+00:00,https://github.com/metabase/metabase/issues/46869,[],"[{'comment_id': 2291229798, 'issue_id': 2466870792, 'author': 'uladzimirdev', 'body': 'fixed by https://github.com/metabase/metabase/pull/46729', 'created_at': datetime.datetime(2024, 8, 15, 13, 3, 30, tzinfo=datetime.timezone.utc)}]","uladzimirdev (Issue Creator) on (2024-08-15 13:03:30 UTC): fixed by https://github.com/metabase/metabase/pull/46729

"
2466869753,issue,closed,completed,Weird timezone log line for sqlserver,"### Describe the bug

In SQL server I saw something like:
metabase.sync.sync-metadata.sync-timezone :sqlserver database 2 default timezone is #object[java.time.ZoneOffset 0x4b796874 ""Z""]

### To Reproduce

Can't repro, but saw it on 2713a63a-c572-4ed5-9f2b-9f51bda8017c

### Expected behavior

Log lines should be readable

### Logs

above

### Information about your Metabase installation

```JSON
v50.19
```


### Severity

P3

### Additional context

_No response_",paoliniluis,2024-08-14 21:26:39+00:00,['rileythomp'],2025-01-22 16:18:44+00:00,2025-01-10 20:06:22+00:00,https://github.com/metabase/metabase/issues/46867,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Administration/Metadata & Sync', ''), ('.Backend', ''), ('.Team/Drivers', '')]","[{'comment_id': 2291070802, 'issue_id': 2466869753, 'author': 'crisptrutski', 'body': 'This appears like a [normal part of syncing metadata.](https://github.com/metabase/metabase/blob/d2fc33a3b5db70823bba9d5af63447e112b41b48/src/metabase/sync/sync_metadata/sync_timezone.clj#L36). ~~Perhaps it should be changed to `DEBUG` level?~~ Or turned into a human friendly label, gotcha.', 'created_at': datetime.datetime(2024, 8, 15, 10, 56, 39, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-08-15 10:56:39 UTC): This appears like a [normal part of syncing metadata.](https://github.com/metabase/metabase/blob/d2fc33a3b5db70823bba9d5af63447e112b41b48/src/metabase/sync/sync_metadata/sync_timezone.clj#L36). ~~Perhaps it should be changed to `DEBUG` level?~~ Or turned into a human friendly label, gotcha.

"
2466793807,issue,closed,completed,"Broken link to models article under ""Custom List"" option in dashboard filter","### Describe the bug

The link in Metabase has an extra ""learn"" which results in the ""Page Not Found""

Mistake is in [this line](https://github.com/metabase/metabase/blob/e426b1a3b9cf8f818d84e110fb664042025f68a7/frontend/src/metabase/parameters/components/ValuesSourceModal/ValuesSourceTypeModal.tsx#L445), it shouldn't have `learn`, just `/data-modeling/models`
[ValuesSourceTypeModal.tsx](https://github.com/metabase/metabase/blob/e426b1a3b9cf8f818d84e110fb664042025f68a7/frontend/src/metabase/parameters/components/ValuesSourceModal/ValuesSourceTypeModal.tsx)
 `const href = getLearnUrl(""learn/data-modeling/models"");`

### To Reproduce

1. 
![Screenshot 2024-08-14 at 1 17 50 PM](https://github.com/user-attachments/assets/c5321fc3-cf19-4b2d-b342-0e832c74965d)
2. 
![Screenshot 2024-08-14 at 1 22 56 PM](https://github.com/user-attachments/assets/0f2e7c73-dd3b-45b0-a713-afae8d098870)
3. ![Screenshot 2024-08-14 at 1 22 56 PM](https://github.com/user-attachments/assets/ff16e882-9dc8-4fed-963e-1aa1ed57f364)



Error: 
![Screenshot 2024-08-14 at 1 39 47 PM](https://github.com/user-attachments/assets/dfd51d16-7feb-4968-850f-a45ce927a49b)

### Expected behavior

Hyperlink should go to `https://www.metabase.com/learn/data-modeling/models`

### Logs

_No response_

### Information about your Metabase installation

```JSON
Looks like this link never worked so information about installation is not relevant :)
```


### Severity

not severe at all 

### Additional context

_No response_",jessicaul,2024-08-14 20:43:51+00:00,[],2024-10-08 16:17:25+00:00,2024-08-15 17:28:55+00:00,https://github.com/metabase/metabase/issues/46865,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Type:Documentation', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2291080575, 'issue_id': 2466793807, 'author': 'crisptrutski', 'body': 'Thanks for reporting! Opened a PR.', 'created_at': datetime.datetime(2024, 8, 15, 11, 5, 2, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-08-15 11:05:02 UTC): Thanks for reporting! Opened a PR.

"
2466766216,issue,closed,completed,Our `mu/defn` and `mu/fn` macros don't work correctly on functions with rest parameters and schemas,"```clj
(mu/defn my-plus :- :int
  [x :- :int
   y :- :int
   & more :- [:sequential :int]]
  (reduce + (list* x y more)))
```

macroexpands to 

```clj
(def my-plus
  ""Inputs: [x :- :int y :- :int & more :- [:sequential :int]]\n  Return: :int""
  (let [&f (fn my_plus90163 [x y & more] (reduce + (list* x y more)))]
    (fn ([a b c]
         (try
           (metabase.util.malli.fn/validate-input {:fn-name 'my-plus} :int a)
           (metabase.util.malli.fn/validate-input {:fn-name 'my-plus} :int b)
           (metabase.util.malli.fn/validate-input {:fn-name 'my-plus} [:sequential :int] c)
           (->> (&f a b c) (metabase.util.malli.fn/validate-output {:fn-name 'my-plus} :int))
           (catch java.lang.Exception error (throw (metabase.util.malli.fn/fixup-stacktrace error))))))))
```
notice that the new function does has the signature `(f a b c)` rather than `(f a b & c)`.",camsaul,2024-08-14 20:25:14+00:00,['camsaul'],2024-08-24 00:20:37+00:00,2024-08-23 23:25:24+00:00,https://github.com/metabase/metabase/issues/46864,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('.DX', 'Developer experience and QoL related.'), ('.Team/DevEx', '')]",[],
2466739888,issue,open,,Add Kondo linter to make sure namespace doesn't require itself,Can probably actually be submitted as a PR against Kondo itself. I think there's an open issue for this.,camsaul,2024-08-14 20:08:12+00:00,[],2025-02-04 20:23:41+00:00,,https://github.com/metabase/metabase/issues/46862,"[('.CI & Tests', ''), ('.Backend', ''), ('.DX', 'Developer experience and QoL related.'), ('.Team/DevEx', '')]",[],
2466738127,issue,open,,Add Kondo linter to check whether you mark a test namespace `:^mb/once` and it uses `test-driver` or `test-drivers`,"If you mark it `^:mb/once`, `test-driver`/`test-drivers` won't actually run tests against those drivers, so it should return a warning.

Another nice thing would be to suggest marking test namespaces `^:mb/once` if the file uses neither `test-driver` nor `test-drivers` so we can skip those tests when running driver tests",camsaul,2024-08-14 20:07:10+00:00,[],2025-02-04 20:23:39+00:00,,https://github.com/metabase/metabase/issues/46860,"[('.CI & Tests', ''), ('.Backend', ''), ('.DX', 'Developer experience and QoL related.'), ('.Team/DevEx', '')]",[],
2466644079,issue,closed,completed,CSV dates for MongoDB are emitted with a time,"Date columns are supposed to be emitted without time for CSV exports, however for MongoDB it seems like times are being included. Discovered when enabling a test in #41384

```
FAIL in metabase.query-processor.streaming.csv-test/date-columns-should-be-emitted-without-time (csv_test.clj:35)

:mongo

expected: [[""1"" ""April 7, 2014"" ""5"" ""12""]
           [""2"" ""September 18, 2014"" ""1"" ""31""]
           [""3"" ""September 15, 2014"" ""8"" ""56""]
           [""4"" ""March 11, 2014"" ""5"" ""4""]
           [""5"" ""May 5, 2013"" ""3"" ""49""]]
  actual: ([""1"" ""April 7, 2014, 12:00 AM"" ""5"" ""12""]
           [""2"" ""September 18, 2014, 12:00 AM"" ""1"" ""31""]
           [""3"" ""September 15, 2014, 12:00 AM"" ""8"" ""56""]
           [""4"" ""March 11, 2014, 12:00 AM"" ""5"" ""4""]
           [""5"" ""May 5, 2013, 12:00 AM"" ""3"" ""49""])
    diff: - [[nil ""April 7, 2014""]
             [nil ""September 18, 2014""]
             [nil ""September 15, 2014""]
             [nil ""March 11, 2014""]
             [nil ""May 5, 2013""]]
          + [[nil ""April 7, 2014, 12:00 AM""]
             [nil ""September 18, 2014, 12:00 AM""]
             [nil ""September 15, 2014, 12:00 AM""]
             [nil ""March 11, 2014, 12:00 AM""]
             [nil ""May 5, 2013, 12:00 AM""]]
```

See also #46849",camsaul,2024-08-14 19:18:05+00:00,['rileythomp'],2025-01-24 21:53:04+00:00,2025-01-17 00:08:21+00:00,https://github.com/metabase/metabase/issues/46856,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Database/Mongo', None), ('.Backend', ''), ('Visualization/Download', ''), ('.Team/Drivers', '')]",[],
2466346419,issue,closed,completed,`yyyymmddhhmmss` bytes to timestamp coercion broken for Redshift,"The Redshift driver implements a method for `sql.qp/cast-temporal-byte` for `:Coercion/YYYYMMDDHHMMSSBytes->Temporal` (indirectly, via Postgres) but it does not appear to actually work when enabling a test for it in #41384

Maybe the fix here is to add an actual feature flag for this coercion strategy and just disable it for Redshift if there's no function we can use to make this work

```
ERROR in metabase.query-processor-test.alternative-date-test/yyyymmddhhmmss-binary-dates (sql.clj:234)

:redshift

expected: (=
           (yyyymmddhhmmss-binary-dates-expected-rows driver/*driver*)
           (sort-by
            first
            (mt/rows
             (mt/dataset
              yyyymmddhhss-binary-times
              (qp/process-query
               (assoc (mt/mbql-query times) :middleware {:format-rows? false}))))))
  actual: 
clojure.lang.ExceptionInfo: Missing datatype for field ""as_bytes"" for driver: :redshift
    driver: :redshift
     field: {:field-name ""as_bytes"",
             :base-type {:natives {:postgres ""BYTEA"", :h2 ""BYTEA"", :mysql ""VARBINARY(100)""}},
             :effective-type :type/DateTime,
             :coercion-strategy :Coercion/YYYYMMDDHHMMSSBytes->Temporal,
             :semantic-type nil,
             :visibility-type nil,
             :fk nil,
             :field-comment nil}
                               metabase.test.data.sql/field-definition-sql                  sql.clj:  234
                           metabase.test.data.sql/eval161930/fn/iter/fn/fn                  sql.clj:  260
                              metabase.test.data.sql/eval161930/fn/iter/fn                  sql.clj:  259
                                                                       ...                               
                                                         clojure.core/next                 core.clj:   64
                                                       clojure.string/join               string.clj:  180
                                      metabase.test.data.sql/eval161930/fn                  sql.clj:  257
                                                                       ...                               
                                  metabase.test.data.sql.ddl/eval303406/fn                  ddl.clj:   70
                                                                       ...                               
                                                        clojure.core/apply                 core.clj:  671
metabase.test.data.sql-jdbc.load-data/create-db-execute-db-ddl-statements!            load_data.clj:  234
                       metabase.test.data.sql-jdbc.load-data/create-db!/fn            load_data.clj:  267
                                 metabase.driver.redshift/eval342098/fn/fn             redshift.clj:  257
     metabase.driver.sql-jdbc.execute/fn/do-with-resolved-connection115806              execute.clj:  337
                                    metabase.driver.sql-jdbc.execute/fn/fn              execute.clj:  320
                                    metabase.driver.redshift/eval342098/fn             redshift.clj:  242
                                                                       ...                               
                          metabase.test.data.sql-jdbc.load-data/create-db!            load_data.clj:  260
                          metabase.test.data.sql-jdbc.load-data/create-db!            load_data.clj:  254
                                                                       ...                               
                                                        clojure.core/apply                 core.clj:  667
                                 metabase.test.data.sql-jdbc/eval303675/fn             sql_jdbc.clj:   40
                                                                       ...                               
  metabase.test.data.impl.get-or-create/load-dataset-data-if-needed!/fn/fn        get_or_create.clj:  251
                   metabase.test.util.timezone/do-with-system-timezone-id!             timezone.clj:   18
     metabase.test.data.impl.get-or-create/load-dataset-data-if-needed!/fn        get_or_create.clj:  250
                                       clojure.core/binding-conveyor-fn/fn                 core.clj: 2047
                                                                       ...                               
                                       java.util.concurrent.FutureTask.run          FutureTask.java:  264
                         java.util.concurrent.ThreadPoolExecutor.runWorker  ThreadPoolExecutor.java: 1128
                        java.util.concurrent.ThreadPoolExecutor$Worker.run  ThreadPoolExecutor.java:  628
                                                      java.lang.Thread.run              Thread.java:  829
```",camsaul,2024-08-14 16:56:35+00:00,['rileythomp'],2025-01-16 18:42:35+00:00,2025-01-16 17:26:42+00:00,https://github.com/metabase/metabase/issues/46850,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Database/Redshift', None), ('.Backend', ''), ('.Team/Drivers', '')]","[{'comment_id': 2289318173, 'issue_id': 2466346419, 'author': 'camsaul', 'body': 'See also #46848', 'created_at': datetime.datetime(2024, 8, 14, 16, 57, 20, tzinfo=datetime.timezone.utc)}]","camsaul (Issue Creator) on (2024-08-14 16:57:20 UTC): See also #46848

"
2466341902,issue,closed,completed,CSV dates for Athena are emitted with time,"Date columns are supposed to be emitted without time for CSV exports, however for Athena it seems like times are being included. Discovered when enabling a test in #41384

```
FAIL in metabase.query-processor.streaming.csv-test/date-columns-should-be-emitted-without-time (csv_test.clj:26)

:athena

expected: [[""1"" ""April 7, 2014"" ""5"" ""12""]
           [""2"" ""September 18, 2014"" ""1"" ""31""]
           [""3"" ""September 15, 2014"" ""8"" ""56""]
           [""4"" ""March 11, 2014"" ""5"" ""4""]
           [""5"" ""May 5, 2013"" ""3"" ""49""]]
  actual: ([""1"" ""April 7, 2014, 12:00 AM"" ""5"" ""12""]
           [""2"" ""September 18, 2014, 12:00 AM"" ""1"" ""31""]
           [""3"" ""September 15, 2014, 12:00 AM"" ""8"" ""56""]
           [""4"" ""March 11, 2014, 12:00 AM"" ""5"" ""4""]
           [""5"" ""May 5, 2013, 12:00 AM"" ""3"" ""49""])
    diff: - [[nil ""April 7, 2014""]
             [nil ""September 18, 2014""]
             [nil ""September 15, 2014""]
             [nil ""March 11, 2014""]
             [nil ""May 5, 2013""]]
          + [[nil ""April 7, 2014, 12:00 AM""]
             [nil ""September 18, 2014, 12:00 AM""]
             [nil ""September 15, 2014, 12:00 AM""]
             [nil ""March 11, 2014, 12:00 AM""]
             [nil ""May 5, 2013, 12:00 AM""]]
```",camsaul,2024-08-14 16:53:59+00:00,['rileythomp'],2025-01-24 21:53:05+00:00,2025-01-17 00:08:22+00:00,https://github.com/metabase/metabase/issues/46849,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Backend', ''), ('Database/Athena', ''), ('Visualization/Download', ''), ('.Team/Drivers', '')]",[],
2466335358,issue,closed,completed,`yyyymmddhhmmss` bytes to timestamp coercion broken for Presto JDBC,"The Presto JDBC driver implements a method for `sql.qp/cast-temporal-byte` for `:Coercion/YYYYMMDDHHMMSSBytes->Temporal` but it does not appear to actually work when enabling a test for it in #41384

```
ERROR in metabase.query-processor-test.alternative-date-test/yyyymmddhhmmss-binary-dates (sql.clj:234)

:presto-jdbc

expected: (=
           (yyyymmddhhmmss-binary-dates-expected-rows driver/*driver*)
           (sort-by
            first
            (mt/rows
             (mt/dataset
              yyyymmddhhss-binary-times
              (qp/process-query
               (assoc (mt/mbql-query times) :middleware {:format-rows? false}))))))
  actual: 
clojure.lang.ExceptionInfo: Missing datatype for field ""as_bytes"" for driver: :presto-jdbc
    driver: :presto-jdbc
     field: {:field-name ""as_bytes"",
             :base-type {:natives {:postgres ""BYTEA"", :h2 ""BYTEA"", :mysql ""VARBINARY(100)""}},
             :effective-type :type/DateTime,
             :coercion-strategy :Coercion/YYYYMMDDHHMMSSBytes->Temporal,
             :semantic-type nil,
             :visibility-type nil,
             :fk nil,
             :field-comment nil}
                               metabase.test.data.sql/field-definition-sql                  sql.clj:  234
                           metabase.test.data.sql/eval161930/fn/iter/fn/fn                  sql.clj:  260
                              metabase.test.data.sql/eval161930/fn/iter/fn                  sql.clj:  259
                                                                       ...                               
                                                         clojure.core/next                 core.clj:   64
                                                       clojure.string/join               string.clj:  180
                                      metabase.test.data.sql/eval161930/fn                  sql.clj:  257
                              metabase.test.data.presto-jdbc/eval323175/fn          presto_jdbc.clj:  151
                                                                       ...                               
                                  metabase.test.data.sql.ddl/eval303406/fn                  ddl.clj:   70
                                                                       ...                               
                                                        clojure.core/apply                 core.clj:  671
metabase.test.data.sql-jdbc.load-data/create-db-execute-db-ddl-statements!            load_data.clj:  234
                       metabase.test.data.sql-jdbc.load-data/create-db!/fn            load_data.clj:  267
                              metabase.driver.presto-jdbc/eval323011/fn/fn          presto_jdbc.clj:  706
     metabase.driver.sql-jdbc.execute/fn/do-with-resolved-connection115806              execute.clj:  337
                                    metabase.driver.sql-jdbc.execute/fn/fn              execute.clj:  320
                                 metabase.driver.presto-jdbc/eval323011/fn          presto_jdbc.clj:  699
                                                                       ...                               
                                 metabase.driver.presto-jdbc/eval323011/fn          presto_jdbc.clj:  693
                                                                       ...                               
                          metabase.test.data.sql-jdbc.load-data/create-db!            load_data.clj:  260
                          metabase.test.data.sql-jdbc.load-data/create-db!            load_data.clj:  254
                                                                       ...                               
                                                        clojure.core/apply                 core.clj:  667
                                 metabase.test.data.sql-jdbc/eval303675/fn             sql_jdbc.clj:   40
                                                                       ...                               
  metabase.test.data.impl.get-or-create/load-dataset-data-if-needed!/fn/fn        get_or_create.clj:  251
                   metabase.test.util.timezone/do-with-system-timezone-id!             timezone.clj:   18
     metabase.test.data.impl.get-or-create/load-dataset-data-if-needed!/fn        get_or_create.clj:  250
                                       clojure.core/binding-conveyor-fn/fn                 core.clj: 2047
                                                                       ...                               
                                       java.util.concurrent.FutureTask.run          FutureTask.java:  264
                         java.util.concurrent.ThreadPoolExecutor.runWorker  ThreadPoolExecutor.java: 1128
                        java.util.concurrent.ThreadPoolExecutor$Worker.run  ThreadPoolExecutor.java:  628
                                                      java.lang.Thread.run              Thread.java:  829
```",camsaul,2024-08-14 16:51:15+00:00,['rileythomp'],2025-01-22 16:13:35+00:00,2025-01-20 20:01:38+00:00,https://github.com/metabase/metabase/issues/46848,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Database/Presto', ''), ('Difficulty:Easy', ''), ('.Backend', ''), ('.Team/Drivers', '')]",[],
2466194762,issue,closed,completed,[Epic] Simplify finding metrics in Summarize,"[product doc](https://www.notion.so/metabase/Simplify-finding-metrics-in-Summarize-7f70c572fa5640a2a76caa4ee8625ca4)
[testing plan](https://www.notion.so/metabase/Testing-plan-Simplifying-metrics-in-Summarize-692ca2a9c0154e948ce3a36cb2c62c95)

- Always show the input field on top of the Summarize block.
- On hover in the list of Common Metrics show (i) icon and on hover on this icon a tooltip with a description for this metric. When clicking on the icon open the metric.
- Make operators searchable in aggregation picker
- Sort the available metrics",romeovs,2024-08-14 15:35:31+00:00,['romeovs'],2024-09-03 16:29:42+00:00,2024-08-22 14:35:04+00:00,https://github.com/metabase/metabase/issues/46847,"[('.Epic', 'Feature Implementation or Project')]",[],
2466181613,issue,open,,Implicitly joinable column groups cannot be distinguished,"### Describe the bug

[filter modal](https://github.com/user-attachments/assets/9c2ba607-a7c4-46e6-8b2b-c4ade737bcab)
[dashboard parameter mapping](https://github.com/user-attachments/assets/a461c0bf-19d3-47d0-bb25-9cc2f7e6e71f)



### To Reproduce

1. New > Question > Orders
2. Join Reviews on Product ID = Product ID
3. Visualize
4. Open filter modal

:x: Column groups cannot be distinguished by name

----

6. Save question
7. Add it to dashboard
8. Add Number filter and try to map it to the question

:x: Column groups cannot be distinguished by name

----

:x: Also affects column mapping in click behavior (saved question as destination).

### Expected behavior

We should show these columns under different headers like Product (via Order -> Product ID) and Product (via Review -> Product ID)
The same should be for explicit joins (currently it's like Products - Product ID and shown only after you add a filter), check the thread https://metaboat.slack.com/archives/C0645JP1W81/p1723648335555529

### Information about your Metabase installation

master, a4f1223d1d


### Severity

P2


### Additional context

https://metaboat.slack.com/archives/C0645JP1W81/p1723648335555529",kamilmielnik,2024-08-14 15:28:46+00:00,[],2025-02-04 20:27:50+00:00,,https://github.com/metabase/metabase/issues/46845,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]",[],
2466176057,issue,closed,completed,Common Metrics search doesn't work when you add a space ` `,"### Describe the bug

Common Metrics search doesn't work when you add a space ` `

### To Reproduce

Create a bunch of metrics having a space in their name and try to search for them:


https://github.com/user-attachments/assets/208c7bc1-1770-4aaa-97b9-2e0ead52d999




### Expected behavior

I am able to search for names which have a space in their name

### Logs

None

### Information about your Metabase installation

```JSON
master and version 50
```


### Severity

annoying

### Additional context

_No response_",Tony-metabase,2024-08-14 15:26:05+00:00,[],2024-09-03 16:29:42+00:00,2024-08-22 14:35:05+00:00,https://github.com/metabase/metabase/issues/46843,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('.Team/Querying', ''), ('Querying/Metrics', 'v2')]","[{'comment_id': 2291083663, 'issue_id': 2466176057, 'author': 'crisptrutski', 'body': 'Not sure whether this is an issue on the FE or BE, starting from the front.', 'created_at': datetime.datetime(2024, 8, 15, 11, 7, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2291144662, 'issue_id': 2466176057, 'author': 'romeovs', 'body': 'This will be fixed when we merge https://github.com/metabase/metabase/issues/46843', 'created_at': datetime.datetime(2024, 8, 15, 12, 1, 40, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-08-15 11:07:40 UTC): Not sure whether this is an issue on the FE or BE, starting from the front.

romeovs on (2024-08-15 12:01:40 UTC): This will be fixed when we merge https://github.com/metabase/metabase/issues/46843

"
2465975233,issue,closed,completed,improve cypress local dx,cypress became unresponsive and very slow locally,uladzimirdev,2024-08-14 14:12:49+00:00,['uladzimirdev'],2024-08-14 18:36:56+00:00,2024-08-14 15:32:46+00:00,https://github.com/metabase/metabase/issues/46840,[],[],
2465878458,issue,open,,Update Milestone Automation to be Repository-aware,"Currently our milestones issue tracing logic assumes all issue mentions are from the metabase repository. (see [discussion](https://metaboat.slack.com/archives/C864UT5CZ/p1723595134585069))

We should update [this regex](https://github.com/metabase/metabase/blob/master/release/src/linked-issues.ts#L3) to only match issues in the metabase/metabase repository


",iethree,2024-08-14 13:41:44+00:00,[],2025-02-04 20:23:41+00:00,,https://github.com/metabase/metabase/issues/46838,"[('.DX', 'Developer experience and QoL related.'), ('.Team/DevEx', '')]",[],
2465859002,issue,open,,Enable FKs tests for mongo,"Most of the tests skipping Mongo (`;; mongodb doesn't support foreign keys required by this test`) should work now, after the https://github.com/metabase/metabase/pull/44894. We should verify that and remove those exceptions.",lbrdnk,2024-08-14 13:35:31+00:00,['lbrdnk'],2025-02-04 20:25:10+00:00,,https://github.com/metabase/metabase/issues/46836,"[('Database/Mongo', None), ('.Backend', ''), ('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Querying', '')]",[],
2465799503,issue,open,,Migration violates unique constraint: idx_uniq_field_table_id_parent_id_name,"### Describe the bug

A customer ran into this on upgrade to v49.20. Slack context [here](https://metaboat.slack.com/archives/C05MPF0TM3L/p1722877182120439).

The migration with ID `v49.2024-06-27T00:00:02` threw an error with a postgres app DB: 
`ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name""`.

The strange thing is, the query in the migration only updates `metabase_field.is_defective_duplicate`, but somehow throws an exception where a unique constraint on `(table_id, parent_id, name)` is violated.

So I can’t see how this is possible yet. As far as I know you shouldn’t be able to have data in Postgres that violates a unique constraint (unless there's a bug in postgres itself). You can’t even add a UNIQUE constraint with the NOT VALID [option](https://www.postgresql.org/docs/current/sql-altertable.html#SQL-ALTERTABLE-DESC-ADD-TABLE-CONSTRAINT) like you can with FOREIGN KEY constraints:
```
metabase=# ALTER TABLE metabase_field ADD CONSTRAINT idx_uniq_field_table_id_parent_id_name 
UNIQUE (table_id, parent_id, name) NOT VALID;
ERROR:  UNIQUE constraints cannot be marked NOT VALID
```

Here's the full stack trace:
```
2024-08-05 12:22:54,771 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:02::calherries encountered an exception.
UPDATE SUMMARY
Run:             7
Previously run:       274
Filtered out:        49
-------------------------------
Total change sets:     330
FILTERED CHANGE SETS SUMMARY
DBMS mismatch:        49
2024-08-05 12:22:54,801 ERROR metabase.core :: Metabase Initialization FAILED
liquibase.exception.CommandExecutionException: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:02::calherries:
   Reason: liquibase.exception.DatabaseException: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name""
 Detail: Key (table_id, parent_id, name)=(81, 2237, proprietary) already exists. [Failed SQL: (0) UPDATE metabase_field mf SET is_defective_duplicate = TRUE WHERE mf.id IN (
  SELECT id
  FROM (
    SELECT
      mf.id,
      ROW_NUMBER() OVER (
        PARTITION BY mf.table_id, mf.name, mf.parent_id
        ORDER BY
          CASE WHEN mf.active THEN 0 ELSE 1 END,
          CASE WHEN mf.nfc_path IS NULL THEN 0 ELSE 1 END,
          mf.created_at
      ) AS rn
    FROM metabase_field mf
  ) x
  WHERE x.rn > 1
)]
	at liquibase.command.CommandScope.execute(CommandScope.java:253)
	at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.Liquibase.runInScope(Liquibase.java:1419)
	at liquibase.Liquibase.update(Liquibase.java:234)
	at liquibase.Liquibase.update(Liquibase.java:212)
	at liquibase.Liquibase.update(Liquibase.java:194)
	at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:305)
	at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:287)
	at metabase.db.setup$migrate_BANG_$fn__51480.invoke(setup.clj:80)
	at metabase.db.liquibase$do_with_liquibase$f_STAR___49156.invoke(liquibase.clj:139)
	at metabase.db.liquibase$do_with_liquibase.invokeStatic(liquibase.clj:142)
	at metabase.db.liquibase$do_with_liquibase.invoke(liquibase.clj:130)
	at metabase.db.setup$migrate_BANG_.invokeStatic(setup.clj:75)
	at metabase.db.setup$migrate_BANG_.doInvoke(setup.clj:56)
	at clojure.lang.RestFn.invoke(RestFn.java:445)
	at metabase.db.setup$run_schema_migrations_BANG_.invokeStatic(setup.clj:147)
	at metabase.db.setup$run_schema_migrations_BANG_.invoke(setup.clj:141)
	at metabase.db.setup$setup_db_BANG_$fn__51508$fn__51509.invoke(setup.clj:165)
	at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:239)
	at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:225)
	at metabase.db.setup$setup_db_BANG_$fn__51508.invoke(setup.clj:160)
	at metabase.db.setup$setup_db_BANG_.invokeStatic(setup.clj:159)
	at metabase.db.setup$setup_db_BANG_.invoke(setup.clj:153)
	at metabase.db$setup_db_BANG_$fn__51528.invoke(db.clj:69)
	at metabase.db$setup_db_BANG_.invokeStatic(db.clj:64)
	at metabase.db$setup_db_BANG_.invoke(db.clj:55)
	at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:116)
	at metabase.core$init_BANG__STAR_.invoke(core.clj:101)
	at metabase.core$init_BANG_.invokeStatic(core.clj:159)
	at metabase.core$init_BANG_.invoke(core.clj:154)
	at metabase.core$start_normally.invokeStatic(core.clj:171)
	at metabase.core$start_normally.invoke(core.clj:165)
	at metabase.core$entrypoint.invokeStatic(core.clj:204)
	at metabase.core$entrypoint.doInvoke(core.clj:198)
	at clojure.lang.RestFn.invoke(RestFn.java:397)
	at clojure.lang.AFn.applyToHelper(AFn.java:152)
	at clojure.lang.RestFn.applyTo(RestFn.java:132)
	at clojure.lang.Var.applyTo(Var.java:705)
	at clojure.core$apply.invokeStatic(core.clj:667)
	at clojure.core$apply.invoke(core.clj:662)
	at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
	at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
	at clojure.lang.RestFn.invoke(RestFn.java:397)
	at clojure.lang.AFn.applyToHelper(AFn.java:152)
	at clojure.lang.RestFn.applyTo(RestFn.java:132)
	at metabase.bootstrap.main(Unknown Source)
Caused by: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:02::calherries:
   Reason: liquibase.exception.DatabaseException: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name""
 Detail: Key (table_id, parent_id, name)=(81, 2237, proprietary) already exists. [Failed SQL: (0) UPDATE metabase_field mf SET is_defective_duplicate = TRUE WHERE mf.id IN (
  SELECT id
  FROM (
    SELECT
      mf.id,
      ROW_NUMBER() OVER (
        PARTITION BY mf.table_id, mf.name, mf.parent_id
        ORDER BY
          CASE WHEN mf.active THEN 0 ELSE 1 END,
          CASE WHEN mf.nfc_path IS NULL THEN 0 ELSE 1 END,
          mf.created_at
      ) AS rn
    FROM metabase_field mf
  ) x
  WHERE x.rn > 1
)]
	at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:151)
	at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
	at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
	at liquibase.command.CommandScope.execute(CommandScope.java:217)
	... 49 more
Caused by: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v49.2024-06-27T00:00:02::calherries:
   Reason: liquibase.exception.DatabaseException: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name""
 Detail: Key (table_id, parent_id, name)=(81, 2237, proprietary) already exists. [Failed SQL: (0) UPDATE metabase_field mf SET is_defective_duplicate = TRUE WHERE mf.id IN (
  SELECT id
  FROM (
    SELECT
      mf.id,
      ROW_NUMBER() OVER (
        PARTITION BY mf.table_id, mf.name, mf.parent_id
        ORDER BY
          CASE WHEN mf.active THEN 0 ELSE 1 END,
          CASE WHEN mf.nfc_path IS NULL THEN 0 ELSE 1 END,
          mf.created_at
      ) AS rn
    FROM metabase_field mf
  ) x
  WHERE x.rn > 1
)]
	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:797)
	at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
	at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
	at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.Scope.child(Scope.java:252)
	at liquibase.Scope.child(Scope.java:256)
	at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
	... 57 more
Caused by: liquibase.exception.DatabaseException: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name""
 Detail: Key (table_id, parent_id, name)=(81, 2237, proprietary) already exists. [Failed SQL: (0) UPDATE metabase_field mf SET is_defective_duplicate = TRUE WHERE mf.id IN (
  SELECT id
  FROM (
    SELECT
      mf.id,
      ROW_NUMBER() OVER (
        PARTITION BY mf.table_id, mf.name, mf.parent_id
        ORDER BY
          CASE WHEN mf.active THEN 0 ELSE 1 END,
          CASE WHEN mf.nfc_path IS NULL THEN 0 ELSE 1 END,
          mf.created_at
      ) AS rn
    FROM metabase_field mf
  ) x
  WHERE x.rn > 1
)]
	at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
	at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
	at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
	at liquibase.database.AbstractJdbcDatabase.execute(AbstractJdbcDatabase.java:1291)
	at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1273)
	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
	... 72 more
Caused by: org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint ""idx_uniq_field_table_id_parent_id_name""
 Detail: Key (table_id, parent_id, name)=(81, 2237, proprietary) already exists.
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
	at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
	at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
	... 77 more
2024-08-05 12:22:54,808 INFO metabase.core :: Metabase Shutting Down ...
2024-08-05 12:22:54,809 INFO metabase.server :: Shutting Down Embedded Jetty Webserver
2024-08-05 12:22:54,817 WARN db.liquibase :: ()
2024-08-05 12:22:54,818 INFO metabase.core :: Metabase Shutdown COMPLETE
```

### To Reproduce

no repro yet.

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
49.20
```


### Severity

low

### Additional context

_No response_",calherries,2024-08-14 13:12:01+00:00,[],2025-02-04 20:24:35+00:00,,https://github.com/metabase/metabase/issues/46833,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Metadata & Sync', ''), ('.Backend', ''), ('.Team/Querying', '')]",[],
2465769604,issue,closed,completed,Aggregation picker does not show all columns,"### Describe the bug

https://github.com/user-attachments/assets/9b1325b5-5085-47bc-807f-4b0ea7113aa3


### To Reproduce

1. New > Question > Orders
2. Join Reviews on Product ID = Product ID
3. Summarize > Count > Created At: Month
4. Join Reviews on Created At: Month = Created At: Month
5. Summarize > Count

A) Click ""Pick a column to group by"" > Click ""Review"" section 
:x: It's not possible to select ""Created At: Month"" and ""Count"" columns anymore (without closing the dropdown or searching for them)

B) Click ""Pick a column to group by"" > Click ""Review"" section > Pick any column > Edit the breakout
:x: It's not possible to select ""Created At: Month"" and ""Count"" columns anymore (without searching for them)

### Information about your Metabase installation

master, a4f1223d1deef0bd5c83d31b4cb1fa484dc68d8f


### Severity

P2
",kamilmielnik,2024-08-14 12:58:56+00:00,['kamilmielnik'],2025-01-20 09:47:18+00:00,2025-01-20 07:50:12+00:00,https://github.com/metabase/metabase/issues/46832,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/MBQL', ''), ('Difficulty:Easy', ''), ('.Frontend', ''), ('.Team/Querying', ''), ('.Possibly Already Fixed', 'This might already be fixed, e.g. because we fixed something similar to it recently. TODO-list')]","[{'comment_id': 2304527523, 'issue_id': 2465769604, 'author': 'romeovs', 'body': 'The root cause here is `Lib.columnGroups` is returning groups that have an empty `displayName` [here](https://github.com/metabase/metabase/blob/master/frontend/src/metabase/query_builder/components/notebook/steps/BreakoutStep/BreakoutStep.tsx#L121).\r\n\r\nWe can could work around it by providing a fallback group name (like ""Previous results"" in the breakout step), but I think this should be fixed in Lib instead. Tagging as `.Backend` for that reason.\r\n\r\nUpdate: empty `displayName` from `Lib.displayInfo` is a known issue with MBQL. We need to fix it there.', 'created_at': datetime.datetime(2024, 8, 22, 12, 17, 36, tzinfo=datetime.timezone.utc)}]","romeovs on (2024-08-22 12:17:36 UTC): The root cause here is `Lib.columnGroups` is returning groups that have an empty `displayName` [here](https://github.com/metabase/metabase/blob/master/frontend/src/metabase/query_builder/components/notebook/steps/BreakoutStep/BreakoutStep.tsx#L121).

We can could work around it by providing a fallback group name (like ""Previous results"" in the breakout step), but I think this should be fixed in Lib instead. Tagging as `.Backend` for that reason.

Update: empty `displayName` from `Lib.displayInfo` is a known issue with MBQL. We need to fix it there.

"
2465737980,issue,closed,completed,OOM error during send-pulses task,"### Describe the bug

There's an OOM error happening to some instances in cloud from the `task.send-pulses`.


### To Reproduce

no reproduction steps yet.

### Expected behavior

~

### Logs

[Example logs 1](https://grafana.monitoring.metabase.com/d/Zjw_nJX7k/metabase-logs?orgId=1&var-cluster=prod-prod-eu-central-1&var-filter=OutOfMemoryError&var-namespace=All&var-dns_host=downtown-music.metabaseapp.com&var-pod=All&from=1723507200000&to=1723679999000) (v49.21)

[Example logs 2](https://grafana.monitoring.metabase.com/d/Zjw_nJX7k/metabase-logs?orgId=1&var-cluster=prod-prod-ap-southeast-1&var-filter=OutOfMemoryError&var-namespace=All&var-dns_host=quickli-79.metabaseapp.com&var-pod=All&from=1723507200000&to=1723679999000) (v49.22)

### Information about your Metabase installation

```JSON
49.21 and 49.22
```


### Severity

high

### Additional context

_No response_",calherries,2024-08-14 12:45:18+00:00,[],2024-12-09 13:09:28+00:00,2024-12-09 13:09:26+00:00,https://github.com/metabase/metabase/issues/46830,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Pulses', 'Now called Subscriptions'), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2298020371, 'issue_id': 2465737980, 'author': 'qnkhuat', 'body': ""We've changed the mechanism to send pulse in 50, see https://github.com/metabase/metabase/pull/41772.\r\n\r\nLet's see if this fixes the OOM issue."", 'created_at': datetime.datetime(2024, 8, 20, 5, 51, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2527883295, 'issue_id': 2465737980, 'author': 'qnkhuat', 'body': 'Closing in favor of https://github.com/metabase/metabase/issues/50863', 'created_at': datetime.datetime(2024, 12, 9, 13, 9, 26, tzinfo=datetime.timezone.utc)}]","qnkhuat on (2024-08-20 05:51:35 UTC): We've changed the mechanism to send pulse in 50, see https://github.com/metabase/metabase/pull/41772.

Let's see if this fixes the OOM issue.

qnkhuat on (2024-12-09 13:09:26 UTC): Closing in favor of https://github.com/metabase/metabase/issues/50863

"
