id,type,state,state_reason,title,body,author,created_at,assignees,updated_at,closed_at,url,labels,comments_list,comment_thread
2763503393,issue,open,,"""You need to set up integration"" modal looks weird","### Describe the bug

When you try to create an alert but you don't have email, slack, or webhook integration set up, you get a modal that prompts you to do it. 

The modal looks weird - e.g. it's very wide.

![Image](https://github.com/user-attachments/assets/f3c36b47-f50e-4c73-8a31-be5793b62b99)


[Slack thread](https://metaboat.slack.com/archives/C01LQQ2UW03/p1735578959390629)

### To Reproduce

1. Start with a new instance with no integration set up
2. Create any question, e.g. Count of Products by Created At: Month
3. Save the question
4. Click on the ""Sharing"" icon

-> The modal will open

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
52.4
```

### Severity

P3, looks weird

### Additional context

_No response_",alexyarosh,2024-12-30 17:32:39+00:00,[],2025-02-04 20:26:26+00:00,,https://github.com/metabase/metabase/issues/51695,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Notifications/Slack', ''), ('.Team/Workflows', 'aka BEC'), ('Notifications/Webhooks', '')]",[],
2763379751,issue,closed,completed,Docs still reference bell icon,"### Describe the bug

[This page](https://www.metabase.com/docs/latest/questions/sharing/alerts) still says to look for a bell icon to update alerts, but it seems like that's been removed. [This page](https://www.metabase.com/docs/latest/questions/sharing/alerts) has the correct instructions.



### To Reproduce

Just an issue with documentation


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""redshift"",
      ""snowflake""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-19"",
      ""tag"": ""v0.51.4"",
      ""hash"": ""47f05f3""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""17.2""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9-post-Ubuntu-1ubuntu122.04"",
    ""java.vendor"": ""Ubuntu"",
    ""java.vendor.url"": ""https://ubuntu.com/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9-post-Ubuntu-1ubuntu122.04"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.115-126.197.amzn2023.aarch64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```

### Severity

issue with documentation

### Additional context

_No response_",nbrustein,2024-12-30 15:40:17+00:00,['alexyarosh'],2025-01-03 17:03:15+00:00,2025-01-03 17:03:15+00:00,https://github.com/metabase/metabase/issues/51694,"[('Type:Documentation', '')]",[],
2762950650,issue,open,,[MLv2] Compiled query has wrong aliases when generating ref for joined field on next stage,"_EDIT_: Original reproduction query used `with-fields` function incorrectly, in query that contained a join. To return joined fields, `with-join-fields` function should be used. The question was modified to use `with-fields` on another stage to demonstrate the `with-fields` with `visible-columns` problem, that is described later in this issue.

Second stage field ref that was created by `with-fields` and `visible-columns` combination (see the attached test) is compiled to incorrect sql (see the attached snippet). Query, when constructed as in the test, should compile to correct sql and execute with no error. 

Noteworthy:
- If the second stage of the `q` is left empty, the query compiles just fine. Second stage `:fields` are added in different code path: `metabase.query-processor.middleware.add-implicit-clauses/add-implicit-fields`.
- Use of `fieldable-columns` instead of `visible-columns` produces same result.
- Fails on master `ef01a0f9f10633bee72eade16bbe0a935a0472fd`.
- To make test executable copy it into `metabase.query-processor.middleware.metrics-test` ns and add require for `metabase.lib.stage`.

Test stub:
```
(deftest with-fields-repro-test
  (let [mp (lib.metadata.jvm/application-database-metadata-provider (mt/id))]
    (mt/with-temp
      [:model/Card
       {id :id}
       {:dataset_query (lib.convert/->legacy-MBQL
                        (-> (lib/query mp (lib.metadata/table mp (mt/id :products)))
                            (lib/aggregate
                             (lib/avg (lib.metadata/field mp (mt/id :products :price))))))}
       :model/Card
       {id2 :id}
       {:dataset_query (lib.convert/->legacy-MBQL
                        (as-> (lib/query mp (lib.metadata/table mp (mt/id :products)))
                              $
                          (lib/join $ (lib/with-join-alias (lib/join-clause (lib.metadata/card mp id)
                                                                            [(lib/= (lib/+ 1 1) 2)]
                                                                            :left-join)
                                        ""A""))
                          (lib/breakout $ (m/find-first :metabase.lib.join/join-alias (lib/breakoutable-columns $)))))}]
      (let [q (as-> (lib/query mp (lib.metadata/table mp (mt/id :products))) $
                (lib/join $ (lib/with-join-alias (lib/join-clause (lib.metadata/card mp id2)
                                                                  [(lib/= (lib/+ 1 1) 2)]
                                                                  :left-join)
                              ""B""))
                (lib/append-stage $)
                (lib/with-fields $ [(m/find-first (comp #{""avg""} :name) (lib/visible-columns $))]))]
        (def p (metabase.query-processor.preprocess/preprocess q))
        (def c (metabase.query-processor.compile/compile q))
        ;; Execution (ie. following line) fails!
        (qp/process-query q)))))
```

Compiled sql:
```
SELECT
    -- Source alias on the next line is incorrect, missing the A__ prefix for the name.
    ""source"".""B__avg"" AS ""B__avg""
FROM
    (
        SELECT
            ""PUBLIC"".""PRODUCTS"".""ID"" AS ""ID"",
            ""PUBLIC"".""PRODUCTS"".""EAN"" AS ""EAN"",
            ""PUBLIC"".""PRODUCTS"".""TITLE"" AS ""TITLE"",
            ""PUBLIC"".""PRODUCTS"".""CATEGORY"" AS ""CATEGORY"",
            ""PUBLIC"".""PRODUCTS"".""VENDOR"" AS ""VENDOR"",
            ""PUBLIC"".""PRODUCTS"".""PRICE"" AS ""PRICE"",
            ""PUBLIC"".""PRODUCTS"".""RATING"" AS ""RATING"",
            ""PUBLIC"".""PRODUCTS"".""CREATED_AT"" AS ""CREATED_AT"",
            ""B"".""A__avg"" AS ""B__A__avg""
        FROM
            ""PUBLIC"".""PRODUCTS""
            LEFT JOIN (
                SELECT
                    ""A"".""avg"" AS ""A__avg""
                FROM
                    ""PUBLIC"".""PRODUCTS""
                    LEFT JOIN (
                        SELECT
                            AVG(""PUBLIC"".""PRODUCTS"".""PRICE"") AS ""avg""
                        FROM
                            ""PUBLIC"".""PRODUCTS""
                    ) AS ""A"" ON (1 + 1) = 2
                GROUP BY
                    ""A"".""avg""
                ORDER BY
                    ""A"".""avg"" ASC
            ) AS ""B"" ON (1 + 1) = 2
    ) AS ""source""
LIMIT
    1048575
```

",lbrdnk,2024-12-30 09:54:54+00:00,[],2025-02-04 20:27:57+00:00,,https://github.com/metabase/metabase/issues/51690,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('Querying/MBQL', ''), ('Querying/Nested Queries', 'Questions based on other saved questions'), ('.Backend', ''), ('.metabase-lib', 'Label for tracking all issues related to the shared CLJC metabase-lib'), ('.Team/Querying', '')]",[],
2762049136,issue,closed,completed,Link Checker Report,"[Full Github Actions output](https://github.com/metabase/metabase/actions/runs/12530869564?check_suite_focus=true)
",github-actions[bot],2024-12-29 00:20:08+00:00,['jeff-bruemmer'],2025-01-02 14:02:10+00:00,2025-01-02 14:02:09+00:00,https://github.com/metabase/metabase/issues/51686,"[('Type:Documentation', '')]",[],
2761119750,issue,open,,Field Values must short circuit on sync ending errors,"### Describe the bug

Syncing field values does not short circuit on errors which indicate a sync job has no hope of completing.

Background: 
We've seen a _ton_ of snowflake logs logging that they must use MFA and that it cannot get a connection.
https://github.com/snowflakedb/snowflake-jdbc/blob/master/src/main/java/net/snowflake/client/core/SessionUtil.java#L743-L746

This happens a lot when c3p0 is trying to get us a connection in https://github.com/swaldman/c3p0/blob/0.10.x/src/com/mchange/v2/c3p0/impl/C3P0PooledConnectionPool.java#L901

We are _flooding_ with logs. As a short term effort we are turning off this log hitting us, but that means we are still doing a _ton_ of work that has no hope of succeeding. So let's not do the work.

We have some abort retry logic in mb.sync.util:

```clojure
(doseq [klass [java.net.ConnectException
               java.net.NoRouteToHostException
               java.net.UnknownHostException
               com.mchange.v2.resourcepool.CannotAcquireResourceException
               javax.net.ssl.SSLHandshakeException]]
  (derive klass ::exception-class-not-to-retry))

(defn- do-not-retry-exception? [e]
  (or (isa? (class e) ::exception-class-not-to-retry)
      (some-> (ex-cause e) recur)))
```

And this _does_ register the error that is thrown in this pathway:

```clojure
util=> (do-not-retry-exception?
         (com.mchange.v2.sql.SqlUtils/toSQLException
           ""Connections could not be qcquired from the underlying database!""
           ""08001""
           (com.mchange.v2.resourcepool.CannotAcquireResourceException.)))
true
```

And we can even add a test that this is true:

```clojure
(deftest ^:parallel error-handling-test
  (testing ""A ConnectException will cause sync to stop""
    (mt/dataset time-test-data
      (doseq [error [(java.io.IOException.
                      ""outer""
                      (java.net.ConnectException.
                       ""inner, this one triggers the failure""))
                     ;; this is what c3p0 throws in checkoutPooledConnection
                     (SqlUtils/toSQLException ""Connections could not be qcquired from the underlying database!""
                                              ""08001""
                                              (CannotAcquireResourceException.))]]
        (let [expected           error
              actual             (sync-util/sync-operation ::sync-error-handling (mt/db) ""sync error handling test""
                                                           (sync-util/run-sync-operation
                                                            ""sync""
                                                            (mt/db)
                                                            [(sync-util/create-sync-step ""failure-step""
                                                                                         (fn [_]
                                                                                           (throw expected)))
                                                             (sync-util/create-sync-step ""should-not-run""
                                                                                         (fn [_]
                                                                                           {}))]))
              [step-name result] (first (:steps actual))]
          (is (= 1 (count (:steps actual))))
          (is (= ""failure-step"" step-name))
          (is (= {:throwable expected :log-summary-fn nil}
                 (dissoc result :start-time :end-time))))))))

,,,
util-test=> (clojure.test/run-test error-handling-test)

Testing metabase.sync.util-test

Ran 1 tests containing 6 assertions.
0 failures, 0 errors.
{:test 1, :pass 6, :fail 0, :error 0, :type :summary}
```

However, this machinery does not help us when running the field values task that runs in sync database task.

If we update `create-or-update-full-field-values!` to 

```clojure
(throw (com.mchange.v2.sql.SqlUtils/toSQLException
         ""Connections could not be qcquired from the underlying database!""
         ""08001""
         (com.mchange.v2.resourcepool.CannotAcquireResourceException.)))
```

We would hope that we hit this error _once_. But that is not the case

```clojure
sync-databases=> (let [database (t2/select-one :model/Database :id 1)]
                   (sync.field-values/update-field-values! database))
{:start-time """"
 :end-time """"
 :steps [[""delete-expired-advanced-field-values""
          {:deleted 0}]
         [""update-field-values""
          {:errors 24, :created 0, :updated 0, :deleted 0}]]}
```

And this means we have no hope of succeeding, we hit this error 24 times instead of once. We are doing work repeatedly that we know and can classify as futile.

### To Reproduce

The actual pathway that our customers are hitting is to have snowflake connected, and then add MFA to the account and watch it fail.

A simple way locally is to modify `metabase.models.field-values/create-or-update-full-field-values!` to throw 

```clojure
    (throw (com.mchange.v2.sql.SqlUtils/toSQLException ""Connections could not be qcquired from the underlying database!""
                                    ""08001""
                                    (com.mchange.v2.resourcepool.CannotAcquireResourceException.)))
```

And then sync the sample database. Note there is some logic about inactive fields in `metabase.sync.field-values/update-field-values-for-field!` that checks `(field-values/inactive? field-values)` and i commented that out so it would always hit the `field-values/create-or-update-full-field-values!` branch.

### Expected behavior

One of these errors should stop the rest of the sync job.

For instance, the current output is 

```clojure
{:start-time """"
 :end-time """"
 :steps [[""delete-expired-advanced-field-values""
          {:deleted 0}]
         [""update-field-values""
          {:errors 24, :created 0, :updated 0, :deleted 0}]]}
```

There seem to be multiple ways to fix this:
- there's lots of error insulation on the field values. It does addition and is careful to catch exceptions so that it can add numbers, using 0 on a swallowed error. Putting the `com.mchange.v2.sql.SqlUtils/toSQLException` trick in various places of syncing fields doesn't work because of lots of opaque error handling.

```clojure
sync-databases=> (let [database (t2/select-one :model/Database :id 1)]
                   (f (sync-metadata/sync-db-metadata! database)))
{:steps [[""sync-dbms-version""
          {:flavor ""H2"",
           :version ""2.1.214 (2022-06-13)"",
           :semantic-version [2 1]}]
         [""sync-timezone"" {:timezone-id ""UTC""}]
         [""sync-tables"" {:updated-tables 0, :total-tables 8}]
         [""sync-fields""
          {:throwable #object[java.sql.SQLException
                              ""0x13146d4e""
                              ""java.sql.SQLException: Connections could not be qcquired from the underlying database!""]}]]}
```

Here is successfully stops syncing when i put the exception at the right level. Note i had to turn error checking off because the type it expects does not handle an error. And at that point the error returned actually is _not_ interruptible. Note here that the sync fields step is the last step because the `:throwable` key aborts the remaining steps.

```clojure
(mu/defn sync-fields! #_#_ :- [:map
                          [:updated-fields ms/IntGreaterThanOrEqualToZero]
                          [:total-fields   ms/IntGreaterThanOrEqualToZero]]
  ""Sync the Fields in the Metabase application database for all the Tables in a `database`.""
  [database :- i/DatabaseInstance]
  (sync-util/with-error-handling (format ""Error syncing Fields for Database ''%s''"" (sync-util/name-for-logging database))
    (throw (doto (com.mchange.v2.sql.SqlUtils/toSQLException ""Connections could not be qcquired from the underlying database!""
                                                        ""08001""
                                                        (com.mchange.v2.resourcepool.CannotAcquireResourceException.))
             (.setStackTrace (into-array StackTraceElement []))))
```


If I leave the type checking in, I get the following error

```clojure
{:steps [[""sync-dbms-version""
          {:flavor ""H2"",
           :version ""2.1.214 (2022-06-13)"",
           :semantic-version [2 1]}]
         [""sync-timezone"" {:timezone-id ""UTC""}]
         [""sync-tables"" {:updated-tables 0, :total-tables 8}]
         [""sync-fields""
          {:throwable #object[clojure.lang.ExceptionInfo
                              ""0x79aa5272""
                              ""clojure.lang.ExceptionInfo: Invalid output: [\""invalid type, got: #error {\\n :cause \\\""\\\""\\n :via\\n [{:type java.sql.SQLException\\n   :message \\\""Connections could not be qcquired from the underlying database!\\\""}\\n  {:type com.mchange.v2.resourcepool.CannotAcquireResourceException\\n   :message \\\""\\\""\\n   :at [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \\\""fields.clj\\\"" 76]}]\\n :trace\\n [[metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \\\""fields.clj\\\"" 76]\\n  [metabase.sync.util$do_with_error_handling invokeStatic \\\""util.clj\\\"" 191]\\n  [metabase.sync.util$do_with_error_handling invoke \\\""util.clj\\\"" 184]\\n  [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460 invoke \\\""fields.clj\\\"" 76]\\n  [metabase.sync.sync_metadata.fields$fn__3613459$fn__3613474 invoke \\\""fields.clj\\\"" 71]\\n  [clojure.lang.AFn applyToHelper \\\""AFn.java\\\"" 154]\\n  [clojure.lang.AFn applyTo \\\""AFn.java\\\"" 144]\\n  [clojure.core$apply invokeStatic \\\""core.clj\\\"" 669]\\n  [clojure.core$apply invoke \\\""core.clj\\\"" 662]\\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047$fn__3613050 invoke \\\""util.clj\\\"" 495]\\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \\\""task_history.clj\\\"" 122]\\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \\\""task_history.clj\\\"" 110]\\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047 doInvoke \\\""util.clj\\\"" 488]\\n  [clojure.lang.RestFn invoke \\\""RestFn.java\\\"" 400]\\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \\\""util.clj\\\"" 132]\\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \\\""util.clj\\\"" 126]\\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invokeStatic \\\""util.clj\\\"" 150]\\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invoke \\\""util.clj\\\"" 146]\\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045 invoke \\\""util.clj\\\"" 482]\\n  [metabase.sync.util$fn__3613043$fn__3613058 invoke \\\""util.clj\\\"" 477]\\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111$fn__3613119 invoke \\\""util.clj\\\"" 577]\\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111 invoke \\\""util.clj\\\"" 575]\\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \\\""task_history.clj\\\"" 122]\\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \\\""task_history.clj\\\"" 110]\\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110 invoke \\\""util.clj\\\"" 572]\\n  [metabase.sync.util$fn__3613109$fn__3613129 invoke \\\""util.clj\\\"" 567]\\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455$fn__141456 invoke \\\""sync_metadata.clj\\\"" 70]\\n  [metabase.sync.util$do_with_error_handling invokeStatic \\\""util.clj\\\"" 191]\\n  [metabase.sync.util$do_with_error_handling invoke \\\""util.clj\\\"" 184]\\n  [clojure.core$partial$fn__5929 invoke \\\""core.clj\\\"" 2647]\\n  [metabase.driver$eval89685$fn__89686 invoke \\\""driver.clj\\\"" 910]\\n  [clojure.lang.MultiFn invoke \\\""MultiFn.java\\\"" 239]\\n  [metabase.sync.util$sync_in_context$fn__3612917 invoke \\\""util.clj\\\"" 167]\\n  [metabase.sync.util$with_db_logging_disabled$fn__3612914 invoke \\\""util.clj\\\"" 159]\\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \\\""util.clj\\\"" 132]\\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \\\""util.clj\\\"" 126
]\\n  [metabase.sync.util$with_start_and_finish_logging$fn__3612897 invoke \\\""util.clj\\\"" 144]\\n  [metabase.sync.util$fn__3612884$with_sync_events3612883__3612885$fn__3612889 invoke \\\""util.clj\\\"" 118]\\n  [metabase.sync.util$with_duplicate_ops_prevented$fn__3612871 invoke \\\""util.clj\\\"" 90]\\n  [metabase.sync.util$fn__3612939$do_sync_operation3612938__3612940 invoke \\\""util.clj\\\"" 216]\\n  [metabase.sync.util$fn__3612939$fn__3612942 invoke \\\""util.clj\\\"" 210]\\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455 invoke \\\""sync_metadata.clj\\\"" 68]\\n  [metabase.sync.sync_metadata$fn__141454$fn__141459 invoke \\\""sync_metadata.clj\\\"" 65]\\n  [metabase.task.sync_databases$eval3613486 invokeStatic \\\""NO_SOURCE_FILE\\\"" 636]\\n  [metabase.task.sync_databases$eval3613486 invoke \\\""NO_SOURCE_FILE\\\"" 635]\\n  [clojure.lang.Compiler eval \\\""Compiler.java\\\"" 7700]\\n  [clojure.lang.Compiler eval \\\""Compiler.java\\\"" 7655]\\n  [clojure.core$eval invokeStatic \\\""core.clj\\\"" 3232]\\n  [clojure.core$eval invoke \\\""core.clj\\\"" 3228]\\n  [user$eval3444021$fn__3444024 invoke \\\""NO_SOURCE_FILE\\\"" 8]\\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \\\""main.clj\\\"" 437]\\n  [clojure.main$repl$read_eval_print__9244 invoke \\\""main.clj\\\"" 437]\\n  [clojure.main$repl$fn__9253 invoke \\\""main.clj\\\"" 459]\\n  [clojure.main$repl invokeStatic \\\""main.clj\\\"" 459]\\n  [clojure.main$repl doInvoke \\\""main.clj\\\"" 368]\\n  [clojure.lang.RestFn invoke \\\""RestFn.java\\\"" 622]\\n  [user$eval3444021 invokeStatic \\\""NO_SOURCE_FILE\\\"" 6]\\n  [user$eval3444021 invoke \\\""NO_SOURCE_FILE\\\"" 6]\\n  [clojure.lang.Compiler eval \\\""Compiler.java\\\"" 7700]\\n  [clojure.lang.Compiler eval \\\""Compiler.java\\\"" 7655]\\n  [clojure.core$eval invokeStatic \\\""core.clj\\\"" 3232]\\n  [clojure.core$eval invoke \\\""core.clj\\\"" 3228]\\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \\\""main.clj\\\"" 437]\\n  [clojure.main$repl$read_eval_print__9244 invoke \\\""main.clj\\\"" 437]\\n  [clojure.main$repl$fn__9253 invoke \\\""main.clj\\\"" 459]\\n  [clojure.main$repl invokeStatic \\\""main.clj\\\"" 459]\\n  [clojure.core.server$repl invokeStatic \\\""server.clj\\\"" 183]\\n  [clojure.core.server$repl invoke \\\""server.clj\\\"" 183]\\n  [clojure.lang.AFn applyToHelper \\\""AFn.java\\\"" 152]\\n  [clojure.lang.AFn applyTo \\\""AFn.java\\\"" 144]\\n  [clojure.lang.Var applyTo \\\""Var.java\\\"" 707]\\n  [clojure.core$apply invokeStatic \\\""core.clj\\\"" 667]\\n  [clojure.core.server$accept_connection invokeStatic \\\""server.clj\\\"" 74]\\n  [clojure.core.server$start_server$fn__9040$fn__9041$fn__9043 invoke \\\""server.clj\\\"" 118]\\n  [clojure.lang.AFn run \\\""AFn.java\\\"" 22]\\n  [java.lang.Thread run \\\""Thread.java\\\"" 1583]]}\""] {:type :metabase.util.malli.fn/invalid-output, :error {:schema [:map [:updated-fields [:int {:min 0, :description #metabase.util.i18n.UserLocalizedString{:format-string \""value must be an integer greater than zero.\"", :args [], :pluralization-opts {}}, :error/fn #object[clojure.core$constantly$fn__5759 0x1a42a52d \""clojure.core$constantly$fn__5759@1a42a52d\""]}]] [:total-fields [:int {:min 0, :description #metabase.util.i18n.UserLocalizedString{:format-string \""value must be an integer greater than zero.\"", :args [], :pluralization-opts {}}, :error/fn #object[clojure.core$constantly$fn__5759 0x1a42a52d \""clojure.core$constantly$fn__5759@1a42a52d\""]}]]], :value #error {\n :cause \""\""\n :via\n [{:type java.sql.SQLException\n   :message \""Connections could not be qcquired from the underlying database!\""}\n  {:type com.mchange.v2.resourcepool.CannotAcquireResourceException\n   :message \""\""\n   :at [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \""fields.clj\"" 76]}]\n :trace\n [[metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \""fields.clj\"" 76]\n  [metabase.sync.util$do_with_error_handling invokeStatic \""util.clj\"" 191]\n  [metabase.sync.util$do_with_error_handling invoke \""util.clj\"" 
184]\n  [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460 invoke \""fields.clj\"" 76]\n  [metabase.sync.sync_metadata.fields$fn__3613459$fn__3613474 invoke \""fields.clj\"" 71]\n  [clojure.lang.AFn applyToHelper \""AFn.java\"" 154]\n  [clojure.lang.AFn applyTo \""AFn.java\"" 144]\n  [clojure.core$apply invokeStatic \""core.clj\"" 669]\n  [clojure.core$apply invoke \""core.clj\"" 662]\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047$fn__3613050 invoke \""util.clj\"" 495]\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \""task_history.clj\"" 122]\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \""task_history.clj\"" 110]\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047 doInvoke \""util.clj\"" 488]\n  [clojure.lang.RestFn invoke \""RestFn.java\"" 400]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \""util.clj\"" 132]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \""util.clj\"" 126]\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invokeStatic \""util.clj\"" 150]\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invoke \""util.clj\"" 146]\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045 invoke \""util.clj\"" 482]\n  [metabase.sync.util$fn__3613043$fn__3613058 invoke \""util.clj\"" 477]\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111$fn__3613119 invoke \""util.clj\"" 577]\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111 invoke \""util.clj\"" 575]\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \""task_history.clj\"" 122]\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \""task_history.clj\"" 110]\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110 invoke \""util.clj\"" 572]\n  [metabase.sync.util$fn__3613109$fn__3613129 invoke \""util.clj\"" 567]\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455$fn__141456 invoke \""sync_metadata.clj\"" 70]\n  [metabase.sync.util$do_with_error_handling invokeStatic \""util.clj\"" 191]\n  [metabase.sync.util$do_with_error_handling invoke \""util.clj\"" 184]\n  [clojure.core$partial$fn__5929 invoke \""core.clj\"" 2647]\n  [metabase.driver$eval89685$fn__89686 invoke \""driver.clj\"" 910]\n  [clojure.lang.MultiFn invoke \""MultiFn.java\"" 239]\n  [metabase.sync.util$sync_in_context$fn__3612917 invoke \""util.clj\"" 167]\n  [metabase.sync.util$with_db_logging_disabled$fn__3612914 invoke \""util.clj\"" 159]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \""util.clj\"" 132]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \""util.clj\"" 126]\n  [metabase.sync.util$with_start_and_finish_logging$fn__3612897 invoke \""util.clj\"" 144]\n  [metabase.sync.util$fn__3612884$with_sync_events3612883__3612885$fn__3612889 invoke \""util.clj\"" 118]\n  [metabase.sync.util$with_duplicate_ops_prevented$fn__3612871 invoke \""util.clj\"" 90]\n  [metabase.sync.util$fn__3612939$do_sync_operation3612938__3612940 invoke \""util.clj\"" 216]\n  [metabase.sync.util$fn__3612939$fn__3612942 invoke \""util.clj\"" 210]\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455 invoke \""sync_metadata.clj\"" 68]\n  [metabase.sync.sync_metadata$fn__141454$fn__141459 invoke \""sync_metadata.clj\"" 65]\n  [metabase.task.sync_databases$eval3613486 invokeStatic \""NO_SOURCE_FILE\"" 636]\n  [metabase.task.sync_databases$eval3613486 invoke \""NO_SOURCE_FILE\"" 635]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7700]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7655]\n  [clojure.core$eval invokeStatic \""core.clj\"" 3232]\n  [clojure.core$eval invoke \""core.clj\"" 3228]\n  [user$eval3444021$fn__3444024 invoke \""NO_SOURCE_FILE\"" 8]\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \""main.clj\"" 437]\n  [clojure.main$repl$read_eval_print__9244 invoke \""main.clj\"" 437]\n  [clojure.main$repl$fn__9253 invoke \""main.clj\"" 459]\n  [clojure.main$repl
 invokeStatic \""main.clj\"" 459]\n  [clojure.main$repl doInvoke \""main.clj\"" 368]\n  [clojure.lang.RestFn invoke \""RestFn.java\"" 622]\n  [user$eval3444021 invokeStatic \""NO_SOURCE_FILE\"" 6]\n  [user$eval3444021 invoke \""NO_SOURCE_FILE\"" 6]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7700]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7655]\n  [clojure.core$eval invokeStatic \""core.clj\"" 3232]\n  [clojure.core$eval invoke \""core.clj\"" 3228]\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \""main.clj\"" 437]\n  [clojure.main$repl$read_eval_print__9244 invoke \""main.clj\"" 437]\n  [clojure.main$repl$fn__9253 invoke \""main.clj\"" 459]\n  [clojure.main$repl invokeStatic \""main.clj\"" 459]\n  [clojure.core.server$repl invokeStatic \""server.clj\"" 183]\n  [clojure.core.server$repl invoke \""server.clj\"" 183]\n  [clojure.lang.AFn applyToHelper \""AFn.java\"" 152]\n  [clojure.lang.AFn applyTo \""AFn.java\"" 144]\n  [clojure.lang.Var applyTo \""Var.java\"" 707]\n  [clojure.core$apply invokeStatic \""core.clj\"" 667]\n  [clojure.core.server$accept_connection invokeStatic \""server.clj\"" 74]\n  [clojure.core.server$start_server$fn__9040$fn__9041$fn__9043 invoke \""server.clj\"" 118]\n  [clojure.lang.AFn run \""AFn.java\"" 22]\n  [java.lang.Thread run \""Thread.java\"" 1583]]}, :errors ({:path [], :in [], :schema [:map [:updated-fields [:int {:min 0, :description #metabase.util.i18n.UserLocalizedString{:format-string \""value must be an integer greater than zero.\"", :args [], :pluralization-opts {}}, :error/fn #object[clojure.core$constantly$fn__5759 0x1a42a52d \""clojure.core$constantly$fn__5759@1a42a52d\""]}]] [:total-fields [:int {:min 0, :description #metabase.util.i18n.UserLocalizedString{:format-string \""value must be an integer greater than zero.\"", :args [], :pluralization-opts {}}, :error/fn #object[clojure.core$constantly$fn__5759 0x1a42a52d \""clojure.core$constantly$fn__5759@1a42a52d\""]}]]], :value #error {\n :cause \""\""\n :via\n [{:type java.sql.SQLException\n   :message \""Connections could not be qcquired from the underlying database!\""}\n  {:type com.mchange.v2.resourcepool.CannotAcquireResourceException\n   :message \""\""\n   :at [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \""fields.clj\"" 76]}]\n :trace\n [[metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \""fields.clj\"" 76]\n  [metabase.sync.util$do_with_error_handling invokeStatic \""util.clj\"" 191]\n  [metabase.sync.util$do_with_error_handling invoke \""util.clj\"" 184]\n  [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460 invoke \""fields.clj\"" 76]\n  [metabase.sync.sync_metadata.fields$fn__3613459$fn__3613474 invoke \""fields.clj\"" 71]\n  [clojure.lang.AFn applyToHelper \""AFn.java\"" 154]\n  [clojure.lang.AFn applyTo \""AFn.java\"" 144]\n  [clojure.core$apply invokeStatic \""core.clj\"" 669]\n  [clojure.core$apply invoke \""core.clj\"" 662]\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047$fn__3613050 invoke \""util.clj\"" 495]\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \""task_history.clj\"" 122]\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \""task_history.clj\"" 110]\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047 doInvoke \""util.clj\"" 488]\n  [clojure.lang.RestFn invoke \""RestFn.java\"" 400]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \""util.clj\"" 132]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \""util.clj\"" 126]\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invokeStatic \""util.clj\"" 150]\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invoke \""util.clj\"" 146]\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045 invoke \""util.clj\"" 482]\n  [metabase.sync.util$fn__3613043$fn__3613058 invoke \""util.clj\"" 477]\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111$fn__3613119 invoke \""util.clj\"" 577]\n 
 [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111 invoke \""util.clj\"" 575]\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \""task_history.clj\"" 122]\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \""task_history.clj\"" 110]\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110 invoke \""util.clj\"" 572]\n  [metabase.sync.util$fn__3613109$fn__3613129 invoke \""util.clj\"" 567]\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455$fn__141456 invoke \""sync_metadata.clj\"" 70]\n  [metabase.sync.util$do_with_error_handling invokeStatic \""util.clj\"" 191]\n  [metabase.sync.util$do_with_error_handling invoke \""util.clj\"" 184]\n  [clojure.core$partial$fn__5929 invoke \""core.clj\"" 2647]\n  [metabase.driver$eval89685$fn__89686 invoke \""driver.clj\"" 910]\n  [clojure.lang.MultiFn invoke \""MultiFn.java\"" 239]\n  [metabase.sync.util$sync_in_context$fn__3612917 invoke \""util.clj\"" 167]\n  [metabase.sync.util$with_db_logging_disabled$fn__3612914 invoke \""util.clj\"" 159]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \""util.clj\"" 132]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \""util.clj\"" 126]\n  [metabase.sync.util$with_start_and_finish_logging$fn__3612897 invoke \""util.clj\"" 144]\n  [metabase.sync.util$fn__3612884$with_sync_events3612883__3612885$fn__3612889 invoke \""util.clj\"" 118]\n  [metabase.sync.util$with_duplicate_ops_prevented$fn__3612871 invoke \""util.clj\"" 90]\n  [metabase.sync.util$fn__3612939$do_sync_operation3612938__3612940 invoke \""util.clj\"" 216]\n  [metabase.sync.util$fn__3612939$fn__3612942 invoke \""util.clj\"" 210]\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455 invoke \""sync_metadata.clj\"" 68]\n  [metabase.sync.sync_metadata$fn__141454$fn__141459 invoke \""sync_metadata.clj\"" 65]\n  [metabase.task.sync_databases$eval3613486 invokeStatic \""NO_SOURCE_FILE\"" 636]\n  [metabase.task.sync_databases$eval3613486 invoke \""NO_SOURCE_FILE\"" 635]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7700]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7655]\n  [clojure.core$eval invokeStatic \""core.clj\"" 3232]\n  [clojure.core$eval invoke \""core.clj\"" 3228]\n  [user$eval3444021$fn__3444024 invoke \""NO_SOURCE_FILE\"" 8]\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \""main.clj\"" 437]\n  [clojure.main$repl$read_eval_print__9244 invoke \""main.clj\"" 437]\n  [clojure.main$repl$fn__9253 invoke \""main.clj\"" 459]\n  [clojure.main$repl invokeStatic \""main.clj\"" 459]\n  [clojure.main$repl doInvoke \""main.clj\"" 368]\n  [clojure.lang.RestFn invoke \""RestFn.java\"" 622]\n  [user$eval3444021 invokeStatic \""NO_SOURCE_FILE\"" 6]\n  [user$eval3444021 invoke \""NO_SOURCE_FILE\"" 6]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7700]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7655]\n  [clojure.core$eval invokeStatic \""core.clj\"" 3232]\n  [clojure.core$eval invoke \""core.clj\"" 3228]\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \""main.clj\"" 437]\n  [clojure.main$repl$read_eval_print__9244 invoke \""main.clj\"" 437]\n  [clojure.main$repl$fn__9253 invoke \""main.clj\"" 459]\n  [clojure.main$repl invokeStatic \""main.clj\"" 459]\n  [clojure.core.server$repl invokeStatic \""server.clj\"" 183]\n  [clojure.core.server$repl invoke \""server.clj\"" 183]\n  [clojure.lang.AFn applyToHelper \""AFn.java\"" 152]\n  [clojure.lang.AFn applyTo \""AFn.java\"" 144]\n  [clojure.lang.Var applyTo \""Var.java\"" 707]\n  [clojure.core$apply invokeStatic \""core.clj\"" 667]\n  [clojure.core.server$accept_connection invokeStatic \""server.clj\"" 74]\n  [clojure.core.server$start_server$fn__9040$fn__9041$fn__9043 invoke \""server.clj\"" 118]\n  [clojure.lang.AFn run \""AFn.java\"" 22]\n  [java.lang.Thread run \""Thread.java\"" 1583]]}, :type :malli.core/invalid-type})}, :humanized [\""invalid type, got: #error {\\n :cause \\\""\\\""\\n :via\\n [{:type java.sql.SQLException\\n   :message \\\""Connections could not be qcquired from the underlying database!\\\""}\\n  {:type com.mchange.v2.res
ourcepool.CannotAcquireResourceException\\n   :message \\\""\\\""\\n   :at [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \\\""fields.clj\\\"" 76]}]\\n :trace\\n [[metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \\\""fields.clj\\\"" 76]\\n  [metabase.sync.util$do_with_error_handling invokeStatic \\\""util.clj\\\"" 191]\\n  [metabase.sync.util$do_with_error_handling invoke \\\""util.clj\\\"" 184]\\n  [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460 invoke \\\""fields.clj\\\"" 76]\\n  [metabase.sync.sync_metadata.fields$fn__3613459$fn__3613474 invoke \\\""fields.clj\\\"" 71]\\n  [clojure.lang.AFn applyToHelper \\\""AFn.java\\\"" 154]\\n  [clojure.lang.AFn applyTo \\\""AFn.java\\\"" 144]\\n  [clojure.core$apply invokeStatic \\\""core.clj\\\"" 669]\\n  [clojure.core$apply invoke \\\""core.clj\\\"" 662]\\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047$fn__3613050 invoke \\\""util.clj\\\"" 495]\\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \\\""task_history.clj\\\"" 122]\\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \\\""task_history.clj\\\"" 110]\\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047 doInvoke \\\""util.clj\\\"" 488]\\n  [clojure.lang.RestFn invoke \\\""RestFn.java\\\"" 400]\\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \\\""util.clj\\\"" 132]\\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \\\""util.clj\\\"" 126]\\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invokeStatic \\\""util.clj\\\"" 150]\\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invoke \\\""util.clj\\\"" 146]\\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045 invoke \\\""util.clj\\\"" 482]\\n  [metabase.sync.util$fn__3613043$fn__3613058 invoke \\\""util.clj\\\"" 477]\\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111$fn__3613119 invoke \\\""util.clj\\\"" 577]\\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111 invoke \\\""util.clj\\\"" 575]\\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \\\""task_history.clj\\\"" 122]\\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \\\""task_history.clj\\\"" 110]\\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110 invoke \\\""util.clj\\\"" 572]\\n  [metabase.sync.util$fn__3613109$fn__3613129 invoke \\\""util.clj\\\"" 567]\\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455$fn__141456 invoke \\\""sync_metadata.clj\\\"" 70]\\n  [metabase.sync.util$do_with_error_handling invokeStatic \\\""util.clj\\\"" 191]\\n  [metabase.sync.util$do_with_error_handling invoke \\\""util.clj\\\"" 184]\\n  [clojure.core$partial$fn__5929 invoke \\\""core.clj\\\"" 2647]\\n  [metabase.driver$eval89685$fn__89686 invoke \\\""driver.clj\\\"" 910]\\n  [clojure.lang.MultiFn invoke \\\""MultiFn.java\\\"" 239]\\n  [metabase.sync.util$sync_in_context$fn__3612917 invoke \\\""util.clj\\\"" 167]\\n  [metabase.sync.util$with_db_logging_disabled$fn__3612914 invoke \\\""util.clj\\\"" 159]\\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \\\""util.clj\\\"" 132]\\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \\\""util.clj\\\"" 126]\\n  [metabase.sync.util$with_start_and_finish_logging$fn__3612897 invoke \\\""util.clj\\\"" 144]\\n  [metabase.sync.util$fn__3612884$with_sync_events3612883__3612885$fn__3612889 invoke \\\""util.clj\\\"" 118]\\n  [metabase.sync.util$with_duplicate_ops_prevented$fn__3612871 invoke \\\""util.clj\\\"" 90]\\n  [metabase.sync.util$fn__3612939$do_sync_operation3612938__3612940 invoke \\\""util.clj\\\"" 216]\\n  [metabase.sync.util$fn__3612939$fn__3612942 invoke \\\""util.clj\\\"" 210]\\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455 invoke \\\""sync_metadata.clj\\\"" 68]\\n  [metabase.sync.sync_metadata$fn__141454$fn__141459 inv
oke \\\""sync_metadata.clj\\\"" 65]\\n  [metabase.task.sync_databases$eval3613486 invokeStatic \\\""NO_SOURCE_FILE\\\"" 636]\\n  [metabase.task.sync_databases$eval3613486 invoke \\\""NO_SOURCE_FILE\\\"" 635]\\n  [clojure.lang.Compiler eval \\\""Compiler.java\\\"" 7700]\\n  [clojure.lang.Compiler eval \\\""Compiler.java\\\"" 7655]\\n  [clojure.core$eval invokeStatic \\\""core.clj\\\"" 3232]\\n  [clojure.core$eval invoke \\\""core.clj\\\"" 3228]\\n  [user$eval3444021$fn__3444024 invoke \\\""NO_SOURCE_FILE\\\"" 8]\\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \\\""main.clj\\\"" 437]\\n  [clojure.main$repl$read_eval_print__9244 invoke \\\""main.clj\\\"" 437]\\n  [clojure.main$repl$fn__9253 invoke \\\""main.clj\\\"" 459]\\n  [clojure.main$repl invokeStatic \\\""main.clj\\\"" 459]\\n  [clojure.main$repl doInvoke \\\""main.clj\\\"" 368]\\n  [clojure.lang.RestFn invoke \\\""RestFn.java\\\"" 622]\\n  [user$eval3444021 invokeStatic \\\""NO_SOURCE_FILE\\\"" 6]\\n  [user$eval3444021 invoke \\\""NO_SOURCE_FILE\\\"" 6]\\n  [clojure.lang.Compiler eval \\\""Compiler.java\\\"" 7700]\\n  [clojure.lang.Compiler eval \\\""Compiler.java\\\"" 7655]\\n  [clojure.core$eval invokeStatic \\\""core.clj\\\"" 3232]\\n  [clojure.core$eval invoke \\\""core.clj\\\"" 3228]\\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \\\""main.clj\\\"" 437]\\n  [clojure.main$repl$read_eval_print__9244 invoke \\\""main.clj\\\"" 437]\\n  [clojure.main$repl$fn__9253 invoke \\\""main.clj\\\"" 459]\\n  [clojure.main$repl invokeStatic \\\""main.clj\\\"" 459]\\n  [clojure.core.server$repl invokeStatic \\\""server.clj\\\"" 183]\\n  [clojure.core.server$repl invoke \\\""server.clj\\\"" 183]\\n  [clojure.lang.AFn applyToHelper \\\""AFn.java\\\"" 152]\\n  [clojure.lang.AFn applyTo \\\""AFn.java\\\"" 144]\\n  [clojure.lang.Var applyTo \\\""Var.java\\\"" 707]\\n  [clojure.core$apply invokeStatic \\\""core.clj\\\"" 667]\\n  [clojure.core.server$accept_connection invokeStatic \\\""server.clj\\\"" 74]\\n  [clojure.core.server$start_server$fn__9040$fn__9041$fn__9043 invoke \\\""server.clj\\\"" 118]\\n  [clojure.lang.AFn run \\\""AFn.java\\\"" 22]\\n  [java.lang.Thread run \\\""Thread.java\\\"" 1583]]}\""], :schema [:map [:updated-fields [:int {:min 0, :description #metabase.util.i18n.UserLocalizedString{:format-string \""value must be an integer greater than zero.\"", :args [], :pluralization-opts {}}, :error/fn #object[clojure.core$constantly$fn__5759 0x1a42a52d \""clojure.core$constantly$fn__5759@1a42a52d\""]}]] [:total-fields [:int {:min 0, :description #metabase.util.i18n.UserLocalizedString{:format-string \""value must be an integer greater than zero.\"", :args [], :pluralization-opts {}}, :error/fn #object[clojure.core$constantly$fn__5759 0x1a42a52d \""clojure.core$constantly$fn__5759@1a42a52d\""]}]]], :value #error {\n :cause \""\""\n :via\n [{:type java.sql.SQLException\n   :message \""Connections could not be qcquired from the underlying database!\""}\n  {:type com.mchange.v2.resourcepool.CannotAcquireResourceException\n   :message \""\""\n   :at [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \""fields.clj\"" 76]}]\n :trace\n [[metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460$fn__3613461 invoke \""fields.clj\"" 76]\n  [metabase.sync.util$do_with_error_handling invokeStatic \""util.clj\"" 191]\n  [metabase.sync.util$do_with_error_handling invoke \""util.clj\"" 184]\n  [metabase.sync.sync_metadata.fields$fn__3613459$sync_fields_BANG_3613458__3613460 invoke \""fields.clj\"" 76]\n  [metabase.sync.sync_metadata.fields$fn__3613459$fn__3613474 invoke \""fields.clj\"" 71]\n  [clojure.lang.AFn applyToHelper \""AFn.java\"" 154]\n  [clojure.lang.AFn applyTo \""AFn.java\"" 144]\n  [clojure.core$apply invokeStatic \""core.clj\"" 669]\n  [clojure.core$apply invoke \""core.clj\"" 662]\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047$fn__3613050 invoke \""util.clj\"" 495]\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \""task_history.clj\"" 122]\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \""task_
history.clj\"" 110]\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045$fn__3613047 doInvoke \""util.clj\"" 488]\n  [clojure.lang.RestFn invoke \""RestFn.java\"" 400]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \""util.clj\"" 132]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \""util.clj\"" 126]\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invokeStatic \""util.clj\"" 150]\n  [metabase.sync.util$do_with_start_and_finish_debug_logging invoke \""util.clj\"" 146]\n  [metabase.sync.util$fn__3613043$run_step_with_metadata3613042__3613045 invoke \""util.clj\"" 482]\n  [metabase.sync.util$fn__3613043$fn__3613058 invoke \""util.clj\"" 477]\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111$fn__3613119 invoke \""util.clj\"" 577]\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110$fn__3613111 invoke \""util.clj\"" 575]\n  [metabase.models.task_history$fn__93966$do_with_task_history93965__93967 invoke \""task_history.clj\"" 122]\n  [metabase.models.task_history$fn__93966$fn__93975 invoke \""task_history.clj\"" 110]\n  [metabase.sync.util$fn__3613109$run_sync_operation3613108__3613110 invoke \""util.clj\"" 572]\n  [metabase.sync.util$fn__3613109$fn__3613129 invoke \""util.clj\"" 567]\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455$fn__141456 invoke \""sync_metadata.clj\"" 70]\n  [metabase.sync.util$do_with_error_handling invokeStatic \""util.clj\"" 191]\n  [metabase.sync.util$do_with_error_handling invoke \""util.clj\"" 184]\n  [clojure.core$partial$fn__5929 invoke \""core.clj\"" 2647]\n  [metabase.driver$eval89685$fn__89686 invoke \""driver.clj\"" 910]\n  [clojure.lang.MultiFn invoke \""MultiFn.java\"" 239]\n  [metabase.sync.util$sync_in_context$fn__3612917 invoke \""util.clj\"" 167]\n  [metabase.sync.util$with_db_logging_disabled$fn__3612914 invoke \""util.clj\"" 159]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invokeStatic \""util.clj\"" 132]\n  [metabase.sync.util$with_start_and_finish_logging_STAR_ invoke \""util.clj\"" 126]\n  [metabase.sync.util$with_start_and_finish_logging$fn__3612897 invoke \""util.clj\"" 144]\n  [metabase.sync.util$fn__3612884$with_sync_events3612883__3612885$fn__3612889 invoke \""util.clj\"" 118]\n  [metabase.sync.util$with_duplicate_ops_prevented$fn__3612871 invoke \""util.clj\"" 90]\n  [metabase.sync.util$fn__3612939$do_sync_operation3612938__3612940 invoke \""util.clj\"" 216]\n  [metabase.sync.util$fn__3612939$fn__3612942 invoke \""util.clj\"" 210]\n  [metabase.sync.sync_metadata$fn__141454$sync_db_metadata_BANG_141453__141455 invoke \""sync_metadata.clj\"" 68]\n  [metabase.sync.sync_metadata$fn__141454$fn__141459 invoke \""sync_metadata.clj\"" 65]\n  [metabase.task.sync_databases$eval3613486 invokeStatic \""NO_SOURCE_FILE\"" 636]\n  [metabase.task.sync_databases$eval3613486 invoke \""NO_SOURCE_FILE\"" 635]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7700]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7655]\n  [clojure.core$eval invokeStatic \""core.clj\"" 3232]\n  [clojure.core$eval invoke \""core.clj\"" 3228]\n  [user$eval3444021$fn__3444024 invoke \""NO_SOURCE_FILE\"" 8]\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \""main.clj\"" 437]\n  [clojure.main$repl$read_eval_print__9244 invoke \""main.clj\"" 437]\n  [clojure.main$repl$fn__9253 invoke \""main.clj\"" 459]\n  [clojure.main$repl invokeStatic \""main.clj\"" 459]\n  [clojure.main$repl doInvoke \""main.clj\"" 368]\n  [clojure.lang.RestFn invoke \""RestFn.java\"" 622]\n  [user$eval3444021 invokeStatic \""NO_SOURCE_FILE\"" 6]\n  [user$eval3444021 invoke \""NO_SOURCE_FILE\"" 6]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7700]\n  [clojure.lang.Compiler eval \""Compiler.java\"" 7655]\n  [clojure.core$eval invokeStatic \""core.clj\"" 3232]\n  [clojure.core$eval invoke \""core.clj\"" 3228]\n  [clojure.main$repl$read_eval_print__9244$fn__9247 invoke \""main.clj\"" 437]\n  [clojure.main$repl$read_eval_print__9244 invoke \""main.clj\"" 437]\n  [clojure.main$repl$fn__9253 invoke \""main.clj\"" 459]\n  [clojure.main$repl invokeStatic \""main.clj\"" 459]
\n  [clojure.core.server$repl invokeStatic \""server.clj\"" 183]\n  [clojure.core.server$repl invoke \""server.clj\"" 183]\n  [clojure.lang.AFn applyToHelper \""AFn.java\"" 152]\n  [clojure.lang.AFn applyTo \""AFn.java\"" 144]\n  [clojure.lang.Var applyTo \""Var.java\"" 707]\n  [clojure.core$apply invokeStatic \""core.clj\"" 667]\n  [clojure.core.server$accept_connection invokeStatic \""server.clj\"" 74]\n  [clojure.core.server$start_server$fn__9040$fn__9041$fn__9043 invoke \""server.clj\"" 118]\n  [clojure.lang.AFn run \""AFn.java\"" 22]\n  [java.lang.Thread run \""Thread.java\"" 1583]]}, :fn-name sync-fields!}""]}]
         [""sync-fks"" {:total-fks 6, :updated-fks 0, :total-failed 0}]
         [""sync-indexes""
          {:total-indexes 0, :added-indexes 0, :removed-indexes 0}]
         [""sync-metabase-metadata"" {}]
         [""sync-table-privileges"" {}]]}
```

And this error is an error from _malli_ which we do not consider as interruptible, and we carry on.

- Another way to fix this is to do the connection checking that is done for the syncing of the database at https://github.com/metabase/metabase/blob/master/src/metabase/task/sync_databases.clj#L78-L85 where we only try to sync if we can connect. This is smart, but seems to be a bandaid over the above which should work better.

### Logs

_No response_

### Information about your Metabase installation

```JSON
master
```

### Severity

p

### Additional context

_No response_",dpsutton,2024-12-27 17:29:59+00:00,[],2025-02-04 20:24:40+00:00,,https://github.com/metabase/metabase/issues/51683,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Metadata & Sync', ''), ('.Backend', ''), ('.Team/Querying', '')]",[],
2760506732,issue,closed,completed,Fix wrong SDK banner doc link + make doc links more granular,"### Describe the bug

We've moved our SDK docs to the Metabase website not long ago, but the Metabase SDK banner doc still [links to the old doc on Github](https://github.com/metabase/metabase/blob/393308bc5ca608c377b1783d27ea688a9161ff1c/enterprise/frontend/src/embedding-sdk/lib/usage-problem.ts#L28C4-L28C138).

We want to link it to the new doc instead, and at the same time provide better doc links for each problem users might encounter to ensure they get the relevant helps they need the most.

This is the summary of the new links we want to introduce.
- API_KEYS_WITHOUT_LICENSE -> /upgrade
- API_KEYS_WITH_LICENSE -> https://www.metabase.com/docs/latest/embedding/sdk/authentication#authenticating-- people-from-your-server
- SSO_WITHOUT_LICENSE -> /upgrade
- CONFLICTING_AUTH_METHODS -> https://www.metabase.com/docs/latest/embedding/sdk/authentication#authenticating-people-from-your-server
- JWT_PROVIDER_URI_DEPRECATED -> https://www.metabase.com/docs/latest/embedding/sdk/authentication#authenticating-people-from-your-server
- NO_AUTH_METHOD_PROVIDED -> https://www.metabase.com/docs/latest/embedding/sdk/authentication#authenticating-people-from-your-server
- EMBEDDING_SDK_NOT_ENABLED -> https://www.metabase.com/docs/latest/embedding/sdk/introduction#in-metabase

### To Reproduce

Use Metabase SDK for React, and click the link in the SDK banner, it should still lead to the old doc on GitHub.

### Expected behavior

Each problem mentioned above should lead users to the desired doc URL on Metabase website.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2""
    ],
    ""run-mode"": ""dev"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-12-25"",
      ""src_hash"": ""8203ff69e414c35581af716207f92c50ab6fc628"",
      ""tag"": ""v1.52.5-SNAPSHOT"",
      ""hash"": ""5d15d8f""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.2+13-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.2"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.2+13-LTS"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""15.2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```

### Severity

p2, but could leave bad impression for Metabase SDK users

### Additional context

_No response_",WiNloSt,2024-12-27 07:15:31+00:00,['heypoom'],2025-01-20 15:21:57+00:00,2025-01-20 14:53:10+00:00,https://github.com/metabase/metabase/issues/51680,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', ''), ('good first issue', 'A starter issue that is good for someone new to the codebase or is a new contributor'), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2579233249, 'issue_id': 2760506732, 'author': 'kartik-raj7', 'body': 'Hey Could you please assign me this issue', 'created_at': datetime.datetime(2025, 1, 9, 5, 52, 15, tzinfo=datetime.timezone.utc)}]","kartik-raj7 on (2025-01-09 05:52:15 UTC): Hey Could you please assign me this issue

"
2760494012,issue,open,,Can't change variables after selecting Field Filter,"### Describe the bug

I was creating a new native question, and had a couple of variables I had created for another question pasted into this new one, but when selecting the right type for each of the variables, I accidentally selected the Field Filter and after selecting I wasn't able to change it into a different type it was stuck, I had to refresh the page and start the process again.

### To Reproduce

1. Go to a new native question, add a couple of variables.
2. Click on variables on the right hand section, and select the types for each of the variables.
3. If Field filter is selected, I'm unable to change back into the right filter needed for the variable
4. Refreshing the page is needed, to start again the process selecting the right one


### Expected behavior

You should be able to select the right filter for the variables, even after selecting Field Filter as the type, and change back and forth.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""sqlserver""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-21"",
      ""tag"": ""v0.52.4"",
      ""hash"": ""2f8c560""
    },
    ""settings"": {
      ""report-timezone"": ""America/Costa_Rica""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.30""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""Cp1252"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""17.0.8.1+1"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""17.0.8.1"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""17.0.8.1+1"",
    ""os.name"": ""Windows Server 2016"",
    ""os.version"": ""10.0"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Guatemala""
  }
}
```

### Severity

Low / Annoying

### Additional context

_No response_",jloria13,2024-12-27 07:01:40+00:00,[],2025-02-04 20:28:33+00:00,,https://github.com/metabase/metabase/issues/51679,"[('Priority:P2', 'Average run of the mill bug'), ('Querying/Native', 'The SQL/native query editor'), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2569386959, 'issue_id': 2760494012, 'author': 'ranquild', 'body': 'The workaround is to select a required field first before changing the type of the variable.', 'created_at': datetime.datetime(2025, 1, 3, 15, 18, 55, tzinfo=datetime.timezone.utc)}, {'comment_id': 2571438341, 'issue_id': 2760494012, 'author': 'jloria13', 'body': 'Understood, will give a it a try, yet is a workaround not the expected behavior right ?', 'created_at': datetime.datetime(2025, 1, 4, 23, 26, 20, tzinfo=datetime.timezone.utc)}]","ranquild on (2025-01-03 15:18:55 UTC): The workaround is to select a required field first before changing the type of the variable.

jloria13 (Issue Creator) on (2025-01-04 23:26:20 UTC): Understood, will give a it a try, yet is a workaround not the expected behavior right ?

"
2760403871,issue,open,,Saving SMTP STARTTLS settings without credentials not working,"### Describe the bug

Hello.

Our company has a local mail server that accepts STARTTLS and plaintext connections without authentication.

When trying to configure SMTP STARTTLS in Metabase without specifying a login/password, the error ""Invalid username or password"" appears in the browser. The same parameters with ""SMTP Security: None"" do not cause an error.

However, if you enter the same STARTTLS parameters directly into the database and restart the application, sending mail will work:

```
UPDATE setting SET value = 'mail.localdomain.tld' WHERE key = 'email-smtp-host';
UPDATE setting SET value = 587 WHERE key = 'email-smtp-port';
UPDATE setting SET value = 'starttls' WHERE key = 'email-smtp-security';
UPDATE setting SET value = '' WHERE key = 'email-smtp-username';
UPDATE setting SET value = '' WHERE key = 'email-smtp-password';
```


### To Reproduce

1. Go to ""Metabase Admin > Settings > Email > Edit Configuration"".
2. Fill settings with STARTTLS, without login/password.
3. Click ""Save changes"".
4. See error.


### Expected behavior

_No response_

### Logs

2024-12-26 09:12:17,796 ERROR metabase.email :: Error testing SMTP connection\njavax.mail.AuthenticationFailedException: ;\n  nested exception is:\n\tjavax.mail.MessagingException: Exception reading response;\n  nested exception is:\n\tjava.net.SocketTimeoutException: Read timed out\n\tat com.sun.mail.smtp.SMTPTransport$Authenticator.authenticate(SMTPTransport.java:942)\n\tat com.sun.mail.smtp.SMTPTransport.authenticate(SMTPTransport.java:858)\n\tat com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:762)\n\tat javax.mail.Service.connect(Service.java:342)\n\tat metabase.email$test_smtp_settings$fn__75838.invoke(email.clj:235)\n\tat metabase.email$test_smtp_settings.invokeStatic(email.clj:234)\n\tat metabase.email$test_smtp_settings.invoke(email.clj:220)\n\tat metabase.email$test_smtp_connection.invokeStatic(email.clj:280)\n\tat metabase.email$test_smtp_connection.invoke(email.clj:266)\n\tat metabase.api.email$fn__87131.invokeStatic(email.clj:112)\n\tat metabase.api.email$fn__87131.invoke(email.clj:92)\n\tat compojure.core$wrap_response$fn__44682.invoke(core.clj:160)\n\tat compojure.core$wrap_route_middleware$fn__44666.invoke(core.clj:132)\n\tat compojure.core$wrap_route_info$fn__44671.invoke(core.clj:139)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:151)\n\tat clojure.lang.Var.invoke(Var.java:393)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat clojure.lang.Var.invoke(Var.java:393)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat metabase.server.middleware.auth$enforce_authentication$fn__94085.invoke(auth.clj:17)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat compojure.core$make_context$handler__44722.invoke(core.clj:290)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:300)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat metabase.api.routes$fn__102118$fn__102121.invoke(routes.clj:67)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat clojure.lang.AFn.applyToHelper(AFn.java:160)\n\tat clojure.lang.AFn.applyTo(AFn.java:144)\n\tat clojure.core$apply.invokeStatic(core.clj:667)\n\tat clojure.core$apply.invoke(core.clj:662)\n\tat metabase.server.routes$fn__102283$fn__102284.doInvoke(routes.clj:72)\n\tat clojure.lang.RestFn.invoke(RestFn.java:436)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat compojure.core$make_context$handler__44722.invoke(core.clj:290)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:300)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat metabase.server.routes$fn__102268$fn__102270.invoke(routes.clj:49)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__98829.invoke(exceptions.clj:108)\n\tat metabase.server.middleware.exceptions$catch_api_exceptions$fn__98826.invoke(exceptions.clj:96)\n\tat metabase.server.middleware.log$log_api_call$fn__102560$fn__102561$fn__102562.invoke(log.clj:230)\n\tat metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info.invokeStatic(diagnostic.clj:18)\n\tat metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info.invoke(diagnostic.clj:12)\n\tat metabase.server.middleware.log$log_api_call$fn__102560$fn__102561.invoke(log.clj:222)\n\tat toucan2.execute$do_with_call_counts.invokeStatic(execute.clj:112)\n\tat toucan2.execute$do_with_call_counts.invoke(execute.clj:103)\n\tat metabase.server.middleware.log$log_api_call$fn__102560.invoke(log.clj:221)\n\tat metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__104625.invoke(browser_cookie.clj:40)\n\tat metabase.server.middleware.security$add_security_headers$fn__98785.invoke(security.clj:182)\n\tat metabase.server.middleware.json$wrap_json_body$fn__46039.invoke(json.clj:67)\n\tat metabase.server.middleware.offset_paging$handle_paging$fn__84983.invoke(offset_paging.clj:43)\n\tat metabase.server.middleware.json$wrap_streamed_json_response$fn__46057.invoke(json.clj:103)\n\tat ring.middleware.keyword_params$wrap_keyword_params$fn__104892.invoke(keyword_params.clj:55)\n\tat ring.middleware.params$wrap_params$fn__104911.invoke(params.clj:77)\n\tat metabase.server.middleware.misc$maybe_set_site_url$fn__67273.invoke(misc.clj:61)\n\tat metabase.server.middleware.session$reset_session_timeout$fn__72704.invoke(session.clj:546)\n\tat metabase.server.middleware.session$bind_current_user$fn__72670$fn__72671.invoke(session.clj:440)\n\tat metabase.server.middleware.session$do_with_current_user.invokeStatic(session.clj:419)\n\tat metabase.server.middleware.session$do_with_current_user.invoke(session.clj:403)\n\tat metabase.server.middleware.session$bind_current_user$fn__72670.invoke(session.clj:439)\n\tat metabase.server.middleware.session$wrap_current_user_info$fn__72653.invoke(session.clj:378)\n\tat metabase.server.middleware.session$wrap_session_id$fn__72625.invoke(session.clj:257)\n\tat metabase.server.middleware.auth$wrap_static_api_key$fn__94093.invoke(auth.clj:30)\n\tat ring.middleware.cookies$wrap_cookies$fn__104812.invoke(cookies.clj:194)\n\tat metabase.server.middleware.misc$add_content_type$fn__67255.invoke(misc.clj:29)\n\tat metabase.server.middleware.misc$disable_streaming_buffering$fn__67281.invoke(misc.clj:78)\n\tat ring.middleware.gzip$wrap_gzip$fn__104854.invoke(gzip.clj:86)\n\tat metabase.server.middleware.misc$bind_request$fn__67284.invoke(misc.clj:95)\n\tat metabase.server.middleware.ssl$redirect_to_https_middleware$fn__104641.invoke(ssl.clj:51)\n\tat metabase.server$async_proxy_handler$fn__67695.invoke(server.clj:78)\n\tat metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a.handle(Unknown Source)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:173)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:122)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:563)\n\tat org.eclipse.jetty.server.HttpChannel$RequestDispatchable.dispatch(HttpChannel.java:1598)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:753)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:501)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:287)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:314)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:100)\n\tat org.eclipse.jetty.io.SelectableChannelEndPoint$1.run(SelectableChannelEndPoint.java:53)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.runTask(AdaptiveExecutionStrategy.java:421)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.consumeTask(AdaptiveExecutionStrategy.java:390)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.tryProduce(AdaptiveExecutionStrategy.java:277)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.run(AdaptiveExecutionStrategy.java:199)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:411)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:969)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.doRunJob(QueuedThreadPool.java:1194)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1149)\n\tat java.base/java.lang.Thread.run(Unknown Source)\nCaused by: javax.mail.MessagingException: Exception reading response;\n  nested exception is:\n\tjava.net.SocketTimeoutException: Read timed out\n\tat com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2476)\n\tat com.sun.mail.smtp.SMTPTransport.simpleCommand(SMTPTransport.java:2406)\n\tat com.sun.mail.smtp.SMTPTransport$LoginAuthenticator.doAuth(SMTPTransport.java:983)\n\tat com.sun.mail.smtp.SMTPTransport$Authenticator.authenticate(SMTPTransport.java:924)\n\t... 137 more\nCaused by: java.net.SocketTimeoutException: Read timed out\n\tat java.base/java.net.SocketInputStream.socketRead0(Native Method)\n\tat java.base/java.net.SocketInputStream.socketRead(Unknown Source)\n\tat java.base/java.net.SocketInputStream.read(Unknown Source)\n\tat java.base/java.net.SocketInputStream.read(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketInputRecord.read(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketInputRecord.readHeader(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketInputRecord.bytesInCompletePacket(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketImpl.readApplicationRecord(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketImpl$AppInputStream.read(Unknown Source)\n\tat com.sun.mail.util.TraceInputStream.read(TraceInputStream.java:102)\n\tat java.base/java.io.BufferedInputStream.fill(Unknown Source)\n\tat java.base/java.io.BufferedInputStream.read(Unknown Source)\n\tat com.sun.mail.util.LineInputStream.readLine(LineInputStream.java:100)\n\tat com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2456)\n\t... 140 more
2024-12-26 09:12:21,872 ERROR metabase.email :: Error testing SMTP connection\njavax.mail.AuthenticationFailedException: ;\n  nested exception is:\n\tjavax.mail.MessagingException: Exception reading response;\n  nested exception is:\n\tjava.net.SocketTimeoutException: Read timed out\n\tat com.sun.mail.smtp.SMTPTransport$Authenticator.authenticate(SMTPTransport.java:942)\n\tat com.sun.mail.smtp.SMTPTransport.authenticate(SMTPTransport.java:858)\n\tat com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:762)\n\tat javax.mail.Service.connect(Service.java:342)\n\tat metabase.email$test_smtp_settings$fn__75838.invoke(email.clj:235)\n\tat metabase.email$test_smtp_settings.invokeStatic(email.clj:234)\n\tat metabase.email$test_smtp_settings.invoke(email.clj:220)\n\tat metabase.email$guess_smtp_security$fn__75843.invoke(email.clj:259)\n\tat clojure.core$some.invokeStatic(core.clj:2718)\n\tat clojure.core$some.invoke(core.clj:2709)\n\tat metabase.email$guess_smtp_security.invokeStatic(email.clj:257)\n\tat metabase.email$guess_smtp_security.invoke(email.clj:248)\n\tat metabase.email$test_smtp_connection.invokeStatic(email.clj:283)\n\tat metabase.email$test_smtp_connection.invoke(email.clj:266)\n\tat metabase.api.email$fn__87131.invokeStatic(email.clj:112)\n\tat metabase.api.email$fn__87131.invoke(email.clj:92)\n\tat compojure.core$wrap_response$fn__44682.invoke(core.clj:160)\n\tat compojure.core$wrap_route_middleware$fn__44666.invoke(core.clj:132)\n\tat compojure.core$wrap_route_info$fn__44671.invoke(core.clj:139)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:151)\n\tat clojure.lang.Var.invoke(Var.java:393)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat clojure.lang.Var.invoke(Var.java:393)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat metabase.server.middleware.auth$enforce_authentication$fn__94085.invoke(auth.clj:17)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat compojure.core$make_context$handler__44722.invoke(core.clj:290)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:300)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat metabase.api.routes$fn__102118$fn__102121.invoke(routes.clj:67)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat clojure.lang.AFn.applyToHelper(AFn.java:160)\n\tat clojure.lang.AFn.applyTo(AFn.java:144)\n\tat clojure.core$apply.invokeStatic(core.clj:667)\n\tat clojure.core$apply.invoke(core.clj:662)\n\tat metabase.server.routes$fn__102283$fn__102284.doInvoke(routes.clj:72)\n\tat clojure.lang.RestFn.invoke(RestFn.java:436)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat compojure.core$make_context$handler__44722.invoke(core.clj:290)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:300)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat metabase.server.routes$fn__102268$fn__102270.invoke(routes.clj:49)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__98829.invoke(exceptions.clj:108)\n\tat metabase.server.middleware.exceptions$catch_api_exceptions$fn__98826.invoke(exceptions.clj:96)\n\tat metabase.server.middleware.log$log_api_call$fn__102560$fn__102561$fn__102562.invoke(log.clj:230)\n\tat metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info.invokeStatic(diagnostic.clj:18)\n\tat metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info.invoke(diagnostic.clj:12)\n\tat metabase.server.middleware.log$log_api_call$fn__102560$fn__102561.invoke(log.clj:222)\n\tat toucan2.execute$do_with_call_counts.invokeStatic(execute.clj:112)\n\tat toucan2.execute$do_with_call_counts.invoke(execute.clj:103)\n\tat metabase.server.middleware.log$log_api_call$fn__102560.invoke(log.clj:221)\n\tat metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__104625.invoke(browser_cookie.clj:40)\n\tat metabase.server.middleware.security$add_security_headers$fn__98785.invoke(security.clj:182)\n\tat metabase.server.middleware.json$wrap_json_body$fn__46039.invoke(json.clj:67)\n\tat metabase.server.middleware.offset_paging$handle_paging$fn__84983.invoke(offset_paging.clj:43)\n\tat metabase.server.middleware.json$wrap_streamed_json_response$fn__46057.invoke(json.clj:103)\n\tat ring.middleware.keyword_params$wrap_keyword_params$fn__104892.invoke(keyword_params.clj:55)\n\tat ring.middleware.params$wrap_params$fn__104911.invoke(params.clj:77)\n\tat metabase.server.middleware.misc$maybe_set_site_url$fn__67273.invoke(misc.clj:61)\n\tat metabase.server.middleware.session$reset_session_timeout$fn__72704.invoke(session.clj:546)\n\tat metabase.server.middleware.session$bind_current_user$fn__72670$fn__72671.invoke(session.clj:440)\n\tat metabase.server.middleware.session$do_with_current_user.invokeStatic(session.clj:419)\n\tat metabase.server.middleware.session$do_with_current_user.invoke(session.clj:403)\n\tat metabase.server.middleware.session$bind_current_user$fn__72670.invoke(session.clj:439)\n\tat metabase.server.middleware.session$wrap_current_user_info$fn__72653.invoke(session.clj:378)\n\tat metabase.server.middleware.session$wrap_session_id$fn__72625.invoke(session.clj:257)\n\tat metabase.server.middleware.auth$wrap_static_api_key$fn__94093.invoke(auth.clj:30)\n\tat ring.middleware.cookies$wrap_cookies$fn__104812.invoke(cookies.clj:194)\n\tat metabase.server.middleware.misc$add_content_type$fn__67255.invoke(misc.clj:29)\n\tat metabase.server.middleware.misc$disable_streaming_buffering$fn__67281.invoke(misc.clj:78)\n\tat ring.middleware.gzip$wrap_gzip$fn__104854.invoke(gzip.clj:86)\n\tat metabase.server.middleware.misc$bind_request$fn__67284.invoke(misc.clj:95)\n\tat metabase.server.middleware.ssl$redirect_to_https_middleware$fn__104641.invoke(ssl.clj:51)\n\tat metabase.server$async_proxy_handler$fn__67695.invoke(server.clj:78)\n\tat metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a.handle(Unknown Source)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:173)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:122)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:563)\n\tat org.eclipse.jetty.server.HttpChannel$RequestDispatchable.dispatch(HttpChannel.java:1598)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:753)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:501)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:287)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:314)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:100)\n\tat org.eclipse.jetty.io.SelectableChannelEndPoint$1.run(SelectableChannelEndPoint.java:53)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.runTask(AdaptiveExecutionStrategy.java:421)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.consumeTask(AdaptiveExecutionStrategy.java:390)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.tryProduce(AdaptiveExecutionStrategy.java:277)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.run(AdaptiveExecutionStrategy.java:199)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:411)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:969)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.doRunJob(QueuedThreadPool.java:1194)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1149)\n\tat java.base/java.lang.Thread.run(Unknown Source)\nCaused by: javax.mail.MessagingException: Exception reading response;\n  nested exception is:\n\tjava.net.SocketTimeoutException: Read timed out\n\tat com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2476)\n\tat com.sun.mail.smtp.SMTPTransport.simpleCommand(SMTPTransport.java:2406)\n\tat com.sun.mail.smtp.SMTPTransport$LoginAuthenticator.doAuth(SMTPTransport.java:983)\n\tat com.sun.mail.smtp.SMTPTransport$Authenticator.authenticate(SMTPTransport.java:924)\n\t... 142 more\nCaused by: java.net.SocketTimeoutException: Read timed out\n\tat java.base/java.net.SocketInputStream.socketRead0(Native Method)\n\tat java.base/java.net.SocketInputStream.socketRead(Unknown Source)\n\tat java.base/java.net.SocketInputStream.read(Unknown Source)\n\tat java.base/java.net.SocketInputStream.read(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketInputRecord.read(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketInputRecord.readHeader(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketInputRecord.bytesInCompletePacket(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketImpl.readApplicationRecord(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketImpl$AppInputStream.read(Unknown Source)\n\tat com.sun.mail.util.TraceInputStream.read(TraceInputStream.java:102)\n\tat java.base/java.io.BufferedInputStream.fill(Unknown Source)\n\tat java.base/java.io.BufferedInputStream.read(Unknown Source)\n\tat com.sun.mail.util.LineInputStream.readLine(LineInputStream.java:100)\n\tat com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2456)\n\t... 145 more
2024-12-26 09:12:26,382 ERROR metabase.email :: Error testing SMTP connection\njavax.mail.MessagingException: Exception reading response;\n  nested exception is:\n\tjava.net.SocketTimeoutException: Read timed out\n\tat com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2476)\n\tat com.sun.mail.smtp.SMTPTransport.openServer(SMTPTransport.java:2172)\n\tat com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:722)\n\tat javax.mail.Service.connect(Service.java:342)\n\tat metabase.email$test_smtp_settings$fn__75838.invoke(email.clj:235)\n\tat metabase.email$test_smtp_settings.invokeStatic(email.clj:234)\n\tat metabase.email$test_smtp_settings.invoke(email.clj:220)\n\tat metabase.email$guess_smtp_security$fn__75843.invoke(email.clj:259)\n\tat clojure.core$some.invokeStatic(core.clj:2718)\n\tat clojure.core$some.invoke(core.clj:2709)\n\tat metabase.email$guess_smtp_security.invokeStatic(email.clj:257)\n\tat metabase.email$guess_smtp_security.invoke(email.clj:248)\n\tat metabase.email$test_smtp_connection.invokeStatic(email.clj:283)\n\tat metabase.email$test_smtp_connection.invoke(email.clj:266)\n\tat metabase.api.email$fn__87131.invokeStatic(email.clj:112)\n\tat metabase.api.email$fn__87131.invoke(email.clj:92)\n\tat compojure.core$wrap_response$fn__44682.invoke(core.clj:160)\n\tat compojure.core$wrap_route_middleware$fn__44666.invoke(core.clj:132)\n\tat compojure.core$wrap_route_info$fn__44671.invoke(core.clj:139)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:151)\n\tat clojure.lang.Var.invoke(Var.java:393)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat clojure.lang.Var.invoke(Var.java:393)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat metabase.server.middleware.auth$enforce_authentication$fn__94085.invoke(auth.clj:17)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat compojure.core$make_context$handler__44722.invoke(core.clj:290)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:300)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat metabase.api.routes$fn__102118$fn__102121.invoke(routes.clj:67)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat clojure.lang.AFn.applyToHelper(AFn.java:160)\n\tat clojure.lang.AFn.applyTo(AFn.java:144)\n\tat clojure.core$apply.invokeStatic(core.clj:667)\n\tat clojure.core$apply.invoke(core.clj:662)\n\tat metabase.server.routes$fn__102283$fn__102284.doInvoke(routes.clj:72)\n\tat clojure.lang.RestFn.invoke(RestFn.java:436)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat compojure.core$make_context$handler__44722.invoke(core.clj:290)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:300)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat metabase.server.routes$fn__102268$fn__102270.invoke(routes.clj:49)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__98829.invoke(exceptions.clj:108)\n\tat metabase.server.middleware.exceptions$catch_api_exceptions$fn__98826.invoke(exceptions.clj:96)\n\tat metabase.server.middleware.log$log_api_call$fn__102560$fn__102561$fn__102562.invoke(log.clj:230)\n\tat metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info.invokeStatic(diagnostic.clj:18)\n\tat metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info.invoke(diagnostic.clj:12)\n\tat metabase.server.middleware.log$log_api_call$fn__102560$fn__102561.invoke(log.clj:222)\n\tat toucan2.execute$do_with_call_counts.invokeStatic(execute.clj:112)\n\tat toucan2.execute$do_with_call_counts.invoke(execute.clj:103)\n\tat metabase.server.middleware.log$log_api_call$fn__102560.invoke(log.clj:221)\n\tat metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__104625.invoke(browser_cookie.clj:40)\n\tat metabase.server.middleware.security$add_security_headers$fn__98785.invoke(security.clj:182)\n\tat metabase.server.middleware.json$wrap_json_body$fn__46039.invoke(json.clj:67)\n\tat metabase.server.middleware.offset_paging$handle_paging$fn__84983.invoke(offset_paging.clj:43)\n\tat metabase.server.middleware.json$wrap_streamed_json_response$fn__46057.invoke(json.clj:103)\n\tat ring.middleware.keyword_params$wrap_keyword_params$fn__104892.invoke(keyword_params.clj:55)\n\tat ring.middleware.params$wrap_params$fn__104911.invoke(params.clj:77)\n\tat metabase.server.middleware.misc$maybe_set_site_url$fn__67273.invoke(misc.clj:61)\n\tat metabase.server.middleware.session$reset_session_timeout$fn__72704.invoke(session.clj:546)\n\tat metabase.server.middleware.session$bind_current_user$fn__72670$fn__72671.invoke(session.clj:440)\n\tat metabase.server.middleware.session$do_with_current_user.invokeStatic(session.clj:419)\n\tat metabase.server.middleware.session$do_with_current_user.invoke(session.clj:403)\n\tat metabase.server.middleware.session$bind_current_user$fn__72670.invoke(session.clj:439)\n\tat metabase.server.middleware.session$wrap_current_user_info$fn__72653.invoke(session.clj:378)\n\tat metabase.server.middleware.session$wrap_session_id$fn__72625.invoke(session.clj:257)\n\tat metabase.server.middleware.auth$wrap_static_api_key$fn__94093.invoke(auth.clj:30)\n\tat ring.middleware.cookies$wrap_cookies$fn__104812.invoke(cookies.clj:194)\n\tat metabase.server.middleware.misc$add_content_type$fn__67255.invoke(misc.clj:29)\n\tat metabase.server.middleware.misc$disable_streaming_buffering$fn__67281.invoke(misc.clj:78)\n\tat ring.middleware.gzip$wrap_gzip$fn__104854.invoke(gzip.clj:86)\n\tat metabase.server.middleware.misc$bind_request$fn__67284.invoke(misc.clj:95)\n\tat metabase.server.middleware.ssl$redirect_to_https_middleware$fn__104641.invoke(ssl.clj:51)\n\tat metabase.server$async_proxy_handler$fn__67695.invoke(server.clj:78)\n\tat metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a.handle(Unknown Source)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:173)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:122)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:563)\n\tat org.eclipse.jetty.server.HttpChannel$RequestDispatchable.dispatch(HttpChannel.java:1598)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:753)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:501)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:287)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:314)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:100)\n\tat org.eclipse.jetty.io.SelectableChannelEndPoint$1.run(SelectableChannelEndPoint.java:53)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.runTask(AdaptiveExecutionStrategy.java:421)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.consumeTask(AdaptiveExecutionStrategy.java:390)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.tryProduce(AdaptiveExecutionStrategy.java:277)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.run(AdaptiveExecutionStrategy.java:199)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:411)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:969)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.doRunJob(QueuedThreadPool.java:1194)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1149)\n\tat java.base/java.lang.Thread.run(Unknown Source)\nCaused by: java.net.SocketTimeoutException: Read timed out\n\tat java.base/java.net.SocketInputStream.socketRead0(Native Method)\n\tat java.base/java.net.SocketInputStream.socketRead(Unknown Source)\n\tat java.base/java.net.SocketInputStream.read(Unknown Source)\n\tat java.base/java.net.SocketInputStream.read(Unknown Source)\n\tat com.sun.mail.util.TraceInputStream.read(TraceInputStream.java:102)\n\tat java.base/java.io.BufferedInputStream.fill(Unknown Source)\n\tat java.base/java.io.BufferedInputStream.read(Unknown Source)\n\tat com.sun.mail.util.LineInputStream.readLine(LineInputStream.java:100)\n\tat com.sun.mail.smtp.SMTPTransport.readServerResponse(SMTPTransport.java:2456)\n\t... 142 more
2024-12-26 09:12:30,896 ERROR metabase.email :: Error testing SMTP connection\njavax.mail.MessagingException: Could not connect to SMTP host: mail.localdomain.tld, port: 587;\n  nested exception is:\n\tjava.net.SocketTimeoutException: Read timed out\n\tat com.sun.mail.smtp.SMTPTransport.openServer(SMTPTransport.java:2212)\n\tat com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:722)\n\tat javax.mail.Service.connect(Service.java:342)\n\tat metabase.email$test_smtp_settings$fn__75838.invoke(email.clj:235)\n\tat metabase.email$test_smtp_settings.invokeStatic(email.clj:234)\n\tat metabase.email$test_smtp_settings.invoke(email.clj:220)\n\tat metabase.email$guess_smtp_security$fn__75843.invoke(email.clj:259)\n\tat clojure.core$some.invokeStatic(core.clj:2718)\n\tat clojure.core$some.invoke(core.clj:2709)\n\tat metabase.email$guess_smtp_security.invokeStatic(email.clj:257)\n\tat metabase.email$guess_smtp_security.invoke(email.clj:248)\n\tat metabase.email$test_smtp_connection.invokeStatic(email.clj:283)\n\tat metabase.email$test_smtp_connection.invoke(email.clj:266)\n\tat metabase.api.email$fn__87131.invokeStatic(email.clj:112)\n\tat metabase.api.email$fn__87131.invoke(email.clj:92)\n\tat compojure.core$wrap_response$fn__44682.invoke(core.clj:160)\n\tat compojure.core$wrap_route_middleware$fn__44666.invoke(core.clj:132)\n\tat compojure.core$wrap_route_info$fn__44671.invoke(core.clj:139)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:151)\n\tat clojure.lang.Var.invoke(Var.java:393)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat clojure.lang.Var.invoke(Var.java:393)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat metabase.server.middleware.auth$enforce_authentication$fn__94085.invoke(auth.clj:17)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat compojure.core$make_context$handler__44722.invoke(core.clj:290)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:300)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:301)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat metabase.api.routes$fn__102118$fn__102121.invoke(routes.clj:67)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat clojure.lang.AFn.applyToHelper(AFn.java:160)\n\tat clojure.lang.AFn.applyTo(AFn.java:144)\n\tat clojure.core$apply.invokeStatic(core.clj:667)\n\tat clojure.core$apply.invoke(core.clj:662)\n\tat metabase.server.routes$fn__102283$fn__102284.doInvoke(routes.clj:72)\n\tat clojure.lang.RestFn.invoke(RestFn.java:436)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat compojure.core$make_context$handler__44722.invoke(core.clj:290)\n\tat compojure.core$make_context$fn__44726.invoke(core.clj:300)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat compojure.core$wrap_route_matches$fn__44675.invoke(core.clj:153)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694$f__44695$respond_SINGLEQUOTE___44696.invoke(core.clj:197)\n\tat metabase.server.routes$fn__102268$fn__102270.invoke(routes.clj:49)\n\tat compojure.core$routes$fn__44694$f__44695.invoke(core.clj:198)\n\tat compojure.core$routes$fn__44694.invoke(core.clj:200)\n\tat metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__98829.invoke(exceptions.clj:108)\n\tat metabase.server.middleware.exceptions$catch_api_exceptions$fn__98826.invoke(exceptions.clj:96)\n\tat metabase.server.middleware.log$log_api_call$fn__102560$fn__102561$fn__102562.invoke(log.clj:230)\n\tat metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info.invokeStatic(diagnostic.clj:18)\n\tat metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info.invoke(diagnostic.clj:12)\n\tat metabase.server.middleware.log$log_api_call$fn__102560$fn__102561.invoke(log.clj:222)\n\tat toucan2.execute$do_with_call_counts.invokeStatic(execute.clj:112)\n\tat toucan2.execute$do_with_call_counts.invoke(execute.clj:103)\n\tat metabase.server.middleware.log$log_api_call$fn__102560.invoke(log.clj:221)\n\tat metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__104625.invoke(browser_cookie.clj:40)\n\tat metabase.server.middleware.security$add_security_headers$fn__98785.invoke(security.clj:182)\n\tat metabase.server.middleware.json$wrap_json_body$fn__46039.invoke(json.clj:67)\n\tat metabase.server.middleware.offset_paging$handle_paging$fn__84983.invoke(offset_paging.clj:43)\n\tat metabase.server.middleware.json$wrap_streamed_json_response$fn__46057.invoke(json.clj:103)\n\tat ring.middleware.keyword_params$wrap_keyword_params$fn__104892.invoke(keyword_params.clj:55)\n\tat ring.middleware.params$wrap_params$fn__104911.invoke(params.clj:77)\n\tat metabase.server.middleware.misc$maybe_set_site_url$fn__67273.invoke(misc.clj:61)\n\tat metabase.server.middleware.session$reset_session_timeout$fn__72704.invoke(session.clj:546)\n\tat metabase.server.middleware.session$bind_current_user$fn__72670$fn__72671.invoke(session.clj:440)\n\tat metabase.server.middleware.session$do_with_current_user.invokeStatic(session.clj:419)\n\tat metabase.server.middleware.session$do_with_current_user.invoke(session.clj:403)\n\tat metabase.server.middleware.session$bind_current_user$fn__72670.invoke(session.clj:439)\n\tat metabase.server.middleware.session$wrap_current_user_info$fn__72653.invoke(session.clj:378)\n\tat metabase.server.middleware.session$wrap_session_id$fn__72625.invoke(session.clj:257)\n\tat metabase.server.middleware.auth$wrap_static_api_key$fn__94093.invoke(auth.clj:30)\n\tat ring.middleware.cookies$wrap_cookies$fn__104812.invoke(cookies.clj:194)\n\tat metabase.server.middleware.misc$add_content_type$fn__67255.invoke(misc.clj:29)\n\tat metabase.server.middleware.misc$disable_streaming_buffering$fn__67281.invoke(misc.clj:78)\n\tat ring.middleware.gzip$wrap_gzip$fn__104854.invoke(gzip.clj:86)\n\tat metabase.server.middleware.misc$bind_request$fn__67284.invoke(misc.clj:95)\n\tat metabase.server.middleware.ssl$redirect_to_https_middleware$fn__104641.invoke(ssl.clj:51)\n\tat metabase.server$async_proxy_handler$fn__67695.invoke(server.clj:78)\n\tat metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a.handle(Unknown Source)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:173)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:122)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:563)\n\tat org.eclipse.jetty.server.HttpChannel$RequestDispatchable.dispatch(HttpChannel.java:1598)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:753)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:501)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:287)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:314)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:100)\n\tat org.eclipse.jetty.io.SelectableChannelEndPoint$1.run(SelectableChannelEndPoint.java:53)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.runTask(AdaptiveExecutionStrategy.java:421)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.consumeTask(AdaptiveExecutionStrategy.java:390)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.tryProduce(AdaptiveExecutionStrategy.java:277)\n\tat org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.run(AdaptiveExecutionStrategy.java:199)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:411)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:969)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.doRunJob(QueuedThreadPool.java:1194)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1149)\n\tat java.base/java.lang.Thread.run(Unknown Source)\nCaused by: java.net.SocketTimeoutException: Read timed out\n\tat java.base/java.net.SocketInputStream.socketRead0(Native Method)\n\tat java.base/java.net.SocketInputStream.socketRead(Unknown Source)\n\tat java.base/java.net.SocketInputStream.read(Unknown Source)\n\tat java.base/java.net.SocketInputStream.read(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketInputRecord.read(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketInputRecord.readHeader(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketInputRecord.decode(Unknown Source)\n\tat java.base/sun.security.ssl.SSLTransport.decode(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketImpl.decode(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketImpl.readHandshakeRecord(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source)\n\tat java.base/sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source)\n\tat com.sun.mail.util.SocketFetcher.configureSSLSocket(SocketFetcher.java:602)\n\tat com.sun.mail.util.SocketFetcher.createSocket(SocketFetcher.java:376)\n\tat com.sun.mail.util.SocketFetcher.getSocket(SocketFetcher.java:214)\n\tat com.sun.mail.smtp.SMTPTransport.openServer(SMTPTransport.java:2160)\n\t... 141 more
2024-12-26 09:12:31,398 WARN api.email :: Problem connecting to mail server: : Exception reading response: Read timed out
2024-12-26 09:12:31,399 DEBUG middleware.log :: PUT /api/email 400 17.7 s (0 DB calls) \n{:errors {:email-smtp-username \""Wrong username or password\ :email-smtp-password \""Wrong username or password\""}}


### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:133.0) Gecko/20100101 Firefox/133.0"",
    ""vendor"": """"
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.4.0-200-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""oracle"",
      ""postgres"",
      ""bigquery-cloud-sdk""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.15 (Ubuntu 14.15-1.pgdg22.04+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.2""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-05-13"",
      ""tag"": ""v0.49.10"",
      ""hash"": ""9e8fc83""
    }
  }
}
```

### Severity

annoying

### Additional context

_No response_",ky0uraku,2024-12-27 05:10:41+00:00,[],2025-02-04 20:30:45+00:00,,https://github.com/metabase/metabase/issues/51678,"[('Type:New Feature', ''), ('Administration/Settings', ''), ('Misc/Emails', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2563528149, 'issue_id': 2760403871, 'author': 'paoliniluis', 'body': 'The product is designed to send always a password', 'created_at': datetime.datetime(2024, 12, 27, 9, 57, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2563596036, 'issue_id': 2760403871, 'author': 'ky0uraku', 'body': '> The product is designed to send always a password\n\nLimiting the user is bad design. What problem does it solve?', 'created_at': datetime.datetime(2024, 12, 27, 11, 17, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2563955439, 'issue_id': 2760403871, 'author': 'paoliniluis', 'body': ""we never imagined that there would be an smtp server with no password, that's it"", 'created_at': datetime.datetime(2024, 12, 27, 18, 59, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2563959140, 'issue_id': 2760403871, 'author': 'paoliniluis', 'body': '@ky0uraku so the only thing you need to connect to the SMTP gateway is the host? can you give us an example?', 'created_at': datetime.datetime(2024, 12, 27, 19, 5, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2564225748, 'issue_id': 2760403871, 'author': 'ky0uraku', 'body': '@paoliniluis For local mail servers, working without authentication is a common practice. Yes, a hostname and encryption type are enough to connect to them.\n\nWhat example are you asking for?', 'created_at': datetime.datetime(2024, 12, 28, 6, 29, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2564355741, 'issue_id': 2760403871, 'author': 'paoliniluis', 'body': '@ky0uraku is there any container image we can use where we can set up some testing?', 'created_at': datetime.datetime(2024, 12, 28, 15, 7, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2564396566, 'issue_id': 2760403871, 'author': 'ky0uraku', 'body': '@paoliniluis Sure, this postfix image, for example, provide no-auth access by default: https://hub.docker.com/r/juanluisbaptiste/postfix', 'created_at': datetime.datetime(2024, 12, 28, 18, 24, 19, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-27 09:57:59 UTC): The product is designed to send always a password

ky0uraku (Issue Creator) on (2024-12-27 11:17:34 UTC): Limiting the user is bad design. What problem does it solve?

paoliniluis on (2024-12-27 18:59:42 UTC): we never imagined that there would be an smtp server with no password, that's it

paoliniluis on (2024-12-27 19:05:33 UTC): @ky0uraku so the only thing you need to connect to the SMTP gateway is the host? can you give us an example?

ky0uraku (Issue Creator) on (2024-12-28 06:29:17 UTC): @paoliniluis For local mail servers, working without authentication is a common practice. Yes, a hostname and encryption type are enough to connect to them.

What example are you asking for?

paoliniluis on (2024-12-28 15:07:23 UTC): @ky0uraku is there any container image we can use where we can set up some testing?

ky0uraku (Issue Creator) on (2024-12-28 18:24:19 UTC): @paoliniluis Sure, this postfix image, for example, provide no-auth access by default: https://hub.docker.com/r/juanluisbaptiste/postfix

"
2760113431,issue,closed,completed,Query results with aggregations are not correctly cached,"### Describe the bug

If I enable caching for question like `http://localhost:3000/question/21-best-selling-products`,  it saves new query results to the `query_cache` table every time I refresh the page rather than pulling the saved value from cache.

The reason seems to be that the query map that gets hashed into the query-key has the sort order by as:
```
      ""order-by"": [
        [
          ""desc"",
          {},
          [
            ""aggregation"",
            {},
            ""b2e1c83a-6c83-459a-866b-c42675d6461e""
          ]
        ]
      ], 
```
with that random UUID which is different on every run therefore the query is different on every run.

### To Reproduce

Enabling caching on `http://localhost:3000/question/21-best-selling-products` and refreshing the page reproduces the problem.

Also [failing-cache-test.patch](https://github.com/user-attachments/files/18255244/failing-cache-test.patch) is a failing test that demos the issue


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""mysql""
    ],
    ""run-mode"": ""dev"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""tag"": ""vLOCAL_DEV"",
      ""hash"": ""06d1ba2ae111e66253209c01c244d6379acfc6dcb1911fa9ab6012cec9ce52e5""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""9.1.0""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""15.2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```

### Severity

P2

### Additional context

_No response_",nvoxland,2024-12-26 20:18:20+00:00,['wzimrin'],2025-01-10 16:30:31+00:00,2025-01-08 05:27:53+00:00,https://github.com/metabase/metabase/issues/51672,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('Querying/Cache', ''), ('.Escalation', ''), ('.Team/Querying', ''), ('Cloud-Blocker:52', 'Issues blocking the cloud customers to be upgraded to v52')]",[],
2759326471,issue,closed,completed,change title bar name,"i have taken the code from github , is there any option available to change the titlebar name . please help me to solve this ASAP. 
![Image](https://github.com/user-attachments/assets/1edb1ecd-6a31-4a77-aba8-7c620384465c)
",sundarrdeveloper,2024-12-26 06:08:32+00:00,[],2025-01-06 13:19:14+00:00,2025-01-03 17:04:52+00:00,https://github.com/metabase/metabase/issues/51665,[],"[{'comment_id': 2573035391, 'issue_id': 2759326471, 'author': 'sundarrdeveloper', 'body': 'can you please tell me how to change the name of titlebar using github code', 'created_at': datetime.datetime(2025, 1, 6, 12, 42, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2573096363, 'issue_id': 2759326471, 'author': 'brunobergher', 'body': ""@sundarrdeveloper, what are you trying to accomplish? There's very little detail in this issue."", 'created_at': datetime.datetime(2025, 1, 6, 13, 19, 13, tzinfo=datetime.timezone.utc)}]","sundarrdeveloper (Issue Creator) on (2025-01-06 12:42:10 UTC): can you please tell me how to change the name of titlebar using github code

brunobergher on (2025-01-06 13:19:13 UTC): @sundarrdeveloper, what are you trying to accomplish? There's very little detail in this issue.

"
2759250445,issue,open,,Grouped Sum Mismatch with Ungrouped Total in Pie Chart Visualization,"**Describe the bug**
When summing a column and grouping by a field (e.g., ""workspace"") in a pie chart, the total of the grouped sums does not match the ungrouped total.


**To Reproduce**
Steps to reproduce the behavior:
When creating a pie chart:
- Calculate the sum of a column (e.g., ""total"").
- Group the data by a specific field (e.g., ""workspace"").
- Observe that the sum of grouped totals does not match the overall total of the column when ungrouped.
- 
**Expected behavior**
 the grouped totals should add up to the same overall total.



**Screenshots**
![Image](https://github.com/user-attachments/assets/5f54acbc-04ae-4381-ad27-44f6446a91cd)
![Image](https://github.com/user-attachments/assets/6425941d-7a7b-455e-a7ef-559fad9632d1)


**Severity**
This discrepancy causing a confusion and affects data accuracy in the visualization.



**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mongo"",
      ""h2"",
      ""bigquery-cloud-sdk""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-21"",
      ""tag"": ""v0.52.4"",
      ""hash"": ""2f8c560""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.12""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.8.0-1017-azure"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```",Lina-penny,2024-12-26 04:12:58+00:00,[],2024-12-26 04:12:58+00:00,,https://github.com/metabase/metabase/issues/51664,[],[],
2758657397,issue,open,,"Error publishing :event/user-invited event: ERROR: relation ""notification"" does not exist Position: 19","### Describe the bug

This is the exception I'm getting on a new version of Metabase when trying to add a new user. It might be connected anyhow with with my migration to another instance of postgres, but I don't see any reasons why. I made simply `pg_dump` and then `pg_restore`

### To Reproduce

1. Go to admin
2. Add a new user
3. Click ""create""
4. See error


### Expected behavior

A user successfully created

### Logs

<details>
<summary> logs from instance </summary>

```
2024-12-25 09:08:08,814 INFO models.user :: Setting User 61's last_acknowledged_version to v0.52.3, the current version
2024-12-25 09:08:08,818 INFO models.user :: Adding User 61 to All Users permissions group...
2024-12-25 09:08:08,845 ERROR middleware.log :: POST /api/user 500 114ms (10 DB calls) {:metabase-user-id 1}
{:via
 [{:type clojure.lang.ExceptionInfo,
   :message
   ""Error publishing :event/user-invited event: ERROR: relation \""notification\"" does not exist\n  Position: 19"",
   :data
   {:topic :event/user-invited,
    :event
    {:object
     {:email ""zhandos@uvu.kz"",
      :first_name ""Zhandos"",
      :last_login nil,
      :is_qbnewb true,
      :is_superuser false,
      :id 61,
      :last_name ""Mukhataev"",
      :is_from_setup false,
      :date_joined #t ""2024-12-25T09:08:08.716091Z"",
      :sso_source nil,
      :common_name ""Zhandos Mukhataev"",
      :invite_method ""email""},
     :details {:invitor {:email ""muammar@uvu.kz"", :first_name ""Muammar""}}},
    :toucan2/context-trace
    [[""resolve connection"" {:toucan2.connection/connectable metabase.db.connection.ApplicationDB}]
     [""resolve connection"" {:toucan2.connection/connectable :default}]
     [""resolve connection"" {:toucan2.connection/connectable nil}]]},
   :at [metabase.events$publish_event_BANG__around_method_default$fn__40734 invoke ""events.clj"" 139]}
  {:type clojure.lang.ExceptionInfo,
   :message ""ERROR: relation \""notification\"" does not exist\n  Position: 19"",
   :data
   {:toucan2/context-trace
    [[""execute SQL with class com.mchange.v2.c3p0.impl.NewProxyConnection""
      {:toucan2.jdbc.query/sql-args
       [""SELECT \""n\"".* FROM \""notification\"" AS \""n\"" LEFT JOIN \""notification_subscription\"" AS \""ns\"" ON \""n\"".\""id\"" = \""ns\"".\""notification_id\"" WHERE (\""n\"".\""active\"" = TRUE) AND (\""ns\"".\""event_name\"" = ?) AND (\""ns\"".\""type\"" = ?)""
        ""event/user-invited""
        ""notification-subscription/system-event""]}]
     [""resolve connection"" {:toucan2.connection/connectable org.postgresql.jdbc.PgConnection}]
     [""resolve connection"" {:toucan2.connection/connectable nil}]
     {:toucan2.pipeline/rf
      #object[clojure.core$map$fn__5950$fn__5951 0x311cd49f ""clojure.core$map$fn__5950$fn__5951@311cd49f""]}
     [""with compiled query""
      {:toucan2.pipeline/compiled-query
       [""SELECT \""n\"".* FROM \""notification\"" AS \""n\"" LEFT JOIN \""notification_subscription\"" AS \""ns\"" ON \""n\"".\""id\"" = \""ns\"".\""notification_id\"" WHERE (\""n\"".\""active\"" = TRUE) AND (\""ns\"".\""event_name\"" = ?) AND (\""ns\"".\""type\"" = ?)""
        ""event/user-invited""
        ""notification-subscription/system-event""]}]
     [""with built query""
      {:toucan2.pipeline/built-query
       {:from [[:notification :n]],
        :select [:n.*],
        :left-join [[:notification_subscription :ns] [:= :n.id :ns.notification_id]],
        :where
        [:and
         [:= :n.active true]
         [:= :ns.event_name ""event/user-invited""]
         [:= :ns.type ""notification-subscription/system-event""]]}}]
     [""with resolved query""
      {:toucan2.pipeline/resolved-query
       {:select [:n.*],
        :from [[:notification :n]],
        :left-join [[:notification_subscription :ns] [:= :n.id :ns.notification_id]],
        :where
        [:and
         [:= :n.active true]
         [:= :ns.event_name ""event/user-invited""]
         [:= :ns.type ""notification-subscription/system-event""]]}}]
     [""with parsed args""
      {:toucan2.pipeline/query-type :toucan.query-type/select.instances,
       :toucan2.pipeline/parsed-args
       {:queryable
        {:select [:n.*],
         :from [[:notification :n]],
         :left-join [[:notification_subscription :ns] [:= :n.id :ns.notification_id]],
         :where
         [:and
          [:= :n.active true]
          [:= :ns.event_name ""event/user-invited""]
          [:= :ns.type ""notification-subscription/system-event""]]}}}]
     [""with model"" {:toucan2.pipeline/model :model/Notification}]
     [""with unparsed args""
      {:toucan2.pipeline/query-type :toucan.query-type/select.instances,
       :toucan2.pipeline/unparsed-args
       (:model/Notification
        {:select [:n.*],
         :from [[:notification :n]],
         :left-join [[:notification_subscription :ns] [:= :n.id :ns.notification_id]],
         :where
         [:and
          [:= :n.active true]
          [:= :ns.event_name ""event/user-invited""]
          [:= :ns.type ""notification-subscription/system-event""]]})}]]},
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse ""QueryExecutorImpl.java"" 2725]}
  {:type org.postgresql.util.PSQLException,
   :message ""ERROR: relation \""notification\"" does not exist\n  Position: 19"",
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse ""QueryExecutorImpl.java"" 2725]}],
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse ""QueryExecutorImpl.java"" 2725]
  [org.postgresql.core.v3.QueryExecutorImpl processResults ""QueryExecutorImpl.java"" 2412]
  [org.postgresql.core.v3.QueryExecutorImpl execute ""QueryExecutorImpl.java"" 371]
  [org.postgresql.jdbc.PgStatement executeInternal ""PgStatement.java"" 502]
  [org.postgresql.jdbc.PgStatement execute ""PgStatement.java"" 419]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags ""PgPreparedStatement.java"" 194]
  [org.postgresql.jdbc.PgPreparedStatement execute ""PgPreparedStatement.java"" 180]
  [com.mchange.v2.c3p0.impl.NewProxyPreparedStatement execute ""NewProxyPreparedStatement.java"" 1216]
  [toucan2.jdbc.query$reduce_jdbc_query invokeStatic ""query.clj"" 40]
  [toucan2.jdbc.query$reduce_jdbc_query invoke ""query.clj"" 22]
  [toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default
   invokeStatic
   ""pipeline.clj""
   19]
  [toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default
   invoke
   ""pipeline.clj""
   9]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 15]
  [methodical.impl.combo.threaded$combine_methods_thread_last$fn__19698$combined_method_thread_last__19699
   invoke
   ""threaded.clj""
   64]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 65]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 216]
  [toucan2.pipeline$transduce_execute$with_connection_STAR___22784 invoke ""pipeline.clj"" 78]
  [toucan2.connection$bind_current_connectable_fn$fn__22461 invoke ""connection.clj"" 104]
  [toucan2.connection$bind_current_connectable_fn$fn__22461 invoke ""connection.clj"" 104]
  [toucan2.jdbc.connection$do_with_connection_primary_method_java_sql_Connection invokeStatic ""connection.clj"" 13]
  [toucan2.jdbc.connection$do_with_connection_primary_method_java_sql_Connection invoke ""connection.clj"" 11]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.connection$do_with_connection_primary_method_ invokeStatic ""connection.clj"" 204]
  [toucan2.connection$do_with_connection_primary_method_ invoke ""connection.clj"" 194]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.pipeline$transduce_execute invokeStatic ""pipeline.clj"" 77]
  [toucan2.pipeline$transduce_execute invoke ""pipeline.clj"" 64]
  [clojure.lang.Var invoke ""Var.java"" 401]
  [toucan2.pipeline$transduce_compiled_query invokeStatic ""pipeline.clj"" 244]
  [toucan2.pipeline$transduce_compiled_query invoke ""pipeline.clj"" 240]
  [toucan2.pipeline$transduce_built_query invokeStatic ""pipeline.clj"" 252]
  [toucan2.pipeline$transduce_built_query invoke ""pipeline.clj"" 246]
  [toucan2.pipeline$transduce_query_primary_method_default invokeStatic ""pipeline.clj"" 272]
  [toucan2.pipeline$transduce_query_primary_method_default invoke ""pipeline.clj"" 269]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 15]
  [methodical.impl.combo.threaded$combine_methods_thread_last$fn__19698$combined_method_thread_last__19699
   invoke
   ""threaded.clj""
   64]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 65]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 216]
  [toucan2.pipeline$transduce_query_STAR_ invokeStatic ""pipeline.clj"" 278]
  [toucan2.pipeline$transduce_query_STAR_ invoke ""pipeline.clj"" 274]
  [toucan2.pipeline$transduce_with_model invokeStatic ""pipeline.clj"" 293]
  [toucan2.pipeline$transduce_with_model invoke ""pipeline.clj"" 280]
  [toucan2.pipeline$transduce_parsed invokeStatic ""pipeline.clj"" 309]
  [toucan2.pipeline$transduce_parsed invoke ""pipeline.clj"" 295]
  [toucan2.pipeline$transduce_unparsed invokeStatic ""pipeline.clj"" 317]
  [toucan2.pipeline$transduce_unparsed invoke ""pipeline.clj"" 311]
  [toucan2.pipeline$transduce_unparsed_with_default_rf invokeStatic ""pipeline.clj"" 374]
  [toucan2.pipeline$transduce_unparsed_with_default_rf invoke ""pipeline.clj"" 368]
  [toucan2.select$select invokeStatic ""select.clj"" 48]
  [toucan2.select$select doInvoke ""select.clj"" 44]
  [clojure.lang.RestFn invoke ""RestFn.java"" 424]
  [metabase.models.notification$notifications_for_event invokeStatic ""notification.clj"" 271]
  [metabase.models.notification$notifications_for_event invoke ""notification.clj"" 268]
  [metabase.events.notification$notifications_for_topic invokeStatic ""notification.clj"" 61]
  [metabase.events.notification$notifications_for_topic invoke ""notification.clj"" 57]
  [metabase.events.notification$maybe_send_notification_for_topic_BANG_ invokeStatic ""notification.clj"" 72]
  [metabase.events.notification$maybe_send_notification_for_topic_BANG_ invoke ""notification.clj"" 69]
  [metabase.events.notification$publish_event_BANG__primary_method_metabase_events_notification_notification
   invokeStatic
   ""notification.clj""
   84]
  [metabase.events.notification$publish_event_BANG__primary_method_metabase_events_notification_notification
   invoke
   ""notification.clj""
   82]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.combo.operator$invoke_fn$fn__19503 invoke ""operator.clj"" 69]
  [methodical.impl.combo.operator$fn__19524$fn__19525$fn__19526 invoke ""operator.clj"" 112]
  [clojure.core$comp$fn__5895 invoke ""core.clj"" 2587]
  [metabase.events$publish_event_BANG__around_method_default$fn__40734 invoke ""events.clj"" 137]
  [metabase.events$publish_event_BANG__around_method_default invokeStatic ""events.clj"" 134]
  [metabase.events$publish_event_BANG__around_method_default invoke ""events.clj"" 113]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [metabase.models.user$create_and_invite_user_BANG_71905__71906 invokeStatic ""user.clj"" 368]
  [metabase.models.user$create_and_invite_user_BANG_71905__71906 invoke ""user.clj"" 360]
  [metabase.api.user$fn__109170$with_connection_STAR___109173$with_transaction_STAR___109174 invoke ""user.clj"" 371]
  [toucan2.connection$bind_current_connectable_fn$fn__22461 invoke ""connection.clj"" 104]
  [metabase.db.connection$do_transaction$thunk__43606 invoke ""connection.clj"" 140]
  [metabase.db.connection$do_transaction invokeStatic ""connection.clj"" 152]
  [metabase.db.connection$do_transaction invoke ""connection.clj"" 136]
  [metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection invokeStatic ""connection.clj"" 189]
  [metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection invoke ""connection.clj"" 162]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 13]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_transaction_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 249]
  [toucan2.connection$do_with_transaction_around_method_toucan2_connection_default invoke ""connection.clj"" 245]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 13]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 58]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 212]
  [metabase.api.user$fn__109170$with_connection_STAR___109173 invoke ""user.clj"" 370]
  [toucan2.connection$bind_current_connectable_fn$fn__22461 invoke ""connection.clj"" 104]
  [toucan2.connection$bind_current_connectable_fn$fn__22461 invoke ""connection.clj"" 104]
  [toucan2.connection$bind_current_connectable_fn$fn__22461 invoke ""connection.clj"" 104]
  [toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource invokeStatic ""connection.clj"" 18]
  [toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource invoke ""connection.clj"" 15]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [metabase.db.connection$do_with_connection_primary_method_default invokeStatic ""connection.clj"" 132]
  [metabase.db.connection$do_with_connection_primary_method_default invoke ""connection.clj"" 130]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.connection$do_with_connection_primary_method_ invokeStatic ""connection.clj"" 204]
  [toucan2.connection$do_with_connection_primary_method_ invoke ""connection.clj"" 194]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19388 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [metabase.api.user$fn__109170 invokeStatic ""user.clj"" 370]
  [metabase.api.user$fn__109170 invoke ""user.clj"" 359]
  [compojure.core$wrap_response$fn__54217 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__54201 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__54206 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [metabase.server.middleware.auth$enforce_authentication$fn__104621 invoke ""auth.clj"" 18]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__54257 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 300]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [metabase.api.routes$fn__109277$fn__109280 invoke ""routes.clj"" 75]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__110019$fn__110020 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__54257 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__54261 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
  [metabase.server.routes$fn__110002$fn__110004 invoke ""routes.clj"" 47]
  [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__106746 invoke ""exceptions.clj"" 111]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__106743 invoke ""exceptions.clj"" 100]
  [metabase.server.middleware.log$log_api_call$fn__110385$fn__110386$fn__110387 invoke ""log.clj"" 233]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 17]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__110385$fn__110386 invoke ""log.clj"" 224]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__110385 invoke ""log.clj"" 223]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__114100 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__106702 invoke ""security.clj"" 273]
  [ring.middleware.json$wrap_json_body$fn__114359 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__96235 invoke ""offset_paging.clj"" 56]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__55864 invoke ""json.clj"" 88]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__114448 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__114467 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__70111 invoke ""misc.clj"" 59]
  [metabase.server.middleware.session$reset_session_timeout$fn__72177 invoke ""session.clj"" 566]
  [metabase.server.middleware.session$bind_current_user$fn__72143$fn__72144 invoke ""session.clj"" 459]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 438]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 421]
  [metabase.server.middleware.session$bind_current_user$fn__72143 invoke ""session.clj"" 458]
  [metabase.server.middleware.session$wrap_current_user_info$fn__72120 invoke ""session.clj"" 383]
  [metabase.analytics.sdk$embedding_mw$embedding_mw_fn__78293 invoke ""sdk.clj"" 61]
  [metabase.server.middleware.session$wrap_session_id$fn__72092 invoke ""session.clj"" 261]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__104629 invoke ""auth.clj"" 33]
  [ring.middleware.cookies$wrap_cookies$fn__114287 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__70093 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__70119 invoke ""misc.clj"" 75]
  [ring.middleware.gzip$wrap_gzip$fn__114329 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.request_id$wrap_request_id$fn__110081 invoke ""request_id.clj"" 9]
  [metabase.server.middleware.misc$bind_request$fn__70122 invoke ""misc.clj"" 91]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__114116 invoke ""ssl.clj"" 51]
  [metabase.server$async_proxy_handler$fn__56833 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run nil -1]],
 :cause ""ERROR: relation \""notification\"" does not exist\n  Position: 19"",
 :message ""Error publishing :event/user-invited event: ERROR: relation \""notification\"" does not exist\n  Position: 19"",
 :topic :event/user-invited,
 :event
 {:object
```

</details>

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  }
}
```

### Severity

normal

### Additional context

_No response_",al-muammar,2024-12-25 09:11:15+00:00,[],2025-02-04 20:26:31+00:00,,https://github.com/metabase/metabase/issues/51659,"[('Priority:P2', 'Average run of the mill bug'), ('Operation/Database Migrations', 'Issues with application DB migrations when launching Metabase'), ('.Backend', ''), ('.Team/Workflows', 'aka BEC'), ('.Needs Clarification', 'Issue is incomplete or missing actionable information.')]","[{'comment_id': 2561875496, 'issue_id': 2758657397, 'author': 'paoliniluis', 'body': 'Theres a table that doesnt exist. Can you check if migration worked?', 'created_at': datetime.datetime(2024, 12, 25, 12, 42, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2563617562, 'issue_id': 2758657397, 'author': 'al-muammar', 'body': ""@paoliniluis, well, that's also my suspicion. What is the table with migrations? And how can I re-apply migrations in case they didn't work?\n\nAlso, on which version this table was added?"", 'created_at': datetime.datetime(2024, 12, 27, 11, 46, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2564362010, 'issue_id': 2758657397, 'author': 'paoliniluis', 'body': '@al-muammar I would guess that you moved between versions without applying migrations, can you do a database backup and then run Metabase with ""migrate force"" as arguments?', 'created_at': datetime.datetime(2024, 12, 28, 15, 26, 50, tzinfo=datetime.timezone.utc)}, {'comment_id': 2587462263, 'issue_id': 2758657397, 'author': 'dpsutton', 'body': ""I'm removing the bug label as this seems to be related to actions outside of Metabase itself."", 'created_at': datetime.datetime(2025, 1, 13, 15, 39, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2589788394, 'issue_id': 2758657397, 'author': 'qnkhuat', 'body': 'this is triggered by system notifications: https://github.com/metabase/metabase/blob/950e61e5b059b6fc80aea121767fd0aa1edafa42/src/metabase/events/notification.clj#L69\n\nit looks like the `notification` table does not exist.', 'created_at': datetime.datetime(2025, 1, 14, 12, 29, 16, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-25 12:42:34 UTC): Theres a table that doesnt exist. Can you check if migration worked?

al-muammar (Issue Creator) on (2024-12-27 11:46:56 UTC): @paoliniluis, well, that's also my suspicion. What is the table with migrations? And how can I re-apply migrations in case they didn't work?

Also, on which version this table was added?

paoliniluis on (2024-12-28 15:26:50 UTC): @al-muammar I would guess that you moved between versions without applying migrations, can you do a database backup and then run Metabase with ""migrate force"" as arguments?

dpsutton on (2025-01-13 15:39:18 UTC): I'm removing the bug label as this seems to be related to actions outside of Metabase itself.

qnkhuat on (2025-01-14 12:29:16 UTC): this is triggered by system notifications: https://github.com/metabase/metabase/blob/950e61e5b059b6fc80aea121767fd0aa1edafa42/src/metabase/events/notification.clj#L69

it looks like the `notification` table does not exist.

"
2758590650,issue,closed,completed,Fix static embedding missing dark theme on some date widgets,"### Describe the bug

Since https://github.com/metabase/metabase/pull/51596 and #51645, some static embedding widgets are missing dark theme, and have to be themed.

For example
- ![img](https://github.com/metabase/metabase/blob/eb596a48f0e32ee5b3017eec9d36a89796159b0e/.loki/reference/chrome_laptop_embed_PublicOrEmbeddedDashboardView_filters_Dark_Theme_Date_Filter_Month_Year.png?raw=true)


### To Reproduce

1. Check all static embedding snapshots under `.loki/reference/chrome_laptop_embed_PublicOrEmbedded*` and see if all snapshots looks okay on dark theme.


### Expected behavior

All widgets on static embed dark theme should look okay, texts should be legible.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2""
    ],
    ""run-mode"": ""dev"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-12-18"",
      ""src_hash"": ""dda626cbd158bb763f9661e8ff435361fb2b20f5"",
      ""tag"": ""v1.52.5-SNAPSHOT"",
      ""hash"": ""4cfbd67""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.2+13-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.2"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.2+13-LTS"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""15.2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```

### Severity

annoying

### Additional context

_No response_",WiNloSt,2024-12-25 07:44:05+00:00,['WiNloSt'],2025-01-27 22:12:39+00:00,2025-01-03 09:13:58+00:00,https://github.com/metabase/metabase/issues/51658,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('.Regression/master', 'Regression that is only present on master, or bug in new upcoming feature'), ('.Team/Embedding', '')]",[],
2757925646,issue,open,,Row totals of distinct values on pivot tables don't add up,"### Describe the bug

The row totals for the pivot table are wrong when using the distinct values function

### To Reproduce

1) Build the following pivot
![Image](https://github.com/user-attachments/assets/4b4fa2a1-643b-41f1-a656-80a9df21a6f5)
2) visualize it like
![Image](https://github.com/user-attachments/assets/91f7a3f7-2f36-4db8-844f-949bcd22f9f7)
3) see that the row totals are wrong

### Expected behavior

Correct row totals

### Logs

NA

### Information about your Metabase installation

```JSON
seems it has always been like that (tested in master and customer reported in 51)
```

### Severity

P1

### Additional context

NA",paoliniluis,2024-12-24 15:20:38+00:00,[],2025-02-04 20:31:42+00:00,,https://github.com/metabase/metabase/issues/51654,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('Visualization/Tables/old-pivoted', ''), ('.Product Input Needed', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Reporting/Export/Pivot', 'Exporting data as pivoted tables')]","[{'comment_id': 2562912710, 'issue_id': 2757925646, 'author': 'perivamsi', 'body': ""[Stats repro link](https://stats.metabase.com/question#eyJkYXRhc2V0X3F1ZXJ5Ijp7ImRhdGFiYXNlIjoxLCJ0eXBlIjoicXVlcnkiLCJxdWVyeSI6eyJzb3VyY2UtdGFibGUiOjQsImJyZWFrb3V0IjpbWyJmaWVsZCIsMTcseyJiYXNlLXR5cGUiOiJ0eXBlL0RhdGUiLCJ0ZW1wb3JhbC11bml0IjoibW9udGgtb2YteWVhciIsIm9yaWdpbmFsLXRlbXBvcmFsLXVuaXQiOiJtb250aCJ9XSxbImZpZWxkIiwzMyx7ImJhc2UtdHlwZSI6InR5cGUvVGV4dCJ9XV0sImFnZ3JlZ2F0aW9uIjpbWyJkaXN0aW5jdCIsWyJmaWVsZCIsNix7ImJhc2UtdHlwZSI6InR5cGUvVGV4dCJ9XV1dLCJhZ2dyZWdhdGlvbi1pZGVudHMiOnsiMCI6Ik9JcmdmblZNbTQ5cDJlR1YwN252QiJ9LCJicmVha291dC1pZGVudHMiOnsiMCI6IlNvYTM5M1BWbFl2Q2pNVTF5STh5QyIsIjEiOiJrU3I3OW1NaE5ZUXBmQkYxZmR5eU8ifX19LCJkaXNwbGF5IjoicGl2b3QiLCJkaXNwbGF5SXNMb2NrZWQiOnRydWUsInZpc3VhbGl6YXRpb25fc2V0dGluZ3MiOnsicGl2b3RfdGFibGUuY29sdW1uX3NwbGl0Ijp7InJvd3MiOlsiU1RBVEUiXSwiY29sdW1ucyI6WyJCSVJUSF9EQVRFIl0sInZhbHVlcyI6WyJjb3VudCJdfSwicGl2b3RfdGFibGUuY29sdW1uX3dpZHRocyI6eyJsZWZ0SGVhZGVyV2lkdGhzIjpbODBdLCJ0b3RhbExlZnRIZWFkZXJXaWR0aHMiOjgwLCJ2YWx1ZUhlYWRlcldpZHRocyI6e319fSwidHlwZSI6InF1ZXN0aW9uIn0=)\n\nThis is an interesting one - pivots and non-linear aggregations (things like distinct count, cumulative sum, max, min, etc - basically anything other than count) don't play well with pivot tables. \n\nIn this case, the row total is the number of distinct values of that row, not the sum of all the values of that row. Does it even make sense to add up the distinct number of sources to get to the row totals?"", 'created_at': datetime.datetime(2024, 12, 26, 16, 0, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2569442996, 'issue_id': 2757925646, 'author': 'ranquild', 'body': ""The UX is confusing but it's unclear what the fix should be. Requires product input."", 'created_at': datetime.datetime(2025, 1, 3, 15, 46, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572891623, 'issue_id': 2757925646, 'author': 'mngr', 'body': ""Relates to this one: https://github.com/metabase/metabase/issues/49957, we discussed it [here](https://metaboat.slack.com/archives/C064EB1UE5P/p1732622632999549?thread_ts=1732570903.852019&cid=C064EB1UE5P) .\nBetween the PMs, we share the opinion that it doesn't make sense to sum up stuff like cumulatives and distincts.\nI would add some docs covering these cases."", 'created_at': datetime.datetime(2025, 1, 6, 11, 11, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2573336780, 'issue_id': 2757925646, 'author': 'zbodi74', 'body': 'Note that he issue is not limited to the row / column totals - it also affects non-additive measures (like distinct count) in any exported pivot table with more than one level of aggregation.\n\nThe native pivot visualization handles this correctly since it computes the measure for each aggregation level from the unaggregated data. However, when the pivot table is exported, the data is already pre-aggregated, meaning higher level aggregations for non-additive measures cannot be computed accurately.\n\nAnother limitation to note is that standard pivot tables in Excel dont support distinct()  this only appears to be available in Power Pivot, which works from the unaggregated data source.', 'created_at': datetime.datetime(2025, 1, 6, 15, 23, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2573374936, 'issue_id': 2757925646, 'author': 'mngr', 'body': ""What's your opinion @cdeweyx ? Would you take it to your backlog along with https://github.com/metabase/metabase/issues/49957?"", 'created_at': datetime.datetime(2025, 1, 6, 15, 42, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2576507381, 'issue_id': 2757925646, 'author': 'tsplude', 'body': '@adam-james-v and I took a look at this. Seems like there are at least two potentially actionable things:\n\n1. The aggregation column / row headers are unintuitive in some non linear measure cases (e.g. distinct count)\n2. As @zbodi74 points out, the resulting aggregations in csv / xlsx exports do not match their in app counterparts\n\nFor 1, it seems that that is the reason this issue came to be. For the posted example of distinct counts the aggregation headers lead you to believe that those values should be summations when in reality they represent e.g. the distinct values of ""Source"" in the month of January.\n\nAlso consider the below example, where I took the same dataset and trimmed it down to just AK/AL Jan/Feb and then set all the ""Source"" values to be distinct (beyond the original 5 values of Twitter, Facebook, etc.). The result is that both the aggregation values and their headers make you think this is a summation when that is not the case. Perhaps it\'s worth considering updating the aggregation row/column labels depending on the measure?\n\n<details>\n<summary>Distinct Count Example</summary>\n<img width=""550"" alt=""Image"" src=""https://github.com/user-attachments/assets/b77fbaf7-1996-4f64-8596-e5ca8a89d176"" />\n</details>\n\nFor 2, we can fix csv exports to use the aggregations already done by qp if that\'s what we want here. Unfortunately no easy fix is possible for xlsx exports due to the nature of their implementation. As @zbodi74 points out, we receive pre-aggregated values from qp and use that ""raw"" data in a 2nd sheet of the xlsx file in order to lean on Excel\'s pivot table implementation which is then responsible for ultimately displaying the row/column aggregations.\n\nTwo ideas for moving forward would be 1) we disable the aggregation rows/columns for non linear measures where it\'s debatable that they make sense generally, or 2) the streaming export code receives non aggregated data from qp for excel pivot table exports.', 'created_at': datetime.datetime(2025, 1, 8, 1, 3, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2577835500, 'issue_id': 2757925646, 'author': 'cdeweyx', 'body': ""Following up on @tsplude's comment above, I'm re-labeling this issue as a P2 for the same reasons I laid out [here](https://github.com/metabase/metabase/issues/49957#issuecomment-2512257076). I do think it's problematic that exports are incorrect, and we should fix CSV downloads. \n\nXLXS is tougher since I worry that streaming non-aggregated data will amplify the crashing bugs we hit before running out of memory. Maybe the best short-term path there is to disable totals in these cases and denote it in documentation, but low conviction on that.\n\ncc: @zbodi74 @paoliniluis to gut check my thinking here"", 'created_at': datetime.datetime(2025, 1, 8, 14, 39, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2583836654, 'issue_id': 2757925646, 'author': 'zbodi74', 'body': 'Sounds right - the exported data should align with the results from the native widget. This can be adressed for some aggregate metrics (min, max), but is not feasible for others (distinct, average) with xlsx. For those not feasible, it may be better to disable the totals in the export to prevent incorrect data.', 'created_at': datetime.datetime(2025, 1, 10, 19, 47, 43, tzinfo=datetime.timezone.utc)}]","perivamsi on (2024-12-26 16:00:26 UTC): [Stats repro link](https://stats.metabase.com/question#eyJkYXRhc2V0X3F1ZXJ5Ijp7ImRhdGFiYXNlIjoxLCJ0eXBlIjoicXVlcnkiLCJxdWVyeSI6eyJzb3VyY2UtdGFibGUiOjQsImJyZWFrb3V0IjpbWyJmaWVsZCIsMTcseyJiYXNlLXR5cGUiOiJ0eXBlL0RhdGUiLCJ0ZW1wb3JhbC11bml0IjoibW9udGgtb2YteWVhciIsIm9yaWdpbmFsLXRlbXBvcmFsLXVuaXQiOiJtb250aCJ9XSxbImZpZWxkIiwzMyx7ImJhc2UtdHlwZSI6InR5cGUvVGV4dCJ9XV0sImFnZ3JlZ2F0aW9uIjpbWyJkaXN0aW5jdCIsWyJmaWVsZCIsNix7ImJhc2UtdHlwZSI6InR5cGUvVGV4dCJ9XV1dLCJhZ2dyZWdhdGlvbi1pZGVudHMiOnsiMCI6Ik9JcmdmblZNbTQ5cDJlR1YwN252QiJ9LCJicmVha291dC1pZGVudHMiOnsiMCI6IlNvYTM5M1BWbFl2Q2pNVTF5STh5QyIsIjEiOiJrU3I3OW1NaE5ZUXBmQkYxZmR5eU8ifX19LCJkaXNwbGF5IjoicGl2b3QiLCJkaXNwbGF5SXNMb2NrZWQiOnRydWUsInZpc3VhbGl6YXRpb25fc2V0dGluZ3MiOnsicGl2b3RfdGFibGUuY29sdW1uX3NwbGl0Ijp7InJvd3MiOlsiU1RBVEUiXSwiY29sdW1ucyI6WyJCSVJUSF9EQVRFIl0sInZhbHVlcyI6WyJjb3VudCJdfSwicGl2b3RfdGFibGUuY29sdW1uX3dpZHRocyI6eyJsZWZ0SGVhZGVyV2lkdGhzIjpbODBdLCJ0b3RhbExlZnRIZWFkZXJXaWR0aHMiOjgwLCJ2YWx1ZUhlYWRlcldpZHRocyI6e319fSwidHlwZSI6InF1ZXN0aW9uIn0=)

This is an interesting one - pivots and non-linear aggregations (things like distinct count, cumulative sum, max, min, etc - basically anything other than count) don't play well with pivot tables. 

In this case, the row total is the number of distinct values of that row, not the sum of all the values of that row. Does it even make sense to add up the distinct number of sources to get to the row totals?

ranquild on (2025-01-03 15:46:44 UTC): The UX is confusing but it's unclear what the fix should be. Requires product input.

mngr on (2025-01-06 11:11:43 UTC): Relates to this one: https://github.com/metabase/metabase/issues/49957, we discussed it [here](https://metaboat.slack.com/archives/C064EB1UE5P/p1732622632999549?thread_ts=1732570903.852019&cid=C064EB1UE5P) .
Between the PMs, we share the opinion that it doesn't make sense to sum up stuff like cumulatives and distincts.
I would add some docs covering these cases.

zbodi74 on (2025-01-06 15:23:24 UTC): Note that he issue is not limited to the row / column totals - it also affects non-additive measures (like distinct count) in any exported pivot table with more than one level of aggregation.

The native pivot visualization handles this correctly since it computes the measure for each aggregation level from the unaggregated data. However, when the pivot table is exported, the data is already pre-aggregated, meaning higher level aggregations for non-additive measures cannot be computed accurately.

Another limitation to note is that standard pivot tables in Excel dont support distinct()  this only appears to be available in Power Pivot, which works from the unaggregated data source.

mngr on (2025-01-06 15:42:48 UTC): What's your opinion @cdeweyx ? Would you take it to your backlog along with https://github.com/metabase/metabase/issues/49957?

tsplude on (2025-01-08 01:03:48 UTC): @adam-james-v and I took a look at this. Seems like there are at least two potentially actionable things:

1. The aggregation column / row headers are unintuitive in some non linear measure cases (e.g. distinct count)
2. As @zbodi74 points out, the resulting aggregations in csv / xlsx exports do not match their in app counterparts

For 1, it seems that that is the reason this issue came to be. For the posted example of distinct counts the aggregation headers lead you to believe that those values should be summations when in reality they represent e.g. the distinct values of ""Source"" in the month of January.

Also consider the below example, where I took the same dataset and trimmed it down to just AK/AL Jan/Feb and then set all the ""Source"" values to be distinct (beyond the original 5 values of Twitter, Facebook, etc.). The result is that both the aggregation values and their headers make you think this is a summation when that is not the case. Perhaps it's worth considering updating the aggregation row/column labels depending on the measure?

<details>
<summary>Distinct Count Example</summary>
<img width=""550"" alt=""Image"" src=""https://github.com/user-attachments/assets/b77fbaf7-1996-4f64-8596-e5ca8a89d176"" />
</details>

For 2, we can fix csv exports to use the aggregations already done by qp if that's what we want here. Unfortunately no easy fix is possible for xlsx exports due to the nature of their implementation. As @zbodi74 points out, we receive pre-aggregated values from qp and use that ""raw"" data in a 2nd sheet of the xlsx file in order to lean on Excel's pivot table implementation which is then responsible for ultimately displaying the row/column aggregations.

Two ideas for moving forward would be 1) we disable the aggregation rows/columns for non linear measures where it's debatable that they make sense generally, or 2) the streaming export code receives non aggregated data from qp for excel pivot table exports.

cdeweyx on (2025-01-08 14:39:21 UTC): Following up on @tsplude's comment above, I'm re-labeling this issue as a P2 for the same reasons I laid out [here](https://github.com/metabase/metabase/issues/49957#issuecomment-2512257076). I do think it's problematic that exports are incorrect, and we should fix CSV downloads. 

XLXS is tougher since I worry that streaming non-aggregated data will amplify the crashing bugs we hit before running out of memory. Maybe the best short-term path there is to disable totals in these cases and denote it in documentation, but low conviction on that.

cc: @zbodi74 @paoliniluis to gut check my thinking here

zbodi74 on (2025-01-10 19:47:43 UTC): Sounds right - the exported data should align with the results from the native widget. This can be adressed for some aggregate metrics (min, max), but is not feasible for others (distinct, average) with xlsx. For those not feasible, it may be better to disable the totals in the export to prevent incorrect data.

"
2757854096,issue,open,,"Little accessibility Improvements - keyboard interaction, voice over pdf improvement","**Is your feature request related to a problem? Please describe.**
Creating a feature request to attach it to a customer regarding this fixes: https://github.com/metabase/metabase/pull/51577

Keyboard Interaction
a. When trying to navigate through charts and other options of the dashboard
via Tab button, it doesnt focus on the available areas of the dashboard. 
Like navigating to charts and the Ellipsis button for exporting the 
chart/questions of a dashboard.
b. When the cursor hovers over a chart, and then we click on the Tab button 
then the Ellipsis button of that question/chart only gets focussed. If we try 
to navigate to the ellipsis button of other charts it doesn't get focussed

Voice Over interaction.
a. It is reading Document sign as an image and Export as PDF text 
separately when we try to load the HTML page. This is part of Export as 
PDF button.
Since keyboard interaction is limited as per above point, voice over also 
not able to go through Charts


**Describe alternatives you've considered**
N/A

**How important is this feature to you?**
Requested by a customer, internal ticket [here](https://app.usepylon.com/issues/views/a99c7d49-0fac-40e9-8fab-6352c41dc7de?conversationID=334099c0-9be3-4c55-b9b1-06b761d50b8e)

**Additional context**
Related to this PR: ",ignacio-mb,2024-12-24 14:11:43+00:00,[],2025-02-04 20:30:57+00:00,,https://github.com/metabase/metabase/issues/51652,"[('Type:New Feature', ''), ('Misc/Accessibility', '')]",[],
2756634348,issue,closed,completed,Basic Action Fails if ID Comes from Filter set by Custom Click Behavior,"### Describe the bug

Basic actions fails if they get a value from a dashboard filter that was set with custom click behavior.

### To Reproduce

1. Create a model with basic actions enabled
2. Set up a dashboard with a question that contains ID field that also exists in the model
3. Add a dashboard filter for the ID field
4. Add custom click behavior to the card such that the ID filter is updated when the field is selected
5. Add action button to the dashboard that refers to a Basic Action


https://www.loom.com/share/f3082c367166498091e002a75b70f719



### Expected behavior

Click action should work.

### Logs

Cannot run the query: missing required parameters: #{""id""}

### Information about your Metabase installation

```JSON
Works in 49. Busted in 51 and 52.
```

### Severity

Annoying / Possibly blocking

### Additional context

You can technically work around it with a custom action. If someone had actions built prior to upgrade I imagine it would be a pain to have to recreate them. I haven't seen explicit reports of people having to rebuild them, though.",ixipixi,2024-12-23 19:49:19+00:00,[],2024-12-31 14:37:11+00:00,2024-12-31 14:37:10+00:00,https://github.com/metabase/metabase/issues/51644,"[('Type:Bug', 'Product defects'), ('.Needs Triage', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.')]","[{'comment_id': 2561221093, 'issue_id': 2756634348, 'author': 'joeledwardson', 'body': ""Confirmed this is happening for us, this is the version:\n\n```\nThanks for using Metabase!\nYou're on version v1.51.6.5\nBuilt on 2024-12-03\n\nHash: 22b76e9\n```\n\nI would use custom actions but there a couple of features of basic actions I haven't figured out how to replicate in custom actions:\n\n- toggles for booleans\n- copying table data into forms"", 'created_at': datetime.datetime(2024, 12, 24, 15, 12, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2566501103, 'issue_id': 2756634348, 'author': 'paoliniluis', 'body': 'fixed in https://github.com/metabase/metabase/issues/51020', 'created_at': datetime.datetime(2024, 12, 31, 14, 37, 10, tzinfo=datetime.timezone.utc)}]","joeledwardson on (2024-12-24 15:12:59 UTC): Confirmed this is happening for us, this is the version:

```
Thanks for using Metabase!
You're on version v1.51.6.5
Built on 2024-12-03

Hash: 22b76e9
```

I would use custom actions but there a couple of features of basic actions I haven't figured out how to replicate in custom actions:

- toggles for booleans
- copying table data into forms

paoliniluis on (2024-12-31 14:37:10 UTC): fixed in https://github.com/metabase/metabase/issues/51020

"
2756576879,issue,open,,Custom Labels for Trend Visualizations,"**Is your feature request related to a problem? Please describe.**
There are some cases where the generated labels for comparison values in a trend chart don't make sense. One such example is creating arbitrary date range comparisons with the native editor. There's no way to display the actual range of values.

![Image](https://github.com/user-attachments/assets/d2dbe51f-c352-4318-a428-afebb306ed82)

**Describe the solution you'd like**
It would be ideal if we could display the actual ranges in the trend viz or overwrite the labels entirely with custom titles to match the names of the filters.

**How important is this feature to you?**
being able to pass arbitrary ranges and values to the Trend viz often works but the UX presented to end users is generally not great, preventing adoption of some of these use cases.
",ixipixi,2024-12-23 19:01:23+00:00,[],2025-02-04 20:31:53+00:00,,https://github.com/metabase/metabase/issues/51641,"[('Type:New Feature', ''), ('Visualization/Scalars', 'Numbers, progress bars, gauges')]",[],
2756548870,issue,closed,completed,find-outliers,,metamben,2024-12-23 18:36:26+00:00,['johnswanson'],2025-01-21 18:57:30+00:00,2025-01-21 18:57:30+00:00,https://github.com/metabase/metabase/issues/51639,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2756196667,issue,closed,completed,Add new default theme to embedding sdk demo app,Let's add a new Shoppy theme specifically for SaaS / B2B use cases.,heypoom,2024-12-23 14:38:23+00:00,['heypoom'],2025-01-09 13:11:35+00:00,2025-01-09 13:11:35+00:00,https://github.com/metabase/metabase/issues/51629,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2755990411,issue,closed,completed,Errors on Next.js when render combinations of components,"Using this template https://github.com/WiNloSt/next-app-template, when rendering a certain set of components under the same provider I'll get this console error, certain build tools will likely surface this error on the UI leaving a bad impression for the SDK.

Tested using version `0.52.6`

### The error
```
NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.
```

![Image](https://github.com/user-attachments/assets/bc0e1f43-69a3-46a9-83fe-114a0025bc9d)

#### Example combinations that show this error
- `InteractiveQuestion` + `StaticQuestion`
- `StaticQuestion` + `InteractiveDashboard`


#### Example combinations without the error
- `InteractiveQuestion` + `InteractiveDashboard`
- `InteractiveDashboard` + `StaticDashboard`
- `InteractiveDashboard` + `EditableDashboard`",WiNloSt,2024-12-23 12:36:57+00:00,['npretto'],2025-02-05 17:23:33+00:00,2025-02-05 14:36:16+00:00,https://github.com/metabase/metabase/issues/51628,"[('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2614938929, 'issue_id': 2755990411, 'author': 'heypoom', 'body': ""Unassigning for now since I'm still on other task, for visibility."", 'created_at': datetime.datetime(2025, 1, 27, 6, 27, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2630839007, 'issue_id': 2755990411, 'author': 'npretto', 'body': ""From my testing this bug shows up when we render ~two~ a `TableInteractive` component~s~.\nOnly on app router, even without strict mode.\nIn prod mode it shows in the console but doesn't break the entire app."", 'created_at': datetime.datetime(2025, 2, 3, 12, 40, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2637563864, 'issue_id': 2755990411, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)', 'created_at': datetime.datetime(2025, 2, 5, 17, 23, 31, tzinfo=datetime.timezone.utc)}]","heypoom on (2025-01-27 06:27:51 UTC): Unassigning for now since I'm still on other task, for visibility.

npretto (Assginee) on (2025-02-03 12:40:54 UTC): From my testing this bug shows up when we render ~two~ a `TableInteractive` component~s~.
Only on app router, even without strict mode.
In prod mode it shows in the console but doesn't break the entire app.

github-actions[bot] on (2025-02-05 17:23:31 UTC):  This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)

"
2755816224,issue,open,,Control the options shown in the Time Grouping Filter based on the Date Filter or trigger an event on Date Filter change that sets the time grouping,"**Is your feature request related to a problem? Please describe.**

Right now if you have a combination of Time Grouping with Date Filter it can make extracted results confusing if output values exceed 10000 limit on dashbaord. Take the following example where you have 2 filter:

![Image](https://github.com/user-attachments/assets/210d81e5-d936-4d36-b832-9ce055ee6648)

Let's take the above example and have Filter to Day and a Time Grouping by minute a max of `60*24` points will be shown. but if a user changes that date to past year, the time grouping is still set to minute, suddenly that smashes through to `365*24*60`, which is way above 10k limit to display in a chart

So the graph is trimmed to 10k rows and its not really obvious because theres no warning like you get on a Question level:

![Image](https://github.com/user-attachments/assets/611028b7-194a-4c5d-b1fd-47058250aadb)

**Describe the solution you'd like**
To the very least there would be a warning somewhere about the truncated data. Or a more complex approach would be to control the Time Grouping based on the Date Filter. So that if you select a Year worth of Data then you will only give Day grouping or Month Grouping as options in the Time grouping filter

 
**Describe alternatives you've considered**
None that I can think of

",Tony-metabase,2024-12-23 11:11:36+00:00,[],2025-02-04 20:29:42+00:00,,https://github.com/metabase/metabase/issues/51626,"[('Reporting/Dashboards/Filters & Parameters', 'Related to the setup and use of filters and parameters in dashboards only')]",[],
2755513289,issue,open,,Embedded dashboard with locked filters doesn't fill dropdown options,"Hello, 

We are experiencing issues that the dropdown filter doesn't get populated with data. This only happens in the embedded dashboards, on metabase itself the dropdowns do get populated.

On metabase:
![Image](https://github.com/user-attachments/assets/e3b0eea6-fa64-4077-a473-cfb879d98005)

Embedded:
![Image](https://github.com/user-attachments/assets/5a2a2dd3-da14-4166-8b29-3b73af356774)

The ContainerID is a locked filter, so we don't see it on the embedded dashboards, but when I change that to  be editable, then suddenly the dropdowns do get populated when embedded. 
Embedded with editable filter:
![Image](https://github.com/user-attachments/assets/3ced8d40-fe55-45e6-a948-f343d5a83233)

So to me it seems like the issue comes from the locked filter, which then somehow can't be used as a linked filter?

**Severity**
Some filter options are complex for the user to type out, so these can't be used at all now. This stops some of our users from using the dashboards at all.

Some info,
We have had this issue when we were running on version 41.2, but have also updated a few weeks ago to version 52.2, and still running against that same issue.

The container ID is a linked filter for the StandardProduct dropdown
All filters are field filters, from connected fields.

Edit on 15-1-2025, Possibly related log line after trying to get a dashboard with the locked filters:

`[817f1fdd-a289-45f2-b95d-9594dc8082a7] 2025-01-15T14:55:18+01:00 ERROR metabase.query-processor.streaming Client closed connection prematurely,org.eclipse.jetty.io.EofException,	at org.eclipse.jetty.io.SocketChannelEndPoint.flush(SocketChannelEndPoint.java:116),	at org.eclipse.jetty.io.WriteFlusher.flush(WriteFlusher.java:422),	at org.eclipse.jetty.io.WriteFlusher.write(WriteFlusher.java:275),	at org.eclipse.jetty.io.WriteFlusher.write(WriteFlusher.java:254),	at org.eclipse.jetty.io.AbstractEndPoint.write(AbstractEndPoint.java:386),	at org.eclipse.jetty.server.HttpConnection$SendCallback.process(HttpConnection.java:849),	at org.eclipse.jetty.util.IteratingCallback.processing(IteratingCallback.java:243),	at org.eclipse.jetty.util.IteratingCallback.iterate(IteratingCallback.java:224),	at org.eclipse.jetty.server.HttpConnection.send(HttpConnection.java:600),	at org.eclipse.jetty.server.HttpChannel.sendResponse(HttpChannel.java:1051),	at org.eclipse.jetty.server.HttpChannel.write(HttpChannel.java:1123),	at org.eclipse.jetty.server.HttpOutput.channelWrite(HttpOutput.java:270),	at org.eclipse.jetty.server.HttpOutput.close(HttpOutput.java:623),	at java.base/java.util.zip.DeflaterOutputStream.close(Unknown Source),	at metabase.async.streaming_response$delay_output_stream$fn__53454.invoke(streaming_response.clj:130),	at metabase.async.streaming_response.proxy$java.io.OutputStream$ff19274a.close(Unknown Source),	at java.base/sun.nio.cs.StreamEncoder.implClose(Unknown Source),	at java.base/sun.nio.cs.StreamEncoder.lockedClose(Unknown Source),	at java.base/sun.nio.cs.StreamEncoder.close(Unknown Source),	at java.base/java.io.OutputStreamWriter.close(Unknown Source),	at java.base/java.io.BufferedWriter.implClose(Unknown Source),	at java.base/java.io.BufferedWriter.close(Unknown Source),	at com.fasterxml.jackson.core.json.WriterBasedJsonGenerator.close(WriterBasedJsonGenerator.java:1033),	at metabase.query_processor.streaming.json$fn$reify__82188.finish_BANG_(json.clj:154),	at metabase.query_processor.streaming$streaming_result_fn83083__83084$result__83085$fn__83086.invoke(streaming.clj:153),	at metabase.query_processor.streaming$streaming_result_fn83083__83084$result__83085.invoke(streaming.clj:152),	at clojure.core$comp$fn__5895.invoke(core.clj:2586),	at metabase.query_processor.pipeline$_STAR_reduce_STAR_.invokeStatic(pipeline.clj:86),	at metabase.query_processor.pipeline$_STAR_reduce_STAR_.invoke(pipeline.clj:54),	at metabase.query_processor.pipeline$_STAR_run_STAR_$respond__62619.invoke(pipeline.clj:100),	at metabase.driver.sql_jdbc.execute$execute_reducible_query$fn__87558.invoke(execute.clj:725),	at metabase.driver.sql_jdbc.execute$fn__87362$fn__87363.invoke(execute.clj:398),	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87332__87333.invokeStatic(execute.clj:338),	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87332__87333.invoke(execute.clj:321),	at metabase.driver.sql_jdbc.execute$fn__87362.invokeStatic(execute.clj:392),	at metabase.driver.sql_jdbc.execute$fn__87362.invoke(execute.clj:390),	at clojure.lang.MultiFn.invoke(MultiFn.java:244),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694),	at metabase.driver.sql_jdbc$fn__115586.invokeStatic(sql_jdbc.clj:79),	at metabase.driver.sql_jdbc$fn__115586.invoke(sql_jdbc.clj:77),	at clojure.lang.MultiFn.invoke(MultiFn.java:244),	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52),	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39),	at metabase.query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102),	at metabase.query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95),	at metabase.query_processor.execute$run.invokeStatic(execute.clj:62),	at metabase.query_processor.execute$run.invoke(execute.clj:56),	at metabase.query_processor.middleware.update_used_cards$update_used_cards_BANG_75913__75914$fn__75915.invoke(update_used_cards.clj:60),	at metabase.query_processor.execute$add_native_form_to_result_metadata$fn__75930.invoke(execute.clj:25),	at metabase.query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__75936.invoke(execute.clj:36),	at metabase.query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___75886.invoke(cache.clj:241),	at metabase.query_processor.middleware.permissions$check_query_permissions$fn__72591.invoke(permissions.clj:148),	at metabase.query_processor.middleware.enterprise$check_download_permissions_middleware$fn__73312.invoke(enterprise.clj:51),	at metabase.query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__73322.invoke(enterprise.clj:64),	at metabase.query_processor.execute$execute75963__75964$fn__75965.invoke(execute.clj:94),	at metabase.query_processor.setup$do_with_qp_setup73837__73838.invokeStatic(setup.clj:225),	at metabase.query_processor.setup$do_with_qp_setup73837__73838.invoke(setup.clj:216),	at metabase.query_processor.execute$execute75963__75964.invokeStatic(execute.clj:93),	at metabase.query_processor.execute$execute75963__75964.invoke(execute.clj:89),	at metabase.query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49),	at metabase.query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44),	at metabase.query_processor.middleware.enterprise$fn__73339$handle_audit_app_internal_queries__73340$fn__73342.invoke(enterprise.clj:96),	at metabase.query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__73350.invoke(enterprise.clj:103),	at metabase.query_processor.middleware.process_userland_query$process_userland_query_middleware78395__78396$fn__78397.invoke(process_userland_query.clj:204),	at metabase.query_processor.middleware.catch_exceptions$catch_exceptions78460__78461$fn__78462.invoke(catch_exceptions.clj:132),	at metabase.query_processor$process_query78501__78502$fn__78503.invoke(query_processor.clj:80),	at metabase.query_processor.setup$do_with_canceled_chan73832__73833$fn__73834.invoke(setup.clj:187),	at metabase.query_processor.setup$do_with_database_local_settings73825__73826$fn__73827.invoke(setup.clj:181),	at metabase.query_processor.setup$do_with_driver73818__73819$fn__73820$fn__73821.invoke(setup.clj:166),	at metabase.driver$do_with_driver.invokeStatic(driver.clj:106),	at metabase.driver$do_with_driver.invoke(driver.clj:101),	at metabase.query_processor.setup$do_with_driver73818__73819$fn__73820.invoke(setup.clj:165),	at metabase.query_processor.setup$do_with_metadata_provider73809__73810$fn__73811$fn__73814.invoke(setup.clj:151),	at metabase.query_processor.store$do_with_metadata_provider59778__59779.invokeStatic(store.clj:170),	at metabase.query_processor.store$do_with_metadata_provider59778__59779.invoke(store.clj:150),	at metabase.query_processor.store$do_with_metadata_provider59778__59779.invokeStatic(store.clj:159),	at metabase.query_processor.store$do_with_metadata_provider59778__59779.invoke(store.clj:150),	at metabase.query_processor.setup$do_with_metadata_provider73809__73810$fn__73811.invoke(setup.clj:150),	at metabase.query_processor.setup$do_with_resolved_database73799__73800$fn__73801.invoke(setup.clj:128),	at metabase.query_processor.setup$do_with_qp_setup73837__73838.invokeStatic(setup.clj:232),	at metabase.query_processor.setup$do_with_qp_setup73837__73838.invoke(setup.clj:216),	at metabase.query_processor$process_query78501__78502.invokeStatic(query_processor.clj:78),	at metabase.query_processor$process_query78501__78502.invoke(query_processor.clj:71),	at metabase.query_processor.card$process_query_for_card_default_qp89390__89391.invokeStatic(card.clj:233),	at metabase.query_processor.card$process_query_for_card_default_qp89390__89391.invoke(card.clj:229),	at metabase.api.public$process_query_for_card_with_id_run_fn$run__103345$fn__103346$fn__103347.invoke(public.clj:140),	at metabase.server.middleware.session$do_with_current_user.invokeStatic(session.clj:438),	at metabase.server.middleware.session$do_with_current_user.invoke(session.clj:421),	at metabase.api.public$process_query_for_card_with_id_run_fn$run__103345$fn__103346.invoke(public.clj:139),	at metabase.query_processor.streaming$_streaming_response$fn__83097$fn__83098$fn__83099.invoke(streaming.clj:185),	at metabase.query_processor.streaming$_streaming_response$fn__83097$fn__83098.invoke(streaming.clj:183),	at metabase.query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:174),	at metabase.query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:161),	at metabase.query_processor.streaming$_streaming_response$fn__83097.invoke(streaming.clj:180),	at clojure.lang.AFn.applyToHelper(AFn.java:156),	at clojure.lang.AFn.applyTo(AFn.java:144),	at clojure.core$apply.invokeStatic(core.clj:667),	at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1990),	at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1990),	at clojure.lang.RestFn.applyTo(RestFn.java:145),	at clojure.core$apply.invokeStatic(core.clj:671),	at clojure.core$bound_fn_STAR_$fn__5837.doInvoke(core.clj:2020),	at clojure.lang.RestFn.invoke(RestFn.java:424),	at metabase.async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78),	at metabase.async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76),	at metabase.async.streaming_response$do_f_async$task__53439.invoke(streaming_response.clj:97),	at clojure.lang.AFn.run(AFn.java:22),	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source),	at java.base/java.util.concurrent.FutureTask.run(Unknown Source),	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source),	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source),	at java.base/java.lang.Thread.run(Unknown Source),Caused by: java.io.IOException: Broken pipe,	at java.base/sun.nio.ch.SocketDispatcher.writev0(Native Method),	at java.base/sun.nio.ch.SocketDispatcher.writev(Unknown Source),	at java.base/sun.nio.ch.IOUtil.write(Unknown Source),	at java.base/sun.nio.ch.IOUtil.write(Unknown Source),	at java.base/sun.nio.ch.SocketChannelImpl.write(Unknown Source),	at java.base/java.nio.channels.SocketChannel.write(Unknown Source),	at org.eclipse.jetty.io.SocketChannelEndPoint.flush(SocketChannelEndPoint.java:110),	... 114 more
`

Diagnostic info:
`{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""sqlserver""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-09"",
      ""tag"": ""v0.52.2"",
      ""hash"": ""32effb1""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Amsterdam""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.20""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-1073-azure"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}`",IsThisOriginalEnough,2024-12-23 08:32:32+00:00,[],2025-02-07 10:03:10+00:00,,https://github.com/metabase/metabase/issues/51622,[],"[{'comment_id': 2559661245, 'issue_id': 2755513289, 'author': 'fer-batista', 'body': 'I use embedded dashboards with hidden fields and I faced this issue.\nIn my case, I solved it by setting the field to ""a list of all values"".\n\nGo to Admin -> Table Metadata -> Database -> Schema -> Table -> Find your field and click on the gear icon -> Change the ""Filtering on this field"" to ""a list of all values"".\n\nYou need to do this for all tables that use this field in your dashboard.', 'created_at': datetime.datetime(2024, 12, 23, 12, 56, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2559712604, 'issue_id': 2755513289, 'author': 'IsThisOriginalEnough', 'body': 'Thanks for the reply, it was ""Search box"" before, changed it to ""A list of all values"", rescanned the field but no luck sadly.', 'created_at': datetime.datetime(2024, 12, 23, 13, 28, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2559744213, 'issue_id': 2755513289, 'author': 'fer-batista', 'body': 'Confirm if you also changed the field filter in the dashboard to ""Dropdown""', 'created_at': datetime.datetime(2024, 12, 23, 13, 48, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2559755333, 'issue_id': 2755513289, 'author': 'IsThisOriginalEnough', 'body': ""Hmm it was already a dropdown there. So I've checked it when both are dropdown, and when both are search box just in case, but no luck.\nI wouldn't think the issue is in the filter options, as the other dropdowns do get populated when I test my embedded dashboard when I make my hidden filter editable."", 'created_at': datetime.datetime(2024, 12, 23, 13, 56, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2594787668, 'issue_id': 2755513289, 'author': 'IsThisOriginalEnough', 'body': ""I have also made a post on the forum: https://discourse.metabase.com/t/embedded-dashboard-with-locked-filters-doesnt-fill-dropdown-options/197598 \n\nBut it seems like the behaviour was changed in sending filter options through the JWT. Now these filter options are automatically used as a linked filter for the other filter options, even though in the dashboard we don't specify it that way. Not sure if that is intended behaviour or not, but for us this breaks some filter options which are not necessarily linked to filters sent through the JWT."", 'created_at': datetime.datetime(2025, 1, 16, 8, 13, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2642478590, 'issue_id': 2755513289, 'author': 'zierler', 'body': 'I have the same issue on v0.53.1. Thanks for analyzing it, I can reproduce everything you said.', 'created_at': datetime.datetime(2025, 2, 7, 10, 3, 9, tzinfo=datetime.timezone.utc)}]","fer-batista on (2024-12-23 12:56:29 UTC): I use embedded dashboards with hidden fields and I faced this issue.
In my case, I solved it by setting the field to ""a list of all values"".

Go to Admin -> Table Metadata -> Database -> Schema -> Table -> Find your field and click on the gear icon -> Change the ""Filtering on this field"" to ""a list of all values"".

You need to do this for all tables that use this field in your dashboard.

IsThisOriginalEnough (Issue Creator) on (2024-12-23 13:28:33 UTC): Thanks for the reply, it was ""Search box"" before, changed it to ""A list of all values"", rescanned the field but no luck sadly.

fer-batista on (2024-12-23 13:48:58 UTC): Confirm if you also changed the field filter in the dashboard to ""Dropdown""

IsThisOriginalEnough (Issue Creator) on (2024-12-23 13:56:12 UTC): Hmm it was already a dropdown there. So I've checked it when both are dropdown, and when both are search box just in case, but no luck.
I wouldn't think the issue is in the filter options, as the other dropdowns do get populated when I test my embedded dashboard when I make my hidden filter editable.

IsThisOriginalEnough (Issue Creator) on (2025-01-16 08:13:33 UTC): I have also made a post on the forum: https://discourse.metabase.com/t/embedded-dashboard-with-locked-filters-doesnt-fill-dropdown-options/197598 

But it seems like the behaviour was changed in sending filter options through the JWT. Now these filter options are automatically used as a linked filter for the other filter options, even though in the dashboard we don't specify it that way. Not sure if that is intended behaviour or not, but for us this breaks some filter options which are not necessarily linked to filters sent through the JWT.

zierler on (2025-02-07 10:03:09 UTC): I have the same issue on v0.53.1. Thanks for analyzing it, I can reproduce everything you said.

"
2755204424,issue,open,,Download csv does not respect config limit if the query's limit exceeds it,"### Describe the bug

In https://github.com/metabase/metabase/pull/46401 we introduced the `MB_DOWNLOAD_ROW_LIMIT` environment to set row limit when download alert / subscription attachments.

But if you have a query that has a limit that exceeds the env var limit, the download limit will be query's limit, not the env var limit.

### To Reproduce

1. Start MB with `MB_DOWNLOAD_ROW_LIMIT=10`
2. Set up email
3. Create a question on orders table with limit = 20 and save it
4. Add it to a dashboard
5. Create a dashboard subscription with attachments included
6. Send test it
7. Check the attachments, you'll see the the csv has 20 rows

### Expected behavior

the limit should be `(min question-limit download-row-limit)`, which is 10 in the above example

### Logs

_No response_

### Information about your Metabase installation

```JSON
master
```

### Severity

P2?

### Additional context

_No response_",qnkhuat,2024-12-23 04:42:33+00:00,[],2025-02-04 20:29:34+00:00,,https://github.com/metabase/metabase/issues/51620,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Export', ''), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2754415951,issue,closed,completed,Link Checker Report,"[Full Github Actions output](https://github.com/metabase/metabase/actions/runs/12449588918?check_suite_focus=true)
",github-actions[bot],2024-12-22 00:19:50+00:00,['jeff-bruemmer'],2024-12-23 15:25:17+00:00,2024-12-23 15:25:17+00:00,https://github.com/metabase/metabase/issues/51619,"[('Type:Documentation', '')]",[],
2754139749,issue,open,,Expressions Out of Order,"### Describe the bug

Description: custom column(expressions) disorder, when total columns reaching 9



### To Reproduce
1. Create New Question, From Sample Database / Accounts
2.  add custom column from c0 to c9
(like case([ID] = ""1"", ""2"")), After adding c8, out-of-order issues occur.


![Image](https://github.com/user-attachments/assets/94cd64bc-05d4-4780-b993-6a386b3d8e52)
Sorting becomes disordered after adding a new column, total columns reaching 9
![Image](https://github.com/user-attachments/assets/b68f365d-0cad-48c5-a5e6-8a74703abef7)


### Expected behavior

The expected behavior is that the displayed order should match the order in which the columns were added.

### Logs

_No response_

### Information about your Metabase installation

```JSON
Environment:
OS: [e.g.,Ubuntu]
Version: [e.g., v0.52.3]
```

### Severity

annoying

### Additional context

Other relevant environment details: 
After reviewing the source code, I discovered that the issue is caused by using into {} to assemble :expression. The resulting HashMap is unordered, which leads to the problem. Do you have any suggestions for improving this? Also, if possible, could I be assigned to fix this issue?",a78239636,2024-12-21 15:19:18+00:00,[],2025-02-04 20:27:13+00:00,,https://github.com/metabase/metabase/issues/51614,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/MBQL', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2558175589, 'issue_id': 2754139749, 'author': 'paoliniluis', 'body': '@a78239636 please upgrade to 52 and let us know if you see it there', 'created_at': datetime.datetime(2024, 12, 21, 17, 5, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2558265445, 'issue_id': 2754139749, 'author': 'a78239636', 'body': '@paoliniluis Hi, I was able to reproduce this issue on the latest version (0.52.3)\n\nAdditionally, I found that this issue has hidden risks. When custom column A depends on custom column B, an incorrect order might cause the custom column to fail.""\n\nInit: \n![Image](https://github.com/user-attachments/assets/0908da49-a7d6-4356-b3df-b0c00bc5f97f)\n\nwhen total columns reaching 9\n![Image](https://github.com/user-attachments/assets/286e560b-321a-42ff-9938-c8fc856e1aff)', 'created_at': datetime.datetime(2024, 12, 21, 23, 18, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2558629832, 'issue_id': 2754139749, 'author': 'paoliniluis', 'body': '@a78239636 can you give us exact steps about how to reproduce?', 'created_at': datetime.datetime(2024, 12, 22, 22, 37, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2562183770, 'issue_id': 2754139749, 'author': 'a78239636', 'body': ""@paoliniluis Hi, I've added the missing information, and this issue seems more complicated than I initially thought."", 'created_at': datetime.datetime(2024, 12, 26, 5, 49, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2569293434, 'issue_id': 2754139749, 'author': 'ranquild', 'body': 'MBQL lib bug; related to how clojure maps work.', 'created_at': datetime.datetime(2025, 1, 3, 14, 23, 38, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-21 17:05:29 UTC): @a78239636 please upgrade to 52 and let us know if you see it there

a78239636 (Issue Creator) on (2024-12-21 23:18:03 UTC): @paoliniluis Hi, I was able to reproduce this issue on the latest version (0.52.3)

Additionally, I found that this issue has hidden risks. When custom column A depends on custom column B, an incorrect order might cause the custom column to fail.""

Init: 
![Image](https://github.com/user-attachments/assets/0908da49-a7d6-4356-b3df-b0c00bc5f97f)

when total columns reaching 9
![Image](https://github.com/user-attachments/assets/286e560b-321a-42ff-9938-c8fc856e1aff)

paoliniluis on (2024-12-22 22:37:28 UTC): @a78239636 can you give us exact steps about how to reproduce?

a78239636 (Issue Creator) on (2024-12-26 05:49:22 UTC): @paoliniluis Hi, I've added the missing information, and this issue seems more complicated than I initially thought.

ranquild on (2025-01-03 14:23:38 UTC): MBQL lib bug; related to how clojure maps work.

"
2753851604,issue,closed,completed,PDF can't show whole data. The rightmost part is cut off.,"### Describe the bug

I export tab as PDF. This PDF can't show whole data. The rightmost part is cut off. The last page is displayed normally.

### To Reproduce

1. Go to 'a big whole dashboard '
2. Click on 'edict dashboard', export tab as PDF. 
3. Check the PDF (more than one page) The rightmost part of the first few pages is cut off. The last page is displayed normally. 



### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
no idea
```

### Severity

blocking some users

### Additional context

_No response_",JessieLiuz,2024-12-21 08:57:18+00:00,[],2024-12-23 14:08:32+00:00,2024-12-23 14:08:31+00:00,https://github.com/metabase/metabase/issues/51612,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2559776823, 'issue_id': 2753851604, 'author': 'cdeweyx', 'body': 'Fixed with https://github.com/metabase/metabase/pull/51491 cc: @alxnddr', 'created_at': datetime.datetime(2024, 12, 23, 14, 8, 31, tzinfo=datetime.timezone.utc)}]","cdeweyx on (2024-12-23 14:08:31 UTC): Fixed with https://github.com/metabase/metabase/pull/51491 cc: @alxnddr

"
2753613539,issue,closed,not_planned,Support encrypted RSA private key on Snowflake connection,"**Is your feature request related to a problem? Please describe.**
Snowflake recommends to use encrypted RSA private keys, which is not yet supported. [Reference](https://docs.snowflake.com/en/user-guide/key-pair-auth)

**Describe the solution you'd like**
When creating a new database connection to snowflake, if the user provides **both** the RSA key file and a password, then metabase could automatically infer that the password is the private key pass phrase (as a benchmark, this is exactly what [Airflow](https://www.astronomer.io/docs/learn/connections/snowflake/) does, when adding a conection to snowflake). Alternatively, we could use an field `Private key pass phrase`.

**Describe alternatives you've considered**
N/A

**How important is this feature to you?**
I would guess this is not an urgent matter. I'm currently using non encrypted RSA keys. But I think it should be fine to support encrypted RSA keys at some point, since metabase uses JDBC driver, which already support it.

**Additional context**
Error message when uploading an encrypted RSA key file:

![Image](https://github.com/user-attachments/assets/11d13717-bf33-4015-86ea-bb503cd017b4)

",vicmayrink,2024-12-20 23:07:33+00:00,[],2024-12-21 00:06:37+00:00,2024-12-21 00:06:36+00:00,https://github.com/metabase/metabase/issues/51604,"[('Type:New Feature', ''), ('.Needs Triage', '')]","[{'comment_id': 2557900121, 'issue_id': 2753613539, 'author': 'paoliniluis', 'body': 'Check https://github.com/metabase/metabase/issues/51057', 'created_at': datetime.datetime(2024, 12, 21, 0, 6, 36, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-21 00:06:36 UTC): Check https://github.com/metabase/metabase/issues/51057

"
2753608152,issue,open,,Convert to SQL Button Breaks Queries Using || Concatenate Operator by Inserting Invalid Spaces,"### Describe the bug

Using the ""Convert to SQL"" button on a report or model derived from a SQL query that uses the || concatenate operator results in an invalid query due to incorrect insertion of spaces between the vertical bars, even though the original query runs successfully. This issue occurs when the report is created from a saved report or model that uses the || operator.

### To Reproduce

1. Create a simple question using a query that uses the concatenate operator ( || )
`SELECT 'Hello' || ' ' || 'world' AS ""Test""`
<img width=""328"" alt=""Image"" src=""https://github.com/user-attachments/assets/b51775ff-79d5-4797-9771-1ad68e3fe883"" />


<br>

2. Create a new question based on the first question, save and visualize to confirm it works.

<br>

3. Click on ""View the SQL"" button to see the generated SQL, and notice there's a space between the concatenate operator. 

<br>

4. Click on ""Convert this question to SQL"" from the editor and receive the error.<img width=""965"" alt=""Image"" src=""https://github.com/user-attachments/assets/9b61bf72-1ac7-4a2d-8b75-f83d6c0090ff"" />


### Expected behavior

For the concatenate operator to not have a space that leads to the generation of the error.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""snowflake"",
      ""postgres"",
      ""h2"",
      ""mysql"",
      ""mongo"",
      ""bigquery-cloud-sdk""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-12-14"",
      ""tag"": ""v1.52.3"",
      ""hash"": ""6f76bb6""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.3""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.22+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.22"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.22+7"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""14.5"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Chicago""
  }
}
```

### Severity

P2

### Additional context

_No response_",FilmonK,2024-12-20 23:00:16+00:00,[],2025-02-04 20:28:31+00:00,,https://github.com/metabase/metabase/issues/51603,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Native', 'The SQL/native query editor'), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2586999849, 'issue_id': 2753608152, 'author': 'wvengen', 'body': 'Looks like it could be related to #36175.', 'created_at': datetime.datetime(2025, 1, 13, 12, 39, 45, tzinfo=datetime.timezone.utc)}]","wvengen on (2025-01-13 12:39:45 UTC): Looks like it could be related to #36175.

"
2753528746,issue,open,,[BE] Exports bugs cluster,"[Bug board](https://github.com/orgs/metabase/projects/106/views/1)

Claster of backend bugs related to data exports.

- https://github.com/metabase/metabase/issues/49977
- https://github.com/metabase/metabase/issues/51342
- https://github.com/metabase/metabase/issues/49957
- https://github.com/metabase/metabase/issues/40492
- https://github.com/metabase/metabase/issues/42115
- https://github.com/metabase/metabase/issues/40670
- https://github.com/metabase/metabase/issues/30622

",alxnddr,2024-12-20 21:51:19+00:00,[],2025-02-04 20:29:33+00:00,,https://github.com/metabase/metabase/issues/51601,"[('Reporting/Export', ''), ('.Backend', ''), ('.Epic', 'Feature Implementation or Project'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2753522371,issue,open,,[BE] Subscriptions bugs cluster,"[Bug board](https://github.com/orgs/metabase/projects/106/views/1)

Cluster of backend bugs related to dashboard subscriptions and question alerts.

- https://github.com/metabase/metabase/issues/29277
- https://github.com/metabase/metabase/issues/39021
- https://github.com/metabase/metabase/issues/47497
- https://github.com/metabase/metabase/issues/35955
- https://github.com/metabase/metabase/issues/47949
- https://github.com/metabase/metabase/issues/6874
- https://github.com/metabase/metabase/issues/11426
- https://github.com/metabase/metabase/issues/24651
- https://github.com/metabase/metabase/issues/43638",alxnddr,2024-12-20 21:44:37+00:00,['tsplude'],2025-02-04 20:29:32+00:00,,https://github.com/metabase/metabase/issues/51600,"[('Reporting/Pulses', 'Now called Subscriptions'), ('.Backend', ''), ('.Epic', 'Feature Implementation or Project'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2753235486,issue,closed,duplicate,duplicate issue ignore,"### Links

- [product doc](https://www.notion.so/metabase/Support-stable-IDs-in-interactive-embedding-1f99db58da9945218519cbbc40de0175)
- [technical design doc](https://www.notion.so/metabase/Tech-Support-stable-IDs-in-interactive-embedding-16169354c90180898ca9c6509febd0de)
- [testing plan](https://www.notion.so/metabase/Tech-Support-stable-IDs-in-interactive-embedding-16169354c90180898ca9c6509febd0de?pvs=4#16169354c90181fdb5aff23b1d949bc8)
- feature branch: `stable-ids-core-app`


### Implementation Plan
Because this will be done with a route helper, it should be possible to do everything in one PR

```[tasklist]
#### Milestone 1
- [ ] Create `EntityAwareRoute` and use it to wrap the needed routes
```
",npretto,2024-12-20 18:13:01+00:00,[],2025-01-29 17:19:11+00:00,2025-01-29 17:18:41+00:00,https://github.com/metabase/metabase/issues/51589,[],"[{'comment_id': 2622270200, 'issue_id': 2753235486, 'author': 'npretto', 'body': 'Duplicate of https://github.com/metabase/metabase/issues/52320', 'created_at': datetime.datetime(2025, 1, 29, 17, 15, 5, tzinfo=datetime.timezone.utc)}]","npretto (Issue Creator) on (2025-01-29 17:15:05 UTC): Duplicate of https://github.com/metabase/metabase/issues/52320

"
2752926674,issue,closed,completed,Set up flaky test Webhook,,iethree,2024-12-20 15:10:16+00:00,[],2025-01-03 23:10:03+00:00,2025-01-03 23:10:03+00:00,https://github.com/metabase/metabase/issues/51578,[],[],
2752921189,issue,closed,not_planned,look into testing in dev mode,"instead of building, uploading and downloading  jars, just run from source like we do in local dev",iethree,2024-12-20 15:07:05+00:00,['iethree'],2025-01-17 20:29:46+00:00,2025-01-08 17:24:29+00:00,https://github.com/metabase/metabase/issues/51576,[],[],
2752722083,issue,open,,Pinned questions don't show the verified badge,"In this example, both pinned questions are verified, but the verification badge doesn't appear.

<img src=""https://uploads.linear.app/aa0b7104-d385-47b7-bfc6-015760e1d91e/890a16e1-544f-478f-8dfc-aba41f76b812/1e4682dc-051f-44b3-9644-9d9e0b081ccd?signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXRoIjoiL2FhMGI3MTA0LWQzODUtNDdiNy1iZmM2LTAxNTc2MGUxZDkxZS84OTBhMTZlMS01NDRmLTQ3OGYtOGRmYy1hYmE0MWY3NmI4MTIvMWU0NjgyZGMtMDUxZi00NGIzLTk2NDQtOWQ5ZTBiMDgxY2NkIiwiaWF0IjoxNzM0NzAwNDk5LCJleHAiOjMzMzA1MjYwNDk5fQ.k5wYqbf6pY9JMi9SCg5O0Nu2BUYaYKJh3gX1lf2_LFw "" alt=""image.png"" width=""819"" data-linear-height=""438"" />

v52 / master",luizarakaki,2024-12-20 13:14:59+00:00,[],2025-02-05 19:30:39+00:00,,https://github.com/metabase/metabase/issues/51570,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Organization/Collections', ''), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2752543298,issue,closed,not_planned,ldap freeipa not work,"### Describe the bug

metabase version: 50.1-52.3
ldap server: freeipa

![Image](https://github.com/user-attachments/assets/71454657-f07d-408d-a13e-a21f8ccf6855)
![Image](https://github.com/user-attachments/assets/88e188e5-65f7-44fe-b353-3ff9949d0301)

<details>
<summary> stack trace</summary>


```
2024-12-20 11:13:59,770 ERROR middleware.log :: PUT /api/setting/ldap-group-mappings 500 301ms (2 DB calls) {:metabase-user-id 1} 
2024-12-20T11:13:59.770621381Z {:via
2024-12-20T11:13:59.770627372Z  [{:type java.lang.IllegalArgumentException,
2024-12-20T11:13:59.770630328Z    :message ""metabase_users is not a valid DN."",
2024-12-20T11:13:59.770633223Z    :at [metabase.integrations.ldap$fn__107761$fn__107766 invoke ""ldap.clj"" 120]}],
2024-12-20T11:13:59.770636329Z  :trace
2024-12-20T11:13:59.770639044Z  [[metabase.integrations.ldap$fn__107761$fn__107766 invoke ""ldap.clj"" 120]
2024-12-20T11:13:59.770641850Z   [metabase.models.setting$set_with_audit_logging_BANG_ invokeStatic ""setting.clj"" 927]
2024-12-20T11:13:59.770668440Z   [metabase.models.setting$set_with_audit_logging_BANG_ invoke ""setting.clj"" 915]
2024-12-20T11:13:59.770672378Z   [metabase.models.setting$set_BANG_ invokeStatic ""setting.clj"" 955]
2024-12-20T11:13:59.770675143Z   [metabase.models.setting$set_BANG_ doInvoke ""setting.clj"" 931]
2024-12-20T11:13:59.770677978Z   [clojure.lang.RestFn invoke ""RestFn.java"" 428]
2024-12-20T11:13:59.770681946Z   [metabase.api.setting$fn__106603$fn__106606 invoke ""setting.clj"" 59]
2024-12-20T11:13:59.770684761Z   [metabase.api.setting$do_with_setting_access_control invokeStatic ""setting.clj"" 14]
2024-12-20T11:13:59.770687777Z   [metabase.api.setting$do_with_setting_access_control invoke ""setting.clj"" 10]
2024-12-20T11:13:59.770690622Z   [metabase.api.setting$fn__106603 invokeStatic ""setting.clj"" 58]
2024-12-20T11:13:59.770693388Z   [metabase.api.setting$fn__106603 invoke ""setting.clj"" 53]
2024-12-20T11:13:59.770696173Z   [compojure.core$wrap_response$fn__54217 invoke ""core.clj"" 160]
2024-12-20T11:13:59.770698898Z   [compojure.core$wrap_route_middleware$fn__54201 invoke ""core.clj"" 132]
2024-12-20T11:13:59.770702004Z   [compojure.core$wrap_route_info$fn__54206 invoke ""core.clj"" 139]
2024-12-20T11:13:59.770706553Z   [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 151]
2024-12-20T11:13:59.770711252Z   [clojure.lang.Var invoke ""Var.java"" 395]
2024-12-20T11:13:59.770715770Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770720549Z   [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
2024-12-20T11:13:59.770725088Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770728675Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770732081Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770737762Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770744385Z   [metabase.server.middleware.auth$enforce_authentication$fn__104621 invoke ""auth.clj"" 18]
2024-12-20T11:13:59.770749865Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770754544Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770759263Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770765475Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770770094Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770774773Z   [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
2024-12-20T11:13:59.770779652Z   [compojure.core$make_context$handler__54257 invoke ""core.clj"" 290]
2024-12-20T11:13:59.770784501Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 300]
2024-12-20T11:13:59.770789120Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770801734Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770806463Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770810130Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770814258Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770818556Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.770822974Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.770826852Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770829707Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770832422Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770835939Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770840367Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770844475Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.770848493Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.770852891Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770856959Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770860135Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770862900Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770865635Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770869793Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.770872609Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.770875364Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770878059Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770880754Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770883690Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770886405Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770889140Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.770891976Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.770895202Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770898027Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770900752Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770907856Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770910711Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770913446Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.770916222Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.770919047Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770921762Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770924467Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770927203Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770929908Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770932663Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.770935448Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.770940398Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770943223Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770945918Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770948653Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770951419Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770954154Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.770956919Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.770959644Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770962379Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770965105Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770967920Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770970655Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770973380Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.770976166Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.770978901Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.770981616Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.770984371Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.770987117Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.770989832Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.770993188Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.770999410Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771002295Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771005031Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771007736Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771010451Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771013216Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771015971Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771018777Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771021492Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771024167Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771026832Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771029537Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771032282Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771035038Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771037813Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771040528Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771043213Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771045908Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771048684Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771051389Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771054144Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771056939Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771059725Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771062420Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771065125Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771069363Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771073311Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771078130Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771082418Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771087127Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771097657Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771102536Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771107265Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771111804Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771116092Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771120891Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771125550Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771129968Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771135008Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771139346Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771143594Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771147993Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771152191Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771156649Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771161057Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771165626Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771170285Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771174884Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771179903Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771184542Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771188740Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771192407Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771195182Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771198248Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771202707Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771207095Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771211744Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771216473Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771221052Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771225320Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771237613Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771241951Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771245588Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771249987Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771254535Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771259535Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771264364Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771268762Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771273101Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771277910Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771283019Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771287318Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771291886Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771295263Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771298038Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771300763Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771303559Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771306404Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771309149Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771311874Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771314630Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771317395Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771320110Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771322875Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771325671Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771330139Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771334367Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771338535Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771342873Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771347131Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771351410Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771362511Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771367600Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771372700Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771377139Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771381437Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771386166Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771391265Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771396355Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771400293Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771403699Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771408148Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771412356Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771416564Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771420772Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771424509Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771427264Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771430089Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771432925Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771436722Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771440900Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771445318Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771449767Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771454616Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771459295Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771463453Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771468262Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771473382Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771477650Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771481657Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771484894Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771492548Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771496445Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771536171Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771548404Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771557051Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771564445Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771571338Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771578101Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771585014Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771591576Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771599599Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771615018Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771620328Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771624065Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771627552Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771630958Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771634605Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771638222Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771641829Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771645466Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771648952Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771652389Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771655785Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771659262Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771662719Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771666175Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771669642Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771673068Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771677226Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771682897Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771700881Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771705871Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771711782Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771717302Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771721521Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771725007Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771728484Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771731960Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771735437Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771738413Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771741238Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771744113Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771746849Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771749915Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771752720Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771755515Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771758260Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771761456Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771765634Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771768450Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771771175Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771773980Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771776746Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771779551Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771782396Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771785152Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771787877Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771791744Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771796203Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771800821Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771805140Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771846477Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 301]
2024-12-20T11:13:59.771871004Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771886192Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771899959Z   [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
2024-12-20T11:13:59.771913955Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.771924540Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771938206Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771944348Z   [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
2024-12-20T11:13:59.771949067Z   [clojure.lang.Var invoke ""Var.java"" 395]
2024-12-20T11:13:59.771953435Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771957893Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.771962232Z   [metabase.api.routes$fn__109277$fn__109280 invoke ""routes.clj"" 75]
2024-12-20T11:13:59.771967752Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.771971990Z   [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
2024-12-20T11:13:59.771977511Z   [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
2024-12-20T11:13:59.771981268Z   [clojure.lang.AFn applyTo ""AFn.java"" 144]
2024-12-20T11:13:59.771985806Z   [clojure.core$apply invokeStatic ""core.clj"" 667]
2024-12-20T11:13:59.771990175Z   [clojure.core$apply invoke ""core.clj"" 662]
2024-12-20T11:13:59.771994573Z   [metabase.server.routes$fn__110019$fn__110020 doInvoke ""routes.clj"" 73]
2024-12-20T11:13:59.771998861Z   [clojure.lang.RestFn invoke ""RestFn.java"" 439]
2024-12-20T11:13:59.772002969Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.772007217Z   [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
2024-12-20T11:13:59.772011756Z   [compojure.core$make_context$handler__54257 invoke ""core.clj"" 290]
2024-12-20T11:13:59.772016395Z   [compojure.core$make_context$fn__54261 invoke ""core.clj"" 300]
2024-12-20T11:13:59.772020903Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.772025282Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.772029840Z   [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
2024-12-20T11:13:59.772034128Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.772038346Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.772050900Z   [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
2024-12-20T11:13:59.772055449Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.772059787Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.772064196Z   [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
2024-12-20T11:13:59.772068564Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.772072882Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.772076920Z   [compojure.core$wrap_route_matches$fn__54210 invoke ""core.clj"" 153]
2024-12-20T11:13:59.772081448Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.772085867Z   [compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231 invoke ""core.clj"" 197]
2024-12-20T11:13:59.772090295Z   [metabase.server.routes$fn__110002$fn__110004 invoke ""routes.clj"" 47]
2024-12-20T11:13:59.772094563Z   [compojure.core$routes$fn__54229$f__54230 invoke ""core.clj"" 198]
2024-12-20T11:13:59.772099573Z   [compojure.core$routes$fn__54229 invoke ""core.clj"" 200]
2024-12-20T11:13:59.772103961Z   [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__106746 invoke ""exceptions.clj"" 111]
2024-12-20T11:13:59.772108520Z   [metabase.server.middleware.exceptions$catch_api_exceptions$fn__106743 invoke ""exceptions.clj"" 100]
2024-12-20T11:13:59.772113539Z   [metabase.server.middleware.log$log_api_call$fn__110385$fn__110386$fn__110387 invoke ""log.clj"" 233]
2024-12-20T11:13:59.772118088Z   [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 17]
2024-12-20T11:13:59.772122877Z   [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
2024-12-20T11:13:59.772127777Z   [metabase.server.middleware.log$log_api_call$fn__110385$fn__110386 invoke ""log.clj"" 224]
2024-12-20T11:13:59.772132225Z   [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
2024-12-20T11:13:59.772136303Z   [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
2024-12-20T11:13:59.772140561Z   [metabase.server.middleware.log$log_api_call$fn__110385 invoke ""log.clj"" 223]
2024-12-20T11:13:59.772145280Z   [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__114100 invoke ""browser_cookie.clj"" 40]
2024-12-20T11:13:59.772150239Z   [metabase.server.middleware.security$add_security_headers$fn__106702 invoke ""security.clj"" 273]
2024-12-20T11:13:59.772154828Z   [ring.middleware.json$wrap_json_body$fn__114359 invoke ""json.clj"" 64]
2024-12-20T11:13:59.772159006Z   [metabase.server.middleware.offset_paging$handle_paging$fn__96235 invoke ""offset_paging.clj"" 56]
2024-12-20T11:13:59.772164146Z   [metabase.server.middleware.json$wrap_streamed_json_response$fn__55864 invoke ""json.clj"" 88]
2024-12-20T11:13:59.772176028Z   [ring.middleware.keyword_params$wrap_keyword_params$fn__114448 invoke ""keyword_params.clj"" 55]
2024-12-20T11:13:59.772180427Z   [ring.middleware.params$wrap_params$fn__114467 invoke ""params.clj"" 77]
2024-12-20T11:13:59.772184164Z   [metabase.server.middleware.misc$maybe_set_site_url$fn__70111 invoke ""misc.clj"" 59]
2024-12-20T11:13:59.772187690Z   [metabase.server.middleware.session$reset_session_timeout$fn__72177 invoke ""session.clj"" 566]
2024-12-20T11:13:59.772191478Z   [metabase.server.middleware.session$bind_current_user$fn__72143$fn__72144 invoke ""session.clj"" 459]
2024-12-20T11:13:59.772196287Z   [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 438]
2024-12-20T11:13:59.772200755Z   [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 421]
2024-12-20T11:13:59.772205224Z   [metabase.server.middleware.session$bind_current_user$fn__72143 invoke ""session.clj"" 458]
2024-12-20T11:13:59.772209893Z   [metabase.server.middleware.session$wrap_current_user_info$fn__72120 invoke ""session.clj"" 383]
2024-12-20T11:13:59.772214001Z   [metabase.analytics.sdk$embedding_mw$embedding_mw_fn__78293 invoke ""sdk.clj"" 61]
2024-12-20T11:13:59.772219241Z   [metabase.server.middleware.session$wrap_session_id$fn__72092 invoke ""session.clj"" 261]
2024-12-20T11:13:59.772223609Z   [metabase.server.middleware.auth$wrap_static_api_key$fn__104629 invoke ""auth.clj"" 33]
2024-12-20T11:13:59.772227857Z   [ring.middleware.cookies$wrap_cookies$fn__114287 invoke ""cookies.clj"" 200]
2024-12-20T11:13:59.772232426Z   [metabase.server.middleware.misc$add_content_type$fn__70093 invoke ""misc.clj"" 28]
2024-12-20T11:13:59.772236934Z   [metabase.server.middleware.misc$disable_streaming_buffering$fn__70119 invoke ""misc.clj"" 75]
2024-12-20T11:13:59.772241333Z   [ring.middleware.gzip$wrap_gzip$fn__114329 invoke ""gzip.clj"" 86]
2024-12-20T11:13:59.772245701Z   [metabase.server.middleware.request_id$wrap_request_id$fn__110081 invoke ""request_id.clj"" 9]
2024-12-20T11:13:59.772250219Z   [metabase.server.middleware.misc$bind_request$fn__70122 invoke ""misc.clj"" 91]
2024-12-20T11:13:59.772254518Z   [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__114116 invoke ""ssl.clj"" 41]
2024-12-20T11:13:59.772259076Z   [metabase.server$async_proxy_handler$fn__56833 invoke ""server.clj"" 77]
2024-12-20T11:13:59.772263214Z   [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
2024-12-20T11:13:59.772267172Z   [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
2024-12-20T11:13:59.772271630Z   [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
2024-12-20T11:13:59.772275908Z   [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
2024-12-20T11:13:59.772280808Z   [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
2024-12-20T11:13:59.772285617Z   [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
2024-12-20T11:13:59.772297059Z   [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
2024-12-20T11:13:59.772302088Z   [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
2024-12-20T11:13:59.772306677Z   [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
2024-12-20T11:13:59.772310865Z   [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
2024-12-20T11:13:59.772315273Z   [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
2024-12-20T11:13:59.772319471Z   [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
2024-12-20T11:13:59.772323819Z   [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
2024-12-20T11:13:59.772330332Z   [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
2024-12-20T11:13:59.772335081Z   [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
2024-12-20T11:13:59.772339760Z   [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
2024-12-20T11:13:59.772344489Z   [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
2024-12-20T11:13:59.772349118Z   [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
2024-12-20T11:13:59.772353646Z   [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
2024-12-20T11:13:59.772357924Z   [java.lang.Thread run ""Thread.java"" 1583]],
2024-12-20T11:13:59.772362353Z  :cause ""metabase_users is not a valid DN."",
2024-12-20T11:13:59.772366921Z  :message ""metabase_users is not a valid DN.""}
```
</details>

### To Reproduce

1. fill in the data correctly
2. New mapping
3. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-RU"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-14"",
      ""tag"": ""v0.52.3"",
      ""hash"": ""6f76bb6""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.1""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-alpine-r0"",
    ""java.vendor"": ""Alpine"",
    ""java.vendor.url"": ""https://alpinelinux.org/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-alpine-r0"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

error

### Additional context

_No response_",selfing12,2024-12-20 11:29:46+00:00,[],2025-02-05 14:43:41+00:00,2025-02-05 14:43:41+00:00,https://github.com/metabase/metabase/issues/51564,"[('Administration/Auth', 'Google Auth, LDAP, pw+email login'), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('.Needs Clarification', 'Issue is incomplete or missing actionable information.')]","[{'comment_id': 2556958362, 'issue_id': 2752543298, 'author': 'dpsutton', 'body': '@selfing12 I edited your comment so the stack trace was collapsible. But as you can see from it, it\'s attempting to set those settings, and not liking one of them.\n\nCan you open the network tab and find the payload for `PUT /api/setting/ldap-group-mappings`. For some reason it thinks one of the keys involved is `metabase_users` from the error message ""metabase_users is not a valid DN."".\n\nCan you share a redacted version of the payload of this response?', 'created_at': datetime.datetime(2024, 12, 20, 12, 58, 55, tzinfo=datetime.timezone.utc)}, {'comment_id': 2557240415, 'issue_id': 2752543298, 'author': 'noahmoss', 'body': ""@selfing12 This seems like a configuration issue. You need to use the DN of the LDAP group in the mappings, not just its common name. `metabase_users` isn't a valid DN so the backend rejects the configuration.\n\nPer [the docs](https://www.metabase.com/learn/metabase-basics/administration/permissions/ldap-auth-access-control#group-management):\n> The last step is to tell Metabase how its groups and LDAPs groups are related. If we click on Edit mappings and Create a mapping, we can fill in the distinguished name that identifies the group in LDAPin this case, the DN for the Human Resources group we created earlier\n\nSo, for the example in the docs, you'd use `cn=Human Resources,ou=Groups,dc=metabase,dc=com` instead of just `Human Resources`.\n\nThanks for the report and let us know if this works! This is definitely not intuitive from the UI so we'll discuss internally how to make this clearer."", 'created_at': datetime.datetime(2024, 12, 20, 15, 39, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2581822286, 'issue_id': 2752543298, 'author': 'selfing12', 'body': '@dpsutton \n<details>\n<summary> stack trace</summary>\n\n```JSON\n{\n    ""via"": [\n        {\n            ""type"": ""java.lang.IllegalArgumentException"",\n            ""message"": ""metabase_users is not a valid DN."",\n            ""at"": [\n                ""metabase.integrations.ldap$fn__107761$fn__107766"",\n                ""invoke"",\n                ""ldap.clj"",\n                120\n            ]\n        }\n    ],\n    ""trace"": [\n        [\n            ""metabase.integrations.ldap$fn__107761$fn__107766"",\n            ""invoke"",\n            ""ldap.clj"",\n            120\n        ],\n        [\n            ""metabase.models.setting$set_with_audit_logging_BANG_"",\n            ""invokeStatic"",\n            ""setting.clj"",\n            927\n        ],\n        [\n            ""metabase.models.setting$set_with_audit_logging_BANG_"",\n            ""invoke"",\n            ""setting.clj"",\n            915\n        ],\n        [\n            ""metabase.models.setting$set_BANG_"",\n            ""invokeStatic"",\n            ""setting.clj"",\n            955\n        ],\n        [\n            ""metabase.models.setting$set_BANG_"",\n            ""doInvoke"",\n            ""setting.clj"",\n            931\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            428\n        ],\n        [\n            ""metabase.api.setting$fn__106603$fn__106606"",\n            ""invoke"",\n            ""setting.clj"",\n            59\n        ],\n        [\n            ""metabase.api.setting$do_with_setting_access_control"",\n            ""invokeStatic"",\n            ""setting.clj"",\n            14\n        ],\n        [\n            ""metabase.api.setting$do_with_setting_access_control"",\n            ""invoke"",\n            ""setting.clj"",\n            10\n        ],\n        [\n            ""metabase.api.setting$fn__106603"",\n            ""invokeStatic"",\n            ""setting.clj"",\n            58\n        ],\n        [\n            ""metabase.api.setting$fn__106603"",\n            ""invoke"",\n            ""setting.clj"",\n            53\n        ],\n        [\n            ""compojure.core$wrap_response$fn__54217"",\n            ""invoke"",\n            ""core.clj"",\n            160\n        ],\n        [\n            ""compojure.core$wrap_route_middleware$fn__54201"",\n            ""invoke"",\n            ""core.clj"",\n            132\n        ],\n        [\n            ""compojure.core$wrap_route_info$fn__54206"",\n            ""invoke"",\n            ""core.clj"",\n            139\n        ],\n        [\n            ""compojure.core$wrap_route_matches$fn__54210"",\n            ""invoke"",\n            ""core.clj"",\n            151\n        ],\n        [\n            ""clojure.lang.Var"",\n            ""invoke"",\n            ""Var.java"",\n            395\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229"",\n            ""invoke"",\n            ""core.clj"",\n            200\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""metabase.server.middleware.auth$enforce_authentication$fn__104621"",\n            ""invoke"",\n            ""auth.clj"",\n            18\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229"",\n            ""invoke"",\n            ""core.clj"",\n            200\n        ],\n        [\n            ""compojure.core$make_context$handler__54257"",\n            ""invoke"",\n            ""core.clj"",\n            290\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            300\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            301\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.lang.AFunction$1"",\n            ""doInvoke"",\n            ""AFunction.java"",\n            33\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$wrap_route_matches$fn__54210"",\n            ""invoke"",\n            ""core.clj"",\n            153\n        ],\n        [\n            ""clojure.lang.Var"",\n            ""invoke"",\n            ""Var.java"",\n            395\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""metabase.api.routes$fn__109277$fn__109280"",\n            ""invoke"",\n            ""routes.clj"",\n            75\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229"",\n            ""invoke"",\n            ""core.clj"",\n            200\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyToHelper"",\n            ""AFn.java"",\n            160\n        ],\n        [\n            ""clojure.lang.AFn"",\n            ""applyTo"",\n            ""AFn.java"",\n            144\n        ],\n        [\n            ""clojure.core$apply"",\n            ""invokeStatic"",\n            ""core.clj"",\n            667\n        ],\n        [\n            ""clojure.core$apply"",\n            ""invoke"",\n            ""core.clj"",\n            662\n        ],\n        [\n            ""metabase.server.routes$fn__110019$fn__110020"",\n            ""doInvoke"",\n            ""routes.clj"",\n            73\n        ],\n        [\n            ""clojure.lang.RestFn"",\n            ""invoke"",\n            ""RestFn.java"",\n            439\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229"",\n            ""invoke"",\n            ""core.clj"",\n            200\n        ],\n        [\n            ""compojure.core$make_context$handler__54257"",\n            ""invoke"",\n            ""core.clj"",\n            290\n        ],\n        [\n            ""compojure.core$make_context$fn__54261"",\n            ""invoke"",\n            ""core.clj"",\n            300\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$wrap_route_matches$fn__54210"",\n            ""invoke"",\n            ""core.clj"",\n            153\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$wrap_route_matches$fn__54210"",\n            ""invoke"",\n            ""core.clj"",\n            153\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$wrap_route_matches$fn__54210"",\n            ""invoke"",\n            ""core.clj"",\n            153\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""compojure.core$wrap_route_matches$fn__54210"",\n            ""invoke"",\n            ""core.clj"",\n            153\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",\n            ""invoke"",\n            ""core.clj"",\n            197\n        ],\n        [\n            ""metabase.server.routes$fn__110002$fn__110004"",\n            ""invoke"",\n            ""routes.clj"",\n            47\n        ],\n        [\n            ""compojure.core$routes$fn__54229$f__54230"",\n            ""invoke"",\n            ""core.clj"",\n            198\n        ],\n        [\n            ""compojure.core$routes$fn__54229"",\n            ""invoke"",\n            ""core.clj"",\n            200\n        ],\n        [\n            ""metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__106746"",\n            ""invoke"",\n            ""exceptions.clj"",\n            111\n        ],\n        [\n            ""metabase.server.middleware.exceptions$catch_api_exceptions$fn__106743"",\n            ""invoke"",\n            ""exceptions.clj"",\n            100\n        ],\n        [\n            ""metabase.server.middleware.log$log_api_call$fn__110385$fn__110386$fn__110387"",\n            ""invoke"",\n            ""log.clj"",\n            233\n        ],\n        [\n            ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",\n            ""invokeStatic"",\n            ""diagnostic.clj"",\n            17\n        ],\n        [\n            ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",\n            ""invoke"",\n            ""diagnostic.clj"",\n            12\n        ],\n        [\n            ""metabase.server.middleware.log$log_api_call$fn__110385$fn__110386"",\n            ""invoke"",\n            ""log.clj"",\n            224\n        ],\n        [\n            ""toucan2.execute$do_with_call_counts"",\n            ""invokeStatic"",\n            ""execute.clj"",\n            112\n        ],\n        [\n            ""toucan2.execute$do_with_call_counts"",\n            ""invoke"",\n            ""execute.clj"",\n            103\n        ],\n        [\n            ""metabase.server.middleware.log$log_api_call$fn__110385"",\n            ""invoke"",\n            ""log.clj"",\n            223\n        ],\n        [\n            ""metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__114100"",\n            ""invoke"",\n            ""browser_cookie.clj"",\n            40\n        ],\n        [\n            ""metabase.server.middleware.security$add_security_headers$fn__106702"",\n            ""invoke"",\n            ""security.clj"",\n            273\n        ],\n        [\n            ""ring.middleware.json$wrap_json_body$fn__114359"",\n            ""invoke"",\n            ""json.clj"",\n            64\n        ],\n        [\n            ""metabase.server.middleware.offset_paging$handle_paging$fn__96235"",\n            ""invoke"",\n            ""offset_paging.clj"",\n            56\n        ],\n        [\n            ""metabase.server.middleware.json$wrap_streamed_json_response$fn__55864"",\n            ""invoke"",\n            ""json.clj"",\n            88\n        ],\n        [\n            ""ring.middleware.keyword_params$wrap_keyword_params$fn__114448"",\n            ""invoke"",\n            ""keyword_params.clj"",\n            55\n        ],\n        [\n            ""ring.middleware.params$wrap_params$fn__114467"",\n            ""invoke"",\n            ""params.clj"",\n            77\n        ],\n        [\n            ""metabase.server.middleware.misc$maybe_set_site_url$fn__70111"",\n            ""invoke"",\n            ""misc.clj"",\n            59\n        ],\n        [\n            ""metabase.server.middleware.session$reset_session_timeout$fn__72177"",\n            ""invoke"",\n            ""session.clj"",\n            566\n        ],\n        [\n            ""metabase.server.middleware.session$bind_current_user$fn__72143$fn__72144"",\n            ""invoke"",\n            ""session.clj"",\n            459\n        ],\n        [\n            ""metabase.server.middleware.session$do_with_current_user"",\n            ""invokeStatic"",\n            ""session.clj"",\n            438\n        ],\n        [\n            ""metabase.server.middleware.session$do_with_current_user"",\n            ""invoke"",\n            ""session.clj"",\n            421\n        ],\n        [\n            ""metabase.server.middleware.session$bind_current_user$fn__72143"",\n            ""invoke"",\n            ""session.clj"",\n            458\n        ],\n        [\n            ""metabase.server.middleware.session$wrap_current_user_info$fn__72120"",\n            ""invoke"",\n            ""session.clj"",\n            383\n        ],\n        [\n            ""metabase.analytics.sdk$embedding_mw$embedding_mw_fn__78293"",\n            ""invoke"",\n            ""sdk.clj"",\n            61\n        ],\n        [\n            ""metabase.server.middleware.session$wrap_session_id$fn__72092"",\n            ""invoke"",\n            ""session.clj"",\n            261\n        ],\n        [\n            ""metabase.server.middleware.auth$wrap_static_api_key$fn__104629"",\n            ""invoke"",\n            ""auth.clj"",\n            33\n        ],\n        [\n            ""ring.middleware.cookies$wrap_cookies$fn__114287"",\n            ""invoke"",\n            ""cookies.clj"",\n            200\n        ],\n        [\n            ""metabase.server.middleware.misc$add_content_type$fn__70093"",\n            ""invoke"",\n            ""misc.clj"",\n            28\n        ],\n        [\n            ""metabase.server.middleware.misc$disable_streaming_buffering$fn__70119"",\n            ""invoke"",\n            ""misc.clj"",\n            75\n        ],\n        [\n            ""ring.middleware.gzip$wrap_gzip$fn__114329"",\n            ""invoke"",\n            ""gzip.clj"",\n            86\n        ],\n        [\n            ""metabase.server.middleware.request_id$wrap_request_id$fn__110081"",\n            ""invoke"",\n            ""request_id.clj"",\n            9\n        ],\n        [\n            ""metabase.server.middleware.misc$bind_request$fn__70122"",\n            ""invoke"",\n            ""misc.clj"",\n            91\n        ],\n        [\n            ""metabase.server.middleware.ssl$redirect_to_https_middleware$fn__114116"",\n            ""invoke"",\n            ""ssl.clj"",\n            41\n        ],\n        [\n            ""metabase.server$async_proxy_handler$fn__56833"",\n            ""invoke"",\n            ""server.clj"",\n            77\n        ],\n        [\n            ""metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a"",\n            ""handle"",\n            null,\n            -1\n        ],\n        [\n            ""org.eclipse.jetty.server.handler.StatisticsHandler"",\n            ""handle"",\n            ""StatisticsHandler.java"",\n            173\n        ],\n        [\n            ""org.eclipse.jetty.server.handler.HandlerWrapper"",\n            ""handle"",\n            ""HandlerWrapper.java"",\n            122\n        ],\n        [\n            ""org.eclipse.jetty.server.Server"",\n            ""handle"",\n            ""Server.java"",\n            563\n        ],\n        [\n            ""org.eclipse.jetty.server.HttpChannel$RequestDispatchable"",\n            ""dispatch"",\n            ""HttpChannel.java"",\n            1598\n        ],\n        [\n            ""org.eclipse.jetty.server.HttpChannel"",\n            ""dispatch"",\n            ""HttpChannel.java"",\n            753\n        ],\n        [\n            ""org.eclipse.jetty.server.HttpChannel"",\n            ""handle"",\n            ""HttpChannel.java"",\n            501\n        ],\n        [\n            ""org.eclipse.jetty.server.HttpConnection"",\n            ""onFillable"",\n            ""HttpConnection.java"",\n            287\n        ],\n        [\n            ""org.eclipse.jetty.io.AbstractConnection$ReadCallback"",\n            ""succeeded"",\n            ""AbstractConnection.java"",\n            314\n        ],\n        [\n            ""org.eclipse.jetty.io.FillInterest"",\n            ""fillable"",\n            ""FillInterest.java"",\n            100\n        ],\n        [\n            ""org.eclipse.jetty.io.SelectableChannelEndPoint$1"",\n            ""run"",\n            ""SelectableChannelEndPoint.java"",\n            53\n        ],\n        [\n            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\n            ""runTask"",\n            ""AdaptiveExecutionStrategy.java"",\n            421\n        ],\n        [\n            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\n            ""consumeTask"",\n            ""AdaptiveExecutionStrategy.java"",\n            390\n        ],\n        [\n            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\n            ""tryProduce"",\n            ""AdaptiveExecutionStrategy.java"",\n            277\n        ],\n        [\n            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",\n            ""run"",\n            ""AdaptiveExecutionStrategy.java"",\n            199\n        ],\n        [\n            ""org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread"",\n            ""run"",\n            ""ReservedThreadExecutor.java"",\n            411\n        ],\n        [\n            ""org.eclipse.jetty.util.thread.QueuedThreadPool"",\n            ""runJob"",\n            ""QueuedThreadPool.java"",\n            969\n        ],\n        [\n            ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",\n            ""doRunJob"",\n            ""QueuedThreadPool.java"",\n            1194\n        ],\n        [\n            ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",\n            ""run"",\n            ""QueuedThreadPool.java"",\n            1149\n        ],\n        [\n            ""java.lang.Thread"",\n            ""run"",\n            ""Thread.java"",\n            1583\n        ]\n    ],\n    ""cause"": ""metabase_users is not a valid DN."",\n    ""message"": ""metabase_users is not a valid DN.""\n}\n```\n</details>\n\n\n@noahmoss we use freeipa as an ldap server.\n\nThe documentation says that if the user has a memberOf key, then you do not need to set it. We have such a property\n\n![Image](https://github.com/user-attachments/assets/2f296ae0-d3dc-4ddd-87de-97361e9012ef)', 'created_at': datetime.datetime(2025, 1, 10, 5, 41, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2582382607, 'issue_id': 2752543298, 'author': 'paoliniluis', 'body': 'Thats wrong, you always need to set the group youre mapping', 'created_at': datetime.datetime(2025, 1, 10, 10, 42, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2630135027, 'issue_id': 2752543298, 'author': 'selfing12', 'body': '> Thats wrong, you always need to set the group youre mapping\n\nthis does not negate the fact that when mapping the group correctly, we get an error with DN.Or am I wrong?', 'created_at': datetime.datetime(2025, 2, 3, 7, 7, 38, tzinfo=datetime.timezone.utc)}]","dpsutton on (2024-12-20 12:58:55 UTC): @selfing12 I edited your comment so the stack trace was collapsible. But as you can see from it, it's attempting to set those settings, and not liking one of them.

Can you open the network tab and find the payload for `PUT /api/setting/ldap-group-mappings`. For some reason it thinks one of the keys involved is `metabase_users` from the error message ""metabase_users is not a valid DN."".

Can you share a redacted version of the payload of this response?

noahmoss on (2024-12-20 15:39:18 UTC): @selfing12 This seems like a configuration issue. You need to use the DN of the LDAP group in the mappings, not just its common name. `metabase_users` isn't a valid DN so the backend rejects the configuration.

Per [the docs](https://www.metabase.com/learn/metabase-basics/administration/permissions/ldap-auth-access-control#group-management):

So, for the example in the docs, you'd use `cn=Human Resources,ou=Groups,dc=metabase,dc=com` instead of just `Human Resources`.

Thanks for the report and let us know if this works! This is definitely not intuitive from the UI so we'll discuss internally how to make this clearer.

selfing12 (Issue Creator) on (2025-01-10 05:41:39 UTC): @dpsutton 
<details>
<summary> stack trace</summary>

```JSON
{
    ""via"": [
        {
            ""type"": ""java.lang.IllegalArgumentException"",
            ""message"": ""metabase_users is not a valid DN."",
            ""at"": [
                ""metabase.integrations.ldap$fn__107761$fn__107766"",
                ""invoke"",
                ""ldap.clj"",
                120
            ]
        }
    ],
    ""trace"": [
        [
            ""metabase.integrations.ldap$fn__107761$fn__107766"",
            ""invoke"",
            ""ldap.clj"",
            120
        ],
        [
            ""metabase.models.setting$set_with_audit_logging_BANG_"",
            ""invokeStatic"",
            ""setting.clj"",
            927
        ],
        [
            ""metabase.models.setting$set_with_audit_logging_BANG_"",
            ""invoke"",
            ""setting.clj"",
            915
        ],
        [
            ""metabase.models.setting$set_BANG_"",
            ""invokeStatic"",
            ""setting.clj"",
            955
        ],
        [
            ""metabase.models.setting$set_BANG_"",
            ""doInvoke"",
            ""setting.clj"",
            931
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            428
        ],
        [
            ""metabase.api.setting$fn__106603$fn__106606"",
            ""invoke"",
            ""setting.clj"",
            59
        ],
        [
            ""metabase.api.setting$do_with_setting_access_control"",
            ""invokeStatic"",
            ""setting.clj"",
            14
        ],
        [
            ""metabase.api.setting$do_with_setting_access_control"",
            ""invoke"",
            ""setting.clj"",
            10
        ],
        [
            ""metabase.api.setting$fn__106603"",
            ""invokeStatic"",
            ""setting.clj"",
            58
        ],
        [
            ""metabase.api.setting$fn__106603"",
            ""invoke"",
            ""setting.clj"",
            53
        ],
        [
            ""compojure.core$wrap_response$fn__54217"",
            ""invoke"",
            ""core.clj"",
            160
        ],
        [
            ""compojure.core$wrap_route_middleware$fn__54201"",
            ""invoke"",
            ""core.clj"",
            132
        ],
        [
            ""compojure.core$wrap_route_info$fn__54206"",
            ""invoke"",
            ""core.clj"",
            139
        ],
        [
            ""compojure.core$wrap_route_matches$fn__54210"",
            ""invoke"",
            ""core.clj"",
            151
        ],
        [
            ""clojure.lang.Var"",
            ""invoke"",
            ""Var.java"",
            395
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""metabase.server.middleware.auth$enforce_authentication$fn__104621"",
            ""invoke"",
            ""auth.clj"",
            18
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""compojure.core$make_context$handler__54257"",
            ""invoke"",
            ""core.clj"",
            290
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            300
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            301
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.lang.AFunction$1"",
            ""doInvoke"",
            ""AFunction.java"",
            33
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$wrap_route_matches$fn__54210"",
            ""invoke"",
            ""core.clj"",
            153
        ],
        [
            ""clojure.lang.Var"",
            ""invoke"",
            ""Var.java"",
            395
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""metabase.api.routes$fn__109277$fn__109280"",
            ""invoke"",
            ""routes.clj"",
            75
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""clojure.lang.AFn"",
            ""applyToHelper"",
            ""AFn.java"",
            160
        ],
        [
            ""clojure.lang.AFn"",
            ""applyTo"",
            ""AFn.java"",
            144
        ],
        [
            ""clojure.core$apply"",
            ""invokeStatic"",
            ""core.clj"",
            667
        ],
        [
            ""clojure.core$apply"",
            ""invoke"",
            ""core.clj"",
            662
        ],
        [
            ""metabase.server.routes$fn__110019$fn__110020"",
            ""doInvoke"",
            ""routes.clj"",
            73
        ],
        [
            ""clojure.lang.RestFn"",
            ""invoke"",
            ""RestFn.java"",
            439
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""compojure.core$make_context$handler__54257"",
            ""invoke"",
            ""core.clj"",
            290
        ],
        [
            ""compojure.core$make_context$fn__54261"",
            ""invoke"",
            ""core.clj"",
            300
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$wrap_route_matches$fn__54210"",
            ""invoke"",
            ""core.clj"",
            153
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$wrap_route_matches$fn__54210"",
            ""invoke"",
            ""core.clj"",
            153
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$wrap_route_matches$fn__54210"",
            ""invoke"",
            ""core.clj"",
            153
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""compojure.core$wrap_route_matches$fn__54210"",
            ""invoke"",
            ""core.clj"",
            153
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
            ""invoke"",
            ""core.clj"",
            197
        ],
        [
            ""metabase.server.routes$fn__110002$fn__110004"",
            ""invoke"",
            ""routes.clj"",
            47
        ],
        [
            ""compojure.core$routes$fn__54229$f__54230"",
            ""invoke"",
            ""core.clj"",
            198
        ],
        [
            ""compojure.core$routes$fn__54229"",
            ""invoke"",
            ""core.clj"",
            200
        ],
        [
            ""metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__106746"",
            ""invoke"",
            ""exceptions.clj"",
            111
        ],
        [
            ""metabase.server.middleware.exceptions$catch_api_exceptions$fn__106743"",
            ""invoke"",
            ""exceptions.clj"",
            100
        ],
        [
            ""metabase.server.middleware.log$log_api_call$fn__110385$fn__110386$fn__110387"",
            ""invoke"",
            ""log.clj"",
            233
        ],
        [
            ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",
            ""invokeStatic"",
            ""diagnostic.clj"",
            17
        ],
        [
            ""metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info"",
            ""invoke"",
            ""diagnostic.clj"",
            12
        ],
        [
            ""metabase.server.middleware.log$log_api_call$fn__110385$fn__110386"",
            ""invoke"",
            ""log.clj"",
            224
        ],
        [
            ""toucan2.execute$do_with_call_counts"",
            ""invokeStatic"",
            ""execute.clj"",
            112
        ],
        [
            ""toucan2.execute$do_with_call_counts"",
            ""invoke"",
            ""execute.clj"",
            103
        ],
        [
            ""metabase.server.middleware.log$log_api_call$fn__110385"",
            ""invoke"",
            ""log.clj"",
            223
        ],
        [
            ""metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__114100"",
            ""invoke"",
            ""browser_cookie.clj"",
            40
        ],
        [
            ""metabase.server.middleware.security$add_security_headers$fn__106702"",
            ""invoke"",
            ""security.clj"",
            273
        ],
        [
            ""ring.middleware.json$wrap_json_body$fn__114359"",
            ""invoke"",
            ""json.clj"",
            64
        ],
        [
            ""metabase.server.middleware.offset_paging$handle_paging$fn__96235"",
            ""invoke"",
            ""offset_paging.clj"",
            56
        ],
        [
            ""metabase.server.middleware.json$wrap_streamed_json_response$fn__55864"",
            ""invoke"",
            ""json.clj"",
            88
        ],
        [
            ""ring.middleware.keyword_params$wrap_keyword_params$fn__114448"",
            ""invoke"",
            ""keyword_params.clj"",
            55
        ],
        [
            ""ring.middleware.params$wrap_params$fn__114467"",
            ""invoke"",
            ""params.clj"",
            77
        ],
        [
            ""metabase.server.middleware.misc$maybe_set_site_url$fn__70111"",
            ""invoke"",
            ""misc.clj"",
            59
        ],
        [
            ""metabase.server.middleware.session$reset_session_timeout$fn__72177"",
            ""invoke"",
            ""session.clj"",
            566
        ],
        [
            ""metabase.server.middleware.session$bind_current_user$fn__72143$fn__72144"",
            ""invoke"",
            ""session.clj"",
            459
        ],
        [
            ""metabase.server.middleware.session$do_with_current_user"",
            ""invokeStatic"",
            ""session.clj"",
            438
        ],
        [
            ""metabase.server.middleware.session$do_with_current_user"",
            ""invoke"",
            ""session.clj"",
            421
        ],
        [
            ""metabase.server.middleware.session$bind_current_user$fn__72143"",
            ""invoke"",
            ""session.clj"",
            458
        ],
        [
            ""metabase.server.middleware.session$wrap_current_user_info$fn__72120"",
            ""invoke"",
            ""session.clj"",
            383
        ],
        [
            ""metabase.analytics.sdk$embedding_mw$embedding_mw_fn__78293"",
            ""invoke"",
            ""sdk.clj"",
            61
        ],
        [
            ""metabase.server.middleware.session$wrap_session_id$fn__72092"",
            ""invoke"",
            ""session.clj"",
            261
        ],
        [
            ""metabase.server.middleware.auth$wrap_static_api_key$fn__104629"",
            ""invoke"",
            ""auth.clj"",
            33
        ],
        [
            ""ring.middleware.cookies$wrap_cookies$fn__114287"",
            ""invoke"",
            ""cookies.clj"",
            200
        ],
        [
            ""metabase.server.middleware.misc$add_content_type$fn__70093"",
            ""invoke"",
            ""misc.clj"",
            28
        ],
        [
            ""metabase.server.middleware.misc$disable_streaming_buffering$fn__70119"",
            ""invoke"",
            ""misc.clj"",
            75
        ],
        [
            ""ring.middleware.gzip$wrap_gzip$fn__114329"",
            ""invoke"",
            ""gzip.clj"",
            86
        ],
        [
            ""metabase.server.middleware.request_id$wrap_request_id$fn__110081"",
            ""invoke"",
            ""request_id.clj"",
            9
        ],
        [
            ""metabase.server.middleware.misc$bind_request$fn__70122"",
            ""invoke"",
            ""misc.clj"",
            91
        ],
        [
            ""metabase.server.middleware.ssl$redirect_to_https_middleware$fn__114116"",
            ""invoke"",
            ""ssl.clj"",
            41
        ],
        [
            ""metabase.server$async_proxy_handler$fn__56833"",
            ""invoke"",
            ""server.clj"",
            77
        ],
        [
            ""metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a"",
            ""handle"",
            null,
            -1
        ],
        [
            ""org.eclipse.jetty.server.handler.StatisticsHandler"",
            ""handle"",
            ""StatisticsHandler.java"",
            173
        ],
        [
            ""org.eclipse.jetty.server.handler.HandlerWrapper"",
            ""handle"",
            ""HandlerWrapper.java"",
            122
        ],
        [
            ""org.eclipse.jetty.server.Server"",
            ""handle"",
            ""Server.java"",
            563
        ],
        [
            ""org.eclipse.jetty.server.HttpChannel$RequestDispatchable"",
            ""dispatch"",
            ""HttpChannel.java"",
            1598
        ],
        [
            ""org.eclipse.jetty.server.HttpChannel"",
            ""dispatch"",
            ""HttpChannel.java"",
            753
        ],
        [
            ""org.eclipse.jetty.server.HttpChannel"",
            ""handle"",
            ""HttpChannel.java"",
            501
        ],
        [
            ""org.eclipse.jetty.server.HttpConnection"",
            ""onFillable"",
            ""HttpConnection.java"",
            287
        ],
        [
            ""org.eclipse.jetty.io.AbstractConnection$ReadCallback"",
            ""succeeded"",
            ""AbstractConnection.java"",
            314
        ],
        [
            ""org.eclipse.jetty.io.FillInterest"",
            ""fillable"",
            ""FillInterest.java"",
            100
        ],
        [
            ""org.eclipse.jetty.io.SelectableChannelEndPoint$1"",
            ""run"",
            ""SelectableChannelEndPoint.java"",
            53
        ],
        [
            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
            ""runTask"",
            ""AdaptiveExecutionStrategy.java"",
            421
        ],
        [
            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
            ""consumeTask"",
            ""AdaptiveExecutionStrategy.java"",
            390
        ],
        [
            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
            ""tryProduce"",
            ""AdaptiveExecutionStrategy.java"",
            277
        ],
        [
            ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
            ""run"",
            ""AdaptiveExecutionStrategy.java"",
            199
        ],
        [
            ""org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread"",
            ""run"",
            ""ReservedThreadExecutor.java"",
            411
        ],
        [
            ""org.eclipse.jetty.util.thread.QueuedThreadPool"",
            ""runJob"",
            ""QueuedThreadPool.java"",
            969
        ],
        [
            ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",
            ""doRunJob"",
            ""QueuedThreadPool.java"",
            1194
        ],
        [
            ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",
            ""run"",
            ""QueuedThreadPool.java"",
            1149
        ],
        [
            ""java.lang.Thread"",
            ""run"",
            ""Thread.java"",
            1583
        ]
    ],
    ""cause"": ""metabase_users is not a valid DN."",
    ""message"": ""metabase_users is not a valid DN.""
}
```
</details>


@noahmoss we use freeipa as an ldap server.

The documentation says that if the user has a memberOf key, then you do not need to set it. We have such a property

![Image](https://github.com/user-attachments/assets/2f296ae0-d3dc-4ddd-87de-97361e9012ef)

paoliniluis on (2025-01-10 10:42:05 UTC): Thats wrong, you always need to set the group youre mapping

selfing12 (Issue Creator) on (2025-02-03 07:07:38 UTC): this does not negate the fact that when mapping the group correctly, we get an error with DN.Or am I wrong?

"
2752179665,issue,open,,After updating to 0.51 opening collection page became too slow,"### Describe the bug

Hello!
We recently upgraded our Metabase from 47.1 to 51.3. After some time, some of our users reported that Metabase became too slow after the upgrade.
We investigated this case and found that these users have membership in more than 40 groups.
For these users, some API endpoints are too slow. For example, opening a collection page to view a list of subcollections, dashboards, and cards took more than 6 seconds.
![Image](https://github.com/user-attachments/assets/c71b06a0-4860-40e8-ae30-18fbf07bba7f)

While for users with a small number of groups, this query took half a second.

At that time, this query was run twice in the DB:

<details>
<summary>Query</summary>

```sql
# Query_time: 2.669313  Lock_time: 0.001512  Rows_sent: 1  Rows_examined: 3
# Rows_affected: 0  Bytes_sent: 60

SELECT COUNT(*) AS `count`
FROM (SELECT 5                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'card'           AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             (SELECT `status`
              FROM `moderation_review`
              WHERE (`moderated_item_type` = 'card')
                AND (`moderated_item_id` = `c`.`id`)
                AND (`most_recent` = TRUE)
              ORDER BY `id` DESC
              LIMIT 1)        AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (570)) AS `c`
                                                               WHERE (<OTHER?_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'question')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 7            AS `model_ranking`,
             `id`,
             `name`,
             `description`,
             `entity_id`,
             NULL         AS `display`,
             NULL         AS `collection_preview`,
             NULL         AS `dataset_query`,
             `id`         AS `collection_id`,
             `archived_directly`,
             'collection' AS `model`,
             NULL         AS `collection_position`,
             `authority_level`,
             `personal_owner_id`,
             `location`,
             NULL         AS `last_edit_email`,
             NULL         AS `last_edit_first_name`,
             NULL         AS `last_edit_last_name`,
             NULL         AS `moderated_status`,
             NULL         AS `icon`,
             NULL         AS `last_edit_user`,
             NULL         AS `last_edit_timestamp`,
             NULL         AS `database_id`,
             `type`       AS `collection_type`,
             `archived`,
             NULL         AS `last_used_at`,
             NULL         AS `table_id`,
             NULL         AS `is_upload`,
             NULL         AS `query_type`
      FROM `collection` AS `col`
      WHERE ((`id` IN (SELECT `id`
                       FROM (SELECT `c`.*
                             FROM `collection` AS `c`
                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                             WHERE (`pgm`.`user_id` = <USER_ID>)
                               AND (`p`.`perm_type` = 'perms/collection-access')
                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `type` = 'trash'
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `id` IN (570)) AS `c`
                       WHERE (`archived` = FALSE)
                         AND ((`location` LIKE '/<COLLECTION_ID>/%') AND
                              NOT EXISTS(SELECT 1 FROM `collection` AS `c2` WHERE ((`c2`.`id` IS NULL) OR (`c2`.`id` IN (SELECT `id` FROM (SELECT `c`.* FROM `collection` AS `c` INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id` INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id` INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id` WHERE (`pgm`.`user_id` = <USER_ID>) AND (`p`.`perm_type` = 'perms/collection-access') AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read')) UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `type` = 'trash' UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `id` IN (570)) AS `c` WHERE (`archived` = FALSE)))) AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')) AND (`c2`.`id` <> <COLLECTION_ID>))))))
        AND (`personal_owner_id` IS NULL)
        AND ((`archived` = FALSE) AND (`id` <> <OTHER?_COLLECTION_ID>))
        AND (`namespace` IS NULL)
        AND ((`namespace` IS NULL) OR (`namespace` <> 'snippets'))
        AND (NULL IS NULL)
      UNION ALL
      SELECT 1                AS `model_ranking`,
             `d`.`id`,
             `d`.`name`,
             `d`.`description`,
             `d`.`entity_id`,
             NULL             AS `display`,
             NULL             AS `collection_preview`,
             NULL             AS `dataset_query`,
             `d`.`collection_id`,
             `d`.`archived_directly`,
             'dashboard'      AS `model`,
             `d`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             NULL             AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `archived`,
             `last_viewed_at` AS `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_dashboard` AS `d`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (570)) AS `c`
                                                               WHERE (<OTHER?_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`d`.`archived_directly` <> TRUE))
        AND (`archived` = FALSE)
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 3                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'dataset'        AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             (SELECT `status`
              FROM `moderation_review`
              WHERE (`moderated_item_type` = 'card')
                AND (`moderated_item_id` = `c`.`id`)
                AND (`most_recent` = TRUE)
              ORDER BY `id` DESC
              LIMIT 1)        AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             `c`.`table_id`,
             `t`.`is_upload`,
             `c`.`query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (570)) AS `c`
                                                               WHERE (<OTHER?_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'model')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 4                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'metric'         AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             (SELECT `status`
              FROM `moderation_review`
              WHERE (`moderated_item_type` = 'card')
                AND (`moderated_item_id` = `c`.`id`)
                AND (`most_recent` = TRUE)
              ORDER BY `id` DESC
              LIMIT 1)        AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (570)) AS `c`
                                                               WHERE (<OTHER?_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'metric')
        AND (`collection_position` IS NULL)) AS `dummy_alias`;
```

</details>

In the latest version (52.3), these queries became significantly slower - opening the same collection page took 10 seconds.


### To Reproduce

Create several thousands collections, 40-50 permission groups, that get access to particular collection, create test user and add it to all of these groups. Try to open some collection page.

### Expected behavior

Opening any page takes less than a second.

### Logs

_No response_

### Information about your Metabase installation

Metabase - v0.51.3 (Built on 2024-11-11)
We use MariaDB as backend DB. 
We have about 1000 users, 2500 collections, 18000 cards, more than 100 permissions group and 63000 records in the `permissions` table.

Most of users use Chrome browser.

### Severity

annoying

### Additional context

_No response_",ppavlov39,2024-12-20 08:07:45+00:00,['noahmoss'],2025-02-04 20:24:53+00:00,,https://github.com/metabase/metabase/issues/51560,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Performance', ''), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('Bug:v51', 'bugs or regressions introduced in v51')]","[{'comment_id': 2559649916, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': ""Hello!\nToday we continue to investigate the issue ~~and found that the query from the message above is running in 0.2 seconds. Much faster than we have seen before.~~ (0.2 seconds for user with small amount of groups).\n\nWe have noticed that our database sometimes has high disk usage, up to 100% for several minutes. We have not seen such indicators before.\n![Image](https://github.com/user-attachments/assets/0b6772ed-67c9-4bf7-846f-d2663f8e0dcf)\n\nFurther investigation into the cause of the issue revealed several queries that are causing high disk usage.\n\n```\nSELECT AVG(`running_time`) AS `running_time`, `card_id` FROM `query_execution` \nWHERE (`running_time` IS NOT NULL) AND (`cache_hit` <> TRUE) AND (`card_id` IN (7196)) GROUP BY `card_id`;\n```\nand\n```\nSELECT MIN(`executor_id`) AS `user_id`, `query_execution`.`card_id` AS `model_id`, COUNT(*) AS `cnt`, MAX(`started_at`) AS `max_ts` FROM `query_execution` \nWHERE (`context` = 'question') GROUP BY `query_execution`.`card_id`, `context` ORDER BY `max_ts` DESC LIMIT 8;\n```\n\nThe card_id specified in the first query is present in all such requests.\nThe `query_execution` table is about 3GB in size. \nCould you help me understand what event causes these requests to be executed? And what can we do to resolve this problem?"", 'created_at': datetime.datetime(2024, 12, 23, 12, 49, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2559787353, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': 'The message above does not seem to be related to the problems. It may be related to caching ([issue](https://github.com/metabase/metabase/issues/33375) about it). Now we have disabled caching and disk usage is lower.', 'created_at': datetime.datetime(2024, 12, 23, 14, 15, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2559937556, 'issue_id': 2752179665, 'author': 'paoliniluis', 'body': ""@ppavlov39 first of all, great debugging, thanks a lot for this. Quick question: what's your app database sizing?"", 'created_at': datetime.datetime(2024, 12, 23, 15, 50, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2560701466, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': '@paoliniluis Hi!\nThe size of the app db is about 13 GB.', 'created_at': datetime.datetime(2024, 12, 24, 6, 7, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2560712057, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': ""> The message above does not seem to be related to the problems. It may be related to caching ([issue](https://github.com/metabase/metabase/issues/33375) about it). Now we have disabled caching and disk usage is lower.\n\nBut I was wrong. Disabling any result caching doesn't help.\n\nThere are still many similar queries:\n```\nSELECT AVG(`running_time`) AS `running_time`, `card_id` FROM `query_execution` WHERE (`running_time` IS NOT NULL) AND (`cache_hit` <> TRUE) AND (`card_id` IN (7194)) GROUP BY `card_id`;\n```\n\nAnd hight disk utilization:\n![Image](https://github.com/user-attachments/assets/46c2c153-00ae-4f19-8a7d-c7e080fd4188)"", 'created_at': datetime.datetime(2024, 12, 24, 6, 18, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2561274501, 'issue_id': 2752179665, 'author': 'paoliniluis', 'body': ""@ppavlov39 I meant, give us the CPU and memory that you're assigning to the app db, since your use case with so many users and permissions need a decently sized app db"", 'created_at': datetime.datetime(2024, 12, 24, 16, 29, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2561274835, 'issue_id': 2752179665, 'author': 'paoliniluis', 'body': 'BTW @ppavlov39, wipe query_execution and permissions_review (leave the last entry) tables', 'created_at': datetime.datetime(2024, 12, 24, 16, 30, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2561719640, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': ""> [@ppavlov39](https://github.com/ppavlov39) I meant, give us the CPU and memory that you're assigning to the app db, since your use case with so many users and permissions need a decently sized app db\n\nYes, sorry. Yesterday we increased the DB server resources and now it has 4 CPUs, 12 GB RAM and innodb_buffer_pool_size=6 GB.\nThe issues related to the queries from this [post](https://github.com/metabase/metabase/issues/51560#issuecomment-2559649916) are gone.\nBut the original issues are still there."", 'created_at': datetime.datetime(2024, 12, 25, 8, 36, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2561728211, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': ""> BTW [@ppavlov39](https://github.com/ppavlov39), wipe query_execution and permissions_review (leave the last entry) tables\n\nI can't find `permissions_review` table. May be you just meant `review`?\n\nTable `query_execution` we can try wipe it, but if i'm not mistaken it should be done automatically two times a day, and storing data for 2 years is not problem now."", 'created_at': datetime.datetime(2024, 12, 25, 8, 50, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2561876250, 'issue_id': 2752179665, 'author': 'paoliniluis', 'body': 'When you say that the original issues are still there, you mean the high disk usage?', 'created_at': datetime.datetime(2024, 12, 25, 12, 44, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2561930996, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': '> When you say that the original issues are still there, you mean the high disk usage?\n\nNo, I meant the problem from [this](https://github.com/metabase/metabase/issues/51560#issue-2752179665) post.', 'created_at': datetime.datetime(2024, 12, 25, 15, 34, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2562025858, 'issue_id': 2752179665, 'author': 'paoliniluis', 'body': ""@ppavlov39 I clicked on the link and I don't get anywhere"", 'created_at': datetime.datetime(2024, 12, 25, 23, 46, 9, tzinfo=datetime.timezone.utc)}, {'comment_id': 2562196450, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': '@paoliniluis this is the link to the first post of this issue. I checked in a new tab and it works correctly.', 'created_at': datetime.datetime(2024, 12, 26, 6, 9, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2562519229, 'issue_id': 2752179665, 'author': 'paoliniluis', 'body': '@ppavlov39 I thought you mentioned that the problem went away scaling vertically your app db, wasnt that the case?', 'created_at': datetime.datetime(2024, 12, 26, 11, 34, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2562561822, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': '> [@ppavlov39](https://github.com/ppavlov39) I thought you mentioned that the problem went away scaling vertically your app db, wasnt that the case?\n\nUnfortunately, no. After scaling the application database, queries using the `query_execution` table are no longer a problem. And they execute quickly.\nBut the query from the first post is still slow and users are forced to wait several seconds before they see any collections or cards.', 'created_at': datetime.datetime(2024, 12, 26, 11, 56, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2563961101, 'issue_id': 2752179665, 'author': 'paoliniluis', 'body': '@ppavlov39 we will ship 52.5 with a possible fix to this issue, can you test it?', 'created_at': datetime.datetime(2024, 12, 27, 19, 8, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2563970321, 'issue_id': 2752179665, 'author': 'noahmoss', 'body': ""I suspect that #51673 will help but may not be the entire root cause (still investigating) so let's keep this issue open for now"", 'created_at': datetime.datetime(2024, 12, 27, 19, 24, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2564216764, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': 'Thanks! Yes, I will test it when it becomes available. Now I only found 52.4.', 'created_at': datetime.datetime(2024, 12, 28, 6, 13, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2564933120, 'issue_id': 2752179665, 'author': 'paoliniluis', 'body': ""@ppavlov39 I'll need some help here. Please send me the output of the following queries:\n\n1) select version();\n2) \n```\nEXPLAIN FORMAT=JSON SELECT *\nFROM (SELECT 5                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'card'           AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<insert_collection_id_here>)) AS `c`\n                                                               WHERE (1 <> `id`))))\n        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'question')\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 7            AS `model_ranking`,\n             `id`,\n             `name`,\n             `description`,\n             `entity_id`,\n             NULL         AS `display`,\n             NULL         AS `collection_preview`,\n             NULL         AS `dataset_query`,\n             `id`         AS `collection_id`,\n             `archived_directly`,\n             'collection' AS `model`,\n             NULL         AS `collection_position`,\n             `authority_level`,\n             `personal_owner_id`,\n             `location`,\n             NULL         AS `last_edit_email`,\n             NULL         AS `last_edit_first_name`,\n             NULL         AS `last_edit_last_name`,\n             NULL         AS `moderated_status`,\n             NULL         AS `icon`,\n             NULL         AS `last_edit_user`,\n             NULL         AS `last_edit_timestamp`,\n             NULL         AS `database_id`,\n             `type`       AS `collection_type`,\n             `archived`,\n             NULL         AS `last_used_at`,\n             NULL         AS `table_id`,\n             NULL         AS `is_upload`,\n             NULL         AS `query_type`\n      FROM `collection` AS `col`\n      WHERE ((`id` IN (SELECT `id`\n                       FROM (SELECT `c`.*\n                             FROM `collection` AS `c`\n                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                             WHERE (`pgm`.`user_id` = <inser_problematic_user_id_here>)\n                               AND (`p`.`perm_type` = 'perms/collection-access')\n                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `type` = 'trash'\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                       WHERE (`archived` = FALSE)\n                         AND ((`location` LIKE '/%') AND NOT EXISTS (SELECT 1\n                                                                     FROM `collection` AS `c2`\n                                                                     WHERE ((`c2`.`id` IS NULL) OR\n                                                                            (`c2`.`id` IN (SELECT `id`\n                                                                                           FROM (SELECT `c`.*\n                                                                                                 FROM `collection` AS `c`\n                                                                                                          INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                                                          INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                                                          INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                                                 WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                                                   AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                                                   AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                                                 UNION ALL\n                                                                                                 SELECT `c`.*\n                                                                                                 FROM `collection` AS `c`\n                                                                                                 WHERE `type` = 'trash'\n                                                                                                 UNION ALL\n                                                                                                 SELECT `c`.*\n                                                                                                 FROM `collection` AS `c`\n                                                                                                 WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                                                                                           WHERE (`archived` = FALSE))))\n                                                                       AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')))))))\n        AND (`personal_owner_id` IS NULL)\n        AND ((`archived` = FALSE) AND (`id` <> 1))\n        AND ((`namespace` IS NULL) OR (`namespace` = 'analytics'))\n        AND (NULL IS NULL)\n      UNION ALL\n      SELECT 1                AS `model_ranking`,\n             `d`.`id`,\n             `d`.`name`,\n             `d`.`description`,\n             `d`.`entity_id`,\n             NULL             AS `display`,\n             NULL             AS `collection_preview`,\n             NULL             AS `dataset_query`,\n             `d`.`collection_id`,\n             `d`.`archived_directly`,\n             'dashboard'      AS `model`,\n             `d`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `archived`,\n             `last_viewed_at` AS `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_dashboard` AS `d`\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'dashboard')\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                                                               WHERE (1 <> `id`))))\n        AND ((`collection_id` IS NULL) AND (`d`.`archived_directly` <> TRUE))\n        AND (`archived` = FALSE)\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 3                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'dataset'        AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             `c`.`table_id`,\n             `t`.`is_upload`,\n             `c`.`query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                                                               WHERE (1 <> `id`))))\n        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'model')\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 4                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'metric'         AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                                                               WHERE (1 <> `id`))))\n        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'metric')\n        AND (`collection_position` IS NULL)) AS `dummy_alias`\nORDER BY (CASE WHEN `authority_level` = 'official' THEN 0 ELSE 1 END) ASC,\n         (CASE WHEN `collection_type` IS NULL THEN 0 WHEN `collection_type` = 'trash' THEN 1 ELSE 2 END) ASC,\n         LOWER(`name`) ASC\nLIMIT 25 OFFSET 0\n```\n\n(check in the previous query the places where I put <insert_problematic_user_id_here> and <insert_problematic_collection_id_here>)\n\n3) \n```\nexplain analyze SELECT *\nFROM (SELECT 5                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'card'           AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<insert_collection_id_here>)) AS `c`\n                                                               WHERE (1 <> `id`))))\n        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'question')\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 7            AS `model_ranking`,\n             `id`,\n             `name`,\n             `description`,\n             `entity_id`,\n             NULL         AS `display`,\n             NULL         AS `collection_preview`,\n             NULL         AS `dataset_query`,\n             `id`         AS `collection_id`,\n             `archived_directly`,\n             'collection' AS `model`,\n             NULL         AS `collection_position`,\n             `authority_level`,\n             `personal_owner_id`,\n             `location`,\n             NULL         AS `last_edit_email`,\n             NULL         AS `last_edit_first_name`,\n             NULL         AS `last_edit_last_name`,\n             NULL         AS `moderated_status`,\n             NULL         AS `icon`,\n             NULL         AS `last_edit_user`,\n             NULL         AS `last_edit_timestamp`,\n             NULL         AS `database_id`,\n             `type`       AS `collection_type`,\n             `archived`,\n             NULL         AS `last_used_at`,\n             NULL         AS `table_id`,\n             NULL         AS `is_upload`,\n             NULL         AS `query_type`\n      FROM `collection` AS `col`\n      WHERE ((`id` IN (SELECT `id`\n                       FROM (SELECT `c`.*\n                             FROM `collection` AS `c`\n                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                             WHERE (`pgm`.`user_id` = <inser_problematic_user_id_here>)\n                               AND (`p`.`perm_type` = 'perms/collection-access')\n                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `type` = 'trash'\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                       WHERE (`archived` = FALSE)\n                         AND ((`location` LIKE '/%') AND NOT EXISTS (SELECT 1\n                                                                     FROM `collection` AS `c2`\n                                                                     WHERE ((`c2`.`id` IS NULL) OR\n                                                                            (`c2`.`id` IN (SELECT `id`\n                                                                                           FROM (SELECT `c`.*\n                                                                                                 FROM `collection` AS `c`\n                                                                                                          INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                                                          INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                                                          INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                                                 WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                                                   AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                                                   AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                                                 UNION ALL\n                                                                                                 SELECT `c`.*\n                                                                                                 FROM `collection` AS `c`\n                                                                                                 WHERE `type` = 'trash'\n                                                                                                 UNION ALL\n                                                                                                 SELECT `c`.*\n                                                                                                 FROM `collection` AS `c`\n                                                                                                 WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                                                                                           WHERE (`archived` = FALSE))))\n                                                                       AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')))))))\n        AND (`personal_owner_id` IS NULL)\n        AND ((`archived` = FALSE) AND (`id` <> 1))\n        AND ((`namespace` IS NULL) OR (`namespace` = 'analytics'))\n        AND (NULL IS NULL)\n      UNION ALL\n      SELECT 1                AS `model_ranking`,\n             `d`.`id`,\n             `d`.`name`,\n             `d`.`description`,\n             `d`.`entity_id`,\n             NULL             AS `display`,\n             NULL             AS `collection_preview`,\n             NULL             AS `dataset_query`,\n             `d`.`collection_id`,\n             `d`.`archived_directly`,\n             'dashboard'      AS `model`,\n             `d`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `archived`,\n             `last_viewed_at` AS `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_dashboard` AS `d`\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'dashboard')\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                                                               WHERE (1 <> `id`))))\n        AND ((`collection_id` IS NULL) AND (`d`.`archived_directly` <> TRUE))\n        AND (`archived` = FALSE)\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 3                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'dataset'        AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             `c`.`table_id`,\n             `t`.`is_upload`,\n             `c`.`query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                                                               WHERE (1 <> `id`))))\n        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'model')\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 4                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'metric'         AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`\n                                                               WHERE (1 <> `id`))))\n        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'metric')\n        AND (`collection_position` IS NULL)) AS `dummy_alias`\nORDER BY (CASE WHEN `authority_level` = 'official' THEN 0 ELSE 1 END) ASC,\n         (CASE WHEN `collection_type` IS NULL THEN 0 WHEN `collection_type` = 'trash' THEN 1 ELSE 2 END) ASC,\n         LOWER(`name`) ASC\nLIMIT 25 OFFSET 0\n```\n\n(check in the previous query the places where I put <insert_problematic_user_id_here> and <insert_problematic_collection_id_here>)"", 'created_at': datetime.datetime(2024, 12, 30, 1, 19, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2567065037, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': '@paoliniluis Here are the results:\n1. `10.5.13-MariaDB-log`\n2. \n<details><summary>Results</summary>\n\n```\n{\n  ""query_block"": {\n    ""select_id"": 1,\n    ""read_sorted_file"": {\n      ""filesort"": {\n        ""sort_key"": ""case when dummy_alias.authority_level = \'official\' then 0 else 1 end, case when dummy_alias.collection_type is null then 0 when dummy_alias.collection_type = \'trash\' then 1 else 2 end, lcase(dummy_alias.`name`)"",\n        ""table"": {\n          ""table_name"": ""<derived2>"",\n          ""access_type"": ""ALL"",\n          ""rows"": 20987,\n          ""filtered"": 100,\n          ""materialized"": {\n            ""query_block"": {\n              ""union_result"": {\n                ""table_name"": ""<union2,7,17,22,27>"",\n                ""access_type"": ""ALL"",\n                ""query_specifications"": [\n                  {\n                    ""query_block"": {\n                      ""select_id"": 2,\n                      ""table"": {\n                        ""table_name"": ""c"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [""idx_card_collection_id""],\n                        ""key"": ""idx_card_collection_id"",\n                        ""key_length"": ""5"",\n                        ""used_key_parts"": [""collection_id""],\n                        ""ref"": [""const""],\n                        ""rows"": 102,\n                        ""filtered"": 100,\n                        ""index_condition"": ""c.collection_id is null"",\n                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#3))) and c.`type` = \'question\' and c.collection_position is null""\n                      },\n                      ""table"": {\n                        ""table_name"": ""r"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_revision_model_model_id"",\n                          ""idx_revision_most_recent""\n                        ],\n                        ""key"": ""idx_revision_model_model_id"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""model_id""],\n                        ""ref"": [""metabase_update.c.id""],\n                        ""rows"": 1,\n                        ""filtered"": 50,\n                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = \'Card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""mr"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_moderation_review_item_type_item_id""\n                        ],\n                        ""key"": ""idx_moderation_review_item_type_item_id"",\n                        ""key_length"": ""1026"",\n                        ""used_key_parts"": [\n                          ""moderated_item_type"",\n                          ""moderated_item_id""\n                        ],\n                        ""ref"": [""const"", ""metabase_update.c.id""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = \'card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""u"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.r.user_id""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""\n                      },\n                      ""subqueries"": [\n                        {\n                          ""query_block"": {\n                            ""select_id"": 3,\n                            ""table"": {\n                              ""table_name"": ""<derived4>"",\n                              ""access_type"": ""ALL"",\n                              ""rows"": 19582,\n                              ""filtered"": 100,\n                              ""attached_condition"": ""1 <> c.`id`"",\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""union_result"": {\n                                    ""table_name"": ""<union4,5,6>"",\n                                    ""access_type"": ""ALL"",\n                                    ""query_specifications"": [\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 4,\n                                          ""table"": {\n                                            ""table_name"": ""pgm"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""unique_permissions_group_membership_user_id_group_id"",\n                                              ""idx_permissions_group_membership_group_id"",\n                                              ""idx_permissions_group_membership_user_id"",\n                                              ""idx_permissions_group_membership_group_id_user_id""\n                                            ],\n                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""user_id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 44,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""pg"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""p"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""group_id"",\n                                              ""idx_permissions_group_id"",\n                                              ""idx_permissions_collection_id"",\n                                              ""idx_permissions_perm_type"",\n                                              ""idx_permissions_perm_value""\n                                            ],\n                                            ""key"": ""group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""group_id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rowid_filter"": {\n                                              ""range"": {\n                                                ""key"": ""idx_permissions_collection_id"",\n                                                ""used_key_parts"": [""collection_id""]\n                                              },\n                                              ""rows"": 32084,\n                                              ""selectivity_pct"": 50.00155846\n                                            },\n                                            ""rows"": 445,\n                                            ""filtered"": 14.01837444,\n                                            ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and 1 <> p.collection_id and p.collection_id is not null""\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [\n                                              ""metabase_update.p.collection_id""\n                                            ],\n                                            ""rows"": 1,\n                                            ""filtered"": 100\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 5,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_type""\n                                            ],\n                                            ""key"": ""idx_collection_type"",\n                                            ""key_length"": ""1027"",\n                                            ""used_key_parts"": [""type""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""index_condition"": ""c.`type` = \'trash\' and 1 <> c.`id`""\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 6,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""const"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100\n                                          }\n                                        }\n                                      }\n                                    ]\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  },\n                  {\n                    ""query_block"": {\n                      ""select_id"": 7,\n                      ""operation"": ""UNION"",\n                      ""table"": {\n                        ""table_name"": ""col"",\n                        ""access_type"": ""ALL"",\n                        ""possible_keys"": [\n                          ""PRIMARY"",\n                          ""unique_collection_personal_owner_id"",\n                          ""idx_collection_personal_owner_id""\n                        ],\n                        ""rows"": 3005,\n                        ""filtered"": 68.78535461,\n                        ""attached_condition"": ""col.archived = 0 and col.personal_owner_id is null and col.`id` <> 1 and (col.namespace is null or col.namespace = \'analytics\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""<subquery8>"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""distinct_key""],\n                        ""key"": ""distinct_key"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""func""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""materialized"": {\n                          ""unique"": 1,\n                          ""query_block"": {\n                            ""select_id"": 8,\n                            ""table"": {\n                              ""table_name"": ""<derived9>"",\n                              ""access_type"": ""ALL"",\n                              ""rows"": 19582,\n                              ""filtered"": 100,\n                              ""attached_condition"": ""c.archived = 0 and c.location like \'/%\' and !<in_optimizer>(1,exists(subquery#12))"",\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""union_result"": {\n                                    ""table_name"": ""<union9,10,11>"",\n                                    ""access_type"": ""ALL"",\n                                    ""query_specifications"": [\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 9,\n                                          ""table"": {\n                                            ""table_name"": ""pgm"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""unique_permissions_group_membership_user_id_group_id"",\n                                              ""idx_permissions_group_membership_group_id"",\n                                              ""idx_permissions_group_membership_user_id"",\n                                              ""idx_permissions_group_membership_group_id_user_id""\n                                            ],\n                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""user_id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 44,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""pg"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""p"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""group_id"",\n                                              ""idx_permissions_group_id"",\n                                              ""idx_permissions_collection_id"",\n                                              ""idx_permissions_perm_type"",\n                                              ""idx_permissions_perm_value""\n                                            ],\n                                            ""key"": ""group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""group_id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rowid_filter"": {\n                                              ""range"": {\n                                                ""key"": ""idx_permissions_collection_id"",\n                                                ""used_key_parts"": [""collection_id""]\n                                              },\n                                              ""rows"": 32084,\n                                              ""selectivity_pct"": 50.00155846\n                                            },\n                                            ""rows"": 445,\n                                            ""filtered"": 14.01837444,\n                                            ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and p.collection_id <> 1 and p.collection_id is not null""\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_location""\n                                            ],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [\n                                              ""metabase_update.p.collection_id""\n                                            ],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""attached_condition"": ""c.archived = 0 and c.location like \'/%\'""\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 10,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_location"",\n                                              ""idx_collection_type""\n                                            ],\n                                            ""key"": ""idx_collection_type"",\n                                            ""key_length"": ""1027"",\n                                            ""used_key_parts"": [""type""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""index_condition"": ""c.`type` = \'trash\' and c.`id` <> 1"",\n                                            ""attached_condition"": ""c.archived = 0 and c.location like \'/%\'""\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 11,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""const"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_location""\n                                            ],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100\n                                          }\n                                        }\n                                      }\n                                    ]\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      },\n                      ""subqueries"": [\n                        {\n                          ""expression_cache"": {\n                            ""state"": ""uninitialized"",\n                            ""query_block"": {\n                              ""select_id"": 12,\n                              ""table"": {\n                                ""table_name"": ""c2"",\n                                ""access_type"": ""ALL"",\n                                ""rows"": 3005,\n                                ""filtered"": 100,\n                                ""attached_condition"": ""<in_optimizer>(c2.`id`,c2.`id` in (subquery#13)) and c.location = concat(c2.location,c2.`id`,\'/\')""\n                              },\n                              ""subqueries"": [\n                                {\n                                  ""query_block"": {\n                                    ""select_id"": 13,\n                                    ""table"": {\n                                      ""table_name"": ""<derived14>"",\n                                      ""access_type"": ""ALL"",\n                                      ""rows"": 19582,\n                                      ""filtered"": 100,\n                                      ""attached_condition"": ""c.archived = 0"",\n                                      ""materialized"": {\n                                        ""query_block"": {\n                                          ""union_result"": {\n                                            ""table_name"": ""<union14,15,16>"",\n                                            ""access_type"": ""ALL"",\n                                            ""query_specifications"": [\n                                              {\n                                                ""query_block"": {\n                                                  ""select_id"": 14,\n                                                  ""table"": {\n                                                    ""table_name"": ""pgm"",\n                                                    ""access_type"": ""ref"",\n                                                    ""possible_keys"": [\n                                                      ""unique_permissions_group_membership_user_id_group_id"",\n                                                      ""idx_permissions_group_membership_group_id"",\n                                                      ""idx_permissions_group_membership_user_id"",\n                                                      ""idx_permissions_group_membership_group_id_user_id""\n                                                    ],\n                                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""user_id""],\n                                                    ""ref"": [""const""],\n                                                    ""rows"": 44,\n                                                    ""filtered"": 100,\n                                                    ""using_index"": true\n                                                  },\n                                                  ""table"": {\n                                                    ""table_name"": ""pg"",\n                                                    ""access_type"": ""eq_ref"",\n                                                    ""possible_keys"": [""PRIMARY""],\n                                                    ""key"": ""PRIMARY"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""id""],\n                                                    ""ref"": [\n                                                      ""metabase_update.pgm.group_id""\n                                                    ],\n                                                    ""rows"": 1,\n                                                    ""filtered"": 100,\n                                                    ""using_index"": true\n                                                  },\n                                                  ""table"": {\n                                                    ""table_name"": ""p"",\n                                                    ""access_type"": ""ref"",\n                                                    ""possible_keys"": [\n                                                      ""group_id"",\n                                                      ""idx_permissions_group_id"",\n                                                      ""idx_permissions_collection_id"",\n                                                      ""idx_permissions_perm_type"",\n                                                      ""idx_permissions_perm_value""\n                                                    ],\n                                                    ""key"": ""group_id"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""group_id""],\n                                                    ""ref"": [\n                                                      ""metabase_update.pgm.group_id""\n                                                    ],\n                                                    ""rowid_filter"": {\n                                                      ""range"": {\n                                                        ""key"": ""idx_permissions_perm_type"",\n                                                        ""used_key_parts"": [\n                                                          ""perm_type""\n                                                        ]\n                                                      },\n                                                      ""rows"": 32083,\n                                                      ""selectivity_pct"": 50\n                                                    },\n                                                    ""rows"": 445,\n                                                    ""filtered"": 28.03587532,\n                                                    ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and p.collection_id is not null""\n                                                  },\n                                                  ""table"": {\n                                                    ""table_name"": ""c"",\n                                                    ""access_type"": ""eq_ref"",\n                                                    ""possible_keys"": [""PRIMARY""],\n                                                    ""key"": ""PRIMARY"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""id""],\n                                                    ""ref"": [\n                                                      ""metabase_update.p.collection_id""\n                                                    ],\n                                                    ""rows"": 1,\n                                                    ""filtered"": 100,\n                                                    ""attached_condition"": ""c.archived = 0""\n                                                  }\n                                                }\n                                              },\n                                              {\n                                                ""query_block"": {\n                                                  ""select_id"": 15,\n                                                  ""operation"": ""UNION"",\n                                                  ""table"": {\n                                                    ""table_name"": ""c"",\n                                                    ""access_type"": ""ref"",\n                                                    ""possible_keys"": [\n                                                      ""idx_collection_type""\n                                                    ],\n                                                    ""key"": ""idx_collection_type"",\n                                                    ""key_length"": ""1027"",\n                                                    ""used_key_parts"": [""type""],\n                                                    ""ref"": [""const""],\n                                                    ""rows"": 1,\n                                                    ""filtered"": 100,\n                                                    ""index_condition"": ""c.`type` = \'trash\'"",\n                                                    ""attached_condition"": ""c.archived = 0""\n                                                  }\n                                                }\n                                              },\n                                              {\n                                                ""query_block"": {\n                                                  ""select_id"": 16,\n                                                  ""operation"": ""UNION"",\n                                                  ""table"": {\n                                                    ""table_name"": ""c"",\n                                                    ""access_type"": ""const"",\n                                                    ""possible_keys"": [""PRIMARY""],\n                                                    ""key"": ""PRIMARY"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""id""],\n                                                    ""ref"": [""const""],\n                                                    ""rows"": 1,\n                                                    ""filtered"": 100\n                                                  }\n                                                }\n                                              }\n                                            ]\n                                          }\n                                        }\n                                      }\n                                    }\n                                  }\n                                }\n                              ]\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  },\n                  {\n                    ""query_block"": {\n                      ""select_id"": 17,\n                      ""operation"": ""UNION"",\n                      ""table"": {\n                        ""table_name"": ""d"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [""idx_dashboard_collection_id""],\n                        ""key"": ""idx_dashboard_collection_id"",\n                        ""key_length"": ""5"",\n                        ""used_key_parts"": [""collection_id""],\n                        ""ref"": [""const""],\n                        ""rows"": 9,\n                        ""filtered"": 100,\n                        ""index_condition"": ""d.collection_id is null"",\n                        ""attached_condition"": ""d.archived = 0 and (d.collection_id is null or <in_optimizer>(d.collection_id,<exists>(subquery#18))) and d.archived_directly <> 1 and d.collection_position is null""\n                      },\n                      ""table"": {\n                        ""table_name"": ""mr"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_moderation_review_item_type_item_id""\n                        ],\n                        ""key"": ""idx_moderation_review_item_type_item_id"",\n                        ""key_length"": ""1026"",\n                        ""used_key_parts"": [\n                          ""moderated_item_type"",\n                          ""moderated_item_id""\n                        ],\n                        ""ref"": [""const"", ""metabase_update.d.id""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = \'dashboard\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""r"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_revision_model_model_id"",\n                          ""idx_revision_most_recent""\n                        ],\n                        ""key"": ""idx_revision_model_model_id"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""model_id""],\n                        ""ref"": [""metabase_update.d.id""],\n                        ""rows"": 1,\n                        ""filtered"": 50,\n                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = \'Dashboard\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""u"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.r.user_id""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""\n                      },\n                      ""subqueries"": [\n                        {\n                          ""query_block"": {\n                            ""select_id"": 18,\n                            ""table"": {\n                              ""table_name"": ""<derived19>"",\n                              ""access_type"": ""index_subquery"",\n                              ""possible_keys"": [""key0""],\n                              ""key"": ""key0"",\n                              ""key_length"": ""4"",\n                              ""used_key_parts"": [""id""],\n                              ""ref"": [""func""],\n                              ""rows"": 1958,\n                              ""filtered"": 100,\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""union_result"": {\n                                    ""table_name"": ""<union19,20,21>"",\n                                    ""access_type"": ""ALL"",\n                                    ""query_specifications"": [\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 19,\n                                          ""table"": {\n                                            ""table_name"": ""pgm"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""unique_permissions_group_membership_user_id_group_id"",\n                                              ""idx_permissions_group_membership_group_id"",\n                                              ""idx_permissions_group_membership_user_id"",\n                                              ""idx_permissions_group_membership_group_id_user_id""\n                                            ],\n                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""user_id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 44,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""pg"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""p"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""group_id"",\n                                              ""idx_permissions_group_id"",\n                                              ""idx_permissions_collection_id"",\n                                              ""idx_permissions_perm_type"",\n                                              ""idx_permissions_perm_value""\n                                            ],\n                                            ""key"": ""group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""group_id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rowid_filter"": {\n                                              ""range"": {\n                                                ""key"": ""idx_permissions_collection_id"",\n                                                ""used_key_parts"": [""collection_id""]\n                                              },\n                                              ""rows"": 32084,\n                                              ""selectivity_pct"": 50.00155846\n                                            },\n                                            ""rows"": 445,\n                                            ""filtered"": 14.01837444,\n                                            ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and 1 <> p.collection_id and p.collection_id is not null""\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [\n                                              ""metabase_update.p.collection_id""\n                                            ],\n                                            ""rows"": 1,\n                                            ""filtered"": 100\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 20,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_type""\n                                            ],\n                                            ""key"": ""idx_collection_type"",\n                                            ""key_length"": ""1027"",\n                                            ""used_key_parts"": [""type""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""index_condition"": ""c.`type` = \'trash\' and 1 <> c.`id`""\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 21,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""const"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100\n                                          }\n                                        }\n                                      }\n                                    ]\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  },\n                  {\n                    ""query_block"": {\n                      ""select_id"": 22,\n                      ""operation"": ""UNION"",\n                      ""table"": {\n                        ""table_name"": ""c"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [""idx_card_collection_id""],\n                        ""key"": ""idx_card_collection_id"",\n                        ""key_length"": ""5"",\n                        ""used_key_parts"": [""collection_id""],\n                        ""ref"": [""const""],\n                        ""rows"": 102,\n                        ""filtered"": 100,\n                        ""index_condition"": ""c.collection_id is null"",\n                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#23))) and c.`type` = \'model\' and c.collection_position is null""\n                      },\n                      ""table"": {\n                        ""table_name"": ""r"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_revision_model_model_id"",\n                          ""idx_revision_most_recent""\n                        ],\n                        ""key"": ""idx_revision_model_model_id"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""model_id""],\n                        ""ref"": [""metabase_update.c.id""],\n                        ""rows"": 1,\n                        ""filtered"": 50,\n                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = \'Card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""mr"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_moderation_review_item_type_item_id""\n                        ],\n                        ""key"": ""idx_moderation_review_item_type_item_id"",\n                        ""key_length"": ""1026"",\n                        ""used_key_parts"": [\n                          ""moderated_item_type"",\n                          ""moderated_item_id""\n                        ],\n                        ""ref"": [""const"", ""metabase_update.c.id""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = \'card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""u"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.r.user_id""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""\n                      },\n                      ""table"": {\n                        ""table_name"": ""t"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.c.table_id""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""attached_condition"": ""trigcond(trigcond(c.table_id is not null))""\n                      },\n                      ""subqueries"": [\n                        {\n                          ""query_block"": {\n                            ""select_id"": 23,\n                            ""table"": {\n                              ""table_name"": ""<derived24>"",\n                              ""access_type"": ""ALL"",\n                              ""rows"": 19582,\n                              ""filtered"": 100,\n                              ""attached_condition"": ""1 <> c.`id`"",\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""union_result"": {\n                                    ""table_name"": ""<union24,25,26>"",\n                                    ""access_type"": ""ALL"",\n                                    ""query_specifications"": [\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 24,\n                                          ""table"": {\n                                            ""table_name"": ""pgm"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""unique_permissions_group_membership_user_id_group_id"",\n                                              ""idx_permissions_group_membership_group_id"",\n                                              ""idx_permissions_group_membership_user_id"",\n                                              ""idx_permissions_group_membership_group_id_user_id""\n                                            ],\n                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""user_id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 44,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""pg"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""p"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""group_id"",\n                                              ""idx_permissions_group_id"",\n                                              ""idx_permissions_collection_id"",\n                                              ""idx_permissions_perm_type"",\n                                              ""idx_permissions_perm_value""\n                                            ],\n                                            ""key"": ""group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""group_id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rowid_filter"": {\n                                              ""range"": {\n                                                ""key"": ""idx_permissions_collection_id"",\n                                                ""used_key_parts"": [""collection_id""]\n                                              },\n                                              ""rows"": 32084,\n                                              ""selectivity_pct"": 50.00155846\n                                            },\n                                            ""rows"": 445,\n                                            ""filtered"": 14.01837444,\n                                            ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and 1 <> p.collection_id and p.collection_id is not null""\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [\n                                              ""metabase_update.p.collection_id""\n                                            ],\n                                            ""rows"": 1,\n                                            ""filtered"": 100\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 25,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_type""\n                                            ],\n                                            ""key"": ""idx_collection_type"",\n                                            ""key_length"": ""1027"",\n                                            ""used_key_parts"": [""type""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""index_condition"": ""c.`type` = \'trash\' and 1 <> c.`id`""\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 26,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""const"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100\n                                          }\n                                        }\n                                      }\n                                    ]\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  },\n                  {\n                    ""query_block"": {\n                      ""select_id"": 27,\n                      ""operation"": ""UNION"",\n                      ""table"": {\n                        ""table_name"": ""c"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [""idx_card_collection_id""],\n                        ""key"": ""idx_card_collection_id"",\n                        ""key_length"": ""5"",\n                        ""used_key_parts"": [""collection_id""],\n                        ""ref"": [""const""],\n                        ""rows"": 102,\n                        ""filtered"": 100,\n                        ""index_condition"": ""c.collection_id is null"",\n                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#28))) and c.`type` = \'metric\' and c.collection_position is null""\n                      },\n                      ""table"": {\n                        ""table_name"": ""r"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_revision_model_model_id"",\n                          ""idx_revision_most_recent""\n                        ],\n                        ""key"": ""idx_revision_model_model_id"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""model_id""],\n                        ""ref"": [""metabase_update.c.id""],\n                        ""rows"": 1,\n                        ""filtered"": 50,\n                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = \'Card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""mr"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_moderation_review_item_type_item_id""\n                        ],\n                        ""key"": ""idx_moderation_review_item_type_item_id"",\n                        ""key_length"": ""1026"",\n                        ""used_key_parts"": [\n                          ""moderated_item_type"",\n                          ""moderated_item_id""\n                        ],\n                        ""ref"": [""const"", ""metabase_update.c.id""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = \'card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""u"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.r.user_id""],\n                        ""rows"": 1,\n                        ""filtered"": 100,\n                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""\n                      },\n                      ""subqueries"": [\n                        {\n                          ""query_block"": {\n                            ""select_id"": 28,\n                            ""table"": {\n                              ""table_name"": ""<derived29>"",\n                              ""access_type"": ""ALL"",\n                              ""rows"": 19582,\n                              ""filtered"": 100,\n                              ""attached_condition"": ""1 <> c.`id`"",\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""union_result"": {\n                                    ""table_name"": ""<union29,30,31>"",\n                                    ""access_type"": ""ALL"",\n                                    ""query_specifications"": [\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 29,\n                                          ""table"": {\n                                            ""table_name"": ""pgm"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""unique_permissions_group_membership_user_id_group_id"",\n                                              ""idx_permissions_group_membership_group_id"",\n                                              ""idx_permissions_group_membership_user_id"",\n                                              ""idx_permissions_group_membership_group_id_user_id""\n                                            ],\n                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""user_id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 44,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""pg"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""p"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""group_id"",\n                                              ""idx_permissions_group_id"",\n                                              ""idx_permissions_collection_id"",\n                                              ""idx_permissions_perm_type"",\n                                              ""idx_permissions_perm_value""\n                                            ],\n                                            ""key"": ""group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""group_id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rowid_filter"": {\n                                              ""range"": {\n                                                ""key"": ""idx_permissions_collection_id"",\n                                                ""used_key_parts"": [""collection_id""]\n                                              },\n                                              ""rows"": 32084,\n                                              ""selectivity_pct"": 50.00155846\n                                            },\n                                            ""rows"": 445,\n                                            ""filtered"": 14.01837444,\n                                            ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and 1 <> p.collection_id and p.collection_id is not null""\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [\n                                              ""metabase_update.p.collection_id""\n                                            ],\n                                            ""rows"": 1,\n                                            ""filtered"": 100\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 30,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_type""\n                                            ],\n                                            ""key"": ""idx_collection_type"",\n                                            ""key_length"": ""1027"",\n                                            ""used_key_parts"": [""type""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100,\n                                            ""index_condition"": ""c.`type` = \'trash\' and 1 <> c.`id`""\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 31,\n                                          ""operation"": ""UNION"",\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""const"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""const""],\n                                            ""rows"": 1,\n                                            ""filtered"": 100\n                                          }\n                                        }\n                                      }\n                                    ]\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  }\n                ]\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n</details>\n\n3.\n<details>\n<summary>Results</summary>\n\n```\n{\n  ""query_block"": {\n    ""select_id"": 1,\n    ""r_loops"": 1,\n    ""r_total_time_ms"": 1433.735201,\n    ""read_sorted_file"": {\n      ""r_rows"": 25,\n      ""filesort"": {\n        ""sort_key"": ""case when dummy_alias.authority_level = \'official\' then 0 else 1 end, case when dummy_alias.collection_type is null then 0 when dummy_alias.collection_type = \'trash\' then 1 else 2 end, lcase(dummy_alias.`name`)"",\n        ""r_loops"": 1,\n        ""r_total_time_ms"": 0.094719873,\n        ""r_limit"": 25,\n        ""r_used_priority_queue"": false,\n        ""r_output_rows"": 54,\n        ""r_buffer_size"": ""66Kb"",\n        ""r_sort_mode"": ""sort_key,rowid"",\n        ""table"": {\n          ""table_name"": ""<derived2>"",\n          ""access_type"": ""ALL"",\n          ""r_loops"": 1,\n          ""rows"": 20987,\n          ""r_rows"": 54,\n          ""r_table_time_ms"": 0.17856957,\n          ""r_other_time_ms"": 0.118990126,\n          ""filtered"": 100,\n          ""r_filtered"": 100,\n          ""materialized"": {\n            ""query_block"": {\n              ""union_result"": {\n                ""table_name"": ""<union2,7,17,22,27>"",\n                ""access_type"": ""ALL"",\n                ""r_loops"": 0,\n                ""r_rows"": null,\n                ""query_specifications"": [\n                  {\n                    ""query_block"": {\n                      ""select_id"": 2,\n                      ""r_loops"": 1,\n                      ""r_total_time_ms"": 0.914228715,\n                      ""table"": {\n                        ""table_name"": ""c"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [""idx_card_collection_id""],\n                        ""key"": ""idx_card_collection_id"",\n                        ""key_length"": ""5"",\n                        ""used_key_parts"": [""collection_id""],\n                        ""ref"": [""const""],\n                        ""r_loops"": 1,\n                        ""rows"": 102,\n                        ""r_rows"": 102,\n                        ""r_table_time_ms"": 0.507976123,\n                        ""r_other_time_ms"": 0.033438159,\n                        ""filtered"": 100,\n                        ""r_filtered"": 2.941176471,\n                        ""index_condition"": ""c.collection_id is null"",\n                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#3))) and c.`type` = \'question\' and c.collection_position is null""\n                      },\n                      ""table"": {\n                        ""table_name"": ""r"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_revision_model_model_id"",\n                          ""idx_revision_most_recent""\n                        ],\n                        ""key"": ""idx_revision_model_model_id"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""model_id""],\n                        ""ref"": [""metabase_update.c.id""],\n                        ""r_loops"": 3,\n                        ""rows"": 1,\n                        ""r_rows"": 6.333333333,\n                        ""r_table_time_ms"": 0.163624812,\n                        ""r_other_time_ms"": 0.049678306,\n                        ""filtered"": 50,\n                        ""r_filtered"": 15.78947368,\n                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = \'Card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""mr"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_moderation_review_item_type_item_id""\n                        ],\n                        ""key"": ""idx_moderation_review_item_type_item_id"",\n                        ""key_length"": ""1026"",\n                        ""used_key_parts"": [\n                          ""moderated_item_type"",\n                          ""moderated_item_id""\n                        ],\n                        ""ref"": [""const"", ""metabase_update.c.id""],\n                        ""r_loops"": 3,\n                        ""rows"": 1,\n                        ""r_rows"": 0,\n                        ""r_table_time_ms"": 0.00724871,\n                        ""r_other_time_ms"": 0.007980016,\n                        ""filtered"": 100,\n                        ""r_filtered"": 100,\n                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = \'card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""u"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.r.user_id""],\n                        ""r_loops"": 3,\n                        ""rows"": 1,\n                        ""r_rows"": 1,\n                        ""r_table_time_ms"": 0.019117207,\n                        ""r_other_time_ms"": 0.052030197,\n                        ""filtered"": 100,\n                        ""r_filtered"": 100,\n                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""\n                      },\n                      ""subqueries"": [\n                        {\n                          ""query_block"": {\n                            ""select_id"": 3,\n                            ""table"": {\n                              ""table_name"": ""<derived4>"",\n                              ""access_type"": ""ALL"",\n                              ""r_loops"": 0,\n                              ""rows"": 19582,\n                              ""r_rows"": null,\n                              ""filtered"": 100,\n                              ""r_filtered"": null,\n                              ""attached_condition"": ""1 <> c.`id`"",\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""select_id"": 4,\n                                  ""table"": {\n                                    ""table_name"": ""pgm"",\n                                    ""access_type"": ""ref"",\n                                    ""possible_keys"": [\n                                      ""unique_permissions_group_membership_user_id_group_id"",\n                                      ""idx_permissions_group_membership_group_id"",\n                                      ""idx_permissions_group_membership_user_id"",\n                                      ""idx_permissions_group_membership_group_id_user_id""\n                                    ],\n                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""user_id""],\n                                    ""ref"": [""const""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 44,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null,\n                                    ""using_index"": true\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""pg"",\n                                    ""access_type"": ""eq_ref"",\n                                    ""possible_keys"": [""PRIMARY""],\n                                    ""key"": ""PRIMARY"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""id""],\n                                    ""ref"": [""metabase_update.pgm.group_id""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 1,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null,\n                                    ""using_index"": true\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""p"",\n                                    ""access_type"": ""ref"",\n                                    ""possible_keys"": [\n                                      ""group_id"",\n                                      ""idx_permissions_group_id"",\n                                      ""idx_permissions_collection_id"",\n                                      ""idx_permissions_perm_type"",\n                                      ""idx_permissions_perm_value""\n                                    ],\n                                    ""key"": ""group_id"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""group_id""],\n                                    ""ref"": [""metabase_update.pgm.group_id""],\n                                    ""rowid_filter"": {\n                                      ""range"": {\n                                        ""key"": ""idx_permissions_collection_id"",\n                                        ""used_key_parts"": [""collection_id""]\n                                      },\n                                      ""rows"": 32084,\n                                      ""selectivity_pct"": 50.00155846,\n                                      ""r_rows"": 0,\n                                      ""r_selectivity_pct"": 0,\n                                      ""r_buffer_size"": 0,\n                                      ""r_filling_time_ms"": 0\n                                    },\n                                    ""r_loops"": 0,\n                                    ""rows"": 445,\n                                    ""r_rows"": null,\n                                    ""filtered"": 14.01837444,\n                                    ""r_filtered"": null,\n                                    ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and 1 <> p.collection_id and p.collection_id is not null""\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""c"",\n                                    ""access_type"": ""eq_ref"",\n                                    ""possible_keys"": [""PRIMARY""],\n                                    ""key"": ""PRIMARY"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""id""],\n                                    ""ref"": [""metabase_update.p.collection_id""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 1,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  },\n                  {\n                    ""query_block"": {\n                      ""select_id"": 7,\n                      ""operation"": ""UNION"",\n                      ""r_loops"": 1,\n                      ""r_total_time_ms"": 1431.307217,\n                      ""table"": {\n                        ""table_name"": ""col"",\n                        ""access_type"": ""ALL"",\n                        ""possible_keys"": [\n                          ""PRIMARY"",\n                          ""unique_collection_personal_owner_id"",\n                          ""idx_collection_personal_owner_id""\n                        ],\n                        ""r_loops"": 1,\n                        ""rows"": 3005,\n                        ""r_rows"": 3069,\n                        ""r_table_time_ms"": 2.461259097,\n                        ""r_other_time_ms"": 0.727278414,\n                        ""filtered"": 68.78535461,\n                        ""r_filtered"": 52.68817204,\n                        ""attached_condition"": ""col.archived = 0 and col.personal_owner_id is null and col.`id` <> 1 and (col.namespace is null or col.namespace = \'analytics\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""<subquery8>"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""distinct_key""],\n                        ""key"": ""distinct_key"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""func""],\n                        ""r_loops"": 1617,\n                        ""rows"": 1,\n                        ""r_rows"": 0.031539889,\n                        ""r_table_time_ms"": 0.393970665,\n                        ""r_other_time_ms"": 0.310406863,\n                        ""filtered"": 100,\n                        ""r_filtered"": 100,\n                        ""materialized"": {\n                          ""unique"": 1,\n                          ""query_block"": {\n                            ""select_id"": 8,\n                            ""table"": {\n                              ""table_name"": ""<derived9>"",\n                              ""access_type"": ""ALL"",\n                              ""r_loops"": 1,\n                              ""rows"": 19582,\n                              ""r_rows"": 36185,\n                              ""r_table_time_ms"": 48.94402769,\n                              ""r_other_time_ms"": 36.49905424,\n                              ""filtered"": 100,\n                              ""r_filtered"": 3.4295979,\n                              ""attached_condition"": ""c.archived = 0 and c.location like \'/%\' and !<in_optimizer>(1,exists(subquery#12))"",\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""union_result"": {\n                                    ""table_name"": ""<union9,10,11>"",\n                                    ""access_type"": ""ALL"",\n                                    ""r_loops"": 0,\n                                    ""r_rows"": null,\n                                    ""query_specifications"": [\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 9,\n                                          ""r_loops"": 1,\n                                          ""r_total_time_ms"": 442.0156915,\n                                          ""table"": {\n                                            ""table_name"": ""pgm"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""unique_permissions_group_membership_user_id_group_id"",\n                                              ""idx_permissions_group_membership_group_id"",\n                                              ""idx_permissions_group_membership_user_id"",\n                                              ""idx_permissions_group_membership_group_id_user_id""\n                                            ],\n                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""user_id""],\n                                            ""ref"": [""const""],\n                                            ""r_loops"": 1,\n                                            ""rows"": 44,\n                                            ""r_rows"": 44,\n                                            ""r_table_time_ms"": 0.049427089,\n                                            ""r_other_time_ms"": 0.029196355,\n                                            ""filtered"": 100,\n                                            ""r_filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""pg"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [""PRIMARY""],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""r_loops"": 44,\n                                            ""rows"": 1,\n                                            ""r_rows"": 1,\n                                            ""r_table_time_ms"": 0.114428906,\n                                            ""r_other_time_ms"": 0.020729701,\n                                            ""filtered"": 100,\n                                            ""r_filtered"": 100,\n                                            ""using_index"": true\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""p"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""group_id"",\n                                              ""idx_permissions_group_id"",\n                                              ""idx_permissions_collection_id"",\n                                              ""idx_permissions_perm_type"",\n                                              ""idx_permissions_perm_value""\n                                            ],\n                                            ""key"": ""group_id"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""group_id""],\n                                            ""ref"": [""metabase_update.pgm.group_id""],\n                                            ""rowid_filter"": {\n                                              ""range"": {\n                                                ""key"": ""idx_permissions_collection_id"",\n                                                ""used_key_parts"": [""collection_id""]\n                                              },\n                                              ""rows"": 32084,\n                                              ""selectivity_pct"": 50.00155846,\n                                              ""r_rows"": 64254,\n                                              ""r_selectivity_pct"": 99.83222939,\n                                              ""r_buffer_size"": 32127,\n                                              ""r_filling_time_ms"": 14.12524787\n                                            },\n                                            ""r_loops"": 44,\n                                            ""rows"": 445,\n                                            ""r_rows"": 1041.340909,\n                                            ""r_table_time_ms"": 158.8915124,\n                                            ""r_other_time_ms"": 31.15108417,\n                                            ""filtered"": 14.01837444,\n                                            ""r_filtered"": 100,\n                                            ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and p.collection_id <> 1 and p.collection_id is not null""\n                                          },\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""eq_ref"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_location""\n                                            ],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [\n                                              ""metabase_update.p.collection_id""\n                                            ],\n                                            ""r_loops"": 45819,\n                                            ""rows"": 1,\n                                            ""r_rows"": 1,\n                                            ""r_table_time_ms"": 112.3951438,\n                                            ""r_other_time_ms"": 91.45252253,\n                                            ""filtered"": 100,\n                                            ""r_filtered"": 78.96942317,\n                                            ""attached_condition"": ""c.archived = 0 and c.location like \'/%\'""\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 10,\n                                          ""operation"": ""UNION"",\n                                          ""r_loops"": 1,\n                                          ""r_total_time_ms"": 0.039022744,\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""ref"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_location"",\n                                              ""idx_collection_type""\n                                            ],\n                                            ""key"": ""idx_collection_type"",\n                                            ""key_length"": ""1027"",\n                                            ""used_key_parts"": [""type""],\n                                            ""ref"": [""const""],\n                                            ""r_loops"": 1,\n                                            ""rows"": 1,\n                                            ""r_rows"": 1,\n                                            ""r_table_time_ms"": 0.016827735,\n                                            ""r_other_time_ms"": 0.008586869,\n                                            ""filtered"": 100,\n                                            ""r_filtered"": 100,\n                                            ""index_condition"": ""c.`type` = \'trash\' and c.`id` <> 1"",\n                                            ""attached_condition"": ""c.archived = 0 and c.location like \'/%\'""\n                                          }\n                                        }\n                                      },\n                                      {\n                                        ""query_block"": {\n                                          ""select_id"": 11,\n                                          ""operation"": ""UNION"",\n                                          ""r_loops"": 1,\n                                          ""r_total_time_ms"": 0.013449011,\n                                          ""table"": {\n                                            ""table_name"": ""c"",\n                                            ""access_type"": ""const"",\n                                            ""possible_keys"": [\n                                              ""PRIMARY"",\n                                              ""idx_collection_location""\n                                            ],\n                                            ""key"": ""PRIMARY"",\n                                            ""key_length"": ""4"",\n                                            ""used_key_parts"": [""id""],\n                                            ""ref"": [""const""],\n                                            ""r_loops"": 0,\n                                            ""rows"": 1,\n                                            ""r_rows"": null,\n                                            ""filtered"": 100,\n                                            ""r_filtered"": null\n                                          }\n                                        }\n                                      }\n                                    ]\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      },\n                      ""subqueries"": [\n                        {\n                          ""expression_cache"": {\n                            ""r_loops"": 36185,\n                            ""r_hit_ratio"": 98.36672654,\n                            ""query_block"": {\n                              ""select_id"": 12,\n                              ""r_loops"": 591,\n                              ""r_total_time_ms"": 940.3421075,\n                              ""table"": {\n                                ""table_name"": ""c2"",\n                                ""access_type"": ""ALL"",\n                                ""r_loops"": 591,\n                                ""rows"": 3005,\n                                ""r_rows"": 1330.812183,\n                                ""r_table_time_ms"": 233.5442391,\n                                ""r_other_time_ms"": 236.8202833,\n                                ""filtered"": 100,\n                                ""r_filtered"": 0.075014939,\n                                ""attached_condition"": ""<in_optimizer>(c2.`id`,c2.`id` in (subquery#13)) and c.location = concat(c2.location,c2.`id`,\'/\')""\n                              },\n                              ""subqueries"": [\n                                {\n                                  ""query_block"": {\n                                    ""select_id"": 13,\n                                    ""r_loops"": 1,\n                                    ""r_total_time_ms"": 468.7988468,\n                                    ""table"": {\n                                      ""table_name"": ""<derived14>"",\n                                      ""access_type"": ""ALL"",\n                                      ""r_loops"": 1,\n                                      ""rows"": 19582,\n                                      ""r_rows"": 36185,\n                                      ""r_table_time_ms"": 49.52882982,\n                                      ""r_other_time_ms"": 11.45762265,\n                                      ""filtered"": 100,\n                                      ""r_filtered"": 100,\n                                      ""attached_condition"": ""c.archived = 0"",\n                                      ""materialized"": {\n                                        ""query_block"": {\n                                          ""union_result"": {\n                                            ""table_name"": ""<union14,15,16>"",\n                                            ""access_type"": ""ALL"",\n                                            ""r_loops"": 0,\n                                            ""r_rows"": null,\n                                            ""query_specifications"": [\n                                              {\n                                                ""query_block"": {\n                                                  ""select_id"": 14,\n                                                  ""r_loops"": 1,\n                                                  ""r_total_time_ms"": 450.495086,\n                                                  ""table"": {\n                                                    ""table_name"": ""pgm"",\n                                                    ""access_type"": ""ref"",\n                                                    ""possible_keys"": [\n                                                      ""unique_permissions_group_membership_user_id_group_id"",\n                                                      ""idx_permissions_group_membership_group_id"",\n                                                      ""idx_permissions_group_membership_user_id"",\n                                                      ""idx_permissions_group_membership_group_id_user_id""\n                                                    ],\n                                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""user_id""],\n                                                    ""ref"": [""const""],\n                                                    ""r_loops"": 1,\n                                                    ""rows"": 44,\n                                                    ""r_rows"": 44,\n                                                    ""r_table_time_ms"": 0.046736516,\n                                                    ""r_other_time_ms"": 0.029102341,\n                                                    ""filtered"": 100,\n                                                    ""r_filtered"": 100,\n                                                    ""using_index"": true\n                                                  },\n                                                  ""table"": {\n                                                    ""table_name"": ""pg"",\n                                                    ""access_type"": ""eq_ref"",\n                                                    ""possible_keys"": [""PRIMARY""],\n                                                    ""key"": ""PRIMARY"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""id""],\n                                                    ""ref"": [\n                                                      ""metabase_update.pgm.group_id""\n                                                    ],\n                                                    ""r_loops"": 44,\n                                                    ""rows"": 1,\n                                                    ""r_rows"": 1,\n                                                    ""r_table_time_ms"": 0.115396402,\n                                                    ""r_other_time_ms"": 0.020362892,\n                                                    ""filtered"": 100,\n                                                    ""r_filtered"": 100,\n                                                    ""using_index"": true\n                                                  },\n                                                  ""table"": {\n                                                    ""table_name"": ""p"",\n                                                    ""access_type"": ""ref"",\n                                                    ""possible_keys"": [\n                                                      ""group_id"",\n                                                      ""idx_permissions_group_id"",\n                                                      ""idx_permissions_collection_id"",\n                                                      ""idx_permissions_perm_type"",\n                                                      ""idx_permissions_perm_value""\n                                                    ],\n                                                    ""key"": ""group_id"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""group_id""],\n                                                    ""ref"": [\n                                                      ""metabase_update.pgm.group_id""\n                                                    ],\n                                                    ""rowid_filter"": {\n                                                      ""range"": {\n                                                        ""key"": ""idx_permissions_perm_type"",\n                                                        ""used_key_parts"": [\n                                                          ""perm_type""\n                                                        ]\n                                                      },\n                                                      ""rows"": 32083,\n                                                      ""selectivity_pct"": 50,\n                                                      ""r_rows"": 64254,\n                                                      ""r_selectivity_pct"": 99.83222939,\n                                                      ""r_buffer_size"": 32127,\n                                                      ""r_filling_time_ms"": 29.6478751\n                                                    },\n                                                    ""r_loops"": 44,\n                                                    ""rows"": 445,\n                                                    ""r_rows"": 1041.340909,\n                                                    ""r_table_time_ms"": 171.5801775,\n                                                    ""r_other_time_ms"": 29.28639475,\n                                                    ""filtered"": 28.03587532,\n                                                    ""r_filtered"": 100,\n                                                    ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and p.collection_id is not null""\n                                                  },\n                                                  ""table"": {\n                                                    ""table_name"": ""c"",\n                                                    ""access_type"": ""eq_ref"",\n                                                    ""possible_keys"": [""PRIMARY""],\n                                                    ""key"": ""PRIMARY"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""id""],\n                                                    ""ref"": [\n                                                      ""metabase_update.p.collection_id""\n                                                    ],\n                                                    ""r_loops"": 45819,\n                                                    ""rows"": 1,\n                                                    ""r_rows"": 1,\n                                                    ""r_table_time_ms"": 114.4012757,\n                                                    ""r_other_time_ms"": 85.43069366,\n                                                    ""filtered"": 100,\n                                                    ""r_filtered"": 78.96942317,\n                                                    ""attached_condition"": ""c.archived = 0""\n                                                  }\n                                                }\n                                              },\n                                              {\n                                                ""query_block"": {\n                                                  ""select_id"": 15,\n                                                  ""operation"": ""UNION"",\n                                                  ""r_loops"": 1,\n                                                  ""r_total_time_ms"": 0.03273498,\n                                                  ""table"": {\n                                                    ""table_name"": ""c"",\n                                                    ""access_type"": ""ref"",\n                                                    ""possible_keys"": [\n                                                      ""idx_collection_type""\n                                                    ],\n                                                    ""key"": ""idx_collection_type"",\n                                                    ""key_length"": ""1027"",\n                                                    ""used_key_parts"": [""type""],\n                                                    ""ref"": [""const""],\n                                                    ""r_loops"": 1,\n                                                    ""rows"": 1,\n                                                    ""r_rows"": 1,\n                                                    ""r_table_time_ms"": 0.015001397,\n                                                    ""r_other_time_ms"": 0.006194135,\n                                                    ""filtered"": 100,\n                                                    ""r_filtered"": 100,\n                                                    ""index_condition"": ""c.`type` = \'trash\'"",\n                                                    ""attached_condition"": ""c.archived = 0""\n                                                  }\n                                                }\n                                              },\n                                              {\n                                                ""query_block"": {\n                                                  ""select_id"": 16,\n                                                  ""operation"": ""UNION"",\n                                                  ""r_loops"": 1,\n                                                  ""r_total_time_ms"": 0.007122331,\n                                                  ""table"": {\n                                                    ""table_name"": ""c"",\n                                                    ""access_type"": ""const"",\n                                                    ""possible_keys"": [""PRIMARY""],\n                                                    ""key"": ""PRIMARY"",\n                                                    ""key_length"": ""4"",\n                                                    ""used_key_parts"": [""id""],\n                                                    ""ref"": [""const""],\n                                                    ""r_loops"": 0,\n                                                    ""rows"": 1,\n                                                    ""r_rows"": null,\n                                                    ""filtered"": 100,\n                                                    ""r_filtered"": null\n                                                  }\n                                                }\n                                              }\n                                            ]\n                                          }\n                                        }\n                                      }\n                                    }\n                                  }\n                                }\n                              ]\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  },\n                  {\n                    ""query_block"": {\n                      ""select_id"": 17,\n                      ""operation"": ""UNION"",\n                      ""r_loops"": 1,\n                      ""r_total_time_ms"": 0.078355658,\n                      ""table"": {\n                        ""table_name"": ""d"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [""idx_dashboard_collection_id""],\n                        ""key"": ""idx_dashboard_collection_id"",\n                        ""key_length"": ""5"",\n                        ""used_key_parts"": [""collection_id""],\n                        ""ref"": [""const""],\n                        ""r_loops"": 1,\n                        ""rows"": 9,\n                        ""r_rows"": 9,\n                        ""r_table_time_ms"": 0.061394608,\n                        ""r_other_time_ms"": 0.00793378,\n                        ""filtered"": 100,\n                        ""r_filtered"": 0,\n                        ""index_condition"": ""d.collection_id is null"",\n                        ""attached_condition"": ""d.archived = 0 and (d.collection_id is null or <in_optimizer>(d.collection_id,<exists>(subquery#18))) and d.archived_directly <> 1 and d.collection_position is null""\n                      },\n                      ""table"": {\n                        ""table_name"": ""mr"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_moderation_review_item_type_item_id""\n                        ],\n                        ""key"": ""idx_moderation_review_item_type_item_id"",\n                        ""key_length"": ""1026"",\n                        ""used_key_parts"": [\n                          ""moderated_item_type"",\n                          ""moderated_item_id""\n                        ],\n                        ""ref"": [""const"", ""metabase_update.d.id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 100,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = \'dashboard\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""r"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_revision_model_model_id"",\n                          ""idx_revision_most_recent""\n                        ],\n                        ""key"": ""idx_revision_model_model_id"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""model_id""],\n                        ""ref"": [""metabase_update.d.id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 50,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = \'Dashboard\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""u"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.r.user_id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 100,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""\n                      },\n                      ""subqueries"": [\n                        {\n                          ""query_block"": {\n                            ""select_id"": 18,\n                            ""table"": {\n                              ""table_name"": ""<derived19>"",\n                              ""access_type"": ""index_subquery"",\n                              ""possible_keys"": [""key0""],\n                              ""key"": ""key0"",\n                              ""key_length"": ""4"",\n                              ""used_key_parts"": [""id""],\n                              ""ref"": [""func""],\n                              ""r_loops"": 0,\n                              ""rows"": 1958,\n                              ""r_rows"": null,\n                              ""filtered"": 100,\n                              ""r_filtered"": null,\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""select_id"": 19,\n                                  ""table"": {\n                                    ""table_name"": ""pgm"",\n                                    ""access_type"": ""ref"",\n                                    ""possible_keys"": [\n                                      ""unique_permissions_group_membership_user_id_group_id"",\n                                      ""idx_permissions_group_membership_group_id"",\n                                      ""idx_permissions_group_membership_user_id"",\n                                      ""idx_permissions_group_membership_group_id_user_id""\n                                    ],\n                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""user_id""],\n                                    ""ref"": [""const""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 44,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null,\n                                    ""using_index"": true\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""pg"",\n                                    ""access_type"": ""eq_ref"",\n                                    ""possible_keys"": [""PRIMARY""],\n                                    ""key"": ""PRIMARY"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""id""],\n                                    ""ref"": [""metabase_update.pgm.group_id""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 1,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null,\n                                    ""using_index"": true\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""p"",\n                                    ""access_type"": ""ref"",\n                                    ""possible_keys"": [\n                                      ""group_id"",\n                                      ""idx_permissions_group_id"",\n                                      ""idx_permissions_collection_id"",\n                                      ""idx_permissions_perm_type"",\n                                      ""idx_permissions_perm_value""\n                                    ],\n                                    ""key"": ""group_id"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""group_id""],\n                                    ""ref"": [""metabase_update.pgm.group_id""],\n                                    ""rowid_filter"": {\n                                      ""range"": {\n                                        ""key"": ""idx_permissions_collection_id"",\n                                        ""used_key_parts"": [""collection_id""]\n                                      },\n                                      ""rows"": 32084,\n                                      ""selectivity_pct"": 50.00155846,\n                                      ""r_rows"": 0,\n                                      ""r_selectivity_pct"": 0,\n                                      ""r_buffer_size"": 0,\n                                      ""r_filling_time_ms"": 0\n                                    },\n                                    ""r_loops"": 0,\n                                    ""rows"": 445,\n                                    ""r_rows"": null,\n                                    ""filtered"": 14.01837444,\n                                    ""r_filtered"": null,\n                                    ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and 1 <> p.collection_id and p.collection_id is not null""\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""c"",\n                                    ""access_type"": ""eq_ref"",\n                                    ""possible_keys"": [""PRIMARY""],\n                                    ""key"": ""PRIMARY"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""id""],\n                                    ""ref"": [""metabase_update.p.collection_id""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 1,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  },\n                  {\n                    ""query_block"": {\n                      ""select_id"": 22,\n                      ""operation"": ""UNION"",\n                      ""r_loops"": 1,\n                      ""r_total_time_ms"": 0.362247877,\n                      ""table"": {\n                        ""table_name"": ""c"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [""idx_card_collection_id""],\n                        ""key"": ""idx_card_collection_id"",\n                        ""key_length"": ""5"",\n                        ""used_key_parts"": [""collection_id""],\n                        ""ref"": [""const""],\n                        ""r_loops"": 1,\n                        ""rows"": 102,\n                        ""r_rows"": 102,\n                        ""r_table_time_ms"": 0.340121451,\n                        ""r_other_time_ms"": 0.0153474,\n                        ""filtered"": 100,\n                        ""r_filtered"": 0,\n                        ""index_condition"": ""c.collection_id is null"",\n                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#23))) and c.`type` = \'model\' and c.collection_position is null""\n                      },\n                      ""table"": {\n                        ""table_name"": ""r"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_revision_model_model_id"",\n                          ""idx_revision_most_recent""\n                        ],\n                        ""key"": ""idx_revision_model_model_id"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""model_id""],\n                        ""ref"": [""metabase_update.c.id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 50,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = \'Card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""mr"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_moderation_review_item_type_item_id""\n                        ],\n                        ""key"": ""idx_moderation_review_item_type_item_id"",\n                        ""key_length"": ""1026"",\n                        ""used_key_parts"": [\n                          ""moderated_item_type"",\n                          ""moderated_item_id""\n                        ],\n                        ""ref"": [""const"", ""metabase_update.c.id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 100,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = \'card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""u"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.r.user_id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 100,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""\n                      },\n                      ""table"": {\n                        ""table_name"": ""t"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.c.table_id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 100,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(trigcond(c.table_id is not null))""\n                      },\n                      ""subqueries"": [\n                        {\n                          ""query_block"": {\n                            ""select_id"": 23,\n                            ""table"": {\n                              ""table_name"": ""<derived24>"",\n                              ""access_type"": ""ALL"",\n                              ""r_loops"": 0,\n                              ""rows"": 19582,\n                              ""r_rows"": null,\n                              ""filtered"": 100,\n                              ""r_filtered"": null,\n                              ""attached_condition"": ""1 <> c.`id`"",\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""select_id"": 24,\n                                  ""table"": {\n                                    ""table_name"": ""pgm"",\n                                    ""access_type"": ""ref"",\n                                    ""possible_keys"": [\n                                      ""unique_permissions_group_membership_user_id_group_id"",\n                                      ""idx_permissions_group_membership_group_id"",\n                                      ""idx_permissions_group_membership_user_id"",\n                                      ""idx_permissions_group_membership_group_id_user_id""\n                                    ],\n                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""user_id""],\n                                    ""ref"": [""const""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 44,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null,\n                                    ""using_index"": true\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""pg"",\n                                    ""access_type"": ""eq_ref"",\n                                    ""possible_keys"": [""PRIMARY""],\n                                    ""key"": ""PRIMARY"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""id""],\n                                    ""ref"": [""metabase_update.pgm.group_id""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 1,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null,\n                                    ""using_index"": true\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""p"",\n                                    ""access_type"": ""ref"",\n                                    ""possible_keys"": [\n                                      ""group_id"",\n                                      ""idx_permissions_group_id"",\n                                      ""idx_permissions_collection_id"",\n                                      ""idx_permissions_perm_type"",\n                                      ""idx_permissions_perm_value""\n                                    ],\n                                    ""key"": ""group_id"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""group_id""],\n                                    ""ref"": [""metabase_update.pgm.group_id""],\n                                    ""rowid_filter"": {\n                                      ""range"": {\n                                        ""key"": ""idx_permissions_collection_id"",\n                                        ""used_key_parts"": [""collection_id""]\n                                      },\n                                      ""rows"": 32084,\n                                      ""selectivity_pct"": 50.00155846,\n                                      ""r_rows"": 0,\n                                      ""r_selectivity_pct"": 0,\n                                      ""r_buffer_size"": 0,\n                                      ""r_filling_time_ms"": 0\n                                    },\n                                    ""r_loops"": 0,\n                                    ""rows"": 445,\n                                    ""r_rows"": null,\n                                    ""filtered"": 14.01837444,\n                                    ""r_filtered"": null,\n                                    ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and 1 <> p.collection_id and p.collection_id is not null""\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""c"",\n                                    ""access_type"": ""eq_ref"",\n                                    ""possible_keys"": [""PRIMARY""],\n                                    ""key"": ""PRIMARY"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""id""],\n                                    ""ref"": [""metabase_update.p.collection_id""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 1,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  },\n                  {\n                    ""query_block"": {\n                      ""select_id"": 27,\n                      ""operation"": ""UNION"",\n                      ""r_loops"": 1,\n                      ""r_total_time_ms"": 0.264037156,\n                      ""table"": {\n                        ""table_name"": ""c"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [""idx_card_collection_id""],\n                        ""key"": ""idx_card_collection_id"",\n                        ""key_length"": ""5"",\n                        ""used_key_parts"": [""collection_id""],\n                        ""ref"": [""const""],\n                        ""r_loops"": 1,\n                        ""rows"": 102,\n                        ""r_rows"": 102,\n                        ""r_table_time_ms"": 0.243571002,\n                        ""r_other_time_ms"": 0.014213838,\n                        ""filtered"": 100,\n                        ""r_filtered"": 0,\n                        ""index_condition"": ""c.collection_id is null"",\n                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#28))) and c.`type` = \'metric\' and c.collection_position is null""\n                      },\n                      ""table"": {\n                        ""table_name"": ""r"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_revision_model_model_id"",\n                          ""idx_revision_most_recent""\n                        ],\n                        ""key"": ""idx_revision_model_model_id"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""model_id""],\n                        ""ref"": [""metabase_update.c.id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 50,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = \'Card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""mr"",\n                        ""access_type"": ""ref"",\n                        ""possible_keys"": [\n                          ""idx_moderation_review_item_type_item_id""\n                        ],\n                        ""key"": ""idx_moderation_review_item_type_item_id"",\n                        ""key_length"": ""1026"",\n                        ""used_key_parts"": [\n                          ""moderated_item_type"",\n                          ""moderated_item_id""\n                        ],\n                        ""ref"": [""const"", ""metabase_update.c.id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 100,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = \'card\')""\n                      },\n                      ""table"": {\n                        ""table_name"": ""u"",\n                        ""access_type"": ""eq_ref"",\n                        ""possible_keys"": [""PRIMARY""],\n                        ""key"": ""PRIMARY"",\n                        ""key_length"": ""4"",\n                        ""used_key_parts"": [""id""],\n                        ""ref"": [""metabase_update.r.user_id""],\n                        ""r_loops"": 0,\n                        ""rows"": 1,\n                        ""r_rows"": null,\n                        ""filtered"": 100,\n                        ""r_filtered"": null,\n                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""\n                      },\n                      ""subqueries"": [\n                        {\n                          ""query_block"": {\n                            ""select_id"": 28,\n                            ""table"": {\n                              ""table_name"": ""<derived29>"",\n                              ""access_type"": ""ALL"",\n                              ""r_loops"": 0,\n                              ""rows"": 19582,\n                              ""r_rows"": null,\n                              ""filtered"": 100,\n                              ""r_filtered"": null,\n                              ""attached_condition"": ""1 <> c.`id`"",\n                              ""materialized"": {\n                                ""query_block"": {\n                                  ""select_id"": 29,\n                                  ""table"": {\n                                    ""table_name"": ""pgm"",\n                                    ""access_type"": ""ref"",\n                                    ""possible_keys"": [\n                                      ""unique_permissions_group_membership_user_id_group_id"",\n                                      ""idx_permissions_group_membership_group_id"",\n                                      ""idx_permissions_group_membership_user_id"",\n                                      ""idx_permissions_group_membership_group_id_user_id""\n                                    ],\n                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""user_id""],\n                                    ""ref"": [""const""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 44,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null,\n                                    ""using_index"": true\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""pg"",\n                                    ""access_type"": ""eq_ref"",\n                                    ""possible_keys"": [""PRIMARY""],\n                                    ""key"": ""PRIMARY"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""id""],\n                                    ""ref"": [""metabase_update.pgm.group_id""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 1,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null,\n                                    ""using_index"": true\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""p"",\n                                    ""access_type"": ""ref"",\n                                    ""possible_keys"": [\n                                      ""group_id"",\n                                      ""idx_permissions_group_id"",\n                                      ""idx_permissions_collection_id"",\n                                      ""idx_permissions_perm_type"",\n                                      ""idx_permissions_perm_value""\n                                    ],\n                                    ""key"": ""group_id"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""group_id""],\n                                    ""ref"": [""metabase_update.pgm.group_id""],\n                                    ""rowid_filter"": {\n                                      ""range"": {\n                                        ""key"": ""idx_permissions_collection_id"",\n                                        ""used_key_parts"": [""collection_id""]\n                                      },\n                                      ""rows"": 32084,\n                                      ""selectivity_pct"": 50.00155846,\n                                      ""r_rows"": 0,\n                                      ""r_selectivity_pct"": 0,\n                                      ""r_buffer_size"": 0,\n                                      ""r_filling_time_ms"": 0\n                                    },\n                                    ""r_loops"": 0,\n                                    ""rows"": 445,\n                                    ""r_rows"": null,\n                                    ""filtered"": 14.01837444,\n                                    ""r_filtered"": null,\n                                    ""attached_condition"": ""p.perm_type = \'perms/collection-access\' and (p.perm_value = \'read-and-write\' or p.perm_value = \'read\') and 1 <> p.collection_id and p.collection_id is not null""\n                                  },\n                                  ""table"": {\n                                    ""table_name"": ""c"",\n                                    ""access_type"": ""eq_ref"",\n                                    ""possible_keys"": [""PRIMARY""],\n                                    ""key"": ""PRIMARY"",\n                                    ""key_length"": ""4"",\n                                    ""used_key_parts"": [""id""],\n                                    ""ref"": [""metabase_update.p.collection_id""],\n                                    ""r_loops"": 0,\n                                    ""rows"": 1,\n                                    ""r_rows"": null,\n                                    ""filtered"": 100,\n                                    ""r_filtered"": null\n                                  }\n                                }\n                              }\n                            }\n                          }\n                        }\n                      ]\n                    }\n                  }\n                ]\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n</details>', 'created_at': datetime.datetime(2025, 1, 1, 16, 12, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2567065573, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': '> [@ppavlov39](https://github.com/ppavlov39) we will ship 52.5 with a possible fix to this issue, can you test it?\n\nCould you please tell me when this version will be available?', 'created_at': datetime.datetime(2025, 1, 1, 16, 14, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2567130581, 'issue_id': 2752179665, 'author': 'paoliniluis', 'body': ""So... this is simply a result of how we do collection permissions in Metabase (which is currently sub optimal).\n\nThe problem lies in here:\n```\nSELECT 1\nFROM ` collection ` AS ` c2 `\nWHERE ((` c2 `.` id ` IS NULL)\n   OR\n    (` c2 `.` id ` IN (SELECT ` id `\n    FROM (SELECT ` c `.*\n    FROM ` collection ` AS ` c `\n    INNER JOIN ` permissions ` AS ` p ` ON ` c `.` id ` = ` p `.` collection_id `\n    INNER JOIN ` permissions_group ` AS ` pg ` ON ` pg `.` id ` = ` p `.` group_id `\n    INNER JOIN ` permissions_group_membership ` AS ` pgm ` ON ` pgm `.` group_id ` = ` pg `.` id `\n    WHERE (` pgm `.` user_id ` =\n    <insert_problematic_user_id_here\n    >)\n  AND (` p `.` perm_type ` = 'perms/collection-access')\n  AND ((` p `.` perm_value ` = 'read-and-write')\n   OR (` p `.` perm_value ` = 'read'))\n    UNION ALL\n    SELECT ` c `.*\n    FROM ` collection ` AS ` c `\n    WHERE ` type ` = 'trash'\n    UNION ALL\n    SELECT ` c `.*\n    FROM ` collection ` AS ` c `\n    WHERE ` id ` IN (\n    <insert_problematic_collection_id_here\n    >)) AS ` c `\n    WHERE (` archived ` = FALSE))))\n  AND (` c `.` location ` = CONCAT(` c2 `.` location `\n    , ` c2 `.` id `\n    , '/'))))))\n```\n\nrelated to https://github.com/metabase/metabase/issues/46697 and https://github.com/metabase/metabase/issues/36442, probably also to https://github.com/metabase/metabase/issues/48674\n\ntagging @luizarakaki, as there might be 2 ways out of this:\n1) we might be able to optimize the query for the items endpoint\n2) re-do the permission checks for the collections, as this has been in the waiting list for some time now"", 'created_at': datetime.datetime(2025, 1, 1, 20, 6, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2578447261, 'issue_id': 2752179665, 'author': 'noahmoss', 'body': ""@ppavlov39 Metabase 52.5 was released today. Would you be able to update and let us know if the you're still seeing the issue?"", 'created_at': datetime.datetime(2025, 1, 8, 19, 20, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2580006480, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': ""Today I've checked the new version on my laptop in docker connected to the production DB cluster (using separate DB). The problem still persists.\n\n![Image](https://github.com/user-attachments/assets/24a3be15-6478-4445-b95e-8316a17e6ce6)\n\nBelow are the slow logs, maybe they will be useful.\n<details><summary>The first query for path /api/collection/< cid >/items?models=dashboard</summary>\nThe full path is http://127.0.0.1:3000/api/collection/< cid >/items?models=dashboard&models=dataset&models=card&models=metric&models=snippet&models=collection&pinned_state=is_not_pinned&limit=25&offset=0&sort_column=name&sort_direction=asc\n\n\n```sql\n# QC_hit: No\n# Query_time: 2.651719 Lock_time: 0.000907 Rows_sent: 2 Rows_examined: 4\n# Rows_affected: 0 Bytes_sent: 1987\n\nSET timestamp = 1736416431;\nSELECT *\nFROM (SELECT 5                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'card'           AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'question')\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 7            AS `model_ranking`,\n             `id`,\n             `name`,\n             `description`,\n             `entity_id`,\n             NULL         AS `display`,\n             NULL         AS `collection_preview`,\n             NULL         AS `dataset_query`,\n             `id`         AS `collection_id`,\n             `archived_directly`,\n             'collection' AS `model`,\n             NULL         AS `collection_position`,\n             `authority_level`,\n             `personal_owner_id`,\n             `location`,\n             NULL         AS `last_edit_email`,\n             NULL         AS `last_edit_first_name`,\n             NULL         AS `last_edit_last_name`,\n             NULL         AS `moderated_status`,\n             NULL         AS `icon`,\n             NULL         AS `last_edit_user`,\n             NULL         AS `last_edit_timestamp`,\n             NULL         AS `database_id`,\n             `type`       AS `collection_type`,\n             `archived`,\n             NULL         AS `last_used_at`,\n             NULL         AS `table_id`,\n             NULL         AS `is_upload`,\n             NULL         AS `query_type`\n      FROM `collection` AS `col`\n      WHERE ((`id` IN (SELECT `id`\n                       FROM (SELECT `c`.*\n                             FROM `collection` AS `c`\n                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                             WHERE (`pgm`.`user_id` = <USER_ID>)\n                               AND (`p`.`perm_type` = 'perms/collection-access')\n                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `type` = 'trash'\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                       WHERE (`archived` = FALSE)\n                         AND ((`location` LIKE '/441/%') AND\n                              NOT EXISTS(SELECT 1 FROM `collection` AS `c2` WHERE ((`c2`.`id` IS NULL) OR (`c2`.`id` IN (SELECT `id` FROM (SELECT `c`.* FROM `collection` AS `c` INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id` INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id` INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id` WHERE (`pgm`.`user_id` = <USER_ID>) AND (`p`.`perm_type` = 'perms/collection-access') AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read')) UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `type` = 'trash' UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `id` IN (<COLLECTION_ID>)) AS `c` WHERE (`archived` = FALSE)))) AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')) AND (`c2`.`id` <> 441))))))\n        AND (`personal_owner_id` IS NULL)\n        AND ((`archived` = FALSE) AND (`id` <> <ANOTHER_COLLECTION_ID>))\n        AND (`namespace` IS NULL)\n        AND ((`namespace` IS NULL) OR (`namespace` <> 'snippets'))\n        AND (NULL IS NULL)\n      UNION ALL\n      SELECT 1                AS `model_ranking`,\n             `d`.`id`,\n             `d`.`name`,\n             `d`.`description`,\n             `d`.`entity_id`,\n             NULL             AS `display`,\n             NULL             AS `collection_preview`,\n             NULL             AS `dataset_query`,\n             `d`.`collection_id`,\n             `d`.`archived_directly`,\n             'dashboard'      AS `model`,\n             `d`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `archived`,\n             `last_viewed_at` AS `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_dashboard` AS `d`\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'dashboard')\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = 441) AND (`d`.`archived_directly` <> TRUE))\n        AND (`archived` = FALSE)\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 3                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'dataset'        AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             `c`.`table_id`,\n             `t`.`is_upload`,\n             `c`.`query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'model')\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 4                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'metric'         AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'metric')\n        AND (`collection_position` IS NULL)) AS `dummy_alias`\nORDER BY (CASE WHEN `authority_level` = 'official' THEN 0 ELSE 1 END) ASC,\n         (CASE WHEN `collection_type` IS NULL THEN 0 WHEN `collection_type` = 'trash' THEN 1 ELSE 2 END) ASC,\n         LOWER(`name`) ASC\nLIMIT 25 OFFSET 0;\n```\n</details>\n\n<details><summary>The second query for path /api/collection/< cid >/items?models=dashboard</summary>\n\n```sql\n# QC_hit: No\n# Query_time: 2.413174 Lock_time: 0.001334 Rows_sent: 0 Rows_examined: 0\n# Rows_affected: 0 Bytes_sent: 1791 \n\nSET timestamp = 1736416431;\nSELECT *\nFROM (SELECT 5                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'card'           AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'question')\n        AND (`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT 7            AS `model_ranking`,\n             `id`,\n             `name`,\n             `description`,\n             `entity_id`,\n             NULL         AS `display`,\n             NULL         AS `collection_preview`,\n             NULL         AS `dataset_query`,\n             `id`         AS `collection_id`,\n             `archived_directly`,\n             'collection' AS `model`,\n             NULL         AS `collection_position`,\n             `authority_level`,\n             `personal_owner_id`,\n             `location`,\n             NULL         AS `last_edit_email`,\n             NULL         AS `last_edit_first_name`,\n             NULL         AS `last_edit_last_name`,\n             NULL         AS `moderated_status`,\n             NULL         AS `icon`,\n             NULL         AS `last_edit_user`,\n             NULL         AS `last_edit_timestamp`,\n             NULL         AS `database_id`,\n             `type`       AS `collection_type`,\n             `archived`,\n             NULL         AS `last_used_at`,\n             NULL         AS `table_id`,\n             NULL         AS `is_upload`,\n             NULL         AS `query_type`\n      FROM `collection` AS `col`\n      WHERE ((`id` IN (SELECT `id`\n                       FROM (SELECT `c`.*\n                             FROM `collection` AS `c`\n                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                             WHERE (`pgm`.`user_id` = <USER_ID>)\n                               AND (`p`.`perm_type` = 'perms/collection-access')\n                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `type` = 'trash'\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                       WHERE (`archived` = FALSE)\n                         AND ((`location` LIKE '/441/%') AND\n                              NOT EXISTS(SELECT 1 FROM `collection` AS `c2` WHERE ((`c2`.`id` IS NULL) OR (`c2`.`id` IN (SELECT `id` FROM (SELECT `c`.* FROM `collection` AS `c` INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id` INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id` INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id` WHERE (`pgm`.`user_id` = <USER_ID>) AND (`p`.`perm_type` = 'perms/collection-access') AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read')) UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `type` = 'trash' UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `id` IN (<COLLECTION_ID>)) AS `c` WHERE (`archived` = FALSE)))) AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')) AND (`c2`.`id` <> 441))))))\n        AND (`personal_owner_id` IS NULL)\n        AND ((`archived` = FALSE) AND (`id` <> <ANOTHER_COLLECTION_ID>))\n        AND (`namespace` IS NULL)\n        AND ((`namespace` IS NULL) OR (`namespace` <> 'snippets'))\n        AND (NULL IS NOT NULL)\n      UNION ALL\n      SELECT 1                AS `model_ranking`,\n             `d`.`id`,\n             `d`.`name`,\n             `d`.`description`,\n             `d`.`entity_id`,\n             NULL             AS `display`,\n             NULL             AS `collection_preview`,\n             NULL             AS `dataset_query`,\n             `d`.`collection_id`,\n             `d`.`archived_directly`,\n             'dashboard'      AS `model`,\n             `d`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `archived`,\n             `last_viewed_at` AS `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_dashboard` AS `d`\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'dashboard')\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = 441) AND (`d`.`archived_directly` <> TRUE))\n        AND (`archived` = FALSE)\n        AND (`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT 3                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'dataset'        AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             `c`.`table_id`,\n             `t`.`is_upload`,\n             `c`.`query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'model')\n        AND (`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT 4                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'metric'         AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'metric')\n        AND (`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT DISTINCT 2       AS `model_ranking`,\n                      `p`.`id`,\n                      `p`.`name`,\n                      NULL    AS `description`,\n                      `p`.`entity_id`,\n                      NULL    AS `display`,\n                      NULL    AS `collection_preview`,\n                      NULL    AS `dataset_query`,\n                      `p`.`collection_id`,\n                      NULL    AS `archived_directly`,\n                      'pulse' AS `model`,\n                      `p`.`collection_position`,\n                      NULL    AS `authority_level`,\n                      NULL    AS `personal_owner_id`,\n                      NULL    AS `location`,\n                      NULL    AS `last_edit_email`,\n                      NULL    AS `last_edit_first_name`,\n                      NULL    AS `last_edit_last_name`,\n                      NULL    AS `moderated_status`,\n                      NULL    AS `icon`,\n                      NULL    AS `last_edit_user`,\n                      NULL    AS `last_edit_timestamp`,\n                      NULL    AS `database_id`,\n                      NULL    AS `collection_type`,\n                      NULL    AS `archived`,\n                      NULL    AS `last_used_at`,\n                      NULL    AS `table_id`,\n                      NULL    AS `is_upload`,\n                      NULL    AS `query_type`\n      FROM `pulse` AS `p`\n               LEFT JOIN `pulse_card` AS `pc` ON `p`.`id` = `pc`.`pulse_id`\n      WHERE (`p`.`collection_id` = 441)\n        AND (`p`.`archived` = FALSE)\n        AND (`p`.`alert_condition` IS NULL)\n        AND (`p`.`dashboard_id` IS NULL)\n        AND (`p`.`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT 8          AS `model_ranking`,\n             `id`,\n             `name`,\n             `description`,\n             `entity_id`,\n             NULL       AS `display`,\n             NULL       AS `collection_preview`,\n             NULL       AS `dataset_query`,\n             `collection_id`,\n             NULL       AS `archived_directly`,\n             'timeline' AS `model`,\n             NULL       AS `collection_position`,\n             NULL       AS `authority_level`,\n             NULL       AS `personal_owner_id`,\n             NULL       AS `location`,\n             NULL       AS `last_edit_email`,\n             NULL       AS `last_edit_first_name`,\n             NULL       AS `last_edit_last_name`,\n             NULL       AS `moderated_status`,\n             `icon`,\n             NULL       AS `last_edit_user`,\n             NULL       AS `last_edit_timestamp`,\n             NULL       AS `database_id`,\n             NULL       AS `collection_type`,\n             NULL       AS `archived`,\n             NULL       AS `last_used_at`,\n             NULL       AS `table_id`,\n             NULL       AS `is_upload`,\n             NULL       AS `query_type`\n      FROM `timeline` AS `timeline`\n      WHERE (1 = 2)\n        AND (`collection_id` = 441)\n        AND (`archived` = FALSE)) AS `dummy_alias`\nORDER BY (CASE WHEN `authority_level` = 'official' THEN 0 ELSE 1 END) ASC,\n         (CASE WHEN `collection_type` IS NULL THEN 0 WHEN `collection_type` = 'trash' THEN 1 ELSE 2 END) ASC,\n         LOWER(`name`) ASC;\n```\n</details>\n\n<details><summary>The first query for path /api/collection/< cid >/items?pinned_state=is_pinned</summary>\nThe full path is http://127.0.0.1:3000/api/collection/< cid >/items?pinned_state=is_pinned&sort_column=name&sort_direction=asc\n\n```sql\n# QC_hit: No\n# Query_time: 2.571262 Lock_time: 0.001132 Rows_sent: 1 Rows_examined: 2\n# Rows_affected: 0 Bytes_sent: 53 \n\nSET timestamp = 1736416428;\nSELECT COUNT(*) AS `count`\nFROM (SELECT 5                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'card'           AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'question')\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 7            AS `model_ranking`,\n             `id`,\n             `name`,\n             `description`,\n             `entity_id`,\n             NULL         AS `display`,\n             NULL         AS `collection_preview`,\n             NULL         AS `dataset_query`,\n             `id`         AS `collection_id`,\n             `archived_directly`,\n             'collection' AS `model`,\n             NULL         AS `collection_position`,\n             `authority_level`,\n             `personal_owner_id`,\n             `location`,\n             NULL         AS `last_edit_email`,\n             NULL         AS `last_edit_first_name`,\n             NULL         AS `last_edit_last_name`,\n             NULL         AS `moderated_status`,\n             NULL         AS `icon`,\n             NULL         AS `last_edit_user`,\n             NULL         AS `last_edit_timestamp`,\n             NULL         AS `database_id`,\n             `type`       AS `collection_type`,\n             `archived`,\n             NULL         AS `last_used_at`,\n             NULL         AS `table_id`,\n             NULL         AS `is_upload`,\n             NULL         AS `query_type`\n      FROM `collection` AS `col`\n      WHERE ((`id` IN (SELECT `id`\n                       FROM (SELECT `c`.*\n                             FROM `collection` AS `c`\n                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                             WHERE (`pgm`.`user_id` = <USER_ID>)\n                               AND (`p`.`perm_type` = 'perms/collection-access')\n                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `type` = 'trash'\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                       WHERE (`archived` = FALSE)\n                         AND ((`location` LIKE '/<COLLECTION_ID>/%') AND\n                              NOT EXISTS(SELECT 1 FROM `collection` AS `c2` WHERE ((`c2`.`id` IS NULL) OR (`c2`.`id` IN (SELECT `id` FROM (SELECT `c`.* FROM `collection` AS `c` INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id` INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id` INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id` WHERE (`pgm`.`user_id` = <USER_ID>) AND (`p`.`perm_type` = 'perms/collection-access') AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read')) UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `type` = 'trash' UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `id` IN (<COLLECTION_ID>)) AS `c` WHERE (`archived` = FALSE)))) AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')) AND (`c2`.`id` <> <COLLECTION_ID>))))))\n        AND (`personal_owner_id` IS NULL)\n        AND ((`archived` = FALSE) AND (`id` <> <ANOTHER_COLLECTION_ID>))\n        AND (`namespace` IS NULL)\n        AND ((`namespace` IS NULL) OR (`namespace` <> 'snippets'))\n        AND (NULL IS NULL)\n      UNION ALL\n      SELECT 1                AS `model_ranking`,\n             `d`.`id`,\n             `d`.`name`,\n             `d`.`description`,\n             `d`.`entity_id`,\n             NULL             AS `display`,\n             NULL             AS `collection_preview`,\n             NULL             AS `dataset_query`,\n             `d`.`collection_id`,\n             `d`.`archived_directly`,\n             'dashboard'      AS `model`,\n             `d`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `archived`,\n             `last_viewed_at` AS `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_dashboard` AS `d`\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'dashboard')\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = <COLLECTION_ID>) AND (`d`.`archived_directly` <> TRUE))\n        AND (`archived` = FALSE)\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 3                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'dataset'        AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             `c`.`table_id`,\n             `t`.`is_upload`,\n             `c`.`query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'model')\n        AND (`collection_position` IS NULL)\n      UNION ALL\n      SELECT 4                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'metric'         AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'metric')\n        AND (`collection_position` IS NULL)) AS `dummy_alias`;\n```\n</details>\n\n<details><summary>The second query for path /api/collection/< cid >/items?pinned_state=is_pinned</summary>\n\n```sql\n# QC_hit: No\n# Query_time: 2.293093 Lock_time: 0.000951 Rows_sent: 1 Rows_examined: 0\n# Rows_affected: 0 Bytes_sent: 53 \n\nSET timestamp = 1736416428;\nSELECT COUNT(*) AS `count`\nFROM (SELECT 5                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'card'           AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'question')\n        AND (`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT 7            AS `model_ranking`,\n             `id`,\n             `name`,\n             `description`,\n             `entity_id`,\n             NULL         AS `display`,\n             NULL         AS `collection_preview`,\n             NULL         AS `dataset_query`,\n             `id`         AS `collection_id`,\n             `archived_directly`,\n             'collection' AS `model`,\n             NULL         AS `collection_position`,\n             `authority_level`,\n             `personal_owner_id`,\n             `location`,\n             NULL         AS `last_edit_email`,\n             NULL         AS `last_edit_first_name`,\n             NULL         AS `last_edit_last_name`,\n             NULL         AS `moderated_status`,\n             NULL         AS `icon`,\n             NULL         AS `last_edit_user`,\n             NULL         AS `last_edit_timestamp`,\n             NULL         AS `database_id`,\n             `type`       AS `collection_type`,\n             `archived`,\n             NULL         AS `last_used_at`,\n             NULL         AS `table_id`,\n             NULL         AS `is_upload`,\n             NULL         AS `query_type`\n      FROM `collection` AS `col`\n      WHERE ((`id` IN (SELECT `id`\n                       FROM (SELECT `c`.*\n                             FROM `collection` AS `c`\n                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                             WHERE (`pgm`.`user_id` = <USER_ID>)\n                               AND (`p`.`perm_type` = 'perms/collection-access')\n                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `type` = 'trash'\n                             UNION ALL\n                             SELECT `c`.*\n                             FROM `collection` AS `c`\n                             WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                       WHERE (`archived` = FALSE)\n                         AND ((`location` LIKE '/<COLLECTION_ID>/%') AND\n                              NOT EXISTS(SELECT 1 FROM `collection` AS `c2` WHERE ((`c2`.`id` IS NULL) OR (`c2`.`id` IN (SELECT `id` FROM (SELECT `c`.* FROM `collection` AS `c` INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id` INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id` INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id` WHERE (`pgm`.`user_id` = <USER_ID>) AND (`p`.`perm_type` = 'perms/collection-access') AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read')) UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `type` = 'trash' UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `id` IN (<COLLECTION_ID>)) AS `c` WHERE (`archived` = FALSE)))) AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')) AND (`c2`.`id` <> <COLLECTION_ID>))))))\n        AND (`personal_owner_id` IS NULL)\n        AND ((`archived` = FALSE) AND (`id` <> <ANOTHER_COLLECTION_ID>))\n        AND (`namespace` IS NULL)\n        AND ((`namespace` IS NULL) OR (`namespace` <> 'snippets'))\n        AND (NULL IS NOT NULL)\n      UNION ALL\n      SELECT 1                AS `model_ranking`,\n             `d`.`id`,\n             `d`.`name`,\n             `d`.`description`,\n             `d`.`entity_id`,\n             NULL             AS `display`,\n             NULL             AS `collection_preview`,\n             NULL             AS `dataset_query`,\n             `d`.`collection_id`,\n             `d`.`archived_directly`,\n             'dashboard'      AS `model`,\n             `d`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `archived`,\n             `last_viewed_at` AS `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_dashboard` AS `d`\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'dashboard')\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = <COLLECTION_ID>) AND (`d`.`archived_directly` <> TRUE))\n        AND (`archived` = FALSE)\n        AND (`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT 3                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'dataset'        AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             `c`.`database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             `c`.`table_id`,\n             `t`.`is_upload`,\n             `c`.`query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'model')\n        AND (`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT 4                AS `model_ranking`,\n             `c`.`id`,\n             `c`.`name`,\n             `c`.`description`,\n             `c`.`entity_id`,\n             `c`.`display`,\n             `c`.`collection_preview`,\n             `c`.`dataset_query`,\n             `c`.`collection_id`,\n             `c`.`archived_directly`,\n             'metric'         AS `model`,\n             `c`.`collection_position`,\n             NULL             AS `authority_level`,\n             NULL             AS `personal_owner_id`,\n             NULL             AS `location`,\n             `u`.`email`      AS `last_edit_email`,\n             `u`.`first_name` AS `last_edit_first_name`,\n             `u`.`last_name`  AS `last_edit_last_name`,\n             `mr`.`status`    AS `moderated_status`,\n             NULL             AS `icon`,\n             `u`.`id`         AS `last_edit_user`,\n             `r`.`timestamp`  AS `last_edit_timestamp`,\n             NULL             AS `database_id`,\n             NULL             AS `collection_type`,\n             `c`.`archived`,\n             `last_used_at`,\n             NULL             AS `table_id`,\n             NULL             AS `is_upload`,\n             NULL             AS `query_type`\n      FROM `report_card` AS `c`\n               LEFT JOIN `revision` AS `r`\n                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')\n               LEFT JOIN `moderation_review` AS `mr`\n                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND\n                            (`mr`.`moderated_item_type` = 'card')\n               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`\n      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`\n                                                               FROM (SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`\n                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`\n                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`\n                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)\n                                                                       AND (`p`.`perm_type` = 'perms/collection-access')\n                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `type` = 'trash'\n                                                                     UNION ALL\n                                                                     SELECT `c`.*\n                                                                     FROM `collection` AS `c`\n                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`\n                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))\n        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))\n        AND (`archived` = FALSE)\n        AND (`c`.`type` = 'metric')\n        AND (`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT DISTINCT 2       AS `model_ranking`,\n                      `p`.`id`,\n                      `p`.`name`,\n                      NULL    AS `description`,\n                      `p`.`entity_id`,\n                      NULL    AS `display`,\n                      NULL    AS `collection_preview`,\n                      NULL    AS `dataset_query`,\n                      `p`.`collection_id`,\n                      NULL    AS `archived_directly`,\n                      'pulse' AS `model`,\n                      `p`.`collection_position`,\n                      NULL    AS `authority_level`,\n                      NULL    AS `personal_owner_id`,\n                      NULL    AS `location`,\n                      NULL    AS `last_edit_email`,\n                      NULL    AS `last_edit_first_name`,\n                      NULL    AS `last_edit_last_name`,\n                      NULL    AS `moderated_status`,\n                      NULL    AS `icon`,\n                      NULL    AS `last_edit_user`,\n                      NULL    AS `last_edit_timestamp`,\n                      NULL    AS `database_id`,\n                      NULL    AS `collection_type`,\n                      NULL    AS `archived`,\n                      NULL    AS `last_used_at`,\n                      NULL    AS `table_id`,\n                      NULL    AS `is_upload`,\n                      NULL    AS `query_type`\n      FROM `pulse` AS `p`\n               LEFT JOIN `pulse_card` AS `pc` ON `p`.`id` = `pc`.`pulse_id`\n      WHERE (`p`.`collection_id` = <COLLECTION_ID>)\n        AND (`p`.`archived` = FALSE)\n        AND (`p`.`alert_condition` IS NULL)\n        AND (`p`.`dashboard_id` IS NULL)\n        AND (`p`.`collection_position` IS NOT NULL)\n      UNION ALL\n      SELECT 8          AS `model_ranking`,\n             `id`,\n             `name`,\n             `description`,\n             `entity_id`,\n             NULL       AS `display`,\n             NULL       AS `collection_preview`,\n             NULL       AS `dataset_query`,\n             `collection_id`,\n             NULL       AS `archived_directly`,\n             'timeline' AS `model`,\n             NULL       AS `collection_position`,\n             NULL       AS `authority_level`,\n             NULL       AS `personal_owner_id`,\n             NULL       AS `location`,\n             NULL       AS `last_edit_email`,\n             NULL       AS `last_edit_first_name`,\n             NULL       AS `last_edit_last_name`,\n             NULL       AS `moderated_status`,\n             `icon`,\n             NULL       AS `last_edit_user`,\n             NULL       AS `last_edit_timestamp`,\n             NULL       AS `database_id`,\n             NULL       AS `collection_type`,\n             NULL       AS `archived`,\n             NULL       AS `last_used_at`,\n             NULL       AS `table_id`,\n             NULL       AS `is_upload`,\n             NULL       AS `query_type`\n      FROM `timeline` AS `timeline`\n      WHERE (1 = 2)\n        AND (`collection_id` = <COLLECTION_ID>)\n        AND (`archived` = FALSE)) AS `dummy_alias`;\n```\n</details>"", 'created_at': datetime.datetime(2025, 1, 9, 12, 12, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2588477470, 'issue_id': 2752179665, 'author': 'noahmoss', 'body': ""@ppavlov39 I made some further optimizations in https://github.com/metabase/metabase/pull/51929 which will go out in the next 52 release (scheduled for this Wednesday 1/15). I suspect they should help a lot, although loading a collection with many children may still take around 1-2 seconds for a user in 50+ groups based on my testing.\n\nFor now I'll keep the issue open but downgrade to a P2."", 'created_at': datetime.datetime(2025, 1, 13, 23, 57, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2595386094, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': 'I checked the speed of the web interface in the new version. \nThe time it takes for a user with 43 groups to see a list of collections has decreased to 2-3 seconds. But, unfortunately, users unfamiliar with such a delay may still not wait for the collections to appear and click somewhere else.\n\n![Image](https://github.com/user-attachments/assets/ef3f8f7e-b93f-488a-beee-f1afc7599772)', 'created_at': datetime.datetime(2025, 1, 16, 12, 14, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2596640551, 'issue_id': 2752179665, 'author': 'luizarakaki', 'body': '@ppavlov39 offtopic, but would you be willing to share why you use MariaDB as the appDB?\nWe are learning more why users adopt MySQL/MariaDB, if you can, please send me an email: luiz.arakaki@metabase.com', 'created_at': datetime.datetime(2025, 1, 16, 19, 23, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2597506877, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': 'Since this may be related to the topic, I will answer here and at the same time ask a question on this topic.\nWe use MySQL because our company has extensive experience in its support. We are currently just trying out Postgres..\n\nOne of the options that we are currently considering to smooth out the current situation is switching to Postgres. Can you recommend doing this to solve this problem.', 'created_at': datetime.datetime(2025, 1, 17, 6, 9, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2598516984, 'issue_id': 2752179665, 'author': 'luizarakaki', 'body': ""I generally recommend using Postgres because it is what we use in development environments.\n\nBut in this case, we reproduced this issue on Postgres too. There might be minor improvements, but won't resolve it."", 'created_at': datetime.datetime(2025, 1, 17, 14, 41, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2601697211, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': ""Would you able to solve the problem?\nWe can review the user permissions management (now it is one security group for one collection), but it is better not to do this, It will take to much time. And it won't be as flexible as it is now."", 'created_at': datetime.datetime(2025, 1, 20, 8, 10, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2602428701, 'issue_id': 2752179665, 'author': 'luizarakaki', 'body': ""We are investigating, but optimizing for this number of collections and simultaneous user groups isn't a quickfix.\nAt this point, we are weeks to months from resolving this. Can you optimize this on your side?\n\nAlso, if you can comment on the use case. Why do you have 2500 collections? You have more collections than users."", 'created_at': datetime.datetime(2025, 1, 20, 13, 27, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2603764661, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': 'Thank you! It will be great!\n\nAs I already mentioned, reorganizing access control will require significant resources, also weeks or months (calendar-wise). And this will potentially deprive us of flexibility in access control. For now, we want to avoid this.\n\nThis number of collections is due to the fact that one day we decided to improve the purity of collections and subcollections that users work with. For this, additional subcollections were created for all the above-mentioned collections and subcollections, in which all cards were placed. Only dashboards remained in the main collections.\n\nThis can be represented as follows:\n\n- Collection\n  - Subcollection for cards\n  - Some user subcollection\n    - Subcollection for cards\n  - Some user subcollection\n    - Subcollection for cards\n    - Some user subcollection\n      - Subcollection for cards\n- Another collection\n  - Subcollection for cards', 'created_at': datetime.datetime(2025, 1, 21, 6, 26, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2604716716, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': 'Just in case, I checked the distribution of collections, we have:\n- about 1000 personal collections;\n- about 700 subcollections for cards;\n- about 100 subcollections for our archive (for outdated cards that are still needed);\n- about 1300 regular collections and subcollections.', 'created_at': datetime.datetime(2025, 1, 21, 13, 19, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2606746715, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': 'It seems that a small increase in the interface speed can be achieved by excluding all identical records from this [CTE](https://github.com/metabase/metabase/blob/master/src/metabase/api/collection.clj#L432) (by adding DISTINCT).', 'created_at': datetime.datetime(2025, 1, 22, 9, 43, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2607301924, 'issue_id': 2752179665, 'author': 'ppavlov39', 'body': 'Perhaps caching user permissions might be appropriate in this case.', 'created_at': datetime.datetime(2025, 1, 22, 13, 50, 1, tzinfo=datetime.timezone.utc)}]","ppavlov39 (Issue Creator) on (2024-12-23 12:49:14 UTC): Hello!
Today we continue to investigate the issue ~~and found that the query from the message above is running in 0.2 seconds. Much faster than we have seen before.~~ (0.2 seconds for user with small amount of groups).

We have noticed that our database sometimes has high disk usage, up to 100% for several minutes. We have not seen such indicators before.
![Image](https://github.com/user-attachments/assets/0b6772ed-67c9-4bf7-846f-d2663f8e0dcf)

Further investigation into the cause of the issue revealed several queries that are causing high disk usage.

```
SELECT AVG(`running_time`) AS `running_time`, `card_id` FROM `query_execution` 
WHERE (`running_time` IS NOT NULL) AND (`cache_hit` <> TRUE) AND (`card_id` IN (7196)) GROUP BY `card_id`;
```
and
```
SELECT MIN(`executor_id`) AS `user_id`, `query_execution`.`card_id` AS `model_id`, COUNT(*) AS `cnt`, MAX(`started_at`) AS `max_ts` FROM `query_execution` 
WHERE (`context` = 'question') GROUP BY `query_execution`.`card_id`, `context` ORDER BY `max_ts` DESC LIMIT 8;
```

The card_id specified in the first query is present in all such requests.
The `query_execution` table is about 3GB in size. 
Could you help me understand what event causes these requests to be executed? And what can we do to resolve this problem?

ppavlov39 (Issue Creator) on (2024-12-23 14:15:40 UTC): The message above does not seem to be related to the problems. It may be related to caching ([issue](https://github.com/metabase/metabase/issues/33375) about it). Now we have disabled caching and disk usage is lower.

paoliniluis on (2024-12-23 15:50:44 UTC): @ppavlov39 first of all, great debugging, thanks a lot for this. Quick question: what's your app database sizing?

ppavlov39 (Issue Creator) on (2024-12-24 06:07:33 UTC): @paoliniluis Hi!
The size of the app db is about 13 GB.

ppavlov39 (Issue Creator) on (2024-12-24 06:18:40 UTC): But I was wrong. Disabling any result caching doesn't help.

There are still many similar queries:
```
SELECT AVG(`running_time`) AS `running_time`, `card_id` FROM `query_execution` WHERE (`running_time` IS NOT NULL) AND (`cache_hit` <> TRUE) AND (`card_id` IN (7194)) GROUP BY `card_id`;
```

And hight disk utilization:
![Image](https://github.com/user-attachments/assets/46c2c153-00ae-4f19-8a7d-c7e080fd4188)

paoliniluis on (2024-12-24 16:29:34 UTC): @ppavlov39 I meant, give us the CPU and memory that you're assigning to the app db, since your use case with so many users and permissions need a decently sized app db

paoliniluis on (2024-12-24 16:30:05 UTC): BTW @ppavlov39, wipe query_execution and permissions_review (leave the last entry) tables

ppavlov39 (Issue Creator) on (2024-12-25 08:36:53 UTC): Yes, sorry. Yesterday we increased the DB server resources and now it has 4 CPUs, 12 GB RAM and innodb_buffer_pool_size=6 GB.
The issues related to the queries from this [post](https://github.com/metabase/metabase/issues/51560#issuecomment-2559649916) are gone.
But the original issues are still there.

ppavlov39 (Issue Creator) on (2024-12-25 08:50:58 UTC): I can't find `permissions_review` table. May be you just meant `review`?

Table `query_execution` we can try wipe it, but if i'm not mistaken it should be done automatically two times a day, and storing data for 2 years is not problem now.

paoliniluis on (2024-12-25 12:44:40 UTC): When you say that the original issues are still there, you mean the high disk usage?

ppavlov39 (Issue Creator) on (2024-12-25 15:34:54 UTC): No, I meant the problem from [this](https://github.com/metabase/metabase/issues/51560#issue-2752179665) post.

paoliniluis on (2024-12-25 23:46:09 UTC): @ppavlov39 I clicked on the link and I don't get anywhere

ppavlov39 (Issue Creator) on (2024-12-26 06:09:40 UTC): @paoliniluis this is the link to the first post of this issue. I checked in a new tab and it works correctly.

paoliniluis on (2024-12-26 11:34:27 UTC): @ppavlov39 I thought you mentioned that the problem went away scaling vertically your app db, wasnt that the case?

ppavlov39 (Issue Creator) on (2024-12-26 11:56:36 UTC): Unfortunately, no. After scaling the application database, queries using the `query_execution` table are no longer a problem. And they execute quickly.
But the query from the first post is still slow and users are forced to wait several seconds before they see any collections or cards.

paoliniluis on (2024-12-27 19:08:33 UTC): @ppavlov39 we will ship 52.5 with a possible fix to this issue, can you test it?

noahmoss (Assginee) on (2024-12-27 19:24:03 UTC): I suspect that #51673 will help but may not be the entire root cause (still investigating) so let's keep this issue open for now

ppavlov39 (Issue Creator) on (2024-12-28 06:13:10 UTC): Thanks! Yes, I will test it when it becomes available. Now I only found 52.4.

paoliniluis on (2024-12-30 01:19:24 UTC): @ppavlov39 I'll need some help here. Please send me the output of the following queries:

1) select version();
2) 
```
EXPLAIN FORMAT=JSON SELECT *
FROM (SELECT 5                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'card'           AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<insert_collection_id_here>)) AS `c`
                                                               WHERE (1 <> `id`))))
        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'question')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 7            AS `model_ranking`,
             `id`,
             `name`,
             `description`,
             `entity_id`,
             NULL         AS `display`,
             NULL         AS `collection_preview`,
             NULL         AS `dataset_query`,
             `id`         AS `collection_id`,
             `archived_directly`,
             'collection' AS `model`,
             NULL         AS `collection_position`,
             `authority_level`,
             `personal_owner_id`,
             `location`,
             NULL         AS `last_edit_email`,
             NULL         AS `last_edit_first_name`,
             NULL         AS `last_edit_last_name`,
             NULL         AS `moderated_status`,
             NULL         AS `icon`,
             NULL         AS `last_edit_user`,
             NULL         AS `last_edit_timestamp`,
             NULL         AS `database_id`,
             `type`       AS `collection_type`,
             `archived`,
             NULL         AS `last_used_at`,
             NULL         AS `table_id`,
             NULL         AS `is_upload`,
             NULL         AS `query_type`
      FROM `collection` AS `col`
      WHERE ((`id` IN (SELECT `id`
                       FROM (SELECT `c`.*
                             FROM `collection` AS `c`
                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                             WHERE (`pgm`.`user_id` = <inser_problematic_user_id_here>)
                               AND (`p`.`perm_type` = 'perms/collection-access')
                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `type` = 'trash'
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                       WHERE (`archived` = FALSE)
                         AND ((`location` LIKE '/%') AND NOT EXISTS (SELECT 1
                                                                     FROM `collection` AS `c2`
                                                                     WHERE ((`c2`.`id` IS NULL) OR
                                                                            (`c2`.`id` IN (SELECT `id`
                                                                                           FROM (SELECT `c`.*
                                                                                                 FROM `collection` AS `c`
                                                                                                          INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                                                          INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                                                          INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                                                 WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                                                   AND (`p`.`perm_type` = 'perms/collection-access')
                                                                                                   AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                                                 UNION ALL
                                                                                                 SELECT `c`.*
                                                                                                 FROM `collection` AS `c`
                                                                                                 WHERE `type` = 'trash'
                                                                                                 UNION ALL
                                                                                                 SELECT `c`.*
                                                                                                 FROM `collection` AS `c`
                                                                                                 WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                                                                                           WHERE (`archived` = FALSE))))
                                                                       AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')))))))
        AND (`personal_owner_id` IS NULL)
        AND ((`archived` = FALSE) AND (`id` <> 1))
        AND ((`namespace` IS NULL) OR (`namespace` = 'analytics'))
        AND (NULL IS NULL)
      UNION ALL
      SELECT 1                AS `model_ranking`,
             `d`.`id`,
             `d`.`name`,
             `d`.`description`,
             `d`.`entity_id`,
             NULL             AS `display`,
             NULL             AS `collection_preview`,
             NULL             AS `dataset_query`,
             `d`.`collection_id`,
             `d`.`archived_directly`,
             'dashboard'      AS `model`,
             `d`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `archived`,
             `last_viewed_at` AS `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_dashboard` AS `d`
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'dashboard')
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                                                               WHERE (1 <> `id`))))
        AND ((`collection_id` IS NULL) AND (`d`.`archived_directly` <> TRUE))
        AND (`archived` = FALSE)
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 3                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'dataset'        AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             `c`.`table_id`,
             `t`.`is_upload`,
             `c`.`query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                                                               WHERE (1 <> `id`))))
        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'model')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 4                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'metric'         AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                                                               WHERE (1 <> `id`))))
        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'metric')
        AND (`collection_position` IS NULL)) AS `dummy_alias`
ORDER BY (CASE WHEN `authority_level` = 'official' THEN 0 ELSE 1 END) ASC,
         (CASE WHEN `collection_type` IS NULL THEN 0 WHEN `collection_type` = 'trash' THEN 1 ELSE 2 END) ASC,
         LOWER(`name`) ASC
LIMIT 25 OFFSET 0
```

(check in the previous query the places where I put <insert_problematic_user_id_here> and <insert_problematic_collection_id_here>)

3) 
```
explain analyze SELECT *
FROM (SELECT 5                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'card'           AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<insert_collection_id_here>)) AS `c`
                                                               WHERE (1 <> `id`))))
        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'question')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 7            AS `model_ranking`,
             `id`,
             `name`,
             `description`,
             `entity_id`,
             NULL         AS `display`,
             NULL         AS `collection_preview`,
             NULL         AS `dataset_query`,
             `id`         AS `collection_id`,
             `archived_directly`,
             'collection' AS `model`,
             NULL         AS `collection_position`,
             `authority_level`,
             `personal_owner_id`,
             `location`,
             NULL         AS `last_edit_email`,
             NULL         AS `last_edit_first_name`,
             NULL         AS `last_edit_last_name`,
             NULL         AS `moderated_status`,
             NULL         AS `icon`,
             NULL         AS `last_edit_user`,
             NULL         AS `last_edit_timestamp`,
             NULL         AS `database_id`,
             `type`       AS `collection_type`,
             `archived`,
             NULL         AS `last_used_at`,
             NULL         AS `table_id`,
             NULL         AS `is_upload`,
             NULL         AS `query_type`
      FROM `collection` AS `col`
      WHERE ((`id` IN (SELECT `id`
                       FROM (SELECT `c`.*
                             FROM `collection` AS `c`
                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                             WHERE (`pgm`.`user_id` = <inser_problematic_user_id_here>)
                               AND (`p`.`perm_type` = 'perms/collection-access')
                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `type` = 'trash'
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                       WHERE (`archived` = FALSE)
                         AND ((`location` LIKE '/%') AND NOT EXISTS (SELECT 1
                                                                     FROM `collection` AS `c2`
                                                                     WHERE ((`c2`.`id` IS NULL) OR
                                                                            (`c2`.`id` IN (SELECT `id`
                                                                                           FROM (SELECT `c`.*
                                                                                                 FROM `collection` AS `c`
                                                                                                          INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                                                          INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                                                          INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                                                 WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                                                   AND (`p`.`perm_type` = 'perms/collection-access')
                                                                                                   AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                                                 UNION ALL
                                                                                                 SELECT `c`.*
                                                                                                 FROM `collection` AS `c`
                                                                                                 WHERE `type` = 'trash'
                                                                                                 UNION ALL
                                                                                                 SELECT `c`.*
                                                                                                 FROM `collection` AS `c`
                                                                                                 WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                                                                                           WHERE (`archived` = FALSE))))
                                                                       AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')))))))
        AND (`personal_owner_id` IS NULL)
        AND ((`archived` = FALSE) AND (`id` <> 1))
        AND ((`namespace` IS NULL) OR (`namespace` = 'analytics'))
        AND (NULL IS NULL)
      UNION ALL
      SELECT 1                AS `model_ranking`,
             `d`.`id`,
             `d`.`name`,
             `d`.`description`,
             `d`.`entity_id`,
             NULL             AS `display`,
             NULL             AS `collection_preview`,
             NULL             AS `dataset_query`,
             `d`.`collection_id`,
             `d`.`archived_directly`,
             'dashboard'      AS `model`,
             `d`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `archived`,
             `last_viewed_at` AS `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_dashboard` AS `d`
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'dashboard')
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                                                               WHERE (1 <> `id`))))
        AND ((`collection_id` IS NULL) AND (`d`.`archived_directly` <> TRUE))
        AND (`archived` = FALSE)
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 3                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'dataset'        AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             `c`.`table_id`,
             `t`.`is_upload`,
             `c`.`query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                                                               WHERE (1 <> `id`))))
        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'model')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 4                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'metric'         AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <insert_problematic_user_id_here>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<insert_problematic_collection_id_here>)) AS `c`
                                                               WHERE (1 <> `id`))))
        AND ((`collection_id` IS NULL) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'metric')
        AND (`collection_position` IS NULL)) AS `dummy_alias`
ORDER BY (CASE WHEN `authority_level` = 'official' THEN 0 ELSE 1 END) ASC,
         (CASE WHEN `collection_type` IS NULL THEN 0 WHEN `collection_type` = 'trash' THEN 1 ELSE 2 END) ASC,
         LOWER(`name`) ASC
LIMIT 25 OFFSET 0
```

(check in the previous query the places where I put <insert_problematic_user_id_here> and <insert_problematic_collection_id_here>)

ppavlov39 (Issue Creator) on (2025-01-01 16:12:22 UTC): @paoliniluis Here are the results:
1. `10.5.13-MariaDB-log`
2. 
<details><summary>Results</summary>

```
{
  ""query_block"": {
    ""select_id"": 1,
    ""read_sorted_file"": {
      ""filesort"": {
        ""sort_key"": ""case when dummy_alias.authority_level = 'official' then 0 else 1 end, case when dummy_alias.collection_type is null then 0 when dummy_alias.collection_type = 'trash' then 1 else 2 end, lcase(dummy_alias.`name`)"",
        ""table"": {
          ""table_name"": ""<derived2>"",
          ""access_type"": ""ALL"",
          ""rows"": 20987,
          ""filtered"": 100,
          ""materialized"": {
            ""query_block"": {
              ""union_result"": {
                ""table_name"": ""<union2,7,17,22,27>"",
                ""access_type"": ""ALL"",
                ""query_specifications"": [
                  {
                    ""query_block"": {
                      ""select_id"": 2,
                      ""table"": {
                        ""table_name"": ""c"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [""idx_card_collection_id""],
                        ""key"": ""idx_card_collection_id"",
                        ""key_length"": ""5"",
                        ""used_key_parts"": [""collection_id""],
                        ""ref"": [""const""],
                        ""rows"": 102,
                        ""filtered"": 100,
                        ""index_condition"": ""c.collection_id is null"",
                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#3))) and c.`type` = 'question' and c.collection_position is null""
                      },
                      ""table"": {
                        ""table_name"": ""r"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_revision_model_model_id"",
                          ""idx_revision_most_recent""
                        ],
                        ""key"": ""idx_revision_model_model_id"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""model_id""],
                        ""ref"": [""metabase_update.c.id""],
                        ""rows"": 1,
                        ""filtered"": 50,
                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = 'Card')""
                      },
                      ""table"": {
                        ""table_name"": ""mr"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_moderation_review_item_type_item_id""
                        ],
                        ""key"": ""idx_moderation_review_item_type_item_id"",
                        ""key_length"": ""1026"",
                        ""used_key_parts"": [
                          ""moderated_item_type"",
                          ""moderated_item_id""
                        ],
                        ""ref"": [""const"", ""metabase_update.c.id""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = 'card')""
                      },
                      ""table"": {
                        ""table_name"": ""u"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.r.user_id""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""
                      },
                      ""subqueries"": [
                        {
                          ""query_block"": {
                            ""select_id"": 3,
                            ""table"": {
                              ""table_name"": ""<derived4>"",
                              ""access_type"": ""ALL"",
                              ""rows"": 19582,
                              ""filtered"": 100,
                              ""attached_condition"": ""1 <> c.`id`"",
                              ""materialized"": {
                                ""query_block"": {
                                  ""union_result"": {
                                    ""table_name"": ""<union4,5,6>"",
                                    ""access_type"": ""ALL"",
                                    ""query_specifications"": [
                                      {
                                        ""query_block"": {
                                          ""select_id"": 4,
                                          ""table"": {
                                            ""table_name"": ""pgm"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""unique_permissions_group_membership_user_id_group_id"",
                                              ""idx_permissions_group_membership_group_id"",
                                              ""idx_permissions_group_membership_user_id"",
                                              ""idx_permissions_group_membership_group_id_user_id""
                                            ],
                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""user_id""],
                                            ""ref"": [""const""],
                                            ""rows"": 44,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""pg"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""p"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""group_id"",
                                              ""idx_permissions_group_id"",
                                              ""idx_permissions_collection_id"",
                                              ""idx_permissions_perm_type"",
                                              ""idx_permissions_perm_value""
                                            ],
                                            ""key"": ""group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""group_id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rowid_filter"": {
                                              ""range"": {
                                                ""key"": ""idx_permissions_collection_id"",
                                                ""used_key_parts"": [""collection_id""]
                                              },
                                              ""rows"": 32084,
                                              ""selectivity_pct"": 50.00155846
                                            },
                                            ""rows"": 445,
                                            ""filtered"": 14.01837444,
                                            ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and 1 <> p.collection_id and p.collection_id is not null""
                                          },
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [
                                              ""metabase_update.p.collection_id""
                                            ],
                                            ""rows"": 1,
                                            ""filtered"": 100
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 5,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_type""
                                            ],
                                            ""key"": ""idx_collection_type"",
                                            ""key_length"": ""1027"",
                                            ""used_key_parts"": [""type""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""index_condition"": ""c.`type` = 'trash' and 1 <> c.`id`""
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 6,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""const"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100
                                          }
                                        }
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    ""query_block"": {
                      ""select_id"": 7,
                      ""operation"": ""UNION"",
                      ""table"": {
                        ""table_name"": ""col"",
                        ""access_type"": ""ALL"",
                        ""possible_keys"": [
                          ""PRIMARY"",
                          ""unique_collection_personal_owner_id"",
                          ""idx_collection_personal_owner_id""
                        ],
                        ""rows"": 3005,
                        ""filtered"": 68.78535461,
                        ""attached_condition"": ""col.archived = 0 and col.personal_owner_id is null and col.`id` <> 1 and (col.namespace is null or col.namespace = 'analytics')""
                      },
                      ""table"": {
                        ""table_name"": ""<subquery8>"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""distinct_key""],
                        ""key"": ""distinct_key"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""func""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""materialized"": {
                          ""unique"": 1,
                          ""query_block"": {
                            ""select_id"": 8,
                            ""table"": {
                              ""table_name"": ""<derived9>"",
                              ""access_type"": ""ALL"",
                              ""rows"": 19582,
                              ""filtered"": 100,
                              ""attached_condition"": ""c.archived = 0 and c.location like '/%' and !<in_optimizer>(1,exists(subquery#12))"",
                              ""materialized"": {
                                ""query_block"": {
                                  ""union_result"": {
                                    ""table_name"": ""<union9,10,11>"",
                                    ""access_type"": ""ALL"",
                                    ""query_specifications"": [
                                      {
                                        ""query_block"": {
                                          ""select_id"": 9,
                                          ""table"": {
                                            ""table_name"": ""pgm"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""unique_permissions_group_membership_user_id_group_id"",
                                              ""idx_permissions_group_membership_group_id"",
                                              ""idx_permissions_group_membership_user_id"",
                                              ""idx_permissions_group_membership_group_id_user_id""
                                            ],
                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""user_id""],
                                            ""ref"": [""const""],
                                            ""rows"": 44,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""pg"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""p"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""group_id"",
                                              ""idx_permissions_group_id"",
                                              ""idx_permissions_collection_id"",
                                              ""idx_permissions_perm_type"",
                                              ""idx_permissions_perm_value""
                                            ],
                                            ""key"": ""group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""group_id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rowid_filter"": {
                                              ""range"": {
                                                ""key"": ""idx_permissions_collection_id"",
                                                ""used_key_parts"": [""collection_id""]
                                              },
                                              ""rows"": 32084,
                                              ""selectivity_pct"": 50.00155846
                                            },
                                            ""rows"": 445,
                                            ""filtered"": 14.01837444,
                                            ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and p.collection_id <> 1 and p.collection_id is not null""
                                          },
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_location""
                                            ],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [
                                              ""metabase_update.p.collection_id""
                                            ],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""attached_condition"": ""c.archived = 0 and c.location like '/%'""
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 10,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_location"",
                                              ""idx_collection_type""
                                            ],
                                            ""key"": ""idx_collection_type"",
                                            ""key_length"": ""1027"",
                                            ""used_key_parts"": [""type""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""index_condition"": ""c.`type` = 'trash' and c.`id` <> 1"",
                                            ""attached_condition"": ""c.archived = 0 and c.location like '/%'""
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 11,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""const"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_location""
                                            ],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100
                                          }
                                        }
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""subqueries"": [
                        {
                          ""expression_cache"": {
                            ""state"": ""uninitialized"",
                            ""query_block"": {
                              ""select_id"": 12,
                              ""table"": {
                                ""table_name"": ""c2"",
                                ""access_type"": ""ALL"",
                                ""rows"": 3005,
                                ""filtered"": 100,
                                ""attached_condition"": ""<in_optimizer>(c2.`id`,c2.`id` in (subquery#13)) and c.location = concat(c2.location,c2.`id`,'/')""
                              },
                              ""subqueries"": [
                                {
                                  ""query_block"": {
                                    ""select_id"": 13,
                                    ""table"": {
                                      ""table_name"": ""<derived14>"",
                                      ""access_type"": ""ALL"",
                                      ""rows"": 19582,
                                      ""filtered"": 100,
                                      ""attached_condition"": ""c.archived = 0"",
                                      ""materialized"": {
                                        ""query_block"": {
                                          ""union_result"": {
                                            ""table_name"": ""<union14,15,16>"",
                                            ""access_type"": ""ALL"",
                                            ""query_specifications"": [
                                              {
                                                ""query_block"": {
                                                  ""select_id"": 14,
                                                  ""table"": {
                                                    ""table_name"": ""pgm"",
                                                    ""access_type"": ""ref"",
                                                    ""possible_keys"": [
                                                      ""unique_permissions_group_membership_user_id_group_id"",
                                                      ""idx_permissions_group_membership_group_id"",
                                                      ""idx_permissions_group_membership_user_id"",
                                                      ""idx_permissions_group_membership_group_id_user_id""
                                                    ],
                                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""user_id""],
                                                    ""ref"": [""const""],
                                                    ""rows"": 44,
                                                    ""filtered"": 100,
                                                    ""using_index"": true
                                                  },
                                                  ""table"": {
                                                    ""table_name"": ""pg"",
                                                    ""access_type"": ""eq_ref"",
                                                    ""possible_keys"": [""PRIMARY""],
                                                    ""key"": ""PRIMARY"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""id""],
                                                    ""ref"": [
                                                      ""metabase_update.pgm.group_id""
                                                    ],
                                                    ""rows"": 1,
                                                    ""filtered"": 100,
                                                    ""using_index"": true
                                                  },
                                                  ""table"": {
                                                    ""table_name"": ""p"",
                                                    ""access_type"": ""ref"",
                                                    ""possible_keys"": [
                                                      ""group_id"",
                                                      ""idx_permissions_group_id"",
                                                      ""idx_permissions_collection_id"",
                                                      ""idx_permissions_perm_type"",
                                                      ""idx_permissions_perm_value""
                                                    ],
                                                    ""key"": ""group_id"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""group_id""],
                                                    ""ref"": [
                                                      ""metabase_update.pgm.group_id""
                                                    ],
                                                    ""rowid_filter"": {
                                                      ""range"": {
                                                        ""key"": ""idx_permissions_perm_type"",
                                                        ""used_key_parts"": [
                                                          ""perm_type""
                                                        ]
                                                      },
                                                      ""rows"": 32083,
                                                      ""selectivity_pct"": 50
                                                    },
                                                    ""rows"": 445,
                                                    ""filtered"": 28.03587532,
                                                    ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and p.collection_id is not null""
                                                  },
                                                  ""table"": {
                                                    ""table_name"": ""c"",
                                                    ""access_type"": ""eq_ref"",
                                                    ""possible_keys"": [""PRIMARY""],
                                                    ""key"": ""PRIMARY"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""id""],
                                                    ""ref"": [
                                                      ""metabase_update.p.collection_id""
                                                    ],
                                                    ""rows"": 1,
                                                    ""filtered"": 100,
                                                    ""attached_condition"": ""c.archived = 0""
                                                  }
                                                }
                                              },
                                              {
                                                ""query_block"": {
                                                  ""select_id"": 15,
                                                  ""operation"": ""UNION"",
                                                  ""table"": {
                                                    ""table_name"": ""c"",
                                                    ""access_type"": ""ref"",
                                                    ""possible_keys"": [
                                                      ""idx_collection_type""
                                                    ],
                                                    ""key"": ""idx_collection_type"",
                                                    ""key_length"": ""1027"",
                                                    ""used_key_parts"": [""type""],
                                                    ""ref"": [""const""],
                                                    ""rows"": 1,
                                                    ""filtered"": 100,
                                                    ""index_condition"": ""c.`type` = 'trash'"",
                                                    ""attached_condition"": ""c.archived = 0""
                                                  }
                                                }
                                              },
                                              {
                                                ""query_block"": {
                                                  ""select_id"": 16,
                                                  ""operation"": ""UNION"",
                                                  ""table"": {
                                                    ""table_name"": ""c"",
                                                    ""access_type"": ""const"",
                                                    ""possible_keys"": [""PRIMARY""],
                                                    ""key"": ""PRIMARY"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""id""],
                                                    ""ref"": [""const""],
                                                    ""rows"": 1,
                                                    ""filtered"": 100
                                                  }
                                                }
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    ""query_block"": {
                      ""select_id"": 17,
                      ""operation"": ""UNION"",
                      ""table"": {
                        ""table_name"": ""d"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [""idx_dashboard_collection_id""],
                        ""key"": ""idx_dashboard_collection_id"",
                        ""key_length"": ""5"",
                        ""used_key_parts"": [""collection_id""],
                        ""ref"": [""const""],
                        ""rows"": 9,
                        ""filtered"": 100,
                        ""index_condition"": ""d.collection_id is null"",
                        ""attached_condition"": ""d.archived = 0 and (d.collection_id is null or <in_optimizer>(d.collection_id,<exists>(subquery#18))) and d.archived_directly <> 1 and d.collection_position is null""
                      },
                      ""table"": {
                        ""table_name"": ""mr"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_moderation_review_item_type_item_id""
                        ],
                        ""key"": ""idx_moderation_review_item_type_item_id"",
                        ""key_length"": ""1026"",
                        ""used_key_parts"": [
                          ""moderated_item_type"",
                          ""moderated_item_id""
                        ],
                        ""ref"": [""const"", ""metabase_update.d.id""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = 'dashboard')""
                      },
                      ""table"": {
                        ""table_name"": ""r"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_revision_model_model_id"",
                          ""idx_revision_most_recent""
                        ],
                        ""key"": ""idx_revision_model_model_id"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""model_id""],
                        ""ref"": [""metabase_update.d.id""],
                        ""rows"": 1,
                        ""filtered"": 50,
                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = 'Dashboard')""
                      },
                      ""table"": {
                        ""table_name"": ""u"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.r.user_id""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""
                      },
                      ""subqueries"": [
                        {
                          ""query_block"": {
                            ""select_id"": 18,
                            ""table"": {
                              ""table_name"": ""<derived19>"",
                              ""access_type"": ""index_subquery"",
                              ""possible_keys"": [""key0""],
                              ""key"": ""key0"",
                              ""key_length"": ""4"",
                              ""used_key_parts"": [""id""],
                              ""ref"": [""func""],
                              ""rows"": 1958,
                              ""filtered"": 100,
                              ""materialized"": {
                                ""query_block"": {
                                  ""union_result"": {
                                    ""table_name"": ""<union19,20,21>"",
                                    ""access_type"": ""ALL"",
                                    ""query_specifications"": [
                                      {
                                        ""query_block"": {
                                          ""select_id"": 19,
                                          ""table"": {
                                            ""table_name"": ""pgm"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""unique_permissions_group_membership_user_id_group_id"",
                                              ""idx_permissions_group_membership_group_id"",
                                              ""idx_permissions_group_membership_user_id"",
                                              ""idx_permissions_group_membership_group_id_user_id""
                                            ],
                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""user_id""],
                                            ""ref"": [""const""],
                                            ""rows"": 44,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""pg"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""p"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""group_id"",
                                              ""idx_permissions_group_id"",
                                              ""idx_permissions_collection_id"",
                                              ""idx_permissions_perm_type"",
                                              ""idx_permissions_perm_value""
                                            ],
                                            ""key"": ""group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""group_id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rowid_filter"": {
                                              ""range"": {
                                                ""key"": ""idx_permissions_collection_id"",
                                                ""used_key_parts"": [""collection_id""]
                                              },
                                              ""rows"": 32084,
                                              ""selectivity_pct"": 50.00155846
                                            },
                                            ""rows"": 445,
                                            ""filtered"": 14.01837444,
                                            ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and 1 <> p.collection_id and p.collection_id is not null""
                                          },
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [
                                              ""metabase_update.p.collection_id""
                                            ],
                                            ""rows"": 1,
                                            ""filtered"": 100
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 20,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_type""
                                            ],
                                            ""key"": ""idx_collection_type"",
                                            ""key_length"": ""1027"",
                                            ""used_key_parts"": [""type""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""index_condition"": ""c.`type` = 'trash' and 1 <> c.`id`""
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 21,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""const"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100
                                          }
                                        }
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    ""query_block"": {
                      ""select_id"": 22,
                      ""operation"": ""UNION"",
                      ""table"": {
                        ""table_name"": ""c"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [""idx_card_collection_id""],
                        ""key"": ""idx_card_collection_id"",
                        ""key_length"": ""5"",
                        ""used_key_parts"": [""collection_id""],
                        ""ref"": [""const""],
                        ""rows"": 102,
                        ""filtered"": 100,
                        ""index_condition"": ""c.collection_id is null"",
                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#23))) and c.`type` = 'model' and c.collection_position is null""
                      },
                      ""table"": {
                        ""table_name"": ""r"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_revision_model_model_id"",
                          ""idx_revision_most_recent""
                        ],
                        ""key"": ""idx_revision_model_model_id"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""model_id""],
                        ""ref"": [""metabase_update.c.id""],
                        ""rows"": 1,
                        ""filtered"": 50,
                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = 'Card')""
                      },
                      ""table"": {
                        ""table_name"": ""mr"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_moderation_review_item_type_item_id""
                        ],
                        ""key"": ""idx_moderation_review_item_type_item_id"",
                        ""key_length"": ""1026"",
                        ""used_key_parts"": [
                          ""moderated_item_type"",
                          ""moderated_item_id""
                        ],
                        ""ref"": [""const"", ""metabase_update.c.id""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = 'card')""
                      },
                      ""table"": {
                        ""table_name"": ""u"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.r.user_id""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""
                      },
                      ""table"": {
                        ""table_name"": ""t"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.c.table_id""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""attached_condition"": ""trigcond(trigcond(c.table_id is not null))""
                      },
                      ""subqueries"": [
                        {
                          ""query_block"": {
                            ""select_id"": 23,
                            ""table"": {
                              ""table_name"": ""<derived24>"",
                              ""access_type"": ""ALL"",
                              ""rows"": 19582,
                              ""filtered"": 100,
                              ""attached_condition"": ""1 <> c.`id`"",
                              ""materialized"": {
                                ""query_block"": {
                                  ""union_result"": {
                                    ""table_name"": ""<union24,25,26>"",
                                    ""access_type"": ""ALL"",
                                    ""query_specifications"": [
                                      {
                                        ""query_block"": {
                                          ""select_id"": 24,
                                          ""table"": {
                                            ""table_name"": ""pgm"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""unique_permissions_group_membership_user_id_group_id"",
                                              ""idx_permissions_group_membership_group_id"",
                                              ""idx_permissions_group_membership_user_id"",
                                              ""idx_permissions_group_membership_group_id_user_id""
                                            ],
                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""user_id""],
                                            ""ref"": [""const""],
                                            ""rows"": 44,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""pg"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""p"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""group_id"",
                                              ""idx_permissions_group_id"",
                                              ""idx_permissions_collection_id"",
                                              ""idx_permissions_perm_type"",
                                              ""idx_permissions_perm_value""
                                            ],
                                            ""key"": ""group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""group_id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rowid_filter"": {
                                              ""range"": {
                                                ""key"": ""idx_permissions_collection_id"",
                                                ""used_key_parts"": [""collection_id""]
                                              },
                                              ""rows"": 32084,
                                              ""selectivity_pct"": 50.00155846
                                            },
                                            ""rows"": 445,
                                            ""filtered"": 14.01837444,
                                            ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and 1 <> p.collection_id and p.collection_id is not null""
                                          },
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [
                                              ""metabase_update.p.collection_id""
                                            ],
                                            ""rows"": 1,
                                            ""filtered"": 100
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 25,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_type""
                                            ],
                                            ""key"": ""idx_collection_type"",
                                            ""key_length"": ""1027"",
                                            ""used_key_parts"": [""type""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""index_condition"": ""c.`type` = 'trash' and 1 <> c.`id`""
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 26,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""const"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100
                                          }
                                        }
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    ""query_block"": {
                      ""select_id"": 27,
                      ""operation"": ""UNION"",
                      ""table"": {
                        ""table_name"": ""c"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [""idx_card_collection_id""],
                        ""key"": ""idx_card_collection_id"",
                        ""key_length"": ""5"",
                        ""used_key_parts"": [""collection_id""],
                        ""ref"": [""const""],
                        ""rows"": 102,
                        ""filtered"": 100,
                        ""index_condition"": ""c.collection_id is null"",
                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#28))) and c.`type` = 'metric' and c.collection_position is null""
                      },
                      ""table"": {
                        ""table_name"": ""r"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_revision_model_model_id"",
                          ""idx_revision_most_recent""
                        ],
                        ""key"": ""idx_revision_model_model_id"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""model_id""],
                        ""ref"": [""metabase_update.c.id""],
                        ""rows"": 1,
                        ""filtered"": 50,
                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = 'Card')""
                      },
                      ""table"": {
                        ""table_name"": ""mr"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_moderation_review_item_type_item_id""
                        ],
                        ""key"": ""idx_moderation_review_item_type_item_id"",
                        ""key_length"": ""1026"",
                        ""used_key_parts"": [
                          ""moderated_item_type"",
                          ""moderated_item_id""
                        ],
                        ""ref"": [""const"", ""metabase_update.c.id""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = 'card')""
                      },
                      ""table"": {
                        ""table_name"": ""u"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.r.user_id""],
                        ""rows"": 1,
                        ""filtered"": 100,
                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""
                      },
                      ""subqueries"": [
                        {
                          ""query_block"": {
                            ""select_id"": 28,
                            ""table"": {
                              ""table_name"": ""<derived29>"",
                              ""access_type"": ""ALL"",
                              ""rows"": 19582,
                              ""filtered"": 100,
                              ""attached_condition"": ""1 <> c.`id`"",
                              ""materialized"": {
                                ""query_block"": {
                                  ""union_result"": {
                                    ""table_name"": ""<union29,30,31>"",
                                    ""access_type"": ""ALL"",
                                    ""query_specifications"": [
                                      {
                                        ""query_block"": {
                                          ""select_id"": 29,
                                          ""table"": {
                                            ""table_name"": ""pgm"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""unique_permissions_group_membership_user_id_group_id"",
                                              ""idx_permissions_group_membership_group_id"",
                                              ""idx_permissions_group_membership_user_id"",
                                              ""idx_permissions_group_membership_group_id_user_id""
                                            ],
                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""user_id""],
                                            ""ref"": [""const""],
                                            ""rows"": 44,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""pg"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""p"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""group_id"",
                                              ""idx_permissions_group_id"",
                                              ""idx_permissions_collection_id"",
                                              ""idx_permissions_perm_type"",
                                              ""idx_permissions_perm_value""
                                            ],
                                            ""key"": ""group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""group_id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rowid_filter"": {
                                              ""range"": {
                                                ""key"": ""idx_permissions_collection_id"",
                                                ""used_key_parts"": [""collection_id""]
                                              },
                                              ""rows"": 32084,
                                              ""selectivity_pct"": 50.00155846
                                            },
                                            ""rows"": 445,
                                            ""filtered"": 14.01837444,
                                            ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and 1 <> p.collection_id and p.collection_id is not null""
                                          },
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [
                                              ""metabase_update.p.collection_id""
                                            ],
                                            ""rows"": 1,
                                            ""filtered"": 100
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 30,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_type""
                                            ],
                                            ""key"": ""idx_collection_type"",
                                            ""key_length"": ""1027"",
                                            ""used_key_parts"": [""type""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100,
                                            ""index_condition"": ""c.`type` = 'trash' and 1 <> c.`id`""
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 31,
                                          ""operation"": ""UNION"",
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""const"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""const""],
                                            ""rows"": 1,
                                            ""filtered"": 100
                                          }
                                        }
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          }
        }
      }
    }
  }
}
```
</details>

3.
<details>
<summary>Results</summary>

```
{
  ""query_block"": {
    ""select_id"": 1,
    ""r_loops"": 1,
    ""r_total_time_ms"": 1433.735201,
    ""read_sorted_file"": {
      ""r_rows"": 25,
      ""filesort"": {
        ""sort_key"": ""case when dummy_alias.authority_level = 'official' then 0 else 1 end, case when dummy_alias.collection_type is null then 0 when dummy_alias.collection_type = 'trash' then 1 else 2 end, lcase(dummy_alias.`name`)"",
        ""r_loops"": 1,
        ""r_total_time_ms"": 0.094719873,
        ""r_limit"": 25,
        ""r_used_priority_queue"": false,
        ""r_output_rows"": 54,
        ""r_buffer_size"": ""66Kb"",
        ""r_sort_mode"": ""sort_key,rowid"",
        ""table"": {
          ""table_name"": ""<derived2>"",
          ""access_type"": ""ALL"",
          ""r_loops"": 1,
          ""rows"": 20987,
          ""r_rows"": 54,
          ""r_table_time_ms"": 0.17856957,
          ""r_other_time_ms"": 0.118990126,
          ""filtered"": 100,
          ""r_filtered"": 100,
          ""materialized"": {
            ""query_block"": {
              ""union_result"": {
                ""table_name"": ""<union2,7,17,22,27>"",
                ""access_type"": ""ALL"",
                ""r_loops"": 0,
                ""r_rows"": null,
                ""query_specifications"": [
                  {
                    ""query_block"": {
                      ""select_id"": 2,
                      ""r_loops"": 1,
                      ""r_total_time_ms"": 0.914228715,
                      ""table"": {
                        ""table_name"": ""c"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [""idx_card_collection_id""],
                        ""key"": ""idx_card_collection_id"",
                        ""key_length"": ""5"",
                        ""used_key_parts"": [""collection_id""],
                        ""ref"": [""const""],
                        ""r_loops"": 1,
                        ""rows"": 102,
                        ""r_rows"": 102,
                        ""r_table_time_ms"": 0.507976123,
                        ""r_other_time_ms"": 0.033438159,
                        ""filtered"": 100,
                        ""r_filtered"": 2.941176471,
                        ""index_condition"": ""c.collection_id is null"",
                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#3))) and c.`type` = 'question' and c.collection_position is null""
                      },
                      ""table"": {
                        ""table_name"": ""r"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_revision_model_model_id"",
                          ""idx_revision_most_recent""
                        ],
                        ""key"": ""idx_revision_model_model_id"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""model_id""],
                        ""ref"": [""metabase_update.c.id""],
                        ""r_loops"": 3,
                        ""rows"": 1,
                        ""r_rows"": 6.333333333,
                        ""r_table_time_ms"": 0.163624812,
                        ""r_other_time_ms"": 0.049678306,
                        ""filtered"": 50,
                        ""r_filtered"": 15.78947368,
                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = 'Card')""
                      },
                      ""table"": {
                        ""table_name"": ""mr"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_moderation_review_item_type_item_id""
                        ],
                        ""key"": ""idx_moderation_review_item_type_item_id"",
                        ""key_length"": ""1026"",
                        ""used_key_parts"": [
                          ""moderated_item_type"",
                          ""moderated_item_id""
                        ],
                        ""ref"": [""const"", ""metabase_update.c.id""],
                        ""r_loops"": 3,
                        ""rows"": 1,
                        ""r_rows"": 0,
                        ""r_table_time_ms"": 0.00724871,
                        ""r_other_time_ms"": 0.007980016,
                        ""filtered"": 100,
                        ""r_filtered"": 100,
                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = 'card')""
                      },
                      ""table"": {
                        ""table_name"": ""u"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.r.user_id""],
                        ""r_loops"": 3,
                        ""rows"": 1,
                        ""r_rows"": 1,
                        ""r_table_time_ms"": 0.019117207,
                        ""r_other_time_ms"": 0.052030197,
                        ""filtered"": 100,
                        ""r_filtered"": 100,
                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""
                      },
                      ""subqueries"": [
                        {
                          ""query_block"": {
                            ""select_id"": 3,
                            ""table"": {
                              ""table_name"": ""<derived4>"",
                              ""access_type"": ""ALL"",
                              ""r_loops"": 0,
                              ""rows"": 19582,
                              ""r_rows"": null,
                              ""filtered"": 100,
                              ""r_filtered"": null,
                              ""attached_condition"": ""1 <> c.`id`"",
                              ""materialized"": {
                                ""query_block"": {
                                  ""select_id"": 4,
                                  ""table"": {
                                    ""table_name"": ""pgm"",
                                    ""access_type"": ""ref"",
                                    ""possible_keys"": [
                                      ""unique_permissions_group_membership_user_id_group_id"",
                                      ""idx_permissions_group_membership_group_id"",
                                      ""idx_permissions_group_membership_user_id"",
                                      ""idx_permissions_group_membership_group_id_user_id""
                                    ],
                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""user_id""],
                                    ""ref"": [""const""],
                                    ""r_loops"": 0,
                                    ""rows"": 44,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null,
                                    ""using_index"": true
                                  },
                                  ""table"": {
                                    ""table_name"": ""pg"",
                                    ""access_type"": ""eq_ref"",
                                    ""possible_keys"": [""PRIMARY""],
                                    ""key"": ""PRIMARY"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""id""],
                                    ""ref"": [""metabase_update.pgm.group_id""],
                                    ""r_loops"": 0,
                                    ""rows"": 1,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null,
                                    ""using_index"": true
                                  },
                                  ""table"": {
                                    ""table_name"": ""p"",
                                    ""access_type"": ""ref"",
                                    ""possible_keys"": [
                                      ""group_id"",
                                      ""idx_permissions_group_id"",
                                      ""idx_permissions_collection_id"",
                                      ""idx_permissions_perm_type"",
                                      ""idx_permissions_perm_value""
                                    ],
                                    ""key"": ""group_id"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""group_id""],
                                    ""ref"": [""metabase_update.pgm.group_id""],
                                    ""rowid_filter"": {
                                      ""range"": {
                                        ""key"": ""idx_permissions_collection_id"",
                                        ""used_key_parts"": [""collection_id""]
                                      },
                                      ""rows"": 32084,
                                      ""selectivity_pct"": 50.00155846,
                                      ""r_rows"": 0,
                                      ""r_selectivity_pct"": 0,
                                      ""r_buffer_size"": 0,
                                      ""r_filling_time_ms"": 0
                                    },
                                    ""r_loops"": 0,
                                    ""rows"": 445,
                                    ""r_rows"": null,
                                    ""filtered"": 14.01837444,
                                    ""r_filtered"": null,
                                    ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and 1 <> p.collection_id and p.collection_id is not null""
                                  },
                                  ""table"": {
                                    ""table_name"": ""c"",
                                    ""access_type"": ""eq_ref"",
                                    ""possible_keys"": [""PRIMARY""],
                                    ""key"": ""PRIMARY"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""id""],
                                    ""ref"": [""metabase_update.p.collection_id""],
                                    ""r_loops"": 0,
                                    ""rows"": 1,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null
                                  }
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    ""query_block"": {
                      ""select_id"": 7,
                      ""operation"": ""UNION"",
                      ""r_loops"": 1,
                      ""r_total_time_ms"": 1431.307217,
                      ""table"": {
                        ""table_name"": ""col"",
                        ""access_type"": ""ALL"",
                        ""possible_keys"": [
                          ""PRIMARY"",
                          ""unique_collection_personal_owner_id"",
                          ""idx_collection_personal_owner_id""
                        ],
                        ""r_loops"": 1,
                        ""rows"": 3005,
                        ""r_rows"": 3069,
                        ""r_table_time_ms"": 2.461259097,
                        ""r_other_time_ms"": 0.727278414,
                        ""filtered"": 68.78535461,
                        ""r_filtered"": 52.68817204,
                        ""attached_condition"": ""col.archived = 0 and col.personal_owner_id is null and col.`id` <> 1 and (col.namespace is null or col.namespace = 'analytics')""
                      },
                      ""table"": {
                        ""table_name"": ""<subquery8>"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""distinct_key""],
                        ""key"": ""distinct_key"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""func""],
                        ""r_loops"": 1617,
                        ""rows"": 1,
                        ""r_rows"": 0.031539889,
                        ""r_table_time_ms"": 0.393970665,
                        ""r_other_time_ms"": 0.310406863,
                        ""filtered"": 100,
                        ""r_filtered"": 100,
                        ""materialized"": {
                          ""unique"": 1,
                          ""query_block"": {
                            ""select_id"": 8,
                            ""table"": {
                              ""table_name"": ""<derived9>"",
                              ""access_type"": ""ALL"",
                              ""r_loops"": 1,
                              ""rows"": 19582,
                              ""r_rows"": 36185,
                              ""r_table_time_ms"": 48.94402769,
                              ""r_other_time_ms"": 36.49905424,
                              ""filtered"": 100,
                              ""r_filtered"": 3.4295979,
                              ""attached_condition"": ""c.archived = 0 and c.location like '/%' and !<in_optimizer>(1,exists(subquery#12))"",
                              ""materialized"": {
                                ""query_block"": {
                                  ""union_result"": {
                                    ""table_name"": ""<union9,10,11>"",
                                    ""access_type"": ""ALL"",
                                    ""r_loops"": 0,
                                    ""r_rows"": null,
                                    ""query_specifications"": [
                                      {
                                        ""query_block"": {
                                          ""select_id"": 9,
                                          ""r_loops"": 1,
                                          ""r_total_time_ms"": 442.0156915,
                                          ""table"": {
                                            ""table_name"": ""pgm"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""unique_permissions_group_membership_user_id_group_id"",
                                              ""idx_permissions_group_membership_group_id"",
                                              ""idx_permissions_group_membership_user_id"",
                                              ""idx_permissions_group_membership_group_id_user_id""
                                            ],
                                            ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""user_id""],
                                            ""ref"": [""const""],
                                            ""r_loops"": 1,
                                            ""rows"": 44,
                                            ""r_rows"": 44,
                                            ""r_table_time_ms"": 0.049427089,
                                            ""r_other_time_ms"": 0.029196355,
                                            ""filtered"": 100,
                                            ""r_filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""pg"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [""PRIMARY""],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""r_loops"": 44,
                                            ""rows"": 1,
                                            ""r_rows"": 1,
                                            ""r_table_time_ms"": 0.114428906,
                                            ""r_other_time_ms"": 0.020729701,
                                            ""filtered"": 100,
                                            ""r_filtered"": 100,
                                            ""using_index"": true
                                          },
                                          ""table"": {
                                            ""table_name"": ""p"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""group_id"",
                                              ""idx_permissions_group_id"",
                                              ""idx_permissions_collection_id"",
                                              ""idx_permissions_perm_type"",
                                              ""idx_permissions_perm_value""
                                            ],
                                            ""key"": ""group_id"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""group_id""],
                                            ""ref"": [""metabase_update.pgm.group_id""],
                                            ""rowid_filter"": {
                                              ""range"": {
                                                ""key"": ""idx_permissions_collection_id"",
                                                ""used_key_parts"": [""collection_id""]
                                              },
                                              ""rows"": 32084,
                                              ""selectivity_pct"": 50.00155846,
                                              ""r_rows"": 64254,
                                              ""r_selectivity_pct"": 99.83222939,
                                              ""r_buffer_size"": 32127,
                                              ""r_filling_time_ms"": 14.12524787
                                            },
                                            ""r_loops"": 44,
                                            ""rows"": 445,
                                            ""r_rows"": 1041.340909,
                                            ""r_table_time_ms"": 158.8915124,
                                            ""r_other_time_ms"": 31.15108417,
                                            ""filtered"": 14.01837444,
                                            ""r_filtered"": 100,
                                            ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and p.collection_id <> 1 and p.collection_id is not null""
                                          },
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""eq_ref"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_location""
                                            ],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [
                                              ""metabase_update.p.collection_id""
                                            ],
                                            ""r_loops"": 45819,
                                            ""rows"": 1,
                                            ""r_rows"": 1,
                                            ""r_table_time_ms"": 112.3951438,
                                            ""r_other_time_ms"": 91.45252253,
                                            ""filtered"": 100,
                                            ""r_filtered"": 78.96942317,
                                            ""attached_condition"": ""c.archived = 0 and c.location like '/%'""
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 10,
                                          ""operation"": ""UNION"",
                                          ""r_loops"": 1,
                                          ""r_total_time_ms"": 0.039022744,
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""ref"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_location"",
                                              ""idx_collection_type""
                                            ],
                                            ""key"": ""idx_collection_type"",
                                            ""key_length"": ""1027"",
                                            ""used_key_parts"": [""type""],
                                            ""ref"": [""const""],
                                            ""r_loops"": 1,
                                            ""rows"": 1,
                                            ""r_rows"": 1,
                                            ""r_table_time_ms"": 0.016827735,
                                            ""r_other_time_ms"": 0.008586869,
                                            ""filtered"": 100,
                                            ""r_filtered"": 100,
                                            ""index_condition"": ""c.`type` = 'trash' and c.`id` <> 1"",
                                            ""attached_condition"": ""c.archived = 0 and c.location like '/%'""
                                          }
                                        }
                                      },
                                      {
                                        ""query_block"": {
                                          ""select_id"": 11,
                                          ""operation"": ""UNION"",
                                          ""r_loops"": 1,
                                          ""r_total_time_ms"": 0.013449011,
                                          ""table"": {
                                            ""table_name"": ""c"",
                                            ""access_type"": ""const"",
                                            ""possible_keys"": [
                                              ""PRIMARY"",
                                              ""idx_collection_location""
                                            ],
                                            ""key"": ""PRIMARY"",
                                            ""key_length"": ""4"",
                                            ""used_key_parts"": [""id""],
                                            ""ref"": [""const""],
                                            ""r_loops"": 0,
                                            ""rows"": 1,
                                            ""r_rows"": null,
                                            ""filtered"": 100,
                                            ""r_filtered"": null
                                          }
                                        }
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""subqueries"": [
                        {
                          ""expression_cache"": {
                            ""r_loops"": 36185,
                            ""r_hit_ratio"": 98.36672654,
                            ""query_block"": {
                              ""select_id"": 12,
                              ""r_loops"": 591,
                              ""r_total_time_ms"": 940.3421075,
                              ""table"": {
                                ""table_name"": ""c2"",
                                ""access_type"": ""ALL"",
                                ""r_loops"": 591,
                                ""rows"": 3005,
                                ""r_rows"": 1330.812183,
                                ""r_table_time_ms"": 233.5442391,
                                ""r_other_time_ms"": 236.8202833,
                                ""filtered"": 100,
                                ""r_filtered"": 0.075014939,
                                ""attached_condition"": ""<in_optimizer>(c2.`id`,c2.`id` in (subquery#13)) and c.location = concat(c2.location,c2.`id`,'/')""
                              },
                              ""subqueries"": [
                                {
                                  ""query_block"": {
                                    ""select_id"": 13,
                                    ""r_loops"": 1,
                                    ""r_total_time_ms"": 468.7988468,
                                    ""table"": {
                                      ""table_name"": ""<derived14>"",
                                      ""access_type"": ""ALL"",
                                      ""r_loops"": 1,
                                      ""rows"": 19582,
                                      ""r_rows"": 36185,
                                      ""r_table_time_ms"": 49.52882982,
                                      ""r_other_time_ms"": 11.45762265,
                                      ""filtered"": 100,
                                      ""r_filtered"": 100,
                                      ""attached_condition"": ""c.archived = 0"",
                                      ""materialized"": {
                                        ""query_block"": {
                                          ""union_result"": {
                                            ""table_name"": ""<union14,15,16>"",
                                            ""access_type"": ""ALL"",
                                            ""r_loops"": 0,
                                            ""r_rows"": null,
                                            ""query_specifications"": [
                                              {
                                                ""query_block"": {
                                                  ""select_id"": 14,
                                                  ""r_loops"": 1,
                                                  ""r_total_time_ms"": 450.495086,
                                                  ""table"": {
                                                    ""table_name"": ""pgm"",
                                                    ""access_type"": ""ref"",
                                                    ""possible_keys"": [
                                                      ""unique_permissions_group_membership_user_id_group_id"",
                                                      ""idx_permissions_group_membership_group_id"",
                                                      ""idx_permissions_group_membership_user_id"",
                                                      ""idx_permissions_group_membership_group_id_user_id""
                                                    ],
                                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""user_id""],
                                                    ""ref"": [""const""],
                                                    ""r_loops"": 1,
                                                    ""rows"": 44,
                                                    ""r_rows"": 44,
                                                    ""r_table_time_ms"": 0.046736516,
                                                    ""r_other_time_ms"": 0.029102341,
                                                    ""filtered"": 100,
                                                    ""r_filtered"": 100,
                                                    ""using_index"": true
                                                  },
                                                  ""table"": {
                                                    ""table_name"": ""pg"",
                                                    ""access_type"": ""eq_ref"",
                                                    ""possible_keys"": [""PRIMARY""],
                                                    ""key"": ""PRIMARY"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""id""],
                                                    ""ref"": [
                                                      ""metabase_update.pgm.group_id""
                                                    ],
                                                    ""r_loops"": 44,
                                                    ""rows"": 1,
                                                    ""r_rows"": 1,
                                                    ""r_table_time_ms"": 0.115396402,
                                                    ""r_other_time_ms"": 0.020362892,
                                                    ""filtered"": 100,
                                                    ""r_filtered"": 100,
                                                    ""using_index"": true
                                                  },
                                                  ""table"": {
                                                    ""table_name"": ""p"",
                                                    ""access_type"": ""ref"",
                                                    ""possible_keys"": [
                                                      ""group_id"",
                                                      ""idx_permissions_group_id"",
                                                      ""idx_permissions_collection_id"",
                                                      ""idx_permissions_perm_type"",
                                                      ""idx_permissions_perm_value""
                                                    ],
                                                    ""key"": ""group_id"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""group_id""],
                                                    ""ref"": [
                                                      ""metabase_update.pgm.group_id""
                                                    ],
                                                    ""rowid_filter"": {
                                                      ""range"": {
                                                        ""key"": ""idx_permissions_perm_type"",
                                                        ""used_key_parts"": [
                                                          ""perm_type""
                                                        ]
                                                      },
                                                      ""rows"": 32083,
                                                      ""selectivity_pct"": 50,
                                                      ""r_rows"": 64254,
                                                      ""r_selectivity_pct"": 99.83222939,
                                                      ""r_buffer_size"": 32127,
                                                      ""r_filling_time_ms"": 29.6478751
                                                    },
                                                    ""r_loops"": 44,
                                                    ""rows"": 445,
                                                    ""r_rows"": 1041.340909,
                                                    ""r_table_time_ms"": 171.5801775,
                                                    ""r_other_time_ms"": 29.28639475,
                                                    ""filtered"": 28.03587532,
                                                    ""r_filtered"": 100,
                                                    ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and p.collection_id is not null""
                                                  },
                                                  ""table"": {
                                                    ""table_name"": ""c"",
                                                    ""access_type"": ""eq_ref"",
                                                    ""possible_keys"": [""PRIMARY""],
                                                    ""key"": ""PRIMARY"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""id""],
                                                    ""ref"": [
                                                      ""metabase_update.p.collection_id""
                                                    ],
                                                    ""r_loops"": 45819,
                                                    ""rows"": 1,
                                                    ""r_rows"": 1,
                                                    ""r_table_time_ms"": 114.4012757,
                                                    ""r_other_time_ms"": 85.43069366,
                                                    ""filtered"": 100,
                                                    ""r_filtered"": 78.96942317,
                                                    ""attached_condition"": ""c.archived = 0""
                                                  }
                                                }
                                              },
                                              {
                                                ""query_block"": {
                                                  ""select_id"": 15,
                                                  ""operation"": ""UNION"",
                                                  ""r_loops"": 1,
                                                  ""r_total_time_ms"": 0.03273498,
                                                  ""table"": {
                                                    ""table_name"": ""c"",
                                                    ""access_type"": ""ref"",
                                                    ""possible_keys"": [
                                                      ""idx_collection_type""
                                                    ],
                                                    ""key"": ""idx_collection_type"",
                                                    ""key_length"": ""1027"",
                                                    ""used_key_parts"": [""type""],
                                                    ""ref"": [""const""],
                                                    ""r_loops"": 1,
                                                    ""rows"": 1,
                                                    ""r_rows"": 1,
                                                    ""r_table_time_ms"": 0.015001397,
                                                    ""r_other_time_ms"": 0.006194135,
                                                    ""filtered"": 100,
                                                    ""r_filtered"": 100,
                                                    ""index_condition"": ""c.`type` = 'trash'"",
                                                    ""attached_condition"": ""c.archived = 0""
                                                  }
                                                }
                                              },
                                              {
                                                ""query_block"": {
                                                  ""select_id"": 16,
                                                  ""operation"": ""UNION"",
                                                  ""r_loops"": 1,
                                                  ""r_total_time_ms"": 0.007122331,
                                                  ""table"": {
                                                    ""table_name"": ""c"",
                                                    ""access_type"": ""const"",
                                                    ""possible_keys"": [""PRIMARY""],
                                                    ""key"": ""PRIMARY"",
                                                    ""key_length"": ""4"",
                                                    ""used_key_parts"": [""id""],
                                                    ""ref"": [""const""],
                                                    ""r_loops"": 0,
                                                    ""rows"": 1,
                                                    ""r_rows"": null,
                                                    ""filtered"": 100,
                                                    ""r_filtered"": null
                                                  }
                                                }
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    ""query_block"": {
                      ""select_id"": 17,
                      ""operation"": ""UNION"",
                      ""r_loops"": 1,
                      ""r_total_time_ms"": 0.078355658,
                      ""table"": {
                        ""table_name"": ""d"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [""idx_dashboard_collection_id""],
                        ""key"": ""idx_dashboard_collection_id"",
                        ""key_length"": ""5"",
                        ""used_key_parts"": [""collection_id""],
                        ""ref"": [""const""],
                        ""r_loops"": 1,
                        ""rows"": 9,
                        ""r_rows"": 9,
                        ""r_table_time_ms"": 0.061394608,
                        ""r_other_time_ms"": 0.00793378,
                        ""filtered"": 100,
                        ""r_filtered"": 0,
                        ""index_condition"": ""d.collection_id is null"",
                        ""attached_condition"": ""d.archived = 0 and (d.collection_id is null or <in_optimizer>(d.collection_id,<exists>(subquery#18))) and d.archived_directly <> 1 and d.collection_position is null""
                      },
                      ""table"": {
                        ""table_name"": ""mr"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_moderation_review_item_type_item_id""
                        ],
                        ""key"": ""idx_moderation_review_item_type_item_id"",
                        ""key_length"": ""1026"",
                        ""used_key_parts"": [
                          ""moderated_item_type"",
                          ""moderated_item_id""
                        ],
                        ""ref"": [""const"", ""metabase_update.d.id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 100,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = 'dashboard')""
                      },
                      ""table"": {
                        ""table_name"": ""r"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_revision_model_model_id"",
                          ""idx_revision_most_recent""
                        ],
                        ""key"": ""idx_revision_model_model_id"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""model_id""],
                        ""ref"": [""metabase_update.d.id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 50,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = 'Dashboard')""
                      },
                      ""table"": {
                        ""table_name"": ""u"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.r.user_id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 100,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""
                      },
                      ""subqueries"": [
                        {
                          ""query_block"": {
                            ""select_id"": 18,
                            ""table"": {
                              ""table_name"": ""<derived19>"",
                              ""access_type"": ""index_subquery"",
                              ""possible_keys"": [""key0""],
                              ""key"": ""key0"",
                              ""key_length"": ""4"",
                              ""used_key_parts"": [""id""],
                              ""ref"": [""func""],
                              ""r_loops"": 0,
                              ""rows"": 1958,
                              ""r_rows"": null,
                              ""filtered"": 100,
                              ""r_filtered"": null,
                              ""materialized"": {
                                ""query_block"": {
                                  ""select_id"": 19,
                                  ""table"": {
                                    ""table_name"": ""pgm"",
                                    ""access_type"": ""ref"",
                                    ""possible_keys"": [
                                      ""unique_permissions_group_membership_user_id_group_id"",
                                      ""idx_permissions_group_membership_group_id"",
                                      ""idx_permissions_group_membership_user_id"",
                                      ""idx_permissions_group_membership_group_id_user_id""
                                    ],
                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""user_id""],
                                    ""ref"": [""const""],
                                    ""r_loops"": 0,
                                    ""rows"": 44,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null,
                                    ""using_index"": true
                                  },
                                  ""table"": {
                                    ""table_name"": ""pg"",
                                    ""access_type"": ""eq_ref"",
                                    ""possible_keys"": [""PRIMARY""],
                                    ""key"": ""PRIMARY"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""id""],
                                    ""ref"": [""metabase_update.pgm.group_id""],
                                    ""r_loops"": 0,
                                    ""rows"": 1,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null,
                                    ""using_index"": true
                                  },
                                  ""table"": {
                                    ""table_name"": ""p"",
                                    ""access_type"": ""ref"",
                                    ""possible_keys"": [
                                      ""group_id"",
                                      ""idx_permissions_group_id"",
                                      ""idx_permissions_collection_id"",
                                      ""idx_permissions_perm_type"",
                                      ""idx_permissions_perm_value""
                                    ],
                                    ""key"": ""group_id"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""group_id""],
                                    ""ref"": [""metabase_update.pgm.group_id""],
                                    ""rowid_filter"": {
                                      ""range"": {
                                        ""key"": ""idx_permissions_collection_id"",
                                        ""used_key_parts"": [""collection_id""]
                                      },
                                      ""rows"": 32084,
                                      ""selectivity_pct"": 50.00155846,
                                      ""r_rows"": 0,
                                      ""r_selectivity_pct"": 0,
                                      ""r_buffer_size"": 0,
                                      ""r_filling_time_ms"": 0
                                    },
                                    ""r_loops"": 0,
                                    ""rows"": 445,
                                    ""r_rows"": null,
                                    ""filtered"": 14.01837444,
                                    ""r_filtered"": null,
                                    ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and 1 <> p.collection_id and p.collection_id is not null""
                                  },
                                  ""table"": {
                                    ""table_name"": ""c"",
                                    ""access_type"": ""eq_ref"",
                                    ""possible_keys"": [""PRIMARY""],
                                    ""key"": ""PRIMARY"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""id""],
                                    ""ref"": [""metabase_update.p.collection_id""],
                                    ""r_loops"": 0,
                                    ""rows"": 1,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null
                                  }
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    ""query_block"": {
                      ""select_id"": 22,
                      ""operation"": ""UNION"",
                      ""r_loops"": 1,
                      ""r_total_time_ms"": 0.362247877,
                      ""table"": {
                        ""table_name"": ""c"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [""idx_card_collection_id""],
                        ""key"": ""idx_card_collection_id"",
                        ""key_length"": ""5"",
                        ""used_key_parts"": [""collection_id""],
                        ""ref"": [""const""],
                        ""r_loops"": 1,
                        ""rows"": 102,
                        ""r_rows"": 102,
                        ""r_table_time_ms"": 0.340121451,
                        ""r_other_time_ms"": 0.0153474,
                        ""filtered"": 100,
                        ""r_filtered"": 0,
                        ""index_condition"": ""c.collection_id is null"",
                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#23))) and c.`type` = 'model' and c.collection_position is null""
                      },
                      ""table"": {
                        ""table_name"": ""r"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_revision_model_model_id"",
                          ""idx_revision_most_recent""
                        ],
                        ""key"": ""idx_revision_model_model_id"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""model_id""],
                        ""ref"": [""metabase_update.c.id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 50,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = 'Card')""
                      },
                      ""table"": {
                        ""table_name"": ""mr"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_moderation_review_item_type_item_id""
                        ],
                        ""key"": ""idx_moderation_review_item_type_item_id"",
                        ""key_length"": ""1026"",
                        ""used_key_parts"": [
                          ""moderated_item_type"",
                          ""moderated_item_id""
                        ],
                        ""ref"": [""const"", ""metabase_update.c.id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 100,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = 'card')""
                      },
                      ""table"": {
                        ""table_name"": ""u"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.r.user_id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 100,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""
                      },
                      ""table"": {
                        ""table_name"": ""t"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.c.table_id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 100,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(trigcond(c.table_id is not null))""
                      },
                      ""subqueries"": [
                        {
                          ""query_block"": {
                            ""select_id"": 23,
                            ""table"": {
                              ""table_name"": ""<derived24>"",
                              ""access_type"": ""ALL"",
                              ""r_loops"": 0,
                              ""rows"": 19582,
                              ""r_rows"": null,
                              ""filtered"": 100,
                              ""r_filtered"": null,
                              ""attached_condition"": ""1 <> c.`id`"",
                              ""materialized"": {
                                ""query_block"": {
                                  ""select_id"": 24,
                                  ""table"": {
                                    ""table_name"": ""pgm"",
                                    ""access_type"": ""ref"",
                                    ""possible_keys"": [
                                      ""unique_permissions_group_membership_user_id_group_id"",
                                      ""idx_permissions_group_membership_group_id"",
                                      ""idx_permissions_group_membership_user_id"",
                                      ""idx_permissions_group_membership_group_id_user_id""
                                    ],
                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""user_id""],
                                    ""ref"": [""const""],
                                    ""r_loops"": 0,
                                    ""rows"": 44,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null,
                                    ""using_index"": true
                                  },
                                  ""table"": {
                                    ""table_name"": ""pg"",
                                    ""access_type"": ""eq_ref"",
                                    ""possible_keys"": [""PRIMARY""],
                                    ""key"": ""PRIMARY"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""id""],
                                    ""ref"": [""metabase_update.pgm.group_id""],
                                    ""r_loops"": 0,
                                    ""rows"": 1,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null,
                                    ""using_index"": true
                                  },
                                  ""table"": {
                                    ""table_name"": ""p"",
                                    ""access_type"": ""ref"",
                                    ""possible_keys"": [
                                      ""group_id"",
                                      ""idx_permissions_group_id"",
                                      ""idx_permissions_collection_id"",
                                      ""idx_permissions_perm_type"",
                                      ""idx_permissions_perm_value""
                                    ],
                                    ""key"": ""group_id"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""group_id""],
                                    ""ref"": [""metabase_update.pgm.group_id""],
                                    ""rowid_filter"": {
                                      ""range"": {
                                        ""key"": ""idx_permissions_collection_id"",
                                        ""used_key_parts"": [""collection_id""]
                                      },
                                      ""rows"": 32084,
                                      ""selectivity_pct"": 50.00155846,
                                      ""r_rows"": 0,
                                      ""r_selectivity_pct"": 0,
                                      ""r_buffer_size"": 0,
                                      ""r_filling_time_ms"": 0
                                    },
                                    ""r_loops"": 0,
                                    ""rows"": 445,
                                    ""r_rows"": null,
                                    ""filtered"": 14.01837444,
                                    ""r_filtered"": null,
                                    ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and 1 <> p.collection_id and p.collection_id is not null""
                                  },
                                  ""table"": {
                                    ""table_name"": ""c"",
                                    ""access_type"": ""eq_ref"",
                                    ""possible_keys"": [""PRIMARY""],
                                    ""key"": ""PRIMARY"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""id""],
                                    ""ref"": [""metabase_update.p.collection_id""],
                                    ""r_loops"": 0,
                                    ""rows"": 1,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null
                                  }
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    ""query_block"": {
                      ""select_id"": 27,
                      ""operation"": ""UNION"",
                      ""r_loops"": 1,
                      ""r_total_time_ms"": 0.264037156,
                      ""table"": {
                        ""table_name"": ""c"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [""idx_card_collection_id""],
                        ""key"": ""idx_card_collection_id"",
                        ""key_length"": ""5"",
                        ""used_key_parts"": [""collection_id""],
                        ""ref"": [""const""],
                        ""r_loops"": 1,
                        ""rows"": 102,
                        ""r_rows"": 102,
                        ""r_table_time_ms"": 0.243571002,
                        ""r_other_time_ms"": 0.014213838,
                        ""filtered"": 100,
                        ""r_filtered"": 0,
                        ""index_condition"": ""c.collection_id is null"",
                        ""attached_condition"": ""c.archived_directly = 0 and c.archived = 0 and (c.collection_id is null or <in_optimizer>(c.collection_id,c.collection_id in (subquery#28))) and c.`type` = 'metric' and c.collection_position is null""
                      },
                      ""table"": {
                        ""table_name"": ""r"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_revision_model_model_id"",
                          ""idx_revision_most_recent""
                        ],
                        ""key"": ""idx_revision_model_model_id"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""model_id""],
                        ""ref"": [""metabase_update.c.id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 50,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(r.most_recent = 1 and r.model = 'Card')""
                      },
                      ""table"": {
                        ""table_name"": ""mr"",
                        ""access_type"": ""ref"",
                        ""possible_keys"": [
                          ""idx_moderation_review_item_type_item_id""
                        ],
                        ""key"": ""idx_moderation_review_item_type_item_id"",
                        ""key_length"": ""1026"",
                        ""used_key_parts"": [
                          ""moderated_item_type"",
                          ""moderated_item_id""
                        ],
                        ""ref"": [""const"", ""metabase_update.c.id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 100,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(mr.most_recent = 1 and mr.moderated_item_type = 'card')""
                      },
                      ""table"": {
                        ""table_name"": ""u"",
                        ""access_type"": ""eq_ref"",
                        ""possible_keys"": [""PRIMARY""],
                        ""key"": ""PRIMARY"",
                        ""key_length"": ""4"",
                        ""used_key_parts"": [""id""],
                        ""ref"": [""metabase_update.r.user_id""],
                        ""r_loops"": 0,
                        ""rows"": 1,
                        ""r_rows"": null,
                        ""filtered"": 100,
                        ""r_filtered"": null,
                        ""attached_condition"": ""trigcond(trigcond(r.user_id is not null))""
                      },
                      ""subqueries"": [
                        {
                          ""query_block"": {
                            ""select_id"": 28,
                            ""table"": {
                              ""table_name"": ""<derived29>"",
                              ""access_type"": ""ALL"",
                              ""r_loops"": 0,
                              ""rows"": 19582,
                              ""r_rows"": null,
                              ""filtered"": 100,
                              ""r_filtered"": null,
                              ""attached_condition"": ""1 <> c.`id`"",
                              ""materialized"": {
                                ""query_block"": {
                                  ""select_id"": 29,
                                  ""table"": {
                                    ""table_name"": ""pgm"",
                                    ""access_type"": ""ref"",
                                    ""possible_keys"": [
                                      ""unique_permissions_group_membership_user_id_group_id"",
                                      ""idx_permissions_group_membership_group_id"",
                                      ""idx_permissions_group_membership_user_id"",
                                      ""idx_permissions_group_membership_group_id_user_id""
                                    ],
                                    ""key"": ""unique_permissions_group_membership_user_id_group_id"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""user_id""],
                                    ""ref"": [""const""],
                                    ""r_loops"": 0,
                                    ""rows"": 44,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null,
                                    ""using_index"": true
                                  },
                                  ""table"": {
                                    ""table_name"": ""pg"",
                                    ""access_type"": ""eq_ref"",
                                    ""possible_keys"": [""PRIMARY""],
                                    ""key"": ""PRIMARY"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""id""],
                                    ""ref"": [""metabase_update.pgm.group_id""],
                                    ""r_loops"": 0,
                                    ""rows"": 1,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null,
                                    ""using_index"": true
                                  },
                                  ""table"": {
                                    ""table_name"": ""p"",
                                    ""access_type"": ""ref"",
                                    ""possible_keys"": [
                                      ""group_id"",
                                      ""idx_permissions_group_id"",
                                      ""idx_permissions_collection_id"",
                                      ""idx_permissions_perm_type"",
                                      ""idx_permissions_perm_value""
                                    ],
                                    ""key"": ""group_id"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""group_id""],
                                    ""ref"": [""metabase_update.pgm.group_id""],
                                    ""rowid_filter"": {
                                      ""range"": {
                                        ""key"": ""idx_permissions_collection_id"",
                                        ""used_key_parts"": [""collection_id""]
                                      },
                                      ""rows"": 32084,
                                      ""selectivity_pct"": 50.00155846,
                                      ""r_rows"": 0,
                                      ""r_selectivity_pct"": 0,
                                      ""r_buffer_size"": 0,
                                      ""r_filling_time_ms"": 0
                                    },
                                    ""r_loops"": 0,
                                    ""rows"": 445,
                                    ""r_rows"": null,
                                    ""filtered"": 14.01837444,
                                    ""r_filtered"": null,
                                    ""attached_condition"": ""p.perm_type = 'perms/collection-access' and (p.perm_value = 'read-and-write' or p.perm_value = 'read') and 1 <> p.collection_id and p.collection_id is not null""
                                  },
                                  ""table"": {
                                    ""table_name"": ""c"",
                                    ""access_type"": ""eq_ref"",
                                    ""possible_keys"": [""PRIMARY""],
                                    ""key"": ""PRIMARY"",
                                    ""key_length"": ""4"",
                                    ""used_key_parts"": [""id""],
                                    ""ref"": [""metabase_update.p.collection_id""],
                                    ""r_loops"": 0,
                                    ""rows"": 1,
                                    ""r_rows"": null,
                                    ""filtered"": 100,
                                    ""r_filtered"": null
                                  }
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          }
        }
      }
    }
  }
}
```
</details>

ppavlov39 (Issue Creator) on (2025-01-01 16:14:04 UTC): Could you please tell me when this version will be available?

paoliniluis on (2025-01-01 20:06:42 UTC): So... this is simply a result of how we do collection permissions in Metabase (which is currently sub optimal).

The problem lies in here:
```
SELECT 1
FROM ` collection ` AS ` c2 `
WHERE ((` c2 `.` id ` IS NULL)
   OR
    (` c2 `.` id ` IN (SELECT ` id `
    FROM (SELECT ` c `.*
    FROM ` collection ` AS ` c `
    INNER JOIN ` permissions ` AS ` p ` ON ` c `.` id ` = ` p `.` collection_id `
    INNER JOIN ` permissions_group ` AS ` pg ` ON ` pg `.` id ` = ` p `.` group_id `
    INNER JOIN ` permissions_group_membership ` AS ` pgm ` ON ` pgm `.` group_id ` = ` pg `.` id `
    WHERE (` pgm `.` user_id ` =
    <insert_problematic_user_id_here
  AND (` p `.` perm_type ` = 'perms/collection-access')
  AND ((` p `.` perm_value ` = 'read-and-write')
   OR (` p `.` perm_value ` = 'read'))
    UNION ALL
    SELECT ` c `.*
    FROM ` collection ` AS ` c `
    WHERE ` type ` = 'trash'
    UNION ALL
    SELECT ` c `.*
    FROM ` collection ` AS ` c `
    WHERE ` id ` IN (
    <insert_problematic_collection_id_here
    WHERE (` archived ` = FALSE))))
  AND (` c `.` location ` = CONCAT(` c2 `.` location `
    , ` c2 `.` id `
    , '/'))))))
```

related to https://github.com/metabase/metabase/issues/46697 and https://github.com/metabase/metabase/issues/36442, probably also to https://github.com/metabase/metabase/issues/48674

tagging @luizarakaki, as there might be 2 ways out of this:
1) we might be able to optimize the query for the items endpoint
2) re-do the permission checks for the collections, as this has been in the waiting list for some time now

noahmoss (Assginee) on (2025-01-08 19:20:25 UTC): @ppavlov39 Metabase 52.5 was released today. Would you be able to update and let us know if the you're still seeing the issue?

ppavlov39 (Issue Creator) on (2025-01-09 12:12:14 UTC): Today I've checked the new version on my laptop in docker connected to the production DB cluster (using separate DB). The problem still persists.

![Image](https://github.com/user-attachments/assets/24a3be15-6478-4445-b95e-8316a17e6ce6)

Below are the slow logs, maybe they will be useful.
<details><summary>The first query for path /api/collection/< cid >/items?models=dashboard</summary>
The full path is http://127.0.0.1:3000/api/collection/< cid >/items?models=dashboard&models=dataset&models=card&models=metric&models=snippet&models=collection&pinned_state=is_not_pinned&limit=25&offset=0&sort_column=name&sort_direction=asc


```sql
# QC_hit: No
# Query_time: 2.651719 Lock_time: 0.000907 Rows_sent: 2 Rows_examined: 4
# Rows_affected: 0 Bytes_sent: 1987

SET timestamp = 1736416431;
SELECT *
FROM (SELECT 5                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'card'           AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'question')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 7            AS `model_ranking`,
             `id`,
             `name`,
             `description`,
             `entity_id`,
             NULL         AS `display`,
             NULL         AS `collection_preview`,
             NULL         AS `dataset_query`,
             `id`         AS `collection_id`,
             `archived_directly`,
             'collection' AS `model`,
             NULL         AS `collection_position`,
             `authority_level`,
             `personal_owner_id`,
             `location`,
             NULL         AS `last_edit_email`,
             NULL         AS `last_edit_first_name`,
             NULL         AS `last_edit_last_name`,
             NULL         AS `moderated_status`,
             NULL         AS `icon`,
             NULL         AS `last_edit_user`,
             NULL         AS `last_edit_timestamp`,
             NULL         AS `database_id`,
             `type`       AS `collection_type`,
             `archived`,
             NULL         AS `last_used_at`,
             NULL         AS `table_id`,
             NULL         AS `is_upload`,
             NULL         AS `query_type`
      FROM `collection` AS `col`
      WHERE ((`id` IN (SELECT `id`
                       FROM (SELECT `c`.*
                             FROM `collection` AS `c`
                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                             WHERE (`pgm`.`user_id` = <USER_ID>)
                               AND (`p`.`perm_type` = 'perms/collection-access')
                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `type` = 'trash'
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                       WHERE (`archived` = FALSE)
                         AND ((`location` LIKE '/441/%') AND
                              NOT EXISTS(SELECT 1 FROM `collection` AS `c2` WHERE ((`c2`.`id` IS NULL) OR (`c2`.`id` IN (SELECT `id` FROM (SELECT `c`.* FROM `collection` AS `c` INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id` INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id` INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id` WHERE (`pgm`.`user_id` = <USER_ID>) AND (`p`.`perm_type` = 'perms/collection-access') AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read')) UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `type` = 'trash' UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `id` IN (<COLLECTION_ID>)) AS `c` WHERE (`archived` = FALSE)))) AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')) AND (`c2`.`id` <> 441))))))
        AND (`personal_owner_id` IS NULL)
        AND ((`archived` = FALSE) AND (`id` <> <ANOTHER_COLLECTION_ID>))
        AND (`namespace` IS NULL)
        AND ((`namespace` IS NULL) OR (`namespace` <> 'snippets'))
        AND (NULL IS NULL)
      UNION ALL
      SELECT 1                AS `model_ranking`,
             `d`.`id`,
             `d`.`name`,
             `d`.`description`,
             `d`.`entity_id`,
             NULL             AS `display`,
             NULL             AS `collection_preview`,
             NULL             AS `dataset_query`,
             `d`.`collection_id`,
             `d`.`archived_directly`,
             'dashboard'      AS `model`,
             `d`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `archived`,
             `last_viewed_at` AS `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_dashboard` AS `d`
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'dashboard')
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = 441) AND (`d`.`archived_directly` <> TRUE))
        AND (`archived` = FALSE)
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 3                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'dataset'        AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             `c`.`table_id`,
             `t`.`is_upload`,
             `c`.`query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'model')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 4                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'metric'         AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'metric')
        AND (`collection_position` IS NULL)) AS `dummy_alias`
ORDER BY (CASE WHEN `authority_level` = 'official' THEN 0 ELSE 1 END) ASC,
         (CASE WHEN `collection_type` IS NULL THEN 0 WHEN `collection_type` = 'trash' THEN 1 ELSE 2 END) ASC,
         LOWER(`name`) ASC
LIMIT 25 OFFSET 0;
```
</details>

<details><summary>The second query for path /api/collection/< cid >/items?models=dashboard</summary>

```sql
# QC_hit: No
# Query_time: 2.413174 Lock_time: 0.001334 Rows_sent: 0 Rows_examined: 0
# Rows_affected: 0 Bytes_sent: 1791 

SET timestamp = 1736416431;
SELECT *
FROM (SELECT 5                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'card'           AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'question')
        AND (`collection_position` IS NOT NULL)
      UNION ALL
      SELECT 7            AS `model_ranking`,
             `id`,
             `name`,
             `description`,
             `entity_id`,
             NULL         AS `display`,
             NULL         AS `collection_preview`,
             NULL         AS `dataset_query`,
             `id`         AS `collection_id`,
             `archived_directly`,
             'collection' AS `model`,
             NULL         AS `collection_position`,
             `authority_level`,
             `personal_owner_id`,
             `location`,
             NULL         AS `last_edit_email`,
             NULL         AS `last_edit_first_name`,
             NULL         AS `last_edit_last_name`,
             NULL         AS `moderated_status`,
             NULL         AS `icon`,
             NULL         AS `last_edit_user`,
             NULL         AS `last_edit_timestamp`,
             NULL         AS `database_id`,
             `type`       AS `collection_type`,
             `archived`,
             NULL         AS `last_used_at`,
             NULL         AS `table_id`,
             NULL         AS `is_upload`,
             NULL         AS `query_type`
      FROM `collection` AS `col`
      WHERE ((`id` IN (SELECT `id`
                       FROM (SELECT `c`.*
                             FROM `collection` AS `c`
                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                             WHERE (`pgm`.`user_id` = <USER_ID>)
                               AND (`p`.`perm_type` = 'perms/collection-access')
                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `type` = 'trash'
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                       WHERE (`archived` = FALSE)
                         AND ((`location` LIKE '/441/%') AND
                              NOT EXISTS(SELECT 1 FROM `collection` AS `c2` WHERE ((`c2`.`id` IS NULL) OR (`c2`.`id` IN (SELECT `id` FROM (SELECT `c`.* FROM `collection` AS `c` INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id` INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id` INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id` WHERE (`pgm`.`user_id` = <USER_ID>) AND (`p`.`perm_type` = 'perms/collection-access') AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read')) UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `type` = 'trash' UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `id` IN (<COLLECTION_ID>)) AS `c` WHERE (`archived` = FALSE)))) AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')) AND (`c2`.`id` <> 441))))))
        AND (`personal_owner_id` IS NULL)
        AND ((`archived` = FALSE) AND (`id` <> <ANOTHER_COLLECTION_ID>))
        AND (`namespace` IS NULL)
        AND ((`namespace` IS NULL) OR (`namespace` <> 'snippets'))
        AND (NULL IS NOT NULL)
      UNION ALL
      SELECT 1                AS `model_ranking`,
             `d`.`id`,
             `d`.`name`,
             `d`.`description`,
             `d`.`entity_id`,
             NULL             AS `display`,
             NULL             AS `collection_preview`,
             NULL             AS `dataset_query`,
             `d`.`collection_id`,
             `d`.`archived_directly`,
             'dashboard'      AS `model`,
             `d`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `archived`,
             `last_viewed_at` AS `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_dashboard` AS `d`
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'dashboard')
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = 441) AND (`d`.`archived_directly` <> TRUE))
        AND (`archived` = FALSE)
        AND (`collection_position` IS NOT NULL)
      UNION ALL
      SELECT 3                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'dataset'        AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             `c`.`table_id`,
             `t`.`is_upload`,
             `c`.`query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'model')
        AND (`collection_position` IS NOT NULL)
      UNION ALL
      SELECT 4                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'metric'         AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = 441) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'metric')
        AND (`collection_position` IS NOT NULL)
      UNION ALL
      SELECT DISTINCT 2       AS `model_ranking`,
                      `p`.`id`,
                      `p`.`name`,
                      NULL    AS `description`,
                      `p`.`entity_id`,
                      NULL    AS `display`,
                      NULL    AS `collection_preview`,
                      NULL    AS `dataset_query`,
                      `p`.`collection_id`,
                      NULL    AS `archived_directly`,
                      'pulse' AS `model`,
                      `p`.`collection_position`,
                      NULL    AS `authority_level`,
                      NULL    AS `personal_owner_id`,
                      NULL    AS `location`,
                      NULL    AS `last_edit_email`,
                      NULL    AS `last_edit_first_name`,
                      NULL    AS `last_edit_last_name`,
                      NULL    AS `moderated_status`,
                      NULL    AS `icon`,
                      NULL    AS `last_edit_user`,
                      NULL    AS `last_edit_timestamp`,
                      NULL    AS `database_id`,
                      NULL    AS `collection_type`,
                      NULL    AS `archived`,
                      NULL    AS `last_used_at`,
                      NULL    AS `table_id`,
                      NULL    AS `is_upload`,
                      NULL    AS `query_type`
      FROM `pulse` AS `p`
               LEFT JOIN `pulse_card` AS `pc` ON `p`.`id` = `pc`.`pulse_id`
      WHERE (`p`.`collection_id` = 441)
        AND (`p`.`archived` = FALSE)
        AND (`p`.`alert_condition` IS NULL)
        AND (`p`.`dashboard_id` IS NULL)
        AND (`p`.`collection_position` IS NOT NULL)
      UNION ALL
      SELECT 8          AS `model_ranking`,
             `id`,
             `name`,
             `description`,
             `entity_id`,
             NULL       AS `display`,
             NULL       AS `collection_preview`,
             NULL       AS `dataset_query`,
             `collection_id`,
             NULL       AS `archived_directly`,
             'timeline' AS `model`,
             NULL       AS `collection_position`,
             NULL       AS `authority_level`,
             NULL       AS `personal_owner_id`,
             NULL       AS `location`,
             NULL       AS `last_edit_email`,
             NULL       AS `last_edit_first_name`,
             NULL       AS `last_edit_last_name`,
             NULL       AS `moderated_status`,
             `icon`,
             NULL       AS `last_edit_user`,
             NULL       AS `last_edit_timestamp`,
             NULL       AS `database_id`,
             NULL       AS `collection_type`,
             NULL       AS `archived`,
             NULL       AS `last_used_at`,
             NULL       AS `table_id`,
             NULL       AS `is_upload`,
             NULL       AS `query_type`
      FROM `timeline` AS `timeline`
      WHERE (1 = 2)
        AND (`collection_id` = 441)
        AND (`archived` = FALSE)) AS `dummy_alias`
ORDER BY (CASE WHEN `authority_level` = 'official' THEN 0 ELSE 1 END) ASC,
         (CASE WHEN `collection_type` IS NULL THEN 0 WHEN `collection_type` = 'trash' THEN 1 ELSE 2 END) ASC,
         LOWER(`name`) ASC;
```
</details>

<details><summary>The first query for path /api/collection/< cid >/items?pinned_state=is_pinned</summary>
The full path is http://127.0.0.1:3000/api/collection/< cid >/items?pinned_state=is_pinned&sort_column=name&sort_direction=asc

```sql
# QC_hit: No
# Query_time: 2.571262 Lock_time: 0.001132 Rows_sent: 1 Rows_examined: 2
# Rows_affected: 0 Bytes_sent: 53 

SET timestamp = 1736416428;
SELECT COUNT(*) AS `count`
FROM (SELECT 5                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'card'           AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'question')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 7            AS `model_ranking`,
             `id`,
             `name`,
             `description`,
             `entity_id`,
             NULL         AS `display`,
             NULL         AS `collection_preview`,
             NULL         AS `dataset_query`,
             `id`         AS `collection_id`,
             `archived_directly`,
             'collection' AS `model`,
             NULL         AS `collection_position`,
             `authority_level`,
             `personal_owner_id`,
             `location`,
             NULL         AS `last_edit_email`,
             NULL         AS `last_edit_first_name`,
             NULL         AS `last_edit_last_name`,
             NULL         AS `moderated_status`,
             NULL         AS `icon`,
             NULL         AS `last_edit_user`,
             NULL         AS `last_edit_timestamp`,
             NULL         AS `database_id`,
             `type`       AS `collection_type`,
             `archived`,
             NULL         AS `last_used_at`,
             NULL         AS `table_id`,
             NULL         AS `is_upload`,
             NULL         AS `query_type`
      FROM `collection` AS `col`
      WHERE ((`id` IN (SELECT `id`
                       FROM (SELECT `c`.*
                             FROM `collection` AS `c`
                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                             WHERE (`pgm`.`user_id` = <USER_ID>)
                               AND (`p`.`perm_type` = 'perms/collection-access')
                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `type` = 'trash'
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                       WHERE (`archived` = FALSE)
                         AND ((`location` LIKE '/<COLLECTION_ID>/%') AND
                              NOT EXISTS(SELECT 1 FROM `collection` AS `c2` WHERE ((`c2`.`id` IS NULL) OR (`c2`.`id` IN (SELECT `id` FROM (SELECT `c`.* FROM `collection` AS `c` INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id` INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id` INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id` WHERE (`pgm`.`user_id` = <USER_ID>) AND (`p`.`perm_type` = 'perms/collection-access') AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read')) UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `type` = 'trash' UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `id` IN (<COLLECTION_ID>)) AS `c` WHERE (`archived` = FALSE)))) AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')) AND (`c2`.`id` <> <COLLECTION_ID>))))))
        AND (`personal_owner_id` IS NULL)
        AND ((`archived` = FALSE) AND (`id` <> <ANOTHER_COLLECTION_ID>))
        AND (`namespace` IS NULL)
        AND ((`namespace` IS NULL) OR (`namespace` <> 'snippets'))
        AND (NULL IS NULL)
      UNION ALL
      SELECT 1                AS `model_ranking`,
             `d`.`id`,
             `d`.`name`,
             `d`.`description`,
             `d`.`entity_id`,
             NULL             AS `display`,
             NULL             AS `collection_preview`,
             NULL             AS `dataset_query`,
             `d`.`collection_id`,
             `d`.`archived_directly`,
             'dashboard'      AS `model`,
             `d`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `archived`,
             `last_viewed_at` AS `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_dashboard` AS `d`
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'dashboard')
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`d`.`archived_directly` <> TRUE))
        AND (`archived` = FALSE)
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 3                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'dataset'        AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             `c`.`table_id`,
             `t`.`is_upload`,
             `c`.`query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'model')
        AND (`collection_position` IS NULL)
      UNION ALL
      SELECT 4                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'metric'         AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'metric')
        AND (`collection_position` IS NULL)) AS `dummy_alias`;
```
</details>

<details><summary>The second query for path /api/collection/< cid >/items?pinned_state=is_pinned</summary>

```sql
# QC_hit: No
# Query_time: 2.293093 Lock_time: 0.000951 Rows_sent: 1 Rows_examined: 0
# Rows_affected: 0 Bytes_sent: 53 

SET timestamp = 1736416428;
SELECT COUNT(*) AS `count`
FROM (SELECT 5                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'card'           AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'question')
        AND (`collection_position` IS NOT NULL)
      UNION ALL
      SELECT 7            AS `model_ranking`,
             `id`,
             `name`,
             `description`,
             `entity_id`,
             NULL         AS `display`,
             NULL         AS `collection_preview`,
             NULL         AS `dataset_query`,
             `id`         AS `collection_id`,
             `archived_directly`,
             'collection' AS `model`,
             NULL         AS `collection_position`,
             `authority_level`,
             `personal_owner_id`,
             `location`,
             NULL         AS `last_edit_email`,
             NULL         AS `last_edit_first_name`,
             NULL         AS `last_edit_last_name`,
             NULL         AS `moderated_status`,
             NULL         AS `icon`,
             NULL         AS `last_edit_user`,
             NULL         AS `last_edit_timestamp`,
             NULL         AS `database_id`,
             `type`       AS `collection_type`,
             `archived`,
             NULL         AS `last_used_at`,
             NULL         AS `table_id`,
             NULL         AS `is_upload`,
             NULL         AS `query_type`
      FROM `collection` AS `col`
      WHERE ((`id` IN (SELECT `id`
                       FROM (SELECT `c`.*
                             FROM `collection` AS `c`
                                      INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                      INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                      INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                             WHERE (`pgm`.`user_id` = <USER_ID>)
                               AND (`p`.`perm_type` = 'perms/collection-access')
                               AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `type` = 'trash'
                             UNION ALL
                             SELECT `c`.*
                             FROM `collection` AS `c`
                             WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                       WHERE (`archived` = FALSE)
                         AND ((`location` LIKE '/<COLLECTION_ID>/%') AND
                              NOT EXISTS(SELECT 1 FROM `collection` AS `c2` WHERE ((`c2`.`id` IS NULL) OR (`c2`.`id` IN (SELECT `id` FROM (SELECT `c`.* FROM `collection` AS `c` INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id` INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id` INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id` WHERE (`pgm`.`user_id` = <USER_ID>) AND (`p`.`perm_type` = 'perms/collection-access') AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read')) UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `type` = 'trash' UNION ALL SELECT `c`.* FROM `collection` AS `c` WHERE `id` IN (<COLLECTION_ID>)) AS `c` WHERE (`archived` = FALSE)))) AND (`c`.`location` = CONCAT(`c2`.`location`, `c2`.`id`, '/')) AND (`c2`.`id` <> <COLLECTION_ID>))))))
        AND (`personal_owner_id` IS NULL)
        AND ((`archived` = FALSE) AND (`id` <> <ANOTHER_COLLECTION_ID>))
        AND (`namespace` IS NULL)
        AND ((`namespace` IS NULL) OR (`namespace` <> 'snippets'))
        AND (NULL IS NOT NULL)
      UNION ALL
      SELECT 1                AS `model_ranking`,
             `d`.`id`,
             `d`.`name`,
             `d`.`description`,
             `d`.`entity_id`,
             NULL             AS `display`,
             NULL             AS `collection_preview`,
             NULL             AS `dataset_query`,
             `d`.`collection_id`,
             `d`.`archived_directly`,
             'dashboard'      AS `model`,
             `d`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `archived`,
             `last_viewed_at` AS `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_dashboard` AS `d`
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `d`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'dashboard')
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `d`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Dashboard')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`d`.`archived_directly` <> TRUE))
        AND (`archived` = FALSE)
        AND (`collection_position` IS NOT NULL)
      UNION ALL
      SELECT 3                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'dataset'        AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             `c`.`database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             `c`.`table_id`,
             `t`.`is_upload`,
             `c`.`query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
               LEFT JOIN `metabase_table` AS `t` ON `t`.`id` = `c`.`table_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'model')
        AND (`collection_position` IS NOT NULL)
      UNION ALL
      SELECT 4                AS `model_ranking`,
             `c`.`id`,
             `c`.`name`,
             `c`.`description`,
             `c`.`entity_id`,
             `c`.`display`,
             `c`.`collection_preview`,
             `c`.`dataset_query`,
             `c`.`collection_id`,
             `c`.`archived_directly`,
             'metric'         AS `model`,
             `c`.`collection_position`,
             NULL             AS `authority_level`,
             NULL             AS `personal_owner_id`,
             NULL             AS `location`,
             `u`.`email`      AS `last_edit_email`,
             `u`.`first_name` AS `last_edit_first_name`,
             `u`.`last_name`  AS `last_edit_last_name`,
             `mr`.`status`    AS `moderated_status`,
             NULL             AS `icon`,
             `u`.`id`         AS `last_edit_user`,
             `r`.`timestamp`  AS `last_edit_timestamp`,
             NULL             AS `database_id`,
             NULL             AS `collection_type`,
             `c`.`archived`,
             `last_used_at`,
             NULL             AS `table_id`,
             NULL             AS `is_upload`,
             NULL             AS `query_type`
      FROM `report_card` AS `c`
               LEFT JOIN `revision` AS `r`
                         ON (`r`.`model_id` = `c`.`id`) AND (`r`.`most_recent` = TRUE) AND (`r`.`model` = 'Card')
               LEFT JOIN `moderation_review` AS `mr`
                         ON (`mr`.`moderated_item_id` = `c`.`id`) AND (`mr`.`most_recent` = TRUE) AND
                            (`mr`.`moderated_item_type` = 'card')
               LEFT JOIN `core_user` AS `u` ON `u`.`id` = `r`.`user_id`
      WHERE ((`collection_id` IS NULL) OR (`collection_id` IN (SELECT `id`
                                                               FROM (SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                              INNER JOIN `permissions` AS `p` ON `c`.`id` = `p`.`collection_id`
                                                                              INNER JOIN `permissions_group` AS `pg` ON `pg`.`id` = `p`.`group_id`
                                                                              INNER JOIN `permissions_group_membership` AS `pgm` ON `pgm`.`group_id` = `pg`.`id`
                                                                     WHERE (`pgm`.`user_id` = <USER_ID>)
                                                                       AND (`p`.`perm_type` = 'perms/collection-access')
                                                                       AND ((`p`.`perm_value` = 'read-and-write') OR (`p`.`perm_value` = 'read'))
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `type` = 'trash'
                                                                     UNION ALL
                                                                     SELECT `c`.*
                                                                     FROM `collection` AS `c`
                                                                     WHERE `id` IN (<COLLECTION_ID>)) AS `c`
                                                               WHERE (<ANOTHER_COLLECTION_ID> <> `id`))))
        AND ((`collection_id` = <COLLECTION_ID>) AND (`c`.`archived_directly` = FALSE))
        AND (`archived` = FALSE)
        AND (`c`.`type` = 'metric')
        AND (`collection_position` IS NOT NULL)
      UNION ALL
      SELECT DISTINCT 2       AS `model_ranking`,
                      `p`.`id`,
                      `p`.`name`,
                      NULL    AS `description`,
                      `p`.`entity_id`,
                      NULL    AS `display`,
                      NULL    AS `collection_preview`,
                      NULL    AS `dataset_query`,
                      `p`.`collection_id`,
                      NULL    AS `archived_directly`,
                      'pulse' AS `model`,
                      `p`.`collection_position`,
                      NULL    AS `authority_level`,
                      NULL    AS `personal_owner_id`,
                      NULL    AS `location`,
                      NULL    AS `last_edit_email`,
                      NULL    AS `last_edit_first_name`,
                      NULL    AS `last_edit_last_name`,
                      NULL    AS `moderated_status`,
                      NULL    AS `icon`,
                      NULL    AS `last_edit_user`,
                      NULL    AS `last_edit_timestamp`,
                      NULL    AS `database_id`,
                      NULL    AS `collection_type`,
                      NULL    AS `archived`,
                      NULL    AS `last_used_at`,
                      NULL    AS `table_id`,
                      NULL    AS `is_upload`,
                      NULL    AS `query_type`
      FROM `pulse` AS `p`
               LEFT JOIN `pulse_card` AS `pc` ON `p`.`id` = `pc`.`pulse_id`
      WHERE (`p`.`collection_id` = <COLLECTION_ID>)
        AND (`p`.`archived` = FALSE)
        AND (`p`.`alert_condition` IS NULL)
        AND (`p`.`dashboard_id` IS NULL)
        AND (`p`.`collection_position` IS NOT NULL)
      UNION ALL
      SELECT 8          AS `model_ranking`,
             `id`,
             `name`,
             `description`,
             `entity_id`,
             NULL       AS `display`,
             NULL       AS `collection_preview`,
             NULL       AS `dataset_query`,
             `collection_id`,
             NULL       AS `archived_directly`,
             'timeline' AS `model`,
             NULL       AS `collection_position`,
             NULL       AS `authority_level`,
             NULL       AS `personal_owner_id`,
             NULL       AS `location`,
             NULL       AS `last_edit_email`,
             NULL       AS `last_edit_first_name`,
             NULL       AS `last_edit_last_name`,
             NULL       AS `moderated_status`,
             `icon`,
             NULL       AS `last_edit_user`,
             NULL       AS `last_edit_timestamp`,
             NULL       AS `database_id`,
             NULL       AS `collection_type`,
             NULL       AS `archived`,
             NULL       AS `last_used_at`,
             NULL       AS `table_id`,
             NULL       AS `is_upload`,
             NULL       AS `query_type`
      FROM `timeline` AS `timeline`
      WHERE (1 = 2)
        AND (`collection_id` = <COLLECTION_ID>)
        AND (`archived` = FALSE)) AS `dummy_alias`;
```
</details>

noahmoss (Assginee) on (2025-01-13 23:57:59 UTC): @ppavlov39 I made some further optimizations in https://github.com/metabase/metabase/pull/51929 which will go out in the next 52 release (scheduled for this Wednesday 1/15). I suspect they should help a lot, although loading a collection with many children may still take around 1-2 seconds for a user in 50+ groups based on my testing.

For now I'll keep the issue open but downgrade to a P2.

ppavlov39 (Issue Creator) on (2025-01-16 12:14:01 UTC): I checked the speed of the web interface in the new version. 
The time it takes for a user with 43 groups to see a list of collections has decreased to 2-3 seconds. But, unfortunately, users unfamiliar with such a delay may still not wait for the collections to appear and click somewhere else.

![Image](https://github.com/user-attachments/assets/ef3f8f7e-b93f-488a-beee-f1afc7599772)

luizarakaki on (2025-01-16 19:23:38 UTC): @ppavlov39 offtopic, but would you be willing to share why you use MariaDB as the appDB?
We are learning more why users adopt MySQL/MariaDB, if you can, please send me an email: luiz.arakaki@metabase.com

ppavlov39 (Issue Creator) on (2025-01-17 06:09:01 UTC): Since this may be related to the topic, I will answer here and at the same time ask a question on this topic.
We use MySQL because our company has extensive experience in its support. We are currently just trying out Postgres..

One of the options that we are currently considering to smooth out the current situation is switching to Postgres. Can you recommend doing this to solve this problem.

luizarakaki on (2025-01-17 14:41:44 UTC): I generally recommend using Postgres because it is what we use in development environments.

But in this case, we reproduced this issue on Postgres too. There might be minor improvements, but won't resolve it.

ppavlov39 (Issue Creator) on (2025-01-20 08:10:11 UTC): Would you able to solve the problem?
We can review the user permissions management (now it is one security group for one collection), but it is better not to do this, It will take to much time. And it won't be as flexible as it is now.

luizarakaki on (2025-01-20 13:27:48 UTC): We are investigating, but optimizing for this number of collections and simultaneous user groups isn't a quickfix.
At this point, we are weeks to months from resolving this. Can you optimize this on your side?

Also, if you can comment on the use case. Why do you have 2500 collections? You have more collections than users.

ppavlov39 (Issue Creator) on (2025-01-21 06:26:01 UTC): Thank you! It will be great!

As I already mentioned, reorganizing access control will require significant resources, also weeks or months (calendar-wise). And this will potentially deprive us of flexibility in access control. For now, we want to avoid this.

This number of collections is due to the fact that one day we decided to improve the purity of collections and subcollections that users work with. For this, additional subcollections were created for all the above-mentioned collections and subcollections, in which all cards were placed. Only dashboards remained in the main collections.

This can be represented as follows:

- Collection
  - Subcollection for cards
  - Some user subcollection
    - Subcollection for cards
  - Some user subcollection
    - Subcollection for cards
    - Some user subcollection
      - Subcollection for cards
- Another collection
  - Subcollection for cards

ppavlov39 (Issue Creator) on (2025-01-21 13:19:34 UTC): Just in case, I checked the distribution of collections, we have:
- about 1000 personal collections;
- about 700 subcollections for cards;
- about 100 subcollections for our archive (for outdated cards that are still needed);
- about 1300 regular collections and subcollections.

ppavlov39 (Issue Creator) on (2025-01-22 09:43:59 UTC): It seems that a small increase in the interface speed can be achieved by excluding all identical records from this [CTE](https://github.com/metabase/metabase/blob/master/src/metabase/api/collection.clj#L432) (by adding DISTINCT).

ppavlov39 (Issue Creator) on (2025-01-22 13:50:01 UTC): Perhaps caching user permissions might be appropriate in this case.

"
2751756633,issue,open,,Questions with Detail Viz Type Poorly Formatted on Dashboards,"### Describe the bug

When adding a Question with a Detail viz type to a dashboard, the whitespacing does not work as expected. It keeps an unnecessary amount of right-padded space; when the size is made smaller it comes at the expense of column names being formatted to multiple lines and ultimately truncated. This leads to requiring dashboards with a bunch of whitespace between questions to make sure names aren't cut out.

Example when fully across a large dashboard
<img width=""1348"" alt=""Image"" src=""https://github.com/user-attachments/assets/5694217b-6009-45a0-9823-1bf1b9fa2134"" />

Column names become multi-line when there is plenty of space 
<img width=""1378"" alt=""Image"" src=""https://github.com/user-attachments/assets/8e6be2b7-7717-4574-a2ff-d153cd4e40c4"" />


### To Reproduce

1. Go to any dashboard
2. Add a question with a Detail type
3. Change the question size to anything, the additional whitespace and poor formatting remains.


### Expected behavior

I should be able to make the question the size up to the red line and it not cause formatting issues

<img width=""1378"" alt=""Image"" src=""https://github.com/user-attachments/assets/bd7954fc-b532-40f3-9f3a-53eea8177a67"" />


### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""snowflake"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-cloud"",
    ""version"": {
      ""date"": ""2024-12-16"",
      ""tag"": ""v1.52.3.1"",
      ""hash"": ""94aa8fd""
    },
    ""settings"": {
      ""report-timezone"": ""America/Los_Angeles""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres""
  }
}
```

### Severity

Blocking usage of the Detail question type

### Additional context

_No response_",andresrecalde,2024-12-20 01:52:33+00:00,[],2025-02-04 20:31:34+00:00,,https://github.com/metabase/metabase/issues/51557,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Detail', 'ObjectDetail'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2750958179,issue,closed,completed,Runtime errors when re-bundling embedding sdk with ESBuild,"A customer is building a shared package with ESBuild by using the Embedding SDK as a dependency. When consuming the shared package in each application in their internal monorepo (e.g. by using `vite` for frontend and `yalc` for linking packages) they ran into errors originating from the Embedding SDK.

Refer to this thread in the [customer channel](https://metaboat.slack.com/archives/C07166YL2UU/p1734549096874829) for more context.",heypoom,2024-12-19 17:03:39+00:00,['heypoom'],2024-12-23 14:36:14+00:00,2024-12-23 14:36:14+00:00,https://github.com/metabase/metabase/issues/51526,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2750945474,issue,closed,completed,Update SDK release workflow to release 52-stable,Updates the SDK release workflow to be able to release `52-stable` without breaking cross-version tests,heypoom,2024-12-19 16:59:23+00:00,['heypoom'],2024-12-23 07:48:23+00:00,2024-12-23 07:08:24+00:00,https://github.com/metabase/metabase/issues/51525,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2750926872,issue,closed,completed,CSS issue: Metabase Dashboards that display a bunch of table data are nearly invisible in dark mode,"### Describe the bug

Hello, we're running latest Metabase 52.2.3, JDK 17 on linux/mysql8.

I don't know which exact release this broke in, but a lot of our dashboards are nearly invisible in dark mode/full screen.  I've redacted some of the data below with background colors, but you can see below that the dark text on a dark background is nearly impossible to read.

![Image](https://github.com/user-attachments/assets/57713203-97c1-418d-87f4-330f7b617411)

We're happy long time Metabase users and continue to recommend the platform to everyone we know. Thank you for your consideration! To avoid creating additional work, I did search for existing bugs on this but did not find a similar one. If my search was ineffective, my apologies for adding a duplicate ticket, please feel free to close this and link me to the correct one.

### To Reproduce

1. Create a dashboard with a tables
2. Enter Full screen and select dark mode
3. Squint

### Expected behavior

These were legible up to a recent release, I imagine this was just an oversight. I believe the bug existed in 52.2.2 as well

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.2 Safari/605.1.15"",
    ""vendor"": ""Apple Computer, Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""mongo""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-14"",
      ""tag"": ""v0.52.3"",
      ""hash"": ""6f76bb6""
    },
    ""settings"": {
      ""report-timezone"": ""US/Central""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.39-30""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""17.0.12+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""17.0.12"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""17.0.12+7"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-126-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Chicago""
  }
}
```

### Severity

Blocking Some Usages/Obnoxious, but there is a workaround: use light mode

### Additional context

_No response_",exabrial,2024-12-19 16:52:31+00:00,['heypoom'],2024-12-20 11:31:03+00:00,2024-12-20 11:05:45+00:00,https://github.com/metabase/metabase/issues/51524,"[('Type:Bug', 'Product defects'), ('.CSS', ''), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations'), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Team/Embedding', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Bug:v52', 'bugs or regressions introduced in v52')]","[{'comment_id': 2556819811, 'issue_id': 2750926872, 'author': 'heypoom', 'body': ""Thank you so much for the detailed report @exabrial! We'll deliver the fix (#51538) in the next minor releases for 51 and 52."", 'created_at': datetime.datetime(2024, 12, 20, 11, 30, 4, tzinfo=datetime.timezone.utc)}]","heypoom (Assginee) on (2024-12-20 11:30:04 UTC): Thank you so much for the detailed report @exabrial! We'll deliver the fix (#51538) in the next minor releases for 51 and 52.

"
2750777033,issue,closed,completed,Bar chart has overlapping bars,"**Context**

[This bar chart](https://metaboat.slack.com/archives/C064QMXEV9N/p1734586475351119) has overlapping bars:
<img width=""307"" alt=""Image"" src=""https://github.com/user-attachments/assets/3dce5cde-0a33-433b-8ecd-2290f338aee8"" />

Can be related to the `stacking` setting as none appear selected:
<img width=""214"" alt=""Image"" src=""https://github.com/user-attachments/assets/cb8b7df0-9762-4bf9-a6a9-bacc4b8d6308"" />

",alxnddr,2024-12-19 15:57:06+00:00,['alxnddr'],2024-12-20 16:25:16+00:00,2024-12-20 15:42:49+00:00,https://github.com/metabase/metabase/issues/51521,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2749272228,issue,closed,completed,Use custom test helpers for native query editor,,romeovs,2024-12-19 05:06:57+00:00,[],2024-12-23 15:53:04+00:00,2024-12-23 15:53:04+00:00,https://github.com/metabase/metabase/issues/51493,[],[],
2748794949,issue,closed,completed,Changes to Scatterplot Tooltip Default Behavior is a Breaking change for Some Customers,"### Describe the bug

We now allow dimensions to be explicitly added to the tooltips for scatterplots. By default these are not displayed. This is a breaking change for customers that previously relied on the dimensions to be visible in the tooltips.

### To Reproduce

Make a scatterplot in 51+

### Expected behavior

1) On scatter charts only show all columns in tooltips by default
or
2) Revert scatter charts tooltips to show content of v50

### Logs

_No response_

### Information about your Metabase installation

```JSON
v52
```

### Severity

Blocking for some customers

### Additional context

_No response_",ixipixi,2024-12-18 21:37:31+00:00,['alxnddr'],2024-12-19 21:21:10+00:00,2024-12-19 20:59:16+00:00,https://github.com/metabase/metabase/issues/51483,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Escalation', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Bug:v52', 'bugs or regressions introduced in v52')]","[{'comment_id': 2555795187, 'issue_id': 2748794949, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)', 'created_at': datetime.datetime(2024, 12, 19, 21, 21, 10, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-19 21:21:10 UTC):  This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)

"
2748670883,issue,open,,Use columns from a table as filters without using pivot grouping,"My request is not directly related to a problem, however, I got frustrated when trying to use the pivot table columns as filters in other tabs of my dashboard. 
I am developing a report that provides a grouped view of my expenses. These expenses serve as a sort of classification for my charts of accounts, so within an expense, I can have N charts of accounts. 
My pivot table is as follows: Year ---> Expenses ---> Charts of accounts. 

I would like the pivot table to have an option like in the table, which allows me to choose whether a certain row, from a certain column, serves as a filter. 
In the table, I can manipulate the click behavior and say that each will correspond to a filter. My problem is in the pivot grouping, which will try to use the same value in each filter that is turned on. 

I would like to click on Logistics (expense) and be directed to the second screen with only the value of the expenses in the filter, click on fuel (chart of accounts) and have the value corresponding to that click placed in my filter, as happens in the table. 

I tried to create more groups to have more cascades in the pivot table, but it didn't work because I don't have the same autonomy for the table.

This would be extremely important to make my dashboard more dynamic, since I often need to filter a specific plan.
",JoaoFabbri,2024-12-18 20:13:56+00:00,[],2025-02-04 20:30:21+00:00,,https://github.com/metabase/metabase/issues/51478,"[('Type:New Feature', ''), ('.Needs Triage', '')]","[{'comment_id': 2569202956, 'issue_id': 2748670883, 'author': 'brunobergher', 'body': ""Joo, let me see if I got this straight: you're looking for the ability to use the group by column of a given Pivot cell as an argument for custom click behavior?"", 'created_at': datetime.datetime(2025, 1, 3, 13, 12, 5, tzinfo=datetime.timezone.utc)}]","brunobergher on (2025-01-03 13:12:05 UTC): Joo, let me see if I got this straight: you're looking for the ability to use the group by column of a given Pivot cell as an argument for custom click behavior?

"
2748593173,issue,open,,Continuous Color scale/palette for time series charts,"**Is your feature request related to a problem? Please describe.**
Right now, we have to use discrete colors in the chart options for lines or scatter. There are cases where having a continuous scale would be more beneficial for end user readability

**Describe the solution you'd like**
I would like to be able to use a continuous color scale to color the lines on the chart so the chart is more readable for the consumers.

**Describe alternatives you've considered**
I am currently building this chart through excel and python to clarify the data output

**How important is this feature to you?**
quite important, A lot of the cohort based charts would be massively improved with this feature and people would be able to read them at a glance. We lose a lot of people looking at the chart in its current state and that is just more work for our data team.

**Additional context**
Add any other context or screenshots about the feature request here.
![Current view of the data in metabase](https://github.com/user-attachments/assets/00898e70-0f9e-43f0-b8da-108baa616aa2)
![Python Example of the same data using a continuous color scale](https://github.com/user-attachments/assets/11941341-36e0-466f-99d4-afcd61bc8c2c)
",aditya-shogun,2024-12-18 19:25:32+00:00,[],2025-02-04 20:30:58+00:00,,https://github.com/metabase/metabase/issues/51474,"[('Visualization/', ''), ('Type:New Feature', ''), ('Administration/Settings', '')]","[{'comment_id': 2569199426, 'issue_id': 2748593173, 'author': 'brunobergher', 'body': 'Related to #12410 (as the overall notion of predefined palettes could go a long way) and #9682 for overall control.', 'created_at': datetime.datetime(2025, 1, 3, 13, 9, 13, tzinfo=datetime.timezone.utc)}]","brunobergher on (2025-01-03 13:09:13 UTC): Related to #12410 (as the overall notion of predefined palettes could go a long way) and #9682 for overall control.

"
2748486684,issue,open,,[MBQL lib] `Lib.replaceClause` should not drop dependent clauses when `temporal-unit` is changed,"With a query similar to
<img width=""678"" alt=""Image"" src=""https://github.com/user-attachments/assets/96c712eb-2db7-49c6-80cf-d37d6906dbee"" />

If I change the temporal unit of the breakout clause to e.g. `Month` the filter would be dropped. But we want this behavior:
- Changing `temporal-unit` should not drop dependent clauses if the effective type doesn't change. In other words, if the previous unit was an ""extraction"" unit and the new unit is also an ""extraction"" unit (like Year, Day of Month, ...) we should not drop anything. The same with ""bucketing"" units - if it was ""Month"" and now ""Quarter"" (not ""Quarter of Year""!) we should not drop clauses. But if it was ""Month"" and now ""Month of Year"" we should drop dependent clauses.
- Changing `temporal-unit` of a breakout should never drop the order by clause based on the breakout column, regardless of unit changes. It already works today and this is just a reminder that we need to preserve this behavior.
",ranquild,2024-12-18 18:32:00+00:00,[],2024-12-18 18:38:32+00:00,,https://github.com/metabase/metabase/issues/51469,[],[],
2748480047,issue,closed,completed,invite-user,,metamben,2024-12-18 18:27:58+00:00,['johnswanson'],2024-12-18 18:29:21+00:00,2024-12-18 18:29:20+00:00,https://github.com/metabase/metabase/issues/51468,[],"[{'comment_id': 2552005318, 'issue_id': 2748480047, 'author': 'metamben', 'body': 'Implemented in #51244.', 'created_at': datetime.datetime(2024, 12, 18, 18, 29, 20, tzinfo=datetime.timezone.utc)}]","metamben (Issue Creator) on (2024-12-18 18:29:20 UTC): Implemented in #51244.

"
2748476707,issue,closed,completed,generate-insights,,metamben,2024-12-18 18:25:51+00:00,['johnswanson'],2024-12-18 18:27:05+00:00,2024-12-18 18:27:03+00:00,https://github.com/metabase/metabase/issues/51467,[],"[{'comment_id': 2552001190, 'issue_id': 2748476707, 'author': 'metamben', 'body': 'Implemented in #51244.', 'created_at': datetime.datetime(2024, 12, 18, 18, 27, 3, tzinfo=datetime.timezone.utc)}]","metamben (Issue Creator) on (2024-12-18 18:27:03 UTC): Implemented in #51244.

"
2748294182,issue,open,,[Epic] Parametrize time granularity for all columns,"### Links

- [Product doc](https://www.notion.so/metabase/Parametrize-time-granularity-for-all-columns-b3cb1eb5ed7c4373b07163f0aca1054f)

### Implementation Plan

```[tasklist]
- [ ] https://github.com/metabase/metabase/issues/51469
- [ ] https://github.com/metabase/metabase/pull/51463
```

### Testing Plan

- Breakout stage - 0, 1
- Drill thru
- Breakout column usage in the next stage - join, custom column, filter, breakout, aggregation
- Multiple breakouts of the same column, including creating duplicate breakouts in the previous stage
- Multiple parameters for the base column + derived column?
- Regular/public/embed dashboards",ranquild,2024-12-18 16:43:43+00:00,['ranquild'],2024-12-18 18:49:36+00:00,,https://github.com/metabase/metabase/issues/51462,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2748127394,issue,open,,Tree-like structure grouping on the pivot table visualization,"**Is your feature request related to a problem? Please describe.**
A lead needs a specific visualization on the pivot table to group the series in a tree like structure
![Image](https://github.com/user-attachments/assets/d2e5c1ae-c2e1-4554-b3c7-41bfb060c06b)

**Describe the solution you'd like**
A custom visualization that has a tree like structure in the pivot table

**Describe alternatives you've considered**
Making a custom build

**How important is this feature to you?**
They need this specific visualization for a specific use case

**Additional context**
NA
",paoliniluis,2024-12-18 15:31:09+00:00,[],2025-02-04 20:31:56+00:00,,https://github.com/metabase/metabase/issues/51460,"[('Type:New Feature', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations')]",[],
2747654797,issue,open,,Getting wrong data in my metabase query but same query working perfectly fine in SQL server directly,"**Description of the bug or issue i am facing**
I have a SQL server query which is working perfectly fine in MS SQL server but same query giving wrong data in SQL query in metabase.
I have many questions/query/dashboard all are working fine except this one.

Kindly let me know, if any other faced same challenge and have solution for this

I am not getting any error to run the query.

Metabase Version i am using **0.52.2**


",rajeev1722,2024-12-18 12:14:57+00:00,[],2024-12-19 04:39:19+00:00,,https://github.com/metabase/metabase/issues/51445,[],"[{'comment_id': 2551296729, 'issue_id': 2747654797, 'author': 'paoliniluis', 'body': '@rajeev1722 please send all the troubleshooting info and also the query. Is there a timestamp filter?', 'created_at': datetime.datetime(2024, 12, 18, 13, 15, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2552760067, 'issue_id': 2747654797, 'author': 'rajeev1722', 'body': '@paoliniluis Thanks for your quick reply\n\n**Diagnostic Info**\n{\n  ""browser-info"": {\n    ""language"": ""en-US"",\n    ""platform"": ""Win32"",\n    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",\n    ""vendor"": ""Google Inc.""\n  },\n  ""metabase-info"": {\n    ""databases"": [\n      ""h2"",\n      ""sqlserver""\n    ],\n    ""run-mode"": ""prod"",\n    ""plan-alias"": """",\n    ""version"": {\n      ""date"": ""2024-12-09"",\n      ""tag"": ""v0.52.2"",\n      ""hash"": ""32effb1""\n    },\n    ""settings"": {\n      ""report-timezone"": null\n    },\n    ""hosting-env"": ""unknown"",\n    ""application-database"": ""h2"",\n    ""application-database-details"": {\n      ""database"": {\n        ""name"": ""H2"",\n        ""version"": ""2.1.214 (2022-06-13)""\n      },\n      ""jdbc-driver"": {\n        ""name"": ""H2 JDBC Driver"",\n        ""version"": ""2.1.214 (2022-06-13)""\n      }\n    }\n  },\n  ""system-info"": {\n    ""file.encoding"": ""Cp1252"",\n    ""java.runtime.name"": ""Java(TM) SE Runtime Environment"",\n    ""java.runtime.version"": ""17.0.7+8-LTS-224"",\n    ""java.vendor"": ""Oracle Corporation"",\n    ""java.vendor.url"": ""https://java.oracle.com/"",\n    ""java.version"": ""17.0.7"",\n    ""java.vm.name"": ""Java HotSpot(TM) 64-Bit Server VM"",\n    ""java.vm.version"": ""17.0.7+8-LTS-224"",\n    ""os.name"": ""Windows Server 2019"",\n    ""os.version"": ""10.0"",\n    ""user.language"": ""en"",\n    ""user.timezone"": ""Asia/Calcutta""\n  }\n}\n\n**SQL Query**\n\n\n   DECLARE @DISTRICT_ID INT ={{districtid}};\n\nDECLARE @schoolcode INT={{schoolcode}};\n\nDROP TABLE IF EXISTS #admission;\n\nSELECT a.admission_id,\n       s.student_registration_number,\n       a.school_id\nINTO   #admission\nFROM   edumiss.student S\n       JOIN admission78 A\n         ON S.current_admission_id = A.admission_id\n            AND S.student_registration_number <> \'0\'\n            AND A.academicyearid = 78\n            AND A.school_leaving_date IS NULL\n       JOIN edumiss.school sh\n         ON sh.id = a.school_id\n            AND sh.schoolownerid IN ( 1, 2 )\nWHERE  sh.schoolcode = CASE\n                         WHEN @schoolcode = 0 THEN sh.schoolcode\n                         ELSE @schoolcode\n                       end;\n\nDROP TABLE IF EXISTS #course;\n\nSELECT sc.admission_id\nINTO   #course\nFROM   edumiss.student_course_registration SC\n       JOIN #admission t\n         ON SC.admission_id = t.admission_id;\n\nSELECT c.districtname          AS [DISTRICT NAME],\n       c.schoolcode            AS [SCHOOL CODE],\n       c.schoolname            AS [SCHOOL NAME],\n       Sum(totalstudent)       AS [TOTAL STUDENT],\n       Sum(subjectunallocated) AS [SUBJECT UNALLOCATED]\nFROM   (SELECT V.districtname,\n               V.schoolcode,\n               sh.name                                       AS schoolname,\n               Count(DISTINCT t.student_registration_number) AS TotalStudent,\n               Isnull(CASE\n                        WHEN sc.admission_id IS NULL THEN\n                        Count(DISTINCT t.student_registration_number)\n                      end, 0)                                AS\n               subjectunallocated\n        FROM   v_schooldistrictblock_v2 v\n               JOIN edumiss.school sh\n                 ON V.schoolid = SH.id\n                    AND v.district_id = CASE\n                                          WHEN @district_id = 0 THEN\n                                          v.district_id\n                                          ELSE @district_id\n                                        end\n                    AND sh.schoolcode = CASE\n                                          WHEN @schoolcode = 0 THEN\n                                          sh.schoolcode\n                                          ELSE @schoolcode\n                                        end\n               JOIN #admission t\n                 ON t.school_id = sh.id\n               LEFT JOIN #course SC\n                      ON SC.admission_id = t.admission_id\n        GROUP  BY V.districtname,\n                  V.schoolcode,\n                  sh.name,\n                  sc.admission_id) c\nGROUP  BY c.districtname,\n          c.schoolcode,\n          c.schoolname\nORDER  BY districtname,\n          schoolcode;\nDROP TABLE IF EXISTS #admission, #course; \n\n\n**Kindly check the files if required**\n\n**connection_pool_info.json**\nhttps://drive.google.com/file/d/1Qm8dOnKn0bJp35600Utf12qPr8rz6jrK/view?usp=sharing\n\n**Logs**\nhttps://drive.google.com/file/d/1uWvego_kzvL9f8lWPGackdevPkl_hiFV/view?usp=sharing', 'created_at': datetime.datetime(2024, 12, 19, 4, 38, 48, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-18 13:15:45 UTC): @rajeev1722 please send all the troubleshooting info and also the query. Is there a timestamp filter?

rajeev1722 (Issue Creator) on (2024-12-19 04:38:48 UTC): @paoliniluis Thanks for your quick reply

**Diagnostic Info**
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""sqlserver""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-09"",
      ""tag"": ""v0.52.2"",
      ""hash"": ""32effb1""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""Cp1252"",
    ""java.runtime.name"": ""Java(TM) SE Runtime Environment"",
    ""java.runtime.version"": ""17.0.7+8-LTS-224"",
    ""java.vendor"": ""Oracle Corporation"",
    ""java.vendor.url"": ""https://java.oracle.com/"",
    ""java.version"": ""17.0.7"",
    ""java.vm.name"": ""Java HotSpot(TM) 64-Bit Server VM"",
    ""java.vm.version"": ""17.0.7+8-LTS-224"",
    ""os.name"": ""Windows Server 2019"",
    ""os.version"": ""10.0"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Calcutta""
  }
}

**SQL Query**


   DECLARE @DISTRICT_ID INT ={{districtid}};

DECLARE @schoolcode INT={{schoolcode}};

DROP TABLE IF EXISTS #admission;

SELECT a.admission_id,
       s.student_registration_number,
       a.school_id
INTO   #admission
FROM   edumiss.student S
       JOIN admission78 A
         ON S.current_admission_id = A.admission_id
            AND S.student_registration_number <> '0'
            AND A.academicyearid = 78
            AND A.school_leaving_date IS NULL
       JOIN edumiss.school sh
         ON sh.id = a.school_id
            AND sh.schoolownerid IN ( 1, 2 )
WHERE  sh.schoolcode = CASE
                         WHEN @schoolcode = 0 THEN sh.schoolcode
                         ELSE @schoolcode
                       end;

DROP TABLE IF EXISTS #course;

SELECT sc.admission_id
INTO   #course
FROM   edumiss.student_course_registration SC
       JOIN #admission t
         ON SC.admission_id = t.admission_id;

SELECT c.districtname          AS [DISTRICT NAME],
       c.schoolcode            AS [SCHOOL CODE],
       c.schoolname            AS [SCHOOL NAME],
       Sum(totalstudent)       AS [TOTAL STUDENT],
       Sum(subjectunallocated) AS [SUBJECT UNALLOCATED]
FROM   (SELECT V.districtname,
               V.schoolcode,
               sh.name                                       AS schoolname,
               Count(DISTINCT t.student_registration_number) AS TotalStudent,
               Isnull(CASE
                        WHEN sc.admission_id IS NULL THEN
                        Count(DISTINCT t.student_registration_number)
                      end, 0)                                AS
               subjectunallocated
        FROM   v_schooldistrictblock_v2 v
               JOIN edumiss.school sh
                 ON V.schoolid = SH.id
                    AND v.district_id = CASE
                                          WHEN @district_id = 0 THEN
                                          v.district_id
                                          ELSE @district_id
                                        end
                    AND sh.schoolcode = CASE
                                          WHEN @schoolcode = 0 THEN
                                          sh.schoolcode
                                          ELSE @schoolcode
                                        end
               JOIN #admission t
                 ON t.school_id = sh.id
               LEFT JOIN #course SC
                      ON SC.admission_id = t.admission_id
        GROUP  BY V.districtname,
                  V.schoolcode,
                  sh.name,
                  sc.admission_id) c
GROUP  BY c.districtname,
          c.schoolcode,
          c.schoolname
ORDER  BY districtname,
          schoolcode;
DROP TABLE IF EXISTS #admission, #course; 


**Kindly check the files if required**

**connection_pool_info.json**
https://drive.google.com/file/d/1Qm8dOnKn0bJp35600Utf12qPr8rz6jrK/view?usp=sharing

**Logs**
https://drive.google.com/file/d/1uWvego_kzvL9f8lWPGackdevPkl_hiFV/view?usp=sharing

"
2747405053,issue,open,,Support React 19 in Embedded SDK,"**Is your feature request related to a problem? Please describe.**
The SDK doesn't work with React 19 and Next.js 15, which depends on React 19.

**Describe the solution you'd like**
Support these versions.

**Describe alternatives you've considered**
Customers can stay w/ React 18 and Next.js 14 but this may or not work for them in practical terms.",albertoperdomo,2024-12-18 10:21:26+00:00,[],2025-02-04 20:30:47+00:00,,https://github.com/metabase/metabase/issues/51442,"[('Type:New Feature', ''), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2747360563,issue,open,,Use of database functions (routines) in questions,"**Is your feature request related to a problem? Please describe.**
Sometimes I have imported (or created) certain functions in my database that are useful when representing data. For instance, the datetime records are in Gregorian calendar and I want to convert them to Jalali when displaying the data. There are existing functions for that purpose that we can use them in our database. 
In Metabase, when creating raw questions, we cannot use any existing functions. The only available functions are COUNT, SUM, etc.

**Describe the solution you'd like**
It would be great if Metabase could read the functions (routines) from the database schemas as well as the tables. So we could use them along with other functions.

**Describe alternatives you've considered**
There are 3 sections in creating a raw question. We select the `Data` (table columns, joining and custom columns with expressions), `Filter` and `Summarize` it.
The use of database functions can either take place in a 4th section (such as `Display` or `Representation`) or in the existing `Data` section by means of custom _expressions_. In the latter scenario, the database functions should be valid to the _expressions_.

**How important is this feature to you?**
It is true that this feature is doable by means of SQL queries; but when the question is too complex, it's not the best practice to write a long query just because we need certain functions. Therefore, it's quite important to be able to use database functions in raw questions as well.

**Additional context**
_Using database functions in SQL queries:_

![Image](https://github.com/user-attachments/assets/0426e745-d99c-4bab-a8cc-673db7845ee5)

_Using database functions in raw questions:_

![Image](https://github.com/user-attachments/assets/93121294-76ba-4bdf-b62e-d8190942c3fe)
",okaeiz,2024-12-18 10:02:56+00:00,[],2025-02-04 20:31:04+00:00,,https://github.com/metabase/metabase/issues/51441,"[('Type:New Feature', ''), ('Querying/Notebook/Custom Column', '')]","[{'comment_id': 2558420630, 'issue_id': 2747360563, 'author': 'okaeiz', 'body': ""I'd be glad if I could know your opinions about this feature."", 'created_at': datetime.datetime(2024, 12, 22, 11, 19, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2558629451, 'issue_id': 2747360563, 'author': 'paoliniluis', 'body': ""@okaeiz the feature request is nice, but there's a lot that we need to do to implement this: e.g. when you call a native database function, which data type does it return? we need that for the metadata"", 'created_at': datetime.datetime(2024, 12, 22, 22, 36, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2603684140, 'issue_id': 2747360563, 'author': 'bpartridge', 'body': 'On the point of typing, https://help.tableau.com/current/pro/desktop/en-us/functions_functions_passthrough.htm is good prior art here - defining various functions like `CallNativeStringFunction(""funcname"", [arg])` might be a more user-friendly wording of RAWSQL_STR, say.\n\nIMO this is incredibly useful - for instance, one could implement #18974 in an error-tolerant way with a custom exception-catching casting function that tries to cast to numeric and returns NULL if unsuccessful.\n\nAnd, of course, there\'s something to be said for making a selling point of Metabase that it has the same fundamental ""escape hatch"" that Tableau has! ;)\n\nIn the meantime, as a workaround here (tested on Postgres), I\'ve had some success saving a SQL query with `select id, custom_function(column) as custom_function_on_column from original_table` and joining against that Saved Question. This leans a lot on the query planner being able to optimize the join across the subquery, which is far from guaranteed, and seems a bit hit-or-miss performance-wise in my testing. But it might work for certain use cases!', 'created_at': datetime.datetime(2025, 1, 21, 5, 23, 10, tzinfo=datetime.timezone.utc)}]","okaeiz (Issue Creator) on (2024-12-22 11:19:03 UTC): I'd be glad if I could know your opinions about this feature.

paoliniluis on (2024-12-22 22:36:23 UTC): @okaeiz the feature request is nice, but there's a lot that we need to do to implement this: e.g. when you call a native database function, which data type does it return? we need that for the metadata

bpartridge on (2025-01-21 05:23:10 UTC): On the point of typing, https://help.tableau.com/current/pro/desktop/en-us/functions_functions_passthrough.htm is good prior art here - defining various functions like `CallNativeStringFunction(""funcname"", [arg])` might be a more user-friendly wording of RAWSQL_STR, say.

IMO this is incredibly useful - for instance, one could implement #18974 in an error-tolerant way with a custom exception-catching casting function that tries to cast to numeric and returns NULL if unsuccessful.

And, of course, there's something to be said for making a selling point of Metabase that it has the same fundamental ""escape hatch"" that Tableau has! ;)

In the meantime, as a workaround here (tested on Postgres), I've had some success saving a SQL query with `select id, custom_function(column) as custom_function_on_column from original_table` and joining against that Saved Question. This leans a lot on the query planner being able to optimize the join across the subquery, which is far from guaranteed, and seems a bit hit-or-miss performance-wise in my testing. But it might work for certain use cases!

"
2746295747,issue,closed,duplicate,`Cannot read properties of undefined (reading 'ReactCurrentDispatcher')` error in React SDK with React 19,"### Describe the bug

When using the latest React SDK in an app with `next@15.0.4` and `react@19.0.0` and `react-dom@19.0.0`, the following error is rendered in the DOM by the `<MetabaseProvider />` component:

```
Cannot read properties of undefined (reading 'ReactCurrentDispatcher')
TypeError: Cannot read properties of undefined (reading 'ReactCurrentDispatcher') 
  at 20244 (http://localhost:3000/_next/static/chunks/08b5e_%40metabase_embedding-sdk-react_dist_main_bundle_da8477.js:180879:85) 
  at __webpack_require__ (http://localhost:3000/_next/static/chunks/08b5e_%40metabase_embedding-sdk-react_dist_main_bundle_da8477.js:293027:39) 
  at 75897 (http://localhost:3000/_next/static/chunks/08b5e_%40metabase_embedding-sdk-react_dist_main_bundle_da8477.js:182770:17) 
  at __webpack_require__ (http://localhost:3000/_next/static/chunks/08b5e_%40metabase_embedding-sdk-react_dist_main_bundle_da8477.js:293027:39) 
  at http://localhost:3000/_next/static/chunks/08b5e_%40metabase_embedding-sdk-react_dist_main_bundle_da8477.js:401079:19 
  at http://localhost:3000/_next/static/chunks/08b5e_%40metabase_embedding-sdk-react_dist_main_bundle_da8477.js:433378:6 
  at [project]/node_modules/@metabase/embedding-sdk-react/dist/main.bundle.js [client] (ecmascript) (http://localhost:3000/_next/static/chunks/08b5e_%40metabase_embedding-sdk-react_dist_main_bundle_da8477.js:433379:2) 
  at http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:693:27 
  at runModuleExecutionHooks (http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:738:9) 
  at instantiateModule (http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:691:9) 
  at getOrInstantiateModuleFromParent (http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:624:12) 
  at esmImport (http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:142:20) 
  at [project]/apps/web/components/metabase/admin-metrics.tsx [client] (ecmascript) (http://localhost:3000/_next/static/chunks/components_metabase_admin-metrics_tsx_2cfdc7._.js:12:181) 
  at http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:693:27 
  at runModuleExecutionHooks (http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:738:9) at instantiateModule (http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:691:9) 
  at getOrInstantiateModuleFromParent (http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:624:12) 
  at esmImport (http://localhost:3000/_next/static/chunks/pages__app_77de1d._.js:142:20) 
  at http://localhost:3000/_next/static/chunks/%5Bproject%5D__4ef268._.js:16:16
```

### To Reproduce

1. Clone https://github.com/metabase/metabase-nextjs-sdk-embedding-sample/tree/main
2. Run `cd next-sample-pages-router`
3. Run `npm install`
4. Run `npm upgrade react@^19.0.0 react-dom@^19.0.0 @types/react@^19.0.0 @types/react-dom@^19.0.0 next@^15.0.0`
5. Follow the remaining steps in the readme to set up the connection to locally running Metabase instance with JWT SSO (as per the docs)

### Expected behavior

It should render the pages with embedded dashboards correctly

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""duckdb"",
      ""postgres"",
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-self-hosted"",
    ""version"": {
      ""date"": ""2024-12-09"",
      ""tag"": ""v1.52.2"",
      ""hash"": ""32effb1""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""heroku"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.5 (Ubuntu 15.5-1.pgdg22.04+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""19+36-2238"",
    ""java.vendor"": ""Oracle Corporation"",
    ""java.vendor.url"": ""https://java.oracle.com/"",
    ""java.version"": ""19"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""19+36-2238"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.0-25-cloud-amd64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```

### Severity

High - blocking usage of SDK

### Additional context

_No response_",umar-ahmed,2024-12-17 23:05:44+00:00,[],2024-12-18 10:35:03+00:00,2024-12-18 10:34:57+00:00,https://github.com/metabase/metabase/issues/51435,"[('Type:Bug', 'Product defects'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2550963985, 'issue_id': 2746295747, 'author': 'albertoperdomo', 'body': ""Hello @umar-ahmed ,\n\ncurrently the SDK is only tested to work with Next.js 14 and React 18. Supporting React 19 is something we are tracking but haven't prioritized yet.\n\nSince this is a known issue bug in favor of a feature request you can upvote and keep track of: https://github.com/metabase/metabase/issues/51442\n\nIn the meantime, my recommendation would be to use Next.js 14 and React 18 if that works for you, as this is known to work and is actively being tested."", 'created_at': datetime.datetime(2024, 12, 18, 10, 34, 57, tzinfo=datetime.timezone.utc)}]","albertoperdomo on (2024-12-18 10:34:57 UTC): Hello @umar-ahmed ,

currently the SDK is only tested to work with Next.js 14 and React 18. Supporting React 19 is something we are tracking but haven't prioritized yet.

Since this is a known issue bug in favor of a feature request you can upvote and keep track of: https://github.com/metabase/metabase/issues/51442

In the meantime, my recommendation would be to use Next.js 14 and React 18 if that works for you, as this is known to work and is actively being tested.

"
2746195959,issue,closed,completed,Pruning query execution log can time out,"### Describe the bug

Query execution table can get very large. We have a twice-daily job to remove old values. But this job can last longer than ten minutes and the job continues to run detached from Metabase. Also, the application can be very sluggish during this. The job runs in a transaction so it must be able to restore the deleted rows, but we never need to roll this back.



### To Reproduce

na

### Expected behavior

Possible fixes:

delete in batches:

```clojure
(let [batch-size 40000
      time-limit (t/minus (t/local-date-time) (t/months 6))]
  (t2/query {:with [[:ids-to-delete
                     {:select [:id]
                      :from [:query_execution]
                      :where [:< :started_at time-limit]
                      :limit batch-size}]]
             :delete-from [:query_execution :qe]
             :using [[:ids-to-delete :ids]]
             :where [:= :qe.id :ids.id]}))
[0]
```

Notes about the above: if it all runs in the same transaction then it's not super helpful since we would have the same sluggishness. We can also set a timer and loop over this query until this until we run out of rows or run out of time.

Perhaps more proper: partition the table. Need to understand the full mechanics of this in the app but undoubtedly we want to end up here.

### Logs

_No response_

### Information about your Metabase installation

```JSON
current
```

### Severity

general sluggishness especially at large size

### Additional context

_No response_",dpsutton,2024-12-17 22:09:59+00:00,['noahmoss'],2024-12-20 22:38:28+00:00,2024-12-20 21:57:32+00:00,https://github.com/metabase/metabase/issues/51432,"[('Type:Bug', 'Product defects'), ('.Backend', ''), ('Organization/Activity Log', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2549750236, 'issue_id': 2746195959, 'author': 'dpsutton', 'body': 'We also need to cleanup in there: https://github.com/metabase/metabase/blob/master/src/metabase/task/truncate_audit_tables.clj#L47', 'created_at': datetime.datetime(2024, 12, 17, 22, 12, 5, tzinfo=datetime.timezone.utc)}]","dpsutton (Issue Creator) on (2024-12-17 22:12:05 UTC): We also need to cleanup in there: https://github.com/metabase/metabase/blob/master/src/metabase/task/truncate_audit_tables.clj#L47

"
2745778775,issue,open,,[Epic] Dismissible collection clean up banner,"### Links

- [product doc](LINK_TO_PRODUCT_DOC)
- [technical design doc](LINK_TO_TECHNICAL_DESIGN_DOC)
- [testing plan](LINK_TO_TESTING_PLAN)
- feature branch: `BRANCH_NAME`
- issue links: _related issues, if any_

### Implementation Plan

```[tasklist]
#### Milestone 1 - Basic solution (Backport to 52)
- [x] BE - Create a global user settings for dismissing the collection clean up banner
- [x] FE - Dismiss all modals once if the user acknowledges/dismisses a single banner
- [x] Add testing
```

```[tasklist]
#### [IN DEFINITION] Milestone 2 - Better solution (Ship 53+) 
- [ ] BE + FE - Remove global user setting
- [ ] BE - Ship the KV store w/ basic schema (strings, numbers, booleans for v1 - we can think about more complex data later)
- [ ] ...TBD
```
",sloansparger,2024-12-17 18:57:02+00:00,['sloansparger'],2024-12-18 22:41:17+00:00,,https://github.com/metabase/metabase/issues/51419,"[('.Epic', 'Feature Implementation or Project'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2745474840,issue,open,,Oracle users are not able to use remapping,"### Describe the bug

We sync all integers in oracle as decimals (as it seems that we read ""numeric"" on the definition and we think it's a decimal data type. If the field is not an integer we don't allow remapping, so in the end you can't use remapping

### To Reproduce

1) start an oracle db, add an integer field and fill it with ones and zeroes
2) sync it, see that it's a decimal
3) try to use remapping, you can't

### Expected behavior

We should see if the numeric is a float or integer, if it's an integer allow remapping

### Logs

NA

### Information about your Metabase installation

```JSON
it has always been like this
```

### Severity

P3

### Additional context

_No response_",paoliniluis,2024-12-17 16:50:42+00:00,[],2025-02-04 20:25:14+00:00,,https://github.com/metabase/metabase/issues/51411,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Administration/Metadata & Sync', ''), ('Database/Oracle', None), ('.Backend', ''), ('.Team/Drivers', '')]",[],
2745144382,issue,closed,completed,Update eslint config to prevent usages of useSelector or connect from react-redux,"Part of https://github.com/metabase/metabase/issues/51397

All the changes in the second commit of https://github.com/metabase/metabase/pull/51382 were import changes. We have already in place some eslint rules that should prevent us from importing the hooks from react-redux directly, but they don't work in all the files.

We should also change the restricted imports to include `connect`

We need to change both the eslint in the enterprise folder, and in the sdk folder",npretto,2024-12-17 14:53:29+00:00,[],2025-01-14 16:13:19+00:00,2025-01-14 16:06:15+00:00,https://github.com/metabase/metabase/issues/51401,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2745143365,issue,open,,Fix the EnterpriseState type used by useEnterpriseSelector,"Was part of https://github.com/metabase/metabase/issues/51397

https://github.com/metabase/metabase/blob/bb32a4111b9843db72e1eff41ccf11b683ab2d9f/enterprise/frontend/src/metabase-enterprise/redux.ts#L7-L8
That ideally would contain all the extra state we have in the enterprise build.

We currently don't have a ""global"" `EnterpriseState` type, but instead have local types implemented locally to some plugins with only the relevant state.
Ideally we could have the equivalent of the [`State` type](https://github.com/metabase/metabase/blob/8df25bf8cc8b37fd073c038aaec9ac442b4b4d7d/frontend/src/metabase-types/store/state.ts#L23) but for the EE folder",npretto,2024-12-17 14:53:05+00:00,[],2025-02-04 20:25:56+00:00,,https://github.com/metabase/metabase/issues/51400,"[('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2745140929,issue,closed,completed,make the core app use the redux custom context,"Right now we're using[ a custom context in the sdk, and the default one in the core app](https://github.com/metabase/metabase/blob/8df25bf8cc8b37fd073c038aaec9ac442b4b4d7d/frontend/src/metabase/lib/redux/custom-context.tsx#L9-L11).
This technically allows core app code to work with the default hooks, but as soon as the component is used in the sdk it will fail, which can be frustrating and hard to debug if the dev doesn't know (and remember) about this detail.

We should migrate the core app to use the custom context too, but we can't do it easily as `redux-auth-wrapper` doesn't support the custom context.

A quick solution could be a patch-package that adds the custom context parameter to the parts of the library that we use.
The [library](https://www.npmjs.com/package/redux-auth-wrapper) hasn't been updated in 4 years so we don't have the problem of keeping the patch up to date.
An alternative approach would be to implement our own route guards without the library.


Part of https://github.com/metabase/metabase/issues/51397",npretto,2024-12-17 14:52:19+00:00,['sloansparger'],2025-01-27 22:11:53+00:00,2025-01-14 15:36:46+00:00,https://github.com/metabase/metabase/issues/51399,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2745137940,issue,closed,completed,Create and use custom redux context on the sdk,Part of https://github.com/metabase/metabase/issues/51397,npretto,2024-12-17 14:51:16+00:00,[],2024-12-18 12:03:12+00:00,2024-12-17 17:37:55+00:00,https://github.com/metabase/metabase/issues/51398,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]","[{'comment_id': 2551146470, 'issue_id': 2745137940, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)', 'created_at': datetime.datetime(2024, 12, 18, 12, 3, 10, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-18 12:03:10 UTC):  This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)

"
2745123165,issue,closed,completed,[Project] migrate redux to use a custom context,"As previously discussed [here](https://metaboat.slack.com/archives/C505ZNNH4/p1734374863986279) we need to migrate to a custom context for redux to solve https://github.com/metabase/metabase/issues/51226

The general idea is to migrate to a [custom context](https://react-redux.js.org/api/hooks#custom-context) so that the `Provider`s won't clash.

This will need creating our own versions of the hooks/connect functions that uses the context.

Rtk also needs to be configured.

At the start we won't be able to use the custom context in the main app as we use a library (react-auth-wrapper) that doesn't support it

",npretto,2024-12-17 14:45:00+00:00,['npretto'],2025-01-14 18:01:18+00:00,2025-01-14 18:01:18+00:00,https://github.com/metabase/metabase/issues/51397,"[('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2745057974,issue,open,,Object details not loading,"### Describe the bug

See [Slack thread](https://metaboat.slack.com/archives/C05MPF0TM3L/p1734441860146119)

### To Reproduce

1. Go to https://stats.metabase.com/question/17639
2. Try to open any object details

Modal shows loading state forever


### Information about your Metabase installation

master, a238b9310f3b1332a73e576ce62b3b38692a82b4

### Severity

P2
",kamilmielnik,2024-12-17 14:14:22+00:00,[],2025-02-04 20:31:57+00:00,,https://github.com/metabase/metabase/issues/51393,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations'), ('Visualization/Detail', 'ObjectDetail'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2551118126, 'issue_id': 2745057974, 'author': 'kamilmielnik', 'body': ""Demoting to P2 since it's expected that object details view does not work with multiple PKs.\nStill, we should handle this better."", 'created_at': datetime.datetime(2024, 12, 18, 11, 48, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2551170643, 'issue_id': 2745057974, 'author': 'kamilmielnik', 'body': 'See [this thread](https://metaboat.slack.com/archives/C07BWMG9C8M/p1734523690648209?thread_ts=1734444877.795079&cid=C07BWMG9C8M) for expected result', 'created_at': datetime.datetime(2024, 12, 18, 12, 15, 41, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-12-18 11:48:29 UTC): Demoting to P2 since it's expected that object details view does not work with multiple PKs.
Still, we should handle this better.

kamilmielnik (Issue Creator) on (2024-12-18 12:15:41 UTC): See [this thread](https://metaboat.slack.com/archives/C07BWMG9C8M/p1734523690648209?thread_ts=1734444877.795079&cid=C07BWMG9C8M) for expected result

"
2744903643,issue,closed,completed,Postgres custom data type not handled anymore,"**Describe the bug**

Since the 1.51.2 update, some questions that would usually be working started to crash. It seems like the custom types I'm using for some columns in my PostgreSQL database are not rightfully parsed anymore. As a result I can't update my metabase instance, stuck in 1.51.1. 

**Example**

I have a custom type `SellerType`, which is a Postgres Enum, stored in the `product` schema. The column `type` of my table `seller` is using this type. I want to filter on this column to fetch only the rows with the value `BROKER`, using a nocode metabase question.

<img width=""283"" alt=""Image"" src=""https://github.com/user-attachments/assets/e94a2d6e-e391-472d-b2e1-05ba73cb812a"" />


- in 1.51.1, the SQL displayed on the side shows that the the data type is prefixed by its schema :
`WHERE ""seller"".""type"" = CAST('BROKER' AS ""product"".""SellerType"")
`
- in 1.51.2 and later, the schema prefix disappeared, resulting in the following error message
`WHERE ""seller"".""type"" = CAST('BROKER' AS ""SellerType"")
`


<img width=""885"" alt=""Image"" src=""https://github.com/user-attachments/assets/01c6809e-9a6a-412d-867e-ba68a9063015"" />


**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""fr-FR"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-self-hosted-yearly"",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v1.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Paris""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.4""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.228-219.884.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Europe/Paris""
  }
}
```",arthurgtllr,2024-12-17 13:08:56+00:00,[],2024-12-17 13:17:34+00:00,2024-12-17 13:17:34+00:00,https://github.com/metabase/metabase/issues/51388,[],"[{'comment_id': 2548437855, 'issue_id': 2744903643, 'author': 'luizarakaki', 'body': 'Please check the latest version, this was fixed on [https://github.com/metabase/metabase/pull/50900](https://github.com/metabase/metabase/pull/50900)', 'created_at': datetime.datetime(2024, 12, 17, 13, 17, 14, tzinfo=datetime.timezone.utc)}]","luizarakaki on (2024-12-17 13:17:14 UTC): Please check the latest version, this was fixed on [https://github.com/metabase/metabase/pull/50900](https://github.com/metabase/metabase/pull/50900)

"
2744739192,issue,closed,completed,Downloading results of an embedded question (via iframe) fails,"### Describe the bug

When pressing the ""Download full results"" widget and clicking the Download button, it immediately gives a download error, see screenshot. This only happens in the iframe-embedded question. The network request shows a 500 internal server error with message `""No matching clause: [\""embedding-iframe\"" nil]""`. If I access the download URL directly (by copying it from Chrome dev tools), the download works without problems.

![Image](https://github.com/user-attachments/assets/7ebba376-e676-48d9-bbf1-a46ca6e33f89)
![Image](https://github.com/user-attachments/assets/a21a6945-e365-4b00-af49-e788b0c47cf7)

### To Reproduce

1. Go to the download link of an embedded question
2. Click on the Download button
3. Observe the error


### Expected behavior

_No response_

### Logs


<details>
<summary> Logs: </summary>

```
{
  ""via"": [
    {
      ""type"": ""java.lang.IllegalArgumentException"",
      ""message"": ""No matching clause: [\""embedding-iframe\"" nil]"",
      ""at"": [
        ""metabase.analytics.sdk$track_sdk_response"",
        ""invokeStatic"",
        ""sdk.clj"",
        40
      ]
    }
  ],
  ""trace"": [
    [
      ""metabase.analytics.sdk$track_sdk_response"",
      ""invokeStatic"",
      ""sdk.clj"",
      40
    ],
    [
      ""metabase.analytics.sdk$track_sdk_response"",
      ""invoke"",
      ""sdk.clj"",
      37
    ],
    [
      ""metabase.analytics.sdk$embedding_mw$embedding_mw_fn__78293$responder__78294"",
      ""invoke"",
      ""sdk.clj"",
      64
    ],
    [
      ""metabase.server.middleware.session$reset_session_timeout$fn__72177$fn__72178"",
      ""invoke"",
      ""session.clj"",
      568
    ],
    [
      ""metabase.server.middleware.json$wrap_streamed_json_response$fn__55864$respond_STAR___55865"",
      ""invoke"",
      ""json.clj"",
      91
    ],
    [
      ""clojure.core$comp$fn__5895"",
      ""invoke"",
      ""core.clj"",
      2586
    ],
    [
      ""metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__106746$fn__106747"",
      ""invoke"",
      ""exceptions.clj"",
      116
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__54210$fn__54211"",
      ""invoke"",
      ""core.clj"",
      151
    ],
    [
      ""compojure.response$send"",
      ""invokeStatic"",
      ""response.clj"",
      28
    ],
    [
      ""compojure.response$send"",
      ""invoke"",
      ""response.clj"",
      22
    ],
    [
      ""compojure.response$fn__53439$fn__53440"",
      ""invoke"",
      ""response.clj"",
      70
    ],
    [
      ""metabase.server.routes$redirect_including_query_string$fn__109990"",
      ""invoke"",
      ""routes.clj"",
      28
    ],
    [
      ""compojure.response$fn__53439"",
      ""invokeStatic"",
      ""response.clj"",
      70
    ],
    [
      ""compojure.response$fn__53439"",
      ""invoke"",
      ""response.clj"",
      67
    ],
    [
      ""compojure.response$fn__53397$G__53392__53408"",
      ""invoke"",
      ""response.clj"",
      17
    ],
    [
      ""compojure.response$send"",
      ""invokeStatic"",
      ""response.clj"",
      27
    ],
    [
      ""compojure.response$send"",
      ""invoke"",
      ""response.clj"",
      22
    ],
    [
      ""compojure.core$wrap_response$fn__54217"",
      ""invoke"",
      ""core.clj"",
      160
    ],
    [
      ""compojure.core$wrap_route_middleware$fn__54201"",
      ""invoke"",
      ""core.clj"",
      132
    ],
    [
      ""compojure.core$wrap_route_info$fn__54206"",
      ""invoke"",
      ""core.clj"",
      139
    ],
    [
      ""compojure.core$wrap_route_matches$fn__54210"",
      ""invoke"",
      ""core.clj"",
      151
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""compojure.core$make_context$handler__54257"",
      ""invoke"",
      ""core.clj"",
      290
    ],
    [
      ""compojure.core$make_context$fn__54261"",
      ""invoke"",
      ""core.clj"",
      300
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__54261"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__54261"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$make_context$fn__54261"",
      ""invoke"",
      ""core.clj"",
      301
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__54210"",
      ""invoke"",
      ""core.clj"",
      153
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__54210"",
      ""invoke"",
      ""core.clj"",
      152
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__54210"",
      ""invoke"",
      ""core.clj"",
      152
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""compojure.core$wrap_route_matches$fn__54210"",
      ""invoke"",
      ""core.clj"",
      152
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230$respond_SINGLEQUOTE___54231"",
      ""invoke"",
      ""core.clj"",
      197
    ],
    [
      ""metabase.server.routes$fn__110002$fn__110004"",
      ""invoke"",
      ""routes.clj"",
      47
    ],
    [
      ""compojure.core$routes$fn__54229$f__54230"",
      ""invoke"",
      ""core.clj"",
      198
    ],
    [
      ""compojure.core$routes$fn__54229"",
      ""invoke"",
      ""core.clj"",
      200
    ],
    [
      ""metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__106746"",
      ""invoke"",
      ""exceptions.clj"",
      111
    ],
    [
      ""metabase.server.middleware.exceptions$catch_api_exceptions$fn__106743"",
      ""invoke"",
      ""exceptions.clj"",
      100
    ],
    [
      ""metabase.server.middleware.log$log_api_call$fn__110385"",
      ""invoke"",
      ""log.clj"",
      221
    ],
    [
      ""metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__114100"",
      ""invoke"",
      ""browser_cookie.clj"",
      40
    ],
    [
      ""metabase.server.middleware.security$add_security_headers$fn__106702"",
      ""invoke"",
      ""security.clj"",
      273
    ],
    [
      ""ring.middleware.json$wrap_json_body$fn__114359"",
      ""invoke"",
      ""json.clj"",
      64
    ],
    [
      ""metabase.server.middleware.offset_paging$handle_paging$fn__96235"",
      ""invoke"",
      ""offset_paging.clj"",
      56
    ],
    [
      ""metabase.server.middleware.json$wrap_streamed_json_response$fn__55864"",
      ""invoke"",
      ""json.clj"",
      88
    ],
    [
      ""ring.middleware.keyword_params$wrap_keyword_params$fn__114448"",
      ""invoke"",
      ""keyword_params.clj"",
      55
    ],
    [
      ""ring.middleware.params$wrap_params$fn__114467"",
      ""invoke"",
      ""params.clj"",
      77
    ],
    [
      ""metabase.server.middleware.misc$maybe_set_site_url$fn__70111"",
      ""invoke"",
      ""misc.clj"",
      59
    ],
    [
      ""metabase.server.middleware.session$reset_session_timeout$fn__72177"",
      ""invoke"",
      ""session.clj"",
      566
    ],
    [
      ""metabase.server.middleware.session$bind_current_user$fn__72143$fn__72144"",
      ""invoke"",
      ""session.clj"",
      459
    ],
    [
      ""metabase.server.middleware.session$do_with_current_user"",
      ""invokeStatic"",
      ""session.clj"",
      438
    ],
    [
      ""metabase.server.middleware.session$do_with_current_user"",
      ""invoke"",
      ""session.clj"",
      421
    ],
    [
      ""metabase.server.middleware.session$bind_current_user$fn__72143"",
      ""invoke"",
      ""session.clj"",
      458
    ],
    [
      ""metabase.server.middleware.session$wrap_current_user_info$fn__72120"",
      ""invoke"",
      ""session.clj"",
      383
    ],
    [
      ""metabase.analytics.sdk$embedding_mw$embedding_mw_fn__78293"",
      ""invoke"",
      ""sdk.clj"",
      61
    ],
    [
      ""metabase.server.middleware.session$wrap_session_id$fn__72092"",
      ""invoke"",
      ""session.clj"",
      261
    ],
    [
      ""metabase.server.middleware.auth$wrap_static_api_key$fn__104629"",
      ""invoke"",
      ""auth.clj"",
      33
    ],
    [
      ""ring.middleware.cookies$wrap_cookies$fn__114287"",
      ""invoke"",
      ""cookies.clj"",
      200
    ],
    [
      ""metabase.server.middleware.misc$add_content_type$fn__70093"",
      ""invoke"",
      ""misc.clj"",
      28
    ],
    [
      ""metabase.server.middleware.misc$disable_streaming_buffering$fn__70119"",
      ""invoke"",
      ""misc.clj"",
      75
    ],
    [
      ""ring.middleware.gzip$wrap_gzip$fn__114329"",
      ""invoke"",
      ""gzip.clj"",
      86
    ],
    [
      ""metabase.server.middleware.request_id$wrap_request_id$fn__110081"",
      ""invoke"",
      ""request_id.clj"",
      9
    ],
    [
      ""metabase.server.middleware.misc$bind_request$fn__70122"",
      ""invoke"",
      ""misc.clj"",
      91
    ],
    [
      ""metabase.server.middleware.ssl$redirect_to_https_middleware$fn__114116"",
      ""invoke"",
      ""ssl.clj"",
      51
    ],
    [
      ""metabase.server$async_proxy_handler$fn__56833"",
      ""invoke"",
      ""server.clj"",
      77
    ],
    [
      ""metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a"",
      ""handle"",
      null,
      -1
    ],
    [
      ""org.eclipse.jetty.server.handler.StatisticsHandler"",
      ""handle"",
      ""StatisticsHandler.java"",
      173
    ],
    [
      ""org.eclipse.jetty.server.handler.HandlerWrapper"",
      ""handle"",
      ""HandlerWrapper.java"",
      122
    ],
    [
      ""org.eclipse.jetty.server.Server"",
      ""handle"",
      ""Server.java"",
      563
    ],
    [
      ""org.eclipse.jetty.server.HttpChannel$RequestDispatchable"",
      ""dispatch"",
      ""HttpChannel.java"",
      1598
    ],
    [
      ""org.eclipse.jetty.server.HttpChannel"",
      ""dispatch"",
      ""HttpChannel.java"",
      753
    ],
    [
      ""org.eclipse.jetty.server.HttpChannel"",
      ""handle"",
      ""HttpChannel.java"",
      501
    ],
    [
      ""org.eclipse.jetty.server.HttpConnection"",
      ""onFillable"",
      ""HttpConnection.java"",
      287
    ],
    [
      ""org.eclipse.jetty.io.AbstractConnection$ReadCallback"",
      ""succeeded"",
      ""AbstractConnection.java"",
      314
    ],
    [
      ""org.eclipse.jetty.io.FillInterest"",
      ""fillable"",
      ""FillInterest.java"",
      100
    ],
    [
      ""org.eclipse.jetty.io.SelectableChannelEndPoint$1"",
      ""run"",
      ""SelectableChannelEndPoint.java"",
      53
    ],
    [
      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
      ""runTask"",
      ""AdaptiveExecutionStrategy.java"",
      421
    ],
    [
      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
      ""consumeTask"",
      ""AdaptiveExecutionStrategy.java"",
      390
    ],
    [
      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
      ""tryProduce"",
      ""AdaptiveExecutionStrategy.java"",
      277
    ],
    [
      ""org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy"",
      ""run"",
      ""AdaptiveExecutionStrategy.java"",
      199
    ],
    [
      ""org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread"",
      ""run"",
      ""ReservedThreadExecutor.java"",
      411
    ],
    [
      ""org.eclipse.jetty.util.thread.QueuedThreadPool"",
      ""runJob"",
      ""QueuedThreadPool.java"",
      969
    ],
    [
      ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",
      ""doRunJob"",
      ""QueuedThreadPool.java"",
      1194
    ],
    [
      ""org.eclipse.jetty.util.thread.QueuedThreadPool$Runner"",
      ""run"",
      ""QueuedThreadPool.java"",
      1149
    ],
    [
      ""java.lang.Thread"",
      ""run"",
      null,
      -1
    ]
  ],
  ""cause"": ""No matching clause: [\""embedding-iframe\"" nil]"",
  ""message"": ""No matching clause: [\""embedding-iframe\"" nil]""
}
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-14"",
      ""tag"": ""v0.52.3"",
      ""hash"": ""6f76bb6""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.4 (Ubuntu 16.4-1.pgdg20.04+2)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.228-219.884.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

</details>

### Severity

The issue is pretty severe, as we have customers who download a daily Excel report from our dashboards and now they're blocked in doing so

### Additional context

_No response_",dbbert,2024-12-17 11:57:31+00:00,['escherize'],2024-12-19 17:11:25+00:00,2024-12-18 22:23:58+00:00,https://github.com/metabase/metabase/issues/51386,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('.Escalation', ''), ('.Team/Embedding', '')]","[{'comment_id': 2548266455, 'issue_id': 2744739192, 'author': 'albertoperdomo', 'body': 'Hello @dbbert ,\n\nis this with interactive, static embedding or embedding SDK?', 'created_at': datetime.datetime(2024, 12, 17, 11, 58, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548269021, 'issue_id': 2744739192, 'author': 'albertoperdomo', 'body': 'Ah, I am guessing static embedding based on the Metabase version v0.52.3.', 'created_at': datetime.datetime(2024, 12, 17, 12, 0, 6, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548287227, 'issue_id': 2744739192, 'author': 'dbbert', 'body': 'Static embedding indeed!', 'created_at': datetime.datetime(2024, 12, 17, 12, 9, 7, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548476299, 'issue_id': 2744739192, 'author': 'paoliniluis', 'body': ""@dbbert is this a table? any viz? I can't repro this by no means"", 'created_at': datetime.datetime(2024, 12, 17, 13, 34, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548614291, 'issue_id': 2744739192, 'author': 'dbbert', 'body': ""It's just a static embed of a table indeed, no viz. Let me know if you want to jump in a quick call to debug."", 'created_at': datetime.datetime(2024, 12, 17, 14, 29, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548650352, 'issue_id': 2744739192, 'author': 'albertoperdomo', 'body': '@dbbert Same, I cannot reproduce. I am using 0.52.3 and embedding a question. I can download CSV results without problem.', 'created_at': datetime.datetime(2024, 12, 17, 14, 47, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548654013, 'issue_id': 2744739192, 'author': 'albertoperdomo', 'body': 'Wait, I do see the error in the logs, but the files can be downloaded without issues. @dbbert @paoliniluis .\n\nCan you confirm that downloads do not work for you, @dbbert ?', 'created_at': datetime.datetime(2024, 12, 17, 14, 49, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548669231, 'issue_id': 2744739192, 'author': 'dbbert', 'body': ""Confirmed that the download does not work, I'm getting the error message shown in my screenshots. But the strange thing is if I then copy the URL from the failed network request in the Chrome dev tools and paste that in a new screen, it does actually just download the file without problems..."", 'created_at': datetime.datetime(2024, 12, 17, 14, 55, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548676913, 'issue_id': 2744739192, 'author': 'albertoperdomo', 'body': ""I have been able to reproduce it now. The issue doesn't present itself when using the URL from the embedding preview, but it does from the actual embed. The download returns an error and the stacktrace is embedded in the server response.\n\nLoom (for Metabase employees): https://www.loom.com/share/f92f9881393b4341938a481c6a394bf1"", 'created_at': datetime.datetime(2024, 12, 17, 14, 58, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2548682033, 'issue_id': 2744739192, 'author': 'dbbert', 'body': 'Great! Thanks for looking into this', 'created_at': datetime.datetime(2024, 12, 17, 15, 0, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2555178285, 'issue_id': 2744739192, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)', 'created_at': datetime.datetime(2024, 12, 19, 17, 11, 23, tzinfo=datetime.timezone.utc)}]","albertoperdomo on (2024-12-17 11:58:40 UTC): Hello @dbbert ,

is this with interactive, static embedding or embedding SDK?

albertoperdomo on (2024-12-17 12:00:06 UTC): Ah, I am guessing static embedding based on the Metabase version v0.52.3.

dbbert (Issue Creator) on (2024-12-17 12:09:07 UTC): Static embedding indeed!

paoliniluis on (2024-12-17 13:34:01 UTC): @dbbert is this a table? any viz? I can't repro this by no means

dbbert (Issue Creator) on (2024-12-17 14:29:51 UTC): It's just a static embed of a table indeed, no viz. Let me know if you want to jump in a quick call to debug.

albertoperdomo on (2024-12-17 14:47:15 UTC): @dbbert Same, I cannot reproduce. I am using 0.52.3 and embedding a question. I can download CSV results without problem.

albertoperdomo on (2024-12-17 14:49:11 UTC): Wait, I do see the error in the logs, but the files can be downloaded without issues. @dbbert @paoliniluis .

Can you confirm that downloads do not work for you, @dbbert ?

dbbert (Issue Creator) on (2024-12-17 14:55:17 UTC): Confirmed that the download does not work, I'm getting the error message shown in my screenshots. But the strange thing is if I then copy the URL from the failed network request in the Chrome dev tools and paste that in a new screen, it does actually just download the file without problems...

albertoperdomo on (2024-12-17 14:58:12 UTC): I have been able to reproduce it now. The issue doesn't present itself when using the URL from the embedding preview, but it does from the actual embed. The download returns an error and the stacktrace is embedded in the server response.

Loom (for Metabase employees): https://www.loom.com/share/f92f9881393b4341938a481c6a394bf1

dbbert (Issue Creator) on (2024-12-17 15:00:12 UTC): Great! Thanks for looking into this

github-actions[bot] on (2024-12-19 17:11:23 UTC):  This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)

"
2744637048,issue,open,,Clarify that the embedding CLI does not work with existing Metabase instances,"Clarifies that the embedding CLI won't work with existing Metabase instances.

People that already have a MB instance they want to embed with are confused when running the CLI because it spins up a new instance and creates new models instead of letting them use the Metabase content they already have.

See [this Slack message](https://metaboat.slack.com/archives/C06FCQT0KMZ/p1734085773449679) for more context.",heypoom,2024-12-17 11:09:26+00:00,[],2025-02-04 20:25:47+00:00,,https://github.com/metabase/metabase/issues/51384,"[('.Team/Embedding', ''), ('Embedding/SDK-CLI', 'Onboarding CLI for React SDK')]",[],
2744568974,issue,closed,completed,Graph lines are disappear after mouse over,"### Describe the bug

https://github.com/user-attachments/assets/ec64b3e7-2d15-4e45-9dfe-a1db00f79e87
![Image](https://github.com/user-attachments/assets/753cd474-477b-417f-8232-c9e0dd99d3cc)

I attached screen capture.

In every lines in a graph(even mixed with bar) are disappear after mouse over and poped up randomly.

I met this 0.52.2. and today with 0.52.3.

It is critical for me and maybe others.

When I check web inspect, opacity of all lines are set to 0, it maybe by chart lib.

This is show only on dashboard, not single question.

And the questions are written by SQL.

### To Reproduce

1. Create a question using SQL and set its visualization to line chart.
2. Set each line to ""no dot on point""
3. Add the question to adashboard 
4. Refresh the dashboard and  mouse over on the line 


### Expected behavior

Show all lines correctly 

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.1.1 Safari/605.1.15"",
    ""vendor"": ""Apple Computer, Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-14"",
      ""tag"": ""v0.52.3"",
      ""hash"": ""6f76bb6""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""17.2 (Ubuntu 17.2-1.pgdg24.04+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""19.0.2+7-Ubuntu-0ubuntu322.04"",
    ""java.vendor"": ""Private Build"",
    ""java.vendor.url"": ""Unknown"",
    ""java.version"": ""19.0.2"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""19.0.2+7-Ubuntu-0ubuntu322.04"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.8.0-1021-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```

### Severity

Critical, blocking your usage of Metabase entirely

### Additional context

_No response_",cartbooster-yohan,2024-12-17 10:41:09+00:00,['alxnddr'],2024-12-24 01:14:43+00:00,2024-12-23 20:32:46+00:00,https://github.com/metabase/metabase/issues/51383,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Browser:Safari', ''), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2743581628,issue,open,,Set up more tests with API helpers,,iethree,2024-12-16 23:12:57+00:00,['iethree'],2025-01-21 19:05:23+00:00,,https://github.com/metabase/metabase/issues/51372,[],[],
2743581035,issue,closed,not_planned,Look into speeding up Restore Helper,,iethree,2024-12-16 23:12:29+00:00,[],2025-01-21 15:50:19+00:00,2025-01-21 15:50:19+00:00,https://github.com/metabase/metabase/issues/51371,[],[],
2743580403,issue,open,,Look into testing on postgres,,iethree,2024-12-16 23:11:57+00:00,[],2025-01-17 20:29:45+00:00,,https://github.com/metabase/metabase/issues/51370,[],[],
2743579984,issue,closed,completed,Split up big e2e jobs,"<img src=""https://uploads.linear.app/aa0b7104-d385-47b7-bfc6-015760e1d91e/08ad7bc2-dbe3-4263-9de1-21172e7ed231/d07d5191-4fa5-4604-b4e1-08d918073206?signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXRoIjoiL2FhMGI3MTA0LWQzODUtNDdiNy1iZmM2LTAxNTc2MGUxZDkxZS8wOGFkN2JjMi1kYmUzLTQyNjMtOWRlMS0yMTE3MmU3ZWQyMzEvZDA3ZDUxOTEtNGZhNS00NjA0LWI0ZTEtMDhkOTE4MDczMjA2IiwiaWF0IjoxNzM0MzkxMjY5LCJleHAiOjMzMzA0OTUxMjY5fQ.3SQOX6Bqy_ORGLiq6zpx_Gw4ILwKO_VN5HEiWKIYeIY "" alt=""10 slowest e2e jobs-12_16_2024, 4_20_16 PM.png"" width=""3226"" data-linear-height=""2096"" />",iethree,2024-12-16 23:11:35+00:00,['iethree'],2025-01-17 20:29:46+00:00,2025-01-03 15:23:18+00:00,https://github.com/metabase/metabase/issues/51369,[],[],
2743579682,issue,open,,Reduce e2e run time,,iethree,2024-12-16 23:11:21+00:00,['iethree'],2025-02-04 20:23:43+00:00,,https://github.com/metabase/metabase/issues/51368,"[('.CI & Tests', ''), ('.Team/DevEx', '')]",[],
2743118860,issue,open,,Run Third Party Driver tests,,iethree,2024-12-16 18:40:54+00:00,[],2024-12-16 18:40:54+00:00,,https://github.com/metabase/metabase/issues/51361,[],[],
2743117823,issue,open,,Notify on ee-extra build/merge failures,,iethree,2024-12-16 18:40:16+00:00,[],2024-12-16 18:40:16+00:00,,https://github.com/metabase/metabase/issues/51360,[],[],
2743112786,issue,open,,Auto re-run only failed e2e tests in CI,,iethree,2024-12-16 18:37:47+00:00,[],2025-01-17 20:29:46+00:00,,https://github.com/metabase/metabase/issues/51359,[],[],
2743013187,issue,closed,not_planned,Add Emergency Patch Release Override,  not entirely sure we should do this. What safeguards can we add to avoid releasing a truly broken patch?,iethree,2024-12-16 17:45:33+00:00,[],2024-12-16 17:51:03+00:00,2024-12-16 17:51:03+00:00,https://github.com/metabase/metabase/issues/51354,[],[],
2742948905,issue,closed,completed,Add UTM to release pricing link,,linear[bot],2024-12-16 17:14:27+00:00,['iethree'],2024-12-16 19:06:04+00:00,2024-12-16 19:06:04+00:00,https://github.com/metabase/metabase/issues/51350,[],[],
2742892813,issue,closed,completed,"Entity Picker Search should surface Dashboard Questions, Scope search to a dashboard",,npfitz,2024-12-16 16:47:57+00:00,['npfitz'],2025-01-27 22:13:07+00:00,2024-12-17 21:36:26+00:00,https://github.com/metabase/metabase/issues/51346,"[('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2742808143,issue,closed,completed,Dot X releases,"let's enable releases like `52.3.x` so that we can link to the latests patch at all times.

[https://www.notion.so/metabase/Dot-X-releases-13769354c90180239d37cd5c9ea87a46](https://www.notion.so/metabase/Dot-X-releases-13769354c90180239d37cd5c9ea87a46)",linear[bot],2024-12-16 16:12:53+00:00,[],2025-01-09 20:25:04+00:00,2025-01-09 20:25:04+00:00,https://github.com/metabase/metabase/issues/51344,[],[],
2742669940,issue,closed,completed,Pivoted xlsx exports - pivot table fields are named as 'Sum' instead of column name,"### Describe the bug

When exporting a pivot table as xlsx (with data kept pivoted), the summarized columns in Excel are displayed as 'Sum' instead of the actual column names.
<img width=""895"" alt=""Image"" src=""https://github.com/user-attachments/assets/0a45122b-e099-490a-8e27-5d783a96bf5d"" />

In Numbers, the value field titles differ and include the source column names:
<img width=""414"" alt=""Image"" src=""https://github.com/user-attachments/assets/84685ad2-79c0-4566-a763-188db725171e"" />



### To Reproduce

1. Create a pivot table, for example:
<img width=""400"" alt=""Image"" src=""https://github.com/user-attachments/assets/989320d0-ca94-40d4-a671-810f1f3fedf0"" />
2. Export as xlsx, keep the data pivoted.
3. View the exported results in Excel.

### Expected behavior

The column titles in Excel should match the original column names from Metabase.

Numbers may display the titles differently, but I think the xlsx export should prioritize how Excel renders the formatting since it is the original tool used for this file type.

### Logs

_No response_

### Information about your Metabase installation

```JSON
Seen in v1.51.8 and v1.52.2.5
```

### Severity

Reported by a customer. Annoying as the fields need to be manually renamed.

### Additional context

_No response_",zbodi74,2024-12-16 15:18:16+00:00,[],2025-01-31 20:01:06+00:00,2025-01-31 02:54:54+00:00,https://github.com/metabase/metabase/issues/51342,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Reporting/Export/Pivot', 'Exporting data as pivoted tables')]","[{'comment_id': 2567014670, 'issue_id': 2742669940, 'author': 'givemesomefaces', 'body': 'This issue seems to be same as https://github.com/metabase/metabase/issues/49605', 'created_at': datetime.datetime(2025, 1, 1, 13, 41, 33, tzinfo=datetime.timezone.utc)}, {'comment_id': 2628060271, 'issue_id': 2742669940, 'author': 'paoliniluis', 'body': 'thank you @givemesomefaces', 'created_at': datetime.datetime(2025, 1, 31, 18, 41, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2628290561, 'issue_id': 2742669940, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)', 'created_at': datetime.datetime(2025, 1, 31, 20, 1, 5, tzinfo=datetime.timezone.utc)}]","givemesomefaces on (2025-01-01 13:41:33 UTC): This issue seems to be same as https://github.com/metabase/metabase/issues/49605

paoliniluis on (2025-01-31 18:41:34 UTC): thank you @givemesomefaces

github-actions[bot] on (2025-01-31 20:01:05 UTC):  This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)

"
2742610676,issue,closed,not_planned,Add the middleware to swap the database_id,"For a given user:

* Swap the database_id from all queries that hit a given database_id
* This should work on all queries, including native and MBQL queries.",luizarakaki,2024-12-16 14:55:37+00:00,[],2025-01-30 20:12:08+00:00,2025-01-30 20:12:08+00:00,https://github.com/metabase/metabase/issues/51339,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2742578383,issue,closed,not_planned,test,"**Context**


- issue links: _related issues if any_

",luizarakaki,2024-12-16 14:43:09+00:00,['luizarakaki'],2024-12-16 17:26:53+00:00,2024-12-16 17:26:53+00:00,https://github.com/metabase/metabase/issues/51337,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2742481363,issue,open,,[SDK] Make it easy to switch between sdk and core app e2e tests,"At the moment, we have to restart the cypress command to switch between the two, which takes a lot of times because it often builds the uber jar again.

This is a pain point for the other teams when they accidentally make the sdk tests fail, as reported [here](https://metaboat.slack.com/archives/C063Q3F1HPF/p1733763864814999)

A quick solution that we can try is to make merge the two cypress config files, so that switching between core app and sdk should just be a matter of changing between e2e and component tests in the cypress UI.",npretto,2024-12-16 14:03:22+00:00,[],2025-02-04 20:25:56+00:00,,https://github.com/metabase/metabase/issues/51334,"[('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2742255620,issue,open,,Basic SQL syntax checking and structure validation in the frontend,"**Is your feature request related to a problem? Please describe.**
I'm always frustrated when i do a to and fro in queries and end up adding redundant where's.  There could be other such client side text based sanitities which could be implemented with regex checks.

**Describe the solution you'd like**
the editor simply should barf out if there is already a where clause in the statement. This could be a simple red underline while writing the query itself.

**Describe alternatives you've considered**
Not preferring it, but we could also just replace all additional where's with and. I don't prefer this because i don't think the editor should decide for the user.

**How important is this feature to you?**
Not that important but i can help out here with a bit of handholding.

**Additional context**
Add any other context or screenshots about the feature request here.
",dubeypranav4,2024-12-16 12:27:05+00:00,[],2025-02-04 20:30:30+00:00,,https://github.com/metabase/metabase/issues/51326,"[('Type:New Feature', ''), ('Querying/Native', 'The SQL/native query editor')]","[{'comment_id': 2569194850, 'issue_id': 2742255620, 'author': 'brunobergher', 'body': ""It's unlikely we'd be able to pull this off, since SQL dialects vary so much, but maybe there are some common mistakes we could catch, so I'll leave it open."", 'created_at': datetime.datetime(2025, 1, 3, 13, 5, 41, tzinfo=datetime.timezone.utc)}]","brunobergher on (2025-01-03 13:05:41 UTC): It's unlikely we'd be able to pull this off, since SQL dialects vary so much, but maybe there are some common mistakes we could catch, so I'll leave it open.

"
2742160859,issue,closed,duplicate,"Choose grouping ""Other"" in bar charts","**Is your feature request related to a problem? Please describe.**
It's not a problem, but would be good could can choose groupping or not groupping in a bars visualization.

**Describe the solution you'd like**
The idea is a checkbox in settings to group ""others"" or not.

**How important is this feature to you?**
Sometimes, even with more data, is important show all bars in a chart, even that need scrolling the chart to visualize more info...

**Version**
0.52.2


**Actual...**
![Image](https://github.com/user-attachments/assets/2558afe5-4a3d-461f-ba9e-ae62300475e6)

**Propose...**
![Image](https://github.com/user-attachments/assets/6b9b5dc6-efea-472b-b0ca-646ecc525e3f)
",felipegranado,2024-12-16 11:47:40+00:00,[],2025-01-03 13:04:13+00:00,2025-01-03 13:04:11+00:00,https://github.com/metabase/metabase/issues/51323,"[('Type:New Feature', ''), ('.Needs Triage', '')]","[{'comment_id': 2569193022, 'issue_id': 2742160859, 'author': 'brunobergher', 'body': 'Felipe, this looks like the same as #11325, so closing as duplicate. Let me know if I got it wrong. Obrigado!', 'created_at': datetime.datetime(2025, 1, 3, 13, 4, 11, tzinfo=datetime.timezone.utc)}]","brunobergher on (2025-01-03 13:04:11 UTC): Felipe, this looks like the same as #11325, so closing as duplicate. Let me know if I got it wrong. Obrigado!

"
2740904937,issue,closed,not_planned,Serialization broken on 52,"### Describe the bug

I can't even export a single card on v52. It will return:

```
2024-12-15 21:21:27,825 ERROR serialization.cmd :: Error during deserialization: Exception extracting Dashboard 1 {:model ""Dashboard"", :table :report_dashboard, :id 1, :entity_id ""xBLdW9FsgRuB2HGhWiBa_"", :cause ""Error extracting Dashboard 1""}
  caused by: Error extracting Dashboard 1 {:model ""Dashboard"", :parent-id 1, :id 1}
  caused by: Error exporting nested :model/DashboardCard {:model :model/DashboardCard, :parent-id 1}
  caused by: Error extracting DashboardCard 29 {:model ""DashboardCard"", :id 29, :skip true, :metabase.models.serialization/type :target-not-found}
  caused by: FK target not found {:model :model/Card, :id 25, :skip true, :metabase.models.serialization/type :target-not-found}
```

### To Reproduce

1) start v52 with a postgres sample DB
2) make a dashboard with an x-ray
3) then run the export via the CLI (guess that via the api is the same)

you'll hit the issue

### Expected behavior

Serialization should work

### Logs

```
luis@pop-os:~/Documents/labs/serialization$ docker exec -it metabase_origin java -jar /app/metabase.jar export /target
Warning: environ value jdk-21.0.5+11 for key :java-version has been overwritten with 21.0.5
2024-12-15 21:21:20,690 INFO metabase.util :: Maximum memory available to JVM: 7.6 GB
2024-12-15 21:21:21,702 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance.  
 For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html
2024-12-15 21:21:22,337 ERROR public-settings.premium-features :: Error validating token: Assert failed: Metabase DB is not yet set up
((requiring-resolve (quote metabase.db/db-is-set-up?)))
WARNING: infinite? already refers to: #'kixi.stats.math/infinite? in namespace: kixi.stats.core, being replaced by: #'clojure.core/infinite?
2024-12-15 21:21:24,256 INFO driver.impl :: Registered abstract driver :sql  
2024-12-15 21:21:24,274 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql]) 
2024-12-15 21:21:24,277 INFO metabase.util :: Load driver :sql-jdbc took 8.1 ms
2024-12-15 21:21:24,278 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc]) 
2024-12-15 21:21:24,398 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc]) 
2024-12-15 21:21:24,421 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc]) 
2024-12-15 21:21:24,506 INFO util.namespaces :: Loading namespace: metabase.notification.payload.impl.alert
2024-12-15 21:21:24,508 INFO util.namespaces :: Loading namespace: metabase.notification.payload.impl.dashboard-subscription
2024-12-15 21:21:24,510 INFO util.namespaces :: Loading namespace: metabase.notification.payload.impl.system-event
2024-12-15 21:21:24,517 INFO util.namespaces :: Loading namespace: metabase.channel.impl.email
2024-12-15 21:21:24,525 INFO util.namespaces :: Loading namespace: metabase.channel.impl.http
2024-12-15 21:21:24,530 INFO util.namespaces :: Loading namespace: metabase.channel.impl.slack
2024-12-15 21:21:25,734 INFO metabase.core :: 
Metabase v1.52.2.6 (0ec00d0) 

Copyright  2024 Metabase, Inc. 

Metabase Enterprise Edition extensions are PRESENT.

Usage of Metabase Enterprise Edition features are subject to the Metabase Commercial License.See https://www.metabase.com/license/commercial/ for details.
2024-12-15 21:21:25,750 INFO serialization.cmd :: Exporting Metabase to /target
2024-12-15 21:21:25,751 INFO db.setup :: Verifying postgres Database Connection ...
2024-12-15 21:21:25,881 INFO db.setup :: Successfully verified PostgreSQL 16.2 application database connection. 
2024-12-15 21:21:25,881 INFO db.setup :: Checking if a database downgrade is required...
2024-12-15 21:21:25,926 INFO liquibase.database :: Set default schema name to public
2024-12-15 21:21:26,178 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-12-15 21:21:26,233 INFO db.setup :: Running Database Migrations...
2024-12-15 21:21:26,233 INFO db.setup :: Setting up Liquibase...
2024-12-15 21:21:26,238 INFO liquibase.database :: Set default schema name to public
2024-12-15 21:21:26,333 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-12-15 21:21:26,344 INFO db.liquibase :: Updating liquibase table to reflect consolidated changeset filenames
2024-12-15 21:21:26,361 INFO liquibase.lockservice :: Successfully acquired change log lock
2024-12-15 21:21:26,362 INFO db.liquibase :: No migration lock found.
2024-12-15 21:21:26,363 INFO db.liquibase :: Migration lock acquired.
2024-12-15 21:21:26,388 INFO liquibase.lockservice :: Successfully released change log lock
2024-12-15 21:21:26,389 INFO db.setup :: Liquibase is ready.
2024-12-15 21:21:26,389 INFO db.liquibase :: Checking if Database has unrun migrations...
2024-12-15 21:21:26,399 INFO liquibase.database :: Set default schema name to public
2024-12-15 21:21:26,457 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-12-15 21:21:26,478 INFO liquibase.changelog :: Reading from public.databasechangelog
2024-12-15 21:21:26,563 INFO db.liquibase :: No unrun migrations found.
2024-12-15 21:21:26,564 INFO db.setup :: Database Migrations Current ... 
2024-12-15 21:21:26,565 INFO metabase.util :: Database setup took 814.3 ms
2024-12-15 21:21:26,597 INFO public-settings.premium-features :: Checking with the MetaStore to see whether token 'f325...d01a' is valid...
2024-12-15 21:21:27,718 INFO models.serialization :: Extracting Dashboard 1 xBLdW9FsgRuB2HGhWiBa_
2024-12-15 21:21:27,825 ERROR serialization.cmd :: Error during deserialization: Exception extracting Dashboard 1 {:model ""Dashboard"", :table :report_dashboard, :id 1, :entity_id ""xBLdW9FsgRuB2HGhWiBa_"", :cause ""Error extracting Dashboard 1""}
  caused by: Error extracting Dashboard 1 {:model ""Dashboard"", :parent-id 1, :id 1}
  caused by: Error exporting nested :model/DashboardCard {:model :model/DashboardCard, :parent-id 1}
  caused by: Error extracting DashboardCard 29 {:model ""DashboardCard"", :id 29, :skip true, :metabase.models.serialization/type :target-not-found}
  caused by: FK target not found {:model :model/Card, :id 25, :skip true, :metabase.models.serialization/type :target-not-found}
```

### Information about your Metabase installation

```JSON
v52.2.6
```

### Severity

P1

### Additional context

Probably we broke references?",paoliniluis,2024-12-15 21:28:29+00:00,['piranha'],2024-12-16 12:12:42+00:00,2024-12-16 12:12:40+00:00,https://github.com/metabase/metabase/issues/51317,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Operation/Serialization', 'Enterprise contents migration'), ('.Escalation', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2544083839, 'issue_id': 2740904937, 'author': 'paoliniluis', 'body': ""EDIT: doesn't happen on 51"", 'created_at': datetime.datetime(2024, 12, 15, 21, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2545467204, 'issue_id': 2740904937, 'author': 'paoliniluis', 'body': ""long story short: serialization works fine, but what doesn't work fine is a cascading deletion of cards which end up with a corrupted dashboard that serialization tries to grab"", 'created_at': datetime.datetime(2024, 12, 16, 12, 12, 40, tzinfo=datetime.timezone.utc)}]","paoliniluis (Issue Creator) on (2024-12-15 21:36:00 UTC): EDIT: doesn't happen on 51

paoliniluis (Issue Creator) on (2024-12-16 12:12:40 UTC): long story short: serialization works fine, but what doesn't work fine is a cascading deletion of cards which end up with a corrupted dashboard that serialization tries to grab

"
2740894943,issue,closed,completed,Deadlock on the app db (52),"### Describe the bug

Got a deadlock on the app db, I think this was when I was deleting an DB, but I may be wrong. EDIT: it's when analyzing a card

### To Reproduce

I really don't know how to repro, got it while a script that I run to initialize instances. It seems to be happening when Metabase analyzes the cards

### Expected behavior

We shouldn't cause any deadlocks

### Logs

```
2024-12-15 21:01:41,045 INFO task.sweep-query-analysis :: Recalculating potentially stale analysis
2024-12-15 21:01:42,052 ERROR task.analyze-queries :: Error analysing and updating query for Card 37
clojure.lang.ExceptionInfo: ERROR: deadlock detected
  Detail: Process 59 waits for ShareLock on transaction 2093; blocked by process 57.
Process 57 waits for ShareLock on transaction 2091; blocked by process 59.
  Hint: See server log for query details.
  Where: while locking tuple (3,6) in relation ""metabase_field""
SQL statement ""SELECT 1 FROM ONLY ""public"".""metabase_field"" x WHERE ""id"" OPERATOR(pg_catalog.=) $1 FOR KEY SHARE OF x"" {:toucan2/context-trace [[""execute SQL with class com.mchange.v2.c3p0.impl.NewProxyConnection"" {:toucan2.jdbc.query/sql-args [""INSERT INTO \""query_field\"" (\""card_id\"", \""analysis_id\"", \""schema\"", \""table\"", \""column\"", \""table_id\"", \""field_id\"", \""explicit_reference\"") VALUES (?, ?, NULL, ?, ?, ?, ?, TRUE), (?, ?, NULL, ?, ?, ?, ?, TRUE), (?, ?, NULL, ?, ?, ?, ?, TRUE)"" 37 118 ""ORDERS"" ""PRODUCT_ID"" 2 14 37 118 ""ORDERS"" ""CREATED_AT"" 2 13 37 118 ""ORDERS"" ""QUANTITY"" 2 2]}] [""resolve connection"" {:toucan2.connection/connectable org.postgresql.jdbc.PgConnection}] [""resolve connection"" {:toucan2.connection/connectable nil}] {:toucan2.pipeline/rf #object[clojure.core$completing$fn__8558 0x12136d20 ""clojure.core$completing$fn__8558@12136d20""]} [""with compiled query"" {:toucan2.pipeline/compiled-query [""INSERT INTO \""query_field\"" (\""card_id\"", \""analysis_id\"", \""schema\"", \""table\"", \""column\"", \""table_id\"", \""field_id\"", \""explicit_reference\"") VALUES (?, ?, NULL, ?, ?, ?, ?, TRUE), (?, ?, NULL, ?, ?, ?, ?, TRUE), (?, ?, NULL, ?, ?, ?, ?, TRUE)"" 37 118 ""ORDERS"" ""PRODUCT_ID"" 2 14 37 118 ""ORDERS"" ""CREATED_AT"" 2 13 37 118 ""ORDERS"" ""QUANTITY"" 2 2]}] [""with built query"" {:toucan2.pipeline/built-query {:insert-into [:query_field], :values ((toucan2.instance/instance :model/QueryField {:card_id 37, :analysis_id 118, :schema nil, :table ""ORDERS"", :column ""PRODUCT_ID"", :table_id 2, :field_id 14, :explicit_reference true}) (toucan2.instance/instance :model/QueryField {:card_id 37, :analysis_id 118, :schema nil, :table ""ORDERS"", :column ""CREATED_AT"", :table_id 2, :field_id 13, :explicit_reference true}) (toucan2.instance/instance :model/QueryField {:card_id 37, :analysis_id 118, :schema nil, :table ""ORDERS"", :column ""QUANTITY"", :table_id 2, :field_id 2, :explicit_reference true}))}}] [""with resolved query"" {:toucan2.pipeline/resolved-query {}}] [""with parsed args"" {:toucan2.pipeline/query-type :toucan.query-type/insert.update-count, :toucan2.pipeline/parsed-args {:rows [{:card_id 37, :analysis_id 118, :schema nil, :table ""ORDERS"", :column ""PRODUCT_ID"", :table_id 2, :field_id 14, :explicit_reference true} {:card_id 37, :analysis_id 118, :schema nil, :table ""ORDERS"", :column ""CREATED_AT"", :table_id 2, :field_id 13, :explicit_reference true} {:card_id 37, :analysis_id 118, :schema nil, :table ""ORDERS"", :column ""QUANTITY"", :table_id 2, :field_id 2, :explicit_reference true}]}}] [""with model"" {:toucan2.pipeline/model :model/QueryField}] [""with unparsed args"" {:toucan2.pipeline/query-type :toucan.query-type/insert.update-count, :toucan2.pipeline/unparsed-args (:model/QueryField ({:card_id 37, :analysis_id 118, :schema nil, :table ""ORDERS"", :column ""PRODUCT_ID"", :table_id 2, :field_id 14, :explicit_reference true} {:card_id 37, :analysis_id 118, :schema nil, :table ""ORDERS"", :column ""CREATED_AT"", :table_id 2, :field_id 13, :explicit_reference true} {:card_id 37, :analysis_id 118, :schema nil, :table ""ORDERS"", :column ""QUANTITY"", :table_id 2, :field_id 2, :explicit_reference true}))}] [""resolve connection"" {:toucan2.connection/connectable metabase.db.connection.ApplicationDB}] [""resolve connection"" {:toucan2.connection/connectable :default}] [""resolve connection"" {:toucan2.connection/connectable nil}]]}
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:194)
	at org.postgresql.jdbc.PgPreparedStatement.execute(PgPreparedStatement.java:180)
	at com.mchange.v2.c3p0.impl.NewProxyPreparedStatement.execute(NewProxyPreparedStatement.java:67)
	at toucan2.jdbc.query$reduce_jdbc_query.invokeStatic(query.clj:40)
	at toucan2.jdbc.query$reduce_jdbc_query.invoke(query.clj:22)
	at toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default.invokeStatic(pipeline.clj:19)
	at toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default.invoke(pipeline.clj:9)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:15)
	at methodical.impl.combo.threaded$combine_methods_thread_last$fn__19702$combined_method_thread_last__19703.invoke(threaded.clj:64)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:65)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:216)
	at toucan2.pipeline$transduce_execute$with_connection_STAR___22784$with_transaction_STAR___22785.invoke(pipeline.clj:75)
	at toucan2.connection$bind_current_connectable_fn$fn__22465.invoke(connection.clj:104)
	at metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection.invokeStatic(connection.clj:180)
	at metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection.invoke(connection.clj:162)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:13)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_transaction_around_method_toucan2_connection_default.invokeStatic(connection.clj:249)
	at toucan2.connection$do_with_transaction_around_method_toucan2_connection_default.invoke(connection.clj:245)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:13)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:58)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:212)
	at toucan2.pipeline$transduce_execute$with_connection_STAR___22784.invoke(pipeline.clj:74)
	at toucan2.connection$bind_current_connectable_fn$fn__22465.invoke(connection.clj:104)
	at toucan2.connection$bind_current_connectable_fn$fn__22465.invoke(connection.clj:104)
	at toucan2.jdbc.connection$do_with_connection_primary_method_java_sql_Connection.invokeStatic(connection.clj:13)
	at toucan2.jdbc.connection$do_with_connection_primary_method_java_sql_Connection.invoke(connection.clj:11)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210)
	at toucan2.connection$do_with_connection_primary_method_.invokeStatic(connection.clj:204)
	at toucan2.connection$do_with_connection_primary_method_.invoke(connection.clj:194)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210)
	at toucan2.pipeline$transduce_execute.invokeStatic(pipeline.clj:74)
	at toucan2.pipeline$transduce_execute.invoke(pipeline.clj:64)
	at clojure.lang.Var.invoke(Var.java:401)
	at toucan2.pipeline$transduce_compiled_query.invokeStatic(pipeline.clj:244)
	at toucan2.pipeline$transduce_compiled_query.invoke(pipeline.clj:240)
	at toucan2.pipeline$transduce_built_query.invokeStatic(pipeline.clj:252)
	at toucan2.pipeline$transduce_built_query.invoke(pipeline.clj:246)
	at toucan2.pipeline$transduce_query_primary_method_default.invokeStatic(pipeline.clj:272)
	at toucan2.pipeline$transduce_query_primary_method_default.invoke(pipeline.clj:269)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:15)
	at methodical.impl.combo.threaded$combine_methods_thread_last$fn__19702$combined_method_thread_last__19703.invoke(threaded.clj:64)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:65)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:216)
	at toucan2.pipeline$transduce_query_STAR_.invokeStatic(pipeline.clj:278)
	at toucan2.pipeline$transduce_query_STAR_.invoke(pipeline.clj:274)
	at toucan2.pipeline$transduce_with_model.invokeStatic(pipeline.clj:293)
	at toucan2.pipeline$transduce_with_model.invoke(pipeline.clj:280)
	at toucan2.pipeline$transduce_parsed.invokeStatic(pipeline.clj:309)
	at toucan2.pipeline$transduce_parsed.invoke(pipeline.clj:295)
	at toucan2.pipeline$transduce_unparsed.invokeStatic(pipeline.clj:317)
	at toucan2.pipeline$transduce_unparsed.invoke(pipeline.clj:311)
	at toucan2.pipeline$transduce_unparsed_with_default_rf.invokeStatic(pipeline.clj:374)
	at toucan2.pipeline$transduce_unparsed_with_default_rf.invoke(pipeline.clj:368)
	at toucan2.insert$insert_BANG_.invokeStatic(insert.clj:124)
	at toucan2.insert$insert_BANG_.doInvoke(insert.clj:74)
	at clojure.lang.RestFn.invoke(RestFn.java:424)
	at metabase.query_analysis$update_query_analysis_for_card_BANG_$with_connection_STAR___75567$with_transaction_STAR___75568.invoke(query_analysis.clj:157)
	at toucan2.connection$bind_current_connectable_fn$fn__22465.invoke(connection.clj:104)
	at metabase.db.connection$do_transaction$thunk__43610.invoke(connection.clj:140)
	at metabase.db.connection$do_transaction.invokeStatic(connection.clj:152)
	at metabase.db.connection$do_transaction.invoke(connection.clj:136)
	at metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection.invokeStatic(connection.clj:189)
	at metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection.invoke(connection.clj:162)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:13)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_transaction_around_method_toucan2_connection_default.invokeStatic(connection.clj:249)
	at toucan2.connection$do_with_transaction_around_method_toucan2_connection_default.invoke(connection.clj:245)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:13)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:58)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:212)
	at metabase.query_analysis$update_query_analysis_for_card_BANG_$with_connection_STAR___75567.invoke(query_analysis.clj:132)
	at toucan2.connection$bind_current_connectable_fn$fn__22465.invoke(connection.clj:104)
	at toucan2.connection$bind_current_connectable_fn$fn__22465.invoke(connection.clj:104)
	at toucan2.connection$bind_current_connectable_fn$fn__22465.invoke(connection.clj:104)
	at toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource.invokeStatic(connection.clj:18)
	at toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource.invoke(connection.clj:15)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210)
	at metabase.db.connection$do_with_connection_primary_method_default.invokeStatic(connection.clj:132)
	at metabase.db.connection$do_with_connection_primary_method_default.invoke(connection.clj:130)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210)
	at toucan2.connection$do_with_connection_primary_method_.invokeStatic(connection.clj:204)
	at toucan2.connection$do_with_connection_primary_method_.invoke(connection.clj:194)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106)
	at methodical.impl.combo.common$partial_STAR_$fn__19392.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210)
	at metabase.query_analysis$update_query_analysis_for_card_BANG_.invokeStatic(query_analysis.clj:132)
	at metabase.query_analysis$update_query_analysis_for_card_BANG_.invoke(query_analysis.clj:124)
	at metabase.query_analysis$analyze_BANG__STAR_.invokeStatic(query_analysis.clj:239)
	at metabase.query_analysis$analyze_BANG__STAR_.invoke(query_analysis.clj:228)
	at metabase.task.analyze_queries$analyzer_loop_STAR_$fn__117936.invoke(analyze_queries.clj:51)
	at metabase.task.analyze_queries$analyzer_loop_STAR_.invokeStatic(analyze_queries.clj:50)
	at metabase.task.analyze_queries$analyzer_loop_STAR_.invoke(analyze_queries.clj:40)
	at metabase.task.analyze_queries$analyzer_loop_BANG_.invokeStatic(analyze_queries.clj:73)
	at metabase.task.analyze_queries$analyzer_loop_BANG_.invoke(analyze_queries.clj:69)
	at metabase.task.analyze_queries$analyzer_loop_BANG_.invokeStatic(analyze_queries.clj:71)
	at metabase.task.analyze_queries$analyzer_loop_BANG_.invoke(analyze_queries.clj:69)
	at metabase.task.analyze_queries.QueryAnalyzer.execute(analyze_queries.clj:82)
	at org.quartz.core.JobRunShell.run(JobRunShell.java:202)
	at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:573)
Caused by: org.postgresql.util.PSQLException: ERROR: deadlock detected
  Detail: Process 59 waits for ShareLock on transaction 2093; blocked by process 57.
Process 57 waits for ShareLock on transaction 2091; blocked by process 59.
  Hint: See server log for query details.
  Where: while locking tuple (3,6) in relation ""metabase_field""
SQL statement ""SELECT 1 FROM ONLY ""public"".""metabase_field"" x WHERE ""id"" OPERATOR(pg_catalog.=) $1 FOR KEY SHARE OF x""
	... 151 more
2024-12-15 21:01:42,076 DEBUG middleware.log :: DELETE /api/database/1 204 1111ms (149 DB calls) App DB connections: 1/7 Jetty threads: 6/50 (1 idle, 0 queued) (52 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
```

### Information about your Metabase installation

```JSON
v52.2.6
```

### Severity

P1

### Additional context

This is the lab
https://github.com/paoliniluis/metabase-serialization",paoliniluis,2024-12-15 21:09:26+00:00,['crisptrutski'],2024-12-16 11:12:04+00:00,2024-12-16 10:09:36+00:00,https://github.com/metabase/metabase/issues/51316,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Escalation', ''), ('.Team/Workflows', 'aka BEC'), ('Querying/Native/Parser', '')]","[{'comment_id': 2544083010, 'issue_id': 2740894943, 'author': 'paoliniluis', 'body': 'EDIT: does not happen in 51', 'created_at': datetime.datetime(2024, 12, 15, 21, 34, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2544820287, 'issue_id': 2740894943, 'author': 'crisptrutski', 'body': ""This is pretty strange, as the transaction should be write-only. Toucan must be inserting that select for some reason, but at first glance it's unclear why as there are no hooks defined on the relevant model."", 'created_at': datetime.datetime(2024, 12, 16, 7, 43, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2544836762, 'issue_id': 2740894943, 'author': 'crisptrutski', 'body': 'Using toucan monitor to examine the queries issued from a local instance with PostgreSQL, this blocking SELECT 1 is not being issued.\n\n```\n""INSERT INTO """"QUERY_ANALYSIS"""" (""""CARD_ID"""", """"STATUS"""") VALUES (?, ?)"",""[1 """"running""""]"",0.383833\n""SELECT """"ID"""", """"ENGINE"""", """"NAME"""", """"DBMS_VERSION"""", """"SETTINGS"""", """"IS_AUDIT"""", """"DETAILS"""", """"TIMEZONE"""" FROM """"METABASE_DATABASE"""" WHERE """"ID"""" = ?"",[1],2.763125\n""SELECT """"T"""".""""ID"""" AS """"TABLE-ID"""", """"T"""".""""NAME"""" AS """"TABLE"""", """"T"""".""""SCHEMA"""" AS """"SCHEMA"""" FROM """"METABASE_TABLE"""" AS """"T"""" WHERE (""""T"""".""""DB_ID"""" = ?) AND ((LOWER(""""T"""".""""NAME"""") = ?) OR (LOWER(""""T"""".""""NAME"""") = ?))"",""[1 """"18be3cc2_84cf_44e6_87a7_306cba70a89812955651_e2c4_48ed_afcd_53cda43b116e598ea6f8_f158_49e1_95f0_4b6d06145dde94a9f996_7390_4813_b4a3_855aacd91c28373021c6_2334_48fd_b456_6ef3fe392daad5922ead_f76a_4f1d_94f3_05d1202dfca14c3ef6cf_8981_4647_a3c5_a86c5052712eb17831cf_5968_45bc_a5fd_f005c3cc4d2b6d1afa0c_7f86_415e_b691_d635809293e5a67a5d46_bae3_41f4_9074_43cc5e2cc5f6"""" """"t""""]"",0.54225\n""SELECT """"F"""".""""ID"""" AS """"FIELD-ID"""", """"F"""".""""NAME"""" AS """"COLUMN"""", """"T"""".""""ID"""" AS """"TABLE-ID"""", """"T"""".""""NAME"""" AS """"TABLE"""", """"T"""".""""SCHEMA"""" AS """"SCHEMA"""" FROM """"METABASE_TABLE"""" AS """"T"""" LEFT JOIN """"METABASE_FIELD"""" AS """"F"""" ON """"F"""".""""TABLE_ID"""" = """"T"""".""""ID"""" WHERE (""""T"""".""""DB_ID"""" = ?) AND ((((""""F"""".""""ID"""" IS NULL) OR (LOWER(""""F"""".""""NAME"""") = ?)) AND ((LOWER(""""T"""".""""NAME"""") = ?) OR (LOWER(""""T"""".""""NAME"""") = ?))) OR (((""""F"""".""""ID"""" IS NULL) OR (LOWER(""""F"""".""""NAME"""") = ?)) AND ((LOWER(""""T"""".""""NAME"""") = ?) OR (LOWER(""""T"""".""""NAME"""") = ?))))"",""[1 """"d40496bd_8a48_4973_b8c9_ac721c83d725eb9694c9_26ff_4764_8224_80856706cd850eebb22a_8796_4b32_b9d3_877616fc824d456b750b_4f29_48d6_a517_81644d01e719e1be74de_4f91_45d4_ba8b_46d108cd92c7c076178b_1a55_4bc3_89c0_accceb4df3ac8339d9f1_8916_4682_b4ec_a7a6ab2710b86e2c28e7_ba2b_4abc_85fd_cf6953059cfc51af7971_e971_40f8_b0c1_6e731be05f19526f7f1d_790b_4742_818c_b54766015c03"""" """"18be3cc2_84cf_44e6_87a7_306cba70a89812955651_e2c4_48ed_afcd_53cda43b116e598ea6f8_f158_49e1_95f0_4b6d06145dde94a9f996_7390_4813_b4a3_855aacd91c28373021c6_2334_48fd_b456_6ef3fe392daad5922ead_f76a_4f1d_94f3_05d1202dfca14c3ef6cf_8981_4647_a3c5_a86c5052712eb17831cf_5968_45bc_a5fd_f005c3cc4d2b6d1afa0c_7f86_415e_b691_d635809293e5a67a5d46_bae3_41f4_9074_43cc5e2cc5f6"""" """"t"""" """"c"""" """"18be3cc2_84cf_44e6_87a7_306cba70a89812955651_e2c4_48ed_afcd_53cda43b116e598ea6f8_f158_49e1_95f0_4b6d06145dde94a9f996_7390_4813_b4a3_855aacd91c28373021c6_2334_48fd_b456_6ef3fe392daad5922ead_f76a_4f1d_94f3_05d1202dfca14c3ef6cf_8981_4647_a3c5_a86c5052712eb17831cf_5968_45bc_a5fd_f005c3cc4d2b6d1afa0c_7f86_415e_b691_d635809293e5a67a5d46_bae3_41f4_9074_43cc5e2cc5f6"""" """"t""""]"",0.58575\n""INSERT INTO """"QUERY_FIELD"""" (""""CARD_ID"""", """"ANALYSIS_ID"""", """"SCHEMA"""", """"TABLE"""", """"COLUMN"""", """"TABLE_ID"""", """"FIELD_ID"""", """"EXPLICIT_REFERENCE"""") VALUES (?, ?, NULL, NULL, ?, NULL, NULL, TRUE), (?, ?, NULL, NULL, ?, NULL, NULL, TRUE)"",""[1 1 """"d40496bd_8a48_4973_b8c9_ac721c83d725eb9694c9_26ff_4764_8224_80856706cd850eebb22a_8796_4b32_b9d3_877616fc824d456b750b_4f29_48d6_a517_81644d01e719e1be74de_4f91_45d4_ba8b_46d108cd92c7c076178b_1a55_4bc3_89c0_accceb4df3ac8339d9f1_8916_4682_b4ec_a7a6ab2710b86e"""" 1 1 """"c""""]"",0.227792\n""INSERT INTO """"QUERY_TABLE"""" (""""CARD_ID"""", """"ANALYSIS_ID"""", """"SCHEMA"""", """"TABLE"""", """"TABLE_ID"""") VALUES (?, ?, NULL, ?, NULL), (?, ?, NULL, ?, NULL)"",""[1 1 """"t"""" 1 1 """"18be3cc2_84cf_44e6_87a7_306cba70a89812955651_e2c4_48ed_afcd_53cda43b116e598ea6f8_f158_49e1_95f0_4b6d06145dde94a9f996_7390_4813_b4a3_855aacd91c28373021c6_2334_48fd_b456_6ef3fe392daad5922ead_f76a_4f1d_94f3_05d1202dfca14c3ef6cf_8981_4647_a3c5_a86c5052712eb1""""]"",0.130791\n""UPDATE """"QUERY_ANALYSIS"""" SET """"STATUS"""" = ? WHERE """"ID"""" = ?"",""[""""complete"""" 1]"",0.175375\n""DELETE FROM """"QUERY_ANALYSIS"""" WHERE (""""CARD_ID"""" = ?) AND (""""ID"""" <> ?)"",[1 1],0.0485\n```', 'created_at': datetime.datetime(2024, 12, 16, 7, 51, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2544970756, 'issue_id': 2740894943, 'author': 'crisptrutski', 'body': ""The deepest toucan logs (toucan2.jdbc.query:40) show that we're about to execute the INSERT query, but for some reason when we execute the statement it refers to this locking SELECT. I can't find any code in metabase or toucan2 that would generate this query either.\n\nI enabled the logging for all Postgres queries locally, but do not see the SELECT 1 statement being run on my side."", 'created_at': datetime.datetime(2024, 12, 16, 8, 53, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2545058293, 'issue_id': 2740894943, 'author': 'crisptrutski', 'body': ""Ah, what I missed is that the exists query is on `metabase_field` *not* `query_field` (which we're inserting into). This must correspond to the implicit foreign key check on the `field_id` column. There is one other query to `metabase_field` in the transaction, which is earlier when we find the relevant entities to join to. This explains why the query is so defensive around inherited tables and overriding operators.\n\nI don't understand how this creates a deadlock, especially not a non-deterministic one as we always do the same two queries. On the other hand, we don't actually need a transaction now that we use a `query_analysis` parent record to do a two phase commit.\n\nRemoving the transaction should resolve the issue, but its hard to be sure if we aren't able to reproduce."", 'created_at': datetime.datetime(2024, 12, 16, 9, 32, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2545063481, 'issue_id': 2740894943, 'author': 'crisptrutski', 'body': 'Lowering from P1 to P2 as this deadlock occurred on the async worker for populating query analysis, and would not cause direct impact. The relevant code has also not changed between 51 and 52.', 'created_at': datetime.datetime(2024, 12, 16, 9, 35, 6, tzinfo=datetime.timezone.utc)}]","paoliniluis (Issue Creator) on (2024-12-15 21:34:54 UTC): EDIT: does not happen in 51

crisptrutski (Assginee) on (2024-12-16 07:43:12 UTC): This is pretty strange, as the transaction should be write-only. Toucan must be inserting that select for some reason, but at first glance it's unclear why as there are no hooks defined on the relevant model.

crisptrutski (Assginee) on (2024-12-16 07:51:37 UTC): Using toucan monitor to examine the queries issued from a local instance with PostgreSQL, this blocking SELECT 1 is not being issued.

```
""INSERT INTO """"QUERY_ANALYSIS"""" (""""CARD_ID"""", """"STATUS"""") VALUES (?, ?)"",""[1 """"running""""]"",0.383833
""SELECT """"ID"""", """"ENGINE"""", """"NAME"""", """"DBMS_VERSION"""", """"SETTINGS"""", """"IS_AUDIT"""", """"DETAILS"""", """"TIMEZONE"""" FROM """"METABASE_DATABASE"""" WHERE """"ID"""" = ?"",[1],2.763125
""SELECT """"T"""".""""ID"""" AS """"TABLE-ID"""", """"T"""".""""NAME"""" AS """"TABLE"""", """"T"""".""""SCHEMA"""" AS """"SCHEMA"""" FROM """"METABASE_TABLE"""" AS """"T"""" WHERE (""""T"""".""""DB_ID"""" = ?) AND ((LOWER(""""T"""".""""NAME"""") = ?) OR (LOWER(""""T"""".""""NAME"""") = ?))"",""[1 """"18be3cc2_84cf_44e6_87a7_306cba70a89812955651_e2c4_48ed_afcd_53cda43b116e598ea6f8_f158_49e1_95f0_4b6d06145dde94a9f996_7390_4813_b4a3_855aacd91c28373021c6_2334_48fd_b456_6ef3fe392daad5922ead_f76a_4f1d_94f3_05d1202dfca14c3ef6cf_8981_4647_a3c5_a86c5052712eb17831cf_5968_45bc_a5fd_f005c3cc4d2b6d1afa0c_7f86_415e_b691_d635809293e5a67a5d46_bae3_41f4_9074_43cc5e2cc5f6"""" """"t""""]"",0.54225
""SELECT """"F"""".""""ID"""" AS """"FIELD-ID"""", """"F"""".""""NAME"""" AS """"COLUMN"""", """"T"""".""""ID"""" AS """"TABLE-ID"""", """"T"""".""""NAME"""" AS """"TABLE"""", """"T"""".""""SCHEMA"""" AS """"SCHEMA"""" FROM """"METABASE_TABLE"""" AS """"T"""" LEFT JOIN """"METABASE_FIELD"""" AS """"F"""" ON """"F"""".""""TABLE_ID"""" = """"T"""".""""ID"""" WHERE (""""T"""".""""DB_ID"""" = ?) AND ((((""""F"""".""""ID"""" IS NULL) OR (LOWER(""""F"""".""""NAME"""") = ?)) AND ((LOWER(""""T"""".""""NAME"""") = ?) OR (LOWER(""""T"""".""""NAME"""") = ?))) OR (((""""F"""".""""ID"""" IS NULL) OR (LOWER(""""F"""".""""NAME"""") = ?)) AND ((LOWER(""""T"""".""""NAME"""") = ?) OR (LOWER(""""T"""".""""NAME"""") = ?))))"",""[1 """"d40496bd_8a48_4973_b8c9_ac721c83d725eb9694c9_26ff_4764_8224_80856706cd850eebb22a_8796_4b32_b9d3_877616fc824d456b750b_4f29_48d6_a517_81644d01e719e1be74de_4f91_45d4_ba8b_46d108cd92c7c076178b_1a55_4bc3_89c0_accceb4df3ac8339d9f1_8916_4682_b4ec_a7a6ab2710b86e2c28e7_ba2b_4abc_85fd_cf6953059cfc51af7971_e971_40f8_b0c1_6e731be05f19526f7f1d_790b_4742_818c_b54766015c03"""" """"18be3cc2_84cf_44e6_87a7_306cba70a89812955651_e2c4_48ed_afcd_53cda43b116e598ea6f8_f158_49e1_95f0_4b6d06145dde94a9f996_7390_4813_b4a3_855aacd91c28373021c6_2334_48fd_b456_6ef3fe392daad5922ead_f76a_4f1d_94f3_05d1202dfca14c3ef6cf_8981_4647_a3c5_a86c5052712eb17831cf_5968_45bc_a5fd_f005c3cc4d2b6d1afa0c_7f86_415e_b691_d635809293e5a67a5d46_bae3_41f4_9074_43cc5e2cc5f6"""" """"t"""" """"c"""" """"18be3cc2_84cf_44e6_87a7_306cba70a89812955651_e2c4_48ed_afcd_53cda43b116e598ea6f8_f158_49e1_95f0_4b6d06145dde94a9f996_7390_4813_b4a3_855aacd91c28373021c6_2334_48fd_b456_6ef3fe392daad5922ead_f76a_4f1d_94f3_05d1202dfca14c3ef6cf_8981_4647_a3c5_a86c5052712eb17831cf_5968_45bc_a5fd_f005c3cc4d2b6d1afa0c_7f86_415e_b691_d635809293e5a67a5d46_bae3_41f4_9074_43cc5e2cc5f6"""" """"t""""]"",0.58575
""INSERT INTO """"QUERY_FIELD"""" (""""CARD_ID"""", """"ANALYSIS_ID"""", """"SCHEMA"""", """"TABLE"""", """"COLUMN"""", """"TABLE_ID"""", """"FIELD_ID"""", """"EXPLICIT_REFERENCE"""") VALUES (?, ?, NULL, NULL, ?, NULL, NULL, TRUE), (?, ?, NULL, NULL, ?, NULL, NULL, TRUE)"",""[1 1 """"d40496bd_8a48_4973_b8c9_ac721c83d725eb9694c9_26ff_4764_8224_80856706cd850eebb22a_8796_4b32_b9d3_877616fc824d456b750b_4f29_48d6_a517_81644d01e719e1be74de_4f91_45d4_ba8b_46d108cd92c7c076178b_1a55_4bc3_89c0_accceb4df3ac8339d9f1_8916_4682_b4ec_a7a6ab2710b86e"""" 1 1 """"c""""]"",0.227792
""INSERT INTO """"QUERY_TABLE"""" (""""CARD_ID"""", """"ANALYSIS_ID"""", """"SCHEMA"""", """"TABLE"""", """"TABLE_ID"""") VALUES (?, ?, NULL, ?, NULL), (?, ?, NULL, ?, NULL)"",""[1 1 """"t"""" 1 1 """"18be3cc2_84cf_44e6_87a7_306cba70a89812955651_e2c4_48ed_afcd_53cda43b116e598ea6f8_f158_49e1_95f0_4b6d06145dde94a9f996_7390_4813_b4a3_855aacd91c28373021c6_2334_48fd_b456_6ef3fe392daad5922ead_f76a_4f1d_94f3_05d1202dfca14c3ef6cf_8981_4647_a3c5_a86c5052712eb1""""]"",0.130791
""UPDATE """"QUERY_ANALYSIS"""" SET """"STATUS"""" = ? WHERE """"ID"""" = ?"",""[""""complete"""" 1]"",0.175375
""DELETE FROM """"QUERY_ANALYSIS"""" WHERE (""""CARD_ID"""" = ?) AND (""""ID"""" <> ?)"",[1 1],0.0485
```

crisptrutski (Assginee) on (2024-12-16 08:53:40 UTC): The deepest toucan logs (toucan2.jdbc.query:40) show that we're about to execute the INSERT query, but for some reason when we execute the statement it refers to this locking SELECT. I can't find any code in metabase or toucan2 that would generate this query either.

I enabled the logging for all Postgres queries locally, but do not see the SELECT 1 statement being run on my side.

crisptrutski (Assginee) on (2024-12-16 09:32:42 UTC): Ah, what I missed is that the exists query is on `metabase_field` *not* `query_field` (which we're inserting into). This must correspond to the implicit foreign key check on the `field_id` column. There is one other query to `metabase_field` in the transaction, which is earlier when we find the relevant entities to join to. This explains why the query is so defensive around inherited tables and overriding operators.

I don't understand how this creates a deadlock, especially not a non-deterministic one as we always do the same two queries. On the other hand, we don't actually need a transaction now that we use a `query_analysis` parent record to do a two phase commit.

Removing the transaction should resolve the issue, but its hard to be sure if we aren't able to reproduce.

crisptrutski (Assginee) on (2024-12-16 09:35:06 UTC): Lowering from P1 to P2 as this deadlock occurred on the async worker for populating query analysis, and would not cause direct impact. The relevant code has also not changed between 51 and 52.

"
2739263881,issue,closed,completed,New Metrics API misses human-friendly text metric definition,"### Describe the bug

https://metaboat.slack.com/archives/C0645JP1W81/p1734109505069329

### To Reproduce

https://metaboat.slack.com/archives/C0645JP1W81/p1734109505069329

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
51
```

### Severity

blocking some users

### Additional context

_No response_",mngr,2024-12-13 21:51:57+00:00,['lbrdnk'],2024-12-23 10:50:26+00:00,2024-12-20 19:51:15+00:00,https://github.com/metabase/metabase/issues/51303,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2559432412, 'issue_id': 2739263881, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)', 'created_at': datetime.datetime(2024, 12, 23, 10, 50, 25, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-23 10:50:25 UTC):  This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)

"
2739211448,issue,closed,completed,[TableInteractive] view detail messes up rows when horizontal scroll is used,"### Describe the bug

wrong line is selected when you click on view details, [context](https://metaboat.slack.com/archives/C05MPF0TM3L/p1734080677038349)



### To Reproduce

- open people table
- scroll a bit down (half of the row)
- scroll on the right
- hover over some line and click on view details -> not correct line is selected

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
v52, 7ab0c413a4
```

### Severity

p2

### Additional context

_No response_",uladzimirdev,2024-12-13 21:06:34+00:00,['uladzimirdev'],2024-12-16 15:57:13+00:00,2024-12-16 14:56:17+00:00,https://github.com/metabase/metabase/issues/51301,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug')]",[],
2739151108,issue,closed,completed,Adjust the diagnostics modal to also offer external users to add context,"We should allow external users to also use the text input to add details to their diagnostics report and make it clear where and how this can be shared with us as the modal right now is a bit cryptic.

@romnitt I've made a few comments in that regard in the [Figma designs](https://www.figma.com/design/Hnb7RXZaL4gMjINWQPjhhf/Bug-reporting?node-id=14061-18873&node-type=frame&t=d2rWDjYeeosXYNnQ-11) for your consideration.

@filiphric I'll let you adjust once Roman has made suggestions",thebiglabasky,2024-12-13 20:21:14+00:00,['thebiglabasky'],2025-02-04 16:53:29+00:00,2025-01-27 17:54:03+00:00,https://github.com/metabase/metabase/issues/51297,[],[],
2739116441,issue,closed,duplicate,Dynamic defaults for filter values,"**Is your feature request related to a problem? Please describe.**

We have two different use cases related to this request:

1) Customer has a question with a date filter and needs to enforce a default date range. They would like for the default month to be ""most recent month with data"".

2) Another customer has a dashboard that they are deploying to multiple environments. Each environment contains it's own identical schema, but the contents of the tables (and thus the default values they need to set for each) will vary. The contents of these tables, per customer, may change. They would like to be able to enforce a default text filter that is something like ""first not null value in the result set"" so that they can deploy all of these dashboard with a functional default filter.

**Describe the solution you'd like**
Some method of defining the default value dynamically. Perhaps a custom expression, SQL statement or being able to refer to the results of another card for the default.

**Describe alternatives you've considered**

- For the deployment case we considered setting the defaults in the YAML files prior to deployment to individual customers. This would add a lot of complexity to the deployment process and the values still wouldn't update with the customers underlying data if it changes.
- For the date issue, considered relative date filter as a default - but the customer would like the default to change as data for the current month become available.
",ixipixi,2024-12-13 19:59:26+00:00,[],2025-01-06 11:04:10+00:00,2025-01-06 11:04:08+00:00,https://github.com/metabase/metabase/issues/51295,"[('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('Reporting/Dashboards/Filters & Parameters', 'Related to the setup and use of filters and parameters in dashboards only')]","[{'comment_id': 2542210842, 'issue_id': 2739116441, 'author': 'ixipixi', 'body': 'Possibly related: https://github.com/metabase/metabase/issues/3156', 'created_at': datetime.datetime(2024, 12, 13, 20, 1, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572879531, 'issue_id': 2739116441, 'author': 'brunobergher', 'body': ""I think they're more than related, LeAnn, but an actual duplicate. Closing, ok?"", 'created_at': datetime.datetime(2025, 1, 6, 11, 4, 8, tzinfo=datetime.timezone.utc)}]","ixipixi (Issue Creator) on (2024-12-13 20:01:36 UTC): Possibly related: https://github.com/metabase/metabase/issues/3156

brunobergher on (2025-01-06 11:04:08 UTC): I think they're more than related, LeAnn, but an actual duplicate. Closing, ok?

"
2738837106,issue,open,,Charts with data labels jitter slightly when hovered on,When you hover on a bar in a chart [like this](https://stats.metabase.com/question/6330-new-oss-instances) it jitters slightly up and down 1px or so. Likely related to data label implementation.,cdeweyx,2024-12-13 17:11:33+00:00,[],2025-02-04 20:31:19+00:00,,https://github.com/metabase/metabase/issues/51289,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2738649953,issue,closed,not_planned,Actions don't work when table name begins with an integer?,"![Image](https://github.com/user-attachments/assets/5357725d-a0ce-4fec-8040-6093e29c17ca)

The action `update 16k_movies_20240906145442 set rating = 1` doesn't work for me, but similar actions for tables beginning with a letter do work.",rafpaf,2024-12-13 15:28:49+00:00,[],2024-12-13 17:44:41+00:00,2024-12-13 17:44:40+00:00,https://github.com/metabase/metabase/issues/51285,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Needs Triage', '')]","[{'comment_id': 2541950882, 'issue_id': 2738649953, 'author': 'rafpaf', 'body': 'this is a postgres thing, not a mb thing', 'created_at': datetime.datetime(2024, 12, 13, 17, 44, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2541951008, 'issue_id': 2738649953, 'author': 'rafpaf', 'body': 'this is a postgres thing, not a mb thing', 'created_at': datetime.datetime(2024, 12, 13, 17, 44, 40, tzinfo=datetime.timezone.utc)}]","rafpaf (Issue Creator) on (2024-12-13 17:44:35 UTC): this is a postgres thing, not a mb thing

rafpaf (Issue Creator) on (2024-12-13 17:44:40 UTC): this is a postgres thing, not a mb thing

"
2738603855,issue,open,,The New Action modal is too hard to close,"### Describe the bug

Modals should be closable by
* clicking an ""x"" in the top right corner
* clicking outside the modal
* pressing `Esc`
* clicking a **Cancel** button.

The New Action modal only has a **Cancel** button. The other methods don't work.

![Image](https://github.com/user-attachments/assets/272ceb71-a416-4faa-90b3-979238ae41e9)",rafpaf,2024-12-13 15:06:31+00:00,[],2025-02-06 10:05:41+00:00,,https://github.com/metabase/metabase/issues/51283,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Querying/Actions', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2541666511, 'issue_id': 2738603855, 'author': 'rafpaf', 'body': 'The missing ""x"" button might be on purpose, since clicking the gear icon opens a closable region within the modal with further information, and this region has an ""x"". \n\n![Image](https://github.com/user-attachments/assets/37b484c4-a4d3-4d0e-9689-b8ad3f90b4c0)\n\nPerhaps the region could use a ""back"" button, like our sub-sidesheets have:\n\n![Image](https://github.com/user-attachments/assets/bd67a3c1-2ea0-4f87-86df-5f55db6efbf3)', 'created_at': datetime.datetime(2024, 12, 13, 15, 10, 58, tzinfo=datetime.timezone.utc)}]","rafpaf (Issue Creator) on (2024-12-13 15:10:58 UTC): The missing ""x"" button might be on purpose, since clicking the gear icon opens a closable region within the modal with further information, and this region has an ""x"". 

![Image](https://github.com/user-attachments/assets/37b484c4-a4d3-4d0e-9689-b8ad3f90b4c0)

Perhaps the region could use a ""back"" button, like our sub-sidesheets have:

![Image](https://github.com/user-attachments/assets/bd67a3c1-2ea0-4f87-86df-5f55db6efbf3)

"
2738594636,issue,closed,completed,Actions can't be made public,"**Describe the bug**

The **Create action** modal provides a ""Make public"" switch. This switch does nothing when I click on it.

**To Reproduce**
Steps to reproduce the behavior:
1. New > Action
2. Click the gear icon (Action settings)
3. Click the ""Make public"" switch on the right
4. Notice it does nothing

![Image](https://github.com/user-attachments/assets/a13223f9-f1e7-4738-8c7d-5bbfdfb1d0c4)
",rafpaf,2024-12-13 15:02:00+00:00,['kamilmielnik'],2025-01-22 10:14:37+00:00,2025-01-22 09:44:26+00:00,https://github.com/metabase/metabase/issues/51282,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Difficulty:Easy', ''), ('.Frontend', ''), ('Querying/Actions', ''), ('.Team/Querying', '')]","[{'comment_id': 2541657521, 'issue_id': 2738594636, 'author': 'kamilmielnik', 'body': ""That toggle can't work before action is created (needs action id for API call) - we should not show it in New Action modal."", 'created_at': datetime.datetime(2024, 12, 13, 15, 6, 30, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Assginee) on (2024-12-13 15:06:30 UTC): That toggle can't work before action is created (needs action id for API call) - we should not show it in New Action modal.

"
2738288104,issue,closed,completed,Co-ordinate Search Index creation and rotation between instances,"As a scrappy first version we relied a non-concurrent Qwartz job updating a clojure map in a defsetting as the source of truth for active and pending tables for each Metabase version.

This has turned out to be too racy, which can result in valid indexes being forgotten and active indexes being deleted.

We need to revisit the co-ordination mechanism to make it bullet proof.",crisptrutski,2024-12-13 12:29:04+00:00,['crisptrutski'],2024-12-17 18:16:42+00:00,2024-12-17 16:08:44+00:00,https://github.com/metabase/metabase/issues/51279,[],"[{'comment_id': 2541368683, 'issue_id': 2738288104, 'author': 'crisptrutski', 'body': '[Original tech doc ](https://www.notion.so/metabase/Search-Index-Maintenance-14b69354c9018047b670cbba1c3be50d)', 'created_at': datetime.datetime(2024, 12, 13, 12, 39, 49, tzinfo=datetime.timezone.utc)}]","crisptrutski (Issue Creator) on (2024-12-13 12:39:49 UTC): [Original tech doc ](https://www.notion.so/metabase/Search-Index-Maintenance-14b69354c9018047b670cbba1c3be50d)

"
2738198068,issue,closed,completed,Authenticate access to Databricks with a service principal using OAuth (OAuth M2M),"### **Is your feature request related to a problem? Please describe.**
The current implementation of the Databricks drivers were inspired by the implementation of [relferreira](https://github.com/relferreira)
[metabase-sparksql-databricks-driver](https://github.com/relferreira/metabase-sparksql-databricks-driver). However, the problem with this implementation, in contrast to [Brigad](https://github.com/Brigad/metabase-sparksql-databricks-driver) is that it makes use of User Access Tokens. Brigad's implementation, which follows Databricks recommendations, uses Machine 2 Machine authentication.

> [!NOTE]
> We make the assumption that no Database connection should be set up using individual user credentials. The connection method, which should be somewhat abstracted from the underlying drivers of the current Databricks implementation should not be affected.

### **Describe the solution you'd like**
We expect that the Databricks Drivers utilise OAuth client id and client secrets as [recommended](https://docs.databricks.com/en/dev-tools/auth/oauth-m2m.html#manually-generate-and-use-access-tokens-for-oauth-m2m-authentication) by Databricks and implemented by  [Brigad](https://github.com/Brigad/metabase-sparksql-databricks-driver). Minimal changes to the underlying drivers are likely needed, only how the authentication works.

> Databricks recommends using client unified authentication, however if you must manually generate, refresh, or use Databricks OAuth access tokens, follow the instructions in this section. (they must be updated every hour)

### **Describe alternatives you've considered**
There are no serious alternatives to do M2M authentication with Metabase and databricks as of today. Thus, the current implementation forces users to utilise non-recommended methods by the vendor.

### **How important is this feature to you?**
Let's just say that using individual credentials to connect to Databases isn't exactly something I dream of......

### **Additional context**
There is an implementation of this already. Maybe we can just lift and shift the authentication part?
",AlexVialaBellander,2024-12-13 11:40:35+00:00,[],2025-01-15 08:01:19+00:00,2024-12-30 15:05:42+00:00,https://github.com/metabase/metabase/issues/51276,"[('.Security related', ''), ('Type:New Feature', ''), ('.Product/HighEnd', ''), ('Database/Databricks', '')]","[{'comment_id': 2541260664, 'issue_id': 2738198068, 'author': 'AlexVialaBellander', 'body': 'CC: @tetiana-kolmychek', 'created_at': datetime.datetime(2024, 12, 13, 11, 41, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2541369571, 'issue_id': 2738198068, 'author': 'AlexVialaBellander', 'body': '### Using Brigad\n> Credentials and details are not real \n\n<details>\n<summary>Click to expand / see image</summary>\n\n![Brigad Implementation](https://github.com/user-attachments/assets/0659dd81-862c-428d-b1ed-42f5cf318137)\n\n</details>\n\n---\n\n### Current Implementation (Official in Main)\n> Credentials and details are not real \n\n<details>\n<summary>Click to expand / see image</summary>\n\n![Official Implementation](https://github.com/user-attachments/assets/3b641f03-5ddd-4bca-8ea9-813c377e1a09)\n\n</details>', 'created_at': datetime.datetime(2024, 12, 13, 12, 39, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2541670990, 'issue_id': 2738198068, 'author': 'paoliniluis', 'body': '@AlexVialaBellander will you be able to make a PR adding that?', 'created_at': datetime.datetime(2024, 12, 13, 15, 13, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2547666590, 'issue_id': 2738198068, 'author': 'AlexVialaBellander', 'body': '@paoliniluis I can give it a try', 'created_at': datetime.datetime(2024, 12, 17, 7, 13, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2552146923, 'issue_id': 2738198068, 'author': 'AlexVialaBellander', 'body': 'I gave it a shot in #51476.\nWould be great if you could guide me in the process here.\nI tried it on our Databricks Servers and worked as expected.', 'created_at': datetime.datetime(2024, 12, 18, 19, 51, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2577702605, 'issue_id': 2738198068, 'author': 'AlexVialaBellander', 'body': '@nemanjaglumac @paoliniluis Hey :) When can we expect this in a release?', 'created_at': datetime.datetime(2025, 1, 8, 13, 42, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2577992524, 'issue_id': 2738198068, 'author': 'paoliniluis', 'body': ""@AlexVialaBellander got into master, so it's going to be shipped in 53 at least. I'm going to check with the team if we want to backport this to 52"", 'created_at': datetime.datetime(2025, 1, 8, 15, 42, 5, tzinfo=datetime.timezone.utc)}]","AlexVialaBellander (Issue Creator) on (2024-12-13 11:41:14 UTC): CC: @tetiana-kolmychek

AlexVialaBellander (Issue Creator) on (2024-12-13 12:39:58 UTC): ### Using Brigad

<details>
<summary>Click to expand / see image</summary>

![Brigad Implementation](https://github.com/user-attachments/assets/0659dd81-862c-428d-b1ed-42f5cf318137)

</details>

---

### Current Implementation (Official in Main)

<details>
<summary>Click to expand / see image</summary>

![Official Implementation](https://github.com/user-attachments/assets/3b641f03-5ddd-4bca-8ea9-813c377e1a09)

</details>

paoliniluis on (2024-12-13 15:13:11 UTC): @AlexVialaBellander will you be able to make a PR adding that?

AlexVialaBellander (Issue Creator) on (2024-12-17 07:13:35 UTC): @paoliniluis I can give it a try

AlexVialaBellander (Issue Creator) on (2024-12-18 19:51:02 UTC): I gave it a shot in #51476.
Would be great if you could guide me in the process here.
I tried it on our Databricks Servers and worked as expected.

AlexVialaBellander (Issue Creator) on (2025-01-08 13:42:22 UTC): @nemanjaglumac @paoliniluis Hey :) When can we expect this in a release?

paoliniluis on (2025-01-08 15:42:05 UTC): @AlexVialaBellander got into master, so it's going to be shipped in 53 at least. I'm going to check with the team if we want to backport this to 52

"
2737133817,issue,open,,Milestone 2,"- [ ]  Virtualize long lists if this improves performance
- [ ]  Tweak hovercard timings if necessary
- [ ]  Add empty state image for relationships tab",rafpaf,2024-12-13 00:35:39+00:00,[],2025-02-04 20:23:45+00:00,,https://github.com/metabase/metabase/issues/51261,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2737133551,issue,open,,Milestone 1,"
- [ ]  <s>Add ability to link to an arbitrary tab in a sidesheet (this will be needed for the model detail link)</s> [We're no longer keeping this link](https://metaboat.slack.com/archives/C084331FL8P/p1734113662010719?thread_ts=1734099295.728019&cid=C084331FL8P)
- [ ] Link to actions on initial model detail page",rafpaf,2024-12-13 00:35:22+00:00,[],2025-02-04 20:23:50+00:00,,https://github.com/metabase/metabase/issues/51260,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2737060873,issue,closed,completed,Feature Request: Eliminate pop-under bugs,"tl;dr: Pop-unders  where a modal (or some other overlay) unexpectedly shows up underneath another  are a persistent pain point for the embedding team. They're also a source of bugs and tech debt throughout the app.

---

Metabase uses lots of *overlays* - elements that float above the main content of the page. There are quite a few kinds of overlays: modals, popovers, hovercards, toasts, tooltips, and dropdowns. Two overlays can be visible at the same time. This makes ""pop-under"" bugs possible - where a new overlay opens _underneath_ an existing overlay and so cannot be seen or clicked on.

To prevent pop-under bugs, on master we set z-indexes on various overlays throughout the app. For example:

```ts
// in the LeaveConfirmation modal
<Modal zIndex={5}>

// in the useConfirmation hook
<Modal zIndex={CONFIRM_MODAL_Z_INDEX}>

// in the bulk actions toast styled component
export const BULK_ACTIONS_Z_INDEX = DEFAULT_POPOVER_Z_INDEX + 1;
export const BulkActionsToast = styled.div`
   z-index: ${BULK_ACTIONS_Z_INDEX};
`
```

But giving overlays hard-coded z-indexes makes unexpected interactions possible. For example, if clicking a button in a modal opens a toast, to ensure that the toast is above the modal, we've sometimes assigned the toast component a higher z-index than the modal. But what if, in another part of the app, that toast needs to launch a modal? Then the modal might show up underneath the toast.

We have several bugs like this: #45469, #45468, #49466, #50943, #50971.

Pop-under bugs have been a recurring headache for our embedding team. @oisincoveney told me: ""When creating features for the SDK, the timeline is significantly increased when we have to deal with these [pop-under] issues."" Since some overlays are incompatible with others, the team had to:
* use a legacy modal for static embedding because the Mantine modal conflicts with legacy popovers,
* delay a key feature in order to convert legacy popovers and dropdowns to the Mantine design system, and
* introduce two distinct portal containers because of the way that popovers and modals interacted.

To solve these issues, they've resorted to ad hoc solutions, like assigning distinct z-indexes.

This approach is not sustainable, for several reasons:
* As mentioned, z-indexes can interact unpredictably.
* These z-indexes are not presently customizable via the SDK. It wouldn't be feasible to let developers customize all of the various z-indexes we use.
* Each bad interaction between overlays must be discovered and solved one by one.",rafpaf,2024-12-12 23:23:02+00:00,['rafpaf'],2025-01-27 22:13:09+00:00,2024-12-17 17:48:19+00:00,https://github.com/metabase/metabase/issues/51256,"[('Type:Tech Debt', 'or Refactoring'), ('Type:Issue Cluster', 'An issue describing and linking to a cluster of similar or related issues')]",[],
2736991373,issue,open,,Search page isn't accessible from the Search Menu Unless there are Results,"### Describe the bug

If you search for an item you can navigate to the search page using the ""View and filter all XX results"" options. If there are no results there is no navigation to this page.

This is problematic if you want to search the Trash for items that aren't coming up in the search bar, for example. You can't toggle that filter on unless you first search for a term that returns records to get to the search page. Then run the search again with your toggles applied.

### To Reproduce

1. Save a question named ""eeeeeee""
2. Drop it in the trash
3. Try to search for it form the search bar

You can't find it and you can't navigate to the search page in order to search the Trash.

### Expected behavior

Search page should be accessible somehow

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres"",
      ""snowflake""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-12-03"",
      ""tag"": ""v1.51.6.5"",
      ""hash"": ""22b76e9""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.1 (Debian 15.1-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

annoying

### Additional context

Yo u an work around it by searching for an item that does exist in order to get to the page. You can also navigate directly to the search URL if you know how to.",ixipixi,2024-12-12 22:23:29+00:00,[],2025-02-05 18:50:01+00:00,,https://github.com/metabase/metabase/issues/51253,"[('Type:New Feature', ''), ('Organization/Search', ''), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2595926737, 'issue_id': 2736991373, 'author': 'luizarakaki', 'body': 'This will be resolved as part of [Resolve filtering on search (and decide what to do with full-page search)](https://www.notion.so/metabase/Resolve-filtering-on-search-and-decide-what-to-do-with-full-page-search-15969354c90180fd8b58de2409f22e06)', 'created_at': datetime.datetime(2025, 1, 16, 14, 48, tzinfo=datetime.timezone.utc)}]","luizarakaki on (2025-01-16 14:48:00 UTC): This will be resolved as part of [Resolve filtering on search (and decide what to do with full-page search)](https://www.notion.so/metabase/Resolve-filtering-on-search-and-decide-what-to-do-with-full-page-search-15969354c90180fd8b58de2409f22e06)

"
2736950018,issue,closed,completed,Handle Snowflake dropping support for user/pw auth,"https://www.notion.so/metabase/Handle-Snowflake-dropping-support-for-user-pw-auth-15469354c901803a86b8f764a5c2d55c?pvs=4

- [x] Make key-pair the default auth method.
- [x] Hide user/pw behind a toggle (similar to `Use hostname` / `Use account name` interaction).
- [x] If the user selects user/pw, show a warning banner in the connection page: ""Snowflake will soon block user and password authentication. [[Learn more](https://www.snowflake.com/en/blog/blocking-single-factor-password-authentification/)](https://www.snowflake.com/en/blog/blocking-single-factor-password-authentification/)
- This should also resolve https://github.com/metabase/metabase/issues/51057",snoe,2024-12-12 21:52:09+00:00,['snoe'],2025-01-08 18:03:25+00:00,2025-01-08 17:23:08+00:00,https://github.com/metabase/metabase/issues/51248,[],[],
2736710466,issue,open,,"Make it easier for Admins to know of problems with Sync, Scan and Fingerprint runs","**Is your feature request related to a problem? Please describe.**
Sometimes it can take a while for schemas to sync or for new tables to sync into Metabase. When there is an issue with the sync (permission error, for example) you have to dig through the logs to find it.

**Describe the solution you'd like**
It would be nice if this were more obviously surfaced or discoverable to Admins who may not immediately think to check for these types of issues. 

Possibly some iconography on the Database or Table Metadata pages to indicate that there was an error during sync, scan, etc to prompt an admin to research the issue. And/or an addition to ""Tools""?

",ixipixi,2024-12-12 19:26:10+00:00,[],2025-02-04 20:30:36+00:00,,https://github.com/metabase/metabase/issues/51240,"[('Administration/Metadata & Sync', ''), ('Type:New Feature', ''), ('Administration/Troubleshooting', '')]","[{'comment_id': 2569184094, 'issue_id': 2736710466, 'author': 'brunobergher', 'body': ""LeAnn, what's your take on proactive notifications (eg via email, like model persistency failures) for this stuff? Too noisy?"", 'created_at': datetime.datetime(2025, 1, 3, 12, 57, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2569571278, 'issue_id': 2736710466, 'author': 'ixipixi', 'body': '@brunobergher I feel like an option to enable/disable notifications for these would be amazing. Often we teach people how to go _look_ for these issues and they build operational processes around proactively checking for them. I think a simple option to choose between instant notifications or a scheduled digest every X hours would be clutch (even better if they can choose a notification target).', 'created_at': datetime.datetime(2025, 1, 3, 17, 23, 5, tzinfo=datetime.timezone.utc)}]","brunobergher on (2025-01-03 12:57:59 UTC): LeAnn, what's your take on proactive notifications (eg via email, like model persistency failures) for this stuff? Too noisy?

ixipixi (Issue Creator) on (2025-01-03 17:23:05 UTC): @brunobergher I feel like an option to enable/disable notifications for these would be amazing. Often we teach people how to go _look_ for these issues and they build operational processes around proactively checking for them. I think a simple option to choose between instant notifications or a scheduled digest every X hours would be clutch (even better if they can choose a notification target).

"
2736651278,issue,closed,completed,"Polish the ""save changes"" modal when creating a new question in a dashboard (copy and spacing)","[Figma](https://www.figma.com/design/YzWNe48JlYGjhmFFtoAdTy/Questions-in-Dashboards---open-questions-answers?node-id=7-132&node-type=frame&t=ktlWndQdYbotzNQJ-0)

[Slack](https://metaboat.slack.com/archives/C06RM2GEP5Z/p1731628557615359)",luizarakaki,2024-12-12 18:51:12+00:00,[],2025-01-27 22:12:58+00:00,2024-12-19 20:05:29+00:00,https://github.com/metabase/metabase/issues/51237,[],[],
2736261407,issue,closed,completed,[SDK] the sdk should not clash the redux context with the host app,"https://metaboat.slack.com/archives/C063Q3F1HPF/p1734017059223439

Possible solution: https://react-redux.js.org/api/hooks#custom-context

I did a quick brute force search and replace + some manual fixes in https://github.com/metabase/metabase/pull/51230 and here's the results:

- it's possible to create hooks that use the correct context 
- rtk can also be configured and works 
- `connect` is still used a lot, but that can also be configured 
- after the ""fixes"" some typing errors came up, I think it's because some enterprise code was using the untyped `useSelector` from `react-redux`, we probably need to create a `useEnterpriseSelector` as we did for `useSdkSelector`
- `redux-auth-wrapper` is hardcoded to use `connect` from `react-redux` and doesn't allow changing that , that branch is currently working around that by using the custom context only in the sdk, as we don't need components that rely on `redux-auth-wrapper` in the sdk at the moment.

The changes are also touching a lot of files, and will most likely need to be backported to 51 to be useful for sdk users. A codemod may be useful for that",npretto,2024-12-12 15:42:53+00:00,['npretto'],2024-12-19 12:21:44+00:00,2024-12-19 12:21:42+00:00,https://github.com/metabase/metabase/issues/51226,"[('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2553662512, 'issue_id': 2736261407, 'author': 'npretto', 'body': 'This was closed by https://github.com/metabase/metabase/pull/51382', 'created_at': datetime.datetime(2024, 12, 19, 12, 21, 42, tzinfo=datetime.timezone.utc)}]","npretto (Issue Creator) on (2024-12-19 12:21:42 UTC): This was closed by https://github.com/metabase/metabase/pull/51382

"
2735874865,issue,closed,completed,Remove `entity.ListLoader`,"TODO:
- [x] `entity.ListLoader`
- [x] UploadSettingsForm.tsx
- [x] ModelCacheRefreshJobs.tsx
- [x] CollectionContentView.tsx
- [x] CollectionItemsTable.tsx
- [x] QuestionList.tsx
- [x] SearchResults.jsx
- [x] SavedEntityList.tsx
- [x] SearchApp.jsx
",kamilmielnik,2024-12-12 13:15:21+00:00,['kamilmielnik'],2025-01-27 22:11:56+00:00,2025-01-14 08:06:52+00:00,https://github.com/metabase/metabase/issues/51215,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]",[],
2735857513,issue,closed,completed,Remove `entity.Loader`,"Blocks #50322

- [x] `PinnedQuestionLoader`
- [x] `LinkedEntityPicker`
- [x] `ParameterLinkedFilters`
- [x] `FieldMappingSelect`
- [x] `QuestionDataSource`
- [x] `containers/index.js`",kamilmielnik,2024-12-12 13:09:34+00:00,['kamilmielnik'],2025-01-27 22:13:24+00:00,2024-12-16 10:15:55+00:00,https://github.com/metabase/metabase/issues/51213,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]",[],
2735567977,issue,closed,not_planned,"""Permeability"" of customizable lists in filters","### Describe the bug

The personalized list in filters are ""permeable"" (we can still filter on other things that aren't in the personalized list)
Example : I want to share a dashboard with a client that has only access to a specific collection. In this dashboard I want to filter on his client name only. I'm thus creating a filter ""Client Name"", forcing the fact that the filter has to be filled. In the ""checklist"" I click on ""personalized list"" to propose only his client name. 
Unfortunately I discovered that, even if I forced the client name by personalizing the list, I can still write another client name, click on enter, and it will show the datas of the other clients. 
I'm aware that this isn't the most secure way to share a dashboard with a client, but it was just a use case to show the ""permeability"" of personalized list in filters. 


### To Reproduce

Unfortunately I deleted the Sample Database 
1. Go to a dashboard 
2. Click on new filter, create a filter category (example : ""Color""), click on the parameters of this filter
3. Scroll down to checklist, modify, personalized list
4. Imagine the 3 possibilities of your categories are ""Black, White, Purple"". Create a personalized list with only ""Black, White""
5. Validate your list, and the filter, save the dashboard
6. Click on the ""Color"" filter, write ""Purple"" and Enter 
7. You can select Purple and see the dashboard with the ""purple"" filter, which I wanted to avoid by personalizing my list with only ""Black, White""

### Expected behavior

The excepted behavior would be : if the client name isn't is the filter personalized list, we can't select it even if we are writting it fully. 

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""fr-FR"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""bigquery-cloud-sdk"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-04"",
      ""tag"": ""v0.51.2"",
      ""hash"": ""8bdb22c""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.2""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-1072-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

annoying 

### Additional context

_No response_",jadedurandv,2024-12-12 10:59:13+00:00,[],2025-01-03 16:44:37+00:00,2025-01-03 16:44:37+00:00,https://github.com/metabase/metabase/issues/51203,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2569465511, 'issue_id': 2735567977, 'author': 'ranquild', 'body': 'Filter widgets / field values is not a permission mechanism. For you case you might want to use sandboxing or database impersonalization.', 'created_at': datetime.datetime(2025, 1, 3, 16, 3, 16, tzinfo=datetime.timezone.utc)}]","ranquild on (2025-01-03 16:03:16 UTC): Filter widgets / field values is not a permission mechanism. For you case you might want to use sandboxing or database impersonalization.

"
2735192028,issue,closed,not_planned,I cannot query the newly inserted data between 4 am and 10 am,"### Describe the bug

I cannot query the newly inserted data between 4 am and 10 am

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""zh-CN"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Shanghai""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.37""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.3.8-1.el7.elrepo.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Shanghai""
  }
}
```

### Severity

Blocking mine usage of Metabase entirely

### Additional context

@luizarakaki ",airorair,2024-12-12 08:23:18+00:00,[],2024-12-12 12:08:29+00:00,2024-12-12 12:08:28+00:00,https://github.com/metabase/metabase/issues/51197,"[('Type:Bug', 'Product defects'), ('.Needs Triage', ''), ('.Needs Clarification', 'Issue is incomplete or missing actionable information.')]","[{'comment_id': 2538726584, 'issue_id': 2735192028, 'author': 'paoliniluis', 'body': ""This report does not meet the bare minimum criteria for us to be able to even start thinking what might be wrong. I'm closing this"", 'created_at': datetime.datetime(2024, 12, 12, 12, 8, 28, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-12 12:08:28 UTC): This report does not meet the bare minimum criteria for us to be able to even start thinking what might be wrong. I'm closing this

"
2734826322,issue,closed,not_planned,"Dashboard Filters based on entity name now show the dropdown of the entity ID, not the configured name","### Describe the bug

Hi Team

We haven't edited anything about this dashboard in a good while (months) but we're seeing an issue where filter dropdown name is displaying as the entity ID, where it used to be the name, and selecting the item fills the filter box with the correct name. Loom video of what we're seeing below, please comment / reach out for any more details.

Metabase cloud

https://www.loom.com/share/37c8041b122d4a56a2304752917bff2e?sid=dfa08c0a-55c9-4546-84ea-8e02b2964c18

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

We should be able to see the name of the entity we've configured - we used to be able to see this

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""starter"",
    ""version"": {
      ""date"": ""2024-12-03"",
      ""tag"": ""v1.51.6.5"",
      ""hash"": ""22b76e9""
    },
    ""settings"": {
      ""report-timezone"": ""Australia/Melbourne""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres""
  }
}
```

### Severity

Blocking some users from being able to configure dashboard filters

### Additional context

_No response_",ok200paul,2024-12-12 05:05:36+00:00,[],2025-01-21 07:18:27+00:00,2025-01-20 20:21:12+00:00,https://github.com/metabase/metabase/issues/51195,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2537911214, 'issue_id': 2734826322, 'author': 'romeovs', 'body': 'Hi @ok200paul, thanks for taking the time to report this bug! \n\nCould you confirm one thing for me?\nIn the video it shows ""Unknown Field"" for the fields mapped to this filter.\nWhat happens when you fix the mapping by pointing it to the correct field again and save the dashboard? Does the filter still show the raw numbers or does that fix the issue?', 'created_at': datetime.datetime(2024, 12, 12, 6, 18, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2537940148, 'issue_id': 2734826322, 'author': 'ok200paul', 'body': ""Hey @romeovs \n\nNo joy - image showing we've re-mapped:\n\n![Image](https://github.com/user-attachments/assets/be235ce6-2326-4347-9178-574e3dfb1263)"", 'created_at': datetime.datetime(2024, 12, 12, 6, 39, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2537940983, 'issue_id': 2734826322, 'author': 'ok200paul', 'body': 'Note that the 2nd filter was fine, so this is a little weird:\n\n![Image](https://github.com/user-attachments/assets/69d21f6d-5ad9-4ddf-80db-1128a7019163)', 'created_at': datetime.datetime(2024, 12, 12, 6, 40, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2537984497, 'issue_id': 2734826322, 'author': 'romeovs', 'body': 'And after this remapping the issue with the missing labels in the ""Select Agency"" filter still persists?', 'created_at': datetime.datetime(2024, 12, 12, 7, 9, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2538017866, 'issue_id': 2734826322, 'author': 'ok200paul', 'body': 'Sorry - should have been clearer! It does not: https://www.loom.com/share/a85898b1dd9d4cd2bf2c6176c2bd940f?sid=75a01052-2404-4ecf-9af5-f8d873eb705b', 'created_at': datetime.datetime(2024, 12, 12, 7, 31, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2587535334, 'issue_id': 2734826322, 'author': 'ixipixi', 'body': ""@ok200paul it looks like you're a cloud customer - would you please send in a support ticket as well? There are some other troubleshooting options we'd like to discuss."", 'created_at': datetime.datetime(2025, 1, 13, 16, 5, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2597827876, 'issue_id': 2734826322, 'author': 'romeovs', 'body': ""We've rolled out some changes to the dropdown filters in 51.11 that _might_ have fixed this issue."", 'created_at': datetime.datetime(2025, 1, 17, 9, 42, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2599258526, 'issue_id': 2734826322, 'author': 'ok200paul', 'body': ""Hey @ixipixi - sorry, busy week! A little more light on the subject as I've been able to grab some time to look at it more:\n\nWhen we configure a question that returns the table ID and name, it shows the ID only in the filter (where we configure it to be name)\n\n![Image](https://github.com/user-attachments/assets/2e042337-0144-4956-98e5-ece4f6e293c2)\n\n![Image](https://github.com/user-attachments/assets/a4b9bea0-3199-4b30-9960-1e1a3b724250)\n\nBut when we configure a question that returns the name _only_, the values populate\n\n![Image](https://github.com/user-attachments/assets/6b052b8a-e904-4dac-8ef0-bc9821e01777)\n\n![Image](https://github.com/user-attachments/assets/45d6ee88-99bd-429e-9d2e-d4285d76ef73)\n\n.. so maybe something to do with the filter automatically selecting the primary ID field or something?\n\n_____\nWe've reconfigured our reports to use the second option above as we needed to get the system back running as required.. unsure if I can provide any more deets on this one"", 'created_at': datetime.datetime(2025, 1, 17, 21, 38, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2603165014, 'issue_id': 2734826322, 'author': 'ranquild', 'body': 'Based on the loom and the last comment, I think what\'s happening is this:\n1. `can-get-card-values?` returns false, and the default logic for field values is run, returning just ids https://github.com/metabase/metabase/blob/84dc6f75ee753852e1b41419471e97b72c1bf489/src/metabase/models/params/custom_values.clj#L153\n2. assuming that the question is not archived (?), `qp.util/field->field-info` can return `false` when it fails to match a field ref from parameter dropdown configuration with the result metadata of the question. Most likely the underlying question was modified in a way that the field ref has changed.\n\nDepending on the changes made to the underlying question, the only way to ""fix"" this would be to reconfigure the dropdown source for this parameter. \n\nAnother thing that proves this theory is ""Unknown field"" errors in parameter mapping. While it\'s different mapping (parameter to dashboard cards, not the underlying parameter dropdown question to parameter) it might indicate that questions are often changed in a way that breaks their consumers.', 'created_at': datetime.datetime(2025, 1, 20, 20, 8, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2603179666, 'issue_id': 2734826322, 'author': 'ranquild', 'body': 'Closing this as a configuration issue. In a few words - if a question is changed in certain ways, you might need to update places where the question was used. For example, if you convert a ""Question"" to a ""SQL query"", it would break its consumers and they need to be manually updated. \n\n@ok200paul thanks for detailed feedback!', 'created_at': datetime.datetime(2025, 1, 20, 20, 21, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2603218100, 'issue_id': 2734826322, 'author': 'ok200paul', 'body': 'Thanks team! Your attention here has been really great, much appreciated.', 'created_at': datetime.datetime(2025, 1, 20, 20, 56, 12, tzinfo=datetime.timezone.utc)}]","romeovs on (2024-12-12 06:18:25 UTC): Hi @ok200paul, thanks for taking the time to report this bug! 

Could you confirm one thing for me?
In the video it shows ""Unknown Field"" for the fields mapped to this filter.
What happens when you fix the mapping by pointing it to the correct field again and save the dashboard? Does the filter still show the raw numbers or does that fix the issue?

ok200paul (Issue Creator) on (2024-12-12 06:39:43 UTC): Hey @romeovs 

No joy - image showing we've re-mapped:

![Image](https://github.com/user-attachments/assets/be235ce6-2326-4347-9178-574e3dfb1263)

ok200paul (Issue Creator) on (2024-12-12 06:40:18 UTC): Note that the 2nd filter was fine, so this is a little weird:

![Image](https://github.com/user-attachments/assets/69d21f6d-5ad9-4ddf-80db-1128a7019163)

romeovs on (2024-12-12 07:09:53 UTC): And after this remapping the issue with the missing labels in the ""Select Agency"" filter still persists?

ok200paul (Issue Creator) on (2024-12-12 07:31:05 UTC): Sorry - should have been clearer! It does not: https://www.loom.com/share/a85898b1dd9d4cd2bf2c6176c2bd940f?sid=75a01052-2404-4ecf-9af5-f8d873eb705b

ixipixi on (2025-01-13 16:05:29 UTC): @ok200paul it looks like you're a cloud customer - would you please send in a support ticket as well? There are some other troubleshooting options we'd like to discuss.

romeovs on (2025-01-17 09:42:13 UTC): We've rolled out some changes to the dropdown filters in 51.11 that _might_ have fixed this issue.

ok200paul (Issue Creator) on (2025-01-17 21:38:22 UTC): Hey @ixipixi - sorry, busy week! A little more light on the subject as I've been able to grab some time to look at it more:

When we configure a question that returns the table ID and name, it shows the ID only in the filter (where we configure it to be name)

![Image](https://github.com/user-attachments/assets/2e042337-0144-4956-98e5-ece4f6e293c2)

![Image](https://github.com/user-attachments/assets/a4b9bea0-3199-4b30-9960-1e1a3b724250)

But when we configure a question that returns the name _only_, the values populate

![Image](https://github.com/user-attachments/assets/6b052b8a-e904-4dac-8ef0-bc9821e01777)

![Image](https://github.com/user-attachments/assets/45d6ee88-99bd-429e-9d2e-d4285d76ef73)

.. so maybe something to do with the filter automatically selecting the primary ID field or something?

_____
We've reconfigured our reports to use the second option above as we needed to get the system back running as required.. unsure if I can provide any more deets on this one

ranquild on (2025-01-20 20:08:27 UTC): Based on the loom and the last comment, I think what's happening is this:
1. `can-get-card-values?` returns false, and the default logic for field values is run, returning just ids https://github.com/metabase/metabase/blob/84dc6f75ee753852e1b41419471e97b72c1bf489/src/metabase/models/params/custom_values.clj#L153
2. assuming that the question is not archived (?), `qp.util/field->field-info` can return `false` when it fails to match a field ref from parameter dropdown configuration with the result metadata of the question. Most likely the underlying question was modified in a way that the field ref has changed.

Depending on the changes made to the underlying question, the only way to ""fix"" this would be to reconfigure the dropdown source for this parameter. 

Another thing that proves this theory is ""Unknown field"" errors in parameter mapping. While it's different mapping (parameter to dashboard cards, not the underlying parameter dropdown question to parameter) it might indicate that questions are often changed in a way that breaks their consumers.

ranquild on (2025-01-20 20:21:12 UTC): Closing this as a configuration issue. In a few words - if a question is changed in certain ways, you might need to update places where the question was used. For example, if you convert a ""Question"" to a ""SQL query"", it would break its consumers and they need to be manually updated. 

@ok200paul thanks for detailed feedback!

ok200paul (Issue Creator) on (2025-01-20 20:56:12 UTC): Thanks team! Your attention here has been really great, much appreciated.

"
2734279291,issue,closed,completed,Cannot Filter on UUID ID Columns in SQL Server / Azure Synapse,"### Describe the bug

Cannot filter on any UUID columns in azure synapse. Receive the error:
""Unsupported parameter type found while parsing RPC request. The request has been terminated.""

From the GUI editor you can get this error by applying a filter. But if you take the generated SQL and run it directly from the native editor it works.

### To Reproduce

Haven't been able to repro outside the customer instance yet. Tried setting up a local test with SQL server but had no luck. it's unclear if the fact that these are UUIDs is specifically relevant.

### Expected behavior

Filtering should work.

### Logs

Added diagnostic export to Slack:
https://metaboat.slack.com/archives/C05NXACAG1G/p1733961071267499

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""sqlserver""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""starter"",
    ""version"": {
      ""date"": ""2024-12-03"",
      ""tag"": ""v1.51.6.5"",
      ""hash"": ""22b76e9""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Amsterdam""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres""
  }
}
```

### Severity

hindering use of several dashboards

### Additional context

_No response_",ixipixi,2024-12-11 23:51:00+00:00,['wzimrin'],2024-12-23 14:15:30+00:00,2024-12-20 15:48:57+00:00,https://github.com/metabase/metabase/issues/51189,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Database/SQLServer', None), ('Querying/Processor', ''), ('.Escalation', ''), ('.Team/Querying', '')]",[],
2734026375,issue,closed,completed,Prevent the comment backport command from creating and merging a PR if the original one has not been merged,"**Context**

[Slack convo](https://metaboat.slack.com/archives/C864UT5CZ/p1733946606880249)
The `@metabase-bot backport` command should not immediately backport a PR if the original PR has not been merged.",alxnddr,2024-12-11 21:06:57+00:00,['alxnddr'],2025-01-31 01:18:45+00:00,2025-01-31 01:18:44+00:00,https://github.com/metabase/metabase/issues/51185,"[('Type:Tech Debt', 'or Refactoring'), ('.Task', 'Not a part of any Epic, used by the Task Issue Template')]","[{'comment_id': 2626075235, 'issue_id': 2734026375, 'author': 'alxnddr', 'body': 'Closed by https://github.com/metabase/metabase/pull/51242', 'created_at': datetime.datetime(2025, 1, 31, 1, 18, 44, tzinfo=datetime.timezone.utc)}]","alxnddr (Issue Creator) on (2025-01-31 01:18:44 UTC): Closed by https://github.com/metabase/metabase/pull/51242

"
2733704236,issue,closed,completed,"Fix failing e2e test: dashboard-questions.cy.spec.js / ""can archive and unarchive a dashboard with cards saved inside it""","This is consistently failing, for example here: https://github.com/metabase/metabase/actions/runs/12281492548/job/34272787919",rafpaf,2024-12-11 18:36:46+00:00,['rafpaf'],2024-12-13 16:47:53+00:00,2024-12-13 16:47:51+00:00,https://github.com/metabase/metabase/issues/51178,"[('.CI & Tests', ''), ('flaky-test-fix', '')]","[{'comment_id': 2541848169, 'issue_id': 2733704236, 'author': 'iethree', 'body': 'resolved by https://github.com/metabase/metabase/pull/51182', 'created_at': datetime.datetime(2024, 12, 13, 16, 47, 51, tzinfo=datetime.timezone.utc)}]","iethree on (2024-12-13 16:47:51 UTC): resolved by https://github.com/metabase/metabase/pull/51182

"
2733674145,issue,closed,completed,Better handling of broken database connections,"Context thread: https://metaboat.slack.com/archives/C010L1Z4F9S/p1733861342280199

Snowflake logging was updated to indicate each time an unauthorized database connection was attempted. This revealed a potential problem in our connection pool.

[This is the relevant document](https://www.mchange.com/projects/c3p0/#configuring_recovery)
What's going on: What we have are saved, configured databases in metabase where the credentials/account/etc changed out from under us and the database connection is no longer valid. This is not specific to snowflake.

By default our connection pool will retry getting a connection 30 times with a 1 second interval. It is during this internal c3p0 pool process that these snowflake logs are being generated. The exception is not surfaced to our code until after the final retry.
Our field values sync is particularly troublesome and seen in these logs because we try to get a new connection for each field and so we get minutes, or hours of retries.

Proposal 1: I think changing the pool to fail faster with an acquireRetryAttempts of  1 or 2 would be a good idea. It means that users will get faster feedback if their credentials have changed and our automated processes won't heat the world so much. The downside is that if a database is legitimately restarting, then queries during the restart wont continue to retry and will more likely fail.

Proposal 2: Verify the connection outside of the pool (same as we do when adding a db) before sync tasks and only proceed if it's successful.
The downside is that if users are trying to run queries /look at dashboards for these dbs the same retries will happen and they'll be sitting there for a 30+s until the pool surfaces an error.

Hotfix to quiet logging.
https://github.com/metabase/metabase/pull/51138",snoe,2024-12-11 18:20:27+00:00,['snoe'],2025-01-08 18:04:14+00:00,2025-01-08 17:22:27+00:00,https://github.com/metabase/metabase/issues/51176,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2733646875,issue,open,,BigQuery - filtering by value does not work on timestamps with fractional seconds,"### Describe the bug

Filtering fails on timestamps with fractional seconds as BigQuery timestamps have microsecond precision (6 decimals), while the generated timestamp literal for filtering only includes 3 decimal places.



### To Reproduce

1. Use BigQuery and create a native model: 
```select
  timestamp '2024-12-11 16:23:55.123456 UTC' col_timestamp,
  datetime '2024-12-11T16:23:55.123456' col_datetime,
  date '2024-12-11' col_date
```

2. Click on the results, and filter on the value of the timestamp column

3. See the error: empty results are returned

The generated SQL:
```
SELECT
  `source`.`col_timestamp` AS `col_timestamp`,
  `source`.`col_datetime` AS `col_datetime`,
  `source`.`col_date` AS `col_date`
FROM
  (
    select
      timestamp '2024-12-11 16:23:55.123456 UTC' col_timestamp,
      datetime '2024-12-11T16:23:55.123456' col_datetime,
      date '2024-12-11' col_date
  ) AS `source`
WHERE
  `source`.`col_timestamp` = timestamp ""2024-12-11 16:23:55.123Z""
```

### Expected behavior

It should work.

### Logs

_No response_

### Information about your Metabase installation

```JSON
v1.51, seen in 1.49 as well.
```

### Severity

Reported by a Pro customer

### Additional context

_No response_",zbodi74,2024-12-11 18:08:05+00:00,[],2025-02-04 20:27:47+00:00,,https://github.com/metabase/metabase/issues/51175,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('Database/BigQuery', ''), ('.Backend', ''), ('.Team/Querying', '')]",[],
2733609319,issue,closed,completed,'Filter by this date' - incorrect / confusing behavior when used on datetime fields,"### Describe the bug

Filtering by the value of a datetime or timestamp field can be confusing due to the way the options are presented.
The popup menu is titled 'Filter by this date':
<img width=""275"" alt=""Image"" src=""https://github.com/user-attachments/assets/6edf31d2-7ec9-4697-a5d6-0db0d3017028"" />

however, when the 'On' option is selected, it filters by both the date and the exact time:
<img width=""259"" alt=""Image"" src=""https://github.com/user-attachments/assets/0f8d7bc4-ff5e-43bb-ac5e-17bbd152caf7"" />

The generated criteria is not a date range but an exact match:
`""source"".""col_timestamp"" = timestamp '2024-12-11 16:23:55.123'`

This is incorrect, as the option was to filter by '_date_', and the '_on_' condition was selected. A user who filters on a date would expect all records from that date to appear.

While it is possible to adjust the filter to exclude the time component, this is only available after the filter has already been added and the user has seen the incorrect result set:
<img width=""277"" alt=""Image"" src=""https://github.com/user-attachments/assets/a2757a51-5ffe-49cd-9663-7cf0a0123c52"" />

### To Reproduce

1. Create a native model with a date and timestamp field, save it. For example on the sample database:
```
select
 timestamp '2024-12-11 16:23:55.123 UTC' col_timestamp,
 date '2024-12-11' col_date
union all
 select
  timestamp '2024-12-11 00:00:00 UTC' col_timestamp,
  date '2024-12-11' col_date
```

2. Query the model
3. Click on the non-midnight timestamp value, and see the popup, worded as: Filter by this date
4. Select 'On'
5. Only one record will appear as the generated WHERE clause is 
`""source"".""col_timestamp"" = timestamp '2024-12-11 16:23:55.123'`



### Expected behavior

Ideally, the context menu should also offer to filter only by the date component.

But at the minimum, the wording of the context menu should better reflect what is going to happen:
- _Filter by this date_ should rather be _Filter by this date and time_
- _On_ --> _At_
- _Not On_ --> _Not At_

### Logs

_No response_

### Information about your Metabase installation

```JSON
v1.51.6
```

### Severity

Reported by a pro customer. Incorrect / confusing behavior and the workaround is annoying.

### Additional context

_No response_",zbodi74,2024-12-11 17:48:41+00:00,['ranquild'],2025-01-08 01:13:08+00:00,2025-01-07 14:53:46+00:00,https://github.com/metabase/metabase/issues/51172,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Frontend', ''), ('.Backend', ''), ('Querying/Drill Thrus', 'Refining existing queries with Drill Thrus'), ('.Team/Querying', '')]","[{'comment_id': 2538438313, 'issue_id': 2733609319, 'author': 'mngr', 'body': 'Yes, for the columns with both date and time the copy should be ""Filter by this date and time""', 'created_at': datetime.datetime(2024, 12, 12, 10, 7, 25, tzinfo=datetime.timezone.utc)}]","mngr on (2024-12-12 10:07:25 UTC): Yes, for the columns with both date and time the copy should be ""Filter by this date and time""

"
2733529590,issue,closed,completed,Update in-dashboard question creation flow (Kyle design),https://www.figma.com/design/XVoU2cfo33QnvYoY2Nrc6K/Dashboard-add-flow---questions-in-dashboards?node-id=0-1&node-type=canvas&t=McM8B4KXxhawNIbl-0,luizarakaki,2024-12-11 17:11:55+00:00,['sloansparger'],2025-01-27 22:13:00+00:00,2024-12-19 16:02:30+00:00,https://github.com/metabase/metabase/issues/51169,[],[],
2733333790,issue,open,,Allow Offset to be Changed with Time Grouping Change,"**Is your feature request related to a problem? Please describe.**
In my dashboard I would like to use it with a simple trend chart that shows the total orders in our shop. It should compare the current (daily or weekly) number to the previous period (previous day or week) and to the previous year (same day or week last year). The comparison to last period is no problem as this changes according to the time grouping filter. But for the YoY comparison I used the offset function.

If we use the time grouping parameter to change the granularity the offset no longer make sense.

**Describe the solution you'd like**
Some way to convert the offset to the appropriate value or set a different offset for different time granularities.

**How important is this feature to you?**
Important - there isn't a way to do use these in conjunction in a way that makes sense. 

",ixipixi,2024-12-11 15:46:38+00:00,[],2025-02-04 20:30:56+00:00,,https://github.com/metabase/metabase/issues/51167,"[('Type:New Feature', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('Querying/Notebook/Custom Expression', '')]","[{'comment_id': 2545628855, 'issue_id': 2733333790, 'author': 'thebiglabasky', 'body': ""Is it fair to say that the Window function is the technical way to do the query yet not the thing people actually care about: they want to compare something with a given equivalent in the past and that's it right?"", 'created_at': datetime.datetime(2024, 12, 16, 13, 25, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2549867627, 'issue_id': 2733333790, 'author': 'ixipixi', 'body': '@thebiglabasky yes. They want the trend to always compare to an equivalent period.', 'created_at': datetime.datetime(2024, 12, 17, 23, 21, 19, tzinfo=datetime.timezone.utc)}, {'comment_id': 2560326327, 'issue_id': 2733333790, 'author': 'mngr', 'body': ""Yes, we don't have a good solution for this atm, but it's in my backlog"", 'created_at': datetime.datetime(2024, 12, 23, 21, 39, 44, tzinfo=datetime.timezone.utc)}]","thebiglabasky on (2024-12-16 13:25:29 UTC): Is it fair to say that the Window function is the technical way to do the query yet not the thing people actually care about: they want to compare something with a given equivalent in the past and that's it right?

ixipixi (Issue Creator) on (2024-12-17 23:21:19 UTC): @thebiglabasky yes. They want the trend to always compare to an equivalent period.

mngr on (2024-12-23 21:39:44 UTC): Yes, we don't have a good solution for this atm, but it's in my backlog

"
2733102918,issue,open,,A solution to visualize incomplete data,"**Is your feature request related to a problem? Please describe.**
A feature I miss in many of my metabase charts is some indication that specific data is incomplete like the most recent week. The most practical example is looking at something like a 7 day conversion rate on a weekly basis. Because conversions can be counted up to 7 days after account create when accounting for a 7 day trial, the most recent week is always incomplete data.

**Describe the solution you'd like**
Other analytics tools we use have a mechanism to color that section of the line or bar a unique color or perhaps to make the last portion of the line dotted. For a tool like metabase it's possible what I'm asking is merely choosing the color or customized visual of a data point based on a value like a bool in the same row.

**Describe alternatives you've considered**
In dashboards I often create two charts. Last 24 weeks not including the current week and a separate This Week. This helps provide context for incomplete data. but it's imperfect. Because depending on the timeframe, even last week's data can be incomplete depending on the window the data settles.

**How important is this feature to you?**
This feature is a nice to have. The data we show is not incorrect, it's just lacking context. Having this feature would prevent a constant need to say ""the most recent X is incomplete"".

**Additional context**
This is an example looking at weekly retention data. Each week has different windows for data being considered complete. The dotted visual makes it easy to tell at a glance which data is set and which data is still counting.
<img width=""1205"" alt=""Image"" src=""https://github.com/user-attachments/assets/7e769a43-edf5-41af-ad95-50f6777d6b8d"" />

",EmperiorEric,2024-12-11 14:16:44+00:00,[],2025-02-04 20:31:21+00:00,,https://github.com/metabase/metabase/issues/51160,"[('Type:New Feature', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2567853497, 'issue_id': 2733102918, 'author': 'brunobergher', 'body': 'Related to #13762', 'created_at': datetime.datetime(2025, 1, 2, 14, 24, 22, tzinfo=datetime.timezone.utc)}]","brunobergher on (2025-01-02 14:24:22 UTC): Related to #13762

"
2732940977,issue,open,,Tootlips for table visualization,"**Describe the solution you'd like**
In a table visualisation of communications, show the communication content in a popup/tooltip when hovering on the subject. All these data are available in the question.

In other words, on a table visualisation, be able to set an available ""stringable"" field as a tooltip to show when hovering the data. Could be set in the same place than column title and view as Text/Link, with a ""related"" field selector which, when set, would tell to show the content of this related field as a tooltip for this data.

**Describe alternatives you've considered**
Add this feature from navigator content script plugin.

**How important is this feature to you?**
Great to have !
",e-gaulue,2024-12-11 13:09:57+00:00,[],2025-02-04 20:31:57+00:00,,https://github.com/metabase/metabase/issues/51157,"[('Type:New Feature', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations'), ('Visualization/Tooltips', '')]",[],
2732412372,issue,closed,completed,No error shown when failed to move question to a dashboard,"### Describe the bug

https://github.com/user-attachments/assets/2995f524-366f-462b-97f5-ce63f92b47da


### To Reproduce

Not sure about exact steps. But I had a question that is present in multiple dashboards and I tried to move it to another dashboard.

### Expected behavior

1. Error is shown to the user if request fails.
2. Maybe the request should succeed? Unclear.

### Information about your Metabase installation

master, ce493525897de71415ad3fc666c0da80eadd756d


### Severity

P2
",kamilmielnik,2024-12-11 09:51:36+00:00,['npfitz'],2025-01-27 22:13:36+00:00,2024-12-12 13:46:19+00:00,https://github.com/metabase/metabase/issues/51150,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Organization/Saved Questions', ''), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2732338290,issue,open,,Allow users to set the full hostname when connecting to Athena,"**Is your feature request related to a problem? Please describe.**
When connecting to Athena database from a Metabase hosted in a VPC private subnet, it try to connect to public endoint""_//athena.{region}:443_"".
Cf. [endpoint construction in code](https://github.com/metabase/metabase/blob/219ca91f6d676e726775439334814866ca6e4e39/modules/drivers/athena/src/metabase/driver/athena.clj#L62)

Thus, the network request will be fowarded to NAT instance, which imply : 
- We have to open outbound port 444 on NAT instance to public internet
- Connection (and maybe result set streaming ?) pass through public networks (even if flux is encrypted)
- Maybe some bad performance even if I think that AWS have done some optimization when outbound request target some of their internal servcies

**Describe the solution you'd like**
In the configuration screen of the database, it could be helpful to indicate a VPC_ENDPOINT_ID allowing to target athena from private subnet without the need of NAT and port opening to public network.
According to [this helper](https://aws.amazon.com/fr/blogs/architecture/field-notes-restricting-amazon-workspaces-users-to-run-amazon-athena-queries/) step 4, the final endpoint will look like _VPC_Endpoint_ID.athena.Region.vpce.amazonaws.com_

**Describe alternatives you've considered**
Alternative is the current behavior, connecting to Athena through public endpoint.

**How important is this feature to you?**
It is a security and performance feature but it is not blocking so medium priority.

**Additional context**
No additional context.",AntoineDuComptoirDesPharmacies,2024-12-11 09:20:11+00:00,[],2025-02-04 20:31:04+00:00,,https://github.com/metabase/metabase/issues/51149,"[('Type:New Feature', ''), ('Administration/Auth', 'Google Auth, LDAP, pw+email login'), ('Database/Athena', '')]","[{'comment_id': 2536643302, 'issue_id': 2732338290, 'author': 'paoliniluis', 'body': 'If we allow users to input the entire hostname will this work? @AntoineDuComptoirDesPharmacies ?', 'created_at': datetime.datetime(2024, 12, 11, 17, 30, 30, tzinfo=datetime.timezone.utc)}, {'comment_id': 2538179674, 'issue_id': 2732338290, 'author': 'AntoineDuComptoirDesPharmacies', 'body': 'You are right, this seems to be another viable solution !', 'created_at': datetime.datetime(2024, 12, 12, 8, 29, 50, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-11 17:30:30 UTC): If we allow users to input the entire hostname will this work? @AntoineDuComptoirDesPharmacies ?

AntoineDuComptoirDesPharmacies (Issue Creator) on (2024-12-12 08:29:50 UTC): You are right, this seems to be another viable solution !

"
2731639234,issue,closed,not_planned,"The database has data, but the data cannot be queried #50844 The problem is not solved","### Describe the bug

**The database has data, but the data cannot be queried**


**Scheduling Information**
Quartz Scheduler (v2.3.2) 'MetabaseScheduler' with instanceId '63af93c7655e1733814611104'
  Scheduler class: 'org.quartz.impl.StdScheduler' - running locally.
  Running since: Tue Dec 10 15:10:11 CST 2024
  Not currently in standby mode.
  Number of jobs executed: 119
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.impl.jdbcjobstore.JobStoreTX' - which supports persistence. and is clustered.





### To Reproduce

Data not updated

### Expected behavior

Timely update data

### Logs

**ERROR:**
[405e48a2-a278-449e-a5a0-74cf6a1f33cf] 2024-12-11T09:59:52+08:00 ERROR metabase.driver.sql-jdbc.execute Failed to set timezone 'Asia/Shanghai' for :mysql database,java.sql.SQLTransientConnectionException: (conn=490868607) Unknown or incorrect time zone: 'Asia/Shanghai',	at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.createException(ExceptionFactory.java:79),	at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.create(ExceptionFactory.java:158),	at org.mariadb.jdbc.MariaDbStatement.executeExceptionEpilogue(MariaDbStatement.java:262),	at org.mariadb.jdbc.MariaDbStatement.executeInternal(MariaDbStatement.java:362),	at org.mariadb.jdbc.MariaDbStatement.execute(MariaDbStatement.java:500),	at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75),	at metabase.driver.sql_jdbc.execute$set_time_zone_if_supported_BANG_.invokeStatic(execute.clj:224),	at metabase.driver.sql_jdbc.execute$set_time_zone_if_supported_BANG_.invoke(execute.clj:209),	at metabase.driver.sql_jdbc.execute$set_default_connection_options_BANG_87296__87298.invokeStatic(execute.clj:351),	at metabase.driver.sql_jdbc.execute$set_default_connection_options_BANG_87296__87298.invoke(execute.clj:340),	at metabase.driver.sql_jdbc.execute$fn__87322$fn__87323.invoke(execute.clj:397),	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87292__87293.invokeStatic(execute.clj:338),	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87292__87293.invoke(execute.clj:321),	at metabase.driver.sql_jdbc.execute$fn__87322.invokeStatic(execute.clj:392),	at metabase.driver.sql_jdbc.execute$fn__87322.invoke(execute.clj:390),	at clojure.lang.MultiFn.invoke(MultiFn.java:244),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694),	at metabase.driver.sql_jdbc$fn__115546.invokeStatic(sql_jdbc.clj:79),	at metabase.driver.sql_jdbc$fn__115546.invoke(sql_jdbc.clj:77),	at clojure.lang.MultiFn.invoke(MultiFn.java:244),	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52),	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39),	at metabase.query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102),	at metabase.query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95),	at metabase.query_processor.execute$run.invokeStatic(execute.clj:62),	at metabase.query_processor.execute$run.invoke(execute.clj:56),	at metabase.query_processor.middleware.update_used_cards$update_used_cards_BANG_75880__75881$fn__75882.invoke(update_used_cards.clj:60),	at metabase.query_processor.execute$add_native_form_to_result_metadata$fn__75897.invoke(execute.clj:25),	at metabase.query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__75903.invoke(execute.clj:36),	at metabase.query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___75853.invoke(cache.clj:241),	at metabase.query_processor.middleware.permissions$check_query_permissions$fn__72558.invoke(permissions.clj:148),	at metabase.query_processor.middleware.enterprise$check_download_permissions_middleware$fn__73279.invoke(enterprise.clj:51),	at metabase.query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__73289.invoke(enterprise.clj:64),	at metabase.query_processor.execute$execute75930__75931$fn__75932.invoke(execute.clj:94),	at metabase.query_processor.setup$do_with_qp_setup73804__73805.invokeStatic(setup.clj:225),	at metabase.query_processor.setup$do_with_qp_setup73804__73805.invoke(setup.clj:216),	at metabase.query_processor.execute$execute75930__75931.invokeStatic(execute.clj:93),	at metabase.query_processor.execute$execute75930__75931.invoke(execute.clj:89),	at metabase.query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49),	at metabase.query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44),	at metabase.query_processor.middleware.enterprise$fn__73306$handle_audit_app_internal_queries__73307$fn__73309.invoke(enterprise.clj:96),	at metabase.query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__73317.invoke(enterprise.clj:103),	at metabase.query_processor.middleware.process_userland_query$process_userland_query_middleware78355__78356$fn__78357.invoke(process_userland_query.clj:191),	at metabase.query_processor.middleware.catch_exceptions$catch_exceptions78420__78421$fn__78422.invoke(catch_exceptions.clj:125),	at metabase.query_processor$process_query78461__78462$fn__78463.invoke(query_processor.clj:80),	at metabase.query_processor.setup$do_with_canceled_chan73799__73800$fn__73801.invoke(setup.clj:189),	at metabase.query_processor.setup$do_with_database_local_settings73792__73793$fn__73794.invoke(setup.clj:181),	at metabase.query_processor.setup$do_with_driver73785__73786$fn__73787$fn__73788.invoke(setup.clj:166),	at metabase.driver$do_with_driver.invokeStatic(driver.clj:106),	at metabase.driver$do_with_driver.invoke(driver.clj:101),	at metabase.query_processor.setup$do_with_driver73785__73786$fn__73787.invoke(setup.clj:165),	at metabase.query_processor.setup$do_with_metadata_provider73776__73777$fn__73778$fn__73781.invoke(setup.clj:151),	at metabase.query_processor.store$do_with_metadata_provider59754__59755.invokeStatic(store.clj:170),	at metabase.query_processor.store$do_with_metadata_provider59754__59755.invoke(store.clj:150),	at metabase.query_processor.store$do_with_metadata_provider59754__59755.invokeStatic(store.clj:159),	at metabase.query_processor.store$do_with_metadata_provider59754__59755.invoke(store.clj:150),	at metabase.query_processor.setup$do_with_metadata_provider73776__73777$fn__73778.invoke(setup.clj:150),	at metabase.query_processor.setup$do_with_resolved_database73766__73767$fn__73768.invoke(setup.clj:128),	at metabase.query_processor.setup$do_with_qp_setup73804__73805.invokeStatic(setup.clj:232),	at metabase.query_processor.setup$do_with_qp_setup73804__73805.invoke(setup.clj:216),	at metabase.query_processor$process_query78461__78462.invokeStatic(query_processor.clj:78),	at metabase.query_processor$process_query78461__78462.invoke(query_processor.clj:71),	at metabase.db.metadata_queries$table_query.invokeStatic(metadata_queries.clj:66),	at metabase.db.metadata_queries$table_query.invoke(metadata_queries.clj:57),	at metabase.models.field_values$distinct_values.invokeStatic(field_values.clj:378),	at metabase.models.field_values$distinct_values.invoke(field_values.clj:364),	at metabase.models.field_values$create_or_update_full_field_values_BANG_.invokeStatic(field_values.clj:445),	at metabase.models.field_values$create_or_update_full_field_values_BANG_.doInvoke(field_values.clj:436),	at clojure.lang.RestFn.invoke(RestFn.java:442),	at metabase.sync.field_values$update_field_values_for_field_BANG_93470__93471.invokeStatic(field_values.clj:32),	at metabase.sync.field_values$update_field_values_for_field_BANG_93470__93471.invoke(field_values.clj:25),	at metabase.sync.field_values$update_field_values_for_table_BANG_93480__93481$fn__93482$fn__93483.invoke(field_values.clj:57),	at metabase.sync.util$do_with_error_handling.invokeStatic(util.clj:191),	at metabase.sync.util$do_with_error_handling.invoke(util.clj:184),	at metabase.sync.field_values$update_field_values_for_table_BANG_93480__93481$fn__93482.invoke(field_values.clj:55),	at clojure.lang.PersistentVector.reduce(PersistentVector.java:418),	at clojure.core$reduce.invokeStatic(core.clj:6964),	at clojure.core$reduce.invoke(core.clj:6947),	at metabase.sync.field_values$update_field_values_for_table_BANG_93480__93481.invokeStatic(field_values.clj:54),	at metabase.sync.field_values$update_field_values_for_table_BANG_93480__93481.invoke(field_values.clj:51),	at clojure.core$map$fn__5950$fn__5951.invoke(core.clj:2759),	at clojure.core$completing$fn__8558.invoke(core.clj:7010),	at clojure.core$map$fn__5950$fn__5951.invoke(core.clj:2759),	at toucan2.pipeline$with_init$fn__22864.invoke(pipeline.clj:327),	at clojure.core$completing$fn__8558.invoke(core.clj:7010),	at clojure.core$map$fn__5950$fn__5951.invoke(core.clj:2759),	at toucan2.jdbc.result_set$reduce_result_set.invokeStatic(result_set.clj:156),	at toucan2.jdbc.result_set$reduce_result_set.invoke(result_set.clj:125),	at toucan2.jdbc.query$reduce_jdbc_query.invokeStatic(query.clj:51),	at toucan2.jdbc.query$reduce_jdbc_query.invoke(query.clj:22),	at toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default.invokeStatic(pipeline.clj:19),	at toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default.invoke(pipeline.clj:9),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:15),	at methodical.impl.combo.threaded$combine_methods_thread_last$fn__19698$combined_method_thread_last__19699.invoke(threaded.clj:64),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:65),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:216),	at toucan2.pipeline$transduce_execute$with_connection_STAR___22784.invoke(pipeline.clj:78),	at toucan2.connection$bind_current_connectable_fn$fn__22461.invoke(connection.clj:104),	at toucan2.connection$bind_current_connectable_fn$fn__22461.invoke(connection.clj:104),	at toucan2.connection$bind_current_connectable_fn$fn__22461.invoke(connection.clj:104),	at toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource.invokeStatic(connection.clj:18),	at toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource.invoke(connection.clj:15),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210),	at metabase.db.connection$do_with_connection_primary_method_default.invokeStatic(connection.clj:132),	at metabase.db.connection$do_with_connection_primary_method_default.invoke(connection.clj:130),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210),	at toucan2.connection$do_with_connection_primary_method_.invokeStatic(connection.clj:204),	at toucan2.connection$do_with_connection_primary_method_.invoke(connection.clj:194),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210),	at toucan2.pipeline$transduce_execute.invokeStatic(pipeline.clj:77),	at toucan2.pipeline$transduce_execute.invoke(pipeline.clj:64),	at clojure.lang.Var.invoke(Var.java:401),	at toucan2.pipeline$transduce_compiled_query.invokeStatic(pipeline.clj:244),	at toucan2.pipeline$transduce_compiled_query.invoke(pipeline.clj:240),	at toucan2.pipeline$transduce_built_query.invokeStatic(pipeline.clj:252),	at toucan2.pipeline$transduce_built_query.invoke(pipeline.clj:246),	at toucan2.pipeline$transduce_query_primary_method_default.invokeStatic(pipeline.clj:272),	at toucan2.pipeline$transduce_query_primary_method_default.invoke(pipeline.clj:269),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:15),	at methodical.impl.combo.threaded$combine_methods_thread_last$fn__19698$combined_method_thread_last__19699.invoke(threaded.clj:64),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:65),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:216),	at toucan2.pipeline$transduce_query_STAR_.invokeStatic(pipeline.clj:278),	at toucan2.pipeline$transduce_query_STAR_.invoke(pipeline.clj:274),	at toucan2.pipeline$transduce_with_model.invokeStatic(pipeline.clj:293),	at toucan2.pipeline$transduce_with_model.invoke(pipeline.clj:280),	at toucan2.pipeline$transduce_parsed.invokeStatic(pipeline.clj:309),	at toucan2.pipeline$transduce_parsed.invoke(pipeline.clj:295),	at toucan2.pipeline$transduce_unparsed.invokeStatic(pipeline.clj:317),	at toucan2.pipeline$transduce_unparsed.invoke(pipeline.clj:311),	at clojure.lang.AFn.applyToHelper(AFn.java:160),	at clojure.lang.AFn.applyTo(AFn.java:144),	at clojure.core$apply.invokeStatic(core.clj:669),	at clojure.core$apply.invoke(core.clj:662),	at toucan2.pipeline$reducible_fn$reify__22884.reduce(pipeline.clj:386),	at clojure.core$transduce.invokeStatic(core.clj:7025),	at clojure.core.Eduction.reduce(core.clj:7874),	at clojure.core$transduce.invokeStatic(core.clj:7025),	at clojure.core$transduce.invokeStatic(core.clj:7021),	at clojure.core$transduce.invoke(core.clj:7012),	at metabase.sync.field_values$update_field_values_for_database_BANG_93487__93488.invokeStatic(field_values.clj:66),	at metabase.sync.field_values$update_field_values_for_database_BANG_93487__93488.invoke(field_values.clj:63),	at clojure.lang.AFn.applyToHelper(AFn.java:154),	at clojure.lang.AFn.applyTo(AFn.java:144),	at clojure.core$apply.invokeStatic(core.clj:669),	at clojure.core$apply.invoke(core.clj:662),	at metabase.sync.util$run_step_with_metadata63542__63544$fn__63546$fn__63549.invoke(util.clj:495),	at metabase.models.task_history$do_with_task_history63379__63380.invokeStatic(task_history.clj:121),	at metabase.models.task_history$do_with_task_history63379__63380.invoke(task_history.clj:109),	at metabase.sync.util$run_step_with_metadata63542__63544$fn__63546.doInvoke(util.clj:488),	at clojure.lang.RestFn.invoke(RestFn.java:400),	at metabase.sync.util$with_start_and_finish_logging_STAR_.invokeStatic(util.clj:132),	at metabase.sync.util$with_start_and_finish_logging_STAR_.invoke(util.clj:126),	at metabase.sync.util$do_with_start_and_finish_debug_logging.invokeStatic(util.clj:150),	at metabase.sync.util$do_with_start_and_finish_debug_logging.invoke(util.clj:146),	at metabase.sync.util$run_step_with_metadata63542__63544.invokeStatic(util.clj:482),	at metabase.sync.util$run_step_with_metadata63542__63544.invoke(util.clj:477),	at metabase.sync.util$run_sync_operation63592__63593$fn__63594$fn__63602.invoke(util.clj:568),	at metabase.sync.util$run_sync_operation63592__63593$fn__63594.invoke(util.clj:566),	at metabase.models.task_history$do_with_task_history63379__63380.invokeStatic(task_history.clj:121),	at metabase.models.task_history$do_with_task_history63379__63380.invoke(task_history.clj:109),	at metabase.sync.util$run_sync_operation63592__63593.invokeStatic(util.clj:563),	at metabase.sync.util$run_sync_operation63592__63593.invoke(util.clj:558),	at metabase.sync.field_values$update_field_values_BANG_93507__93508$fn__93509.invoke(field_values.clj:123),	at metabase.sync.util$do_with_error_handling.invokeStatic(util.clj:191),	at metabase.sync.util$do_with_error_handling.invoke(util.clj:184),	at clojure.core$partial$fn__5929.invoke(core.clj:2647),	at metabase.driver$fn__59430.invokeStatic(driver.clj:892),	at metabase.driver$fn__59430.invoke(driver.clj:892),	at clojure.lang.MultiFn.invoke(MultiFn.java:239),	at metabase.sync.util$sync_in_context$fn__63451.invoke(util.clj:167),	at metabase.sync.util$with_db_logging_disabled$fn__63448.invoke(util.clj:159),	at metabase.sync.util$with_start_and_finish_logging_STAR_.invokeStatic(util.clj:132),	at metabase.sync.util$with_start_and_finish_logging_STAR_.invoke(util.clj:126),	at metabase.sync.util$with_start_and_finish_logging$fn__63435.invoke(util.clj:144),	at metabase.sync.util$with_sync_events63425__63426$fn__63430.invoke(util.clj:118),	at metabase.sync.util$with_duplicate_ops_prevented$fn__63415.invoke(util.clj:90),	at metabase.sync.util$do_sync_operation63466__63467.invokeStatic(util.clj:216),	at metabase.sync.util$do_sync_operation63466__63467.invoke(util.clj:210),	at metabase.sync.field_values$update_field_values_BANG_93507__93508.invokeStatic(field_values.clj:121),	at metabase.sync.field_values$update_field_values_BANG_93507__93508.invoke(field_values.clj:117),	at metabase.api.database$fn__106333$fn__106334$fn__106335.invoke(database.clj:1057),	at clojure.core$binding_conveyor_fn$fn__5842.invoke(core.clj:2047),	at clojure.lang.AFn.call(AFn.java:18),	at java.base/java.util.concurrent.FutureTask.run(Unknown Source),	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source),	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source),	at java.base/java.lang.Thread.run(Unknown Source),Caused by: org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException: Unknown or incorrect time zone: 'Asia/Shanghai',	at org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException.of(MariaDbSqlException.java:34),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.exceptionWithQuery(AbstractQueryProtocol.java:195),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:263),	at org.mariadb.jdbc.MariaDbStatement.executeInternal(MariaDbStatement.java:356),	... 215 more,Caused by: java.sql.SQLException: Unknown or incorrect time zone: 'Asia/Shanghai',	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readErrorPacket(AbstractQueryProtocol.java:1693),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readPacket(AbstractQueryProtocol.java:1555),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.getResult(AbstractQueryProtocol.java:1518),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:257),	... 216 more
[405e48a2-a278-449e-a5a0-74cf6a1f33cf] 2024-12-11T09:59:52+08:00 ERROR metabase.driver.sql-jdbc.execute Failed to set timezone 'Asia/Shanghai' for :mysql database,java.sql.SQLTransientConnectionException: (conn=490868607) Unknown or incorrect time zone: 'Asia/Shanghai',	at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.createException(ExceptionFactory.java:79),	at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.create(ExceptionFactory.java:158),	at org.mariadb.jdbc.MariaDbStatement.executeExceptionEpilogue(MariaDbStatement.java:262),	at org.mariadb.jdbc.MariaDbStatement.executeInternal(MariaDbStatement.java:362),	at org.mariadb.jdbc.MariaDbStatement.execute(MariaDbStatement.java:500),	at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75),	at metabase.driver.sql_jdbc.execute$set_time_zone_if_supported_BANG_.invokeStatic(execute.clj:224),	at metabase.driver.sql_jdbc.execute$set_time_zone_if_supported_BANG_.invoke(execute.clj:209),	at metabase.driver.sql_jdbc.execute$set_default_connection_options_BANG_87296__87298.invokeStatic(execute.clj:351),	at metabase.driver.sql_jdbc.execute$set_default_connection_options_BANG_87296__87298.invoke(execute.clj:340),	at metabase.driver.sql_jdbc.execute$fn__87322$fn__87323.invoke(execute.clj:397),	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87292__87293.invokeStatic(execute.clj:338),	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87292__87293.invoke(execute.clj:321),	at metabase.driver.sql_jdbc.execute$fn__87322.invokeStatic(execute.clj:392),	at metabase.driver.sql_jdbc.execute$fn__87322.invoke(execute.clj:390),	at clojure.lang.MultiFn.invoke(MultiFn.java:244),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705),	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694),	at metabase.driver.sql_jdbc$fn__115546.invokeStatic(sql_jdbc.clj:79),	at metabase.driver.sql_jdbc$fn__115546.invoke(sql_jdbc.clj:77),	at clojure.lang.MultiFn.invoke(MultiFn.java:244),	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52),	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39),	at metabase.query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102),	at metabase.query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95),	at metabase.query_processor.execute$run.invokeStatic(execute.clj:62),	at metabase.query_processor.execute$run.invoke(execute.clj:56),	at metabase.query_processor.middleware.update_used_cards$update_used_cards_BANG_75880__75881$fn__75882.invoke(update_used_cards.clj:60),	at metabase.query_processor.execute$add_native_form_to_result_metadata$fn__75897.invoke(execute.clj:25),	at metabase.query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__75903.invoke(execute.clj:36),	at metabase.query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___75853.invoke(cache.clj:241),	at metabase.query_processor.middleware.permissions$check_query_permissions$fn__72558.invoke(permissions.clj:148),	at metabase.query_processor.middleware.enterprise$check_download_permissions_middleware$fn__73279.invoke(enterprise.clj:51),	at metabase.query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__73289.invoke(enterprise.clj:64),	at metabase.query_processor.execute$execute75930__75931$fn__75932.invoke(execute.clj:94),	at metabase.query_processor.setup$do_with_qp_setup73804__73805.invokeStatic(setup.clj:225),	at metabase.query_processor.setup$do_with_qp_setup73804__73805.invoke(setup.clj:216),	at metabase.query_processor.execute$execute75930__75931.invokeStatic(execute.clj:93),	at metabase.query_processor.execute$execute75930__75931.invoke(execute.clj:89),	at metabase.query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49),	at metabase.query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44),	at metabase.query_processor.middleware.enterprise$fn__73306$handle_audit_app_internal_queries__73307$fn__73309.invoke(enterprise.clj:96),	at metabase.query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__73317.invoke(enterprise.clj:103),	at metabase.query_processor.middleware.process_userland_query$process_userland_query_middleware78355__78356$fn__78357.invoke(process_userland_query.clj:191),	at metabase.query_processor.middleware.catch_exceptions$catch_exceptions78420__78421$fn__78422.invoke(catch_exceptions.clj:125),	at metabase.query_processor$process_query78461__78462$fn__78463.invoke(query_processor.clj:80),	at metabase.query_processor.setup$do_with_canceled_chan73799__73800$fn__73801.invoke(setup.clj:189),	at metabase.query_processor.setup$do_with_database_local_settings73792__73793$fn__73794.invoke(setup.clj:181),	at metabase.query_processor.setup$do_with_driver73785__73786$fn__73787$fn__73788.invoke(setup.clj:166),	at metabase.driver$do_with_driver.invokeStatic(driver.clj:106),	at metabase.driver$do_with_driver.invoke(driver.clj:101),	at metabase.query_processor.setup$do_with_driver73785__73786$fn__73787.invoke(setup.clj:165),	at metabase.query_processor.setup$do_with_metadata_provider73776__73777$fn__73778$fn__73781.invoke(setup.clj:151),	at metabase.query_processor.store$do_with_metadata_provider59754__59755.invokeStatic(store.clj:170),	at metabase.query_processor.store$do_with_metadata_provider59754__59755.invoke(store.clj:150),	at metabase.query_processor.store$do_with_metadata_provider59754__59755.invokeStatic(store.clj:159),	at metabase.query_processor.store$do_with_metadata_provider59754__59755.invoke(store.clj:150),	at metabase.query_processor.setup$do_with_metadata_provider73776__73777$fn__73778.invoke(setup.clj:150),	at metabase.query_processor.setup$do_with_resolved_database73766__73767$fn__73768.invoke(setup.clj:128),	at metabase.query_processor.setup$do_with_qp_setup73804__73805.invokeStatic(setup.clj:232),	at metabase.query_processor.setup$do_with_qp_setup73804__73805.invoke(setup.clj:216),	at metabase.query_processor$process_query78461__78462.invokeStatic(query_processor.clj:78),	at metabase.query_processor$process_query78461__78462.invoke(query_processor.clj:71),	at metabase.db.metadata_queries$table_query.invokeStatic(metadata_queries.clj:66),	at metabase.db.metadata_queries$table_query.invoke(metadata_queries.clj:57),	at metabase.models.field_values$distinct_values.invokeStatic(field_values.clj:378),	at metabase.models.field_values$distinct_values.invoke(field_values.clj:364),	at metabase.models.field_values$create_or_update_full_field_values_BANG_.invokeStatic(field_values.clj:445),	at metabase.models.field_values$create_or_update_full_field_values_BANG_.doInvoke(field_values.clj:436),	at clojure.lang.RestFn.invoke(RestFn.java:442),	at metabase.sync.field_values$update_field_values_for_field_BANG_93470__93471.invokeStatic(field_values.clj:32),	at metabase.sync.field_values$update_field_values_for_field_BANG_93470__93471.invoke(field_values.clj:25),	at metabase.sync.field_values$update_field_values_for_table_BANG_93480__93481$fn__93482$fn__93483.invoke(field_values.clj:57),	at metabase.sync.util$do_with_error_handling.invokeStatic(util.clj:191),	at metabase.sync.util$do_with_error_handling.invoke(util.clj:184),	at metabase.sync.field_values$update_field_values_for_table_BANG_93480__93481$fn__93482.invoke(field_values.clj:55),	at clojure.lang.PersistentVector.reduce(PersistentVector.java:418),	at clojure.core$reduce.invokeStatic(core.clj:6964),	at clojure.core$reduce.invoke(core.clj:6947),	at metabase.sync.field_values$update_field_values_for_table_BANG_93480__93481.invokeStatic(field_values.clj:54),	at metabase.sync.field_values$update_field_values_for_table_BANG_93480__93481.invoke(field_values.clj:51),	at clojure.core$map$fn__5950$fn__5951.invoke(core.clj:2759),	at clojure.core$completing$fn__8558.invoke(core.clj:7010),	at clojure.core$map$fn__5950$fn__5951.invoke(core.clj:2759),	at toucan2.pipeline$with_init$fn__22864.invoke(pipeline.clj:327),	at clojure.core$completing$fn__8558.invoke(core.clj:7010),	at clojure.core$map$fn__5950$fn__5951.invoke(core.clj:2759),	at toucan2.jdbc.result_set$reduce_result_set.invokeStatic(result_set.clj:156),	at toucan2.jdbc.result_set$reduce_result_set.invoke(result_set.clj:125),	at toucan2.jdbc.query$reduce_jdbc_query.invokeStatic(query.clj:51),	at toucan2.jdbc.query$reduce_jdbc_query.invoke(query.clj:22),	at toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default.invokeStatic(pipeline.clj:19),	at toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default.invoke(pipeline.clj:9),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:15),	at methodical.impl.combo.threaded$combine_methods_thread_last$fn__19698$combined_method_thread_last__19699.invoke(threaded.clj:64),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:65),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:216),	at toucan2.pipeline$transduce_execute$with_connection_STAR___22784.invoke(pipeline.clj:78),	at toucan2.connection$bind_current_connectable_fn$fn__22461.invoke(connection.clj:104),	at toucan2.connection$bind_current_connectable_fn$fn__22461.invoke(connection.clj:104),	at toucan2.connection$bind_current_connectable_fn$fn__22461.invoke(connection.clj:104),	at toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource.invokeStatic(connection.clj:18),	at toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource.invoke(connection.clj:15),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210),	at metabase.db.connection$do_with_connection_primary_method_default.invokeStatic(connection.clj:132),	at metabase.db.connection$do_with_connection_primary_method_default.invoke(connection.clj:130),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210),	at toucan2.connection$do_with_connection_primary_method_.invokeStatic(connection.clj:204),	at toucan2.connection$do_with_connection_primary_method_.invoke(connection.clj:194),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118),	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210),	at toucan2.pipeline$transduce_execute.invokeStatic(pipeline.clj:77),	at toucan2.pipeline$transduce_execute.invoke(pipeline.clj:64),	at clojure.lang.Var.invoke(Var.java:401),	at toucan2.pipeline$transduce_compiled_query.invokeStatic(pipeline.clj:244),	at toucan2.pipeline$transduce_compiled_query.invoke(pipeline.clj:240),	at toucan2.pipeline$transduce_built_query.invokeStatic(pipeline.clj:252),	at toucan2.pipeline$transduce_built_query.invoke(pipeline.clj:246),	at toucan2.pipeline$transduce_query_primary_method_default.invokeStatic(pipeline.clj:272),	at toucan2.pipeline$transduce_query_primary_method_default.invoke(pipeline.clj:269),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:15),	at methodical.impl.combo.threaded$combine_methods_thread_last$fn__19698$combined_method_thread_last__19699.invoke(threaded.clj:64),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:65),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:216),	at toucan2.pipeline$transduce_query_STAR_.invokeStatic(pipeline.clj:278),	at toucan2.pipeline$transduce_query_STAR_.invoke(pipeline.clj:274),	at toucan2.pipeline$transduce_with_model.invokeStatic(pipeline.clj:293),	at toucan2.pipeline$transduce_with_model.invoke(pipeline.clj:280),	at toucan2.pipeline$transduce_parsed.invokeStatic(pipeline.clj:309),	at toucan2.pipeline$transduce_parsed.invoke(pipeline.clj:295),	at toucan2.pipeline$transduce_unparsed.invokeStatic(pipeline.clj:317),	at toucan2.pipeline$transduce_unparsed.invoke(pipeline.clj:311),	at clojure.lang.AFn.applyToHelper(AFn.java:160),	at clojure.lang.AFn.applyTo(AFn.java:144),	at clojure.core$apply.invokeStatic(core.clj:669),	at clojure.core$apply.invoke(core.clj:662),	at toucan2.pipeline$reducible_fn$reify__22884.reduce(pipeline.clj:386),	at clojure.core$transduce.invokeStatic(core.clj:7025),	at clojure.core.Eduction.reduce(core.clj:7874),	at clojure.core$transduce.invokeStatic(core.clj:7025),	at clojure.core$transduce.invokeStatic(core.clj:7021),	at clojure.core$transduce.invoke(core.clj:7012),	at metabase.sync.field_values$update_field_values_for_database_BANG_93487__93488.invokeStatic(field_values.clj:66),	at metabase.sync.field_values$update_field_values_for_database_BANG_93487__93488.invoke(field_values.clj:63),	at clojure.lang.AFn.applyToHelper(AFn.java:154),	at clojure.lang.AFn.applyTo(AFn.java:144),	at clojure.core$apply.invokeStatic(core.clj:669),	at clojure.core$apply.invoke(core.clj:662),	at metabase.sync.util$run_step_with_metadata63542__63544$fn__63546$fn__63549.invoke(util.clj:495),	at metabase.models.task_history$do_with_task_history63379__63380.invokeStatic(task_history.clj:121),	at metabase.models.task_history$do_with_task_history63379__63380.invoke(task_history.clj:109),	at metabase.sync.util$run_step_with_metadata63542__63544$fn__63546.doInvoke(util.clj:488),	at clojure.lang.RestFn.invoke(RestFn.java:400),	at metabase.sync.util$with_start_and_finish_logging_STAR_.invokeStatic(util.clj:132),	at metabase.sync.util$with_start_and_finish_logging_STAR_.invoke(util.clj:126),	at metabase.sync.util$do_with_start_and_finish_debug_logging.invokeStatic(util.clj:150),	at metabase.sync.util$do_with_start_and_finish_debug_logging.invoke(util.clj:146),	at metabase.sync.util$run_step_with_metadata63542__63544.invokeStatic(util.clj:482),	at metabase.sync.util$run_step_with_metadata63542__63544.invoke(util.clj:477),	at metabase.sync.util$run_sync_operation63592__63593$fn__63594$fn__63602.invoke(util.clj:568),	at metabase.sync.util$run_sync_operation63592__63593$fn__63594.invoke(util.clj:566),	at metabase.models.task_history$do_with_task_history63379__63380.invokeStatic(task_history.clj:121),	at metabase.models.task_history$do_with_task_history63379__63380.invoke(task_history.clj:109),	at metabase.sync.util$run_sync_operation63592__63593.invokeStatic(util.clj:563),	at metabase.sync.util$run_sync_operation63592__63593.invoke(util.clj:558),	at metabase.sync.field_values$update_field_values_BANG_93507__93508$fn__93509.invoke(field_values.clj:123),	at metabase.sync.util$do_with_error_handling.invokeStatic(util.clj:191),	at metabase.sync.util$do_with_error_handling.invoke(util.clj:184),	at clojure.core$partial$fn__5929.invoke(core.clj:2647),	at metabase.driver$fn__59430.invokeStatic(driver.clj:892),	at metabase.driver$fn__59430.invoke(driver.clj:892),	at clojure.lang.MultiFn.invoke(MultiFn.java:239),	at metabase.sync.util$sync_in_context$fn__63451.invoke(util.clj:167),	at metabase.sync.util$with_db_logging_disabled$fn__63448.invoke(util.clj:159),	at metabase.sync.util$with_start_and_finish_logging_STAR_.invokeStatic(util.clj:132),	at metabase.sync.util$with_start_and_finish_logging_STAR_.invoke(util.clj:126),	at metabase.sync.util$with_start_and_finish_logging$fn__63435.invoke(util.clj:144),	at metabase.sync.util$with_sync_events63425__63426$fn__63430.invoke(util.clj:118),	at metabase.sync.util$with_duplicate_ops_prevented$fn__63415.invoke(util.clj:90),	at metabase.sync.util$do_sync_operation63466__63467.invokeStatic(util.clj:216),	at metabase.sync.util$do_sync_operation63466__63467.invoke(util.clj:210),	at metabase.sync.field_values$update_field_values_BANG_93507__93508.invokeStatic(field_values.clj:121),	at metabase.sync.field_values$update_field_values_BANG_93507__93508.invoke(field_values.clj:117),	at metabase.api.database$fn__106333$fn__106334$fn__106335.invoke(database.clj:1057),	at clojure.core$binding_conveyor_fn$fn__5842.invoke(core.clj:2047),	at clojure.lang.AFn.call(AFn.java:18),	at java.base/java.util.concurrent.FutureTask.run(Unknown Source),	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source),	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source),	at java.base/java.lang.Thread.run(Unknown Source),Caused by: org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException: Unknown or incorrect time zone: 'Asia/Shanghai',	at org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException.of(MariaDbSqlException.java:34),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.exceptionWithQuery(AbstractQueryProtocol.java:195),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:263),	at org.mariadb.jdbc.MariaDbStatement.executeInternal(MariaDbStatement.java:356),	... 215 more,Caused by: java.sql.SQLException: Unknown or incorrect time zone: 'Asia/Shanghai',	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readErrorPacket(AbstractQueryProtocol.java:1693),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readPacket(AbstractQueryProtocol.java:1555),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.getResult(AbstractQueryProtocol.java:1518),	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:257),	... 216 more


### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""zh-CN"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Shanghai""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.37""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.3.8-1.el7.elrepo.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Shanghai""
  }
}
```

### Severity

Bblocking usage of Metabase entirely

### Additional context

_No response_",airorair,2024-12-11 02:10:34+00:00,[],2025-01-09 22:28:07+00:00,2025-01-09 22:26:49+00:00,https://github.com/metabase/metabase/issues/51147,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Database/MySQL', None), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2533467783, 'issue_id': 2731639234, 'author': 'airorair', 'body': '@luizarakaki Help meThis is urgentThank u', 'created_at': datetime.datetime(2024, 12, 11, 2, 16, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2533478077, 'issue_id': 2731639234, 'author': 'paoliniluis', 'body': '@airorair please add the time zones to the database \n\nAlso please send us exactly the database you have with the exact same packages', 'created_at': datetime.datetime(2024, 12, 11, 2, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2533480849, 'issue_id': 2731639234, 'author': 'paoliniluis', 'body': 'https://dba.stackexchange.com/questions/120945/how-do-i-resolve-this-error-error-1298-hy000-unknown-or-incorrect-time-zone', 'created_at': datetime.datetime(2024, 12, 11, 2, 27, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2533481149, 'issue_id': 2731639234, 'author': 'airorair', 'body': '> [@airorair](https://github.com/airorair) please add the time zones to the database\n> \n> Also please send us exactly the database you have with the exact same packages\n\n the time zones to the databaseConfiguration information database OR Data source database?', 'created_at': datetime.datetime(2024, 12, 11, 2, 27, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2581362777, 'issue_id': 2731639234, 'author': 'paoliniluis', 'body': 'Closing this as it should be resolved with the link I posted above', 'created_at': datetime.datetime(2025, 1, 9, 22, 26, 49, tzinfo=datetime.timezone.utc)}, {'comment_id': 2581364694, 'issue_id': 2731639234, 'author': 'paoliniluis', 'body': 'https://github.com/metabase/metabase/issues/10365', 'created_at': datetime.datetime(2025, 1, 9, 22, 28, 6, tzinfo=datetime.timezone.utc)}]","airorair (Issue Creator) on (2024-12-11 02:16:12 UTC): @luizarakaki Help meThis is urgentThank u

paoliniluis on (2024-12-11 02:24:00 UTC): @airorair please add the time zones to the database 

Also please send us exactly the database you have with the exact same packages

paoliniluis on (2024-12-11 02:27:05 UTC): https://dba.stackexchange.com/questions/120945/how-do-i-resolve-this-error-error-1298-hy000-unknown-or-incorrect-time-zone

airorair (Issue Creator) on (2024-12-11 02:27:23 UTC): the time zones to the databaseConfiguration information database OR Data source database?

paoliniluis on (2025-01-09 22:26:49 UTC): Closing this as it should be resolved with the link I posted above

paoliniluis on (2025-01-09 22:28:06 UTC): https://github.com/metabase/metabase/issues/10365

"
2731350249,issue,closed,not_planned,Expose Model Cache Refresh button in OSS,"Hey y'all! I have a starter customer that recently upgraded to v51. They were asking what happened to the ""refresh now"" button for model persistence. In v50, if I run OSS locally, it looks like the ""refresh now"" option was available from the ""More Info"" panel for models. In v51 it's under ""Model Settings"" which is not visible unless I have a Pro/Enterprise license key. Was it intended to remove the ""refresh now"" functionality from Starter?

[Slack Message](https://metaboat.slack.com/archives/C01LQQ2UW03/p1733867777873139?thread_ts=1733867777.873139&cid=C01LQQ2UW03)",iethree,2024-12-10 22:35:00+00:00,[],2025-01-16 14:53:11+00:00,2025-01-16 14:53:11+00:00,https://github.com/metabase/metabase/issues/51142,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Models', 'aka Datasets'), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('Bug:v51', 'bugs or regressions introduced in v51')]","[{'comment_id': 2595939241, 'issue_id': 2731350249, 'author': 'luizarakaki', 'body': 'Per model refresh was never intended to be part of OSS/Starter. With this endpoint, it is possible to replicate the Pro/EE feature of granular persistence controls.', 'created_at': datetime.datetime(2025, 1, 16, 14, 53, 4, tzinfo=datetime.timezone.utc)}]","luizarakaki on (2025-01-16 14:53:04 UTC): Per model refresh was never intended to be part of OSS/Starter. With this endpoint, it is possible to replicate the Pro/EE feature of granular persistence controls.

"
2731117845,issue,closed,completed,[Epic] Enhance custom expressions to support multiple value filters,"### Links

- [Product doc](https://www.notion.so/metabase/Enhance-custom-expressions-to-support-multiple-value-filters-14669354c9018036a8f0fd4aa4861067#14669354c90181108626fc13e4c7608b)

### Implementation Plan

```[tasklist]
- [ ] https://github.com/metabase/metabase/pull/51148
```

### Testing plan

- `in` / `notIn`
- Widgets - strings, number, coordinate, exclude date
- Expression location - custom column, filters, aggregation
- Argument resolving - literals or columns, edge cases - first argument is a literal, 2nd (i.e. > 1) argument is a column
- Argument types - strings, numbers",ranquild,2024-12-10 20:26:17+00:00,['ranquild'],2024-12-12 19:42:54+00:00,2024-12-12 19:42:49+00:00,https://github.com/metabase/metabase/issues/51134,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2731000320,issue,closed,completed,Cannot Save Native Queryies with Crosstabs that have long Definitions,"### Describe the bug

Can longer edit Postgres queries with crosstab functions (or save new ones) if the crosstab definition is too long.

`ERROR: value too long for type character varying(254)`

![Image](https://github.com/user-attachments/assets/a0b6613f-76c0-4029-87f0-d76961e14da3)


### To Reproduce

1. Set up test tables in Postgres

```
CREATE EXTENSION IF NOT EXISTS tablefunc;

-- Create a 'history' table
CREATE TABLE history (
    id SERIAL PRIMARY KEY,
    page INTEGER NOT NULL,
    h_timestamp TIMESTAMP NOT NULL
);

-- Insert test data
INSERT INTO history (page, h_timestamp)
VALUES
    (1, '2024-01-05'),
    (1, '2024-01-15'),
    (1, '2024-02-10'),
    (2, '2024-01-20'),
    (2, '2024-02-25'),
    (3, '2024-01-30'),
    (3, '2024-02-15');

```

2. Execute crosstab query

This one will not save:
```
   SELECT * FROM crosstab($$

    SELECT
        history.page,
        date_trunc('month', history.h_timestamp)::DATE,
        count(history.id) as total
    FROM history
    WHERE h_timestamp between '2024-01-01' and '2024-12-01'
    GROUP BY page, date_trunc('month', history.h_timestamp)
$$,

        $$
            SELECT
                date_trunc('month', generate_series('2024-01-01', '2024-02-01', '1 month'::INTERVAL))::DATE
$$
) AS ct(
    page INTEGER,
    ""Jan"" FLOAT,
    ""Feb"" FLOAT
)
```

This one will save:

```
SELECT * FROM crosstab(
$$
SELECT page, TO_CHAR(h_timestamp, 'Mon') AS mon, COUNT(*) FROM history GROUP BY page, mon ORDER BY page, mon
$$,
$$
VALUES ('Jan'), ('Feb')
$$
) AS ct(page INTEGER, ""Jan"" INTEGER, ""Feb"" INTEGER);
```

### Expected behavior

_No response_

### Logs

I bumped logging on the app DB and it looks like this is the culprit:

```
2024-12-10 13:24:19 2024-12-10 19:24:19.453 UTC [30542] LOG:  execute S_369: SELECT ""t"".""id"" AS ""table-id"", ""t"".""name"" AS ""table"", ""t"".""schema"" AS ""schema"" FROM ""metabase_table"" AS ""t"" WHERE (""t"".""db_id"" = $1) AND (FALSE)
2024-12-10 13:24:19 2024-12-10 19:24:19.453 UTC [30542] DETAIL:  parameters: $1 = '2'
2024-12-10 13:24:19 2024-12-10 19:24:19.455 UTC [30542] LOG:  execute S_370: SELECT ""f"".""id"" AS ""field-id"", ""f"".""name"" AS ""column"", ""t"".""id"" AS ""table-id"", ""t"".""name"" AS ""table"", ""t"".""schema"" AS ""schema"" FROM ""metabase_table"" AS ""t"" LEFT JOIN ""metabase_field"" AS ""f"" ON ""f"".""table_id"" = ""t"".""id"" WHERE (""t"".""db_id"" = $1) AND ((((""f"".""id"" IS NULL) OR (LOWER(""f"".""name"") = $2)) AND (FALSE)) OR (((""f"".""id"" IS NULL) OR (LOWER(""f"".""name"") = $3)) AND (FALSE)))
2024-12-10 13:24:19 2024-12-10 19:24:19.455 UTC [30542] DETAIL:  parameters: $1 = '2', $2 = '$$
2024-12-10 13:24:19                 select
2024-12-10 13:24:19                     date_trunc(''month'', generate_series(''2024-01-01'', ''2024-02-01'', ''1 month''::interval))::date
2024-12-10 13:24:19     $$', $3 = '$$
2024-12-10 13:24:19 
2024-12-10 13:24:19         select
2024-12-10 13:24:19             history.page,
2024-12-10 13:24:19             date_trunc(''month'', history.h_timestamp)::date,
2024-12-10 13:24:19             count(history.id) as total
2024-12-10 13:24:19         from history
2024-12-10 13:24:19         where h_timestamp between ''2024-01-01'' and ''2024-12-01''
2024-12-10 13:24:19         group by page, date_trunc(''month'', history.h_timestamp)
2024-12-10 13:24:19     $$'
2024-12-10 13:24:19 2024-12-10 19:24:19.456 UTC [30542] ERROR:  value too long for type character varying(254)
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-11-07"",
      ""tag"": ""v1.51.2.3"",
      ""hash"": ""33c6105""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.1 (Debian 15.1-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Blocking - customer can longer modify, duplicate or recreate cards with crosstab queries

### Additional context

These work in v50. ",ixipixi,2024-12-10 19:25:11+00:00,['crisptrutski'],2024-12-17 08:43:30+00:00,2024-12-11 15:27:38+00:00,https://github.com/metabase/metabase/issues/51131,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('.Escalation', ''), ('.Team/Workflows', 'aka BEC'), ('Querying/Native/Parser', '')]","[{'comment_id': 2532694173, 'issue_id': 2731000320, 'author': 'dpsutton', 'body': 'repro:\n\n```clojure\nnative-query-analyzer=> (references-for-sql :postgres\n                                            {:type :native\n                                             :native\n                                             {:query\n                                              ""SELECT * FROM crosstab($$\n\n    SELECT\n        history.page,\n        date_trunc(\'month\', history.h_timestamp)::DATE,\n        count(history.id) as total\n    FROM history\n    WHERE h_timestamp between \'2024-01-01\' and \'2024-12-01\'\n    GROUP BY page, date_trunc(\'month\', history.h_timestamp)\n$$,\n\n        $$\n            SELECT\n                date_trunc(\'month\', generate_series(\'2024-01-01\', \'2024-02-01\', \'1 month\'::INTERVAL))::DATE\n$$\n) AS ct(\n    page INTEGER,\n    \\""Jan\\"" FLOAT,\n    \\""Feb\\"" FLOAT\n)""}}\n                                            )\n{:tables (),\n :fields ({:column ""$$\\n            SELECT\\n                date_trunc(\'month\', generate_series(\'2024-01-01\', \'2024-02-01\', \'1 month\'::INTERVAL))::DATE\\n$$"",\n           :explicit-reference true}\n          {:column ""$$\\n    SELECT\\n        history.page,\\n        date_trunc(\'month\', history.h_timestamp)::DATE,\\n        count(history.id) as total\\n    FROM history\\n    WHERE h_timestamp between \'2024-01-01\' and \'2024-12-01\'\\n    GROUP BY page, date_trunc(\'month\', history.h_timestamp)\\n$$"",\n           :explicit-reference true})}\n```', 'created_at': datetime.datetime(2024, 12, 10, 19, 34, 24, tzinfo=datetime.timezone.utc)}]","dpsutton on (2024-12-10 19:34:24 UTC): repro:

```clojure
native-query-analyzer=> (references-for-sql :postgres
                                            {:type :native
                                             :native
                                             {:query
                                              ""SELECT * FROM crosstab($$

    SELECT
        history.page,
        date_trunc('month', history.h_timestamp)::DATE,
        count(history.id) as total
    FROM history
    WHERE h_timestamp between '2024-01-01' and '2024-12-01'
    GROUP BY page, date_trunc('month', history.h_timestamp)
$$,

        $$
            SELECT
                date_trunc('month', generate_series('2024-01-01', '2024-02-01', '1 month'::INTERVAL))::DATE
$$
) AS ct(
    page INTEGER,
    \""Jan\"" FLOAT,
    \""Feb\"" FLOAT
)""}}
                                            )
{:tables (),
 :fields ({:column ""$$\n            SELECT\n                date_trunc('month', generate_series('2024-01-01', '2024-02-01', '1 month'::INTERVAL))::DATE\n$$"",
           :explicit-reference true}
          {:column ""$$\n    SELECT\n        history.page,\n        date_trunc('month', history.h_timestamp)::DATE,\n        count(history.id) as total\n    FROM history\n    WHERE h_timestamp between '2024-01-01' and '2024-12-01'\n    GROUP BY page, date_trunc('month', history.h_timestamp)\n$$"",
           :explicit-reference true})}
```

"
2730981934,issue,open,,Redundant dashboard_id being sent in `api/dashboard/:dashboard-id/dashcard/:dashcard-id/card/:card-id/query`,"When viewing a dashboard, I am seeing the following warnings in the logs:

``` java
2024-12-10 18:46:57,758 WARN api.common :: Unexpected parameters at [:post ""/api/dashboard/10/dashcard/98/card/119/query""]: [:dashboard_id]
Please add them to the schema or remove them from the API client
```

There's a subtle thing happening here: in the [defendpoint definition](https://github.com/metabase/metabase/blob/ss%2Fdashboard-and-dashboard-question-page-updates/src/metabase/api/dashboard.clj#L1333-L1348), we are looking for (and getting) `dashboard-id` as a route param. But we also send them as `dashboard_id` in the request payload. Seems like they always match, for now, but it may be better to send over the dashboard id in a single way.

The solution could be that the frontend stops sending `dashboard_id` in the request body.
",escherize,2024-12-10 19:15:01+00:00,[],2025-02-04 20:23:48+00:00,,https://github.com/metabase/metabase/issues/51130,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2730907567,issue,open,,Support for XMR Charts,"**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]

**Describe the solution you'd like**
I would love to see native XMR chart support in Metabase.

**Describe alternatives you've considered**
I looked into creating my own XMR chart with plugin or something like that and it seems like it isn't supported right now.

**How important is this feature to you?**
We use Metabase as our source of truth. On a weekly basis we download charts from a shared dashboard to review in a weekly meeting. But many of our charts need to be XMR so we end up building the manually from exported CSVs instead. XMR support in Metabase would save me hours a week.

**Additional context**
To learn more about XMR this is a good resource and an open source tool I've used to to very manually work around the missing chart type. https://xmrit.com/opensource/
",EmperiorEric,2024-12-10 18:40:05+00:00,[],2025-02-04 20:31:27+00:00,,https://github.com/metabase/metabase/issues/51127,"[('Visualization/', ''), ('Type:New Feature', ''), ('Visualization/Chart Settings', '')]",[],
2730452917,issue,closed,completed,Sending a notifications test should show the response if it is a non 200 reponse,"Currently, if you try to send a test when creating a webhook notification, upon success we show you a `Test response` section, and upon an error status code we show you an error message on the input, but not the actual response from the destination. This should actually be changed to not show a `Test response` upon success (since it's static), and instead only show that section when the test is unsuccessful",npfitz,2024-12-10 15:28:03+00:00,['npfitz'],2025-01-06 13:39:23+00:00,2024-12-17 12:52:23+00:00,https://github.com/metabase/metabase/issues/51114,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('Notifications/Webhooks', '')]",[],
2730287185,issue,open,,Sandbox the audit view,"**Is your feature request related to a problem? Please describe.**
Some users would like to show to external users the audit info, but just their own. Sandboxing the audit should allow them to do this.

**Describe the solution you'd like**
Expose the audit DB as a a new DB, so users can sandbox it

**Describe alternatives you've considered**
None

**How important is this feature to you?**
Requested by a user, they want to show Metabase usage to external users, but just their own

**Additional context**
NA
",paoliniluis,2024-12-10 14:30:36+00:00,[],2025-02-04 20:30:30+00:00,,https://github.com/metabase/metabase/issues/51111,"[('Type:New Feature', ''), ('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('Administration/Data Sandboxes', 'Enterprise Sandboxing'), ('Administration/Usage analytics', 'Pro and Enterprise meta analytics, fka audit')]",[],
2730084734,issue,open,,Metric lineage,"**Is your feature request related to a problem? Please describe.**
In the same way you can get which questions are derived from a model, we should be able to pull which questions use a certain metric

**Describe the solution you'd like**
See which questions use a specific metric

**Describe alternatives you've considered**
get that from the app db

**How important is this feature to you?**
Should be useful to see impact on metric change. Also requested by a customer

**Additional context**
NA
",paoliniluis,2024-12-10 13:10:36+00:00,[],2025-02-04 20:30:50+00:00,,https://github.com/metabase/metabase/issues/51104,"[('Type:New Feature', ''), ('Querying/Metrics', 'v2'), ('Semantic Model', ''), ('Semantic Model/Metrics', '')]",[],
2729931325,issue,open,,Tooltip vanishes when clicking on bar in statically embedded vertical bar chart,"### Describe the bug

When clicking on the bar of a vertical bar chart that has been statically embedded the tooltip disappears and doesn't reappear when hovering over any of the bars in the chart. The only way to get the tooltip to reappear is reloading the page. Curiously this only happens for the vertical bar chart, horizontal bar charts are not affected.

The problem is reproducible using the sample database/collection.

### To Reproduce

1. Statically embed `question/4-buyers-by-age-group `
2. Make sure no click behavior is defined
3. Click on a vertical bar
4. Tooltip is gone until you refresh the page


### Expected behavior

The tooltip should not dissapear.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64; rv:133.0) Gecko/20100101 Firefox/133.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-self-hosted-yearly"",
    ""version"": {
      ""date"": ""2024-11-19"",
      ""tag"": ""v1.51.4"",
      ""hash"": ""47f05f3""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.19 (Debian 12.19-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.12.1-arch1-1"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Minor

### Additional context

_No response_",YvesBos,2024-12-10 12:01:56+00:00,[],2025-02-04 20:31:18+00:00,,https://github.com/metabase/metabase/issues/51102,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2729860094,issue,closed,completed,Add links to Shoppy,"* Update link on logo to point to public website: `https://www.metabase.com/?utm_source=referral&utm_medium=banner&utm_campaign=shoppy-demo`
* Add footer with links to docs, GH repo for shoppy and Metabase, according to the [design](https://www.figma.com/design/OamRqg07JOoC4bUqfCkh4t/SDK-Reference-APP?node-id=2611-18273&t=shM0xaMmr8BYIX4e-1)",albertoperdomo,2024-12-10 11:33:20+00:00,['heypoom'],2024-12-17 17:26:01+00:00,2024-12-17 17:26:01+00:00,https://github.com/metabase/metabase/issues/51100,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2729849543,issue,closed,completed,Disable custom click action when in embedding sdk,"Contexts:
- https://metaboat.slack.com/archives/C06FCQT0KMZ/p1733768624642749
- https://metaboat.slack.com/archives/C06FCQT0KMZ/p1736331137834799

As a temporary solution, we want to disable click behavior in the SDK components. This would work in conjunction with https://github.com/metabase/metabase/issues/51970 where SDK users would be able to define their own click behavior",NevRA,2024-12-10 11:28:50+00:00,['heypoom'],2025-01-20 16:09:22+00:00,2025-01-20 15:31:47+00:00,https://github.com/metabase/metabase/issues/51099,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2729061785,issue,closed,completed,Implement native editor in CodeMirror,,romeovs,2024-12-10 05:35:04+00:00,[],2024-12-19 05:06:15+00:00,2024-12-19 05:06:14+00:00,https://github.com/metabase/metabase/issues/51090,[],"[{'comment_id': 2552796140, 'issue_id': 2729061785, 'author': 'romeovs', 'body': 'Closed by https://github.com/metabase/metabase/pull/50484', 'created_at': datetime.datetime(2024, 12, 19, 5, 6, 14, tzinfo=datetime.timezone.utc)}]","romeovs (Issue Creator) on (2024-12-19 05:06:14 UTC): Closed by https://github.com/metabase/metabase/pull/50484

"
2728698703,issue,open,,zoom-in.timeseries drill: support zoom in for clicks on timeseries breakout dimension cells,"Currently, the zoom-in.timeseries drill thru is only available when the user clicks on an aggregated cell value, and the drill selects the first timeseries dimension it finds in the query's breakout columns.

Consider also making the drill available when a user a clicks on a cell value for a timeseries breakout column, and use the clicked column as the selected dimension.

For example, given a table result like

```
| Created At: Month | Created At: Year | Count |
|-------------------+------------------+-------|
| July 2022         |             2022 |    11 |
``` 

If the user clicks on the cell with value ""2022"", show ""See this year by quarter"" in the drill through context menu.
If the user clicks on the cell with value ""July 2022"", show ""See this month by week"", etc.

**Context**

https://metaboat.slack.com/archives/C0645JP1W81/p1733772025429769",appleby,2024-12-10 01:27:50+00:00,[],2025-02-04 20:30:35+00:00,,https://github.com/metabase/metabase/issues/51088,"[('Type:New Feature', ''), ('.Backend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', '')]",[],
2728494831,issue,open,,Ability to disable Bookmarks,"**Is your feature request related to a problem? Please describe.**
Customer is building an embedding application and externalizing their own ""favorites"" or ""bookmarks"" feature.

**Describe the solution you'd like**
Ability to disable bookmarks in the application, with permissions or via the iFrame in the interactive embed.
",ixipixi,2024-12-09 23:14:01+00:00,[],2025-02-04 20:31:04+00:00,,https://github.com/metabase/metabase/issues/51086,"[('Type:New Feature', ''), ('Administration/Permissions', 'Collection or Data permissions'), ('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('Administration/Settings', '')]",[],
2728360483,issue,open,,"In Safari, Reducing the Tile Size of a Number viz Might Result in the Number Being truncated like a String Rather than Rounded","### Describe the bug

If you have a large number displayed on a dashboard and reduce the size of the tile manually or display it on a smaller screen the tile is usually displayed as a rounded number. In Safari, sometimes the user is instead presented with a number that's cut down like a string (with ellipses at the end). 

### To Reproduce

1. Set up a Question that's Sum of Total from Invoices
2. Add to a dashboard
3. In Chrome and Firefox changing the tile size results in the Number being rounded
4. In Safari, sometimes, the tile will be saved or displayed with ellipses at the end instead (as if a string is being truncated)

[Loom Recording](https://www.loom.com/oauth-callback?login_success=true&provider=slack-openid-connect&redir=https%3A%2F%2Fwww.loom.com%2Fshare%2F76622e115ed7420da873630e0b9475ce%3Fsid%3Df395f9bc-ffff-4633-ab42-86325e3beff1&redirectToLoomLaunchScreen=false&rollout_desktop_web_login=true&strategy=slack-openid-connect&user_role=client)

### Expected behavior

A full number should be displayed if possible

### Logs

_No response_

### Information about your Metabase installation

```JSON
v1.51.7
```

### Severity

annoying

### Additional context

_No response_",ixipixi,2024-12-09 21:54:08+00:00,['lorem--ipsum'],2025-02-04 20:31:52+00:00,,https://github.com/metabase/metabase/issues/51082,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Scalars', 'Numbers, progress bars, gauges'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2728330934,issue,open,reopened,Tooltip Changes Broke Ability to Display Certain Metrics and Dimensions in a Usable Fashion,"### Describe the bug

Let's say you have a Question with several measures and you want to create a scatterplot and leverage two other mtricss for the axes. In this fashion we could easily plot a count of events/object/etc at the intersection of two averages, for example. If you hovered on the bubble in the scatterplot the tooltip displayed the two averages with clear labels, like so, in 49:

![Image](https://github.com/user-attachments/assets/75f5b5c8-b632-4c7a-9223-6c1fd9cf0138)


In v50+ if you use two metrics for the axes, the value for the X-Axis metric is display as a title and it's not very clear:

![Image](https://github.com/user-attachments/assets/a2a8f593-ebd1-464f-814f-56981721183f)

~~In addition, under ""Display settings"" you can add other metrics but there's no way to intentionally display other Dimensions that may provide valuable context.~~ Seems like this was already updated in 51+.


### To Reproduce

1. Begin with Orders table in v50+
2. Create 2 averages and a count grouped by some fields
3. In viz settings choose a scatterplot
4. Set X-Axis to one average, y-axis to another average, bubble size to ""count""
5. View tooltip


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-12-03"",
      ""tag"": ""v1.51.6.5"",
      ""hash"": ""22b76e9""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.1 (Debian 15.1-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Killed usability of the tooltips on several scatterplots for a customer

### Additional context

_No response_",ixipixi,2024-12-09 21:37:14+00:00,['alxnddr'],2025-02-04 20:29:55+00:00,,https://github.com/metabase/metabase/issues/51080,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2531268568, 'issue_id': 2728330934, 'author': 'fraccaslo', 'body': ""@ixipixi thanks for opening the bug. Adding more context here as requested.\n\nIn my dashboards, I'm using interactive scatterplots for data exploration. I plot some data by two metrics (or three, leveraging the size), so that the user can see at a glance how any of them has performed, and then can learn more by hovering over. It worked really well with Metabase's customizable on-click behaviour too.\n\nI'll give an example with sports data, say football (soccer if you're US based). You could plot strikers by goals and expected goals. That tells you at a glance who's creating the most chances, who's transforming the most chances, who's over- and under-performing. But it's all quite useless if you cannot hover over and see what player (team, country, ...) each bubble corresponds to.\n\nFrom experience, that's a common use of scatterplots, and showing all the dimensions in the label (as it used to be) is sensible default behaviour."", 'created_at': datetime.datetime(2024, 12, 10, 11, 11, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2532127367, 'issue_id': 2728330934, 'author': 'ixipixi', 'body': 'Looks like this was partially addressed when this was fixed:\nhttps://github.com/metabase/metabase/issues/50630', 'created_at': datetime.datetime(2024, 12, 10, 15, 53, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2547200788, 'issue_id': 2728330934, 'author': 'jinwkim', 'body': '@ixipixi this is a breaking change for us as well. We use scatter plots extensively and have had shown all the dimensions in the label (as it used to be), as @fraccasio also pointed out above. How can you restore the previous behavior?', 'created_at': datetime.datetime(2024, 12, 17, 0, 10, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2547279692, 'issue_id': 2728330934, 'author': 'ixipixi', 'body': '@jinwkim what version are you running? You should be able to select the dimensions for the tooltips in v51.8+ or v52.2+.', 'created_at': datetime.datetime(2024, 12, 17, 1, 0, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2551897726, 'issue_id': 2728330934, 'author': 'jinwkim', 'body': ""@ixipixi we're now on 52, but we would need to go back to every single scatter plot (we have a lot) and select the dimensions... just to restore the functionality we already had. Is there a reason why such a breaking change was made? This is an urgent issue for us where we need to restore the tooltip showing all the dimensions by default."", 'created_at': datetime.datetime(2024, 12, 18, 17, 29, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2555967593, 'issue_id': 2728330934, 'author': 'alxnddr', 'body': 'Closed by https://github.com/metabase/metabase/pull/51480', 'created_at': datetime.datetime(2024, 12, 19, 23, 46, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2574157854, 'issue_id': 2728330934, 'author': 'ixipixi', 'body': '@alxnddr I think this one was closed in error. The tooltips were restored to prior behavior but this Github issue was actually about the labelling of the X and Y axis in the tooltips if both return numeric values. The conversation just got a little off topic!', 'created_at': datetime.datetime(2025, 1, 7, 0, 21, 15, tzinfo=datetime.timezone.utc)}]","fraccaslo on (2024-12-10 11:11:25 UTC): @ixipixi thanks for opening the bug. Adding more context here as requested.

In my dashboards, I'm using interactive scatterplots for data exploration. I plot some data by two metrics (or three, leveraging the size), so that the user can see at a glance how any of them has performed, and then can learn more by hovering over. It worked really well with Metabase's customizable on-click behaviour too.

I'll give an example with sports data, say football (soccer if you're US based). You could plot strikers by goals and expected goals. That tells you at a glance who's creating the most chances, who's transforming the most chances, who's over- and under-performing. But it's all quite useless if you cannot hover over and see what player (team, country, ...) each bubble corresponds to.

From experience, that's a common use of scatterplots, and showing all the dimensions in the label (as it used to be) is sensible default behaviour.

ixipixi (Issue Creator) on (2024-12-10 15:53:04 UTC): Looks like this was partially addressed when this was fixed:
https://github.com/metabase/metabase/issues/50630

jinwkim on (2024-12-17 00:10:04 UTC): @ixipixi this is a breaking change for us as well. We use scatter plots extensively and have had shown all the dimensions in the label (as it used to be), as @fraccasio also pointed out above. How can you restore the previous behavior?

ixipixi (Issue Creator) on (2024-12-17 01:00:57 UTC): @jinwkim what version are you running? You should be able to select the dimensions for the tooltips in v51.8+ or v52.2+.

jinwkim on (2024-12-18 17:29:14 UTC): @ixipixi we're now on 52, but we would need to go back to every single scatter plot (we have a lot) and select the dimensions... just to restore the functionality we already had. Is there a reason why such a breaking change was made? This is an urgent issue for us where we need to restore the tooltip showing all the dimensions by default.

alxnddr (Assginee) on (2024-12-19 23:46:51 UTC): Closed by https://github.com/metabase/metabase/pull/51480

ixipixi (Issue Creator) on (2025-01-07 00:21:15 UTC): @alxnddr I think this one was closed in error. The tooltips were restored to prior behavior but this Github issue was actually about the labelling of the X and Y axis in the tooltips if both return numeric values. The conversation just got a little off topic!

"
2728171154,issue,closed,completed,Custom Separator Style Isn't respected on Dashboard when Tile Size Reduced,"### Describe the bug

If you have a large scalar number displayed on a dashboard with a custom separate (like ""."" for thousands and "","" for decimal - this works fine when the number is fully expanded. If you shrink the tile on the dashboard until the number is abbreviated, it will display ""6.7M"" as the shortened version of a number like ""6.704.097,2"". It should display ""6,7M"". 

### To Reproduce

1. Create a Question that's the sum of invoice payments from the sample DB
2. In viz settings set separator style to ""100.100,00""
3. Add to a dashboard
4. See it display correctly when expanded
5. Shrink the tile
6. The rounded number doesn't respect the custom separator



### Expected behavior

Custom separator should be respected on the dashabord

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""snowflake"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-12-03"",
      ""tag"": ""v1.51.6.5"",
      ""hash"": ""22b76e9""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.1 (Debian 15.1-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Annoying

### Additional context

_No response_",ixipixi,2024-12-09 20:16:16+00:00,['alxnddr'],2025-01-31 05:45:56+00:00,2025-01-31 02:15:45+00:00,https://github.com/metabase/metabase/issues/51075,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2626357249, 'issue_id': 2728171154, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)', 'created_at': datetime.datetime(2025, 1, 31, 5, 45, 55, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2025-01-31 05:45:55 UTC):  This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)

"
2727530226,issue,closed,completed,Click behavior doesn't work for numeric columns for questions based on models,"### Describe the bug

Until now, it was possible to set a filter field of type Number in dashboard with a numeric value corresponding to a row ID. 
Specifically, I was using the click behavior feature to set the filter value with the ID of the row clicked.  

Today, I had to change the filter type from Number to ID for all my filters of this type because clicking no longer changed the filter value. 

For instance, that how my widget fetch the data used to set the filter:
```
SELECT  name, id
FROM
...
```


### To Reproduce

This is an example on how to setup the dashboard:

![Image](https://github.com/user-attachments/assets/51d327f1-9d83-4fc3-a33a-7f6115c7e5f1)

![Image](https://github.com/user-attachments/assets/5db7430f-4eca-44c5-a59e-9a59bebefeec)

![Image](https://github.com/user-attachments/assets/a96030f2-13e1-43aa-83de-5c5fc64db3a3)

The last image was the setting for the filter until today.

If the ""Filter or parameter type"" is set to ""ID"" the click behavior works fine.


### Expected behavior

To be in line with the previous version of metabase, the filter should be set even if the filter type is ""Number"" when a numeric ID is used to set its value.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.164.1-1.cm2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

blocking some users

### Additional context

_No response_",antoniocaia,2024-12-09 15:56:00+00:00,['ranquild'],2025-01-22 22:18:34+00:00,2025-01-22 18:27:17+00:00,https://github.com/metabase/metabase/issues/51058,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('Reporting/Dashboards/Click Behavior', ''), ('.Team/Querying', '')]","[{'comment_id': 2531507166, 'issue_id': 2727530226, 'author': 'kamilmielnik', 'body': 'I could reproduce it only by changing columns metadata **after** creating the parameter mapping.\nIn this case dashboard parameter mapping becomes [invalid](https://github.com/user-attachments/assets/98db118c-2ee4-451d-93b2-655666a3a011) and is not expected to work.\n\nTo reproduce:\n1. New > Model > Native > `SELECT * FROM (VALUES (1, \'Alice\'), (2, \'Bob\')) AS temp_table(id, name);` > Run the query\n2. Go to metadata tab > Click ID column > Set ""Column type"" to ""Quantity""\n3. Save as ""Model 51058""\n4. New > Question > Choose ""Model 51058"" as source > Save as ""Question 51058"" and add to new dashboard\n5. Add a ""Number"" filter to the dashboard and connect it to ID column from ""Question 51058""\n6. Set click behavior for that card to update dashboard filter when clicking the value in ID column\n7. Save dashboard\n8. Open ""Model 51058"" > Edit metadata > Click ID column > Set ""Column type"" to ""Entity key""\n9. Save\n10. Go back to dashboard\n11. Try out the click behavior\n\nNothing happens in app.\nError in JS console: `Uncaught TypeError: e.split is not a function` coming from [parseParameterValueForNumber](https://github.com/metabase/metabase/blob/c01d67df0ed9acd664b1c3dfde004c1515201aa1/frontend/src/metabase-lib/v1/parameters/utils/parameter-parsing.ts#L68) with the value being `2`, not a string.\n\n----\n\nI can also reproduce in 0.51.7', 'created_at': datetime.datetime(2024, 12, 10, 12, 30, 5, tzinfo=datetime.timezone.utc)}, {'comment_id': 2531989008, 'issue_id': 2727530226, 'author': 'antoniocaia', 'body': 'Hi, thanks for the feedback.\n\nI tried to replicate my experience using your steps, and unlike you I got the same error as you using from the start ""Entity key"" with ""Number"" filter type.\n\nMy steps:\n1. New > Model > Native > SELECT * FROM (VALUES (1, \'Alice\'), (2, \'Bob\')) AS temp_table(id, name); > Run the query\n2. Save as ""Model 51058""\n3. New > Question > Choose ""Model 51058"" as source > Save as ""Question 51058"" and add to new dashboard\n4. Add a ""Number"" filter to the dashboard and connect it to ID column from ""Question 51058""\n5. Set click behavior for that card to update dashboard filter when clicking the value in ID column\n6. Save dashboard\n7. Try out the click behavior\nNo change in the filter when clicking on the ID column; the JS Console gave me the same error as you:\n`Uncaught TypeError: e.split is not a function`\n8. Change the filter to be of type ""ID""\n9. Save\n10. Try out the click behavior\nEverything works fine.\n\nI want to point out again that using the type ""Number"" was fine until some time ago.\n\nCould only test on 0.52.1\n\nI hope my comment can be somehow helpful, because my case looks to me different from yours. Cheers.', 'created_at': datetime.datetime(2024, 12, 10, 15, 16, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2605786733, 'issue_id': 2727530226, 'author': 'ranquild', 'body': 'Can confirm that click behaviors is broken for numeric columns where the question is based on a model, working on a fix', 'created_at': datetime.datetime(2025, 1, 21, 21, 35, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2607564524, 'issue_id': 2727530226, 'author': 'JHayakaze', 'body': 'Hi,\n\nI am finding this is also happening on a string column click behavior is also throwing the e.split error. I am on the newest version v0.52.6, it was previously working prior to updating. Hoping this fix for the problem described above will also fix the problem I am facing.\n\nThanks.', 'created_at': datetime.datetime(2025, 1, 22, 15, 32, 31, tzinfo=datetime.timezone.utc)}]","kamilmielnik on (2024-12-10 12:30:05 UTC): I could reproduce it only by changing columns metadata **after** creating the parameter mapping.
In this case dashboard parameter mapping becomes [invalid](https://github.com/user-attachments/assets/98db118c-2ee4-451d-93b2-655666a3a011) and is not expected to work.

To reproduce:
1. New > Model > Native > `SELECT * FROM (VALUES (1, 'Alice'), (2, 'Bob')) AS temp_table(id, name);` > Run the query
2. Go to metadata tab > Click ID column > Set ""Column type"" to ""Quantity""
3. Save as ""Model 51058""
4. New > Question > Choose ""Model 51058"" as source > Save as ""Question 51058"" and add to new dashboard
5. Add a ""Number"" filter to the dashboard and connect it to ID column from ""Question 51058""
6. Set click behavior for that card to update dashboard filter when clicking the value in ID column
7. Save dashboard
8. Open ""Model 51058"" > Edit metadata > Click ID column > Set ""Column type"" to ""Entity key""
9. Save
10. Go back to dashboard
11. Try out the click behavior

Nothing happens in app.
Error in JS console: `Uncaught TypeError: e.split is not a function` coming from [parseParameterValueForNumber](https://github.com/metabase/metabase/blob/c01d67df0ed9acd664b1c3dfde004c1515201aa1/frontend/src/metabase-lib/v1/parameters/utils/parameter-parsing.ts#L68) with the value being `2`, not a string.

----

I can also reproduce in 0.51.7

antoniocaia (Issue Creator) on (2024-12-10 15:16:57 UTC): Hi, thanks for the feedback.

I tried to replicate my experience using your steps, and unlike you I got the same error as you using from the start ""Entity key"" with ""Number"" filter type.

My steps:
1. New > Model > Native > SELECT * FROM (VALUES (1, 'Alice'), (2, 'Bob')) AS temp_table(id, name); > Run the query
2. Save as ""Model 51058""
3. New > Question > Choose ""Model 51058"" as source > Save as ""Question 51058"" and add to new dashboard
4. Add a ""Number"" filter to the dashboard and connect it to ID column from ""Question 51058""
5. Set click behavior for that card to update dashboard filter when clicking the value in ID column
6. Save dashboard
7. Try out the click behavior
No change in the filter when clicking on the ID column; the JS Console gave me the same error as you:
`Uncaught TypeError: e.split is not a function`
8. Change the filter to be of type ""ID""
9. Save
10. Try out the click behavior
Everything works fine.

I want to point out again that using the type ""Number"" was fine until some time ago.

Could only test on 0.52.1

I hope my comment can be somehow helpful, because my case looks to me different from yours. Cheers.

ranquild (Assginee) on (2025-01-21 21:35:14 UTC): Can confirm that click behaviors is broken for numeric columns where the question is based on a model, working on a fix

JHayakaze on (2025-01-22 15:32:31 UTC): Hi,

I am finding this is also happening on a string column click behavior is also throwing the e.split error. I am on the newest version v0.52.6, it was previously working prior to updating. Hoping this fix for the problem described above will also fix the problem I am facing.

Thanks.

"
2727509708,issue,closed,completed,Switching Snowflake to RSA Auth after Password Auth is Confusing,"### Describe the bug

If you have Snowflake set up with password authentication and then edit the connection to key pair auth, Metabase will give you a ""Success"" message for the update even if it fails. When you navigate away from the page it tells you there are unsaved changes. If you leave and return nothing indicates that this is now set up with an RSA key - it looks like password auth.

### To Reproduce

1. Create a keypair for Snowflake
2. Set up a connection to test authenticating the user with the key pair to confirm it works 
3. Now set up a DB connection for a different user with username / password auth (not associated with the keypair)
4. Once it's working try to edit the connection and add the key pair
5. Note that the changes appear to be saved
6. Try to leave the page (you'll be prompted that there are unsaved changes)
7. If you leave and return the key pair settings are gone and the password is still there
8. If you *remove* the password before you attempt to save it seems like it will attempt the keypair auth and return a failed error but if you don't scrub the password it will simply connect with the password and ignore the RSA key entirely

This flow is generally confusing from a UX perspective.

### Expected behavior

Perhaps we shouldn't allow both the RSA and password to be set?

### Logs
https://www.loom.com/share/1e4e7d7efcf04c308567f20e77cc7b6d

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""snowflake"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-12-03"",
      ""tag"": ""v1.51.6.5"",
      ""hash"": ""22b76e9""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.1 (Debian 15.1-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

really confusing (and concerning for users trying to switch to keypair auth)

### Additional context

Users cannot tell, when they switch between user/password auth and keypair auth, whether or not the changes persisted. To add more confusion, if you set a brand new Snowflake connection using RSA key pair from the beginning, visiting the connection after it's set up shows dots in the password field. Nothing really indicates that a key pair is in use.",ixipixi,2024-12-09 15:49:38+00:00,[],2025-01-10 16:45:29+00:00,2025-01-10 16:45:29+00:00,https://github.com/metabase/metabase/issues/51057,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Database/Snowflake', ''), ('.Backend', ''), ('.Team/Drivers', '')]",[],
2727438874,issue,open,,Goal line doesn't appear when histogram is stacked 100%,"### Describe the bug

Hi.
When using a Goal line on a stackable histogram, it simply doesn't appear.
As far as I can remember, it appeared in some older versions.

![Image](https://github.com/user-attachments/assets/a77b7510-040a-460a-a7ae-bd73c5f37b67)

Good job mates.

### To Reproduce

1. Go to result of a query
2. Click on visualization, select Histogram
3. Select visualization options, select stacked to 100%
4. check the goal line option
5. set a value for the goal (0-100%)
7. the line doesn't appear

### Expected behavior

The line must appear :)

### Logs

No log provided about this

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""fr"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.16 (Debian 13.16-0+deb11u1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""17.0.12+7-Debian-2deb11u1"",
    ""java.vendor"": ""Debian"",
    ""java.vendor.url"": ""https://tracker.debian.org/openjdk-17"",
    ""java.version"": ""17.0.12"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""17.0.12+7-Debian-2deb11u1"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.0-32-amd64"",
    ""user.language"": ""fr"",
    ""user.timezone"": ""Europe/Paris""
  }
}
```

### Severity

medium

### Additional context

_No response_",labiloute,2024-12-09 15:27:28+00:00,[],2025-02-04 20:31:17+00:00,,https://github.com/metabase/metabase/issues/51054,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2727276341,issue,closed,completed,Port EntityName to use RTK Query,,kamilmielnik,2024-12-09 14:45:06+00:00,['kamilmielnik'],2025-01-27 22:13:21+00:00,2024-12-16 16:01:34+00:00,https://github.com/metabase/metabase/issues/51050,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]",[],
2727245830,issue,open,,Be more suggestive of exiting alerts in the UI when questions don't have any results,"**Is your feature request related to a problem? Please describe.**
Even though you have set up an alert for a question, we don't show that in the UI when the question doesn't have results. This can be a bit confusing: ""You can also get an alert when there are some results.""

![Image](https://github.com/user-attachments/assets/c90263ab-c36f-49b3-b1ba-240acfbf02b7)


**Describe the solution you'd like**
We could be a little more suggestive around the alerts the user already has on that question and link to the edit alerts page.

**Describe alternatives you've considered**
N/A

**How important is this feature to you?**
Requested by a customer, link to ticket [here](https://app.usepylon.com/issues?conversationID=17b36773-539b-4747-86f9-ee740acbe515)

**Additional context**
N/A
",ignacio-mb,2024-12-09 14:36:30+00:00,[],2025-02-04 20:30:48+00:00,,https://github.com/metabase/metabase/issues/51048,"[('Type:New Feature', ''), ('Reporting/Alerts', ''), ('.Frontend', ''), ('.Team/Workflows', 'aka BEC')]",[],
2727024754,issue,closed,completed,Remove EntityLink,"- [x] `entity.Link`
- [x] `TableBrowser`
- [x] `DashboardMoveModal`
- [x] `QuestionMoveToast.styled`",kamilmielnik,2024-12-09 13:14:17+00:00,['kamilmielnik'],2025-01-27 22:13:43+00:00,2024-12-11 09:10:28+00:00,https://github.com/metabase/metabase/issues/51041,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]",[],
2726801907,issue,closed,completed,"Make static/public/sdk (LocaleProvider) support locales in the `xx-yy` format, and also support the fallback to `xx` if `xx-yy` doesn't exist","**Context**

https://metaboat.slack.com/archives/C063Q3F1HPF/p1733501696469049

Currently everything that uses LocaleProvider (so static/public and sdk) for changing the locale don't support the following:
- locales like `xx-yy` are not working, as we we try to look for the file `xx-yy.json` when they're called `xx_yy.json`
- when passing `xx-yy` it won't work if we only have `xx`

Both these issues are also a different behaviour than `?locale=xx` in interactive embedding, where both things are supported, we should replicate the same behaviour of the BE/?locale= parameter.",npretto,2024-12-09 11:43:26+00:00,['npretto'],2024-12-20 16:35:17+00:00,2024-12-20 14:11:09+00:00,https://github.com/metabase/metabase/issues/51039,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]","[{'comment_id': 2557351984, 'issue_id': 2726801907, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)', 'created_at': datetime.datetime(2024, 12, 20, 16, 35, 16, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-20 16:35:16 UTC):  This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)

"
2726516384,issue,closed,completed,Sharing dropdown styling issues,"### Describe the bug

![Image](https://github.com/user-attachments/assets/0be51ac9-9c88-4321-81c8-b9bbc9ae747c)

### To Reproduce

1. New > Question > Orders > Visualize > Save
2. Click ""Sharing"" button to open the dropdown

 Padding on top of the dropdown is different than padding at the bottom

3. Hover ""Create a public link"" or ""Embed"" 

 Item text is not blue


### Information about your Metabase installation

master, 59c5690

### Severity

P3
",kamilmielnik,2024-12-09 09:43:57+00:00,['kamilmielnik'],2025-01-31 13:21:51+00:00,2025-01-31 13:07:44+00:00,https://github.com/metabase/metabase/issues/51036,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Difficulty:Easy', ''), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', '')]","[{'comment_id': 2627293544, 'issue_id': 2726516384, 'author': 'kamilmielnik', 'body': 'Fixed by #51229', 'created_at': datetime.datetime(2025, 1, 31, 13, 7, 44, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2025-01-31 13:07:44 UTC): Fixed by #51229

"
2726509145,issue,closed,completed,Empty tooltip shown when save button is disabled,"### Describe the bug

![Image](https://github.com/user-attachments/assets/b43c3615-9d9f-4694-b106-962c2265d2d5)


### To Reproduce

1. New > SQL Query
2. Hover ""Save"" button

### Information about your Metabase installation

master, 59c5690bd6cfffbfc787088c2ca2bd9dc1bb1b44

### Severity

P3

",kamilmielnik,2024-12-09 09:41:01+00:00,['kamilmielnik'],2025-01-31 15:31:31+00:00,2025-01-31 14:16:38+00:00,https://github.com/metabase/metabase/issues/51035,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Querying/Native', 'The SQL/native query editor'), ('Difficulty:Easy', ''), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2564838755, 'issue_id': 2726509145, 'author': 'dbarabashh', 'body': 'hey @kamilmielnik, i found this product really interesting from an engineering perspective and decided to help out a bit with this task.\n\ni didnt cover all the edge cases at first, but it should work as expected now. happy to help', 'created_at': datetime.datetime(2024, 12, 29, 21, 7, 24, tzinfo=datetime.timezone.utc)}]","dbarabashh on (2024-12-29 21:07:24 UTC): hey @kamilmielnik, i found this product really interesting from an engineering perspective and decided to help out a bit with this task.

i didnt cover all the edge cases at first, but it should work as expected now. happy to help

"
2725573577,issue,open,,Trend date display supports range for native SQL queries,"**Is your feature request related to a problem? Please describe.**
When grouping a question by a time dimension using the GUI, the trend visualisation will display the relevant date range. However, for native SQL queries, we're unable to get this behavior and only get the start of the date range.

**Describe the solution you'd like**
Allow the end point of the date range to be returned from the SQL query in a second column and used in the date range string in the trend chart.

**Describe alternatives you've considered**
Being able to provide the entire date range string as a column would also solve the problem, and would be even more flexible.

**How important is this feature to you?**
Very useful, since at the moment there are some questions we can't express using the GUI (eg. get the totals for an *arbitrary* selected period that isn't necessarily one of the built-in time groupings, plus the prior period of the same length).

**Additional context**
This relates to the broader #48036, which was partly resolved by fixing a formatting regression.",willbryant,2024-12-08 22:44:51+00:00,[],2025-02-04 20:31:51+00:00,,https://github.com/metabase/metabase/issues/51028,"[('Type:New Feature', ''), ('Visualization/Scalars', 'Numbers, progress bars, gauges')]","[{'comment_id': 2526419991, 'issue_id': 2725573577, 'author': 'willbryant', 'body': 'The relevant code is here, in SmartScalar/compute.js:\n\n```\nfunction formatDateStr({ date, dateUnitSettings, options }) {\n  const { dateColumn, dateColumnSettings, dateUnit, queryType } =\n    dateUnitSettings;\n\n  if (isEmpty(dateUnit) || queryType === ""native"") {\n    return formatValue(date, {\n      ...dateColumnSettings,\n      column: dateColumn,\n    });\n  }\n\n  return formatDateTimeRangeWithUnit([date], dateUnit, {\n    ...options,\n    compact: true,\n  });\n}\n```\n\nNote that `formatDateTimeRangeWithUnit` *calculates* the date range (using `to-range`), it doesn\'t get passed it:\n\n```\n(defn ^:export format-range-with-unit\n  ""Returns a string with this datetime formatted as a range, rounded to the given `:unit`.""\n  [value options]\n  (let [options (options/prepare-options options)\n        t       (u.time/coerce-to-timestamp value options)]\n    (if (u.time/valid? t)\n      (format-range-with-unit-inner (u.time/to-range t options) options)\n      ;; Best-effort fallback if we failed to parse - .toString the input.\n      (str value))))\n```\n\nTo be able to pass in a second column, we\'d need to expose the function currently called `format-range-with-unit-inner`, and allow an extra column selection to be provided.', 'created_at': datetime.datetime(2024, 12, 8, 22, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2526422260, 'issue_id': 2725573577, 'author': 'willbryant', 'body': 'Note that the Trend vis doesn\'t actually let you select the column. If you have two date columns, you get a ""Group only by a time field to see how this has changed over time"" error.\n\nIf we *could* select the column, then IMHO the alternative solution could be as simple as, if a string column is selected then use that verbatim as the date string, rather than trying to format it. This would avoid needing to be able to select two columns as inputs to the date-range formatting function.', 'created_at': datetime.datetime(2024, 12, 8, 22, 53, 42, tzinfo=datetime.timezone.utc)}, {'comment_id': 2560171440, 'issue_id': 2725573577, 'author': 'ixipixi', 'body': 'Related: https://github.com/metabase/metabase/issues/51641', 'created_at': datetime.datetime(2024, 12, 23, 19, 2, 7, tzinfo=datetime.timezone.utc)}]","willbryant (Issue Creator) on (2024-12-08 22:47:00 UTC): The relevant code is here, in SmartScalar/compute.js:

```
function formatDateStr({ date, dateUnitSettings, options }) {
  const { dateColumn, dateColumnSettings, dateUnit, queryType } =
    dateUnitSettings;

  if (isEmpty(dateUnit) || queryType === ""native"") {
    return formatValue(date, {
      ...dateColumnSettings,
      column: dateColumn,
    });
  }

  return formatDateTimeRangeWithUnit([date], dateUnit, {
    ...options,
    compact: true,
  });
}
```

Note that `formatDateTimeRangeWithUnit` *calculates* the date range (using `to-range`), it doesn't get passed it:

```
(defn ^:export format-range-with-unit
  ""Returns a string with this datetime formatted as a range, rounded to the given `:unit`.""
  [value options]
  (let [options (options/prepare-options options)
        t       (u.time/coerce-to-timestamp value options)]
    (if (u.time/valid? t)
      (format-range-with-unit-inner (u.time/to-range t options) options)
      ;; Best-effort fallback if we failed to parse - .toString the input.
      (str value))))
```

To be able to pass in a second column, we'd need to expose the function currently called `format-range-with-unit-inner`, and allow an extra column selection to be provided.

willbryant (Issue Creator) on (2024-12-08 22:53:42 UTC): Note that the Trend vis doesn't actually let you select the column. If you have two date columns, you get a ""Group only by a time field to see how this has changed over time"" error.

If we *could* select the column, then IMHO the alternative solution could be as simple as, if a string column is selected then use that verbatim as the date string, rather than trying to format it. This would avoid needing to be able to select two columns as inputs to the date-range formatting function.

ixipixi on (2024-12-23 19:02:07 UTC): Related: https://github.com/metabase/metabase/issues/51641

"
2724898092,issue,open,,"Option for downloads in dashboards need to include all the fields, not the ones that are visible","**Is your feature request related to a problem? Please describe.**
A customer needs the downloads to have all the fields, since they need those files to upload the data to the CRM, but they still want the dashboards to have a limited amount of columns

**Describe the solution you'd like**
A toggle that let's the user pick to download only the visible fields or all the fields that are hidden as well

**Describe alternatives you've considered**
None

**How important is this feature to you?**
See above

**Additional context**
Creating the issue to track thumbs up
",paoliniluis,2024-12-08 01:46:31+00:00,[],2025-02-04 20:31:00+00:00,,https://github.com/metabase/metabase/issues/51021,"[('Reporting/Dashboards', ''), ('Type:New Feature', ''), ('Reporting/Export', '')]",[],
2724840232,issue,closed,completed,Updating a filter via click behavior will not populate the field on actions,"### Describe the bug

If you populate a filter in a dashboard by using a click behavior, then this field will not be used in an action if the action requires that field

### To Reproduce

1) enable actions in settings->admin->databases->pick your db->enable model actions
2) create a model (e.g. a select of the people table)
3) go to the model reference and create the basic actions (click on the little book you see when hovering over a model and then actions tab -> create actions)
4) then create a dashboard and add the model, then add a filter connected to the ID field and then make a click behavior to populate the ID field when clicking on the ID column of the table
5) add an update action to the dashboard, that connects to the UPDATE action of the model (set that the ID field will come prepopulated from the filter)
6) then save the dashboard and click on any ID
7) now click on the action and try to modify any field, you'll get an error saying that ID is required

### Expected behavior

The ID field should be obtained from the filter

### Logs

NA

### Information about your Metabase installation

```JSON
v52.1, but I'm thinking that this comes from way way before
```

### Severity

P1

### Additional context

It's interesting since not using a click behavior and just selecting the ID value will work, so definitely there's something on the click behavior there",paoliniluis,2024-12-07 22:35:01+00:00,['kamilmielnik'],2024-12-13 09:21:38+00:00,2024-12-13 08:18:17+00:00,https://github.com/metabase/metabase/issues/51020,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('Querying/Actions', ''), ('.Team/Querying', '')]","[{'comment_id': 2531547906, 'issue_id': 2724840232, 'author': 'kamilmielnik', 'body': 'I can also reproduce in 0.51.7.\n\nAnd not only with click behavior, it also happens when navigating to dashboard with parameter set in the URL', 'created_at': datetime.datetime(2024, 12, 10, 12, 48, 56, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Assginee) on (2024-12-10 12:48:56 UTC): I can also reproduce in 0.51.7.

And not only with click behavior, it also happens when navigating to dashboard with parameter set in the URL

"
2724810035,issue,closed,completed,"Every time the /session/properties is hit, we fire a ton of count queries to the core_user table","### Describe the bug

Just saw this by chance while doing some tests, but every time we hit the api/session/properties endpoint we send this query to the app db tens of times
2024-12-07 20:51:25.959 UTC [108] LOG:  execute S_2: SELECT COUNT(*) AS ""count"" FROM ""core_user"" WHERE (""is_active"" = TRUE) AND (""type"" = $1)
2024-12-07 20:51:25.959 UTC [108] DETAIL:  Parameters: $1 = 'personal'

![Image](https://github.com/user-attachments/assets/a26c52b3-d9f8-4521-82f3-7da96070b408)



### To Reproduce

1) set up 52
2) hit the endpoint

(I have 2 users and a group set up, don't know if that has to do with this)

### Expected behavior

We shouldn't make so many queries

### Logs

NA

### Information about your Metabase installation

```JSON
v52
```

### Severity

P2

### Additional context

_No response_",paoliniluis,2024-12-07 20:53:57+00:00,[],2024-12-19 07:02:46+00:00,2024-12-07 21:26:40+00:00,https://github.com/metabase/metabase/issues/51019,"[('Type:Bug', 'Product defects'), ('.Needs Triage', ''), ('Bug:v52', 'bugs or regressions introduced in v52'), ('Cloud-Blocker:52', 'Issues blocking the cloud customers to be upgraded to v52')]",[],
2724232121,issue,closed,completed,Click behavior uses numerical ID's for tabs so serialization does not work with dashboard tabs,"### Describe the bug

Interesting bug that a customer reported where subsequent changes in the staging environment leads to wrong destinations in click behavior when you use serialization

### To Reproduce

1) deploy 2 instances: origin and destination
2) create a simple card (e.g. count of people per source, make a row chart) 
3) create a dashboard in the origin which has 2 tabs and add the card to the first tab, which has a click behavior that opens the second tab of the same dashboard
4) export from origin and now import into destination
5) now on the origin do the following:
5.1) edit the dashboard, delete the second tab and save the dashboard
5.2) edit again the dashboard, add a tab and save the dashboard
5.3) edit again the dashboard, delete the tab and save the dashboard
5.4) edit again the dashboard, add the tab and save the dashboard
6) make sure that the click behavior works, so go to the card in tab one and make sure that the click behavior opens the second tab
7) now export from origin and import to destination

As the tab in the origin is now a few id's over the id's of the destination the click behavior will not be able to link to the tab via serialization, so the only way to make it work is to delete the origin and restore a backup from the destination into the origin

### Expected behavior

This should be painless

### Logs

NA

### Information about your Metabase installation

```JSON
it has always been like this
```

### Severity

P1

### Additional context

NA",paoliniluis,2024-12-07 01:20:58+00:00,[],2024-12-22 13:06:00+00:00,2024-12-21 10:07:25+00:00,https://github.com/metabase/metabase/issues/51018,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('Operation/Serialization', 'Enterprise contents migration'), ('.Escalation', ''), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2529941469, 'issue_id': 2724232121, 'author': 'bunny-rich', 'body': '+1', 'created_at': datetime.datetime(2024, 12, 10, 0, 56, 31, tzinfo=datetime.timezone.utc)}, {'comment_id': 2557045972, 'issue_id': 2724232121, 'author': 'piranha', 'body': ""I'm looking into this and it's not clear to me how do you set up a link to another tab, is this just a custom destination URL where you put tab's URL?"", 'created_at': datetime.datetime(2024, 12, 20, 13, 44, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2558450213, 'issue_id': 2724232121, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)', 'created_at': datetime.datetime(2024, 12, 22, 13, 5, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2558450343, 'issue_id': 2724232121, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.51.10](https://github.com/metabase/metabase/milestone/295)', 'created_at': datetime.datetime(2024, 12, 22, 13, 5, 49, tzinfo=datetime.timezone.utc)}, {'comment_id': 2558450407, 'issue_id': 2724232121, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.50.36](https://github.com/metabase/metabase/milestone/289)', 'created_at': datetime.datetime(2024, 12, 22, 13, 5, 59, tzinfo=datetime.timezone.utc)}]","bunny-rich on (2024-12-10 00:56:31 UTC): +1

piranha on (2024-12-20 13:44:18 UTC): I'm looking into this and it's not clear to me how do you set up a link to another tab, is this just a custom destination URL where you put tab's URL?

github-actions[bot] on (2024-12-22 13:05:27 UTC):  This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)

github-actions[bot] on (2024-12-22 13:05:49 UTC):  This should also be released by [v0.51.10](https://github.com/metabase/metabase/milestone/295)

github-actions[bot] on (2024-12-22 13:05:59 UTC):  This should also be released by [v0.50.36](https://github.com/metabase/metabase/milestone/289)

"
2723986498,issue,open,,Should we include the things we left behind in serialization?,"### Describe the bug

Checking some other bug, it seems that we left many attributes behind: https://github.com/metabase/metabase/issues/29837. E.g. landing page gets dumped but the value will be always null. Should we include those again?

### To Reproduce

1) configure a landing page
2) export the instance. Check the values that get dumped

### Expected behavior

Should we dump all the values?

### Logs

NA

### Information about your Metabase installation

```JSON
It has been always like that
```

### Severity

P3

### Additional context

_No response_",paoliniluis,2024-12-06 21:50:18+00:00,[],2025-02-04 20:26:37+00:00,,https://github.com/metabase/metabase/issues/51015,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Backend', ''), ('Operation/Serialization', 'Enterprise contents migration'), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2572867084, 'issue_id': 2723986498, 'author': 'piranha', 'body': '/cc @luizarakaki', 'created_at': datetime.datetime(2025, 1, 6, 10, 56, 20, tzinfo=datetime.timezone.utc)}]","piranha on (2025-01-06 10:56:20 UTC): /cc @luizarakaki

"
2723599755,issue,closed,completed,Onboarding accordion items can sometimes expand outside the viewport,"Like the title says - onboarding accordion items can sometimes expand outside the viewport. This is actually a native Mantine accordion behavior *when only a single item is allowed to be open at a time*. We should try to resolve it and improve the user experience, nevertheless.

### Explanation of why this happens (repro):
- Only one item can be open
- You opened the top one
- You scroll the page so that the currently opened item is outside the viewport
- You open the item below it
- The top one collapses and effectively pulls the newly opened item upwards

### Demo
https://github.com/user-attachments/assets/63b84ac4-3bae-40d6-937d-4224365a2c31
",nemanjaglumac,2024-12-06 17:41:51+00:00,['nemanjaglumac'],2024-12-12 11:43:26+00:00,2024-12-12 10:59:07+00:00,https://github.com/metabase/metabase/issues/51006,"[('Type:UX', ''), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('First Experience/Onboarding', '')]",[],
2723559308,issue,open,,Arrows in the column names makes searching for fields impossible,"### Describe the bug

How can you write an arrow in the search box?
![Image](https://github.com/user-attachments/assets/efd56365-6431-4734-afe6-0f97fe7b8a72)


### To Reproduce

do a join and then search for a joined field in the filters section

### Expected behavior

You should be able to search for the field

### Logs

NA

### Information about your Metabase installation

```JSON
It has been like this since forever
```

### Severity

P2

### Additional context

Please let's remove the arrows https://github.com/metabase/metabase/issues/43152",paoliniluis,2024-12-06 17:21:09+00:00,[],2025-02-04 20:31:04+00:00,,https://github.com/metabase/metabase/issues/51004,"[('Type:New Feature', ''), ('.Frontend', ''), ('Querying/Notebook/Custom Expression', ''), ('.Team/Querying', '')]","[{'comment_id': 2527843265, 'issue_id': 2723559308, 'author': 'mngr', 'body': 'Ideally the autocomplete should fetch the records even if some symbols don\'t match.\nLike if I enter ""people name"" I expect `People - User -> Name` column to be shown in the suggests.\nBut that\'s more of a new feature request.', 'created_at': datetime.datetime(2024, 12, 9, 12, 51, 20, tzinfo=datetime.timezone.utc)}]","mngr on (2024-12-09 12:51:20 UTC): Ideally the autocomplete should fetch the records even if some symbols don't match.
Like if I enter ""people name"" I expect `People - User -> Name` column to be shown in the suggests.
But that's more of a new feature request.

"
2723310299,issue,closed,completed,Add ChartSettings button to InteractiveQuestion,"https://github.com/metabase/metabase/pull/51154 is blocked until I get, at least, `ChartSettingSelect` in. I want to get  `ChartSettingOrderedItems` with this because they need to have the same styles so it doesn't look disjointed on the core app.

The other ones are optional in terms of features, but are important for polish and theming

```[tasklist]
### Tasks
- [ ] #50998
- [ ] #50994
- [ ] https://github.com/metabase/metabase/pull/51000
- [ ] https://github.com/metabase/metabase/pull/51162
- [ ] https://github.com/metabase/metabase/pull/51210
- [ ] https://github.com/metabase/metabase/pull/51165
- [ ] https://github.com/metabase/metabase/pull/51223
- [ ] #50977
- [ ] https://github.com/metabase/metabase/pull/51332
- [ ] https://github.com/metabase/metabase/pull/51154
- [ ] #50976
```
",oisincoveney,2024-12-06 15:25:19+00:00,['oisincoveney'],2025-01-10 10:48:58+00:00,2025-01-10 10:48:58+00:00,https://github.com/metabase/metabase/issues/50999,[],[],
2723192825,issue,closed,completed,Cancelled requests are overly verbose,"When using strict mode in React (default in development for later versions of Node), a request is opened, it's cancelled and a follow-up request is made.
It seems this makes the back-end throw an exception on every cancelled request. Do we consider this an issue?
In the logs:

```
[backend] 2024-12-06 09:48:05,234 ERROR query-processor.streaming :: Client closed connection prematurely
[backend] org.eclipse.jetty.io.EofException
[backend] 	at org.eclipse.jetty.io.SocketChannelEndPoint.flush(SocketChannelEndPoint.java:116)
[backend] 	at org.eclipse.jetty.io.WriteFlusher.flush(WriteFlusher.java:422)
[backend] 	at org.eclipse.jetty.io.WriteFlusher.write(WriteFlusher.java:275)
[backend] 	at org.eclipse.jetty.io.WriteFlusher.write(WriteFlusher.java:254)
[backend] 	at org.eclipse.jetty.io.AbstractEndPoint.write(AbstractEndPoint.java:386)
[backend] 	at org.eclipse.jetty.server.HttpConnection$SendCallback.process(HttpConnection.java:849)
[backend] 	at org.eclipse.jetty.util.IteratingCallback.processing(IteratingCallback.java:243)
[backend] 	at org.eclipse.jetty.util.IteratingCallback.iterate(IteratingCallback.java:224)
[backend] 	at org.eclipse.jetty.server.HttpConnection.send(HttpConnection.java:600)
[backend] 	at org.eclipse.jetty.server.HttpChannel.sendResponse(HttpChannel.java:1051)
[backend] 	at org.eclipse.jetty.server.HttpChannel.write(HttpChannel.java:1123)
```

Some context from Nicol:
> The last couple of versions of react enables ""strict mode"" by default in development mode.
This means that most sdk users have strict mode on when trying things locally.
Strict mode calls ""effects"" twice, it basically mounts a component, un-mounts it, and then remounts it. This is to help catching issues, like for example not cancelling ongoing requests when un-mounting a component/changing page before the request finishes.
This means that some sdk components are mounting (-> start a fetch request), un-mounting (cancelling it), and then re-mounting (making a new request).",dpsutton,2024-12-06 14:28:30+00:00,[],2024-12-10 20:54:20+00:00,2024-12-10 09:59:57+00:00,https://github.com/metabase/metabase/issues/50992,"[('Type:New Feature', ''), ('.Needs Triage', '')]",[],
2723068229,issue,closed,completed,filter-data,,perivamsi,2024-12-06 13:29:53+00:00,['metamben'],2024-12-18 18:20:26+00:00,2024-12-18 18:20:25+00:00,https://github.com/metabase/metabase/issues/50988,[],"[{'comment_id': 2551989103, 'issue_id': 2723068229, 'author': 'metamben', 'body': 'Implemented in #51452.', 'created_at': datetime.datetime(2024, 12, 18, 18, 20, 25, tzinfo=datetime.timezone.utc)}]","metamben (Assginee) on (2024-12-18 18:20:25 UTC): Implemented in #51452.

"
2723068116,issue,closed,completed,query-metric,,perivamsi,2024-12-06 13:29:49+00:00,['metamben'],2024-12-18 18:22:34+00:00,2024-12-18 18:22:33+00:00,https://github.com/metabase/metabase/issues/50987,[],"[{'comment_id': 2551993214, 'issue_id': 2723068116, 'author': 'metamben', 'body': 'Implemented in #51315.', 'created_at': datetime.datetime(2024, 12, 18, 18, 22, 33, tzinfo=datetime.timezone.utc)}]","metamben (Assginee) on (2024-12-18 18:22:33 UTC): Implemented in #51315.

"
2723058350,issue,closed,not_planned,Locale configuration not working in static embedding after upgrading to v0.52.1,"### Describe the bug

I recently upgraded to Metabase v0.52.1, and the locale configuration in static embeddings has stopped working. According to the changelog, the following feature was introduced:
```
Language localization in static embedding with hash parameter #locale=xx
```
Before upgrading, I had several static embeddings where all dashboards were designed to display in English. These dashboards were embedded using the following format:
```
.../embed/dashboard/...?locale=en#...

```
This worked perfectly fine in previous versions. However, since the update, this functionality is broken.

I also tried changing the locale configuration to:
```
.../embed/dashboard/...#locale=en&...
```
But this doesnt work either.

I saw in the PR that theres support for public dashboards, but it seems like this might have introduced a regression in static embeddings. The discrepancy between the changelog and the actual behavior is quite confusing.

### To Reproduce

1. Embed a dashboard using the URL format: .../embed/dashboard/...?locale=en#...
2. Verify if the locale configuration works as expected after upgrading to v0.52.1.

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""es-ES"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.20""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9-LTS"",
    ""java.vendor"": ""Red Hat, Inc."",
    ""java.vendor.url"": ""https://www.redhat.com/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""3.10.0-1160.114.2.el7.x86_64"",
    ""user.language"": ""es"",
    ""user.timezone"": ""Europe/Madrid""
  }
}
```

### Severity

high

### Additional context

_No response_",rodrigoGA,2024-12-06 13:24:50+00:00,[],2024-12-10 17:24:49+00:00,2024-12-10 14:27:17+00:00,https://github.com/metabase/metabase/issues/50986,"[('Type:Bug', 'Product defects'), ('.Needs Triage', ''), ('.Team/Embedding', '')]","[{'comment_id': 2531789417, 'issue_id': 2723058350, 'author': 'albertoperdomo', 'body': ""Hello @rodrigoGA ,\n\nthanks for reaching out. In Metabase 44, we introduced this functionality for interactive embedding. It seems, as a side-effect, this was also accidentally introduced for static embedding, but wasn't fully working, and it was never meant to be released. To this extent, this was not part of our official documentation.\n\nIn 52, we've had to implement a new feature for this to work properly, and as a result, we've decided to clean things up."", 'created_at': datetime.datetime(2024, 12, 10, 14, 27, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2531830295, 'issue_id': 2723058350, 'author': 'rodrigoGA', 'body': ""@albertoperdomo I think we are not understanding each other, or your message has not been clear enough.\nThe changelog states the following:\n```\nLanguage localization in static embedding with hash parameter #locale=xx  \n```\nThat doesn't work with static embedding, as I explained, so it should be considered a bug.\n\nOn the other hand, static embedding already supported the locale parameter in the form locale=xx#, but it stopped working.\nNow the locale as #locale=xx, as mentioned in the changelog, also doesn't work!\n\nYour message is confusing. According to what you are saying, have you actually removed localization support for static embedding?\nShouldn't that changelog line state that you removed support rather than saying you added it?\n\nAs a developer, I can tell you it's very frustrating to convince a client to use metabase, explain and show them it has a functionality to always keep localization in English (which is documented in your forums), only for that functionality to be removed in the next version."", 'created_at': datetime.datetime(2024, 12, 10, 14, 43, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2532088625, 'issue_id': 2723058350, 'author': 'albertoperdomo', 'body': ""@rodrigoGA \n\n>Language localization in static embedding with hash parameter #locale=xx  \n\nOk, I can get the confusion. Sorry about the lack of clarity.\n\n`#locale=xx` should work, but requires a Pro or Enterprise license. I will see that we amend the release notes to include this for clarity.\n\n\nWe have removed the support for `?locale=xx`, which was never meant to be introduced and wasn't fully working.\n\nCan you provide some links to the forum discussions where we suggest using this method? I am aware of threads ([example](https://discourse.metabase.com/t/embedding-with-internationalization-support/22288/3)), where we mention that this only worked for interactive embedding. It seems at some point, this started working for static embedding by accident but wasn't fully working (no localized downloads, for instance)."", 'created_at': datetime.datetime(2024, 12, 10, 15, 38, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2532180291, 'issue_id': 2723058350, 'author': 'rodrigoGA', 'body': 'Thank you for the clarification, but I would like to express my dissatisfaction as a developer who recommends Metabase to clients. This decision has directly impacted dashboards in production.\n\nIts common for applications to be multilingual, but Metabase does not support multiple languages in static texts, such as titles and labels. Setting a fixed language was the most sensible solution to avoid inconsistencies in the dashboards.\n\nIll leave a quote from your own words in another issue,:\n\n> This is supported since 44 in\n> \n> * regular app usage, e.g. `https://mymb.metabaseapp.com/dashboard/1-a-look-at-invoices?locale=de-DE`\n> * interactive embedding, e.g. `https://mymb.metabaseapp.com/dashboard/1-a-look-at-invoices?locale=de-DE`\n> * static embedding, e.g. `https://mymb.metabaseapp.com/embed/dashboard/TOKEN?locale=de-DE#theme=night&background=false&bordered=true&titled=true"")`\n> * public links, e.g. `https://mymb.metabaseapp.com/public/dashboard/UUID?locale=de-DE`\n\n\nI hope that in the future you consider more carefully the impact that removing existing functionalities has on users. With this change, dashboards are now broken and unpolished, seriously affecting their presentation.\n\nCould you clarify which is the minimum plan we would need to upgrade to in order to regain this functionality? Please note that, for privacy reasons, the client requires the Metabase instance to remain self-hosted.', 'created_at': datetime.datetime(2024, 12, 10, 16, 13, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2532257922, 'issue_id': 2723058350, 'author': 'albertoperdomo', 'body': ""Hello @rodrigoGA .\n\nYes, I understand your frustration, and I am really sorry about it.\n\nIf you scroll up on the same issue, you will find a comment saying it was introduced in 44 but only for interactive embedding.\nI did publish that comment on Aug 23 because when we discovered that it was working, but we later realized that it wasn't working as expected and then later followed up with another comment on September 9. \n\nI should have probably updated or removed the comment to not mislead people into believing it's something they should use. It's currently hidden.\n\nThis feature requires a Pro subscription (available for self-hosting as well as cloud), which also removes the Powered by Metabase banner, adds the ability to hide downloads, and customizes the embedding font and appearance settings."", 'created_at': datetime.datetime(2024, 12, 10, 16, 45, tzinfo=datetime.timezone.utc)}, {'comment_id': 2532267876, 'issue_id': 2723058350, 'author': 'albertoperdomo', 'body': 'Follow up, @rodrigoGA, am I reading right that you are using this feature to make sure the embeds are always in the same language and not in multiple languages? If yes, can you explain further? Why would the embeds show in different languages?', 'created_at': datetime.datetime(2024, 12, 10, 16, 49, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2532278246, 'issue_id': 2723058350, 'author': 'albertoperdomo', 'body': ""If you are up for it, let's talk @rodrigoGA : https://calendly.com/d/cqvv-ykn-gs2/15min\nI'd love to better understand the problem you are trying to solve. This features is meant for people who actually need to embed in different languages, so I'd love know more about your use case."", 'created_at': datetime.datetime(2024, 12, 10, 16, 53, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2532346945, 'issue_id': 2723058350, 'author': 'rodrigoGA', 'body': ""The application we use to integrate the dashboards supports many languages (English, German, Turkish, Spanish, French, and Portuguese).\nTo avoid duplicating and maintaining dashboards in all languages, it was decided that the dashboard section would be in English using locale=en. Everything looked fine in: chart titles, dates, currencies, descriptions...\n\nWith the update, we now have a mix of languages on the home page, elements that Metabase renders in the user's browser language, such as dates, currencies, interface options....and card titles, alongside descriptions and chart information in English.\n\nWe were aware this was a feature we had read about in a forum, not in the official documentation, but it worked, and we proposed it, and the client accepted it.\n\nThanks for the information about the plan; I'll pass it along to see if it's accepted. Here's a suggestion regarding plans: https://discourse.metabase.com/t/suggestion-introduce-a-mid-tier-plan-for-embedded-analytics/182847"", 'created_at': datetime.datetime(2024, 12, 10, 17, 24, 40, tzinfo=datetime.timezone.utc)}]","albertoperdomo on (2024-12-10 14:27:17 UTC): Hello @rodrigoGA ,

thanks for reaching out. In Metabase 44, we introduced this functionality for interactive embedding. It seems, as a side-effect, this was also accidentally introduced for static embedding, but wasn't fully working, and it was never meant to be released. To this extent, this was not part of our official documentation.

In 52, we've had to implement a new feature for this to work properly, and as a result, we've decided to clean things up.

rodrigoGA (Issue Creator) on (2024-12-10 14:43:22 UTC): @albertoperdomo I think we are not understanding each other, or your message has not been clear enough.
The changelog states the following:
```
Language localization in static embedding with hash parameter #locale=xx  
```
That doesn't work with static embedding, as I explained, so it should be considered a bug.

On the other hand, static embedding already supported the locale parameter in the form locale=xx#, but it stopped working.
Now the locale as #locale=xx, as mentioned in the changelog, also doesn't work!

Your message is confusing. According to what you are saying, have you actually removed localization support for static embedding?
Shouldn't that changelog line state that you removed support rather than saying you added it?

As a developer, I can tell you it's very frustrating to convince a client to use metabase, explain and show them it has a functionality to always keep localization in English (which is documented in your forums), only for that functionality to be removed in the next version.

albertoperdomo on (2024-12-10 15:38:12 UTC): @rodrigoGA 


Ok, I can get the confusion. Sorry about the lack of clarity.

`#locale=xx` should work, but requires a Pro or Enterprise license. I will see that we amend the release notes to include this for clarity.


We have removed the support for `?locale=xx`, which was never meant to be introduced and wasn't fully working.

Can you provide some links to the forum discussions where we suggest using this method? I am aware of threads ([example](https://discourse.metabase.com/t/embedding-with-internationalization-support/22288/3)), where we mention that this only worked for interactive embedding. It seems at some point, this started working for static embedding by accident but wasn't fully working (no localized downloads, for instance).

rodrigoGA (Issue Creator) on (2024-12-10 16:13:41 UTC): Thank you for the clarification, but I would like to express my dissatisfaction as a developer who recommends Metabase to clients. This decision has directly impacted dashboards in production.

Its common for applications to be multilingual, but Metabase does not support multiple languages in static texts, such as titles and labels. Setting a fixed language was the most sensible solution to avoid inconsistencies in the dashboards.

Ill leave a quote from your own words in another issue,:



I hope that in the future you consider more carefully the impact that removing existing functionalities has on users. With this change, dashboards are now broken and unpolished, seriously affecting their presentation.

Could you clarify which is the minimum plan we would need to upgrade to in order to regain this functionality? Please note that, for privacy reasons, the client requires the Metabase instance to remain self-hosted.

albertoperdomo on (2024-12-10 16:45:00 UTC): Hello @rodrigoGA .

Yes, I understand your frustration, and I am really sorry about it.

If you scroll up on the same issue, you will find a comment saying it was introduced in 44 but only for interactive embedding.
I did publish that comment on Aug 23 because when we discovered that it was working, but we later realized that it wasn't working as expected and then later followed up with another comment on September 9. 

I should have probably updated or removed the comment to not mislead people into believing it's something they should use. It's currently hidden.

This feature requires a Pro subscription (available for self-hosting as well as cloud), which also removes the Powered by Metabase banner, adds the ability to hide downloads, and customizes the embedding font and appearance settings.

albertoperdomo on (2024-12-10 16:49:08 UTC): Follow up, @rodrigoGA, am I reading right that you are using this feature to make sure the embeds are always in the same language and not in multiple languages? If yes, can you explain further? Why would the embeds show in different languages?

albertoperdomo on (2024-12-10 16:53:53 UTC): If you are up for it, let's talk @rodrigoGA : https://calendly.com/d/cqvv-ykn-gs2/15min
I'd love to better understand the problem you are trying to solve. This features is meant for people who actually need to embed in different languages, so I'd love know more about your use case.

rodrigoGA (Issue Creator) on (2024-12-10 17:24:40 UTC): The application we use to integrate the dashboards supports many languages (English, German, Turkish, Spanish, French, and Portuguese).
To avoid duplicating and maintaining dashboards in all languages, it was decided that the dashboard section would be in English using locale=en. Everything looked fine in: chart titles, dates, currencies, descriptions...

With the update, we now have a mix of languages on the home page, elements that Metabase renders in the user's browser language, such as dates, currencies, interface options....and card titles, alongside descriptions and chart information in English.

We were aware this was a feature we had read about in a forum, not in the official documentation, but it worked, and we proposed it, and the client accepted it.

Thanks for the information about the plan; I'll pass it along to see if it's accepted. Here's a suggestion regarding plans: https://discourse.metabase.com/t/suggestion-introduce-a-mid-tier-plan-for-embedded-analytics/182847

"
2723054647,issue,closed,completed,replace usage of `:global(.Icon)` with an additional class passed to the Icon,https://github.com/metabase/metabase/pull/50909#discussion_r1872830698,uladzimirdev,2024-12-06 13:23:08+00:00,[],2025-01-27 22:12:51+00:00,2024-12-20 22:12:18+00:00,https://github.com/metabase/metabase/issues/50985,[],[],
2723007668,issue,closed,completed,[Epic] Migrate querying components to CSS from emotion,"### Links
- issue links: [notion](https://www.notion.so/metabase/FE-tech-projects-13f69354c90180b1bd16ca6e51ae8482#13f69354c901802cab6ac803e6d56027)

### Implementation Plan

```[tasklist]
#### Migrate `query_builder` folder to css modules
- [ ] https://github.com/metabase/metabase/pull/50861
- [ ] https://github.com/metabase/metabase/pull/50912
- [ ] https://github.com/metabase/metabase/pull/50911
- [ ] https://github.com/metabase/metabase/pull/50909
- [ ] https://github.com/metabase/metabase/pull/50907
- [ ] https://github.com/metabase/metabase/pull/50864
- [ ] https://github.com/metabase/metabase/pull/51137
- [ ] https://github.com/metabase/metabase/pull/51136
- [ ] https://github.com/metabase/metabase/pull/51219
- [ ] https://github.com/metabase/metabase/pull/51220
```

```[tasklist]
#### Migrate `querying` folder to css modules
- [ ] https://github.com/metabase/metabase/pull/51427
- [ ] https://github.com/metabase/metabase/pull/51430
```

```[tasklist]
#### Followups
- [ ] https://github.com/metabase/metabase/issues/50985
- [ ] https://github.com/metabase/metabase/pull/51542
```",uladzimirdev,2024-12-06 13:00:00+00:00,['uladzimirdev'],2024-12-20 22:16:01+00:00,2024-12-20 22:16:00+00:00,https://github.com/metabase/metabase/issues/50983,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2722638140,issue,closed,completed,Insert setting error on master,"### Describe the bug

checkout master and starts with an empty db you'll see this error
```
2024-12-06 04:07:13,425 INFO appdb.index :: Dropped 1 stale indexes
2024-12-06 04:07:13,426 WARN models.setting :: Error inserting a new Setting:
 ERROR: duplicate key value violates unique constraint ""setting_pkey""
  Detail: Key (key)=(search-engine-appdb-index-state) already exists.
 Assuming Setting already exists in DB and updating existing value.
2024-12-06 04:07:13,439 INFO appdb.index :: Dropped 1 stale indexes
```


### Expected behavior

no warning on startup

### Logs

_No response_

### Information about your Metabase installation

```JSON
master
```

### Severity

start normally but still should fix this

### Additional context

_No response_",qnkhuat,2024-12-06 10:25:33+00:00,[],2024-12-10 08:20:19+00:00,2024-12-06 15:08:07+00:00,https://github.com/metabase/metabase/issues/50978,"[('Type:Bug', 'Product defects'), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2522919012, 'issue_id': 2722638140, 'author': 'crisptrutski', 'body': ""@qnkhuat is the title a typo, or have you also seen this on Stats?\n\nChecking in Grafana it doesn't look like it (I guess because the db is not empty)"", 'created_at': datetime.datetime(2024, 12, 6, 11, 12, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2523004184, 'issue_id': 2722638140, 'author': 'qnkhuat', 'body': 'sorry, I meant on master', 'created_at': datetime.datetime(2024, 12, 6, 11, 44, 39, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-12-06 11:12:16 UTC): @qnkhuat is the title a typo, or have you also seen this on Stats?

Checking in Grafana it doesn't look like it (I guess because the db is not empty)

qnkhuat (Issue Creator) on (2024-12-06 11:44:39 UTC): sorry, I meant on master

"
2722164786,issue,closed,not_planned,Error processing query: write beyond end of stream - Sustained More than 80% CPU,"### Describe the bug

The CPU of the metabase remained at around 80% for two days, and there were a large number of ""Error processing query: write beyond end of stream"" errors in the log.

### To Reproduce

As it is the customer's operation, we do not know the specific operating procedures.
But we have found some abnormal phenomena: 
1 We checked the execution status of queries and found that queries related to the same table were executed approximately 100000 times in the past two days. However, I checked the API requests during the same period and found that there were no API requests for a long time in between, but queries were executed. I don't understand why this situation occurred.
2 We found that the CPU has been at around 80% for the past two days.
3 There are a large number of 'Error processing query: write beyond end of stream' errors in the log.
![Image](https://github.com/user-attachments/assets/03e5a8ee-cd4f-4ab0-9fca-76f823c74ffb)
![Image](https://github.com/user-attachments/assets/33d0237b-8c62-48c6-b0e3-72df3f60f7a8)
![Image](https://github.com/user-attachments/assets/edde7f35-c155-47af-94c5-f253ff255eb1)
![Image](https://github.com/user-attachments/assets/872a2c7e-7984-467d-a1d4-812f9f13c504)
![Image](https://github.com/user-attachments/assets/1a724ac0-4c64-4278-b760-f6e28df7cb00)
![Image](https://github.com/user-attachments/assets/a61a0dcc-d813-4856-bf33-85e6b75209cc)










### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
We are currently using version 0.46.6.4
{
  ""browser-info"": {
    ""language"": ""ja"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.19+7-LTS"",
    ""java.vendor"": ""Amazon.com Inc."",
    ""java.vendor.url"": ""https://aws.amazon.com/corretto/"",
    ""java.version"": ""11.0.19"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.19+7-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.226-214.880.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Japan""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.32""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.6""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""?"",
      ""tag"": ""vUNKNOWN"",
      ""branch"": ""?"",
      ""hash"": ""?""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```

### Severity

blocking some users

### Additional context


",li-xiaolu,2024-12-06 06:18:57+00:00,[],2024-12-09 04:09:44+00:00,2024-12-06 10:19:45+00:00,https://github.com/metabase/metabase/issues/50973,"[('Type:Bug', 'Product defects'), ('.Performance', ''), ('.Needs Triage', '')]","[{'comment_id': 2522750634, 'issue_id': 2722164786, 'author': 'paoliniluis', 'body': 'Please upgrade to the latest version, we have fixed a ton of bugs since then', 'created_at': datetime.datetime(2024, 12, 6, 10, 19, 45, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-06 10:19:45 UTC): Please upgrade to the latest version, we have fixed a ton of bugs since then

"
2721924488,issue,closed,completed,Cannot go back from notebook editor,"The user cannot go back from the notebook editor since the confirmation modal appears behind the data picker modal.

![Image](https://github.com/user-attachments/assets/233fbcd4-a956-4efe-89e3-70432df43a4b)

@kamilmielnik noted this in July: https://github.com/metabase/metabase/issues/45469#issuecomment-2232650222

### To Reproduce

1. Go to New > Model
2. Click on Notebook editor
3. Press the back button
4. Notice that the page does not respond

### Severity

P2",rafpaf,2024-12-06 02:51:54+00:00,[],2025-01-27 22:13:11+00:00,2024-12-17 17:48:18+00:00,https://github.com/metabase/metabase/issues/50971,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Misc/Accessibility', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2522347333, 'issue_id': 2721924488, 'author': 'WiNloSt', 'body': 'happens to v50.35, and v51.7', 'created_at': datetime.datetime(2024, 12, 6, 7, 34, 9, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2024-12-06 07:34:09 UTC): happens to v50.35, and v51.7

"
2721478859,issue,open,,[BE] Use `:during` in `specific-date-filter-clause` and `-parts`,,ranquild,2024-12-05 21:35:40+00:00,['ranquild'],2024-12-08 05:09:54+00:00,,https://github.com/metabase/metabase/issues/50960,[],[],
2721478763,issue,open,,[BE] Migrate legacy specific date filter clauses on card read,,ranquild,2024-12-05 21:35:36+00:00,['ranquild'],2024-12-08 05:09:32+00:00,,https://github.com/metabase/metabase/issues/50959,[],[],
2721478661,issue,closed,completed,[FE] Remove legacy exclude date filters from `filter.ts`,,ranquild,2024-12-05 21:35:32+00:00,['ranquild'],2025-01-27 22:13:48+00:00,2024-12-10 17:33:07+00:00,https://github.com/metabase/metabase/issues/50958,[],[],
2721086265,issue,open,,"Dashboard copy with ""Only when adding a new filter widget"" will trigger get-field-values and the api call will fail with big DW's","### Describe the bug

Took me some time to realize but when you have a trillion rows and the get-field-values operation never finishes (for obvious reasons), then a dashboard copy will also never finish.

This happens only with the following config in the DW:
![Image](https://github.com/user-attachments/assets/1b6e0b65-78f1-434b-b87d-240f3ea5ceb6)

as it will trigger those operations as the dashboard copy adds new filters and therefore it triggers the get-filter-values operation

### To Reproduce

1) set the DW to only get field values if there's a new filter added
2) copy a dashboard and monitor the operation in the DW, see that the queries to get field values is fired
![Image](https://github.com/user-attachments/assets/0cef27bd-71a6-4bc6-9c48-80e9b66e41ab)


### Expected behavior

We should deal with this async, not on the api call


### Logs

NA

### Information about your Metabase installation

```JSON
it has always been like this
```

### Severity

P1ish?

### Additional context

related to https://github.com/metabase/metabase/issues/35631, also probably https://github.com/metabase/metabase/issues/31166",paoliniluis,2024-12-05 18:09:19+00:00,[],2025-02-04 20:24:32+00:00,,https://github.com/metabase/metabase/issues/50951,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Metadata & Sync', ''), ('.Backend', ''), ('.Team/Drivers', '')]",[],
2721063751,issue,closed,completed,"Driver tests skip lots of tests, but it is verbose","Looking at CI test run https://github.com/metabase/metabase/actions/runs/12183946047/job/33986706167?pr=50941

These driver tests will skip some tests, which is good. But the output in the CI runner has 4,685 lines of output telling us it is skipping tests(lines 420 - 5105)

I wonder if this could be a bit less chatt?
<details>

<summary> logs of skipped tests </summary>

```

Skipping `happy-path-test` due to missing only tag(s): :mb/driver-tests
Skipping `create-new-jwt-user-no-user-provisioning-test` due to missing only tag(s): :mb/driver-tests
Skipping `no-open-redirect-test` due to missing only tag(s): :mb/driver-tests
Skipping `sso-prereqs-test` due to missing only tag(s): :mb/driver-tests
Skipping `group-mappings-test` due to missing only tag(s): :mb/driver-tests
Skipping `update-account-test` due to missing only tag(s): :mb/driver-tests
Skipping `redirect-test` due to missing only tag(s): :mb/driver-tests
Skipping `create-new-account-test` due to missing only tag(s): :mb/driver-tests
Skipping `create-new-saml-user-no-user-provisioning-test` due to missing only tag(s): :mb/driver-tests
Skipping `logout-should-delete-session-test-slo-disabled` due to missing only tag(s): :mb/driver-tests
Skipping `validate-not-on-or-after-test` due to missing only tag(s): :mb/driver-tests
Skipping `validate-issuer-test` due to missing only tag(s): :mb/driver-tests
Skipping `require-valid-premium-features-token-test` due to missing only tag(s): :mb/driver-tests
Skipping `validate-signatures-test` due to missing only tag(s): :mb/driver-tests
Skipping `login-invalid-relay-state-test-2` due to missing only tag(s): :mb/driver-tests
Skipping `relay-state-e2e-test` due to missing only tag(s): :mb/driver-tests
Skipping `login-should-sync-single-group-membership` due to missing only tag(s): :mb/driver-tests
Skipping `jwt-saml-both-enabled-saml-success-test` due to missing only tag(s): :mb/driver-tests
Skipping `logout-should-delete-session-test-slo-enabled` due to missing only tag(s): :mb/driver-tests
Skipping `validate-request-id-test` due to missing only tag(s): :mb/driver-tests
Skipping `uri->params-map-test` due to missing only tag(s): :mb/driver-tests
Skipping `require-saml-enabled-test` due to missing only tag(s): :mb/driver-tests
Skipping `login-test` due to missing only tag(s): :mb/driver-tests
Skipping `relay-state-test` due to missing only tag(s): :mb/driver-tests
Skipping `login-test-2` due to missing only tag(s): :mb/driver-tests
Skipping `validate-not-on-or-after-test-2` due to missing only tag(s): :mb/driver-tests
Skipping `redirect-append-paramters-test` due to missing only tag(s): :mb/driver-tests
Skipping `sso-subpath-e2e-test` due to missing only tag(s): :mb/driver-tests
Skipping `logout-should-delete-session-when-idp-slo-conf-missing-test` due to missing only tag(s): :mb/driver-tests
Skipping `request-xml-test` due to missing only tag(s): :mb/driver-tests
Skipping `login-create-account-test` due to missing only tag(s): :mb/driver-tests
Skipping `login-should-sync-multiple-group-membership` due to missing only tag(s): :mb/driver-tests
Skipping `login-update-account-test` due to missing only tag(s): :mb/driver-tests
Skipping `validate-recipient-test` due to missing only tag(s): :mb/driver-tests
Skipping `login-invalid-relay-state-test` due to missing only tag(s): :mb/driver-tests
Skipping `redirect-test` due to missing only tag(s): :mb/driver-tests
Skipping `login-should-sync-multiple-group-membership-2` due to missing only tag(s): :mb/driver-tests
Skipping `validate-certificate-test` due to missing only tag(s): :mb/driver-tests
Skipping `set-saml-settings-token-features-test` due to missing only tag(s): :mb/driver-tests
Skipping `get-saml-settings-token-features-test` due to missing only tag(s): :mb/driver-tests
Skipping `set-jwt-settings-token-features-test` due to missing only tag(s): :mb/driver-tests
Skipping `saml-scim-user-provisioning` due to missing only tag(s): :mb/driver-tests
Skipping `jwt-settings-token-features-test` due to missing only tag(s): :mb/driver-tests
Skipping `check-sso-redirect-test` due to missing only tag(s): :mb/driver-tests
Skipping `create-new-sso-user-do-not-send-email-test` due to missing only tag(s): :mb/driver-tests
Skipping `create-new-sso-user-test` due to missing only tag(s): :mb/driver-tests
Skipping `snowplow-events-are-emitted` due to missing only tag(s): :mb/driver-tests
Skipping `stale-items-limits-and-offsets-work-correctly` due to missing only tag(s): :mb/driver-tests
Skipping `can-fetch-stale-candidates` due to missing only tag(s): :mb/driver-tests
Skipping `stale-items-is-premium-only` due to missing only tag(s): :mb/driver-tests
Skipping `questions-with-alerts-are-excluded` due to missing only tag(s): :mb/driver-tests
Skipping `can-find-stale-dashboards` due to missing only tag(s): :mb/driver-tests
Skipping `public-and-embedded-content-is-excluded` due to missing only tag(s): :mb/driver-tests
Skipping `can-find-stale-cards` due to missing only tag(s): :mb/driver-tests
Skipping `cutoff-date-is-taken-into-account` due to missing only tag(s): :mb/driver-tests
Skipping `dashboards-with-subscriptions-are-excluded` due to missing only tag(s): :mb/driver-tests
Skipping `results-can-be-sorted` due to missing only tag(s): :mb/driver-tests
Skipping `cards-in-non-standard-collection-types-are-excluded` due to missing only tag(s): :mb/driver-tests
Skipping `verified-cards-are-excluded` due to missing only tag(s): :mb/driver-tests
Skipping `collection-set-is-taken-into-account` due to missing only tag(s): :mb/driver-tests
Skipping `questions-used-as-data-source-for-sandboxes-are-excluded` due to missing only tag(s): :mb/driver-tests
Skipping `limits-and-offset-work` due to missing only tag(s): :mb/driver-tests
Skipping `things-that-are-already-archived-do-not-appear` due to missing only tag(s): :mb/driver-tests
Skipping `ee-snowplow-features-test` due to missing only tag(s): :mb/driver-tests
Skipping `audit-log-cleanup-test` due to missing only tag(s): :mb/driver-tests
Skipping `query-execution-cleanup-test` due to missing only tag(s): :mb/driver-tests
Skipping `view-log-cleanup-test` due to missing only tag(s): :mb/driver-tests
Skipping `list-uploaded-tables-test` due to missing only tag(s): :mb/driver-tests
Skipping `delete-csv-test` due to missing only tag(s): :mb/driver-tests
```

</details>
",dpsutton,2024-12-05 17:56:58+00:00,[],2024-12-06 18:21:38+00:00,2024-12-06 18:21:37+00:00,https://github.com/metabase/metabase/issues/50949,"[('Type:New Feature', ''), ('.Team/DevEx', '')]","[{'comment_id': 2523903136, 'issue_id': 2721063751, 'author': 'dpsutton', 'body': 'closing in favor of an issue in hawk: https://github.com/metabase/hawk/issues/35', 'created_at': datetime.datetime(2024, 12, 6, 18, 21, 37, tzinfo=datetime.timezone.utc)}]","dpsutton (Issue Creator) on (2024-12-06 18:21:37 UTC): closing in favor of an issue in hawk: https://github.com/metabase/hawk/issues/35

"
2721052737,issue,closed,completed,flaky test in `queue-test`,"### Describe the bug

```clojure
FAIL in metabase.util.queue-test/delay-queue-test (queue_test.clj:92)
expected: (nil? (queue/take-delayed-batch! q 3 90 0))
  actual: (not (nil? [689583922888]))
```

### To Reproduce

run the test

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
master
```

### Severity

p2

### Additional context

_No response_",dpsutton,2024-12-05 17:50:33+00:00,['crisptrutski'],2025-01-03 20:39:30+00:00,2024-12-16 09:53:55+00:00,https://github.com/metabase/metabase/issues/50948,"[('Type:Bug', 'Product defects'), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2521055589, 'issue_id': 2721052737, 'author': 'dpsutton', 'body': 'https://github.com/metabase/metabase/actions/runs/12183946047/job/33986704000?pr=50941', 'created_at': datetime.datetime(2024, 12, 5, 17, 51, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2523134441, 'issue_id': 2721052737, 'author': 'crisptrutski', 'body': 'Will let it bake a few weeks before I declare victory', 'created_at': datetime.datetime(2024, 12, 6, 12, 41, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2545112820, 'issue_id': 2721052737, 'author': 'crisptrutski', 'body': ""Haven't seen the issue again, can open if we do."", 'created_at': datetime.datetime(2024, 12, 16, 9, 53, 55, tzinfo=datetime.timezone.utc)}]","dpsutton (Issue Creator) on (2024-12-05 17:51:38 UTC): https://github.com/metabase/metabase/actions/runs/12183946047/job/33986704000?pr=50941

crisptrutski (Assginee) on (2024-12-06 12:41:01 UTC): Will let it bake a few weeks before I declare victory

crisptrutski (Assginee) on (2024-12-16 09:53:55 UTC): Haven't seen the issue again, can open if we do.

"
2720968991,issue,open,,Negative values in stacked area diagram are always drawn below 0,"### Describe the bug

Area graphs with stacking don't handle negative numbers consistently with positive numbers.

- When numbers in one of the upper series are negative,  
(1) Negative numbers are always plotted below 0. The values of the lower series are not taken into account.  
(2) The higher series don't take into account the negative values of lower series  
(3) Zero (0) values behave as expected

- When numbers in multiple upper series are negative,  
(4) Negative numbers are stacked together below 0. It is as if the negative series have a separate stack from the positive series.

Simple example, using the following data through an SQL query (postgresql):
```sql
select *
from (values ('Jan', 20, 2, 5), ('Feb', 22, 0, 5), ('March', 18, 1, 5),
    ('April', 25, -2, 5), ('May', 22, 2, 5), ('June', 20, 1, 5),
    ('July', 19, -3, -5), ('Aug', 22, 2, 5), ('Sep', 20, 1, 5)
    ) as d(m, a, b, c)
```

![Image](https://github.com/user-attachments/assets/443ee817-5e74-42a3-938b-000d189718e0)


### To Reproduce

1. Create new SQL query
2. Select a (postgre)sql database
3. Enter following query:  
```sql
select *
from (values ('Jan', 20, 2, 5), ('Feb', 22, 0, 5), ('March', 18, 1, 5),
    ('April', 25, -2, 5), ('May', 22, 2, 5), ('June', 20, 1, 5),
    ('July', 19, -3, -5), ('Aug', 22, 2, 5), ('Sep', 20, 1, 5)
    ) as d(m, a, b, c)
```
4. Select visualization ""Area""
5. Select m as X-axis
6. Select a, b and c on the Y-axis
7. Set stacking to ""Stack""


### Expected behavior

(1) :  
- The dot for b in April should be at 23, instead of at -2   (a=25, b=-2)

(2):  
- The dot for c in April should be at 28 instead of at 30   (a=25, b=-2, c=5)

(4):  
- The dots for b and c in July should be at 16 and 11 instead of at -3 and -8   (a=19, b=-3, c=-5)

I simulated the expected behavior by explicitly adding columns for a+b and a+b+c and using a Combo graph where a+b and a+b+c are independent lines, while a, b and c are still the stacked areas.
```sql
select m, a, b, c, a+b as ""a+b"", a+b+c as ""a+b+c""
from (values ('Jan', 20, 2, 5), ('Feb', 22, 0, 5), ('March', 18, 1, 5),
    ('April', 25, -2, 5), ('May', 22, 2, 5), ('June', 20, 1, 5)
    ) as d(m, a, b, c)
```

![Image](https://github.com/user-attachments/assets/5b44e047-fb6a-4dbf-bff1-1b654adf6047)




### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.3 (Debian 16.3-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Europe/Brussels""
  }
}
```

### Severity

Annoying

### Additional context

_No response_",janfrederik,2024-12-05 17:08:30+00:00,[],2025-02-04 20:31:18+00:00,,https://github.com/metabase/metabase/issues/50945,"[('Type:New Feature', ''), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2522316542, 'issue_id': 2720968991, 'author': 'WiNloSt', 'body': 'happens to v0.50.35, and v0.51.7', 'created_at': datetime.datetime(2024, 12, 6, 7, 26, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2523697016, 'issue_id': 2720968991, 'author': 'alxnddr', 'body': ""We've been using the stacking strategy that creates separate stacks for positive and negative values. I assume for some share of customers this is a desired behavior. However, we can add a visualization setting that would allow changing the stacking strategy to the described here behavior when we use single stack for values of any sign. Should be easy, @cdeweyx what do you think?"", 'created_at': datetime.datetime(2024, 12, 6, 16, 36, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2529299630, 'issue_id': 2720968991, 'author': 'cdeweyx', 'body': ""> We've been using the stacking strategy that creates separate stacks for positive and negative values. I assume for some share of customers this is a desired behavior. However, we can add a visualization setting that would allow changing the stacking strategy to the described here behavior when we use single stack for values of any sign. Should be easy, [@cdeweyx](https://github.com/cdeweyx) what do you think?\n\n@alxnddr 100% I think this is a worthwhile knob"", 'created_at': datetime.datetime(2024, 12, 9, 19, 56, 5, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2024-12-06 07:26:24 UTC): happens to v0.50.35, and v0.51.7

alxnddr on (2024-12-06 16:36:47 UTC): We've been using the stacking strategy that creates separate stacks for positive and negative values. I assume for some share of customers this is a desired behavior. However, we can add a visualization setting that would allow changing the stacking strategy to the described here behavior when we use single stack for values of any sign. Should be easy, @cdeweyx what do you think?

cdeweyx on (2024-12-09 19:56:05 UTC): @alxnddr 100% I think this is a worthwhile knob

"
2720938921,issue,closed,completed,Popovers in `QuestionSettings` are hidden when using Mantine popovers in SDK,"The popovers on the `QuestionSettings` component disappear behind the chart settings component when the component is used in an SDK popover component. This is a problem with the mantine & legacy popover z-indexes not working with each other

https://github.com/user-attachments/assets/553b7351-cd5d-4f1b-8529-aa1bb0a31229
",oisincoveney,2024-12-05 16:54:11+00:00,['oisincoveney'],2025-01-27 22:13:11+00:00,2024-12-17 17:48:18+00:00,https://github.com/metabase/metabase/issues/50943,[],[],
2720895566,issue,closed,completed,"[BE, MBQL lib], Support the new function in `display-name-method` and `filter-args-display-name` for filters",,metamben,2024-12-05 16:36:33+00:00,['metamben'],2025-01-27 22:13:59+00:00,2024-12-06 21:00:48+00:00,https://github.com/metabase/metabase/issues/50942,[],[],
2720864725,issue,closed,completed,build sometimes fails with race condition in building drivers,"### Describe the bug

<details>
<summary> Stack Trace </summary>

```
      Compiling namespaces [metabase.driver.sqlserver]
{:via
 [{:type clojure.lang.ExceptionInfo,
   :message
   ""Running build steps for Enterprise Edition version UNKNOWN: version, translations, frontend, licenses, drivers, uberjar"",
   :data {},
   :at [metabuild_common.steps$do_step invokeStatic ""steps.clj"" 90]}
  {:type clojure.lang.ExceptionInfo,
   :message ""Building all drivers in parallel (:ee edition)"",
   :data {},
   :at [metabuild_common.steps$do_step invokeStatic ""steps.clj"" 90]}
  {:type java.util.concurrent.ExecutionException,
   :message ""clojure.lang.ExceptionInfo: Build driver :databricks (edition = :ee, options = nil) {}"",
   :at [java.util.concurrent.FutureTask report ""FutureTask.java"" 122]}
  {:type clojure.lang.ExceptionInfo,
   :message ""Build driver :databricks (edition = :ee, options = nil)"",
   :data {},
   :at [metabuild_common.steps$do_step invokeStatic ""steps.clj"" 90]}
  {:type clojure.lang.ExceptionInfo,
   :message
   ""Write :databricks :ee uberjar -> /home/runner/work/metabase/metabase/resources/modules/databricks.metabase-driver.jar"",
   :data {},
   :at [metabuild_common.steps$do_step invokeStatic ""steps.clj"" 90]}
  {:type java.lang.IllegalStateException,
   :message ""Attempting to call unbound fn: #'clojure.tools.build.tasks.uber/uber"",
   :at [clojure.lang.Var$Unbound throwArity ""Var.java"" 47]}],
 :trace
 [[clojure.lang.Var$Unbound throwArity ""Var.java"" 47]
  [clojure.lang.AFn invoke ""AFn.java"" 32]
  [clojure.lang.Var invoke ""Var.java"" 386]
  [clojure.tools.build.api$uber invokeStatic ""api.clj"" 511]
  [clojure.tools.build.api$uber invoke ""api.clj"" 439]
  [build_drivers.create_uberjar$create_uberjar_BANG_$fn__4951 invoke ""create_uberjar.clj"" 82]
  [metabuild_common.steps$do_step invokeStatic ""steps.clj"" 87]
  [metabuild_common.steps$do_step invoke ""steps.clj"" 81]
  [build_drivers.create_uberjar$create_uberjar_BANG_ invokeStatic ""create_uberjar.clj"" 80]
  [build_drivers.create_uberjar$create_uberjar_BANG_ invoke ""create_uberjar.clj"" 77]
  [build_drivers.build_driver$build_driver_BANG_$fn__6636 invoke ""build_driver.clj"" 37]
  [metabuild_common.steps$do_step invokeStatic ""steps.clj"" 87]
  [metabuild_common.steps$do_step invoke ""steps.clj"" 81]
  [build_drivers.build_driver$build_driver_BANG_ invokeStatic ""build_driver.clj"" 33]
  [build_drivers.build_driver$build_driver_BANG_ invoke ""build_driver.clj"" 17]
  [build_drivers.build_driver$build_driver_BANG_ invokeStatic ""build_driver.clj"" 24]
  [build_drivers.build_driver$build_driver_BANG_ invoke ""build_driver.clj"" 17]
  [build_drivers$build_drivers_BANG_$fn__6657$fn__6658 invoke ""build_drivers.clj"" 31]
  [clojure.core$pmap$fn__8582$fn__8583 invoke ""core.clj"" 7169]
  [clojure.core$binding_conveyor_fn$fn__5842 invoke ""core.clj"" 2047]
  [clojure.lang.AFn call ""AFn.java"" 18]
  [java.util.concurrent.FutureTask run ""FutureTask.java"" 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ""ThreadPoolExecutor.java"" 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ""ThreadPoolExecutor.java"" 628]
  [java.lang.Thread run ""Thread.java"" 829]],
 :cause ""Attempting to call unbound fn: #'clojure.tools.build.tasks.uber/uber""}
```

</details>

the relevant part is here is ""Attempting to call unbound fn: #'clojure.tools.build.tasks.uber/uber"".

building drivers in parallel we are `pmap`ing over the clojure.tools.build.api/uber which does `((requiring-resolve 'clojure.tools.build.tasks.uber/uber) params)`. We seem to infrequently hit a state where the namespace is loaded but the variables are not established yet.

See https://clojurians.slack.com/archives/C03S1KBA2/p1733410195854179 for more information.

But in the meantime we can require the namespace that provides `clojure.tools.build.tasks.uber/uber` to ensure it is read.

### To Reproduce

build randomly fails like in https://github.com/metabase/metabase/actions/runs/12181580023/job/33978943366

### Expected behavior

build should work 

### Logs

_No response_

### Information about your Metabase installation

```JSON
n/a
```

### Severity

p-annoying

### Additional context

_No response_",dpsutton,2024-12-05 16:25:34+00:00,[],2025-01-27 22:14:03+00:00,2024-12-05 19:37:57+00:00,https://github.com/metabase/metabase/issues/50940,"[('Type:Bug', 'Product defects'), ('.Building & Releasing', ''), ('flaky-test-fix', '')]","[{'comment_id': 2521244058, 'issue_id': 2720864725, 'author': 'paoliniluis', 'body': 'Seems like making my PR with Claude to pmap the build was not free', 'created_at': datetime.datetime(2024, 12, 5, 19, 37, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2521251587, 'issue_id': 2720864725, 'author': 'dpsutton', 'body': ""@paoliniluis it's true it came with a bug, but honestly it's not really your fault. Talked with the language maintainers and they are planning to put some work here soon."", 'created_at': datetime.datetime(2024, 12, 5, 19, 42, 28, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-05 19:37:51 UTC): Seems like making my PR with Claude to pmap the build was not free

dpsutton (Issue Creator) on (2024-12-05 19:42:28 UTC): @paoliniluis it's true it came with a bug, but honestly it's not really your fault. Talked with the language maintainers and they are planning to put some work here soon.

"
2720441801,issue,closed,completed,Remove list-query hooks from hooks/entity-framework,Follow-up on #50926,kamilmielnik,2024-12-05 13:37:39+00:00,[],2024-12-06 09:58:59+00:00,2024-12-06 09:58:08+00:00,https://github.com/metabase/metabase/issues/50931,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2522705098, 'issue_id': 2720441801, 'author': 'kamilmielnik', 'body': 'Abandoning for now, see https://github.com/metabase/metabase/issues/50926#issuecomment-2522704704', 'created_at': datetime.datetime(2024, 12, 6, 9, 58, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2522706529, 'issue_id': 2720441801, 'author': 'kamilmielnik', 'body': 'This issue was originally was part of #50317', 'created_at': datetime.datetime(2024, 12, 6, 9, 58, 57, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-12-06 09:58:08 UTC): Abandoning for now, see https://github.com/metabase/metabase/issues/50926#issuecomment-2522704704

kamilmielnik (Issue Creator) on (2024-12-06 09:58:57 UTC): This issue was originally was part of #50317

"
2720418394,issue,closed,not_planned,sync-fields task failed - class java.lang.ClassCastException,"### Describe the bug

added new database and Metabase can't get columns data.
![Image](https://github.com/user-attachments/assets/a6c78b51-cc95-4cc4-9b70-059a6d249ec2)


I tried running ""Sync database schema now"" and noticed an error in logs.
`{""status"":""failed"",""exception"":""class java.lang.ClassCastException"",""message"":null,""stacktrace"":[null],""ex-data"":null,""original-info"":null}`

Please note my database is Starrocks and it is compatible with mysql.
I already have databased and tables working with it. This is a new issue and I don't know if it is metabase side or Starrocks.
![Image](https://github.com/user-attachments/assets/a34f8f53-e46c-4731-8ff8-1f7f6375041c)


### To Reproduce

1. Add new Mysql database
2. Got to Admin  > Table Metadata > check id columns where identified.


### Expected behavior

_No response_

### Logs

```
2024-12-05 13:10:56,802 DEBUG middleware.log :: GET /api/health 200 228.7 s (0 DB calls) App DB connections: 0/7 Jetty threads: 8/50 (2 idle, 0 queued) (43 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id nil}
2024-12-05 13:10:59,647 WARN driver.mysql ::

********************************************************************************
WARNING: Metabase only officially supports MySQL 5.7/MariaDB 10.2 and above.
All Metabase features may not work properly when using an unsupported version.
********************************************************************************

2024-12-05 13:10:59,648 DEBUG sync.util :: Sync operations in flight: {:sync-metadata #{36}}
2024-12-05 13:10:59,648 DEBUG middleware.log :: POST /api/database/36/sync_schema 200 20.0 ms (1 DB calls) App DB connections: 0/7 Jetty threads: 8/50 (2 idle, 0 queued) (43 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 1}
2024-12-05 13:10:59,648 INFO sync.util :: STARTING: Sync metadata for mysql Database 36 ''Test''
2024-12-05 13:10:59,704 INFO sync.util :: STARTING: step ''sync-dbms-version'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,711 INFO sync.util :: FINISHED: step ''sync-dbms-version'' for mysql Database 36 ''Test'' (7.1 ms)
2024-12-05 13:10:59,712 INFO sync.util :: STARTING: step ''sync-timezone'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,719 WARN sync.util :: Error running step ''sync-timezone'' for mysql Database 36 ''Test''
java.sql.SQLTransientConnectionException: (conn=884) Getting analyzing error from line 1, column 73 to line 1, column 173. Detail message: No matching function with signature: time_format(TIME, varchar).
	at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.createException(ExceptionFactory.java:79)
	at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.create(ExceptionFactory.java:158)
	at org.mariadb.jdbc.MariaDbStatement.executeExceptionEpilogue(MariaDbStatement.java:262)
	at org.mariadb.jdbc.ClientSidePreparedStatement.executeInternal(ClientSidePreparedStatement.java:229)
	at org.mariadb.jdbc.ClientSidePreparedStatement.execute(ClientSidePreparedStatement.java:149)
	at org.mariadb.jdbc.ClientSidePreparedStatement.executeQuery(ClientSidePreparedStatement.java:163)
	at com.mchange.v2.c3p0.impl.NewProxyPreparedStatement.executeQuery(NewProxyPreparedStatement.java:1471)
	at clojure.java.jdbc$execute_query_with_params.invokeStatic(jdbc.clj:1090)
	at clojure.java.jdbc$execute_query_with_params.invoke(jdbc.clj:1084)
	at clojure.java.jdbc$db_query_with_resultset_STAR_.invokeStatic(jdbc.clj:1113)
	at clojure.java.jdbc$db_query_with_resultset_STAR_.invoke(jdbc.clj:1093)
	at clojure.java.jdbc$query.invokeStatic(jdbc.clj:1182)
	at clojure.java.jdbc$query.invoke(jdbc.clj:1144)
	at clojure.java.jdbc$query.invokeStatic(jdbc.clj:1160)
	at clojure.java.jdbc$query.invoke(jdbc.clj:1144)
	at metabase.driver.mysql$fn__113067.invokeStatic(mysql.clj:239)
	at metabase.driver.mysql$fn__113067.invoke(mysql.clj:229)
	at clojure.lang.MultiFn.invoke(MultiFn.java:234)
	at metabase.driver.sql_jdbc$fn__115544.invokeStatic(sql_jdbc.clj:73)
	at metabase.driver.sql_jdbc$fn__115544.invoke(sql_jdbc.clj:68)
	at clojure.lang.MultiFn.invoke(MultiFn.java:234)
	at metabase.sync.sync_metadata.sync_timezone$sync_timezone_BANG_91670__91671.invokeStatic(sync_timezone.clj:41)
	at metabase.sync.sync_metadata.sync_timezone$sync_timezone_BANG_91670__91671.invoke(sync_timezone.clj:36)
	at clojure.lang.AFn.applyToHelper(AFn.java:154)
	at clojure.lang.AFn.applyTo(AFn.java:144)
	at clojure.core$apply.invokeStatic(core.clj:669)
	at clojure.core$apply.invoke(core.clj:662)
	at metabase.sync.util$run_step_with_metadata63542__63544$fn__63546$fn__63549.invoke(util.clj:495)
	at metabase.models.task_history$do_with_task_history63379__63380.invokeStatic(task_history.clj:121)
	at metabase.models.task_history$do_with_task_history63379__63380.invoke(task_history.clj:109)
	at metabase.sync.util$run_step_with_metadata63542__63544$fn__63546.doInvoke(util.clj:488)
	at clojure.lang.RestFn.invoke(RestFn.java:400)
	at metabase.sync.util$with_start_and_finish_logging_STAR_.invokeStatic(util.clj:132)
	at metabase.sync.util$with_start_and_finish_logging_STAR_.invoke(util.clj:126)
	at metabase.sync.util$do_with_start_and_finish_debug_logging.invokeStatic(util.clj:150)
	at metabase.sync.util$do_with_start_and_finish_debug_logging.invoke(util.clj:146)
	at metabase.sync.util$run_step_with_metadata63542__63544.invokeStatic(util.clj:482)
	at metabase.sync.util$run_step_with_metadata63542__63544.invoke(util.clj:477)
	at metabase.sync.util$run_sync_operation63592__63593$fn__63594$fn__63602.invoke(util.clj:568)
	at metabase.sync.util$run_sync_operation63592__63593$fn__63594.invoke(util.clj:566)
	at metabase.models.task_history$do_with_task_history63379__63380.invokeStatic(task_history.clj:121)
	at metabase.models.task_history$do_with_task_history63379__63380.invoke(task_history.clj:109)
	at metabase.sync.util$run_sync_operation63592__63593.invokeStatic(util.clj:563)
	at metabase.sync.util$run_sync_operation63592__63593.invoke(util.clj:558)
	at metabase.sync.sync_metadata$sync_db_metadata_BANG_93843__93844$fn__93845.invoke(sync_metadata.clj:70)
	at metabase.sync.util$do_with_error_handling.invokeStatic(util.clj:191)
	at metabase.sync.util$do_with_error_handling.invoke(util.clj:184)
	at clojure.core$partial$fn__5929.invoke(core.clj:2647)
	at metabase.driver$fn__59430.invokeStatic(driver.clj:892)
	at metabase.driver$fn__59430.invoke(driver.clj:892)
	at clojure.lang.MultiFn.invoke(MultiFn.java:239)
	at metabase.sync.util$sync_in_context$fn__63451.invoke(util.clj:167)
	at metabase.sync.util$with_db_logging_disabled$fn__63448.invoke(util.clj:159)
	at metabase.sync.util$with_start_and_finish_logging_STAR_.invokeStatic(util.clj:132)
	at metabase.sync.util$with_start_and_finish_logging_STAR_.invoke(util.clj:126)
	at metabase.sync.util$with_start_and_finish_logging$fn__63435.invoke(util.clj:144)
	at metabase.sync.util$with_sync_events63425__63426$fn__63430.invoke(util.clj:118)
	at metabase.sync.util$with_duplicate_ops_prevented$fn__63415.invoke(util.clj:90)
	at metabase.sync.util$do_sync_operation63466__63467.invokeStatic(util.clj:216)
	at metabase.sync.util$do_sync_operation63466__63467.invoke(util.clj:210)
	at metabase.sync.sync_metadata$sync_db_metadata_BANG_93843__93844.invokeStatic(sync_metadata.clj:68)
	at metabase.sync.sync_metadata$sync_db_metadata_BANG_93843__93844.invoke(sync_metadata.clj:65)
	at metabase.api.database$fn__106321$fn__106326.invoke(database.clj:1017)
	at clojure.core$binding_conveyor_fn$fn__5842.invoke(core.clj:2047)
	at clojure.lang.AFn.call(AFn.java:18)
	at java.base/java.util.concurrent.FutureTask.run(Unknown Source)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
	at java.base/java.lang.Thread.run(Unknown Source)
Caused by: org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException: Getting analyzing error from line 1, column 73 to line 1, column 173. Detail message: No matching function with signature: time_format(TIME, varchar).
	at org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException.of(MariaDbSqlException.java:34)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.exceptionWithQuery(AbstractQueryProtocol.java:195)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.exceptionWithQuery(AbstractQueryProtocol.java:178)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:322)
	at org.mariadb.jdbc.ClientSidePreparedStatement.executeInternal(ClientSidePreparedStatement.java:220)
	... 65 more
Caused by: java.sql.SQLException: Getting analyzing error from line 1, column 73 to line 1, column 173. Detail message: No matching function with signature: time_format(TIME, varchar).
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readErrorPacket(AbstractQueryProtocol.java:1693)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readPacket(AbstractQueryProtocol.java:1555)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.getResult(AbstractQueryProtocol.java:1518)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:319)
	... 66 more
2024-12-05 13:10:59,720 INFO sync.util :: FINISHED: step ''sync-timezone'' for mysql Database 36 ''Test'' (8.2 ms)
2024-12-05 13:10:59,720 INFO sync.util :: STARTING: step ''sync-tables'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,724 INFO sync-metadata.tables :: Found new table: Table  ''data''
2024-12-05 13:10:59,736 INFO sync-metadata.tables :: Marking tables as inactive: (Table  ''records'' Table  ''cells'')
2024-12-05 13:10:59,742 INFO sync-metadata.tables :: Updating table metadata for Table 93 ''data''
2024-12-05 13:10:59,745 INFO sync.util :: FINISHED: step ''sync-tables'' for mysql Database 36 ''Test'' (24.4 ms)
2024-12-05 13:10:59,745 INFO sync.util :: STARTING: step ''sync-fields'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,762 WARN sync.util :: Error syncing Fields for Database ''mysql Database 36 ''Test''''
java.lang.ClassCastException
2024-12-05 13:10:59,764 WARN sync.util :: Error running step ''sync-fields'' for mysql Database 36 ''Test''
java.lang.ClassCastException
2024-12-05 13:10:59,764 INFO sync.util :: FINISHED: step ''sync-fields'' for mysql Database 36 ''Test'' (19.5 ms)
2024-12-05 13:10:59,764 INFO sync.util :: STARTING: step ''sync-fks'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,813 INFO sync.util :: FINISHED: step ''sync-fks'' for mysql Database 36 ''Test'' (48.8 ms)
2024-12-05 13:10:59,814 INFO sync.util :: STARTING: step ''sync-indexes'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,836 INFO sync.util :: FINISHED: step ''sync-indexes'' for mysql Database 36 ''Test'' (22.7 ms)
2024-12-05 13:10:59,837 INFO sync.util :: STARTING: step ''sync-metabase-metadata'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,841 INFO sync.util :: FINISHED: step ''sync-metabase-metadata'' for mysql Database 36 ''Test'' (4.7 ms)
2024-12-05 13:10:59,842 INFO sync.util :: STARTING: step ''sync-table-privileges'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,846 INFO sync.util :: FINISHED: step ''sync-table-privileges'' for mysql Database 36 ''Test'' (4.9 ms)
2024-12-05 13:10:59,847 DEBUG sync.util ::
#################################################################
# Completed sync on Test
# Start: 2024-12-05T13:10:59.704699333Z
# End: 2024-12-05T13:10:59.847092029Z
# Duration: 142.4 ms
# ---------------------------------------------------------------
# Completed step ''sync-dbms-version''
# Start: 2024-12-05T13:10:59.704711258Z
# End: 2024-12-05T13:10:59.712030093Z
# Duration: 7.3 ms
# Found DBMS version 5.1.0
# ---------------------------------------------------------------
# Completed step ''sync-timezone''
# Start: 2024-12-05T13:10:59.712048241Z
# End: 2024-12-05T13:10:59.720399892Z
# Duration: 8.4 ms
# Found timezone id null
# ---------------------------------------------------------------
# Completed step ''sync-tables''
# Start: 2024-12-05T13:10:59.720466629Z
# End: 2024-12-05T13:10:59.745160088Z
# Duration: 24.7 ms
# Total number of tables sync''d 2, number of tables updated 3
# ---------------------------------------------------------------
# Completed step ''sync-fields''
# Start: 2024-12-05T13:10:59.745180072Z
# End: 2024-12-05T13:10:59.764832306Z
# Duration: 19.7 ms
# Total number of fields sync''d null, number of fields updated null
# ---------------------------------------------------------------
# Completed step ''sync-fks''
# Start: 2024-12-05T13:10:59.764920806Z
# End: 2024-12-05T13:10:59.814078998Z
# Duration: 49.2 ms
# Total number of foreign keys sync''d 0, 0 updated and 0 tables failed to update
# ---------------------------------------------------------------
# Completed step ''sync-indexes''
# Start: 2024-12-05T13:10:59.814102431Z
# End: 2024-12-05T13:10:59.837030075Z
# Duration: 22.9 ms
# Total number of indexes sync''d 0, 0 added and 0 removed
# ---------------------------------------------------------------
# Completed step ''sync-metabase-metadata''
# Start: 2024-12-05T13:10:59.837052657Z
# End: 2024-12-05T13:10:59.841995605Z
# Duration: 4.9 ms
# ---------------------------------------------------------------
# Completed step ''sync-table-privileges''
# Start: 2024-12-05T13:10:59.842015202Z
# End: 2024-12-05T13:10:59.847082573Z
# Duration: 5.1 ms
#################################################################

2024-12-05 13:10:59,850 INFO sync.util :: FINISHED: Sync metadata for mysql Database 36 ''Test'' (201.3 ms)
2024-12-05 13:10:59,850 DEBUG sync.util :: Sync operations in flight: {:analyze #{36}}
2024-12-05 13:10:59,850 INFO sync.util :: STARTING: Analyze data for mysql Database 36 ''Test''
2024-12-05 13:10:59,854 INFO sync.util :: STARTING: step ''fingerprint-fields'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,859 INFO sync.analyze :: fingerprint-fields Analyzed [************]    25% Table 93 ''data''
2024-12-05 13:10:59,862 INFO sync.util :: FINISHED: step ''fingerprint-fields'' for mysql Database 36 ''Test'' (8.6 ms)
2024-12-05 13:10:59,863 INFO sync.util :: STARTING: step ''classify-fields'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,867 INFO sync.analyze :: classify-fields Analyzed [*************************]    50% Table 93 ''data''
2024-12-05 13:10:59,869 INFO sync.util :: FINISHED: step ''classify-fields'' for mysql Database 36 ''Test'' (6.3 ms)
2024-12-05 13:10:59,869 INFO sync.util :: STARTING: step ''classify-tables'' for mysql Database 36 ''Test''
2024-12-05 13:10:59,874 DEBUG analyze.classify :: Based on classification, updating these values of Table 93 ''data'': {:entity_type :entity/GenericTable}
2024-12-05 13:10:59,876 INFO sync.analyze :: classify-tables Analyzed [*************************************]    75% Table 93 ''data''
2024-12-05 13:10:59,879 INFO sync.util :: FINISHED: step ''classify-tables'' for mysql Database 36 ''Test'' (9.6 ms)
2024-12-05 13:10:59,879 DEBUG sync.util ::
#################################################################
# Completed analyze on Test
# Start: 2024-12-05T13:10:59.854171769Z
# End: 2024-12-05T13:10:59.879344325Z
# Duration: 25.2 ms
# ---------------------------------------------------------------
# Completed step ''fingerprint-fields''
# Start: 2024-12-05T13:10:59.8541806Z
# End: 2024-12-05T13:10:59.862980148Z
# Duration: 8.8 ms
# Fingerprint updates attempted 0, updated 0, no data found 0, failed 0
# ---------------------------------------------------------------
# Completed step ''classify-fields''
# Start: 2024-12-05T13:10:59.862991364Z
# End: 2024-12-05T13:10:59.869513767Z
# Duration: 6.5 ms
# Total number of fields classified 0, 0 failed
# ---------------------------------------------------------------
# Completed step ''classify-tables''
# Start: 2024-12-05T13:10:59.869524562Z
# End: 2024-12-05T13:10:59.879332182Z
# Duration: 9.8 ms
# Total number of tables classified 1, 1 updated
#################################################################

2024-12-05 13:10:59,883 INFO sync.util :: FINISHED: Analyze data for mysql Database 36 ''Test'' (32.4 ms)
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.115"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```

### Severity

blocking

### Additional context

Ignore sync-timezone errors.",dorsegal,2024-12-05 13:27:40+00:00,[],2025-01-06 13:20:17+00:00,2024-12-05 13:58:21+00:00,https://github.com/metabase/metabase/issues/50930,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2520366197, 'issue_id': 2720418394, 'author': 'dpsutton', 'body': ""> Please note my database is Starrocks and it is compatible with mysql.\n\n> Caused by: java.sql.SQLException: Getting analyzing error from line 1, column 73 to line 1, column 173. Detail message: No matching function with signature: time_format(TIME, varchar).\n\nWe attempt to get the timezone of the db with this: https://github.com/metabase/metabase/blob/master/src/metabase/driver/mysql.clj#L233 which runs the query\n\n```sql\nSELECT @@GLOBAL.time_zone AS global_tz, \n       @@system_time_zone AS system_tz,\n       time_format(  \n          timediff(\n            now(), convert_tz(now(), @@GLOBAL.time_zone, '+00:00')\n          ),\n         '%H:%i' ) AS 'offset';\n```\n\nThe complaint seems to be about this."", 'created_at': datetime.datetime(2024, 12, 5, 13, 43, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2520402223, 'issue_id': 2720418394, 'author': 'paoliniluis', 'body': ""we don't support Starrocks: https://github.com/metabase/metabase/issues/28081"", 'created_at': datetime.datetime(2024, 12, 5, 13, 58, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2534554670, 'issue_id': 2720418394, 'author': 'stdpain', 'body': 'supported in https://github.com/StarRocks/starrocks/pull/53724', 'created_at': datetime.datetime(2024, 12, 11, 8, 2, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2572660019, 'issue_id': 2720418394, 'author': 'dorsegal', 'body': '@dpsutton could you have a look again? Starrocks implemented a fix for time_format function. \n\n`sync-timezone` step passes with no errors but my original `sync-fields` error remains.\n\n<img width=""993"" alt=""Image"" src=""https://github.com/user-attachments/assets/eaa098ce-ef49-473e-bc81-8384160360a2"" />\n\n\nCould you help me understand what exactly is failing? \nI was looking here https://github.com/metabase/metabase/blob/master/src/metabase/driver/mysql.clj#L936 but having hard time to understand the code there.', 'created_at': datetime.datetime(2025, 1, 6, 9, 24, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2573098291, 'issue_id': 2720418394, 'author': 'dorsegal', 'body': 'Looks like adding `tinyInt1isBit=false` in additional JDBC connection string options works.', 'created_at': datetime.datetime(2025, 1, 6, 13, 20, 16, tzinfo=datetime.timezone.utc)}]","dpsutton on (2024-12-05 13:43:37 UTC): We attempt to get the timezone of the db with this: https://github.com/metabase/metabase/blob/master/src/metabase/driver/mysql.clj#L233 which runs the query

```sql
SELECT @@GLOBAL.time_zone AS global_tz, 
       @@system_time_zone AS system_tz,
       time_format(  
          timediff(
            now(), convert_tz(now(), @@GLOBAL.time_zone, '+00:00')
          ),
         '%H:%i' ) AS 'offset';
```

The complaint seems to be about this.

paoliniluis on (2024-12-05 13:58:22 UTC): we don't support Starrocks: https://github.com/metabase/metabase/issues/28081

stdpain on (2024-12-11 08:02:16 UTC): supported in https://github.com/StarRocks/starrocks/pull/53724

dorsegal (Issue Creator) on (2025-01-06 09:24:15 UTC): @dpsutton could you have a look again? Starrocks implemented a fix for time_format function. 

`sync-timezone` step passes with no errors but my original `sync-fields` error remains.

<img width=""993"" alt=""Image"" src=""https://github.com/user-attachments/assets/eaa098ce-ef49-473e-bc81-8384160360a2"" />


Could you help me understand what exactly is failing? 
I was looking here https://github.com/metabase/metabase/blob/master/src/metabase/driver/mysql.clj#L936 but having hard time to understand the code there.

dorsegal (Issue Creator) on (2025-01-06 13:20:16 UTC): Looks like adding `tinyInt1isBit=false` in additional JDBC connection string options works.

"
2720334139,issue,open,,[Epic] Make full-text search default on all instances,"### Now
- [x] Programmatically create the index table based on specs (not engine dependent)
- [x] Basic H2 support
- [x] [Co-ordinate index creation and rotation between instances
](https://github.com/metabase/metabase/issues/51279)
- [ ] Define observability metrics and implement them in Prometheus

### To remove old search code
- [x] [Get e2e tests running against New Search](https://github.com/metabase/metabase/pull/50558)
- [ ] MySQL to support the new search index
- [x] Make search possible for models with composite primary key

### After (handed-over to Admin/Webapp)
- [x] [unit test] Test capturing the cascading deletion flow
- [ ] ~~Get H2 ranking on par with Old Search  (then we can remove old search)~~
- [ ] Test performance impact (not sure how best to do this, wide scope)
- [ ] If we need to improve performance, find a lighter way to add hooks to toucan2.
- [ ] Backpressure so we can regulate the load we create on CPU/io
- [ ] Soft-delete search index metadata

### Maybe
- [ ] ~~Automatic data-flow for fields coming from sub-selects[^1]~~
- [ ] Trigger a indexed-entity sync when the Model is updated

[^1]: Stale ""dashboard counts"", we don't update the index when a card is added to a new dashboard as the relationship is not a regular join.",luizarakaki,2024-12-05 12:50:06+00:00,['crisptrutski'],2025-02-04 20:27:24+00:00,,https://github.com/metabase/metabase/issues/50927,"[('Organization/Search', ''), ('.Epic', 'Feature Implementation or Project'), ('.Team/Workflows', 'aka BEC')]",[],
2720294315,issue,closed,completed,Remove query hooks from hooks/entity-framework,To be followed up in #50931,kamilmielnik,2024-12-05 12:32:41+00:00,[],2024-12-06 09:59:29+00:00,2024-12-06 09:57:54+00:00,https://github.com/metabase/metabase/issues/50926,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2522704704, 'issue_id': 2720294315, 'author': 'kamilmielnik', 'body': 'It causes too many test failures (#50928). Abandoning for now.', 'created_at': datetime.datetime(2024, 12, 6, 9, 57, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2522706351, 'issue_id': 2720294315, 'author': 'kamilmielnik', 'body': 'This issue was originally was part of #50317', 'created_at': datetime.datetime(2024, 12, 6, 9, 58, 51, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2024-12-06 09:57:54 UTC): It causes too many test failures (#50928). Abandoning for now.

kamilmielnik (Issue Creator) on (2024-12-06 09:58:51 UTC): This issue was originally was part of #50317

"
2720260982,issue,closed,completed,Custom column formula autocomplete overwrites part of existing formula,"### Describe the bug

https://github.com/user-attachments/assets/2075ad42-6361-45be-b564-e7a7f5c6c37a

Part of the existing query can get overwritten when trying to insert new auto completed parts.

### To Reproduce

1. Have a custom column, define formula `case([Currency ID] = 2, [Revenue] * 1.21, [Revenue])`
2. I now want to enter an extra currency case in the formula, making it `case([Currency ID] = 2, [Revenue] * 1.21, [Currency ID] = 3, [Revenue] * 1.34,  [Revenue])`
3. To do this, I click in the text field after the comma next to 1.21
4. I start typing `[Currency` and click on the auto suggested `[Currency ID]` option. 
5. The `[` in front of Revenue is now removed by the auto complete.

### Expected behavior

Autocomplete should not remove existing characters.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-28"",
      ""tag"": ""v0.51.6"",
      ""hash"": ""fc77ed4""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Amsterdam""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.4""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.0-33-cloud-amd64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Europe/Amsterdam""
  }
}
```

### Severity

Very annoying

### Additional context

_No response_",attaxia,2024-12-05 12:18:15+00:00,['kamilmielnik'],2025-01-17 08:33:01+00:00,2025-01-17 07:53:11+00:00,https://github.com/metabase/metabase/issues/50925,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('Querying/Notebook/Custom Expression', ''), ('.Team/Querying', '')]",[],
2720186703,issue,closed,completed,[QUERY EDITOR] Unable to join a subquery anymore since update to 0.52.1,"### Describe the bug

Hi !
This issue take place in the question editor of version 0.52.1.
In previous releases (0.51.x), we where able to join data from tables and if needed, from any other previously saved queries (that make a subquery).
In this release, only tables are proposed to be ""JOINed"" by the assistant.

### How to reproduce : 

- Select a table, open the query editor
- click on ""Join data""
- click on ""Select Data""
- only the tables are proposed, not all the queries like it was before

Consequence = unable to run subquery based on already saved query.


### Information about my Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""fr"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.16 (Debian 13.16-0+deb11u1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""17.0.12+7-Debian-2deb11u1"",
    ""java.vendor"": ""Debian"",
    ""java.vendor.url"": ""https://tracker.debian.org/openjdk-17"",
    ""java.version"": ""17.0.12"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""17.0.12+7-Debian-2deb11u1"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.0-32-amd64"",
    ""user.language"": ""fr"",
    ""user.timezone"": ""Europe/Paris""
  }
}
```

### Severity

High

### Additional context

_No response_",labiloute,2024-12-05 11:45:52+00:00,[],2024-12-05 13:36:06+00:00,2024-12-05 13:36:06+00:00,https://github.com/metabase/metabase/issues/50924,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2520101260, 'issue_id': 2720186703, 'author': 'paoliniluis', 'body': 'have you clicked on ""saved questions"" on the top @labiloute ![Image](https://github.com/user-attachments/assets/1d0ed394-9ac4-4f71-ae69-60d002e983db)?', 'created_at': datetime.datetime(2024, 12, 5, 11, 50, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2520298462, 'issue_id': 2720186703, 'author': 'labiloute', 'body': '> My bad !Message ID: ***@***.***>\n>\n> My bad !\n\nI had to clear my cache.\n\nThanks a lot an sorry for inconvenience.\n\nCheers', 'created_at': datetime.datetime(2024, 12, 5, 13, 15, 15, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-05 11:50:53 UTC): have you clicked on ""saved questions"" on the top @labiloute ![Image](https://github.com/user-attachments/assets/1d0ed394-9ac4-4f71-ae69-60d002e983db)?

labiloute (Issue Creator) on (2024-12-05 13:15:15 UTC): I had to clear my cache.

Thanks a lot an sorry for inconvenience.

Cheers

"
2719785920,issue,closed,not_planned,Not seeing Clickhouse in the add database drop down list,"### Describe the bug

Not seeing Clickhouse in the add database section drop down list. Version i'm using `v0.52.1`
![Image](https://github.com/user-attachments/assets/26147a50-edf0-4dab-8ec1-503fc7c39335)


### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-1037-gcp"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

medimum

### Additional context

_No response_",SankarKrishna,2024-12-05 08:58:03+00:00,[],2024-12-05 11:11:36+00:00,2024-12-05 11:11:34+00:00,https://github.com/metabase/metabase/issues/50923,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2520008625, 'issue_id': 2719785920, 'author': 'paoliniluis', 'body': 'please see the docs about how to add external drivers', 'created_at': datetime.datetime(2024, 12, 5, 11, 11, 34, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-05 11:11:34 UTC): please see the docs about how to add external drivers

"
2719201529,issue,closed,completed,[BE] Migrate legacy exclude date filter clauses on card read,"Migrate old-style filter clauses on (card, model-level) read. Remove code that handled old expressions. Note - it's not possible to create legacy expressions either via the UI or custom expression editor, so it should be safe to transform them when it matches.

**exclude date filters**

legacy 1:
https://github.com/metabase/metabase/blob/0c2f067db1ded9c523a5bc14a5be3ff7151597c8/src/metabase/lib/fe_util.cljc#L427

legacy 2:
https://github.com/metabase/metabase/blob/0c2f067db1ded9c523a5bc14a5be3ff7151597c8/src/metabase/lib/fe_util.cljc#L437

new:
https://github.com/metabase/metabase/blob/0c2f067db1ded9c523a5bc14a5be3ff7151597c8/src/metabase/lib/fe_util.cljc#L417

and:
https://github.com/metabase/metabase/blob/0c2f067db1ded9c523a5bc14a5be3ff7151597c8/src/metabase/lib/fe_util.cljc#L421
",ranquild,2024-12-05 03:06:34+00:00,['ranquild'],2025-01-27 22:13:47+00:00,2024-12-10 17:33:06+00:00,https://github.com/metabase/metabase/issues/50920,[],[],
2718887650,issue,open,,Expose the verified cards on the content model,"**Is your feature request related to a problem? Please describe.**
Right now on the content model we only expose if a collection is verified or not. We should also expose if a card or a dashboard is as well

**Describe the solution you'd like**
Transform the field of the content model to ""is verified"" and also show when cards and dashboards are verified

**Describe alternatives you've considered**
get it from the app db

**How important is this feature to you?**
requested by a customer, that wants to do a permissions review of those

**Additional context**
NA
",paoliniluis,2024-12-04 22:10:36+00:00,[],2025-02-04 20:31:04+00:00,,https://github.com/metabase/metabase/issues/50916,"[('Type:New Feature', ''), ('Administration/Usage analytics', 'Pro and Enterprise meta analytics, fka audit')]","[{'comment_id': 2520522713, 'issue_id': 2718887650, 'author': 'marisaUP', 'body': 'For the content model, it would be great to have entities in my Metabase (dashboard, model, or question), whether that entity is official or not, and the group IDs of the groups that have access to that entity.', 'created_at': datetime.datetime(2024, 12, 5, 14, 46, 34, tzinfo=datetime.timezone.utc)}]","marisaUP on (2024-12-05 14:46:34 UTC): For the content model, it would be great to have entities in my Metabase (dashboard, model, or question), whether that entity is official or not, and the group IDs of the groups that have access to that entity.

"
2718873110,issue,open,,Model is being expanded to data sources after edit/distribute,"### Describe the bug

It's a weird issue that only happens after you edit a model. Let's say that we have a Notebook editor model that joins Query Execution, Questions, and Users (via Creator ID) and name it ""Query Executions in Data Warehouse"" (available in Stats).

Now, if you edit that model, and move a column to another location, save, and then try to click on any column and select Distribution, the list of data sources will show the underlying 3 tables instead of the data model that we edited -- the model ""expanded"" out to its sources. 

This is what you would see:
![Image](https://github.com/user-attachments/assets/a91eca76-2e6f-40a0-9053-5ae969ba2403)

The model is intended to be a reusable abstraction of tables/transformation, so it should not be ""expanded"" and would defeat the point of having reusability of model logic. This worked fine previously, so it's a regression. 

Also, once that happens if you click on the browser button to go back, and then edit the model to move columns, the save button doesn't become active, so you can't save changes. 

### To Reproduce

1. Create model that joins 3 tables
2. Edit model to move a column or any other change and save
3. Click on any column and select Distribution
4. Notice the sources under question name is showing the 3 tables instead of the model. This is the first / primary bug. 
5. Click on browser back button and then edit model to move a column, the save button remains greyed out. This is the second bug. 


### Expected behavior

It should show the model name as the source for the distribution question like: 
![Image](https://github.com/user-attachments/assets/2fdef128-6fad-42c6-bf40-201e0a40a935)


### Logs

n/a

### Information about your Metabase installation

```JSON
master @ postgres / Stats
```

### Severity

Defeats reusability of models after edit

### Additional context

_No response_",maxzheng,2024-12-04 22:00:09+00:00,[],2025-02-04 20:31:07+00:00,,https://github.com/metabase/metabase/issues/50915,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/MBQL', ''), ('Difficulty:Easy', ''), ('.Backend', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('Querying/Models', 'aka Datasets'), ('.Regression/master', 'Regression that is only present on master, or bug in new upcoming feature'), ('.Team/Querying', ''), ('Semantic Model', ''), ('Semantic Model/Models', '')]","[{'comment_id': 2607222930, 'issue_id': 2718873110, 'author': 'kamilmielnik', 'body': 'To reproduce the first issue with sample database:\n1. New > Model > Notebook\n2. Orders join People\n3. Save\n4. Click User -> Address column header and choose ""Distinct"" drill\n\nThe original model where this can be reproduced: [stats](https://stats.metabase.com/model/20977).', 'created_at': datetime.datetime(2025, 1, 22, 13, 15, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2609814883, 'issue_id': 2718873110, 'author': 'kamilmielnik', 'body': ""My findings so far:\n\nWhen distribution drill is being applied, `setCardAndRun` action receives `nextCard` with unexpected query (the source query, instead of composed source query, so we're losing information about the model).\nBefore that even happens, `getClickActions` uses `rawSeries` with the card as above (the source query, instead of composed source query).\nRedux store does not seem to have any relevant differences. I suspect the issue lies somewhere in selectors, action creators, or entity framework cache.\n\n----\n\n> Click on browser back button and then edit model to move a column, the save button remains greyed out. This is the second bug.\n\nI haven't gotten into investigating the 2nd issue but I can reproduce it in stats.\n\n----\n\nI'm getting stuck here, so I'll move on to another issue for now.\nIn the meantime, feel free to pick this one up and hit me up if you want more details."", 'created_at': datetime.datetime(2025, 1, 23, 13, 30, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2616896545, 'issue_id': 2718873110, 'author': 'ranquild', 'body': 'Okay this seems to be just an MBQL lib problem. This drill somehow ""unwraps"" the source card when it shouldn\'t: \n\n<img width=""1529"" alt=""Image"" src=""https://github.com/user-attachments/assets/d625ed00-663b-4d11-a515-cd9f43c46b69"" />', 'created_at': datetime.datetime(2025, 1, 27, 21, 8, 5, tzinfo=datetime.timezone.utc)}]","kamilmielnik on (2025-01-22 13:15:24 UTC): To reproduce the first issue with sample database:
1. New > Model > Notebook
2. Orders join People
3. Save
4. Click User -> Address column header and choose ""Distinct"" drill

The original model where this can be reproduced: [stats](https://stats.metabase.com/model/20977).

kamilmielnik on (2025-01-23 13:30:21 UTC): My findings so far:

When distribution drill is being applied, `setCardAndRun` action receives `nextCard` with unexpected query (the source query, instead of composed source query, so we're losing information about the model).
Before that even happens, `getClickActions` uses `rawSeries` with the card as above (the source query, instead of composed source query).
Redux store does not seem to have any relevant differences. I suspect the issue lies somewhere in selectors, action creators, or entity framework cache.

----


I haven't gotten into investigating the 2nd issue but I can reproduce it in stats.

----

I'm getting stuck here, so I'll move on to another issue for now.
In the meantime, feel free to pick this one up and hit me up if you want more details.

ranquild on (2025-01-27 21:08:05 UTC): Okay this seems to be just an MBQL lib problem. This drill somehow ""unwraps"" the source card when it shouldn't: 

<img width=""1529"" alt=""Image"" src=""https://github.com/user-attachments/assets/d625ed00-663b-4d11-a515-cd9f43c46b69"" />

"
2718563540,issue,open,,Allow the embedding-app-origin property to accept URLs with context paths,"**Is your feature request related to a problem? Please describe.**
Currently, the embedding-app-origin property in the Metabase config file (config.yml) doesn't support URLs containing context paths (e.g., https://localhost:3000/subpath/). When a context path is included, Metabase logs numerous ""Invalid URL"" errors, even though embedding dashboards appear to function correctly.

When multiple apps are hosted on the same domain, context paths are often used to differentiate them. The current behavior leads to:

- Log files being cluttered with ""Invalid URL"" errors, making it harder to identify real issues.
- Ambiguity around whether the configuration is supported, despite embedding working correctly.

**Describe the solution you'd like**
Allow the embedding-app-origin property to accept URLs with context paths and ensure they are validated without triggering unnecessary log errors.
",ixipixi,2024-12-04 18:58:13+00:00,[],2025-02-04 20:30:13+00:00,,https://github.com/metabase/metabase/issues/50894,"[('Type:New Feature', ''), ('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('.Team/Embedding', ''), ('Operation/Logging', ""Related to what and how we log things to log files/SDOUT (don't confuse with Usage Analytics/Audit)"")]","[{'comment_id': 2569166663, 'issue_id': 2718563540, 'author': 'brunobergher', 'body': '@albertoperdomo borderline bug, no?', 'created_at': datetime.datetime(2025, 1, 3, 12, 42, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2569242774, 'issue_id': 2718563540, 'author': 'albertoperdomo', 'body': ""@brunobergher So the format we support is frame-ancestors which is also the underlying browser feature we use to control this and frame-ancestors doesn't contemplate sub-paths according [to the spec](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).\n\nSo it's possible to include the sub-path but the browser will ignore and still let the request through even if accessed from a different path.\n\nIt can be considered a bug that we accept the value, but throw errors with invalid URL and the embedding is still working correctly. I haven't been able to repro on 52, though. cc @ixipixi \n\nI think if this is not the case we should fix it.\n\nLetting people lock down by sub-path is definitely a feature request since this is not possible today with the current mechanism, at least AFAIK."", 'created_at': datetime.datetime(2025, 1, 3, 13, 44, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2569246272, 'issue_id': 2718563540, 'author': 'albertoperdomo', 'body': '@ixipixi Just to be clear, in my repro, I can include a subpath (probably we should not), but I see no invalid URL errors. Of course the subpath is ignored by the browser and you can still access from any arbitrary path.\n\nI think we should just improve the validation logic to reject sub-paths altogether and not set false expectations.', 'created_at': datetime.datetime(2025, 1, 3, 13, 46, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2630757697, 'issue_id': 2718563540, 'author': 'brunobergher', 'body': ""Agreed. The setting is inherently about origins, we shouldn't let users think there's any additional path-level enforcement happening."", 'created_at': datetime.datetime(2025, 2, 3, 12, 4, 28, tzinfo=datetime.timezone.utc)}]","brunobergher on (2025-01-03 12:42:44 UTC): @albertoperdomo borderline bug, no?

albertoperdomo on (2025-01-03 13:44:13 UTC): @brunobergher So the format we support is frame-ancestors which is also the underlying browser feature we use to control this and frame-ancestors doesn't contemplate sub-paths according [to the spec](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

So it's possible to include the sub-path but the browser will ignore and still let the request through even if accessed from a different path.

It can be considered a bug that we accept the value, but throw errors with invalid URL and the embedding is still working correctly. I haven't been able to repro on 52, though. cc @ixipixi 

I think if this is not the case we should fix it.

Letting people lock down by sub-path is definitely a feature request since this is not possible today with the current mechanism, at least AFAIK.

albertoperdomo on (2025-01-03 13:46:59 UTC): @ixipixi Just to be clear, in my repro, I can include a subpath (probably we should not), but I see no invalid URL errors. Of course the subpath is ignored by the browser and you can still access from any arbitrary path.

I think we should just improve the validation logic to reject sub-paths altogether and not set false expectations.

brunobergher on (2025-02-03 12:04:28 UTC): Agreed. The setting is inherently about origins, we shouldn't let users think there's any additional path-level enforcement happening.

"
2718419350,issue,open,,"Aggregate non-selected filter values into an ""Other"" category","**Is your feature request related to a problem? Please describe.**
While working with categories, it is often useful to show metrics for a selected few categories as well as for the overall dataset. A way of doing this could be to summarize the data for the categories not in focus into an ""Other"" group.

Currently, there is no easy way to implement this with multi-select filters.

From a user:
> Concrete example of analyzing average registrations per country : 
> * If I select France and Germany, I will see their individual average registration numbers 
> * The ""Other"" category will display the average number of registrations in all countries NOT explicitly selected 
> 
> This would enable a more flexible and focused view of the data, while capturing the full characteristics of the dataset.

**Describe the solution you'd like**
When applying a filter linked to a grouping category, provide an option to automatically group non-selected categories into an ""Other"" group.

Selecting this option would change the grouping logic to create an ""Other"" category for non-selected values rather than applying the usual WHERE clause filter logic. 


**Describe alternatives you've considered**
* Custom columns: Create a calculated column that labels selected categories with their name and all others as ""Other."" Then group by this column. However, this method doesnt support dynamic selection through a filter.

* Native questions: Use SQL and compute an union of the result set filtered on the selected categories and the complementary ""Other"" set.
For example:
```
select category, avg(price)
from PRODUCTS
where {{ category }}
group by category
[[
union
select 'Other', avg(price)
from PRODUCTS
where not {{ category }}
]]
```
That said, SQL might not be an option for other reasons, making a query builder-based approach preferred.

**How important is this feature to you?**
This functionality was suggested by a customer.

**Additional context**
A related feature could be summarizing across all categories, including the selected ones, into an ""Overall"" group. This would be useful for non-additive measures like averages.






",zbodi74,2024-12-04 17:46:13+00:00,[],2025-02-04 20:30:13+00:00,,https://github.com/metabase/metabase/issues/50891,"[('Querying/Processor', ''), ('Type:New Feature', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.')]",[],
2718194718,issue,open,,docker upgrade v0.49.8 to v0.50.1 failed,"### Describe the bug


Metabase Enterprise Edition extensions are NOT PRESENT.
2024-12-04 15:44:16,333 INFO metabase.core :: Starting Metabase in STANDALONE mode
2024-12-04 15:44:16,387 INFO metabase.server :: Launching Embedded Jetty Webserver with config:
 {:port 3000, :host ""0.0.0.0""}

2024-12-04 15:44:16,454 INFO metabase.core :: Starting Metabase version v0.51.6 (fc77ed4) ...
2024-12-04 15:44:16,461 INFO metabase.core :: System info:
 {""file.encoding"" ""UTF-8"",
 ""java.runtime.name"" ""OpenJDK Runtime Environment"",
 ""java.runtime.version"" ""11.0.25+9"",
 ""java.vendor"" ""Eclipse Adoptium"",
 ""java.vendor.url"" ""https://adoptium.net/"",
 ""java.version"" ""11.0.25"",
 ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",
 ""java.vm.version"" ""11.0.25+9"",
 ""os.name"" ""Linux"",
 ""os.version"" ""5.15.0-101-generic"",
 ""user.language"" ""en"",
 ""user.timezone"" ""GMT""}

2024-12-04 15:44:16,463 INFO metabase.plugins :: Loading plugins in /plugins...
2024-12-04 15:44:17,489 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :druid...[0m
2024-12-04 15:44:17,494 INFO driver.impl :: [34mRegistered driver :druid[0m  
2024-12-04 15:44:17,511 INFO plugins.dependencies :: [31mMetabase cannot initialize plugin Metabase Vertica Driver due to required dependencies.[0m Metabase requires the Vertica JDBC driver in order to connect to Vertica databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/vertica.html for more details.

2024-12-04 15:44:17,513 INFO plugins.dependencies :: Metabase Vertica Driver dependency {:class com.vertica.jdbc.Driver} satisfied? false
2024-12-04 15:44:17,557 INFO plugins.dependencies :: [33mPlugins with unsatisfied deps: [""Metabase Vertica Driver""][0m
2024-12-04 15:44:17,605 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :presto-jdbc...[0m
2024-12-04 15:44:17,606 INFO driver.impl :: [34mRegistered driver :presto-jdbc[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:17,666 INFO plugins.dependencies :: Plugin 'Metabase Databricks Driver' depends on plugin 'Metabase Hive Like Abstract Driver'
2024-12-04 15:44:17,667 INFO plugins.dependencies :: Metabase Databricks Driver dependency {:plugin Metabase Hive Like Abstract Driver} satisfied? false
2024-12-04 15:44:17,667 INFO plugins.dependencies :: [33mPlugins with unsatisfied deps: [""Metabase Vertica Driver"" ""Metabase Databricks Driver""][0m
2024-12-04 15:44:17,681 INFO plugins.dependencies :: Plugin 'Metabase Spark SQL Driver' depends on plugin 'Metabase Hive Like Abstract Driver'
2024-12-04 15:44:17,681 INFO plugins.dependencies :: Metabase Spark SQL Driver dependency {:plugin Metabase Hive Like Abstract Driver} satisfied? false
2024-12-04 15:44:17,682 INFO plugins.dependencies :: [33mPlugins with unsatisfied deps: [""Metabase Vertica Driver"" ""Metabase Databricks Driver"" ""Metabase Spark SQL Driver""][0m
2024-12-04 15:44:17,697 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :bigquery-cloud-sdk...[0m
2024-12-04 15:44:17,697 INFO driver.impl :: [34mRegistered driver :bigquery-cloud-sdk[0m (parents: [:sql]) 
2024-12-04 15:44:17,701 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :redshift...[0m
2024-12-04 15:44:17,702 INFO driver.impl :: [34mRegistered driver :redshift[0m (parents: [:postgres]) 
2024-12-04 15:44:17,738 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :snowflake...[0m
2024-12-04 15:44:17,739 INFO driver.impl :: [34mRegistered driver :snowflake[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:17,745 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :druid-jdbc...[0m
2024-12-04 15:44:17,746 INFO driver.impl :: [34mRegistered driver :druid-jdbc[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:17,752 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :mongo...[0m
2024-12-04 15:44:17,752 INFO driver.impl :: [34mRegistered driver :mongo[0m  
2024-12-04 15:44:17,757 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :sqlserver...[0m
2024-12-04 15:44:17,757 INFO driver.impl :: [34mRegistered driver :sqlserver[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:17,760 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :sqlite...[0m
2024-12-04 15:44:17,761 INFO driver.impl :: [34mRegistered driver :sqlite[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:17,773 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :hive-like...[0m
2024-12-04 15:44:17,773 INFO driver.impl :: [34mRegistered abstract driver :hive-like[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:17,774 INFO plugins.dependencies :: Metabase Databricks Driver dependency {:plugin Metabase Hive Like Abstract Driver} satisfied? true
2024-12-04 15:44:17,774 INFO plugins.dependencies :: Metabase Spark SQL Driver dependency {:plugin Metabase Hive Like Abstract Driver} satisfied? true
2024-12-04 15:44:17,775 DEBUG plugins.initialize :: [33mDependencies satisfied; these plugins will now be loaded: [""Metabase Spark SQL Driver"" ""Metabase Databricks Driver""][0m
2024-12-04 15:44:17,775 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :sparksql...[0m
2024-12-04 15:44:17,778 INFO driver.impl :: [34mRegistered driver :sparksql[0m (parents: [:hive-like]) 
2024-12-04 15:44:17,779 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :databricks...[0m
2024-12-04 15:44:17,779 INFO driver.impl :: [34mRegistered driver :databricks[0m (parents: [:hive-like]) 
2024-12-04 15:44:17,792 INFO plugins.dependencies :: [31mMetabase cannot initialize plugin Metabase Oracle Driver due to required dependencies.[0m Metabase requires the Oracle JDBC driver in order to connect to Oracle databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/oracle.html for more details.

2024-12-04 15:44:17,793 INFO plugins.dependencies :: Metabase Oracle Driver dependency {:class oracle.jdbc.OracleDriver} satisfied? false
2024-12-04 15:44:17,794 INFO plugins.dependencies :: [33mPlugins with unsatisfied deps: [""Metabase Oracle Driver"" ""Metabase Vertica Driver""][0m
2024-12-04 15:44:17,807 DEBUG plugins.lazy-loaded-driver :: [35mRegistering lazy loading driver :athena...[0m
2024-12-04 15:44:17,817 INFO driver.impl :: [34mRegistered driver :athena[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:17,833 INFO metabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...
2024-12-04 15:44:17,835 INFO db.setup :: [36mVerifying postgres Database Connection ...[0m
2024-12-04 15:44:18,355 INFO db.setup :: Successfully verified PostgreSQL 16.6 (Ubuntu 16.6-1.pgdg22.04+1) application database connection. 
2024-12-04 15:44:18,356 INFO db.setup :: [36mChecking if a database downgrade is required...[0m
2024-12-04 15:44:18,467 INFO liquibase.database :: Set default schema name to public
2024-12-04 15:44:19,246 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-12-04 15:44:19,460 INFO db.setup :: Running Database Migrations...
2024-12-04 15:44:19,462 INFO db.setup :: Setting up Liquibase...
2024-12-04 15:44:19,476 INFO liquibase.database :: Set default schema name to public
2024-12-04 15:44:19,821 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-12-04 15:44:19,866 INFO db.liquibase :: Updating liquibase table to reflect consolidated changeset filenames
2024-12-04 15:44:19,913 INFO liquibase.lockservice :: Successfully acquired change log lock
2024-12-04 15:44:19,916 INFO db.liquibase :: No migration lock found.
2024-12-04 15:44:19,916 INFO db.liquibase :: Migration lock acquired.
2024-12-04 15:44:19,939 INFO liquibase.lockservice :: Successfully released change log lock
2024-12-04 15:44:19,942 INFO db.setup :: Liquibase is ready.
2024-12-04 15:44:19,942 INFO db.liquibase :: Checking if Database has unrun migrations...
2024-12-04 15:44:19,965 INFO liquibase.database :: Set default schema name to public
2024-12-04 15:44:20,206 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-12-04 15:44:20,249 INFO liquibase.changelog :: Reading from public.databasechangelog
2024-12-04 15:44:20,771 INFO db.liquibase :: Database has unrun migrations. Checking if migration lock is taken...
2024-12-04 15:44:20,787 INFO liquibase.lockservice :: Successfully acquired change log lock
2024-12-04 15:44:20,790 INFO db.liquibase :: No migration lock found.
2024-12-04 15:44:20,791 INFO db.liquibase :: Migration lock acquired.
2024-12-04 15:44:20,807 INFO liquibase.database :: Set default schema name to public
2024-12-04 15:44:21,297 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-12-04 15:44:21,320 INFO liquibase.changelog :: Reading from public.databasechangelog
2024-12-04 15:44:21,507 INFO db.liquibase :: Running 131 migrations ...
2024-12-04 15:44:21,607 INFO liquibase.changelog :: Reading from public.databasechangelog
2024-12-04 15:44:21,812 INFO liquibase.command :: Using deploymentId: 3327061812
2024-12-04 15:44:21,826 INFO liquibase.changelog :: Reading from public.databasechangelog
2024-12-04 15:44:21,938 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v50.2024-01-04T13:52:51::noahmoss encountered an exception.
liquibase.exception.DatabaseException: ERROR: there is no unique constraint matching given keys for referenced table ""metabase_database"" [Failed SQL: (0) CREATE TABLE ""public"".""data_permissions"" (""id"" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, ""group_id"" INTEGER NOT NULL, ""perm_type"" VARCHAR(64) NOT NULL, ""db_id"" INTEGER NOT NULL, ""schema_name"" VARCHAR(254), ""table_id"" INTEGER, ""perm_value"" VARCHAR(64) NOT NULL, CONSTRAINT ""data_permissions_pkey"" PRIMARY KEY (""id""), CONSTRAINT ""fk_data_permissions_ref_permissions_group"" FOREIGN KEY (""group_id"") REFERENCES ""public"".""permissions_group""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_db_id"" FOREIGN KEY (""db_id"") REFERENCES ""public"".""metabase_database""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_table_id"" FOREIGN KEY (""table_id"") REFERENCES ""public"".""metabase_table""(""id"") ON DELETE CASCADE)]
	at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
	at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
	at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
	at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)
	at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)
	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
	at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
	at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
	at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.Scope.child(Scope.java:252)
	at liquibase.Scope.child(Scope.java:256)
	at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
	at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
	at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
	at liquibase.command.CommandScope.execute(CommandScope.java:217)
	at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.Liquibase.runInScope(Liquibase.java:1419)
	at liquibase.Liquibase.update(Liquibase.java:234)
	at liquibase.Liquibase.update(Liquibase.java:212)
	at liquibase.Liquibase.update(Liquibase.java:194)
	at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__45472.invoke(liquibase.clj:371)
	at metabase.db.liquibase$run_in_scope_locked$reify__45468.run(liquibase.clj:336)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:329)
	at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:312)
	at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:360)
	at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:353)
	at metabase.db.setup$migrate_BANG_55487__55488$fn__55489.invoke(setup.clj:84)
	at metabase.db.liquibase$do_with_liquibase45402__45403$f_STAR___45404.invoke(liquibase.clj:135)
	at metabase.db.liquibase$do_with_liquibase45402__45403.invokeStatic(liquibase.clj:138)
	at metabase.db.liquibase$do_with_liquibase45402__45403.invoke(liquibase.clj:126)
	at metabase.db.setup$migrate_BANG_55487__55488.invokeStatic(setup.clj:73)
	at metabase.db.setup$migrate_BANG_55487__55488.doInvoke(setup.clj:55)
	at clojure.lang.RestFn.invoke(RestFn.java:428)
	at metabase.db.setup$run_schema_migrations_BANG_55514__55515.invokeStatic(setup.clj:149)
	at metabase.db.setup$run_schema_migrations_BANG_55514__55515.invoke(setup.clj:144)
	at metabase.db.setup$setup_db_BANG_55521__55522$fn__55525$fn__55526.invoke(setup.clj:167)
	at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:238)
	at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:224)
	at metabase.db.setup$setup_db_BANG_55521__55522$fn__55525.invoke(setup.clj:161)
	at metabase.db.setup$setup_db_BANG_55521__55522.invokeStatic(setup.clj:160)
	at metabase.db.setup$setup_db_BANG_55521__55522.invoke(setup.clj:153)
	at metabase.db$setup_db_BANG_$fn__55550.invoke(db.clj:86)
	at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
	at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
	at clojure.lang.RestFn.invoke(RestFn.java:424)
	at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:121)
	at metabase.core$init_BANG__STAR_.invoke(core.clj:102)
	at metabase.core$init_BANG_.invokeStatic(core.clj:181)
	at metabase.core$init_BANG_.invoke(core.clj:176)
	at metabase.core$start_normally.invokeStatic(core.clj:193)
	at metabase.core$start_normally.invoke(core.clj:187)
	at metabase.core$entrypoint.invokeStatic(core.clj:226)
	at metabase.core$entrypoint.doInvoke(core.clj:220)
	at clojure.lang.RestFn.invoke(RestFn.java:400)
	at clojure.lang.AFn.applyToHelper(AFn.java:152)
	at clojure.lang.RestFn.applyTo(RestFn.java:135)
	at clojure.lang.Var.applyTo(Var.java:707)
	at clojure.core$apply.invokeStatic(core.clj:667)
	at clojure.core$apply.invoke(core.clj:662)
	at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
	at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
	at clojure.lang.RestFn.invoke(RestFn.java:400)
	at clojure.lang.AFn.applyToHelper(AFn.java:152)
	at clojure.lang.RestFn.applyTo(RestFn.java:135)
	at metabase.bootstrap.main(Unknown Source)
Caused by: org.postgresql.util.PSQLException: ERROR: there is no unique constraint matching given keys for referenced table ""metabase_database""
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
	at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
	at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
	... 86 more

UPDATE SUMMARY
Run:                        131
Previously run:             289
Filtered out:                51
-------------------------------
Total change sets:          471


FILTERED CHANGE SETS SUMMARY
DBMS mismatch:               51

2024-12-04 15:44:21,985 INFO liquibase.util :: UPDATE SUMMARY
2024-12-04 15:44:21,986 INFO liquibase.util :: Run:                        131
2024-12-04 15:44:21,987 INFO liquibase.util :: Previously run:             289
2024-12-04 15:44:21,987 INFO liquibase.util :: Filtered out:                51
2024-12-04 15:44:21,988 INFO liquibase.util :: -------------------------------
2024-12-04 15:44:21,988 INFO liquibase.util :: Total change sets:          471
2024-12-04 15:44:21,989 INFO liquibase.util :: FILTERED CHANGE SETS SUMMARY
2024-12-04 15:44:21,990 INFO liquibase.util :: DBMS mismatch:               51
2024-12-04 15:44:22,006 INFO liquibase.util :: Update summary generated
2024-12-04 15:44:22,011 INFO liquibase.command :: Update command encountered an exception.
2024-12-04 15:44:22,020 INFO liquibase.lockservice :: Successfully released change log lock
2024-12-04 15:44:22,025 INFO liquibase.command :: Logging exception.
2024-12-04 15:44:22,025 INFO liquibase.command :: Command execution complete
2024-12-04 15:44:22,033 INFO liquibase.lockservice :: Successfully released change log lock
2024-12-04 15:44:22,082 ERROR metabase.core :: Metabase Initialization FAILED
liquibase.exception.CommandExecutionException: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-04T13:52:51::noahmoss:
     Reason: liquibase.exception.DatabaseException: ERROR: there is no unique constraint matching given keys for referenced table ""metabase_database"" [Failed SQL: (0) CREATE TABLE ""public"".""data_permissions"" (""id"" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, ""group_id"" INTEGER NOT NULL, ""perm_type"" VARCHAR(64) NOT NULL, ""db_id"" INTEGER NOT NULL, ""schema_name"" VARCHAR(254), ""table_id"" INTEGER, ""perm_value"" VARCHAR(64) NOT NULL, CONSTRAINT ""data_permissions_pkey"" PRIMARY KEY (""id""), CONSTRAINT ""fk_data_permissions_ref_permissions_group"" FOREIGN KEY (""group_id"") REFERENCES ""public"".""permissions_group""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_db_id"" FOREIGN KEY (""db_id"") REFERENCES ""public"".""metabase_database""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_table_id"" FOREIGN KEY (""table_id"") REFERENCES ""public"".""metabase_table""(""id"") ON DELETE CASCADE)]
	at liquibase.command.CommandScope.execute(CommandScope.java:253)
	at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.Liquibase.runInScope(Liquibase.java:1419)
	at liquibase.Liquibase.update(Liquibase.java:234)
	at liquibase.Liquibase.update(Liquibase.java:212)
	at liquibase.Liquibase.update(Liquibase.java:194)
	at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__45472.invoke(liquibase.clj:371)
	at metabase.db.liquibase$run_in_scope_locked$reify__45468.run(liquibase.clj:336)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:329)
	at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:312)
	at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:360)
	at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:353)
	at metabase.db.setup$migrate_BANG_55487__55488$fn__55489.invoke(setup.clj:84)
	at metabase.db.liquibase$do_with_liquibase45402__45403$f_STAR___45404.invoke(liquibase.clj:135)
	at metabase.db.liquibase$do_with_liquibase45402__45403.invokeStatic(liquibase.clj:138)
	at metabase.db.liquibase$do_with_liquibase45402__45403.invoke(liquibase.clj:126)
	at metabase.db.setup$migrate_BANG_55487__55488.invokeStatic(setup.clj:73)
	at metabase.db.setup$migrate_BANG_55487__55488.doInvoke(setup.clj:55)
	at clojure.lang.RestFn.invoke(RestFn.java:428)
	at metabase.db.setup$run_schema_migrations_BANG_55514__55515.invokeStatic(setup.clj:149)
	at metabase.db.setup$run_schema_migrations_BANG_55514__55515.invoke(setup.clj:144)
	at metabase.db.setup$setup_db_BANG_55521__55522$fn__55525$fn__55526.invoke(setup.clj:167)
	at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:238)
	at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:224)
	at metabase.db.setup$setup_db_BANG_55521__55522$fn__55525.invoke(setup.clj:161)
	at metabase.db.setup$setup_db_BANG_55521__55522.invokeStatic(setup.clj:160)
	at metabase.db.setup$setup_db_BANG_55521__55522.invoke(setup.clj:153)
	at metabase.db$setup_db_BANG_$fn__55550.invoke(db.clj:86)
	at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
	at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
	at clojure.lang.RestFn.invoke(RestFn.java:424)
	at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:121)
	at metabase.core$init_BANG__STAR_.invoke(core.clj:102)
	at metabase.core$init_BANG_.invokeStatic(core.clj:181)
	at metabase.core$init_BANG_.invoke(core.clj:176)
	at metabase.core$start_normally.invokeStatic(core.clj:193)
	at metabase.core$start_normally.invoke(core.clj:187)
	at metabase.core$entrypoint.invokeStatic(core.clj:226)
	at metabase.core$entrypoint.doInvoke(core.clj:220)
	at clojure.lang.RestFn.invoke(RestFn.java:400)
	at clojure.lang.AFn.applyToHelper(AFn.java:152)
	at clojure.lang.RestFn.applyTo(RestFn.java:135)
	at clojure.lang.Var.applyTo(Var.java:707)
	at clojure.core$apply.invokeStatic(core.clj:667)
	at clojure.core$apply.invoke(core.clj:662)
	at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
	at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
	at clojure.lang.RestFn.invoke(RestFn.java:400)
	at clojure.lang.AFn.applyToHelper(AFn.java:152)
	at clojure.lang.RestFn.applyTo(RestFn.java:135)
	at metabase.bootstrap.main(Unknown Source)
Caused by: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-04T13:52:51::noahmoss:
     Reason: liquibase.exception.DatabaseException: ERROR: there is no unique constraint matching given keys for referenced table ""metabase_database"" [Failed SQL: (0) CREATE TABLE ""public"".""data_permissions"" (""id"" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, ""group_id"" INTEGER NOT NULL, ""perm_type"" VARCHAR(64) NOT NULL, ""db_id"" INTEGER NOT NULL, ""schema_name"" VARCHAR(254), ""table_id"" INTEGER, ""perm_value"" VARCHAR(64) NOT NULL, CONSTRAINT ""data_permissions_pkey"" PRIMARY KEY (""id""), CONSTRAINT ""fk_data_permissions_ref_permissions_group"" FOREIGN KEY (""group_id"") REFERENCES ""public"".""permissions_group""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_db_id"" FOREIGN KEY (""db_id"") REFERENCES ""public"".""metabase_database""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_table_id"" FOREIGN KEY (""table_id"") REFERENCES ""public"".""metabase_table""(""id"") ON DELETE CASCADE)]
	at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:151)
	at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
	at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
	at liquibase.command.CommandScope.execute(CommandScope.java:217)
	... 58 more
Caused by: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v50.2024-01-04T13:52:51::noahmoss:
     Reason: liquibase.exception.DatabaseException: ERROR: there is no unique constraint matching given keys for referenced table ""metabase_database"" [Failed SQL: (0) CREATE TABLE ""public"".""data_permissions"" (""id"" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, ""group_id"" INTEGER NOT NULL, ""perm_type"" VARCHAR(64) NOT NULL, ""db_id"" INTEGER NOT NULL, ""schema_name"" VARCHAR(254), ""table_id"" INTEGER, ""perm_value"" VARCHAR(64) NOT NULL, CONSTRAINT ""data_permissions_pkey"" PRIMARY KEY (""id""), CONSTRAINT ""fk_data_permissions_ref_permissions_group"" FOREIGN KEY (""group_id"") REFERENCES ""public"".""permissions_group""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_db_id"" FOREIGN KEY (""db_id"") REFERENCES ""public"".""metabase_database""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_table_id"" FOREIGN KEY (""table_id"") REFERENCES ""public"".""metabase_table""(""id"") ON DELETE CASCADE)]
	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:797)
	at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
	at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
	at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
	at liquibase.Scope.lambda$child$0(Scope.java:186)
	at liquibase.Scope.child(Scope.java:195)
	at liquibase.Scope.child(Scope.java:185)
	at liquibase.Scope.child(Scope.java:164)
	at liquibase.Scope.child(Scope.java:252)
	at liquibase.Scope.child(Scope.java:256)
	at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
	... 66 more
Caused by: liquibase.exception.DatabaseException: ERROR: there is no unique constraint matching given keys for referenced table ""metabase_database"" [Failed SQL: (0) CREATE TABLE ""public"".""data_permissions"" (""id"" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, ""group_id"" INTEGER NOT NULL, ""perm_type"" VARCHAR(64) NOT NULL, ""db_id"" INTEGER NOT NULL, ""schema_name"" VARCHAR(254), ""table_id"" INTEGER, ""perm_value"" VARCHAR(64) NOT NULL, CONSTRAINT ""data_permissions_pkey"" PRIMARY KEY (""id""), CONSTRAINT ""fk_data_permissions_ref_permissions_group"" FOREIGN KEY (""group_id"") REFERENCES ""public"".""permissions_group""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_db_id"" FOREIGN KEY (""db_id"") REFERENCES ""public"".""metabase_database""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_data_permissions_ref_table_id"" FOREIGN KEY (""table_id"") REFERENCES ""public"".""metabase_table""(""id"") ON DELETE CASCADE)]
	at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
	at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
	at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
	at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)
	at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)
	at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
	... 81 more
Caused by: org.postgresql.util.PSQLException: ERROR: there is no unique constraint matching given keys for referenced table ""metabase_database""
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
	at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
	at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
	... 86 more
2024-12-04 15:44:22,097 INFO metabase.core :: Metabase Shutting Down ...
2024-12-04 15:44:22,100 INFO metabase.server :: Shutting Down Embedded Jetty Webserver
2024-12-04 15:44:22,111 WARN db.liquibase :: ()
2024-12-04 15:44:22,111 INFO metabase.core :: Metabase Shutdown COMPLETE
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
	at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
	at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
	... 86 more
2024-12-04 15:44:22,097 INFO metabase.core :: Metabase Shutting Down ...
2024-12-04 15:44:22,100 INFO metabase.server :: Shutting Down Embedded Jetty Webserver
2024-12-04 15:44:22,111 WARN db.liquibase :: ()
2024-12-04 15:44:22,111 INFO metabase.core :: Metabase Shutdown COMPLETE
Warning: environ value jdk-11.0.25+9 for key :java-version has been overwritten with 11.0.25
2024-12-04 15:44:29,170 INFO metabase.util :: Maximum memory available to JVM: 852.0 MB
2024-12-04 15:44:32,558 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance.  
 For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html
2024-12-04 15:44:39,729 INFO driver.impl :: [34mRegistered abstract driver :sql[0m  
2024-12-04 15:44:39,779 INFO driver.impl :: [34mRegistered abstract driver :sql-jdbc[0m (parents: [:sql]) 
2024-12-04 15:44:39,789 INFO metabase.util :: [32mLoad driver :sql-jdbc took 23.8 ms[0m
2024-12-04 15:44:39,790 INFO driver.impl :: [34mRegistered driver :h2[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:40,149 INFO driver.impl :: [34mRegistered driver :mysql[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:40,193 INFO driver.impl :: [34mRegistered driver :postgres[0m (parents: [:sql-jdbc]) 
2024-12-04 15:44:42,095 INFO metabase.core :: 
Metabase v0.51.6 (fc77ed4) 

Copyright  2024 Metabase, Inc. 

Metabase Enterprise Edition extensions are NOT PRESENT.
2024-12-04 15:44:42,101 INFO metabase.core :: Starting Metabase in STANDALONE mode
2024-12-04 15:44:42,166 INFO metabase.server :: Launching Embedded Jetty Webserver with config:
 {:port 3000, :host ""0.0.0.0""}

2024-12-04 15:44:42,251 INFO metabase.core :: Starting Metabase version v0.51.6 (fc77ed4) ...
2024-12-04 15:44:42,279 INFO metabase.core :: System info:
 {""file.encoding"" ""UTF-8"",
 ""java.runtime.name"" ""OpenJDK Runtime Environment"",
 ""java.runtime.version"" ""11.0.25+9"",
 ""java.vendor"" ""Eclipse Adoptium"",
 ""java.vendor.url"" ""https://adoptium.net/"",
 ""java.version"" ""11.0.25"",
 ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",
 ""java.vm.version"" ""11.0.25+9"",
 ""os.name"" ""Linux"",
 ""os.version"" ""5.15.0-101-generic"",
 ""user.language"" ""en"",
 ""user.timezone"" ""GMT""}

### To Reproduce

docker upgrade  metabase/metabase:v0.49.8  to v0.50.1

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-CN"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-101-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.6 (Ubuntu 16.6-1.pgdg22.04+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.2""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2024-05-02"",
      ""tag"": ""v0.49.8"",
      ""hash"": ""38cb850""
    },
    ""settings"": {
      ""report-timezone"": null
    }
  }
}
```

### Severity

blocking an upgrade

### Additional context

_No response_",delai,2024-12-04 16:02:48+00:00,[],2025-02-04 20:26:30+00:00,,https://github.com/metabase/metabase/issues/50882,"[('Operation/Database Migrations', 'Issues with application DB migrations when launching Metabase'), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2517908872, 'issue_id': 2718194718, 'author': 'noahmoss', 'body': ""Hi @delai, thanks for your report. That's a strange failure because it's indicating that the `metabase_database.id` column in the DB doesn't have a unique constraint, but it should since it's the primary key. If you can access your application database, can you send the schema for `metabase_database`? (e.g. `\\d+ metabase_database` in `psql`)"", 'created_at': datetime.datetime(2024, 12, 4, 16, 15, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2523938549, 'issue_id': 2718194718, 'author': 'dpsutton', 'body': 'The error here is\n\n```sql\nliquibase.exception.DatabaseException:\nERROR: there is no unique constraint matching given keys for referenced table ""metabase_database""\n[Failed SQL: (0)\nCREATE TABLE ""public"".""data_permissions""\n  (""id"" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,\n   ""group_id"" INTEGER NOT NULL,\n   ""perm_type"" VARCHAR(64) NOT NULL,\n   ""db_id"" INTEGER NOT NULL,\n   ""schema_name"" VARCHAR(254),\n   ""table_id"" INTEGER,\n   ""perm_value"" VARCHAR(64) NOT NULL,\n      CONSTRAINT ""data_permissions_pkey"" PRIMARY KEY (""id""),\n      CONSTRAINT ""fk_data_permissions_ref_permissions_group""\n           FOREIGN KEY (""group_id"") REFERENCES ""public"".""permissions_group""(""id"")\n              ON DELETE CASCADE,\n      CONSTRAINT ""fk_data_permissions_ref_db_id""\n           FOREIGN KEY (""db_id"") REFERENCES ""public"".""metabase_database""(""id"") -- <--\n              ON DELETE CASCADE,\n      CONSTRAINT ""fk_data_permissions_ref_table_id""\n           FOREIGN KEY (""table_id"") REFERENCES ""public"".""metabase_table""(""id"")\n              ON DELETE CASCADE)\n```\n\nIt is complaining that there is no unique constraint on the metabase_database table. We are referring to the `metabase_database.id` column which _absolutely_ should be unique. \n\nCan you show the output of this command?\n\n```sql\nclean=# \\d metabase_database\n                                          Table ""public.metabase_database""\n           Column            |           Type           | Collation | Nullable |               Default\n-----------------------------+--------------------------+-----------+----------+-------------------------------------\n id                          | integer                  |           | not null | generated by default as identity\n...\nIndexes:\n    ""metabase_database_pkey"" PRIMARY KEY, btree (id)  -- <-- the btree on id here is what we are attempting to rely on\n    ""idx_metabase_database_creator_id"" btree (creator_id)\n\n```\n\nAs such, I\'m not sure this is a bug with metabase.', 'created_at': datetime.datetime(2024, 12, 6, 18, 43, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2625211601, 'issue_id': 2718194718, 'author': 'paoliniluis', 'body': 'hi @delai have you been able to fix this?', 'created_at': datetime.datetime(2025, 1, 30, 18, 3, 35, tzinfo=datetime.timezone.utc)}]","noahmoss on (2024-12-04 16:15:38 UTC): Hi @delai, thanks for your report. That's a strange failure because it's indicating that the `metabase_database.id` column in the DB doesn't have a unique constraint, but it should since it's the primary key. If you can access your application database, can you send the schema for `metabase_database`? (e.g. `\d+ metabase_database` in `psql`)

dpsutton on (2024-12-06 18:43:59 UTC): The error here is

```sql
liquibase.exception.DatabaseException:
ERROR: there is no unique constraint matching given keys for referenced table ""metabase_database""
[Failed SQL: (0)
CREATE TABLE ""public"".""data_permissions""
  (""id"" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   ""group_id"" INTEGER NOT NULL,
   ""perm_type"" VARCHAR(64) NOT NULL,
   ""db_id"" INTEGER NOT NULL,
   ""schema_name"" VARCHAR(254),
   ""table_id"" INTEGER,
   ""perm_value"" VARCHAR(64) NOT NULL,
      CONSTRAINT ""data_permissions_pkey"" PRIMARY KEY (""id""),
      CONSTRAINT ""fk_data_permissions_ref_permissions_group""
           FOREIGN KEY (""group_id"") REFERENCES ""public"".""permissions_group""(""id"")
              ON DELETE CASCADE,
      CONSTRAINT ""fk_data_permissions_ref_db_id""
           FOREIGN KEY (""db_id"") REFERENCES ""public"".""metabase_database""(""id"") -- <--
              ON DELETE CASCADE,
      CONSTRAINT ""fk_data_permissions_ref_table_id""
           FOREIGN KEY (""table_id"") REFERENCES ""public"".""metabase_table""(""id"")
              ON DELETE CASCADE)
```

It is complaining that there is no unique constraint on the metabase_database table. We are referring to the `metabase_database.id` column which _absolutely_ should be unique. 

Can you show the output of this command?

```sql
clean=# \d metabase_database
                                          Table ""public.metabase_database""
           Column            |           Type           | Collation | Nullable |               Default
-----------------------------+--------------------------+-----------+----------+-------------------------------------
 id                          | integer                  |           | not null | generated by default as identity
...
Indexes:
    ""metabase_database_pkey"" PRIMARY KEY, btree (id)  -- <-- the btree on id here is what we are attempting to rely on
    ""idx_metabase_database_creator_id"" btree (creator_id)

```

As such, I'm not sure this is a bug with metabase.

paoliniluis on (2025-01-30 18:03:35 UTC): hi @delai have you been able to fix this?

"
2718057996,issue,closed,completed,create-dashboard-subscription,,perivamsi,2024-12-04 15:12:14+00:00,['metamben'],2024-12-13 16:07:00+00:00,2024-12-10 21:54:46+00:00,https://github.com/metabase/metabase/issues/50879,"[('Metabot/Tools', 'Tools that are agnostic of the LLM framework itself, could be reused for notifications framework als')]",[],
2717881458,issue,closed,completed,Error Saving Field Usages,"**Describe the bug**
We are getting an error in our logs for ""error saving field usages"".
Not really sure what this is and if it's important even. Because from the looks of it, things do seem to be working.

**Logs**
```
[
  1433845f-9766-4d77-b06f-0fd2fbf29100
] 2024-12-04T14: 58: 39+01: 00 ERROR metabase.query-processor.middleware.process-userland-query Error saving field usages,clojure.lang.ExceptionInfo: Unknown type of ref {
  :ref [
    := {
      :lib/uuid ""5c972e38-046b-439a-a95c-8e0f2571f75c""
    } [
      :field {
        :base-type :type/Text,
        :lib/uuid ""b732ec7a-e715-4340-844a-e210c7ee7126"",
        :effective-type :type/Text
      } 378
    ] [
      :value {
        :effective_type :type/Text,
        :name ""event"",
        :base-type :type/Text,
        :semantic-type :type/Category,
        :database-type ""text"",
        :effective-type :type/Text,
        :lib/uuid ""406975d2-daaa-47f8-b1bd-1aa065da50ab""
      } ""EXITWITHTIMEOUT""
    ]
  ]
},	at metabase.lib.equality$find_matching_column31884__31887.invokeStatic(equality.cljc: 310),	at metabase.lib.equality$find_matching_column31884__31887.invoke(equality.cljc: 266),	at metabase.lib.equality$find_matching_column31884__31887.invokeStatic(equality.cljc: 323),	at metabase.lib.equality$find_matching_column31884__31887.invoke(equality.cljc: 266),	at metabase.lib.equality$find_matching_column31884__31887.invokeStatic(equality.cljc: 313),	at metabase.lib.equality$find_matching_column31884__31887.invoke(equality.cljc: 266),	at metabase.lib.filter$filter_parts32739__32740.invokeStatic(filter.cljc: 552),	at metabase.lib.filter$filter_parts32739__32740.invoke(filter.cljc: 540),	at metabase.models.field_usage$filter__GT_field_usage.invokeStatic(field_usage.clj: 29),	at metabase.models.field_usage$filter__GT_field_usage.invoke(field_usage.clj: 27),	at metabase.models.field_usage$stage__GT_field_usages$fn__77867.invoke(field_usage.clj: 76),	at clojure.core$keep$fn__8691.invoke(core.clj: 7529),	at clojure.lang.LazySeq.force(LazySeq.java: 50),	at clojure.lang.LazySeq.realize(LazySeq.java: 89),	at clojure.lang.LazySeq.seq(LazySeq.java: 106),	at clojure.lang.RT.seq(RT.java: 555),	at clojure.core$seq__5486.invokeStatic(core.clj: 139),	at clojure.core$concat$fn__5577.invoke(core.clj: 727),	at clojure.lang.LazySeq.force(LazySeq.java: 50),	at clojure.lang.LazySeq.realize(LazySeq.java: 89),	at clojure.lang.LazySeq.seq(LazySeq.java: 106),	at clojure.lang.RT.seq(RT.java: 555),	at clojure.core$seq__5486.invokeStatic(core.clj: 139),	at clojure.core$concat$cat__5579$fn__5580.invoke(core.clj: 736),	at clojure.lang.LazySeq.force(LazySeq.java: 50),	at clojure.lang.LazySeq.lockAndForce(LazySeq.java: 60),	at clojure.lang.LazySeq.sval(LazySeq.java: 69),	at clojure.lang.LazySeq.unwrap(LazySeq.java: 77),	at clojure.lang.LazySeq.realize(LazySeq.java: 93),	at clojure.lang.LazySeq.seq(LazySeq.java: 106),	at clojure.lang.RT.seq(RT.java: 555),	at clojure.core$seq__5486.invokeStatic(core.clj: 139),	at clojure.core$map$fn__5954.invoke(core.clj: 2763),	at clojure.lang.LazySeq.force(LazySeq.java: 50),	at clojure.lang.LazySeq.realize(LazySeq.java: 89),	at clojure.lang.LazySeq.seq(LazySeq.java: 106),	at clojure.lang.RT.seq(RT.java: 555),	at clojure.core$seq__5486.invokeStatic(core.clj: 139),	at clojure.core$concat$cat__5579$fn__5580.invoke(core.clj: 736),	at clojure.lang.LazySeq.force(LazySeq.java: 50),	at clojure.lang.LazySeq.lockAndForce(LazySeq.java: 60),	at clojure.lang.LazySeq.sval(LazySeq.java: 69),	at clojure.lang.LazySeq.unwrap(LazySeq.java: 77),	at clojure.lang.LazySeq.realize(LazySeq.java: 93),	at clojure.lang.LazySeq.seq(LazySeq.java: 106),	at clojure.lang.RT.seq(RT.java: 555),	at clojure.core$seq__5486.invokeStatic(core.clj: 139),	at clojure.core$map$fn__5954.invoke(core.clj: 2763),	at clojure.lang.LazySeq.force(LazySeq.java: 50),	at clojure.lang.LazySeq.realize(LazySeq.java: 89),	at clojure.lang.LazySeq.seq(LazySeq.java: 106),	at clojure.lang.ChunkedCons.chunkedNext(ChunkedCons.java: 61),	at clojure.lang.ChunkedCons.next(ChunkedCons.java: 45),	at clojure.lang.RT.next(RT.java: 733),	at clojure.core$next__5470.invokeStatic(core.clj: 64),	at clojure.core$dorun.invokeStatic(core.clj: 3150),	at clojure.core$doall.invokeStatic(core.clj: 3156),	at clojure.walk$walk.invokeStatic(walk.clj: 47),	at clojure.walk$prewalk.invokeStatic(walk.clj: 65),	at clojure.walk$prewalk.invoke(walk.clj: 61),	at clojure.core$partial$fn__5927.invoke(core.clj: 2641),	at clojure.core$map$fn__5954.invoke(core.clj: 2772),	at clojure.lang.LazySeq.force(LazySeq.java: 50),	at clojure.lang.LazySeq.realize(LazySeq.java: 89),	at clojure.lang.LazySeq.seq(LazySeq.java: 106),	at clojure.lang.Cons.next(Cons.java: 41),	at clojure.lang.RT.next(RT.java: 733),	at clojure.core$next__5470.invokeStatic(core.clj: 64),	at clojure.core$dorun.invokeStatic(core.clj: 3150),	at clojure.core$doall.invokeStatic(core.clj: 3156),	at clojure.walk$walk.invokeStatic(walk.clj: 47),	at clojure.walk$prewalk.invokeStatic(walk.clj: 65),	at clojure.walk$prewalk.invoke(walk.clj: 61),	at clojure.core$partial$fn__5927.invoke(core.clj: 2641),	at clojure.walk$walk.invokeStatic(walk.clj: 46),	at clojure.walk$prewalk.invokeStatic(walk.clj: 65),	at clojure.walk$prewalk.invoke(walk.clj: 61),	at clojure.core$partial$fn__5927.invoke(core.clj: 2641),	at clojure.core$map$fn__5954.invoke(core.clj: 2772),	at clojure.lang.LazySeq.force(LazySeq.java: 50),	at clojure.lang.LazySeq.realize(LazySeq.java: 89),	at clojure.lang.LazySeq.seq(LazySeq.java: 106),	at clojure.lang.Cons.next(Cons.java: 41),	at clojure.lang.RT.next(RT.java: 733),	at clojure.core$next__5470.invokeStatic(core.clj: 64),	at clojure.core.protocols$fn__8275.invokeStatic(protocols.clj: 168),	at clojure.core.protocols$fn__8275.invoke(protocols.clj: 123),	at clojure.core.protocols$fn__8229$G__8224__8238.invoke(protocols.clj: 19),	at clojure.core.protocols$seq_reduce.invokeStatic(protocols.clj: 31),	at clojure.core.protocols$fn__8262.invokeStatic(protocols.clj: 74),	at clojure.core.protocols$fn__8262.invoke(protocols.clj: 74),	at clojure.core.protocols$fn__8203$G__8198__8216.invoke(protocols.clj: 13),	at clojure.core$reduce.invokeStatic(core.clj: 6965),	at clojure.core$into.invokeStatic(core.clj: 7038),	at clojure.walk$walk.invokeStatic(walk.clj: 50),	at clojure.walk$prewalk.invokeStatic(walk.clj: 65),	at clojure.walk$prewalk.invoke(walk.clj: 61),	at clojure.core$partial$fn__5927.invoke(core.clj: 2641),	at clojure.core$map$fn__5954.invoke(core.clj: 2770),	at clojure.lang.LazySeq.force(LazySeq.java: 50),	at clojure.lang.LazySeq.realize(LazySeq.java: 89),	at clojure.lang.LazySeq.seq(LazySeq.java: 106),	at clojure.lang.RT.seq(RT.java: 555),	at clojure.core$seq__5486.invokeStatic(core.clj: 139),	at clojure.core.protocols$seq_reduce.invokeStatic(protocols.clj: 24),	at clojure.core.protocols$fn__8262.invokeStatic(protocols.clj: 74),	at clojure.core.protocols$fn__8262.invoke(protocols.clj: 74),	at clojure.core.protocols$fn__8203$G__8198__8216.invoke(protocols.clj: 13),	at clojure.core$reduce.invokeStatic(core.clj: 6965),	at clojure.core$into.invokeStatic(core.clj: 7038),	at clojure.walk$walk.invokeStatic(walk.clj: 50),	at clojure.walk$prewalk.invokeStatic(walk.clj: 65),	at clojure.walk$prewalk.invoke(walk.clj: 61),	at toucan2.util$add_context_to_ex_data$fn__22364.invoke(util.clj: 53),	at clojure.core$update.invokeStatic(core.clj: 6259),	at clojure.core$update.invoke(core.clj: 6251),	at toucan2.util$add_context_to_ex_data.invokeStatic(util.clj: 51),	at toucan2.util$add_context_to_ex_data.invoke(util.clj: 50),	at toucan2.util$fn__22370.invokeStatic(util.clj: 78),	at toucan2.util$fn__22370.invoke(util.clj: 72),	at toucan2.util$fn__22350$G__22345__22357.invoke(util.clj: 47),	at toucan2.query$parse_args_with_spec.invokeStatic(query.clj: 69),	at toucan2.query$parse_args_with_spec.invoke(query.clj: 66),	at toucan2.insert$parse_args_primary_method_toucan_query_type_insert__STAR_.invokeStatic(insert.clj: 35),	at toucan2.insert$parse_args_primary_method_toucan_query_type_insert__STAR_.invoke(insert.clj: 32),	at methodical.impl.combo.common$partial_STAR_$fn__19336.invoke(common.clj: 12),	at methodical.util.FnWithMeta.invoke(util.clj: 46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj: 55),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj: 47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj: 210),	at toucan2.pipeline$transduce_unparsed.invokeStatic(pipeline.clj: 315),	at toucan2.pipeline$transduce_unparsed.invoke(pipeline.clj: 311),	at toucan2.pipeline$transduce_unparsed_with_default_rf.invokeStatic(pipeline.clj: 374),	at toucan2.pipeline$transduce_unparsed_with_default_rf.invoke(pipeline.clj: 368),	at toucan2.insert$insert_BANG_.invokeStatic(insert.clj: 124),	at toucan2.insert$insert_BANG_.doInvoke(insert.clj: 74),	at clojure.lang.RestFn.invoke(RestFn.java: 424),	at metabase.query_processor.middleware.process_userland_query$fn__77890$fn__77891$fn__77892.invoke(process_userland_query.clj: 43),	at grouper.core$body_fn$fn__64664.invoke(core.clj: 72),	at grouper.core$start_BANG_$thread__64707.invoke(core.clj: 135),	at clojure.lang.AFn.run(AFn.java: 22),	at java.base/java.lang.Thread.run(Unknown Source)
```

**Expected behavior**
I would expect the logs to not have these types of issues since it otherwise seems to be working. I have also restarted the system.

**Severity**
Slightly annoying because we don't know what it is. But at the moment it isn't blocking us from using the system.

**Additional context**
We are running in docker environment.

**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""sqlserver"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-28"",
      ""tag"": ""v0.51.6"",
      ""hash"": ""fc77ed4""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Stockholm""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.1 (Debian 16.1-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.0-18-amd64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```",Snuffsis,2024-12-04 14:10:17+00:00,[],2025-01-06 16:10:46+00:00,2025-01-06 16:10:46+00:00,https://github.com/metabase/metabase/issues/50875,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('Administration/Usage analytics', 'Pro and Enterprise meta analytics, fka audit'), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2528717524, 'issue_id': 2717881458, 'author': 'jmartin127', 'body': 'I am also experiencing this issue.  \n\nError:\n\n```\n2024-12-09 16:51:05,382 ERROR middleware.process-userland-query :: Error saving field usages\nclojure.lang.ExceptionInfo: Unknown type of ref {:ref [:/ {:lib/uuid ""4d5e0320-30ed-4b8b-aefb-c3fe9629937e""} [:sum {:lib/uuid ""f5d9b736-9128-4546-8e6d-eb2265c5d816""} [:field {:lib/uuid ""3a7b7e92-b804-41a9-b19a-d8af2dea50c9"", :metabase.lib.query/transformation-added-base-type true, :base-type :type/Decimal, :effective-type :type/Decimal} 2492]] 100]}\n\tat metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:308)\n\tat metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264)\n\tat metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:289)\n\tat metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264)\n\tat metabase.lib.aggregation$aggregation_column33058__33060.invokeStatic(aggregation.cljc:433)\n\tat metabase.lib.aggregation$aggregation_column33058__33060.invoke(aggregation.cljc:423)\n\tat metabase.models.field_usage$aggregation__GT_field_usage.invokeStatic(field_usage.clj:38)\n\tat metabase.models.field_usage$aggregation__GT_field_usage.invoke(field_usage.clj:36)\n\tat metabase.models.field_usage$stage__GT_field_usages$fn__78328.invoke(field_usage.clj:77)\n\tat clojure.core$keep$fn__8691.invoke(core.clj:7529)\n\tat clojure.lang.LazySeq.force(LazySeq.java:50)\n\tat clojure.lang.LazySeq.lockAndForce(LazySeq.java:60)\n\tat clojure.lang.LazySeq.sval(LazySeq.java:69)\n\tat clojure.lang.LazySeq.unwrap(LazySeq.java:77)\n\tat clojure.lang.LazySeq.realize(LazySeq.java:93)\n\tat clojure.lang.LazySeq.seq(LazySeq.java:106)\n\tat clojure.lang.RT.seq(RT.java:555)\n\tat clojure.core$seq__5486.invokeStatic(core.clj:139)\n\tat clojure.core$concat$cat__5579$fn__5580.invoke(core.clj:736)\n\tat clojure.lang.LazySeq.force(LazySeq.java:50)\n\tat clojure.lang.LazySeq.realize(LazySeq.java:89)\n```\n\nMetabase version: `v0.52.1.3`', 'created_at': datetime.datetime(2024, 12, 9, 16, 55, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2547485592, 'issue_id': 2717881458, 'author': 'andrewler', 'body': '+1\nI experience it after opening a model. I was trying to debug the model persistence performance because I felt it was taking too long to open (~120sec) and discovered this error in the logs. Is the model being properly persisted despite this error?\n\nEdit to add:\nThe same error appears in the logs when I manually run the question that the model originates from. The question also takes around 120 seconds to complete. There appears to be no performance difference between manually running the question vs viewing the supposedly persistence-enabled model.\n\nLogs\n```\n2024-12-17T12:03:29+09:00 INFO metabase.api.dataset Source query for this query is Card 506\n2024-12-17T12:03:30+09:00 INFO metabase.query-processor.middleware.fetch-source-query Found substitute cached query for card 506 from metabase_cache_5f4b1_2.model_506_morocco_ma\n2024-12-17T12:05:33+09:00 DEBUG metabase.server.middleware.log POST /api/dataset 202 [ASYNC: completed] 2.1 mins (21 DB calls) App DB connections: 1/15 Jetty threads: 4/50 (2 idle, 0 queued) (126 total active threads) Queries in flight: 0 (0 queued); mysql DB 2 connections: 0/2 (0 threads blocked) {:metabase-user-id 1}\n2024-12-17T12:05:36+09:00 ERROR metabase.query-processor.middleware.process-userland-query Error saving field usages,clojure.lang.ExceptionInfo: Unknown type of ref {:ref [:= {:lib/uuid ""0f73a263-95d0-48fe-875e-4eb5132a977f""} [:field {:base-type :type/Text, :lib/uuid ""4b4d95e4-8364-406d-9bf8-9361d6b2efff""} ""pn""] [:value {:effective_type :type/Text, :base-type :type/Text, :database-type ""VARCHAR"", :effective-type :type/Text, :lib/uuid ""eb0584c2-812b-4f5b-80eb-d43125371971""} ""CBZTSBE247A09327""]], :toucan2/context-trace [[""parse args"" {:toucan2.query/query-type :toucan.query-type/insert.update-count, :toucan2.query/unparsed-args (:model/FieldUsage ())}]]},\tat metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:308),\tat metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264),\tat metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:321),\tat metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264),\tat metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:311),\tat metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264),\tat metabase.lib.filter$filter_parts32794__32795.invokeStatic(filter.cljc:552),\tat metabase.lib.filter$filter_parts32794__32795.invoke(filter.cljc:540),\tat metabase.models.field_usage$filter__GT_field_usage.invokeStatic(field_usage.clj:29),\tat metabase.models.field_usage$filter__GT_field_usage.invoke(field_usage.clj:27),\tat metabase.models.field_usage$stage__GT_field_usages$fn__78286.invoke(field_usage.clj:76),\tat clojure.core$keep$fn__8691.invoke(core.clj:7529),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$concat$fn__5577.invoke(core.clj:727),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$concat$cat__5579$fn__5580.invoke(core.clj:736),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.lockAndForce(LazySeq.java:60),\tat clojure.lang.LazySeq.sval(LazySeq.java:69),\tat clojure.lang.LazySeq.unwrap(LazySeq.java:77),\tat clojure.lang.LazySeq.realize(LazySeq.java:93),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$concat$cat__5579$fn__5580.invoke(core.clj:736),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$map$fn__5954.invoke(core.clj:2763),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.lockAndForce(LazySeq.java:60),\tat clojure.lang.LazySeq.sval(LazySeq.java:69),\tat clojure.lang.LazySeq.unwrap(LazySeq.java:77),\tat clojure.lang.LazySeq.realize(LazySeq.java:93),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$seq__5486.invoke(core.clj:139),\tat clojure.spec.alpha$regex_spec_impl$reify__2496.conform_STAR_(alpha.clj:1708),\tat clojure.spec.alpha$conform.invokeStatic(alpha.clj:171),\tat clojure.spec.alpha$conform.invoke(alpha.clj:167),\tat clojure.spec.alpha$dt.invokeStatic(alpha.clj:762),\tat clojure.spec.alpha$dt.invoke(alpha.clj:757),\tat clojure.spec.alpha$dt.invokeStatic(alpha.clj:758),\tat clojure.spec.alpha$dt.invoke(alpha.clj:757),\tat clojure.spec.alpha$deriv.invokeStatic(alpha.clj:1532),\tat clojure.spec.alpha$deriv.invoke(alpha.clj:1526),\tat clojure.spec.alpha$deriv$fn__2412.invoke(alpha.clj:1542),\tat clojure.core$map$fn__5954.invoke(core.clj:2772),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$map$fn__5961.invoke(core.clj:2780),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$filter$fn__5981.invoke(core.clj:2826),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.lockAndForce(LazySeq.java:60),\tat clojure.lang.LazySeq.sval(LazySeq.java:69),\tat clojure.lang.LazySeq.unwrap(LazySeq.java:77),\tat clojure.lang.LazySeq.realize(LazySeq.java:93),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$map$fn__5954.invoke(core.clj:2763),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$seq__5486.invoke(core.clj:139),\tat clojure.spec.alpha$filter_alt.invokeStatic(alpha.clj:1429),\tat clojure.spec.alpha$filter_alt.invoke(alpha.clj:1423),\tat clojure.spec.alpha$alt_STAR_.invokeStatic(alpha.clj:1433),\tat clojure.spec.alpha$alt_STAR_.invoke(alpha.clj:1432),\tat clojure.spec.alpha$deriv.invokeStatic(alpha.clj:1542),\tat clojure.spec.alpha$deriv.invoke(alpha.clj:1526),\tat clojure.spec.alpha$deriv$fn__2412.invoke(alpha.clj:1542),\tat clojure.core$map$fn__5954.invoke(core.clj:2772),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$map$fn__5961.invoke(core.clj:2780),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$filter$fn__5981.invoke(core.clj:2826),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$map$fn__5954.invoke(core.clj:2763),\tat clojure.lang.LazySeq.force(LazySeq.java:50),\tat clojure.lang.LazySeq.realize(LazySeq.java:89),\tat clojure.lang.LazySeq.seq(LazySeq.java:106),\tat clojure.lang.RT.seq(RT.java:555),\tat clojure.core$seq__5486.invokeStatic(core.clj:139),\tat clojure.core$seq__5486.invoke(core.clj:139),\tat clojure.spec.alpha$filter_alt.invokeStatic(alpha.clj:1429),\tat clojure.spec.alpha$filter_alt.invoke(alpha.clj:1423),\tat clojure.spec.alpha$alt_STAR_.invokeStatic(alpha.clj:1433),\tat clojure.spec.alpha$alt_STAR_.invoke(alpha.clj:1432),\tat clojure.spec.alpha$deriv.invokeStatic(alpha.clj:1542),\tat clojure.spec.alpha$deriv.invoke(alpha.clj:1526),\tat clojure.spec.alpha$deriv.invokeStatic(alpha.clj:1540),\tat clojure.spec.alpha$deriv.invoke(alpha.clj:1526),\tat clojure.spec.alpha$re_conform.invokeStatic(alpha.clj:1667),\tat clojure.spec.alpha$re_conform.invoke(alpha.clj:1658),\tat clojure.spec.alpha$regex_spec_impl$reify__2496.conform_STAR_(alpha.clj:1708),\tat clojure.spec.alpha$conform.invokeStatic(alpha.clj:171),\tat clojure.spec.alpha$conform.invoke(alpha.clj:167),\tat toucan2.query$parse_args_with_spec.invokeStatic(query.clj:71),\tat toucan2.query$parse_args_with_spec.invoke(query.clj:66),\tat toucan2.insert$parse_args_primary_method_toucan_query_type_insert__STAR_.invokeStatic(insert.clj:35),\tat toucan2.insert$parse_args_primary_method_toucan_query_type_insert__STAR_.invoke(insert.clj:32),\tat methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),\tat methodical.util.FnWithMeta.invoke(util.clj:46),\tat methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55),\tat methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),\tat methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210),\tat toucan2.pipeline$transduce_unparsed.invokeStatic(pipeline.clj:315),\tat toucan2.pipeline$transduce_unparsed.invoke(pipeline.clj:311),\tat toucan2.pipeline$transduce_unparsed_with_default_rf.invokeStatic(pipeline.clj:374),\tat toucan2.pipeline$transduce_unparsed_with_default_rf.invoke(pipeline.clj:368),\tat toucan2.insert$insert_BANG_.invokeStatic(insert.clj:124),\tat toucan2.insert$insert_BANG_.doInvoke(insert.clj:74),\tat clojure.lang.RestFn.invoke(RestFn.java:424),\tat metabase.query_processor.middleware.process_userland_query$fn__78309$fn__78310$fn__78311.invoke(process_userland_query.clj:43),\tat grouper.core$body_fn$fn__62178.invoke(core.clj:72),\tat grouper.core$start_BANG_$thread__62221.invoke(core.clj:135),\tat clojure.lang.AFn.run(AFn.java:22),\tat java.base/java.lang.Thread.run(Unknown Source)\n```\n\nMetabase environment:\n```{\n  ""browser-info"": {\n    ""language"": ""en-US"",\n    ""platform"": ""Win32"",\n    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",\n    ""vendor"": ""Google Inc.""\n  },\n  ""metabase-info"": {\n    ""databases"": [\n      ""mysql"",\n      ""h2""\n    ],\n    ""run-mode"": ""prod"",\n    ""plan-alias"": """",\n    ""version"": {\n      ""date"": ""2024-12-04"",\n      ""tag"": ""v0.52.1"",\n      ""hash"": ""5bc320b""\n    },\n    ""settings"": {\n      ""report-timezone"": null\n    },\n    ""hosting-env"": ""unknown"",\n    ""application-database"": ""mysql"",\n    ""application-database-details"": {\n      ""database"": {\n        ""name"": ""MySQL"",\n        ""version"": ""8.0.27""\n      },\n      ""jdbc-driver"": {\n        ""name"": ""MariaDB Connector/J"",\n        ""version"": ""2.7.10""\n      }\n    }\n  },\n  ""system-info"": {\n    ""file.encoding"": ""UTF-8"",\n    ""java.runtime.name"": ""OpenJDK Runtime Environment"",\n    ""java.runtime.version"": ""21.0.5+11-LTS"",\n    ""java.vendor"": ""Eclipse Adoptium"",\n    ""java.vendor.url"": ""https://adoptium.net/"",\n    ""java.version"": ""21.0.5"",\n    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",\n    ""java.vm.version"": ""21.0.5+11-LTS"",\n    ""os.name"": ""Linux"",\n    ""os.version"": ""5.11.0-41-generic"",\n    ""user.language"": ""en"",\n    ""user.timezone"": ""Asia/Seoul""\n  }\n}```', 'created_at': datetime.datetime(2024, 12, 17, 4, 32, 19, tzinfo=datetime.timezone.utc)}, {'comment_id': 2562969122, 'issue_id': 2717881458, 'author': 'paoliniluis', 'body': 'raised the priority, this should not happen', 'created_at': datetime.datetime(2024, 12, 26, 17, 23, 17, tzinfo=datetime.timezone.utc)}]","jmartin127 on (2024-12-09 16:55:12 UTC): I am also experiencing this issue.  

Error:

```
2024-12-09 16:51:05,382 ERROR middleware.process-userland-query :: Error saving field usages
clojure.lang.ExceptionInfo: Unknown type of ref {:ref [:/ {:lib/uuid ""4d5e0320-30ed-4b8b-aefb-c3fe9629937e""} [:sum {:lib/uuid ""f5d9b736-9128-4546-8e6d-eb2265c5d816""} [:field {:lib/uuid ""3a7b7e92-b804-41a9-b19a-d8af2dea50c9"", :metabase.lib.query/transformation-added-base-type true, :base-type :type/Decimal, :effective-type :type/Decimal} 2492]] 100]}
	at metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:308)
	at metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264)
	at metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:289)
	at metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264)
	at metabase.lib.aggregation$aggregation_column33058__33060.invokeStatic(aggregation.cljc:433)
	at metabase.lib.aggregation$aggregation_column33058__33060.invoke(aggregation.cljc:423)
	at metabase.models.field_usage$aggregation__GT_field_usage.invokeStatic(field_usage.clj:38)
	at metabase.models.field_usage$aggregation__GT_field_usage.invoke(field_usage.clj:36)
	at metabase.models.field_usage$stage__GT_field_usages$fn__78328.invoke(field_usage.clj:77)
	at clojure.core$keep$fn__8691.invoke(core.clj:7529)
	at clojure.lang.LazySeq.force(LazySeq.java:50)
	at clojure.lang.LazySeq.lockAndForce(LazySeq.java:60)
	at clojure.lang.LazySeq.sval(LazySeq.java:69)
	at clojure.lang.LazySeq.unwrap(LazySeq.java:77)
	at clojure.lang.LazySeq.realize(LazySeq.java:93)
	at clojure.lang.LazySeq.seq(LazySeq.java:106)
	at clojure.lang.RT.seq(RT.java:555)
	at clojure.core$seq__5486.invokeStatic(core.clj:139)
	at clojure.core$concat$cat__5579$fn__5580.invoke(core.clj:736)
	at clojure.lang.LazySeq.force(LazySeq.java:50)
	at clojure.lang.LazySeq.realize(LazySeq.java:89)
```

Metabase version: `v0.52.1.3`

andrewler on (2024-12-17 04:32:19 UTC): +1
I experience it after opening a model. I was trying to debug the model persistence performance because I felt it was taking too long to open (~120sec) and discovered this error in the logs. Is the model being properly persisted despite this error?

Edit to add:
The same error appears in the logs when I manually run the question that the model originates from. The question also takes around 120 seconds to complete. There appears to be no performance difference between manually running the question vs viewing the supposedly persistence-enabled model.

Logs
```
2024-12-17T12:03:29+09:00 INFO metabase.api.dataset Source query for this query is Card 506
2024-12-17T12:03:30+09:00 INFO metabase.query-processor.middleware.fetch-source-query Found substitute cached query for card 506 from metabase_cache_5f4b1_2.model_506_morocco_ma
2024-12-17T12:05:33+09:00 DEBUG metabase.server.middleware.log POST /api/dataset 202 [ASYNC: completed] 2.1 mins (21 DB calls) App DB connections: 1/15 Jetty threads: 4/50 (2 idle, 0 queued) (126 total active threads) Queries in flight: 0 (0 queued); mysql DB 2 connections: 0/2 (0 threads blocked) {:metabase-user-id 1}
2024-12-17T12:05:36+09:00 ERROR metabase.query-processor.middleware.process-userland-query Error saving field usages,clojure.lang.ExceptionInfo: Unknown type of ref {:ref [:= {:lib/uuid ""0f73a263-95d0-48fe-875e-4eb5132a977f""} [:field {:base-type :type/Text, :lib/uuid ""4b4d95e4-8364-406d-9bf8-9361d6b2efff""} ""pn""] [:value {:effective_type :type/Text, :base-type :type/Text, :database-type ""VARCHAR"", :effective-type :type/Text, :lib/uuid ""eb0584c2-812b-4f5b-80eb-d43125371971""} ""CBZTSBE247A09327""]], :toucan2/context-trace [[""parse args"" {:toucan2.query/query-type :toucan.query-type/insert.update-count, :toucan2.query/unparsed-args (:model/FieldUsage ())}]]},	at metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:308),	at metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264),	at metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:321),	at metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264),	at metabase.lib.equality$find_matching_column31939__31942.invokeStatic(equality.cljc:311),	at metabase.lib.equality$find_matching_column31939__31942.invoke(equality.cljc:264),	at metabase.lib.filter$filter_parts32794__32795.invokeStatic(filter.cljc:552),	at metabase.lib.filter$filter_parts32794__32795.invoke(filter.cljc:540),	at metabase.models.field_usage$filter__GT_field_usage.invokeStatic(field_usage.clj:29),	at metabase.models.field_usage$filter__GT_field_usage.invoke(field_usage.clj:27),	at metabase.models.field_usage$stage__GT_field_usages$fn__78286.invoke(field_usage.clj:76),	at clojure.core$keep$fn__8691.invoke(core.clj:7529),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$concat$fn__5577.invoke(core.clj:727),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$concat$cat__5579$fn__5580.invoke(core.clj:736),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.lockAndForce(LazySeq.java:60),	at clojure.lang.LazySeq.sval(LazySeq.java:69),	at clojure.lang.LazySeq.unwrap(LazySeq.java:77),	at clojure.lang.LazySeq.realize(LazySeq.java:93),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$concat$cat__5579$fn__5580.invoke(core.clj:736),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$map$fn__5954.invoke(core.clj:2763),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.lockAndForce(LazySeq.java:60),	at clojure.lang.LazySeq.sval(LazySeq.java:69),	at clojure.lang.LazySeq.unwrap(LazySeq.java:77),	at clojure.lang.LazySeq.realize(LazySeq.java:93),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$seq__5486.invoke(core.clj:139),	at clojure.spec.alpha$regex_spec_impl$reify__2496.conform_STAR_(alpha.clj:1708),	at clojure.spec.alpha$conform.invokeStatic(alpha.clj:171),	at clojure.spec.alpha$conform.invoke(alpha.clj:167),	at clojure.spec.alpha$dt.invokeStatic(alpha.clj:762),	at clojure.spec.alpha$dt.invoke(alpha.clj:757),	at clojure.spec.alpha$dt.invokeStatic(alpha.clj:758),	at clojure.spec.alpha$dt.invoke(alpha.clj:757),	at clojure.spec.alpha$deriv.invokeStatic(alpha.clj:1532),	at clojure.spec.alpha$deriv.invoke(alpha.clj:1526),	at clojure.spec.alpha$deriv$fn__2412.invoke(alpha.clj:1542),	at clojure.core$map$fn__5954.invoke(core.clj:2772),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$map$fn__5961.invoke(core.clj:2780),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$filter$fn__5981.invoke(core.clj:2826),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.lockAndForce(LazySeq.java:60),	at clojure.lang.LazySeq.sval(LazySeq.java:69),	at clojure.lang.LazySeq.unwrap(LazySeq.java:77),	at clojure.lang.LazySeq.realize(LazySeq.java:93),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$map$fn__5954.invoke(core.clj:2763),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$seq__5486.invoke(core.clj:139),	at clojure.spec.alpha$filter_alt.invokeStatic(alpha.clj:1429),	at clojure.spec.alpha$filter_alt.invoke(alpha.clj:1423),	at clojure.spec.alpha$alt_STAR_.invokeStatic(alpha.clj:1433),	at clojure.spec.alpha$alt_STAR_.invoke(alpha.clj:1432),	at clojure.spec.alpha$deriv.invokeStatic(alpha.clj:1542),	at clojure.spec.alpha$deriv.invoke(alpha.clj:1526),	at clojure.spec.alpha$deriv$fn__2412.invoke(alpha.clj:1542),	at clojure.core$map$fn__5954.invoke(core.clj:2772),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$map$fn__5961.invoke(core.clj:2780),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$filter$fn__5981.invoke(core.clj:2826),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$map$fn__5954.invoke(core.clj:2763),	at clojure.lang.LazySeq.force(LazySeq.java:50),	at clojure.lang.LazySeq.realize(LazySeq.java:89),	at clojure.lang.LazySeq.seq(LazySeq.java:106),	at clojure.lang.RT.seq(RT.java:555),	at clojure.core$seq__5486.invokeStatic(core.clj:139),	at clojure.core$seq__5486.invoke(core.clj:139),	at clojure.spec.alpha$filter_alt.invokeStatic(alpha.clj:1429),	at clojure.spec.alpha$filter_alt.invoke(alpha.clj:1423),	at clojure.spec.alpha$alt_STAR_.invokeStatic(alpha.clj:1433),	at clojure.spec.alpha$alt_STAR_.invoke(alpha.clj:1432),	at clojure.spec.alpha$deriv.invokeStatic(alpha.clj:1542),	at clojure.spec.alpha$deriv.invoke(alpha.clj:1526),	at clojure.spec.alpha$deriv.invokeStatic(alpha.clj:1540),	at clojure.spec.alpha$deriv.invoke(alpha.clj:1526),	at clojure.spec.alpha$re_conform.invokeStatic(alpha.clj:1667),	at clojure.spec.alpha$re_conform.invoke(alpha.clj:1658),	at clojure.spec.alpha$regex_spec_impl$reify__2496.conform_STAR_(alpha.clj:1708),	at clojure.spec.alpha$conform.invokeStatic(alpha.clj:171),	at clojure.spec.alpha$conform.invoke(alpha.clj:167),	at toucan2.query$parse_args_with_spec.invokeStatic(query.clj:71),	at toucan2.query$parse_args_with_spec.invoke(query.clj:66),	at toucan2.insert$parse_args_primary_method_toucan_query_type_insert__STAR_.invokeStatic(insert.clj:35),	at toucan2.insert$parse_args_primary_method_toucan_query_type_insert__STAR_.invoke(insert.clj:32),	at methodical.impl.combo.common$partial_STAR_$fn__19388.invoke(common.clj:12),	at methodical.util.FnWithMeta.invoke(util.clj:46),	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55),	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47),	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210),	at toucan2.pipeline$transduce_unparsed.invokeStatic(pipeline.clj:315),	at toucan2.pipeline$transduce_unparsed.invoke(pipeline.clj:311),	at toucan2.pipeline$transduce_unparsed_with_default_rf.invokeStatic(pipeline.clj:374),	at toucan2.pipeline$transduce_unparsed_with_default_rf.invoke(pipeline.clj:368),	at toucan2.insert$insert_BANG_.invokeStatic(insert.clj:124),	at toucan2.insert$insert_BANG_.doInvoke(insert.clj:74),	at clojure.lang.RestFn.invoke(RestFn.java:424),	at metabase.query_processor.middleware.process_userland_query$fn__78309$fn__78310$fn__78311.invoke(process_userland_query.clj:43),	at grouper.core$body_fn$fn__62178.invoke(core.clj:72),	at grouper.core$start_BANG_$thread__62221.invoke(core.clj:135),	at clojure.lang.AFn.run(AFn.java:22),	at java.base/java.lang.Thread.run(Unknown Source)
```

Metabase environment:
```{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-12-04"",
      ""tag"": ""v0.52.1"",
      ""hash"": ""5bc320b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.27""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.11.0-41-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Seoul""
  }
}```

paoliniluis on (2024-12-26 17:23:17 UTC): raised the priority, this should not happen

"
2717855461,issue,closed,completed,[Project] Metabot Toolbox v1 Tools Implementation,"[Notion doc](https://www.notion.so/metabase/Metabot-toolbox-v1-15169354c90180cf92edd3a32f8fc62c)


- [x] #50879
- [x] #50987
- [x] #50988
- [x] #51639
- [x] #51467
- [x] #51468
- [x] who-is-your-favorite",perivamsi,2024-12-04 14:01:51+00:00,[],2025-01-21 20:54:10+00:00,2025-01-21 20:54:09+00:00,https://github.com/metabase/metabase/issues/50874,"[('.Epic', 'Feature Implementation or Project'), ('Metabot/Tools', 'Tools that are agnostic of the LLM framework itself, could be reused for notifications framework als')]","[{'comment_id': 2605717631, 'issue_id': 2717855461, 'author': 'retro', 'body': '@perivamsi I will close this one as we have completed all the subtasks listed here.', 'created_at': datetime.datetime(2025, 1, 21, 20, 54, 9, tzinfo=datetime.timezone.utc)}]","retro on (2025-01-21 20:54:09 UTC): @perivamsi I will close this one as we have completed all the subtasks listed here.

"
2717693659,issue,closed,completed,Replace Actions API handlers in entities with RTK Query,"- Make the entity framework use RTK query under the hood for all Actions API requests
- Port Actions to use new `EntityObjectLoaderRtkQuery` (#50868)

----

_We missed this before, it should have been done in Milestone 1 in #40788._

",kamilmielnik,2024-12-04 13:09:14+00:00,['kamilmielnik'],2025-01-27 22:13:56+00:00,2024-12-10 09:04:50+00:00,https://github.com/metabase/metabase/issues/50873,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]",[],
2717672733,issue,open,,Dashboard import fails with 500 internal server error,"### Describe the bug

When exporting dashboards and importing them, we get a 500 internal server error.

## Versions tested

We use docker images in development and production.

- `metabase-enterprise-head:latest`
- `metabase-enterprise`  **1.51.6** **1.51.3**

## Import API Response



### To Reproduce

1. Install Metabase 1.51.3 (or another version tested, see above)
2. Import the attached dashboards

[dashboards-demo-test.tgz](https://github.com/user-attachments/files/18008379/dashboards-demo-test.tgz)


### Expected behavior

I'd like to export dashboards from DEV and import them in STAGING and PROD instances (same metabase version, same database backend)

### Logs

```
2024-12-04 12:27:45,301 INFO serialization.api :: Serdes import, size 235917
2024-12-04 12:27:45,414 INFO serialization.api :: In total 657 entries unpacked, detected source dir: metabase_test-2024-11-29_15-53
2024-12-04 12:27:46,517 INFO v2.load :: Starting deserialization, total 595 documents
2024-12-04 12:27:46,533 INFO v2.load :: Loading Card ElM0YFXrN1deXd1zpGoAJ
2024-12-04 12:27:46,550 INFO v2.load :: Loading Database DWH
2024-12-04 12:27:47,114 INFO v2.load :: Loading Card VaZvfbV1ZNSlsXQViHHyo
2024-12-04 12:27:47,131 INFO v2.load :: Loading Database DWH > Schema public > Table dim_bewertungsebene > Field id
2024-12-04 12:27:47,133 INFO v2.load :: Loading Database DWH > Schema public > Table dim_bewertungsebene
2024-12-04 12:27:47,134 INFO v2.load :: Loading Database DWH
2024-12-04 12:27:47,240 INFO v2.load :: Loading Database DWH
2024-12-04 12:27:47,241 INFO v2.load :: Loading Database DWH > Schema public > Table dim_kostenstelle > Field id
2024-12-04 12:27:47,242 INFO v2.load :: Loading Database DWH > Schema public > Table dim_kostenstelle
2024-12-04 12:27:47,243 INFO v2.load :: Loading Database DWH
2024-12-04 12:27:47,282 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal > Field kostenstelle_id
2024-12-04 12:27:47,283 INFO v2.load :: Loading Database DWH > Schema public > Table dim_kostenstelle > Field id
2024-12-04 12:27:47,283 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,284 INFO v2.load :: Loading Database DWH
2024-12-04 12:27:47,333 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal > Field qualifikation
2024-12-04 12:27:47,334 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,346 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal > Field wache
2024-12-04 12:27:47,347 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,356 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal > Field id
2024-12-04 12:27:47,358 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,369 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal > Field jahr_monat
2024-12-04 12:27:47,370 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,377 INFO v2.load :: Loading Collection fFyTnk2TusvtWbIehkma4
2024-12-04 12:27:47,437 INFO v2.load :: Loading Database DWH > Schema public > Table dim_bewertungsebene > Field bewertungsebene
2024-12-04 12:27:47,438 INFO v2.load :: Loading Database DWH > Schema public > Table dim_bewertungsebene
2024-12-04 12:27:47,453 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal > Field planungsebene
2024-12-04 12:27:47,454 INFO v2.load :: Loading Database DWH > Schema public > Table dim_planungsebene > Field id
2024-12-04 12:27:47,455 INFO v2.load :: Loading Database DWH > Schema public > Table dim_planungsebene
2024-12-04 12:27:47,455 INFO v2.load :: Loading Database DWH
2024-12-04 12:27:47,502 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,513 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal > Field bewertungsebene
2024-12-04 12:27:47,516 INFO v2.load :: Loading Database DWH > Schema public > Table dim_bewertungsebene > Field id
2024-12-04 12:27:47,516 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,544 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal > Field netto_jahres_arbeitszeit
2024-12-04 12:27:47,545 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,556 INFO v2.load :: Loading Database DWH > Schema public > Table dim_planungsebene > Field id
2024-12-04 12:27:47,556 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal > Field mannmonate
2024-12-04 12:27:47,557 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,565 INFO v2.load :: Loading Database DWH > Schema public > Table fakt_personal
2024-12-04 12:27:47,677 INFO v2.load :: Loading Collection fFyTnk2TusvtWbIehkma4
2024-12-04 12:27:47,677 INFO v2.load :: Loading LegacyMetric MPhmMBlsLhPUkPBlwFiOW
2024-12-04 12:27:47,693 ERROR serialization.api :: Error during serialization: Failed to read file for LegacyMetric MPhmMBlsLhPUkPBlwFiOW {:path [{:model ""LegacyMetric"", :id ""MPhmMBlsLhPUkPBlwFiOW""}], :deps-chain #{[{:id ""ElM0YFXrN1deXd1zpGoAJ"", :model ""Card""}]}, :model ""LegacyMetric"", :table :metric, :error :metabase-enterprise.serialization.v2.load/not-found}
  caused by: Cannot find file {:abs-path [{:model ""LegacyMetric"", :id ""MPhmMBlsLhPUkPBlwFiOW""}]}
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""de-DE"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.1.1 Safari/605.1.15"",
    ""vendor"": ""Apple Computer, Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-self-hosted"",
    ""version"": {
      ""date"": ""2024-11-11"",
      ""tag"": ""v1.51.3"",
      ""hash"": ""d757d0b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.4""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.14.0-427.35.1.el9_4.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

pretty high -- this is a blocker ob going in production.

### Additional context

Any information on the error cause or what we could try to prevent it, any workaround would be greratly appreciated.

Our main goal is to have our data analysts develop dashboards on a DEV metabase instance and export them.  We then would use the .tgz as release artifact and do automated releases and roll outs on STAGING/PROD.  As we have many tenants, we're pretty much rely on this to work -- data analysts clicking the same dashboards over and over again gets old pretty fast.",seletz,2024-12-04 13:00:14+00:00,[],2025-02-04 20:26:37+00:00,,https://github.com/metabase/metabase/issues/50871,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('Operation/Serialization', 'Enterprise contents migration'), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2517637152, 'issue_id': 2717672733, 'author': 'paoliniluis', 'body': 'Seems like the metric is not on the bundle, please search for MPhmMBlsLhPUkPBlwFiOW in the bundle @seletz', 'created_at': datetime.datetime(2024, 12, 4, 14, 42, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2518162001, 'issue_id': 2717672733, 'author': 'seletz', 'body': '> Seems like the metric is not on the bundle, please search for MPhmMBlsLhPUkPBlwFiOW in the bundle [@seletz](https://github.com/seletz)\n\nBy ""bundle"" I guess you mean the tgz resulting from the ""export"" API call?  That may well be, that there\'s something missing in that file -- but that would be not something I can fix on my end, or am I missing something?', 'created_at': datetime.datetime(2024, 12, 4, 18, 0, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2518649752, 'issue_id': 2717672733, 'author': 'paoliniluis', 'body': ""@seletz exactly. Can you tell us how you've done the export?"", 'created_at': datetime.datetime(2024, 12, 4, 22, 1, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2519348800, 'issue_id': 2717672733, 'author': 'seletz', 'body': '@paoliniluis Sure.  We wrote a python program to do this.  \n\nIt\'s essentially a POST to the `/api/ee/serialization/export` endpoint with an API key header set.  The `tgz` is simply the response body.  We *could* just use `curl` -- but I like a dedicated CLI better.\n\nI believe we can\'t use the CLI of the `metabase.jar` as this needs access to the local database, I believe.\n\nThe client part which does the web request looks like this:\n\n```python\nimport logging\nimport requests\nfrom requests_toolbelt import MultipartEncoder, MultipartEncoderMonitor\n\n\nlogger = logging.getLogger(__name__)\n\n\nclass MetabaseClient:\n    def __init__(self, host: str, api_key: str):\n        self.host = host\n        self.api_key = api_key\n        self.headers = {""x-api-key"": api_key}\n\n    def export(self):\n        url = self.host + ""/api/ee/serialization/export""\n        logger.debug(f""EXPORT: url={url}"")\n        response = requests.post(url, headers=self.headers)\n        if not response.ok:\n            logger.error(f""Request failed: {response.status_code} {response.reason}"")\n            response.raise_for_status()\n\n        return response\n\n    def do_import(self, file_path: str, callback: callable = None):\n        url = self.host + ""/api/ee/serialization/import""\n\n        upload = MultipartEncoder(\n            fields={\'file\': (\'\', open(file_path, \'rb\'), \'application/tar+gzip\')}\n        )\n        monitor = MultipartEncoderMonitor(upload, callback)\n\n        headers = self.headers.copy()\n        headers[\'Content-Type\'] = monitor.content_type\n\n        response = requests.post(url, params={""continue_on_error"": 1}, headers=headers, data=monitor)\n        if not response.ok:\n            logger.error(f""Request failed: {response.status_code} {response.reason}"")\n            if response.text:\n                logger.error(f""Server said: \\n{response.text}"")\n            response.raise_for_status()\n        return response\n```', 'created_at': datetime.datetime(2024, 12, 5, 6, 49, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2519376599, 'issue_id': 2717672733, 'author': 'seletz', 'body': '@paoliniluis Essentially following https://www.metabase.com/docs/latest/installation-and-operation/serialization#serialization-via-the-api', 'created_at': datetime.datetime(2024, 12, 5, 6, 54, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2535010426, 'issue_id': 2717672733, 'author': 'seletz', 'body': 'Any update on this?', 'created_at': datetime.datetime(2024, 12, 11, 8, 33, 51, tzinfo=datetime.timezone.utc)}, {'comment_id': 2571887763, 'issue_id': 2717672733, 'author': 'paoliniluis', 'body': ""@seletz I'm trying to reproduce this but I can't. Can you guide me on the reproduction of this issue?\n\n1) how did you create the metric and in which version did you do it?\n2) then I would guess that you moved to version 51 and then you wanted to export and import, is that correct?"", 'created_at': datetime.datetime(2025, 1, 6, 1, 33, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2590333147, 'issue_id': 2717672733, 'author': 'seletz', 'body': ""@paoliniluis So I have tested the import/export flow again with a version of the dashboards which does apparently not use metrics (can't say, for sure though).  I used **1.52.5** locally to import the dashboard and this **worked.**\n\nI'm not completely sure if this is the dashboard or the new version **1.52.5**.\n\nFWIW, here's the dashboard which works:\n\n[dashboards-test.tgz](https://github.com/user-attachments/files/18412806/dashboards-test.tgz)"", 'created_at': datetime.datetime(2025, 1, 14, 15, 59, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2590340732, 'issue_id': 2717672733, 'author': 'seletz', 'body': ""@paoliniluis And to actually answer your questions:\n1. I can't say -- I have no dashboard-fu.  I'll try to get the answer for that.\n2. No -- I believe that the dashboards were created in the same version all over.  Our use case is to transport from dev to test to prod, and all the metabase instances run the same version (or should)."", 'created_at': datetime.datetime(2025, 1, 14, 16, 2, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-04 14:42:57 UTC): Seems like the metric is not on the bundle, please search for MPhmMBlsLhPUkPBlwFiOW in the bundle @seletz

seletz (Issue Creator) on (2024-12-04 18:00:22 UTC): By ""bundle"" I guess you mean the tgz resulting from the ""export"" API call?  That may well be, that there's something missing in that file -- but that would be not something I can fix on my end, or am I missing something?

paoliniluis on (2024-12-04 22:01:36 UTC): @seletz exactly. Can you tell us how you've done the export?

seletz (Issue Creator) on (2024-12-05 06:49:10 UTC): @paoliniluis Sure.  We wrote a python program to do this.  

It's essentially a POST to the `/api/ee/serialization/export` endpoint with an API key header set.  The `tgz` is simply the response body.  We *could* just use `curl` -- but I like a dedicated CLI better.

I believe we can't use the CLI of the `metabase.jar` as this needs access to the local database, I believe.

The client part which does the web request looks like this:

```python
import logging
import requests
from requests_toolbelt import MultipartEncoder, MultipartEncoderMonitor


logger = logging.getLogger(__name__)


class MetabaseClient:
    def __init__(self, host: str, api_key: str):
        self.host = host
        self.api_key = api_key
        self.headers = {""x-api-key"": api_key}

    def export(self):
        url = self.host + ""/api/ee/serialization/export""
        logger.debug(f""EXPORT: url={url}"")
        response = requests.post(url, headers=self.headers)
        if not response.ok:
            logger.error(f""Request failed: {response.status_code} {response.reason}"")
            response.raise_for_status()

        return response

    def do_import(self, file_path: str, callback: callable = None):
        url = self.host + ""/api/ee/serialization/import""

        upload = MultipartEncoder(
            fields={'file': ('', open(file_path, 'rb'), 'application/tar+gzip')}
        )
        monitor = MultipartEncoderMonitor(upload, callback)

        headers = self.headers.copy()
        headers['Content-Type'] = monitor.content_type

        response = requests.post(url, params={""continue_on_error"": 1}, headers=headers, data=monitor)
        if not response.ok:
            logger.error(f""Request failed: {response.status_code} {response.reason}"")
            if response.text:
                logger.error(f""Server said: \n{response.text}"")
            response.raise_for_status()
        return response
```

seletz (Issue Creator) on (2024-12-05 06:54:32 UTC): @paoliniluis Essentially following https://www.metabase.com/docs/latest/installation-and-operation/serialization#serialization-via-the-api

seletz (Issue Creator) on (2024-12-11 08:33:51 UTC): Any update on this?

paoliniluis on (2025-01-06 01:33:48 UTC): @seletz I'm trying to reproduce this but I can't. Can you guide me on the reproduction of this issue?

1) how did you create the metric and in which version did you do it?
2) then I would guess that you moved to version 51 and then you wanted to export and import, is that correct?

seletz (Issue Creator) on (2025-01-14 15:59:14 UTC): @paoliniluis So I have tested the import/export flow again with a version of the dashboards which does apparently not use metrics (can't say, for sure though).  I used **1.52.5** locally to import the dashboard and this **worked.**

I'm not completely sure if this is the dashboard or the new version **1.52.5**.

FWIW, here's the dashboard which works:

[dashboards-test.tgz](https://github.com/user-attachments/files/18412806/dashboards-test.tgz)

seletz (Issue Creator) on (2025-01-14 16:02:00 UTC): @paoliniluis And to actually answer your questions:
1. I can't say -- I have no dashboard-fu.  I'll try to get the answer for that.
2. No -- I believe that the dashboards were created in the same version all over.  Our use case is to transport from dev to test to prod, and all the metabase instances run the same version (or should).

"
2717516203,issue,open,,OOM when sending big dashboard subscription,"**Context**
Slack thread: https://metaboat.slack.com/archives/C0641E4PB9B/p1733285781794479
Problem:
- OOM when sending a big dashboard subscription
- The dashboard has 5 tabs and 68 cards in total
  - Looking at the network tabs, it has in total ~22MiB of data transferred
  - Send to one recipient
  - Can easily reproduced by manually sending the dashboard from ""Send test"" button
  - Stats run on 2 instances, each with 1.5GiB of memory

Root causes:
- It has been like this forever, but we generate subscription emails by executing all the dash cards and keeping them in memory ([src](https://github.com/metabase/metabase/blob/3e33ab4/src/metabase/notification/payload/execute.clj#L228-L241))
- Another contributing factor is that pulses are sent in parallel, so we might have more than one pulse being sent simultaneously.

Ideas for improvement:
- we need to avoid keeping all dash cards in memory:
  - Keep execution result on disk
  - temporarily save them in AppDB
- Offer an option to send select tabs to include in a dashboard subscription",qnkhuat,2024-12-04 11:59:06+00:00,[],2025-02-04 20:23:54+00:00,,https://github.com/metabase/metabase/issues/50863,"[('Priority:P2', 'Average run of the mill bug'), ('.Performance', ''), ('.Memory Usage', ''), ('.Backend', ''), ('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Workflows', 'aka BEC')]",[],
2716716397,issue,closed,not_planned,"The database has data, but the data cannot be queried","### Describe the bug

Version : v0.43.1

Description : We will add some data at 8 o'clock in the morning, but it won't be able to be queried through the Metabase until 9:30. And it has been delayed until 10 o'clock recently. 

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

Timely update data

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""zh-CN"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.15+10"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.15"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.15+10"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.3.8-1.el7.elrepo.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Shanghai""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""mysql""
    ],
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""5.7.19-log""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.5""
      }
    },
    ""run-mode"": ""prod"",
    ""version"": {
      ""date"": ""2022-05-16"",
      ""tag"": ""v0.43.1"",
      ""branch"": ""release-x.43.x"",
      ""hash"": ""7f1a1c4""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Shanghai""
    }
  }
}
```

### Severity

Causing trouble

### Additional context

_No response_",airorair,2024-12-04 06:50:08+00:00,[],2024-12-04 16:28:51+00:00,2024-12-04 16:28:50+00:00,https://github.com/metabase/metabase/issues/50844,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2517955656, 'issue_id': 2716716397, 'author': 'luizarakaki', 'body': 'This version is more than 2 years old... You need to update.\nThe delays are caused by the sync process and it was improved significantly since 43.', 'created_at': datetime.datetime(2024, 12, 4, 16, 28, 50, tzinfo=datetime.timezone.utc)}]","luizarakaki on (2024-12-04 16:28:50 UTC): This version is more than 2 years old... You need to update.
The delays are caused by the sync process and it was improved significantly since 43.

"
2716523241,issue,open,,Unable to set MB_ALLOWED_IFRAME_HOSTS to comma separated list of domains,"### Describe the bug

Setting `MB_ALLOWED_IFRAME_HOSTS` to a comma separated list of domains like `youtube.com,google.com` doesn't work and causes all domains to be blocked. Setting it to the [default in the docs](https://www.metabase.com/docs/latest/configuring-metabase/environment-variables#mb_allowed_iframe_hosts) causes the same issue. The only way to make it work is to insert newlines in between the entries, which is unintuitive.

Note that this is also reproducible from the Admin => Settings => General page, but probably less likely to occur there since the default entries are already comma and newline separated and the user is likely to stick with that pattern.

### To Reproduce

1. Run EE with `MB_ALLOWED_IFRAME_HOSTS=""youtube.com,google.com""`
2. Create a dashboard and add an iframe from youtube, e.g.,
```
<iframe width=""560"" height=""315"" src=""https://www.youtube.com/embed/dnT2Xj52mnk?si=LQkBr9cbZlvqSpnP"" title=""YouTube video player"" frameborder=""0"" allow=""accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"" referrerpolicy=""strict-origin-when-cross-origin"" allowfullscreen></iframe>
```
3. See error: ""www.youtube.com can not be embedded in iframe cards.""


To fix this, rerun with a newline inserted:
```
MB_ALLOWED_IFRAME_HOSTS=""youtube.com,
google.com""
```

### Expected behavior

A comma separated list of domains with or without whitespace should work

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""duckdb"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-11-26"",
      ""tag"": ""v51.3.1"",
      ""hash"": ""689a04d""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.6 (Debian 15.6-1.pgdg120+2)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.10.4-linuxkit"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```

### Severity

Not severe, just unintuitive and awkward to configure as an env var

### Additional context

_No response_",eskrm,2024-12-04 04:19:36+00:00,[],2025-02-04 20:24:52+00:00,,https://github.com/metabase/metabase/issues/50838,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Bug:v51', 'bugs or regressions introduced in v51')]",[],
2716358355,issue,open,,[Epic] Sankey Chart v53+,"## Description

Sankey chart v53+ scope: more visualization settings and support of the other data shape.

- v52 epic: https://github.com/metabase/metabase/issues/29671

## Bug bash

- [ ] Improve color selection algorithm [(link)](https://metaboat.slack.com/archives/C080R5Y30G2/p1731524558853679)
- [ ] Improve organization of sankey viz settings in the sidebar [(link)](https://metaboat.slack.com/archives/C080R5Y30G2/p1731524936022419)  **input required**
- [ ] Hide align options when they would not change anything on a given dataset [(link)](https://metaboat.slack.com/archives/C080R5Y30G2/p1731525811819019)

### Milestone 1: Simple customization [1-3 days]

- [ ] Additional tooltip metrics

### Milestone 2: Simple customization [2-5 days]
- [ ] Support reordering via settings sidebar and DnD

### Milestone 3: Suitable Shape #2 from the product doc [1 week]
- [ ] Implement data settings for the [second suitable data shape](https://www.notion.so/metabase/Offer-new-viz-type-Sankey-chart-ebc7f49acbf740249115f65d017e8bf6?pvs=4#11269354c90180d0b14ae0b697dd6904)
- [ ] Implement data transformation
- [ ] Update color assignments",alxnddr,2024-12-04 01:44:04+00:00,[],2025-02-04 20:31:32+00:00,,https://github.com/metabase/metabase/issues/50833,"[('Type:New Feature', ''), ('.Epic', 'Feature Implementation or Project'), ('.Team/DashViz', 'Dashboard and Viz team'), ('Visualization/Charts/Sankey', '')]",[],
2716327914,issue,closed,completed,Filtering on a multi stage question in MongoDB results in a non-working query,"### Describe the bug

For some reason we end up with MBQL in the results of a Mongo query when there's a multi stage question

### To Reproduce

1) use a Mongo database
2) use the orders table
- first stage do a distinct count of product id by created_at: day
- second stage do a cumulative sum of the distinct value of the first stage, by day
- third stage do a filter on any date of the previous stage
3) run the query and see the results
![Image](https://github.com/user-attachments/assets/38a6a54e-6e4f-46ef-83c2-4a39536b08ba)


### Expected behavior

The query should run and we should see results?

### Logs

NA

### Information about your Metabase installation

```JSON
v51,probably comes from many versions before, at least 49
```

### Severity

P1

### Additional context

NA",paoliniluis,2024-12-04 01:13:18+00:00,['wzimrin'],2024-12-16 14:57:25+00:00,2024-12-13 18:48:23+00:00,https://github.com/metabase/metabase/issues/50832,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Database/Mongo', None), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2532885415, 'issue_id': 2716327914, 'author': 'wzimrin', 'body': 'Worth noting that the fix for this will only work in mongo version 5 or later.  In older versions, if you are using a cumulative sum or cumulative count, that has to be the final stage.  Doing a filter or the like afterwards will cause this error.', 'created_at': datetime.datetime(2024, 12, 10, 21, 2, 36, tzinfo=datetime.timezone.utc)}]","wzimrin (Assginee) on (2024-12-10 21:02:36 UTC): Worth noting that the fix for this will only work in mongo version 5 or later.  In older versions, if you are using a cumulative sum or cumulative count, that has to be the final stage.  Doing a filter or the like afterwards will cause this error.

"
2716298760,issue,open,,Time zone issue with SQL server,"### Describe the bug

Today is adding -6 to all queries and result is not same when i run query in db.

![Image](https://github.com/user-attachments/assets/a52267ec-c927-4c3a-90e3-335fe7ff1305)


DB time zone 
![Image](https://github.com/user-attachments/assets/32473ba7-9343-4258-87d5-b89a9402331f)

System Time zone
![Image](https://github.com/user-attachments/assets/4606ca26-036c-48ce-a2a0-bd62f8460116)


Reporting and JAVA Time zone

{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""sqlserver""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-09-24"",
      ""tag"": ""v0.50.27"",
      ""hash"": ""8b9a8fc""
    },
    ""settings"": {
      ""report-timezone"": ""America/Chicago""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""17.2 (Debian 17.2-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Chicago""
  }
}

### To Reproduce

create a new question and put field filter as today.

### Expected behavior

-6  should not be added from ui .

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""sqlserver""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-09-24"",
      ""tag"": ""v0.50.27"",
      ""hash"": ""8b9a8fc""
    },
    ""settings"": {
      ""report-timezone"": ""America/Chicago""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""17.2 (Debian 17.2-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Chicago""
  }
}
```

### Severity

P2

### Additional context

_No response_",himaroratcore,2024-12-04 00:47:48+00:00,[],2025-02-04 20:27:13+00:00,,https://github.com/metabase/metabase/issues/50831,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Database/SQLServer', None), ('Querying/MBQL', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2629130220, 'issue_id': 2716298760, 'author': 'himaroratcore', 'body': '@givemesomefaces \n\nHi Guys, this looks good . who will assign the reviewers? When can we expect this to get approved and release.', 'created_at': datetime.datetime(2025, 2, 1, 21, 51, 46, tzinfo=datetime.timezone.utc)}]","himaroratcore (Issue Creator) on (2025-02-01 21:51:46 UTC): @givemesomefaces 

Hi Guys, this looks good . who will assign the reviewers? When can we expect this to get approved and release.

"
2716297454,issue,closed,not_planned,Allowing empty entity_id's leads to app db inserting duplicate entities which ends up with serialization not working anymore,"### Describe the bug

Seems that we're being very generous here, and the fact that we try to do the backfill when we do exports will break the process if users have done wrongly in the past if they import stuff with null entity id's

### To Reproduce

1) start Metabase from scratch, just a blank instance
2) now create a collection, let's say ""abc""
--- state of the app db till this step is ---
![Image](https://github.com/user-attachments/assets/c0b4eca2-387d-4aaf-bf43-88fcffaf5e49)
---end state---
3) do an export (curl ""http://<url>/api/ee/serialization/export?database_secrets=false&field_values=false&data_model=false&settings=false"" -X POST -o export.tar.gz --header ""Cookie: metabase.SESSION=xxxxxxxxxxxxxxx"")
4) unzip it
5) open the yaml file of the newly created collection and make the entity_id a null value (just to reconfirm, it will have an entity_id, you need to make it null), e.g. like
![Image](https://github.com/user-attachments/assets/0e272839-55f6-406c-a7e7-f559ec1090a6)
6) now zip it and import it
--- state of the app db till this step is ---
![Image](https://github.com/user-attachments/assets/b75070ac-293f-4552-97fc-cf916ed55533)
check the null in the entity id
---end state---

7) now reuse the same bundle you had from the previous export and now wipe the entity id key completely, zip it and import it again
--- state of the app db till this step is ---
![Image](https://github.com/user-attachments/assets/9839ddde-87a9-45ca-aa61-f4c46c2887bb)
check the collection being duplicate, one with entity id, the other without
---end state---

8) now you won't be able to export anything since we'll want to seed the app db, but we can't

```
2024-12-04 00:38:36,789 INFO v2.backfill-ids :: Backfilling entity_id for 1 rows of Collection
2024-12-04 00:38:36,804 ERROR serialization.api :: Error during serialization: ERROR: duplicate key value violates unique constraint ""collection_entity_id_key""
  Detail: Key (entity_id)=(VwkhS217DKxiXQyVjBzaK) already exists.
  caused by: ERROR: duplicate key value violates unique constraint ""collection_entity_id_key""
  Detail: Key (entity_id)=(VwkhS217DKxiXQyVjBzaK) already exists.
```



### Expected behavior

We shouldn't allow empty entity id's? why did we allow this?

### Logs

above

### Information about your Metabase installation

```JSON
probably since v50
```

### Severity

P1

### Additional context

_No response_",paoliniluis,2024-12-04 00:46:34+00:00,[],2024-12-05 11:15:59+00:00,2024-12-05 11:15:58+00:00,https://github.com/metabase/metabase/issues/50830,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2516582346, 'issue_id': 2716297454, 'author': 'thebiglabasky', 'body': ""Out of curiosity, in what situations would one want to nullify an entity ID? I'm wondering about the use case or reason why this happens?"", 'created_at': datetime.datetime(2024, 12, 4, 8, 50, 2, tzinfo=datetime.timezone.utc)}, {'comment_id': 2517566441, 'issue_id': 2716297454, 'author': 'bshepherdson', 'body': ""We have occasionally suggested that people blank that column in their appdb if there are bad values in it, but they should get regenerated with the hash-based values before any serdes action. I'm not sure why one would blank it in the exported files.\n\nI'm not sure how this would come up in practice, so it's hard to see this as a P1 bug. Yes, deleting key information from an export will make import do odd things, but why would that ever happen?\n\nThat said, I think it makes sense to reject an import if it's malformed, including if it's missing an `entity_id` on anything. Those should have been added before the export, and import relies on them."", 'created_at': datetime.datetime(2024, 12, 4, 14, 17, 19, tzinfo=datetime.timezone.utc)}, {'comment_id': 2518254283, 'issue_id': 2716297454, 'author': 'ixipixi', 'body': 'https://github.com/metabase/metabase/issues/50106', 'created_at': datetime.datetime(2024, 12, 4, 18, 41, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2520018694, 'issue_id': 2716297454, 'author': 'paoliniluis', 'body': 'Then this is a duplicate', 'created_at': datetime.datetime(2024, 12, 5, 11, 15, 58, tzinfo=datetime.timezone.utc)}]","thebiglabasky on (2024-12-04 08:50:02 UTC): Out of curiosity, in what situations would one want to nullify an entity ID? I'm wondering about the use case or reason why this happens?

bshepherdson on (2024-12-04 14:17:19 UTC): We have occasionally suggested that people blank that column in their appdb if there are bad values in it, but they should get regenerated with the hash-based values before any serdes action. I'm not sure why one would blank it in the exported files.

I'm not sure how this would come up in practice, so it's hard to see this as a P1 bug. Yes, deleting key information from an export will make import do odd things, but why would that ever happen?

That said, I think it makes sense to reject an import if it's malformed, including if it's missing an `entity_id` on anything. Those should have been added before the export, and import relies on them.

ixipixi on (2024-12-04 18:41:35 UTC): https://github.com/metabase/metabase/issues/50106

paoliniluis (Issue Creator) on (2024-12-05 11:15:58 UTC): Then this is a duplicate

"
2716114273,issue,open,,Remove legacy consuming functions for bucketing and binning from lib,"Functions `lib.binning/ensure-binning-in-display-name` and `lib.bucketing/ensure-temproal-unit-in-display-name` were added to the lib recently. Both functions consume result_metadata legacy style column. Because of that, both should be moved out of the lib, based on [this review comment](https://github.com/metabase/metabase/pull/50531/files#r1868453596).",lbrdnk,2024-12-03 22:41:27+00:00,['lbrdnk'],2025-02-04 20:23:52+00:00,,https://github.com/metabase/metabase/issues/50818,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2716029426,issue,closed,completed,Metabase Can't Startup because of `GET /api/health 503`,"> When you started up v0.17.0 how long did you wait to let the app start up?  It looks to me like the app was starting up properly.
> 
> I would just run `java -jar metabase.jar migrate release-locks` once and then start up the app normally and give it a little while before doing anything else.  At the very least if there is an issue it should eventually error out and print something to the logs for us to go off of.
>  

 _Originally posted by @agilliland in [#2115](https://github.com/metabase/metabase/issues/2115#issuecomment-218196742)_

I already did that, on Postgre connection but still got error same as first occurences
```
2024-12-04 05:37:47,217 INFO metabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...
2024-12-04 05:37:47,227 INFO db.setup :: Verifying postgres Database Connection ...
2024-12-04 05:37:47,448 ERROR middleware.log :: GET /api/health 503 410.8 s (0 DB calls) {:metabase-user-id nil} 
{:status ""initializing"", :progress 0.3}
```
I am using Metabase v0.51.3",ans-4175,2024-12-03 21:40:18+00:00,[],2024-12-04 02:40:42+00:00,2024-12-04 02:40:41+00:00,https://github.com/metabase/metabase/issues/50809,[],"[{'comment_id': 2515694660, 'issue_id': 2716029426, 'author': 'paoliniluis', 'body': 'I really dont know what we can do here with such little information', 'created_at': datetime.datetime(2024, 12, 3, 22, 37, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2516044434, 'issue_id': 2716029426, 'author': 'ans-4175', 'body': ""Sorry, I think it's irrelevant to ask it here (My bad, quote reply without contexts)\n\n> I really dont know what we can do here with such little information\n\nI've already asked following up on https://discourse.metabase.com/t/metabase-cant-startup-because-of-get-api-health-503/186840"", 'created_at': datetime.datetime(2024, 12, 4, 2, 40, 41, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-03 22:37:37 UTC): I really dont know what we can do here with such little information

ans-4175 (Issue Creator) on (2024-12-04 02:40:41 UTC): Sorry, I think it's irrelevant to ask it here (My bad, quote reply without contexts)


I've already asked following up on https://discourse.metabase.com/t/metabase-cant-startup-because-of-get-api-health-503/186840

"
2715985471,issue,open,,Linked filter doesn't work when the query is unaggregated and based on a simple model,"### Describe the bug

https://www.loom.com/share/062c10ed77e44c518148d591b2d2f45b

### To Reproduce

1. Create a model on top of Accounts table from the Sample Database
2. Create a question based on this model as Count by Created At
3. Add this question to a dashboard
4. Add 2 text filters on a dashboard - first connect to the First Name field, second to the Last Name field
5. In the Last Name filter settings toggle First Name filter in the linked filters tab
6. Pick anything as a First Name filter value
7. See that the Last Name filter still shows all last names as options
8. Modify the question by removing the aggregation, save with replacing the original question
9. Open the dashboard again with anything selected in the First Name filter
10. See that the Last Name filter now shows only options relevant to the chosen First Name value


### Expected behavior

Linked filter should reduce the options shown in the filter accordingly

### Logs

_No response_

### Information about your Metabase installation

```JSON
a2a4fff
```

### Severity

Very weird

### Additional context

_No response_",mngr,2024-12-03 21:11:46+00:00,[],2025-02-05 11:57:58+00:00,,https://github.com/metabase/metabase/issues/50805,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Backend', ''), ('.Team/Querying', ''), ('Reporting/Dashboards/Filters & Parameters', 'Related to the setup and use of filters and parameters in dashboards only')]","[{'comment_id': 2636529855, 'issue_id': 2715985471, 'author': 'AGRe55ive56', 'body': '\n\n> ### Describe the bug\n> https://www.loom.com/share/062c10ed77e44c518148d591b2d2f45b\n\nits not open. a cant watch it', 'created_at': datetime.datetime(2025, 2, 5, 11, 57, 56, tzinfo=datetime.timezone.utc)}]","AGRe55ive56 on (2025-02-05 11:57:56 UTC): 


its not open. a cant watch it

"
2715860489,issue,open,,Permission simulator,"**Is your feature request related to a problem? Please describe.**
People get confused with the permissions, we should have a permissions simulator that tells admins what users can do/see

**Describe the solution you'd like**
A very simple simulator of permissions and what can users do/see

**Describe alternatives you've considered**
None

**How important is this feature to you?**
We get lots of questions with the new ""Can view"" permissions, people think that users will be able to see the actual data...

**Additional context**
NA
",paoliniluis,2024-12-03 19:59:51+00:00,[],2025-02-04 20:30:18+00:00,,https://github.com/metabase/metabase/issues/50803,"[('Type:New Feature', ''), ('Administration/Permissions', 'Collection or Data permissions')]","[{'comment_id': 2567733738, 'issue_id': 2715860489, 'author': 'brunobergher', 'body': 'Very related to, maybe a duplicate of #30379', 'created_at': datetime.datetime(2025, 1, 2, 12, 54, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2567858240, 'issue_id': 2715860489, 'author': 'paoliniluis', 'body': 'Relevant discussion here: #ama-product - Nov 26th from me (search term: is:thread with:@Luiggi simulator)', 'created_at': datetime.datetime(2025, 1, 2, 14, 27, 44, tzinfo=datetime.timezone.utc)}]","brunobergher on (2025-01-02 12:54:57 UTC): Very related to, maybe a duplicate of #30379

paoliniluis (Issue Creator) on (2025-01-02 14:27:44 UTC): Relevant discussion here: #ama-product - Nov 26th from me (search term: is:thread with:@Luiggi simulator)

"
2715842963,issue,open,,Waterfall metric viz setting should not have a color selector,"**Context**

Waterfall metric viz setting should not have a color selector because waterfall colors are configured separately on the display tab.

Screenshot
![Image](https://github.com/user-attachments/assets/960421be-e577-47e3-8095-e3929c34281c)


",alxnddr,2024-12-03 19:34:44+00:00,[],2025-02-04 20:31:20+00:00,,https://github.com/metabase/metabase/issues/50801,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2715768089,issue,open,,"If you create a lot of tabs and then select one in the middle, you can't see the rest of the remaining tabs on the edit unless you move backwards and forward","### Describe the bug

Probably a state bug that does not allow you to see the remaining tabs when you select one in the middle and edit

### To Reproduce

1) create a dashboard
2) create 20 tabs
3) select tab 13
4) edit the dashboard, see that the rest of the tabs till tab 20 are not shown UNLESS you go to tab 1 and then click on the > button

### Expected behavior

We should be able to navigate to all the tabs

### Logs

NA

### Information about your Metabase installation

```JSON
v51
```

### Severity

P3

### Additional context

_No response_",paoliniluis,2024-12-03 18:49:51+00:00,[],2025-02-04 20:28:43+00:00,,https://github.com/metabase/metabase/issues/50798,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Reporting/Dashboards', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2522265503, 'issue_id': 2715768089, 'author': 'WiNloSt', 'body': 'happens to v50.35 and v51.4', 'created_at': datetime.datetime(2024, 12, 6, 6, 49, 42, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2024-12-06 06:49:42 UTC): happens to v50.35 and v51.4

"
2715756784,issue,closed,completed,We should trim the tab names,"### Describe the bug

If you try to save a tab with the name of "" "" (a space character), the BE complains with:
```
{
    ""errors"": {
        ""dash-updates"": ""map where {:name (optional) -> <nullable value must be a non-blank string.>, :description (optional) -> <nullable string>, :caveats (optional) -> <nullable string>, :points_of_interest (optional) -> <nullable string>, :show_in_getting_started (optional) -> <nullable boolean>, :enable_embedding (optional) -> <nullable boolean>, :embedding_params (optional) -> <nullable value must be a valid embedding params map.>, :parameters (optional) -> <nullable sequence of parameter must be a map with :id and :type keys>, :position (optional) -> <nullable value must be an integer greater than zero.>, :width (optional) -> <enum of fixed, full>, :archived (optional) -> <nullable boolean>, :collection_id (optional) -> <nullable value must be an integer greater than zero.>, :collection_position (optional) -> <nullable value must be an integer greater than zero.>, :cache_ttl (optional) -> <nullable value must be an integer greater than zero.>, :dashcards (optional) -> <nullable value must be seq of maps in which ids are unique>, :tabs (optional) -> <nullable value must be seq of maps in which ids are unique>}""
    },
    ""specific-errors"": {
        ""dash-updates"": {
            ""tabs"": [
                null,
                {
                    ""name"": [
                        ""non-blank string, received: \"" \""""
                    ]
                }
            ]
        }
    }
}
```

so we should simply trim on the FE and return the tab default name

### To Reproduce

create a dashboard
add a tab
put a space character
try to save

### Expected behavior

we should put ""tab x"" in the same way we do if it's blank

### Logs

above

### Information about your Metabase installation

```JSON
v51.x
```

### Severity

P3

### Additional context

_No response_",paoliniluis,2024-12-03 18:43:18+00:00,['lorem--ipsum'],2025-01-29 09:31:00+00:00,2025-01-23 09:02:18+00:00,https://github.com/metabase/metabase/issues/50797,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Reporting/Dashboards', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2522257183, 'issue_id': 2715756784, 'author': 'WiNloSt', 'body': 'happens to v50.35, v51.4, and master', 'created_at': datetime.datetime(2024, 12, 6, 6, 42, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2573872392, 'issue_id': 2715756784, 'author': 'tsplude', 'body': 'For posterity, solution as requested (default to ""Tab <X>"") could be something like the below, adjusted [here](https://github.com/metabase/metabase/blob/bb3abf74e1cf0fa9474c96c9a9c766470bf5f4f5/frontend/src/metabase/dashboard/components/DashboardTabs/use-dashboard-tabs.ts#L81)\n\n```\nrenameTab: (tabId: SelectedTabId, name: string) => {\n      name = name.trim();\n      if (name.length === 0) {\n        // Revert to default tab name if entered name is just whitespace\n        const tabIdx =\n          Number(Object.keys(tabs).find(key => tabs[key].id === tabId)) + 1;\n        name = `Tab ${tabIdx}`;\n      }\n      dispatch(renameTab({ tabId, name }));\n    },\n```\n\nBut talked to @alxnddr and we\'d prefer to have the rename field turn to red outline and give user feedback regarding naming constraints which requires error state handling in the dashboard tabs code so he\'s going to take it from here', 'created_at': datetime.datetime(2025, 1, 6, 20, 29, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2621116491, 'issue_id': 2715756784, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)', 'created_at': datetime.datetime(2025, 1, 29, 9, 30, 59, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2024-12-06 06:42:39 UTC): happens to v50.35, v51.4, and master

tsplude on (2025-01-06 20:29:48 UTC): For posterity, solution as requested (default to ""Tab <X>"") could be something like the below, adjusted [here](https://github.com/metabase/metabase/blob/bb3abf74e1cf0fa9474c96c9a9c766470bf5f4f5/frontend/src/metabase/dashboard/components/DashboardTabs/use-dashboard-tabs.ts#L81)

```
renameTab: (tabId: SelectedTabId, name: string) => {
      name = name.trim();
      if (name.length === 0) {
        // Revert to default tab name if entered name is just whitespace
        const tabIdx =
          Number(Object.keys(tabs).find(key => tabs[key].id === tabId)) + 1;
        name = `Tab ${tabIdx}`;
      }
      dispatch(renameTab({ tabId, name }));
    },
```

But talked to @alxnddr and we'd prefer to have the rename field turn to red outline and give user feedback regarding naming constraints which requires error state handling in the dashboard tabs code so he's going to take it from here

github-actions[bot] on (2025-01-29 09:30:59 UTC):  This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)

"
2715741001,issue,closed,completed,Dashboard date range filter widget stretches when adding a time,"### Describe the bug



![Image](https://github.com/user-attachments/assets/c94870bb-079b-403d-b6e2-a1034b9865e2)


### To Reproduce

1. Go to a dashboard that has a date range filter 
2. Click on the filter control and then on Add a time in the popover
3. See the popover weirdly stretched


### Expected behavior

Should be of the same size
![Image](https://github.com/user-attachments/assets/1d93b68d-c7f8-4435-9eb4-09d0861c0d29)

### Logs

_No response_

### Information about your Metabase installation

```JSON
a2a4fff
```

### Severity

Looks weird

### Additional context

_No response_",mngr,2024-12-03 18:34:16+00:00,[],2025-01-16 20:01:34+00:00,2025-01-16 20:01:27+00:00,https://github.com/metabase/metabase/issues/50796,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('.Team/Querying', ''), ('Reporting/Dashboards/Filters & Parameters', 'Related to the setup and use of filters and parameters in dashboards only')]","[{'comment_id': 2596786196, 'issue_id': 2715741001, 'author': 'ranquild', 'body': 'Fixed with new date parameter widgets', 'created_at': datetime.datetime(2025, 1, 16, 20, 1, 27, tzinfo=datetime.timezone.utc)}]","ranquild on (2025-01-16 20:01:27 UTC): Fixed with new date parameter widgets

"
2715315514,issue,closed,completed,Safari Failed to load resource: The network connection was lost,"### Describe the bug

When opening question in Safari we see following error:

`Failed to load resource: The network connection was lost.`

![Image](https://github.com/user-attachments/assets/f7dfdb91-32db-4e5d-8c1f-72046664ca6d)


### To Reproduce

1. Open question page like `domain.com/question/xxx`.
2. Leave it idle for a few minutes without refreshing it.
3. After a few minutes, press Run Query.
4. Result: A server error is reported.

### Expected behavior

It should not report any error and fetch the data.

### Logs

There are no related entries in Java or Nginx logs, I guess it's because the request doesn't get to website.

```
Summary
URL: https://domain/api/card/9222/query
Status: 
Source: 
Initiator: 
api.js:236

Request
Accept: application/json
Content-Type: application/json
Origin: https://domain
Referer: https://domain/question/9222-monthly-city-by-city-ops-excellence?date=thisday
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.1.1 Safari/605.1.15

Response
No response headers

Request Data
MIME Type: application/json
Request Data: 

{""ignore_cache"":true,""collection_preview"":false,""parameters"":[{""id"":""0d2423fb-xxxx-xxxx-xxxx-xxxxxxxxxx"",""type"":""date/all-options"",""value"":""thisday"",""target"":[""dimension"",[""template-tag"",""date""]]}]}
```

Logs from Metabase Admin Panel:

```
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:07:56+01:00 DEBUG metabase.server.middleware.log GET /api/dashboard/321 200 140.5 ms (21 DB calls) App DB connections: 0/15 Jetty threads: 3/50 (18 idle, 0 queued) (140 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:07:57+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7490/card/7671/query 202 [ASYNC: completed] 453.8 ms (15 DB calls) App DB connections: 3/15 Jetty threads: 3/50 (18 idle, 0 queued) (140 total active threads) Queries in flight: 2 (0 queued); postgres DB 100 connections: 0/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:07:58+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7492/card/7673/query 202 [ASYNC: completed] 645.0 ms (15 DB calls) App DB connections: 4/15 Jetty threads: 5/50 (16 idle, 0 queued) (140 total active threads) Queries in flight: 2 (0 queued); postgres DB 100 connections: 0/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:07:58+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7500/card/7675/query 202 [ASYNC: completed] 957.7 ms (15 DB calls) App DB connections: 4/15 Jetty threads: 5/50 (16 idle, 0 queued) (140 total active threads) Queries in flight: 4 (0 queued); postgres DB 100 connections: 0/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:07:59+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7491/card/7672/query 202 [ASYNC: completed] 1.6 s (15 DB calls) App DB connections: 11/15 Jetty threads: 5/50 (16 idle, 0 queued) (141 total active threads) Queries in flight: 9 (0 queued); postgres DB 100 connections: 2/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:07:59+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7497/card/7645/query 202 [ASYNC: completed] 2.0 s (15 DB calls) App DB connections: 11/15 Jetty threads: 5/50 (15 idle, 0 queued) (141 total active threads) Queries in flight: 8 (0 queued); postgres DB 100 connections: 0/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:00+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7499/card/7674/query 202 [ASYNC: completed] 2.0 s (15 DB calls) App DB connections: 12/15 Jetty threads: 7/50 (14 idle, 0 queued) (141 total active threads) Queries in flight: 10 (0 queued); postgres DB 100 connections: 1/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:00+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7501/card/7676/query 202 [ASYNC: completed] 2.0 s (15 DB calls) App DB connections: 10/15 Jetty threads: 6/50 (15 idle, 0 queued) (141 total active threads) Queries in flight: 10 (1 queued); postgres DB 100 connections: 1/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:01+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7496/card/7644/query 202 [ASYNC: completed] 3.1 s (15 DB calls) App DB connections: 10/15 Jetty threads: 4/50 (16 idle, 0 queued) (141 total active threads) Queries in flight: 13 (0 queued); postgres DB 100 connections: 1/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:01+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7498/card/7646/query 202 [ASYNC: completed] 2.6 s (15 DB calls) App DB connections: 15/15 Jetty threads: 5/50 (16 idle, 0 queued) (141 total active threads) Queries in flight: 12 (0 queued); postgres DB 100 connections: 1/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:01+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/6638/card/6767/query 202 [ASYNC: completed] 2.3 s (15 DB calls) App DB connections: 14/15 Jetty threads: 5/50 (15 idle, 0 queued) (141 total active threads) Queries in flight: 11 (0 queued); postgres DB 100 connections: 2/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:02+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/6635/card/6765/query 202 [ASYNC: completed] 3.1 s (15 DB calls) App DB connections: 11/15 Jetty threads: 4/50 (16 idle, 0 queued) (142 total active threads) Queries in flight: 15 (0 queued); postgres DB 100 connections: 2/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:02+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/6634/card/6766/query 202 [ASYNC: completed] 3.4 s (15 DB calls) App DB connections: 13/15 Jetty threads: 3/50 (17 idle, 0 queued) (142 total active threads) Queries in flight: 14 (0 queued); postgres DB 100 connections: 1/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:02+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/6633/card/6764/query 202 [ASYNC: completed] 3.1 s (15 DB calls) App DB connections: 11/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 14 (0 queued); postgres DB 100 connections: 3/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:02+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7913/card/8122/query 202 [ASYNC: completed] 3.9 s (15 DB calls) App DB connections: 13/15 Jetty threads: 3/50 (17 idle, 0 queued) (142 total active threads) Queries in flight: 13 (0 queued); postgres DB 100 connections: 2/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:02+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7516/card/7690/query 202 [ASYNC: completed] 3.2 s (15 DB calls) App DB connections: 12/15 Jetty threads: 3/50 (17 idle, 0 queued) (142 total active threads) Queries in flight: 12 (0 queued); postgres DB 100 connections: 2/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:02+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/6639/card/6768/query 202 [ASYNC: completed] 2.7 s (15 DB calls) App DB connections: 9/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 11 (0 queued); postgres DB 100 connections: 2/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7481/card/7654/query 202 [ASYNC: completed] 3.0 s (15 DB calls) App DB connections: 8/15 Jetty threads: 3/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 10 (0 queued); postgres DB 100 connections: 3/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7479/card/7652/query 202 [ASYNC: completed] 3.6 s (15 DB calls) App DB connections: 8/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 10 (0 queued); postgres DB 100 connections: 2/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7480/card/7653/query 202 [ASYNC: completed] 3.4 s (15 DB calls) App DB connections: 8/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 9 (0 queued); postgres DB 100 connections: 1/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/6637/card/6762/query 202 [ASYNC: completed] 3.1 s (15 DB calls) App DB connections: 5/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 7 (0 queued); postgres DB 100 connections: 3/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/6745/card/6963/query 202 [ASYNC: completed] 2.0 s (16 DB calls) App DB connections: 1/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 6 (0 queued); postgres DB 100 connections: 4/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7535/card/7712/query 202 [ASYNC: completed] 2.2 s (15 DB calls) App DB connections: 3/15 Jetty threads: 3/50 (17 idle, 0 queued) (142 total active threads) Queries in flight: 5 (0 queued); postgres DB 100 connections: 5/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7534/card/7710/query 202 [ASYNC: completed] 2.6 s (15 DB calls) App DB connections: 3/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 4 (0 queued); postgres DB 100 connections: 3/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/6632/card/6761/query 202 [ASYNC: completed] 3.1 s (15 DB calls) App DB connections: 4/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 4 (0 queued); postgres DB 100 connections: 3/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7533/card/7711/query 202 [ASYNC: completed] 2.4 s (15 DB calls) App DB connections: 4/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 3 (0 queued); postgres DB 100 connections: 6/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/6636/card/6763/query 202 [ASYNC: completed] 3.1 s (15 DB calls) App DB connections: 1/15 Jetty threads: 2/50 (18 idle, 0 queued) (142 total active threads) Queries in flight: 2 (0 queued); postgres DB 100 connections: 2/8 (0 threads blocked) {:metabase-user-id 750}
[c56ae859-6c38-4352-b5da-9bc9871ab315] 2024-12-03T16:08:03+01:00 DEBUG metabase.server.middleware.log POST /api/dashboard/321/dashcard/7532/card/7709/query 202 [ASYNC: completed] 3.0 s (15 DB calls) App DB connections: 2/15 Jetty threads: 3/50 (17 idle, 0 queued) (142 total active threads) Queries in flight: 0 (0 queued); postgres DB 100 connections: 2/8 (0 threads blocked) {:metabase-user-id 750}
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.1.1 Safari/605.1.15"",
    ""vendor"": ""Apple Computer, Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-10"",
      ""tag"": ""v0.50.33"",
      ""hash"": ""7bb5d4c""
    },
    ""settings"": {
      ""report-timezone"": ""UTC""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.15""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9-post-Ubuntu-1ubuntu124.04"",
    ""java.vendor"": ""Ubuntu"",
    ""java.vendor.url"": ""https://ubuntu.com/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9-post-Ubuntu-1ubuntu124.04"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.8.0-1008-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```

### Severity

Annoying

### Additional context

I mentioned ""After a few minutes"" because it's difficult to predict the exact timing, it could be a matter of minutes or hours?. Please try pressing refresh a few times at intervals of a few minutes.

![Image](https://github.com/user-attachments/assets/3951fc7e-755a-44be-af7f-f8336f6a58d2)

I highly doubt this issue is caused by a poor network connection. I ran the same test on Chrome simultaneously, and it worked fine. Additionally, I have a stable connection, and this problem has been reported by multiple users.

Refreshing the page resolves the issue, but it's inconvenient if we need to adjust the query. Interestingly, refreshing immediately after encountering the error also works fine.",blevkovych,2024-12-03 15:19:33+00:00,[],2024-12-09 10:34:00+00:00,2024-12-09 10:32:12+00:00,https://github.com/metabase/metabase/issues/50785,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2514905567, 'issue_id': 2715315514, 'author': 'paoliniluis', 'body': 'Do you have an ids or ips or something that does host based protection? First time we see this issue and only happens to you', 'created_at': datetime.datetime(2024, 12, 3, 15, 37, 15, tzinfo=datetime.timezone.utc)}, {'comment_id': 2515108443, 'issue_id': 2715315514, 'author': 'blevkovych', 'body': ""At this moment we do not have any IDS or IPS. We use CloudFlare but there are also no issues reported there.\nWe do only allow access through CloudFlare but I don't think that's related.\n```   # Only allow access from CloudFlare IP's\n    location / {\n        allow 173.245.48.0/20;\n        allow 103.21.244.0/22;\n        allow 103.22.200.0/22;\n        allow 103.31.4.0/22;\n        allow 141.101.64.0/18;\n        allow 108.162.192.0/18;\n        allow 190.93.240.0/20;\n        allow 188.114.96.0/20;\n        allow 197.234.240.0/22;\n        allow 198.41.128.0/17;\n        allow 162.158.0.0/15;\n        allow 104.16.0.0/13;\n        allow 104.24.0.0/14;\n        allow 172.64.0.0/13;\n        allow 131.0.72.0/22;\n        allow 2400:cb00::/32;\n        allow 2606:4700::/32;\n        allow 2803:f800::/32;\n        allow 2405:b500::/32;\n        allow 2405:8100::/32;\n        allow 2a06:98c0::/29;\n        allow 2c0f:f248::/32;\n        deny all;\n        proxy_pass http://127.0.0.1:3000;\n    }\n\nGenerally it's a clean instance with JVM, NGINX and Metabase, that's it."", 'created_at': datetime.datetime(2024, 12, 3, 16, 59, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2515247961, 'issue_id': 2715315514, 'author': 'paoliniluis', 'body': ""Disable cloudflare and try again. I think it's Cloudflare"", 'created_at': datetime.datetime(2024, 12, 3, 18, 2, 19, tzinfo=datetime.timezone.utc)}, {'comment_id': 2527533090, 'issue_id': 2715315514, 'author': 'blevkovych', 'body': ""I can confirm that everything seems to work fine when it's not routed through Cloudflare."", 'created_at': datetime.datetime(2024, 12, 9, 10, 32, 4, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-03 15:37:15 UTC): Do you have an ids or ips or something that does host based protection? First time we see this issue and only happens to you

blevkovych (Issue Creator) on (2024-12-03 16:59:56 UTC): At this moment we do not have any IDS or IPS. We use CloudFlare but there are also no issues reported there.
We do only allow access through CloudFlare but I don't think that's related.
```   # Only allow access from CloudFlare IP's
    location / {
        allow 173.245.48.0/20;
        allow 103.21.244.0/22;
        allow 103.22.200.0/22;
        allow 103.31.4.0/22;
        allow 141.101.64.0/18;
        allow 108.162.192.0/18;
        allow 190.93.240.0/20;
        allow 188.114.96.0/20;
        allow 197.234.240.0/22;
        allow 198.41.128.0/17;
        allow 162.158.0.0/15;
        allow 104.16.0.0/13;
        allow 104.24.0.0/14;
        allow 172.64.0.0/13;
        allow 131.0.72.0/22;
        allow 2400:cb00::/32;
        allow 2606:4700::/32;
        allow 2803:f800::/32;
        allow 2405:b500::/32;
        allow 2405:8100::/32;
        allow 2a06:98c0::/29;
        allow 2c0f:f248::/32;
        deny all;
        proxy_pass http://127.0.0.1:3000;
    }

Generally it's a clean instance with JVM, NGINX and Metabase, that's it.

paoliniluis on (2024-12-03 18:02:19 UTC): Disable cloudflare and try again. I think it's Cloudflare

blevkovych (Issue Creator) on (2024-12-09 10:32:04 UTC): I can confirm that everything seems to work fine when it's not routed through Cloudflare.

"
2715149577,issue,closed,completed,Better setting for enabling new search,"Something like `MB_SEARCH_ENGINE=fulltext`, pointing to old search by default.",piranha,2024-12-03 14:13:45+00:00,['crisptrutski'],2024-12-04 13:08:23+00:00,2024-12-04 13:08:23+00:00,https://github.com/metabase/metabase/issues/50778,"[('.Team/Workflows', 'aka BEC')]",[],
2715096723,issue,closed,completed,Caching zero user count for too long,"### Describe the bug

We erroneously cache the usercount for ~208 days rather than 5 minutes.

```clojure
(def ^:private ^:const active-users-count-cache-ttl
  ""Amount of time before we re-fetch the count of active users.""
  (u/minutes->ms 5))

;; let's prevent the DB from getting slammed with calls to get the active user count, we only really need one in flight
;; at a time.
(let [f        (fn []
                 {:post [(integer? %)]}
                 (log/debug (u/colorize :yellow ""GETTING ACTIVE USER COUNT!""))
                 (assert ((requiring-resolve 'metabase.db/db-is-set-up?)) ""Metabase DB is not yet set up"")
                 ;; force this to use a new Connection, it seems to be getting called in situations where the Connection
                 ;; is from a different thread and is invalid by the time we get to use it
                 (let [result (binding [t2.conn/*current-connectable* nil]
                                (t2/count :model/User :is_active true :type :personal))]
                   (log/debug (u/colorize :green ""=>"") result)
                   result))
      memoized (memoize/ttl
                f
                :ttl/threshold (u/minutes->ms active-users-count-cache-ttl))
      lock     (Object.)]
  (defn- cached-active-users-count'
    ""Returns a count of users on the system, cached for 5 minutes.""
    []
    (locking lock
      (memoized))))
```

Note the double call of `u/minutes->ms` so we end up with

```clojure
premium-features=> (u/minutes->ms 5)
300000
premium-features=> (u/minutes->ms active-users-count-cache-ttl) ;; the actual cache ttl limit
18000000000
premium-features=> (double (/ *1 (* 1000 60 60 24))) ;; 1000 ms -> s 60 -> m 60 -> h 24 -> days
208.3333333333333
```

### To Reproduce

latest master 

### Expected behavior

should cache the user count for 5 minutes

### Logs

_No response_

### Information about your Metabase installation

```JSON
recent
```

### Severity

p1

### Additional context

_No response_",dpsutton,2024-12-03 13:53:36+00:00,[],2025-01-27 22:14:12+00:00,2024-12-03 20:53:33+00:00,https://github.com/metabase/metabase/issues/50777,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('postmortem-followup', '')]","[{'comment_id': 2515530154, 'issue_id': 2715096723, 'author': 'dpsutton', 'body': 'closed by https://github.com/metabase/metabase/pull/50779', 'created_at': datetime.datetime(2024, 12, 3, 20, 53, 33, tzinfo=datetime.timezone.utc)}]","dpsutton (Issue Creator) on (2024-12-03 20:53:33 UTC): closed by https://github.com/metabase/metabase/pull/50779

"
2714981219,issue,open,,"Can't exclude specific rows (e.g., deleted items) from filter dropdowns","### Describe the bug

Im working on a dashboard in Metabase and need to set up linked filters. One of my filters is based on a column from a table that includes rows marked as deleted by using the ""deleted_at"" column. I want to exclude the rows that contain a date in this field from appearing in the filter dropdown while maintaining the ability to use this filter as a linked filter with other dropdowns.

Heres what Ive tried so far:

Saved Questions: I created a saved question that excludes rows where deleted_at is null. However, saved questions cant be used as linked filters, so this approach doesnt work for my case.

Data Model Settings: I checked the column settings under Admin > Data Model, but I couldnt find an option to apply a default filter like WHERE deleted is null to the column.

Native SQL Queries: While I can write a SQL query that filters out deleted rows and uses {{filter}} for linking, this approach doesnt allow me to set up a global field filter that works seamlessly with other filters in the dashboard.

Database Views: I considered creating a database view that excludes deleted rows, but this might complicate the schema and isnt ideal for frequent updates.

My Goal:

I need to configure the filter dropdown to exclude rows where deleted_at is null, while still enabling it to function as a linked filter in the dashboard.

Questions:

Is there a way to exclude specific rows (e.g., deleted_at is null) directly in a filter dropdown in Metabase without breaking linked filter functionality?
Can this be achieved through the data model settings or some other workaround?
Are there any recommended best practices for handling this scenario?
Additional Details:

Im using Metabase v0.51.5.
The deleted_at column is a datetime nullable field.
My database is MariaDB.

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-26"",
      ""tag"": ""v0.51.5"",
      ""hash"": ""d79d949""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Malta""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.5.11-linuxkit"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

High

### Additional context

_No response_",msciclunacorps,2024-12-03 13:03:59+00:00,[],2025-02-04 20:31:06+00:00,,https://github.com/metabase/metabase/issues/50776,"[('Type:New Feature', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Team/Querying', '')]","[{'comment_id': 2514829483, 'issue_id': 2714981219, 'author': 'mngr', 'body': ""Hey @msciclunacorps, could you please give any specific example of what you want to achieve and why?\nIf your data is sensitive, maybe you could build an example from the Metabase's Sample database where we have Accounts table with Canceled At column, that has null values in some rows."", 'created_at': datetime.datetime(2024, 12, 3, 15, 7, 8, tzinfo=datetime.timezone.utc)}]","mngr on (2024-12-03 15:07:08 UTC): Hey @msciclunacorps, could you please give any specific example of what you want to achieve and why?
If your data is sensitive, maybe you could build an example from the Metabase's Sample database where we have Accounts table with Canceled At column, that has null values in some rows.

"
2714601793,issue,closed,completed,Wrong database_type value,"We are experiencing problems with database_type field in metabase_fields table. When given field has a type from schema eg. ""test_schema"".""category"" the value in the database_type is only ""category"". There is not such a a type in the public schema so the SQL queries behind the questions/dashboard are not working at all. When I update it manually it works till next automatic database update. There is also possibility to have same type both in public and some schema, so it need to have a schema prefix.

We have been using metabase on this database for more than one year. We didn't have any problems with fields. Now after latest update we are using current stable metabase version which is:
version v0.51.6
Built on 2024-11-28
and the bug shows up.

Please fix it or give some advice how to handle this bug. Thank you! 

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""pl"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-28"",
      ""tag"": ""v0.51.6"",
      ""hash"": ""fc77ed4""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-1057-azure"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

blocking usage,sql queries not working",smiecielica-billtech,2024-12-03 10:23:59+00:00,['snoe'],2024-12-05 16:30:09+00:00,2024-12-04 21:33:51+00:00,https://github.com/metabase/metabase/issues/50771,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Database/Postgres', None), ('Administration/Metadata & Sync', ''), ('Cloud-Blocker:51', 'Issues blocking the cloud customers to be upgraded to v51'), ('.Team/Drivers', '')]","[{'comment_id': 2514580649, 'issue_id': 2714601793, 'author': 'luizarakaki', 'body': ""@smiecielica-billtech I'm not following the issue. Can you add more info, an potentially some screenshots?\n\nWhat do you update manually to make it work?\n\n> There is also possibility to have same type both in public and some schema, so it need to have a schema prefix.\n\nNot sure what this means"", 'created_at': datetime.datetime(2024, 12, 3, 13, 37, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2514641967, 'issue_id': 2714601793, 'author': 'smiecielica-billtech', 'body': '@luizarakaki Hi, thanks for answering my issue. \nHere is screenshot from metabase_field:\n![Image](https://github.com/user-attachments/assets/69e12ae2-2020-4236-a883-01edf4e8c3e8)\nYou ca see that there is column database_type which should determine the exact type in the database.\nFor example you can see type DeliveryDispatchType. By default the query search for the type in public.DeliveryDispatchType (or how it is set in search_path in postgresql). But we have two types schema1.DeliveryDispatchType and schema2.DeliveryDispatchType.\nIn this case the column value should be ""schema1"".""DeliveryDispatchType"" and ""schema2"".""DeliveryDispatchType"" (depend to which table it refers). Now we get an error while entering the question:\n![Image](https://github.com/user-attachments/assets/f05a0ac8-a863-4f4d-a06e-7cf7b62aa534)\n(I know screenshot tells about ListingType but this is the same case)\n\nIt cannot find given database_type in out database. We cannot solve it by adding extra schemas in search_path config of postgres because Metabase wouldn\'t know how to differentiate same type name in different schemas.', 'created_at': datetime.datetime(2024, 12, 3, 14, 1, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2514818573, 'issue_id': 2714601793, 'author': 'luizarakaki', 'body': 'Thanks for the clarification. Something is off about `database_type`, it should be the database data type, not the column name', 'created_at': datetime.datetime(2024, 12, 3, 15, 2, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2514823076, 'issue_id': 2714601793, 'author': 'smiecielica-billtech', 'body': '@luizarakaki the name is correct, but is is missing schema prefix', 'created_at': datetime.datetime(2024, 12, 3, 15, 4, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2514826310, 'issue_id': 2714601793, 'author': 'luizarakaki', 'body': ""The schema isn't defined in metabase_field. It is defined in metabase_table"", 'created_at': datetime.datetime(2024, 12, 3, 15, 5, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2514826911, 'issue_id': 2714601793, 'author': 'luizarakaki', 'body': 'Can you check if `schema` in `metabase_table` is correct?', 'created_at': datetime.datetime(2024, 12, 3, 15, 6, 6, tzinfo=datetime.timezone.utc)}, {'comment_id': 2514840618, 'issue_id': 2714601793, 'author': 'smiecielica-billtech', 'body': 'I have ""schema X"", which uses types from ""schema Y"". So if I have a field in table in ""schema X"" and the fields that return a value with type from ""schema Y"" it won\'t work. \nPreviously in Metabase schema was saved in the metabase_field table as on the screen below:\n![Image](https://github.com/user-attachments/assets/25180df4-6fa9-4a10-818e-122aff04fb03)', 'created_at': datetime.datetime(2024, 12, 3, 15, 11, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2520842446, 'issue_id': 2714601793, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.2](https://github.com/metabase/metabase/milestone/291)', 'created_at': datetime.datetime(2024, 12, 5, 16, 30, 7, tzinfo=datetime.timezone.utc)}]","luizarakaki on (2024-12-03 13:37:36 UTC): @smiecielica-billtech I'm not following the issue. Can you add more info, an potentially some screenshots?

What do you update manually to make it work?


Not sure what this means

smiecielica-billtech (Issue Creator) on (2024-12-03 14:01:18 UTC): @luizarakaki Hi, thanks for answering my issue. 
Here is screenshot from metabase_field:
![Image](https://github.com/user-attachments/assets/69e12ae2-2020-4236-a883-01edf4e8c3e8)
You ca see that there is column database_type which should determine the exact type in the database.
For example you can see type DeliveryDispatchType. By default the query search for the type in public.DeliveryDispatchType (or how it is set in search_path in postgresql). But we have two types schema1.DeliveryDispatchType and schema2.DeliveryDispatchType.
In this case the column value should be ""schema1"".""DeliveryDispatchType"" and ""schema2"".""DeliveryDispatchType"" (depend to which table it refers). Now we get an error while entering the question:
![Image](https://github.com/user-attachments/assets/f05a0ac8-a863-4f4d-a06e-7cf7b62aa534)
(I know screenshot tells about ListingType but this is the same case)

It cannot find given database_type in out database. We cannot solve it by adding extra schemas in search_path config of postgres because Metabase wouldn't know how to differentiate same type name in different schemas.

luizarakaki on (2024-12-03 15:02:58 UTC): Thanks for the clarification. Something is off about `database_type`, it should be the database data type, not the column name

smiecielica-billtech (Issue Creator) on (2024-12-03 15:04:38 UTC): @luizarakaki the name is correct, but is is missing schema prefix

luizarakaki on (2024-12-03 15:05:52 UTC): The schema isn't defined in metabase_field. It is defined in metabase_table

luizarakaki on (2024-12-03 15:06:06 UTC): Can you check if `schema` in `metabase_table` is correct?

smiecielica-billtech (Issue Creator) on (2024-12-03 15:11:38 UTC): I have ""schema X"", which uses types from ""schema Y"". So if I have a field in table in ""schema X"" and the fields that return a value with type from ""schema Y"" it won't work. 
Previously in Metabase schema was saved in the metabase_field table as on the screen below:
![Image](https://github.com/user-attachments/assets/25180df4-6fa9-4a10-818e-122aff04fb03)

github-actions[bot] on (2024-12-05 16:30:07 UTC):  This should also be released by [v0.52.2](https://github.com/metabase/metabase/milestone/291)

"
2714369673,issue,closed,completed,Add tests to debugger,"currently debugger has no tests or even gha lint steps. no bueno, lets add some",filiphric,2024-12-03 08:49:34+00:00,[],2025-01-23 08:58:58+00:00,2024-12-16 14:53:30+00:00,https://github.com/metabase/metabase/issues/50769,[],[],
2713920496,issue,open,,[Epic] [Notification] Alert improvement,"### Links

* [product doc](https://www.notion.so/metabase/Alerts-improvements-in-the-new-notifications-architecture-239360679aeb4ea0b26e74fba1725db9?pvs=4)
* technical design doc:
  * [migrate alert to notification](https://www.notion.so/metabase/Migrate-alert-to-notification-14b69354c901801789c6dc34eb12bdc5?pvs=4)
  * [notification API](https://www.notion.so/metabase/Notification-api-14969354c90180ce9e8de76a79cc0a49?pvs=4)
* [testing plan](LINK_TO_TESTING_PLAN)
* feature branch: `a_brave_new_alert`
* issue links:

### Implementation Plan

## Migrate alerts to new schema + Notifications REST API

- [X] [https://github.com/metabase/metabase/pull/51120](https://github.com/metabase/metabase/pull/51120)
- [X] [https://github.com/metabase/metabase/pull/50770](https://github.com/metabase/metabase/pull/50770)
- [X] [https://github.com/metabase/metabase/pull/51267](https://github.com/metabase/metabase/pull/51267)
- [X] [https://github.com/metabase/metabase/pull/50724](https://github.com/metabase/metabase/pull/50724)
- [ ] [https://github.com/metabase/metabase/pull/52431](https://github.com/metabase/metabase/pull/52431)
- [X] [https://github.com/metabase/metabase/pull/51120](https://github.com/metabase/metabase/pull/51120)
- [X] [https://github.com/metabase/metabase/pull/51688](https://github.com/metabase/metabase/pull/51688)

## Notification Management

- [X] [https://github.com/metabase/metabase/pull/51267](https://github.com/metabase/metabase/pull/51267)
- [X] [https://github.com/metabase/metabase/pull/51649](https://github.com/metabase/metabase/pull/51649)
- [X] [https://github.com/metabase/metabase/pull/51688](https://github.com/metabase/metabase/pull/51688)
- [ ] [https://github.com/metabase/metabase/pull/52494](https://github.com/metabase/metabase/pull/52494)
- [X] [https://github.com/metabase/metabase/pull/51561](https://github.com/metabase/metabase/pull/51561)
- [ ] [https://github.com/metabase/metabase/pull/52109](https://github.com/metabase/metabase/pull/52109)
- [X] [https://github.com/metabase/metabase/pull/52193](https://github.com/metabase/metabase/pull/52193)
- [ ] [https://github.com/metabase/metabase/pull/51852](https://github.com/metabase/metabase/pull/51852)

## Polishing

- [ ] [https://github.com/metabase/metabase/pull/52012](https://github.com/metabase/metabase/pull/52012)
- [X] [https://github.com/metabase/metabase/pull/52078](https://github.com/metabase/metabase/pull/52078)",qnkhuat,2024-12-03 03:53:48+00:00,"['deniskaber', 'qnkhuat']",2025-01-28 08:22:26+00:00,,https://github.com/metabase/metabase/issues/50766,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Workflows', 'aka BEC')]","[{'comment_id': 2582421184, 'issue_id': 2713920496, 'author': 'oliviertassinari', 'body': '> Notifications menu with separate entry points for Alerts & Subscriptions\n\nYes, please! This UX is such a regression compared to before. Alert under Sharing? Lol what\n\n<img width=""399"" alt=""Image"" src=""https://github.com/user-attachments/assets/b12f7059-3025-4a97-8f7a-a1b4cb16ec55"" />\n\nv1.51.6.5', 'created_at': datetime.datetime(2025, 1, 10, 10, 55, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2587500345, 'issue_id': 2713920496, 'author': 'fcalvet', 'body': 'This caused quite some confusion here as well. No mention in the release notes ?', 'created_at': datetime.datetime(2025, 1, 13, 15, 52, 33, tzinfo=datetime.timezone.utc)}]","oliviertassinari on (2025-01-10 10:55:58 UTC): Yes, please! This UX is such a regression compared to before. Alert under Sharing? Lol what

<img width=""399"" alt=""Image"" src=""https://github.com/user-attachments/assets/b12f7059-3025-4a97-8f7a-a1b4cb16ec55"" />

v1.51.6.5

fcalvet on (2025-01-13 15:52:33 UTC): This caused quite some confusion here as well. No mention in the release notes ?

"
2713664546,issue,open,,Client closed connection prematurely w static dashboard embed & default value,"### Describe the bug

error in log file. Client closed connection prematurely w static dashboard embed & default value

### To Reproduce

steps to reproduce:

1. create a question from the People table (from the sample database), though any table should do
2. select, say, the Name column
3. put this question in a dashboard
4. create a dashboard (text) filter for the Name column, with a Default value
5. setup static embedding for this dashboard, marking the filter as editable
6. create the embedding html and view in browser, with params: {}
7. get a ""Client closed connection prematurely"" error in the logs

this happens in at least Chrome and Safari, Ubuntu and MacOS

java version = openjdk 11.0.25

metabase version: 0.51.4 (but also .50)

### Expected behavior

_No response_

### Logs

2024-11-25 12:42:23,585 ERROR query-processor.streaming :: Client closed connection prematurely

org.eclipse.jetty.io.EofException

at org.eclipse.jetty.io.SocketChannelEndPoint.flush(SocketChannelEndPoint.java:116)

at org.eclipse.jetty.io.WriteFlusher.flush(WriteFlusher.java:422)

at org.eclipse.jetty.io.WriteFlusher.write(WriteFlusher.java:275)

at org.eclipse.jetty.io.WriteFlusher.write(WriteFlusher.java:254)

at org.eclipse.jetty.io.AbstractEndPoint.write(AbstractEndPoint.java:386)

at org.eclipse.jetty.server.HttpConnection$SendCallback.process(HttpConnection.java:849)

at org.eclipse.jetty.util.IteratingCallback.processing(IteratingCallback.java:243)

at org.eclipse.jetty.util.IteratingCallback.iterate(IteratingCallback.java:224)

at org.eclipse.jetty.server.HttpConnection.send(HttpConnection.java:600)

at org.eclipse.jetty.server.HttpChannel.sendResponse(HttpChannel.java:1051)

at org.eclipse.jetty.server.HttpChannel.write(HttpChannel.java:1123)

at org.eclipse.jetty.server.HttpOutput.channelWrite(HttpOutput.java:270)

at org.eclipse.jetty.server.HttpOutput.close(HttpOutput.java:623)

at java.base/java.util.zip.DeflaterOutputStream.close(DeflaterOutputStream.java:250)

at metabase.async.streaming_response$delay_output_stream$fn__53178.invoke(streaming_response.clj:130)

at metabase.async.streaming_response.proxy$java.io.OutputStream$ff19274a.close(Unknown Source)

at java.base/sun.nio.cs.StreamEncoder.implClose(StreamEncoder.java:341)

at java.base/sun.nio.cs.StreamEncoder.close(StreamEncoder.java:161)

at java.base/java.io.OutputStreamWriter.close(OutputStreamWriter.java:255)

at java.base/java.io.BufferedWriter.close(BufferedWriter.java:269)

at com.fasterxml.jackson.core.json.WriterBasedJsonGenerator.close(WriterBasedJsonGenerator.java:1033)

at metabase.query_processor.streaming.json$fn$reify__60630.finish_BANG_(json.clj:154)

at metabase.query_processor.streaming$streaming_result_fn61508__61509$result__61510$fn__61511.invoke(streaming.clj:143)

at metabase.query_processor.streaming$streaming_result_fn61508__61509$result__61510.invoke(streaming.clj:142)

at clojure.core$comp$fn__5895.invoke(core.clj:2586)

at metabase.query_processor.pipeline$STAR_reduce_STAR.invokeStatic(pipeline.clj:86)

at metabase.query_processor.pipeline$STAR_reduce_STAR.invoke(pipeline.clj:54)

at metabase.query_processor.pipeline$STAR_run_STAR$respond__58968.invoke(pipeline.clj:100)

at metabase.driver.sql_jdbc.execute$execute_reducible_query$fn__87276.invoke(execute.clj:725)

at metabase.driver.h2$fn__90052$fn__90054.invoke(h2.clj:543)

at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87050__87051.invokeStatic(execute.clj:338)

at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87050__87051.invoke(execute.clj:321)

at metabase.driver.h2$fn__90052.invokeStatic(h2.clj:534)

at metabase.driver.h2$fn__90052.invoke(h2.clj:530)

at clojure.lang.MultiFn.invoke(MultiFn.java:244)

at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)

at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)

at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)

at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)

at metabase.driver.sql_jdbc$fn__113467.invokeStatic(sql_jdbc.clj:79)

at metabase.driver.sql_jdbc$fn__113467.invoke(sql_jdbc.clj:77)

at metabase.driver.h2$fn__89891.invokeStatic(h2.clj:271)

at metabase.driver.h2$fn__89891.invoke(h2.clj:267)

at clojure.lang.MultiFn.invoke(MultiFn.java:244)

at metabase.query_processor.pipeline$STAR_execute_STAR.invokeStatic(pipeline.clj:52)

at metabase.query_processor.pipeline$STAR_execute_STAR.invoke(pipeline.clj:39)

at metabase.query_processor.pipeline$STAR_run_STAR.invokeStatic(pipeline.clj:102)

at metabase.query_processor.pipeline$STAR_run_STAR.invoke(pipeline.clj:95)

at metabase.query_processor.execute$run.invokeStatic(execute.clj:62)

at metabase.query_processor.execute$run.invoke(execute.clj:56)

at metabase.query_processor.middleware.update_used_cards$update_used_cards_BANG_76938__76939$fn__76940.invoke(update_used_cards.clj:60)

at metabase.query_processor.execute$add_native_form_to_result_metadata$fn__76955.invoke(execute.clj:25)

at metabase.query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__76961.invoke(execute.clj:36)

at metabase.query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___76911.invoke(cache.clj:241)

at metabase.query_processor.middleware.permissions$check_query_permissions$fn__73948.invoke(permissions.clj:148)

at metabase.query_processor.middleware.enterprise$check_download_permissions_middleware$fn__74659.invoke(enterprise.clj:51)

at metabase.query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__74669.invoke(enterprise.clj:64)

at metabase.query_processor.execute$execute76988__76989$fn__76990.invoke(execute.clj:94)

at metabase.query_processor.setup$do_with_qp_setup75184__75185.invokeStatic(setup.clj:225)

at metabase.query_processor.setup$do_with_qp_setup75184__75185.invoke(setup.clj:216)

at metabase.query_processor.execute$execute76988__76989.invokeStatic(execute.clj:93)

at metabase.query_processor.execute$execute76988__76989.invoke(execute.clj:89)

at metabase.query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)

at metabase.query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)

at metabase.query_processor.middleware.enterprise$fn__74686$handle_audit_app_internal_queries__74687$fn__74689.invoke(enterprise.clj:96)

at metabase.query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__74697.invoke(enterprise.clj:103)

at metabase.query_processor.middleware.process_userland_query$process_userland_query_middleware77844__77845$fn__77846.invoke(process_userland_query.clj:204)

at metabase.query_processor.middleware.catch_exceptions$catch_exceptions77909__77910$fn__77911.invoke(catch_exceptions.clj:132)

at metabase.query_processor$process_query77950__77951$fn__77952.invoke(query_processor.clj:80)

at metabase.query_processor.setup$do_with_canceled_chan75179__75180$fn__75181.invoke(setup.clj:187)

at metabase.query_processor.setup$do_with_database_local_settings75172__75173$fn__75174.invoke(setup.clj:181)

at metabase.query_processor.setup$do_with_driver75165__75166$fn__75167$fn__75168.invoke(setup.clj:166)

at metabase.driver$do_with_driver.invokeStatic(driver.clj:106)

at metabase.driver$do_with_driver.invoke(driver.clj:101)

at metabase.query_processor.setup$do_with_driver75165__75166$fn__75167.invoke(setup.clj:165)

at metabase.query_processor.setup$do_with_metadata_provider75156__75157$fn__75158$fn__75161.invoke(setup.clj:151)

at metabase.query_processor.store$do_with_metadata_provider58679__58680.invokeStatic(store.clj:170)

at metabase.query_processor.store$do_with_metadata_provider58679__58680.invoke(store.clj:150)

at metabase.query_processor.store$do_with_metadata_provider58679__58680.invokeStatic(store.clj:159)

at metabase.query_processor.store$do_with_metadata_provider58679__58680.invoke(store.clj:150)

at metabase.query_processor.setup$do_with_metadata_provider75156__75157$fn__75158.invoke(setup.clj:150)

at metabase.query_processor.setup$do_with_resolved_database75146__75147$fn__75148.invoke(setup.clj:128)

at metabase.query_processor.setup$do_with_qp_setup75184__75185.invokeStatic(setup.clj:232)

at metabase.query_processor.setup$do_with_qp_setup75184__75185.invoke(setup.clj:216)

at metabase.query_processor$process_query77950__77951.invokeStatic(query_processor.clj:78)

at metabase.query_processor$process_query77950__77951.invoke(query_processor.clj:71)

at metabase.query_processor.card$process_query_for_card_default_qp87524__87525.invokeStatic(card.clj:186)

at metabase.query_processor.card$process_query_for_card_default_qp87524__87525.invoke(card.clj:182)

at metabase.api.public$process_query_for_card_with_id_run_fn$run__101638$fn__101639$fn__101640.invoke(public.clj:140)

at metabase.server.middleware.session$do_with_current_user.invokeStatic(session.clj:438)

at metabase.server.middleware.session$do_with_current_user.invoke(session.clj:421)

at metabase.api.public$process_query_for_card_with_id_run_fn$run__101638$fn__101639.invoke(public.clj:139)

at metabase.query_processor.streaming$_streaming_response$fn__61522$fn__61523$fn__61524.invoke(streaming.clj:175)

at metabase.query_processor.streaming$_streaming_response$fn__61522$fn__61523.invoke(streaming.clj:173)

at metabase.query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:164)

at metabase.query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:151)

at metabase.query_processor.streaming$_streaming_response$fn__61522.invoke(streaming.clj:170)

at clojure.lang.AFn.applyToHelper(AFn.java:156)

at clojure.lang.AFn.applyTo(AFn.java:144)

at clojure.core$apply.invokeStatic(core.clj:667)

at clojure.core$with_bindings_STAR_.invokeStatic(core.clj:1990)

at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1990)

at clojure.lang.RestFn.applyTo(RestFn.java:145)

at clojure.core$apply.invokeStatic(core.clj:671)

at clojure.core$bound_fn_STAR_$fn__5837.doInvoke(core.clj:2020)

at clojure.lang.RestFn.invoke(RestFn.java:424)

at metabase.async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)

at metabase.async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)

at metabase.async.streaming_response$do_f_async$task__53163.invoke(streaming_response.clj:97)

at clojure.lang.AFn.run(AFn.java:22)

at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)

at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)

at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)

at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)

at java.base/java.lang.Thread.run(Thread.java:829)

Caused by: java.io.IOException: Broken pipe

at java.base/sun.nio.ch.FileDispatcherImpl.writev0(Native Method)

at java.base/sun.nio.ch.SocketDispatcher.writev(SocketDispatcher.java:51)

at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:182)

at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:130)

at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:493)

at java.base/java.nio.channels.SocketChannel.write(SocketChannel.java:507)

at org.eclipse.jetty.io.SocketChannelEndPoint.flush(SocketChannelEndPoint.java:110)

... 114 more

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-09-16"",
      ""tag"": ""v0.50.26"",
      ""hash"": ""5a65f46""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.32""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8-post-Ubuntu-1ubuntu322.04"",
    ""java.vendor"": ""Ubuntu"",
    ""java.vendor.url"": ""https://ubuntu.com/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8-post-Ubuntu-1ubuntu322.04"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.5.0-1022-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```

### Severity

Medium

### Additional context

_No response_",neilmcguigan,2024-12-03 00:16:15+00:00,[],2025-02-04 20:27:57+00:00,,https://github.com/metabase/metabase/issues/50764,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Backend', ''), ('Embedding/Public', 'Simple public iframe embeds'), ('.Team/Querying', '')]","[{'comment_id': 2515318432, 'issue_id': 2713664546, 'author': 'paoliniluis', 'body': 'do you have an IDS/IPS or something that interferes with the connection?', 'created_at': datetime.datetime(2024, 12, 3, 18, 39, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2515878053, 'issue_id': 2713664546, 'author': 'neilmcguigan', 'body': '> do you have an IDS/IPS or something that interferes with the connection?\n\nno. this happens locally (macbook) as well as in prod (ubuntu/aws/cloudflare)\n\nhappens behind nginx or not\n\nthx', 'created_at': datetime.datetime(2024, 12, 4, 0, 38, 33, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-03 18:39:17 UTC): do you have an IDS/IPS or something that interferes with the connection?

neilmcguigan (Issue Creator) on (2024-12-04 00:38:33 UTC): no. this happens locally (macbook) as well as in prod (ubuntu/aws/cloudflare)

happens behind nginx or not

thx

"
2713544368,issue,closed,completed,"[BE, QP] Add `during` MBQL sugar function","For `=` (i.e. ""On"") date filters, when there is time, we add temporal bucketing by minute to ignore/round seconds. This is done like this: `[""="", [""field"", 1, { ""base-type"": ""type/DateTime"", ""temporal-unit: ""minute"" }, ""2020-01-01T10:20:00""]`, which would match not only `2020-01-01T10:20:00` but also `2020-01-01T10:20:10` etc. To preserve this feature we can add a new MBQL sugar function called `during`, i.e. `[""during"" [""field"" ...] ""2020-01-01"" ""minute""]`. We only need minute for now. See the [slack message](https://metaboat.slack.com/archives/C0645JP1W81/p1730471253160149?thread_ts=1730467651.820909&cid=C0645JP1W81) for details.",metamben,2024-12-02 22:36:50+00:00,['metamben'],2025-01-27 22:14:04+00:00,2024-12-05 19:31:23+00:00,https://github.com/metabase/metabase/issues/50763,[],[],
2713385704,issue,open,,Admin Settings Facelift - Milestone 2,"```[tasklist]
### Milestone 2: Implement new settings design
- [ ] new shared UI components
- [ ] update settings top nav design
- [ ] update settings sidebar design
- [ ] update settings pages designs
```",iethree,2024-12-02 21:05:37+00:00,[],2024-12-02 21:06:21+00:00,,https://github.com/metabase/metabase/issues/50759,[],[],
2713385290,issue,open,,Admin Settings Facelift - Milestone 1,"```[tasklist]
### Milestone 1: Refactor existing settings
- [ ] setup RTK to handle settings
- [ ] https://github.com/metabase/metabase/issues/47566
- [ ] Update settings sidebar to use react components instead of data structure
- [ ] Update settings header to use react components instead of data structure
- [ ] basic mantine settings components
- [ ] convert settings to use mantine components and hooks
- [ ] update SettingsEditor component
```",iethree,2024-12-02 21:05:23+00:00,[],2024-12-02 21:17:26+00:00,,https://github.com/metabase/metabase/issues/50758,[],[],
2713210242,issue,closed,completed,Confusing error message when trying to add a custom expression aggregation,"### Describe the bug

This is a primitive scenario when I add a custom expression referencing some columns but forget to add aggregation function
![Image](https://github.com/user-attachments/assets/d382b969-05e5-45a3-b016-902d11f38d65)
I got the error that there is no such metric highlighting the column name, but that obviously incorrect, the column exists.

### To Reproduce

1. Go to + New question
2. Pick Orders from Sample database
3. Click on Pick a function or metric
4. Click on Custom Expression
5. Start typing a column name, like Subtotal, pick from suggestions
6. Move the focus to the Name field
7. Get the message `Unknown Metric: Subtotal`


### Expected behavior

The message should be like `No aggregation found in: Subtotal. Use functions like Sum() or custom Metrics

### Logs

_No response_

### Information about your Metabase installation

```JSON
06d1ba2ae111e66253209c01c244d6379acfc6dcb1911fa9ab6012cec9ce52e5
```

### Severity

Very confusing

### Additional context

_No response_",mngr,2024-12-02 19:57:52+00:00,['kamilmielnik'],2025-01-17 08:12:58+00:00,2025-01-17 07:36:50+00:00,https://github.com/metabase/metabase/issues/50753,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Querying/Notebook/Custom Expression', ''), ('.Team/Querying', '')]",[],
2712752483,issue,open,,Support border-radius customization for buttons,"**Is your feature request related to a problem? Please describe.**
A prospect has indicated they would probably like to customize the border radius of buttons.

**Describe the solution you'd like**
Specify border radius in the SDK thjeme

**Describe alternatives you've considered**
Let developers implement their own buttons, but this workaround seems heavy on effort for the task at hand.

**How important is this feature to you?**

**Additional context**
Add any other context or screenshots about the feature request here.
",albertoperdomo,2024-12-02 17:31:03+00:00,[],2025-02-04 20:30:30+00:00,,https://github.com/metabase/metabase/issues/50748,"[('Type:New Feature', ''), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2712702927,issue,open,reopened,Script that loads the bug report and process its details to recreate the user's meaningful environment entities,orignally part of https://github.com/metabase/metabase/issues/50627,escherize,2024-12-02 17:11:15+00:00,[],2025-01-30 13:41:44+00:00,,https://github.com/metabase/metabase/issues/50746,[],"[{'comment_id': 2530848492, 'issue_id': 2712702927, 'author': 'thebiglabasky', 'body': 'Cool, marked https://github.com/metabase/metabase/issues/50627 as parent then', 'created_at': datetime.datetime(2024, 12, 10, 8, 52, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2624539446, 'issue_id': 2712702927, 'author': 'thebiglabasky', 'body': 'Closing since this is nowhere to be tackled for now', 'created_at': datetime.datetime(2025, 1, 30, 13, 37, 1, tzinfo=datetime.timezone.utc)}]","thebiglabasky on (2024-12-10 08:52:16 UTC): Cool, marked https://github.com/metabase/metabase/issues/50627 as parent then

thebiglabasky on (2025-01-30 13:37:01 UTC): Closing since this is nowhere to be tackled for now

"
2712413951,issue,open,,Release notes in Docs,,iethree,2024-12-02 15:46:39+00:00,[],2024-12-02 15:46:39+00:00,,https://github.com/metabase/metabase/issues/50742,[],[],
2712413514,issue,closed,completed,Dot X Releases,[Proposal Doc](https://www.notion.so/metabase/Dot-X-releases-13769354c90180239d37cd5c9ea87a46),iethree,2024-12-02 15:46:30+00:00,[],2025-01-13 19:53:04+00:00,2025-01-13 19:53:02+00:00,https://github.com/metabase/metabase/issues/50741,"[('.Building & Releasing', '')]","[{'comment_id': 2588062152, 'issue_id': 2712413514, 'author': 'iethree', 'body': 'done!', 'created_at': datetime.datetime(2025, 1, 13, 19, 53, 2, tzinfo=datetime.timezone.utc)}]","iethree (Issue Creator) on (2025-01-13 19:53:02 UTC): done!

"
2712292829,issue,closed,completed,"Clicking ""View more"" or ""View less"" triggers the filter popover","### Describe the bug

When checking out a card with overflowing text, we show a ""View more"" link to expand the contents. For some reason this also invokes ""click to filter"" behavior we also have in place on cards.

### To Reproduce

1. Go to [this dashboard](https://stats.metabase.com/dashboard/2705-october-2024-customer-survey-results?tab=1084-a-sample-of-surveys-to-read)
2. Click on View more
4. Notice the filter popover showing up

The same reproduces when opening this question standalone and manipulating with the Detail viz type

### Expected behavior

It'd be great to cancel the popover (or stop propagating the click event or whatever) when clicking on ""View more"" / ""View less"" to prevent showing filter modal.

### Logs

_No response_

### Information about your Metabase installation

```JSON
Internal (stats)
```

### Severity

Annoying but OK

### Additional context

_No response_",thebiglabasky,2024-12-02 15:16:39+00:00,['uladzimirdev'],2025-01-27 22:14:10+00:00,2024-12-03 21:15:39+00:00,https://github.com/metabase/metabase/issues/50738,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('.Team/Querying', '')]",[],
2712241713,issue,closed,completed,"[SDK] when components are rendered outside of the provider, they should not make the host app crash","We should be more ""permissive"" and avoid throwing errors when the sdk components are rendered outside of the SDK provider.
The reason we want to do this is that some frameworks may render the sdk components when when the provider is already unmounted.
I run into this two times when using the nextjs compat layer (that uses lazy loading)
- next app router when hot reloading
- next pages router when following a <Link> to a page that was already visited, the whole _app is unmounted and remounted

I believe the reason is that when using lazy loading, the provider will render children when the sdk is loading, I suppose when the sdk is already loaded, it may render for a ""frame"" the loading version of MetabaseProvider (which is basically a div) with the real sdk components",npretto,2024-12-02 14:56:54+00:00,['npretto'],2024-12-10 10:54:52+00:00,2024-12-09 16:12:29+00:00,https://github.com/metabase/metabase/issues/50736,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2711697012,issue,closed,completed,Segment filter misaligned in filter modal,"### Describe the bug

![Image](https://github.com/user-attachments/assets/5e53efe2-0ae3-4ac2-8b4c-4c8124476cee)


### To Reproduce



1. Create a Segment for Orders table
2. New > Question > Orders > Visualize
3. Open filter modal

 spacing in segment row is too large on the left

4. Change viewport width to 500px or less

 [segment icon shrinks](https://github.com/user-attachments/assets/7958caf7-7e2b-4592-b3c8-a84b28e72b23)

### Information about your Metabase installation

master, b26eca9

### Severity

P3

### Additional context

Check **embedding** scenarios when working on this",kamilmielnik,2024-12-02 12:00:10+00:00,['kamilmielnik'],2025-01-31 15:22:48+00:00,2025-01-31 14:32:37+00:00,https://github.com/metabase/metabase/issues/50734,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Difficulty:Easy', ''), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', '')]",[],
2711512119,issue,closed,completed,"Fix ""jump to debugger"" button in slack",,filiphric,2024-12-02 11:01:18+00:00,['filiphric'],2024-12-12 14:22:26+00:00,2024-12-12 14:22:26+00:00,https://github.com/metabase/metabase/issues/50732,[],[],
2711449593,issue,open,,Field tooltip text overflowing in filter modal,"### Describe the bug

![Image](https://github.com/user-attachments/assets/09c61909-6f7f-443b-af56-0e4538c0497a)


### To Reproduce

1. New > Question > Orders > Visualize
2. Open filter modal
3. Change viewport width to 900px or less
4. Hover ""i"" icons of various fields to see tooltip text overflowing its visual container

### Information about your Metabase installation

master, b26eca90b9

### Severity

P3
",kamilmielnik,2024-12-02 10:46:25+00:00,['kamilmielnik'],2025-02-04 20:27:32+00:00,,https://github.com/metabase/metabase/issues/50731,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', '')]",[],
2710943748,issue,closed,completed,Make fields in Slack message more useful,"Slack message now contains some information that is not that useful as pointed out by Vamsi [here](https://metaboat.slack.com/archives/C0834B8DXKK/p1733091458908679?thread_ts=1733091128.380919&cid=C0834B8DXKK). We should get rid of the fields that dont contain useful information

EDIT: Specifically, we need to:

Add:
* Reporter identity (name / email would be ideal)

Remove:
* App database
* Java Runtime
* Java Version
* OS Name
* OS Version
* Version info",filiphric,2024-12-02 07:58:41+00:00,['thebiglabasky'],2025-01-23 08:58:58+00:00,2025-01-22 16:13:44+00:00,https://github.com/metabase/metabase/issues/50727,[],"[{'comment_id': 2607669251, 'issue_id': 2710943748, 'author': 'thebiglabasky', 'body': 'Done via #52296', 'created_at': datetime.datetime(2025, 1, 22, 16, 13, 44, tzinfo=datetime.timezone.utc)}]","thebiglabasky (Assginee) on (2025-01-22 16:13:44 UTC): Done via #52296

"
2710825210,issue,closed,completed,Resource leak during automated report generation (subscriptions),"### Describe the bug

At 08:00 (local time) a lot of automated reports are generated for subscriptions in our Metabase install. It seems every day Metabase leaks some resources when this happens. Until the point where Metabase can't really function anymore due to GC pressure and has to be restarted.

![Image](https://github.com/user-attachments/assets/3de70c8a-b7fb-44b1-9985-64788d64aacd)

As far as I can tell this resource leak seems to be only present for the report generation for subscriptions.

I took a quick look with Eclipse MAT which seems to imply this is related to the generation of SVG's. The following screenshot is from Eclipse MAT when Metabase has been running for a couple of days. There was no activity (no visitors, no subscription report generation, etc.) at the time the heap dump was made:

![Image](https://github.com/user-attachments/assets/e6c9c05f-d429-49f9-ba9f-fe1eda01d9f8)

![Image](https://github.com/user-attachments/assets/7372aee3-b868-441b-8d7f-face4e0b0b31)

If your interested I can send the heap dump via a private channel.


### To Reproduce

I haven't been able to create a standalone reproducer.

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64; rv:133.0) Gecko/20100101 Firefox/133.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-15"",
      ""tag"": ""v0.50.35-SNAPSHOT"",
      ""hash"": ""cd31b54""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Amsterdam""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.13""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.3-internal-adhoc.pkgsrc.jdk-il-jdk-21.0.3-ga"",
    ""java.vendor"": ""N/A"",
    ""java.vendor.url"": ""https://openjdk.org/"",
    ""java.version"": ""21.0.3-internal"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.3-internal-adhoc.pkgsrc.jdk-il-jdk-21.0.3-ga"",
    ""os.name"": ""SunOS"",
    ""os.version"": ""5.11"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Europe/Amsterdam""
  }
}
```

### Severity

Medium

### Additional context

_No response_",siepkes,2024-12-02 07:22:30+00:00,[],2025-01-06 00:36:31+00:00,2025-01-06 00:36:30+00:00,https://github.com/metabase/metabase/issues/50726,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Pulses', 'Now called Subscriptions'), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2511858050, 'issue_id': 2710825210, 'author': 'paoliniluis', 'body': '@siepkes just curious: are you running Metabase on Solaris?', 'created_at': datetime.datetime(2024, 12, 2, 15, 31, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2512424995, 'issue_id': 2710825210, 'author': 'siepkes', 'body': '@paoliniluis Solar-ish ;-) We are using [Triton datacenter](https://www.tritondatacenter.com/) for a private cloud (hardware in a DC) which is based on [illumos](https://illumos.org/). illumos is the opensource fork of Solaris after Solaris went closed source again after Oracle bought Sun. illumos is also the base for the OS the [Oxide](https://oxide.computer/) people use.', 'created_at': datetime.datetime(2024, 12, 2, 18, 49, 8, tzinfo=datetime.timezone.utc)}, {'comment_id': 2564860819, 'issue_id': 2710825210, 'author': 'paoliniluis', 'body': '@siepkes we have a PR almost ready to ship, will you be able to test it?', 'created_at': datetime.datetime(2024, 12, 29, 23, 3, 44, tzinfo=datetime.timezone.utc)}, {'comment_id': 2565059762, 'issue_id': 2710825210, 'author': 'siepkes', 'body': 'Yes, definitely! I assume you want me to test https://github.com/metabase/metabase/pull/51685 ?', 'created_at': datetime.datetime(2024, 12, 30, 6, 6, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2565663158, 'issue_id': 2710825210, 'author': 'paoliniluis', 'body': '@siepkes yes, do you know how to make a custom build?', 'created_at': datetime.datetime(2024, 12, 30, 16, 4, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2565676065, 'issue_id': 2710825210, 'author': 'siepkes', 'body': 'Yes, I backported the patch onto the `0.52.4` release and deployed it. It will probably take a couple of days to see if the memory usage does not gradually increase anymore.', 'created_at': datetime.datetime(2024, 12, 30, 16, 16, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2566912234, 'issue_id': 2710825210, 'author': 'siepkes', 'body': ""First of all, best wishes to everyone! \n\nBit to soon to tell if the problem is a 100% solved but the results look good so far.\n\n![Image](https://github.com/user-attachments/assets/d293e597-6410-47c3-af26-1ca3fbf32429)\n\nAt point 1 the application was rebooted (hence the drop in heap size). Point 2 is the first reports being generated and send at 07:00. There is a bit of an increase in heap size after Metabase is done, but that seems normal to me the first time those code paths are activated. Point 3 is the second time reports are generated at 07:00. The heap size returns to normal after it's done generating the reports.\n\nI will keep monitoring this for a couple days."", 'created_at': datetime.datetime(2025, 1, 1, 8, 45, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2571416822, 'issue_id': 2710825210, 'author': 'siepkes', 'body': 'The memory usage seems to remain constant so I think by now we can say [this](https://github.com/metabase/metabase/pull/51685) fixes this issue!\n\n![Image](https://github.com/user-attachments/assets/38d34083-a07f-448a-8285-eee06a59f48c)', 'created_at': datetime.datetime(2025, 1, 4, 21, 31, 6, tzinfo=datetime.timezone.utc)}, {'comment_id': 2571819474, 'issue_id': 2710825210, 'author': 'paoliniluis', 'body': 'great news, closing', 'created_at': datetime.datetime(2025, 1, 6, 0, 36, 30, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-02 15:31:27 UTC): @siepkes just curious: are you running Metabase on Solaris?

siepkes (Issue Creator) on (2024-12-02 18:49:08 UTC): @paoliniluis Solar-ish ;-) We are using [Triton datacenter](https://www.tritondatacenter.com/) for a private cloud (hardware in a DC) which is based on [illumos](https://illumos.org/). illumos is the opensource fork of Solaris after Solaris went closed source again after Oracle bought Sun. illumos is also the base for the OS the [Oxide](https://oxide.computer/) people use.

paoliniluis on (2024-12-29 23:03:44 UTC): @siepkes we have a PR almost ready to ship, will you be able to test it?

siepkes (Issue Creator) on (2024-12-30 06:06:04 UTC): Yes, definitely! I assume you want me to test https://github.com/metabase/metabase/pull/51685 ?

paoliniluis on (2024-12-30 16:04:34 UTC): @siepkes yes, do you know how to make a custom build?

siepkes (Issue Creator) on (2024-12-30 16:16:39 UTC): Yes, I backported the patch onto the `0.52.4` release and deployed it. It will probably take a couple of days to see if the memory usage does not gradually increase anymore.

siepkes (Issue Creator) on (2025-01-01 08:45:27 UTC): First of all, best wishes to everyone! 

Bit to soon to tell if the problem is a 100% solved but the results look good so far.

![Image](https://github.com/user-attachments/assets/d293e597-6410-47c3-af26-1ca3fbf32429)

At point 1 the application was rebooted (hence the drop in heap size). Point 2 is the first reports being generated and send at 07:00. There is a bit of an increase in heap size after Metabase is done, but that seems normal to me the first time those code paths are activated. Point 3 is the second time reports are generated at 07:00. The heap size returns to normal after it's done generating the reports.

I will keep monitoring this for a couple days.

siepkes (Issue Creator) on (2025-01-04 21:31:06 UTC): The memory usage seems to remain constant so I think by now we can say [this](https://github.com/metabase/metabase/pull/51685) fixes this issue!

![Image](https://github.com/user-attachments/assets/38d34083-a07f-448a-8285-eee06a59f48c)

paoliniluis on (2025-01-06 00:36:30 UTC): great news, closing

"
2710337102,issue,open,,"Filtering on a timestamp that's aggregated by minute will return ""no results""","### Describe the bug

Confusing bug that leads to a wrong query and some users pulling their hair

### To Reproduce

1) go to orders table
2) click on any timestamp on the created_at field, and use the ""on"" filter... it works
3) now go to the notebook and aggregate by minute the sum of total (display a table)
![Image](https://github.com/user-attachments/assets/6be55878-5f84-405b-a408-ab6bba5cf103)
![Image](https://github.com/user-attachments/assets/7d56bb6a-4b5a-41c2-a613-22a233594689)
4) now click on any timestamp and use the ""on"" filter... see no values


### Expected behavior

You should be able to get the exact line that you clicked on

### Logs

NA

### Information about your Metabase installation

```JSON
v50.x
```

### Severity

P2

### Additional context

_No response_",paoliniluis,2024-12-02 03:18:20+00:00,[],2025-02-04 20:27:13+00:00,,https://github.com/metabase/metabase/issues/50722,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/MBQL', ''), ('.Backend', ''), ('Querying/Drill Thrus', 'Refining existing queries with Drill Thrus'), ('.Team/Querying', '')]","[{'comment_id': 2510670547, 'issue_id': 2710337102, 'author': 'WiNloSt', 'body': ""Not reproducible on either 1.50.34 or 1.51.6, so it's not a regression"", 'created_at': datetime.datetime(2024, 12, 2, 6, 18, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2569539574, 'issue_id': 2710337102, 'author': 'ranquild', 'body': '`quick-filter` drill should take the temporal unit / binning strategy into account when adding a filter.', 'created_at': datetime.datetime(2025, 1, 3, 16, 57, 35, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2024-12-02 06:18:35 UTC): Not reproducible on either 1.50.34 or 1.51.6, so it's not a regression

ranquild on (2025-01-03 16:57:35 UTC): `quick-filter` drill should take the temporal unit / binning strategy into account when adding a filter.

"
2710236958,issue,closed,completed,logging seems to be broken on master,"### Describe the bug

There's no logging:

Trying on both 

```shell
 java -version
openjdk version ""11.0.25"" 2024-10-15
OpenJDK Runtime Environment Temurin-11.0.25+9 (build 11.0.25+9)
OpenJDK 64-Bit Server VM Temurin-11.0.25+9 (build 11.0.25+9, mixed mode)
```
and

```shell
 java -version
openjdk version ""21.0.2"" 2024-01-16 LTS
OpenJDK Runtime Environment Temurin-21.0.2+13 (build 21.0.2+13-LTS)
OpenJDK 64-Bit Server VM Temurin-21.0.2+13 (build 21.0.2+13-LTS, mixed mode)
```

Here's the output of running a jar from master as of today:

(note: this is a fresh install)
```shell
 MB_JETTY_PORT=3006 java -jar metabase.jar
Warning: environ value /Users/dan/.sdkman/candidates/java/current for key :java-home has been overwritten with /Users/dan/.sdkman/candidates/java/21.0.2-tem
2024-12-02T02:21:03.533582Z main ERROR Unrecognized format specifier [d]
2024-12-02T02:21:03.534516Z main ERROR Unrecognized conversion specifier [d] starting at position 16 in conversion pattern.
2024-12-02T02:21:03.535144Z main ERROR Unrecognized format specifier [thread]
2024-12-02T02:21:03.535242Z main ERROR Unrecognized conversion specifier [thread] starting at position 25 in conversion pattern.
2024-12-02T02:21:03.535347Z main ERROR Unrecognized format specifier [level]
2024-12-02T02:21:03.535437Z main ERROR Unrecognized conversion specifier [level] starting at position 35 in conversion pattern.
2024-12-02T02:21:03.535540Z main ERROR Unrecognized format specifier [logger]
2024-12-02T02:21:03.535625Z main ERROR Unrecognized conversion specifier [logger] starting at position 47 in conversion pattern.
2024-12-02T02:21:03.535713Z main ERROR Unrecognized format specifier [msg]
2024-12-02T02:21:03.535798Z main ERROR Unrecognized conversion specifier [msg] starting at position 54 in conversion pattern.
2024-12-02T02:21:03.535886Z main ERROR Unrecognized format specifier [n]
2024-12-02T02:21:03.535969Z main ERROR Unrecognized conversion specifier [n] starting at position 56 in conversion pattern.
2024-12-02T02:21:03.545052Z main ERROR Reconfiguration failed: No configuration found for 'Default' at 'null' in 'null'
WARNING: infinite? already refers to: #'clojure.core/infinite? in namespace: kixi.stats.core, being replaced by: #'kixi.stats.math/infinite?

UPDATE SUMMARY
Run:                        436
Previously run:               0
Filtered out:                52
-------------------------------
Total change sets:          488


FILTERED CHANGE SETS SUMMARY
DBMS mismatch:               52

```

### To Reproduce

grab a jar and `MB_JETTY_PORT=3006 java -jar metabase.jar`

### Expected behavior

lots of logs

### Logs

there are no logs. See above.

### Information about your Metabase installation

```JSON
latest master, from https://github.com/metabase/metabase/actions/runs/12098926495
```

### Severity

p1

### Additional context

_No response_",dpsutton,2024-12-02 02:25:30+00:00,[],2025-01-27 22:14:12+00:00,2024-12-03 15:08:27+00:00,https://github.com/metabase/metabase/issues/50721,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Team/DevEx', '')]","[{'comment_id': 2510436604, 'issue_id': 2710236958, 'author': 'dpsutton', 'body': 'It should be noted that on master when running from source you will see good logs:\n\n```\n2024-12-02 02:27:28,372 INFO jdbcjobstore.JobStoreTX :: ClusterManager: ......Cleaned-up 2 other failed job(s).\n2024-12-02 02:27:28,373 INFO core.QuartzScheduler :: Scheduler MetabaseScheduler_$_mbp-m1.lan1733106446855 started.\n2024-12-02 02:27:28,373 INFO metabase.task :: Task scheduler started\n2024-12-02 02:27:28,374 INFO jdbcjobstore.JobStoreTX :: Handling 9 trigger(s) that missed their scheduled fire-time.\n2024-12-02 02:27:28,400 INFO task.sweep-query-analysis :: Calculating analysis for cards without any\n2024-12-02 02:27:28,412 INFO task.sweep-query-analysis :: Recalculating potentially stale analysis\n2024-12-02 02:27:28,447 INFO task.refresh-slack-channel-user-cache :: Slack is not configured, not refreshing slack user/channel cache.\n2024-12-02 02:27:28,528 INFO task.sync-databases :: Not scheduling tasks for audit database\n2024-12-02 02:27:28,548 INFO metabase.core :: Metabase Initialization COMPLETE in 51.5 s\n2024-12-02 02:27:28,559 INFO metabase.events :: Loading events namespace: metabase.events.alerts-deleted-on-card-save \n2024-12-02 02:27:28,592 INFO metabase.events :: Loading events namespace: metabase.events.audit-log \n""malli: dev-mode started\\n""\ndev=> 2024-12-02 02:27:28,713 INFO metabase.events :: Loading events namespace: metabase.events.driver-notifications \n2024-12-02 02:27:28,727 INFO metabase.events :: Loading events namespace: metabase.events.last-login \n2024-12-02 02:27:28,737 INFO metabase.events :: Loading events namespace: metabase.events.notification \n2024-12-02 02:27:28,737 INFO metabase.events :: Loading events namespace: metabase.events.persisted-info \n2024-12-02 02:27:28,751 INFO metabase.events :: Loading events namespace: metabase.events.recent-views \n2024-12-02 02:27:28,779 INFO metabase.events :: Loading events namespace: metabase.events.revision \n2024-12-02 02:27:28,809 INFO metabase.events :: Loading events namespace: metabase.events.schema \n2024-12-02 02:27:28,810 INFO metabase.events :: Loading events namespace: metabase.events.slack \n2024-12-02 02:27:28,817 INFO metabase.events :: Loading events namespace: metabase.events.sync-database \n```\n\nI suspect that this might be related to the build changes to switch over from depstar:\n\nArtifacts from that PR are found here: https://github.com/metabase/metabase/actions/runs/12053514467\nand from before that PR are here: https://github.com/metabase/metabase/actions/runs/12051136822\n\nAfter the change we have\n```\n MB_JETTY_PORT=3006 java -jar metabase.jar\n2024-12-02T02:31:09.863769Z main ERROR Unrecognized format specifier [d]\n2024-12-02T02:31:09.864992Z main ERROR Unrecognized conversion specifier [d] starting at position 16 in conversion pattern.\n2024-12-02T02:31:09.865733Z main ERROR Unrecognized format specifier [thread]\n2024-12-02T02:31:09.865866Z main ERROR Unrecognized conversion specifier [thread] starting at position 25 in conversion pattern.\n2024-12-02T02:31:09.865974Z main ERROR Unrecognized format specifier [level]\n2024-12-02T02:31:09.866067Z main ERROR Unrecognized conversion specifier [level] starting at position 35 in conversion pattern.\n2024-12-02T02:31:09.866181Z main ERROR Unrecognized format specifier [logger]\n2024-12-02T02:31:09.866286Z main ERROR Unrecognized conversion specifier [logger] starting at position 47 in conversion pattern.\n2024-12-02T02:31:09.866388Z main ERROR Unrecognized format specifier [msg]\n2024-12-02T02:31:09.866498Z main ERROR Unrecognized conversion specifier [msg] starting at position 54 in conversion pattern.\n2024-12-02T02:31:09.866605Z main ERROR Unrecognized format specifier [n]\n2024-12-02T02:31:09.866709Z main ERROR Unrecognized conversion specifier [n] starting at position 56 in conversion pattern.\n2024-12-02T02:31:09.877554Z main ERROR Reconfiguration failed: No configuration found for \'Default\' at \'null\' in \'null\'\nWARNING: infinite? already refers to: #\'kixi.stats.math/infinite? in namespace: kixi.stats.core, being replaced by: #\'clojure.core/infinite?\n```\n\nand before that change we have\n\n```\n MB_JETTY_PORT=3007 java -jar metabase.jar\nWarning: environ value /Users/dan/.sdkman/candidates/java/current for key :java-home has been overwritten with /Users/dan/.sdkman/candidates/java/21.0.2-tem\n2024-12-01 20:31:53,560 INFO metabase.util :: Maximum memory available to JVM: 8.0 GB\n2024-12-01 20:31:54,741 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance. \n For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html\n2024-12-01 20:31:55,182 WARN db.env :: WARNING: Using Metabase with an H2 application database is not recommended for production deployments. For production deployments, we highly recommend using Postgres, MySQL, or MariaDB instead. If you decide to continue to use H2, please be sure to back up the database file regularly. For more information, see https://metabase.com/docs/latest/operations-guide/migrating-from-h2.html\nWARNING: infinite? already refers to: #\'kixi.stats.math/infinite? in namespace: kixi.stats.core, being replaced by: #\'clojure.core/infinite?\n2024-12-01 20:31:57,745 INFO driver.impl :: Registered abstract driver :sql  \n2024-12-01 20:31:57,767 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql]) \n2024-12-01 20:31:57,770 INFO metabase.util :: Load driver :sql-jdbc took 7.4 ms\n2024-12-01 20:31:57,770 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc]) \n2024-12-01 20:31:57,895 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc]) \n2024-12-01 20:31:57,914 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc]) \n```', 'created_at': datetime.datetime(2024, 12, 2, 2, 32, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2510458867, 'issue_id': 2710236958, 'author': 'dpsutton', 'body': 'Based on https://stackoverflow.com/questions/48033792/log4j2-error-statuslogger-unrecognized-conversion-specifier I think depstar was merged this stuff for us for free in the past.\n\nIn the ""after"" jar the `META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.dat` is 3247 bytes. In the ""before"" it is `28463` bytes long.\n\nSee the workaround: https://github.com/seancorfield/depstar/blob/develop/src/hf/depstar/uberjar.clj#L151-L166\n\nI think we can use https://github.com/seancorfield/build-uber-log4j2-handler to help us get there.', 'created_at': datetime.datetime(2024, 12, 2, 2, 54, 57, tzinfo=datetime.timezone.utc)}]","dpsutton (Issue Creator) on (2024-12-02 02:32:43 UTC): It should be noted that on master when running from source you will see good logs:

```
2024-12-02 02:27:28,372 INFO jdbcjobstore.JobStoreTX :: ClusterManager: ......Cleaned-up 2 other failed job(s).
2024-12-02 02:27:28,373 INFO core.QuartzScheduler :: Scheduler MetabaseScheduler_$_mbp-m1.lan1733106446855 started.
2024-12-02 02:27:28,373 INFO metabase.task :: Task scheduler started
2024-12-02 02:27:28,374 INFO jdbcjobstore.JobStoreTX :: Handling 9 trigger(s) that missed their scheduled fire-time.
2024-12-02 02:27:28,400 INFO task.sweep-query-analysis :: Calculating analysis for cards without any
2024-12-02 02:27:28,412 INFO task.sweep-query-analysis :: Recalculating potentially stale analysis
2024-12-02 02:27:28,447 INFO task.refresh-slack-channel-user-cache :: Slack is not configured, not refreshing slack user/channel cache.
2024-12-02 02:27:28,528 INFO task.sync-databases :: Not scheduling tasks for audit database
2024-12-02 02:27:28,548 INFO metabase.core :: Metabase Initialization COMPLETE in 51.5 s
2024-12-02 02:27:28,559 INFO metabase.events :: Loading events namespace: metabase.events.alerts-deleted-on-card-save 
2024-12-02 02:27:28,592 INFO metabase.events :: Loading events namespace: metabase.events.audit-log 
""malli: dev-mode started\n""
dev=> 2024-12-02 02:27:28,713 INFO metabase.events :: Loading events namespace: metabase.events.driver-notifications 
2024-12-02 02:27:28,727 INFO metabase.events :: Loading events namespace: metabase.events.last-login 
2024-12-02 02:27:28,737 INFO metabase.events :: Loading events namespace: metabase.events.notification 
2024-12-02 02:27:28,737 INFO metabase.events :: Loading events namespace: metabase.events.persisted-info 
2024-12-02 02:27:28,751 INFO metabase.events :: Loading events namespace: metabase.events.recent-views 
2024-12-02 02:27:28,779 INFO metabase.events :: Loading events namespace: metabase.events.revision 
2024-12-02 02:27:28,809 INFO metabase.events :: Loading events namespace: metabase.events.schema 
2024-12-02 02:27:28,810 INFO metabase.events :: Loading events namespace: metabase.events.slack 
2024-12-02 02:27:28,817 INFO metabase.events :: Loading events namespace: metabase.events.sync-database 
```

I suspect that this might be related to the build changes to switch over from depstar:

Artifacts from that PR are found here: https://github.com/metabase/metabase/actions/runs/12053514467
and from before that PR are here: https://github.com/metabase/metabase/actions/runs/12051136822

After the change we have
```
 MB_JETTY_PORT=3006 java -jar metabase.jar
2024-12-02T02:31:09.863769Z main ERROR Unrecognized format specifier [d]
2024-12-02T02:31:09.864992Z main ERROR Unrecognized conversion specifier [d] starting at position 16 in conversion pattern.
2024-12-02T02:31:09.865733Z main ERROR Unrecognized format specifier [thread]
2024-12-02T02:31:09.865866Z main ERROR Unrecognized conversion specifier [thread] starting at position 25 in conversion pattern.
2024-12-02T02:31:09.865974Z main ERROR Unrecognized format specifier [level]
2024-12-02T02:31:09.866067Z main ERROR Unrecognized conversion specifier [level] starting at position 35 in conversion pattern.
2024-12-02T02:31:09.866181Z main ERROR Unrecognized format specifier [logger]
2024-12-02T02:31:09.866286Z main ERROR Unrecognized conversion specifier [logger] starting at position 47 in conversion pattern.
2024-12-02T02:31:09.866388Z main ERROR Unrecognized format specifier [msg]
2024-12-02T02:31:09.866498Z main ERROR Unrecognized conversion specifier [msg] starting at position 54 in conversion pattern.
2024-12-02T02:31:09.866605Z main ERROR Unrecognized format specifier [n]
2024-12-02T02:31:09.866709Z main ERROR Unrecognized conversion specifier [n] starting at position 56 in conversion pattern.
2024-12-02T02:31:09.877554Z main ERROR Reconfiguration failed: No configuration found for 'Default' at 'null' in 'null'
WARNING: infinite? already refers to: #'kixi.stats.math/infinite? in namespace: kixi.stats.core, being replaced by: #'clojure.core/infinite?
```

and before that change we have

```
 MB_JETTY_PORT=3007 java -jar metabase.jar
Warning: environ value /Users/dan/.sdkman/candidates/java/current for key :java-home has been overwritten with /Users/dan/.sdkman/candidates/java/21.0.2-tem
2024-12-01 20:31:53,560 INFO metabase.util :: Maximum memory available to JVM: 8.0 GB
2024-12-01 20:31:54,741 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance. 
 For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html
2024-12-01 20:31:55,182 WARN db.env :: WARNING: Using Metabase with an H2 application database is not recommended for production deployments. For production deployments, we highly recommend using Postgres, MySQL, or MariaDB instead. If you decide to continue to use H2, please be sure to back up the database file regularly. For more information, see https://metabase.com/docs/latest/operations-guide/migrating-from-h2.html
WARNING: infinite? already refers to: #'kixi.stats.math/infinite? in namespace: kixi.stats.core, being replaced by: #'clojure.core/infinite?
2024-12-01 20:31:57,745 INFO driver.impl :: Registered abstract driver :sql  
2024-12-01 20:31:57,767 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql]) 
2024-12-01 20:31:57,770 INFO metabase.util :: Load driver :sql-jdbc took 7.4 ms
2024-12-01 20:31:57,770 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc]) 
2024-12-01 20:31:57,895 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc]) 
2024-12-01 20:31:57,914 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc]) 
```

dpsutton (Issue Creator) on (2024-12-02 02:54:57 UTC): Based on https://stackoverflow.com/questions/48033792/log4j2-error-statuslogger-unrecognized-conversion-specifier I think depstar was merged this stuff for us for free in the past.

In the ""after"" jar the `META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.dat` is 3247 bytes. In the ""before"" it is `28463` bytes long.

See the workaround: https://github.com/seancorfield/depstar/blob/develop/src/hf/depstar/uberjar.clj#L151-L166

I think we can use https://github.com/seancorfield/build-uber-log4j2-handler to help us get there.

"
2709747421,issue,open,,Make the download button more obvious,"**Is your feature request related to a problem? Please describe.**
The 3 dots to download only appear if you hover over the card, but we should make this to appear as a download icon at all times (maybe)

**Describe the solution you'd like**
A download icon that appears on all cards at all times

**Describe alternatives you've considered**
Make a download in the parent app that uses the api and downloads the file

**How important is this feature to you?**
requested by a customer

**Additional context**
NA
",paoliniluis,2024-12-01 19:36:02+00:00,[],2025-02-04 20:30:35+00:00,,https://github.com/metabase/metabase/issues/50720,"[('Type:New Feature', ''), ('Embedding/Static', 'Static embedding, previously known as signed embedding')]","[{'comment_id': 2515273569, 'issue_id': 2709747421, 'author': 'itsdpao', 'body': 'Is there a way to make this download icon visible at all times, and more prominent? Clients have a hard time 1) knowing the download button exists, and 2) seeing the ellipsis menu', 'created_at': datetime.datetime(2024, 12, 3, 18, 16, 14, tzinfo=datetime.timezone.utc)}]","itsdpao on (2024-12-03 18:16:14 UTC): Is there a way to make this download icon visible at all times, and more prominent? Clients have a hard time 1) knowing the download button exists, and 2) seeing the ellipsis menu

"
2707273063,issue,open,,OFFSET function unavailable on MongoDB databases,"### Describe the bug

Until very recently, the function 'OFFSET' was noted in the official documentation as being unavailable only for MySQL/MariaDB databases. However, last week, I discovered that it has also become unavailable for MongoDB and Druid. This is a significant disappointment, as we were hopeful about upgrading to v51 to utilize this useful function. Is there any way to enable or work around this limitation?

![Image](https://github.com/user-attachments/assets/310349e8-5f99-46f5-8bea-44fb039e792d)


### To Reproduce

1. Create a new dashboard
2. use the OFFSET function in the Summarize section


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""mongo"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-25"",
      ""tag"": ""v0.51.4.5"",
      ""hash"": ""d72706b""
    },
    ""settings"": {
      ""report-timezone"": ""Iran""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.4 (Debian 14.4-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-71-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Annoying

### Additional context

_No response_",alfiwilo,2024-11-30 11:57:43+00:00,[],2025-02-04 20:30:56+00:00,,https://github.com/metabase/metabase/issues/50718,"[('Database/Mongo', None), ('Type:New Feature', ''), ('Querying/Notebook/Custom Expression', '')]","[{'comment_id': 2518342089, 'issue_id': 2707273063, 'author': 'alexyarosh', 'body': 'At this moment, documentation is correct. Offset was never available in MongoDB, but our docs used to omit this limitation. This should be a feature request instead.', 'created_at': datetime.datetime(2024, 12, 4, 19, 10, 47, tzinfo=datetime.timezone.utc)}]","alexyarosh on (2024-12-04 19:10:47 UTC): At this moment, documentation is correct. Offset was never available in MongoDB, but our docs used to omit this limitation. This should be a feature request instead.

"
2706333682,issue,closed,completed,Can't see views or materialized views in Databricks,"### Describe the bug

I just created a view and a materialized view in Databricks and I can't see it

### To Reproduce

1) go to the success databricks connection
2) there should be a sample_view and a sample_materialized_view table

try selecting those 2 on the native editor and you'll see results

### Expected behavior

you should see the views and materialized views

### Logs

NA

### Information about your Metabase installation

```JSON
v51
```

### Severity

P1

### Additional context

NA",paoliniluis,2024-11-29 22:54:29+00:00,['snoe'],2024-12-13 19:03:01+00:00,2024-12-13 19:03:01+00:00,https://github.com/metabase/metabase/issues/50712,"[('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('Database/Databricks', ''), ('.Team/Drivers', ''), ('Bug:v51', 'bugs or regressions introduced in v51')]",[],
2705722050,issue,closed,completed,[Epic] Use If as an alias to Case custom expression function,"**Links**

- [Product doc](https://www.notion.so/metabase/Use-If-as-an-alias-to-Case-custom-expression-function-14669354c901807884acf4a950dbf843)

**Implementation Plan**

```[tasklist]
- [ ] https://github.com/metabase/metabase/pull/51069
- [ ] https://github.com/metabase/metabase/pull/50702
- [ ] https://github.com/metabase/metabase/pull/51245
```

**Testing Plan**

- [ ] data type - string, number
- [ ] clase type - custom column, filter, aggregation
- [ ] expression editor - create/read/update",ranquild,2024-11-29 17:20:43+00:00,['ranquild'],2025-01-27 22:13:32+00:00,2024-12-13 01:28:52+00:00,https://github.com/metabase/metabase/issues/50698,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2705281785,issue,closed,completed,Pie charts stopped working for negative values (in between 50.28 and 51.5),"### Describe the bug

In the new version of Metabase (after upgrading from 50.28 to 51.5) pie charts stopped working for cases where the measure is only negative numbers.

Crafted example:

![Image](https://github.com/user-attachments/assets/767c8639-24a7-4010-9001-5ae0d125a1f5)


### To Reproduce

1. Create a new SQL question
2. Add the query
```
SELECT ""FOOD_AND_DRINK"" AS category, -400 AS costs 
UNION ALL SELECT ""MEDICAL"", -100 costs
UNION ALL SELECT ""RENT"", -1000 costs
UNION ALL SELECT ""INTERNET_AND_TV"", -70 costs
```
3. Visualize this as a Pie Chart
4. Notice it doesn't work, and the Pie Chart will display in grey, with total=0
5. (If you switch visualisation to Bar, you do see it working fine)
6. (If you switch the values to positive, you do see it working fine)


### Expected behavior

It should visualise the pie chart, as previous versions of Metabase did.

It should look like this example (but with negative values, where here I've modified them to positive):
![Image](https://github.com/user-attachments/assets/0940fab1-6d46-44d3-8409-8e8361914149)


### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""bigquery-cloud-sdk"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-self-hosted-yearly"",
    ""version"": {
      ""date"": ""2024-11-26"",
      ""tag"": ""v1.51.5"",
      ""hash"": ""d79d949""
    },
    ""settings"": {
      ""report-timezone"": ""Europe/Amsterdam""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""13.16""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.100+"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

annoying

### Additional context

I could work around this by adding a custom column that turns the negative values into positive (value * -1), and still show the pie-chart. But than I risk viewers of my pie-charts interpretation will be wrong.",johanvdlaak,2024-11-29 14:35:43+00:00,['alxnddr'],2024-12-06 14:29:43+00:00,2024-12-06 13:30:36+00:00,https://github.com/metabase/metabase/issues/50692,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('Visualization/Charts/Pie', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Bug:v51', 'bugs or regressions introduced in v51')]",[],
2705271438,issue,closed,completed,Incorrect tab id computed when edit action modal is open,"### Describe the bug

https://github.com/user-attachments/assets/0a7ac68a-930c-46a2-93df-f161bee2a9f6


### To Reproduce

1. Enable actions in models in admin
2. New > Model > Orders > Save > Visualize
3. Click ""More info""
4. Click ""See more about this model""
5. Click ""Actions""
6. Click ""Create basic actions""
7. Edit any of the created actions

Content behind the modal disappears

### Expected behavior

Content should not disappear when modal is open


### Information about your Metabase installation

master, 6838a0793b5849f7705a7a212faa03d3fa5a7c22

### Severity

P3

### Additional context

The problem is that [this code](https://github.com/metabase/metabase/blob/ead905b105b88c9c524c034cc87eb16935e9c27f/frontend/src/metabase/models/containers/ModelDetailPage/ModelDetailPage.tsx#L110-L119) computes the `tab` to be the id of the action instead of one of the supported values (`""usage"" | ""schema"" | ""actions""`)
",kamilmielnik,2024-11-29 14:30:12+00:00,['kamilmielnik'],2025-01-31 08:47:50+00:00,2025-01-31 08:47:48+00:00,https://github.com/metabase/metabase/issues/50690,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Querying/Actions', ''), ('.Team/Querying', '')]","[{'comment_id': 2626669262, 'issue_id': 2705271438, 'author': 'kamilmielnik', 'body': 'The model details page [recently got overhauled and moved into the sidebar](https://www.notion.so/metabase/Migrate-Model-details-to-Sidesheets-13c69354c901809995afe435ecaa9a8a).\nThe model actions page [no longer has tabs](https://github.com/user-attachments/assets/4fbcf117-d651-4b90-af51-154f0710c812), so the bug is not possible to reproduce anymore.\n\nClosing as fixed. Adding a repro does not make sense.', 'created_at': datetime.datetime(2025, 1, 31, 8, 47, 48, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2025-01-31 08:47:48 UTC): The model details page [recently got overhauled and moved into the sidebar](https://www.notion.so/metabase/Migrate-Model-details-to-Sidesheets-13c69354c901809995afe435ecaa9a8a).
The model actions page [no longer has tabs](https://github.com/user-attachments/assets/4fbcf117-d651-4b90-af51-154f0710c812), so the bug is not possible to reproduce anymore.

Closing as fixed. Adding a repro does not make sense.

"
2704958481,issue,closed,completed,Unable to select more than one comparison for trend card,"### Describe the bug

Using a native sql question with the trend card we're unable to select multiple comparisons as one can when using a notebook question and the same resultset. 

### To Reproduce

1. Click New+ and select ""SQL query""
2. Use the following query with the sample database
```sql
WITH
  daily_totals AS (
    SELECT
      CAST(created_at AS DATE) AS order_day,
      SUM(total) AS total
    FROM
      orders
    GROUP BY
      CAST(created_at AS DATE)
  ),
  daily_totals_with_comparison AS (
    SELECT
      order_day,
      total,
      ROUND(total * (0.8 + (RAND () * 0.4)), 2) AS forecast,
      ROUND(total * (0.9 + (RAND () * 0.15)), 2) AS last_year
    FROM
      daily_totals
    ORDER BY
      order_day
  )
SELECT
  sum(total) AS total,
  sum(forecast) AS forecast,
  sum(last_year) AS last_year,
  now() as now,
FROM
  daily_totals_with_comparison
GROUP BY now
```
3. Select the trend card visualization
4. Add a comparison using ""value from another column"" and select last_year.
5. Try adding a second comparison and nothing happens when clicking add comparison.


### Expected behavior

I should be able to create a second comparison using the forecast column as well. If I create a question using the contents from ""daily_totals"" and do the summation and grouping in a notebook question instead this is possible. 

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:132.0) Gecko/20100101 Firefox/132.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""pro-self-hosted"",
    ""version"": {
      ""date"": ""2024-11-28"",
      ""tag"": ""v1.51.6"",
      ""hash"": ""fc77ed4""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.8 (Debian 14.8-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.10.0-linuxkit"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

annoying

### Additional context

Using a native sql 
![Image](https://github.com/user-attachments/assets/b0ebaaa4-2330-4aa7-867f-036bd5320f60)

Using a notebook question
![Image](https://github.com/user-attachments/assets/9ef31b5d-b288-467a-ac41-9e64b4f564ff)

In our case we cannot use a notebook question as we'd like to do some nested filtering using dashboard filters and had to resort to native sql question instead of a notebook one.",andreasenberg,2024-11-29 12:14:12+00:00,['alxnddr'],2025-01-27 20:53:54+00:00,2025-01-27 15:29:22+00:00,https://github.com/metabase/metabase/issues/50686,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Scalars', 'Numbers, progress bars, gauges'), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2607447095, 'issue_id': 2704958481, 'author': 'ixipixi', 'body': ""Some additional context on this one: Presently we have a customer creating the same Trend card multiple times over for each dashboard to include every comparison metric (a lot of redundant work to get some simple comparisons up there). An alternative for some of their data has been using pivot tables to display some of the comparison metrics largely to avoid the weird optics of a bunch of almost identical Trend charts on the dashboard (this is concerning, too, since we're presently running into some significant performance issues with pivot downloads)."", 'created_at': datetime.datetime(2025, 1, 22, 14, 47, 55, tzinfo=datetime.timezone.utc)}, {'comment_id': 2607640433, 'issue_id': 2704958481, 'author': 'weand', 'body': 'We are running into the same issue. Any update on this ?\n\nAs more simple reproducer looks like this\n\n![Image](https://github.com/user-attachments/assets/b61e8282-7c21-4614-b1f7-64209e316d09)', 'created_at': datetime.datetime(2025, 1, 22, 16, 2, 30, tzinfo=datetime.timezone.utc)}]","ixipixi on (2025-01-22 14:47:55 UTC): Some additional context on this one: Presently we have a customer creating the same Trend card multiple times over for each dashboard to include every comparison metric (a lot of redundant work to get some simple comparisons up there). An alternative for some of their data has been using pivot tables to display some of the comparison metrics largely to avoid the weird optics of a bunch of almost identical Trend charts on the dashboard (this is concerning, too, since we're presently running into some significant performance issues with pivot downloads).

weand on (2025-01-22 16:02:30 UTC): We are running into the same issue. Any update on this ?

As more simple reproducer looks like this

![Image](https://github.com/user-attachments/assets/b61e8282-7c21-4614-b1f7-64209e316d09)

"
2704916957,issue,closed,completed,Setting MB_ENABLE_PIVOTED_EXPORTS to false causes column headers to get lost during download for CSV,"### Describe the bug

Setting MB_ENABLE_PIVOTED_EXPORTS to false causes column headers to get lost during download CSV. 

Note that if you enable the MB_ENABLE_PIVOTED_EXPORTS and download a pivot with `Keep the data pivoted` disabled then it works as expected.

The two flows should be the same. 



### To Reproduce

Make  sure you have an environment running `MB_ENABLE_PIVOTED_EXPORTS=false` 

1) Create a Pivot Table, Any Pivot will do. Then download it:

![Image](https://github.com/user-attachments/assets/a64d2373-71b7-4259-9675-8039cdd6661c)


2) Notice that when you download it

![Image](https://github.com/user-attachments/assets/37481546-2623-496e-a150-31c9dc5663f5)


### Expected behavior

Download works as if it was not Pivoted 

### Logs

None that are relevant

### Information about your Metabase installation

```JSON
1.50.6
```

### Severity

We cannot offer a workaround for people that might get their pivot table broken due to Keep Data Pivoted being enabled by default

### Additional context

_No response_",Tony-metabase,2024-11-29 11:51:24+00:00,['adam-james-v'],2024-12-03 22:46:09+00:00,2024-12-03 14:41:00+00:00,https://github.com/metabase/metabase/issues/50685,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Reporting/Export/Pivot', 'Exporting data as pivoted tables')]","[{'comment_id': 2515705940, 'issue_id': 2704916957, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 12, 3, 22, 46, 8, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-03 22:46:08 UTC):  This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)

"
2704798785,issue,open,,Support fetching bug report files from S3,"**Context**
Once we upload bug report files to S3 instead of Slack we should ensure the download is adapted accordingly

Depends on #50647 ",thebiglabasky,2024-11-29 11:12:04+00:00,[],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50683,[],[],
2704359783,issue,closed,completed,Static embed light mode shows different chart text colors sometimes,"### Describe the bug

Reported [on Slack](https://metaboat.slack.com/archives/C01LQQ2UW03/p1732816074992369)

In some charts, e.g. pie charts. When the chart label is white, but in either static embedding, or a public link the chart label would look dark.

This happened because of https://github.com/metabase/metabase/pull/45633. I believe I incorrectly implemented one of the lines.
https://github.com/metabase/metabase/blob/dd00df1a06ae729d9641e147a0fc91bf54349923/frontend/src/metabase/public/components/EmbedFrame/EmbedFrame.module.css#L32-L35

This `fill` property was inside the dark theme selector, but currently, we apply this style everywhere.

https://github.com/metabase/metabase/blob/8f41692cb09c41ad3734943422b585acd56e3dee/frontend/src/metabase/public/components/EmbedFrame/EmbedFrame.module.css#L22-L26

### To Reproduce

1. Create a dashboard with a pie chart. Ensure at least one of the chart labels inside a slice hasa  white color.
2. Visit a public link.
3. The text color should stay the same.


### Expected behavior

The text color should stay the same as the core app, in embeddings.

### Logs

_No response_

### Information about your Metabase installation

```JSON
-
```

### Severity

confusing?

### Additional context

_No response_",WiNloSt,2024-11-29 08:44:11+00:00,['WiNloSt'],2024-11-29 15:57:45+00:00,2024-11-29 14:22:39+00:00,https://github.com/metabase/metabase/issues/50677,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('.Team/Embedding', '')]","[{'comment_id': 2508075971, 'issue_id': 2704359783, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 11, 29, 15, 57, 44, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-11-29 15:57:44 UTC):  This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)

"
2704148984,issue,open,,SDK Error icon didn't show up,"### Describe the bug

The error icon is invisible. This was due to `box-sizing: content-box` on the SDK compared to `box-sizing: border-box` on the core app.


#### What it looks like now
![Image](https://github.com/user-attachments/assets/911c25df-9a87-4f2d-8ee8-68f3e3008816)

#### What is it supposed to look like
![Image](https://github.com/user-attachments/assets/bd4e03d1-a6ad-4e45-8de5-cd0f808634ea)


### To Reproduce

1. Embed anything with an SDK, and disable SDK embedding in admin settings.


### Expected behavior

The icon should be visible

### Logs

_No response_

### Information about your Metabase installation

```JSON
-
```

### Severity

Error message looks broken

### Additional context

_No response_",WiNloSt,2024-11-29 07:05:28+00:00,['sanex3339'],2025-02-04 20:26:14+00:00,,https://github.com/metabase/metabase/issues/50673,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', ''), ('good first issue', 'A starter issue that is good for someone new to the codebase or is a new contributor'), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2508068514, 'issue_id': 2704148984, 'author': 'npretto', 'body': 'A possible fix for this is listed here: https://metaboat.slack.com/archives/C063Q3F1HPF/p1732892562188129?thread_ts=1732864143.186619&cid=C063Q3F1HPF\n\n```\n  /* ""unset any global reset  */\n  *,\n  :before,\n  ::after {\n    box-sizing: content-box;\n  }\n\n```\nThis should only apply to our components and not leak out, so it\'s based on  [fix(sdk): introduce .mb-wrapper to scope down our css](https://github.com/metabase/metabase/pull/50466)', 'created_at': datetime.datetime(2024, 11, 29, 15, 52, 12, tzinfo=datetime.timezone.utc)}, {'comment_id': 2581617813, 'issue_id': 2704148984, 'author': 'Abhinavagarwa', 'body': 'can i work upon this', 'created_at': datetime.datetime(2025, 1, 10, 2, 29, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2601587325, 'issue_id': 2704148984, 'author': 'sanex3339', 'body': ""I can't reproduce it. I have the icon."", 'created_at': datetime.datetime(2025, 1, 20, 7, 14, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2601750991, 'issue_id': 2704148984, 'author': 'WiNloSt', 'body': 'This seems to only happen to sites overriding `box-sizing: border-box` which is common with some UI libraries, and CSS resets.\n\n![Image](https://github.com/user-attachments/assets/a70d04cd-6c77-498d-8a64-3bc12b2e15bb)\n\nOur SDK should be more resilient to these overrides.', 'created_at': datetime.datetime(2025, 1, 20, 8, 36, 16, tzinfo=datetime.timezone.utc)}]","npretto on (2024-11-29 15:52:12 UTC): A possible fix for this is listed here: https://metaboat.slack.com/archives/C063Q3F1HPF/p1732892562188129?thread_ts=1732864143.186619&cid=C063Q3F1HPF

```
  /* ""unset any global reset  */
  *,
  :before,
  ::after {
    box-sizing: content-box;
  }

```
This should only apply to our components and not leak out, so it's based on  [fix(sdk): introduce .mb-wrapper to scope down our css](https://github.com/metabase/metabase/pull/50466)

Abhinavagarwa on (2025-01-10 02:29:32 UTC): can i work upon this

sanex3339 (Assginee) on (2025-01-20 07:14:58 UTC): I can't reproduce it. I have the icon.

WiNloSt (Issue Creator) on (2025-01-20 08:36:16 UTC): This seems to only happen to sites overriding `box-sizing: border-box` which is common with some UI libraries, and CSS resets.

![Image](https://github.com/user-attachments/assets/a70d04cd-6c77-498d-8a64-3bc12b2e15bb)

Our SDK should be more resilient to these overrides.

"
2703358989,issue,closed,completed,"[BE, MBQL lib] Support new expressions in `filter-args-display-name`",,ranquild,2024-11-28 22:19:06+00:00,['metamben'],2025-01-27 22:14:17+00:00,2024-11-29 20:05:00+00:00,https://github.com/metabase/metabase/issues/50670,[],[],
2702966846,issue,open,,Converting a model to SQL and adding a variable doesn't let you change variable type,"### Describe the bug

Video
https://www.loom.com/share/8bd3b4c64f2247ac9a852f336cfd1384?sid=bf4b0fe3-e449-4d93-b6f8-24c3b683e6a6

Doesn't happen all the time. You'll need to try a couple of times until it happens. 



### To Reproduce

1. Create a question Orders with People model
2. Add a filter
3. Convert the question to SQL. 
4. Find the filter in the SQL, and replace it with a new variable. 
5. Then try and switch the type


### Expected behavior

Should let you change the variable type

### Logs

<details>
    <summary> Console error </summary>
    <div aria-expanded=""true"" tabindex=""-1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; flex: 0 0 auto;""><span class=""source-code"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font-family: var(--source-code-font-family); white-space: pre-wrap; font-size: var(--source-code-font-size) !important; line-height: 1.2;""><span class=""console-message-anchor"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; float: right; text-align: right; max-width: 100%; margin-left: 4px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;""><br class=""Apple-interchange-newline"">vendor.9f90d9662ff4f09d.js:1</button> </span><span class=""console-message-text"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; color: var(--override-error-text-color) !important;"">Uncaught <span class=""object-value-error source-code"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font-family: var(--source-code-font-family); white-space: pre-wrap; font-size: var(--source-code-font-size) !important; line-height: 1.2;""><span style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">Error: StructuredQuery usage is forbidden. Use MLv2
<span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at j.legacyQuery (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///metabase-lib/v1/Question.ts:202:17"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">Question.ts:202:17</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at setType (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///query_builder/components/template_tags/TagEditorParam.tsx:94:45"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">TagEditorParam.tsx:94:45</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; display: var(--display-ignored-formatted-stack-frame); opacity: 0.6;"">    at eC (<button class=""devtools-link text-button link-style ignore-list-link"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///node_modules/@mantine/core/esm/Select/Select.js:259:11"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">Select.js:259:11</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; display: var(--display-ignored-formatted-stack-frame); opacity: 0.6;"">    at S.r.createElement._.onMouseDown (<button class=""devtools-link text-button link-style ignore-list-link"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///node_modules/@mantine/core/esm/Select/SelectItems/SelectItems.js:74:9"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">SelectItems.js:74:9</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at Object.eN (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3803178"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3803178</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at eX (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3803332"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3803332</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at <button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3821651"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3821651</button>
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at rn (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3821750"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3821750</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at rr (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3822164"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3822164</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at <button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3827626"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3827626</button></span></span></span></span></span></div><div class="""" role=""group"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; flex: 0 0 auto;""><span class=""monospace stack-preview-container width-constrained show-hidden-rows"" style=""display: inline-block; --monospace-font-size: 11px; --monospace-font-family: monospace; --source-code-font-size: 11px; --source-code-font-family: monospace; width: 1505.03px; box-sizing: border-box; min-width: 0px; min-height: 0px; font-family: var(--monospace-font-family); font-size: var(--monospace-font-size) !important;"">
 | legacyQuery | @ | Question.ts:202
-- | -- | -- | --
 | setType | @ | TagEditorParam.tsx:94
 | eC | @ | Select.js:259
 | S.r.createElement._.onMouseDown | @ | SelectItems.js:74
 | eN | @ | vendor.9f90d9662ff4f09d.js:1
 | eX | @ | vendor.9f90d9662ff4f09d.js:1
 | (anonymous) | @ | vendor.9f90d9662ff4f09d.js:1
 | rn | @ | vendor.9f90d9662ff4f09d.js:1
 | rr | @ | vendor.9f90d9662ff4f09d.js:1
 | (anonymous) | @ | vendor.9f90d9662ff4f09d.js:1
 | sC | @ | vendor.9f90d9662ff4f09d.js:1
 | eW | @ | vendor.9f90d9662ff4f09d.js:1
 | rc | @ | vendor.9f90d9662ff4f09d.js:1
 | tN | @ | vendor.9f90d9662ff4f09d.js:1
 | tI | @ | vendor.9f90d9662ff4f09d.js:1


harset='utf-8'><div aria-expanded=""true"" tabindex=""-1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; flex: 0 0 auto;""><span class=""source-code"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font-family: var(--source-code-font-family); white-space: pre-wrap; font-size: var(--source-code-font-size) !important; line-height: 1.2;""><span class=""console-message-anchor"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; float: right; text-align: right; max-width: 100%; margin-left: 4px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;""><br class=""Apple-interchange-newline"">vendor.9f90d9662ff4f09d.js:1</button> </span><span class=""console-message-text"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; color: var(--override-error-text-color) !important;"">Uncaught <span class=""object-value-error source-code"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font-family: var(--source-code-font-family); white-space: pre-wrap; font-size: var(--source-code-font-size) !important; line-height: 1.2;""><span style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">Error: StructuredQuery usage is forbidden. Use MLv2
<span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at j.legacyQuery (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///metabase-lib/v1/Question.ts:202:17"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">Question.ts:202:17</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at setType (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///query_builder/components/template_tags/TagEditorParam.tsx:94:45"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">TagEditorParam.tsx:94:45</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; display: var(--display-ignored-formatted-stack-frame); opacity: 0.6;"">    at eC (<button class=""devtools-link text-button link-style ignore-list-link"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///node_modules/@mantine/core/esm/Select/Select.js:259:11"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">Select.js:259:11</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; display: var(--display-ignored-formatted-stack-frame); opacity: 0.6;"">    at S.r.createElement._.onMouseDown (<button class=""devtools-link text-button link-style ignore-list-link"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///node_modules/@mantine/core/esm/Select/SelectItems/SelectItems.js:74:9"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">SelectItems.js:74:9</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at Object.eN (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3803178"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3803178</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at eX (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3803332"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3803332</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at <button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3821651"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3821651</button>
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at rn (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3821750"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3821750</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at rr (<button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3822164"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3822164</button>)
</span><span class=""formatted-stack-frame"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px;"">    at <button class=""devtools-link text-button link-style"" jslog=""Link; context: script-location; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1:3827626"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer; max-width: 100%; overflow: hidden; text-overflow: ellipsis; word-break: break-all;"">vendor.9f90d9662ff4f09d.js:1:3827626</button></span></span></span></span></span></div><div class="""" role=""group"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; flex: 0 0 auto;""><span class=""monospace stack-preview-container width-constrained show-hidden-rows"" style=""display: inline-block; --monospace-font-size: 11px; --monospace-font-family: monospace; --source-code-font-size: 11px; --source-code-font-family: monospace; width: 1505.03px; box-sizing: border-box; min-width: 0px; min-height: 0px; font-family: var(--monospace-font-family); font-size: var(--monospace-font-size) !important;""><table class=""stack-preview-container width-constrained show-hidden-rows"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; --display-ignored-row: table-row; --display-toggle-link: table-row; display: block; width: 1505.03px;""><tbody style=""box-sizing: border-box; min-width: 0px; min-height: 0px; display: var(--override-display-stack-preview-tbody,table-row-group);""><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">legacyQuery</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///metabase-lib/v1/Question.ts:202"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">Question.ts:202</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">setType</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///query_builder/components/template_tags/TagEditorParam.tsx:94"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">TagEditorParam.tsx:94</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px; opacity: 0.6; display: var(--display-ignored-row);""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">eC</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style ignore-list-link"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///node_modules/@mantine/core/esm/Select/Select.js:259"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">Select.js:259</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px; opacity: 0.6; display: var(--display-ignored-row);""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">S.r.createElement._.onMouseDown</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style ignore-list-link"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""webpack:///node_modules/@mantine/core/esm/Select/SelectItems/SelectItems.js:74"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">SelectItems.js:74</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">eN</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--sys-color-primary); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">eX</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">(anonymous)</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">rn</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">rr</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">(anonymous)</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">sC</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">eW</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">rc</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">tN</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr><tr style=""box-sizing: border-box; min-width: 0px; min-height: 0px; height: 16px; line-height: 16px;""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;""></td><td class=""function-name"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; max-width: 80em;"">tI</td><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px;"">@</td><td class=""link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; cursor: pointer; text-decoration: underline; color: var(--sys-color-primary); outline-offset: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; width: 1271.77px; max-width: 0px;""><button class=""devtools-link text-button link-style"" jslog=""Link; context: stack-trace; track: click"" role=""link"" tabindex=""-1"" title=""https://ignacio-staging-instance.hosted.staging.metabase.com/app/dist/vendor.9f90d9662ff4f09d.js:1"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font: inherit; margin: 0px; height: unset; border: none; border-radius: 2px; padding: 0px !important; color: var(--text-link); background: none; flex: 0 0 auto; white-space: nowrap; text-decoration: underline; outline-offset: 2px; outline: none; cursor: pointer;"">vendor.9f90d9662ff4f09d.js:1</button></td></tr></tbody><tfoot style=""box-sizing: border-box; min-width: 0px; min-height: 0px;""><tr class=""show-less-link"" style=""box-sizing: border-box; min-width: 0px; min-height: 0px; font-style: italic; display: var(--display-toggle-link);""><td style=""box-sizing: border-box; min-width: 0px; min-height: 0px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-inline: 2px; color: rgb(227, 227, 227); font-family: monospace; font-size: 11px; font-style: italic; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(0, 74, 119); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;""></td><br class=""Apple-interchange-newline"">
</details>

### Information about your Metabase installation

```JSON
-1.52
```

### Severity

P3

### Additional context

_No response_",ignacio-mb,2024-11-28 18:44:44+00:00,[],2025-02-04 20:29:06+00:00,,https://github.com/metabase/metabase/issues/50662,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('Querying/Native', 'The SQL/native query editor'), ('Difficulty:Hard', ''), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2621836971, 'issue_id': 2702966846, 'author': 'kamilmielnik', 'body': 'I\'m having a very hard time reproducing this.\nI\'m assigning ""Difficulty: Hard"" because of how hard it is to reproduce and debug, and moving on to something else for now.\n\n----\n\nWhen I picked this up 2 days ago, I did reproduce it twice in a row (first 2 attempts) by manually going through the UI, but I didn\'t get any debugging information from it. After that I couldn\'t reproduce it manually again, so I thought I\'ll automate this.\nI prepared an e2e repro, put a breakpoint near the crash and then ran that repro over 300 times without any luck.\nWell, almost - there was a batch where the issue has been hit 6/10 times, but developer tools crashed in Cypress so my breakpoint never triggered (on second thought, those failures could have been due to a different issue since Cypress was misbehaving in that run due to dev tools crash - I\'m not sure anymore).\n\nTo sum up, I was only able to reproduce it manually or with the following e2e repro with developer tools closed:\n\n```js\ndescribe(""issue 50662"", () => {\n  beforeEach(() => {\n    H.restore();\n    cy.signInAsNormalUser();\n    cy.intercept(""POST"", ""api/dataset"").as(""dataset"");\n  });\n\n  it(""does not crash (metabase#50662)"", () => {\n    cy.visit(""/"");\n    H.newButton(""Question"").click();\n    H.entityPickerModalTab(""Tables"").click();\n    H.entityPickerModalItem(2, ""Orders"").click();\n    H.join();\n    H.joinTable(""People"");\n    H.getNotebookStep(""filter"")\n      .findByText(""Add filters to narrow your answer"")\n      .click();\n    H.popover().findByText(""Product ID"").click();\n    H.popover().findByPlaceholderText(""Enter an ID"").type(""42"");\n    H.popover().button(""Add filter"").click();\n    cy.findByLabelText(""View SQL"").click();\n    cy.button(""Convert this question to SQL"").click();\n    cy.wait(""@dataset"");\n    H.focusNativeEditor().type(\n      ""{pagedown}{uparrow}{uparrow}{end}{shift+leftarrow}{shift+leftarrow}{backspace}{{test"",\n    );\n    cy.findByTestId(""variable-type-select"").click();\n    H.popover().findByText(""Number"").click();\n    cy.findByTestId(""variable-type-select"").should(""have.value"", ""Number"");\n  });\n});\n```', 'created_at': datetime.datetime(2025, 1, 29, 14, 38, 25, tzinfo=datetime.timezone.utc)}]","kamilmielnik on (2025-01-29 14:38:25 UTC): I'm having a very hard time reproducing this.
I'm assigning ""Difficulty: Hard"" because of how hard it is to reproduce and debug, and moving on to something else for now.

----

When I picked this up 2 days ago, I did reproduce it twice in a row (first 2 attempts) by manually going through the UI, but I didn't get any debugging information from it. After that I couldn't reproduce it manually again, so I thought I'll automate this.
I prepared an e2e repro, put a breakpoint near the crash and then ran that repro over 300 times without any luck.
Well, almost - there was a batch where the issue has been hit 6/10 times, but developer tools crashed in Cypress so my breakpoint never triggered (on second thought, those failures could have been due to a different issue since Cypress was misbehaving in that run due to dev tools crash - I'm not sure anymore).

To sum up, I was only able to reproduce it manually or with the following e2e repro with developer tools closed:

```js
describe(""issue 50662"", () => {
  beforeEach(() => {
    H.restore();
    cy.signInAsNormalUser();
    cy.intercept(""POST"", ""api/dataset"").as(""dataset"");
  });

  it(""does not crash (metabase#50662)"", () => {
    cy.visit(""/"");
    H.newButton(""Question"").click();
    H.entityPickerModalTab(""Tables"").click();
    H.entityPickerModalItem(2, ""Orders"").click();
    H.join();
    H.joinTable(""People"");
    H.getNotebookStep(""filter"")
      .findByText(""Add filters to narrow your answer"")
      .click();
    H.popover().findByText(""Product ID"").click();
    H.popover().findByPlaceholderText(""Enter an ID"").type(""42"");
    H.popover().button(""Add filter"").click();
    cy.findByLabelText(""View SQL"").click();
    cy.button(""Convert this question to SQL"").click();
    cy.wait(""@dataset"");
    H.focusNativeEditor().type(
      ""{pagedown}{uparrow}{uparrow}{end}{shift+leftarrow}{shift+leftarrow}{backspace}{{test"",
    );
    cy.findByTestId(""variable-type-select"").click();
    H.popover().findByText(""Number"").click();
    cy.findByTestId(""variable-type-select"").should(""have.value"", ""Number"");
  });
});
```

"
2702762563,issue,open,,Recreate entities from bug report in AppDB,"**Context**
The last step to a full reproduction environment is to have a functioning set of entities the user has encountered problems with.
This task is about taking the exported information from the bug report and import it into the reproduction environment's AppDB.",thebiglabasky,2024-11-28 16:54:07+00:00,['escherize'],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50659,[],[],
2702754012,issue,open,,Generate mock data according to fingerprinting info,"**Context**
Bug reports containing the datasource definition also contain fingerprinting information which describe at a high level the contents of the scanned tables. This is useful to generate test data which approximates the real content of a customer's database without requiring actual data which may be sensitive.

This task is about leaning on a data mocking library such as Mockaroo or a lower-level data generator to create synthetic data allowing us to work against a realistic dataset.",thebiglabasky,2024-11-28 16:51:26+00:00,['escherize'],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50658,[],[],
2702744671,issue,closed,completed,Sankey chart tool tip bug,"### Describe the bug

1. not showing the year in the second month (second 5 from video) ![Image](https://github.com/user-attachments/assets/73563774-33e9-428a-a49a-42447048f388)
2. something strange in tool tip, showing 0 (second 9 from video ![Image](https://github.com/user-attachments/assets/9d463fc1-228d-4016-a23a-1c42696bc7ba)
3. when click in line the tool tip no longer appears (second video) 

![Image](https://github.com/user-attachments/assets/8b810a76-5522-4765-b06e-e34280cfa5dc)



### To Reproduce

1. I used order table example


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
v1.52.0-beta Pre-release
```

### Severity

P3

### Additional context

_No response_",fer-batista,2024-11-28 16:50:00+00:00,['alxnddr'],2024-12-03 16:42:03+00:00,2024-12-03 15:20:26+00:00,https://github.com/metabase/metabase/issues/50657,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Visualization/Charts/Sankey', '')]","[{'comment_id': 2506508160, 'issue_id': 2702744671, 'author': 'fer-batista', 'body': 'https://github.com/user-attachments/assets/bb961f1e-5b16-41fa-a65d-2bd37d457aa9\nhttps://github.com/user-attachments/assets/a69d4474-fd98-4ad0-8400-da06562c09c8', 'created_at': datetime.datetime(2024, 11, 28, 16, 51, 56, tzinfo=datetime.timezone.utc)}]","fer-batista (Issue Creator) on (2024-11-28 16:51:56 UTC): https://github.com/user-attachments/assets/bb961f1e-5b16-41fa-a65d-2bd37d457aa9
https://github.com/user-attachments/assets/a69d4474-fd98-4ad0-8400-da06562c09c8

"
2702679933,issue,closed,completed,Don't show the Cleanup modal on the the `Examples` collection,"**Context**
It doesn't make sense to show the cleanup modal on the examples collection. If the user doesn't need the collection anymore, it is better to exclude the entire collection.

[Thread](https://metaboat.slack.com/archives/C01LQQ2UW03/p1732807187740239)

",luizarakaki,2024-11-28 16:32:00+00:00,['sloansparger'],2024-12-03 23:29:13+00:00,2024-12-03 21:51:11+00:00,https://github.com/metabase/metabase/issues/50655,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2515799619, 'issue_id': 2702679933, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 12, 3, 23, 29, 13, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-03 23:29:13 UTC):  This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)

"
2702670255,issue,open,,Generate DDL based on provided bug report datasource structure,"**Context**
We need to generate an appropriate or close-enough DDL of the user's data sources in order to replicate their environment.

[An experiment](https://metaboat.slack.com/archives/C07S2HE8M29/p1732233392642319) was built by @thebiglabasky using Claude, which seems to give promising results. This could be adapted further but should suffice for most relational DB vendors.

An alternative should be found for non-relational ones, in decreasing order of priority:
* BigQuery
* Athena
* MongoDB
",thebiglabasky,2024-11-28 16:26:36+00:00,['escherize'],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50653,[],[],
2702656700,issue,open,,Populate datasources with mock data,"**Context**

Once datasources are created we need to generate the data structure that the user's Metabase instance is expected to run against, along with mock data which will allow to reproduce the problem the user experienced.",thebiglabasky,2024-11-28 16:18:24+00:00,['escherize'],2025-01-23 09:24:55+00:00,,https://github.com/metabase/metabase/issues/50652,[],[],
2702654510,issue,open,,Set the default download extension,"**Is your feature request related to a problem? Please describe.**
Some users only use excel, so we can save them a click by setting a default download behavior that will change it to xlsx first (right now it's csv and users need to click to download the excel file)

**Describe the solution you'd like**
An env var that can set the default behavior to be excel

**Describe alternatives you've considered**
None

**How important is this feature to you?**
Requested by a customer that only uses excel

**Additional context**
NA
",paoliniluis,2024-11-28 16:17:11+00:00,[],2025-02-04 20:30:50+00:00,,https://github.com/metabase/metabase/issues/50651,"[('Type:New Feature', ''), ('Reporting/Export', '')]","[{'comment_id': 2598451709, 'issue_id': 2702654510, 'author': 'dkidd255', 'body': ""Just adding that this is a much needed feature.  As an Paid Enterprise user, I can confirm most businesses are going to prefer xlsx, so i'm not sure why the default was changed to CSV...\n\nIn addition CSV is having a lot of issues with Pivot Tables in Recent Releases, which is currently crashing our entire instance, not good."", 'created_at': datetime.datetime(2025, 1, 17, 14, 9, 47, tzinfo=datetime.timezone.utc)}]","dkidd255 on (2025-01-17 14:09:47 UTC): Just adding that this is a much needed feature.  As an Paid Enterprise user, I can confirm most businesses are going to prefer xlsx, so i'm not sure why the default was changed to CSV...

In addition CSV is having a lot of issues with Pivot Tables in Recent Releases, which is currently crashing our entire instance, not good.

"
2702652040,issue,open,,Provision test datasources based on bug report details,"**Context**
Use the information about datasources to provision test datasources to use for reproduction purposes.

Credentials for test datasources are stored in 1password. We should use the 1password CLI to inject these credentials in a configuration file so that they can be read at runtime by the routine.

@snoe has already implemented the logic to create test schemas / databases for testing each of our drivers without clashes, so we should either reuse the same logic or at least take inspiration from it in order to provision these. Cf. [discussion](https://metaboat.slack.com/archives/C07HJBQ9VAN/p1732727472991319?thread_ts=1732721167.052179&cid=C07HJBQ9VAN).

A suggestion would be to use a bug report ID as prefix, and ensure that if the schema/db already exists, then it's likely that the data environment was already provisioned, so we can skip this step altogether, considering that the person in use of the reproduction environment would trash it when not used anymore.",thebiglabasky,2024-11-28 16:15:56+00:00,['escherize'],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50650,[],[],
2702633941,issue,open,,Implement sending bug reports to Pylon,"**Context**
Once we open this bug reporting to Pro and Enterprise customers, we want to ensure this gets reported directly in Pylon so this streamlines the process for them.",thebiglabasky,2024-11-28 16:05:21+00:00,[],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50649,[],[],
2702630058,issue,open,,Upload bug report files to S3,"**Context**
We currently offer self-hosted customers to transition to our cloud-hosted offer. This process securely uploads information about their instance to our private S3 in order to automate this migration.
We should use the same principle to upload bug report files so that we have a single URL that's independent from the channel the bug is reported to (Slack or Pylon).",thebiglabasky,2024-11-28 16:03:19+00:00,[],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50647,[],[],
2702622977,issue,open,,Abstract where we submit bug reports away from Slack only,"**Context**
We're currently sending internal bug reports to Slack only, but want to eventually send these to our support system for Pro and Enterprise customers. We should thus abstract the process of bug report submission to submit to the appropriate channel depending on the user.

[Flow chart in FigJam](https://www.figma.com/board/Mva83hChGa7yqeDNdoVfVF/Reporter-%2B-Debugger-flows?node-id=1-990&node-type=section&t=9MzaxYI453SvRrTp-11)",thebiglabasky,2024-11-28 15:59:19+00:00,[],2025-01-30 13:57:46+00:00,,https://github.com/metabase/metabase/issues/50646,[],"[{'comment_id': 2624590227, 'issue_id': 2702622977, 'author': 'iethree', 'body': ""FWIW, using s3 as a file store, rather than slack, shouldn't be hard, and might actually be easier than sending to slack"", 'created_at': datetime.datetime(2025, 1, 30, 13, 57, 44, tzinfo=datetime.timezone.utc)}]","iethree on (2025-01-30 13:57:44 UTC): FWIW, using s3 as a file store, rather than slack, shouldn't be hard, and might actually be easier than sending to slack

"
2702482745,issue,closed,not_planned,Field filter dropdowns do not work for view-only users,"### Describe the bug

When you create a question with a field filter with a dropdown option, people with ""curate"" rights can see the filter dropdown, but people with ""view"" rights only see a free-form field without auto-completion. 


### To Reproduce

1. Create a question with a field filter with a dropdown.
2. Connect with a user who only has View rights for this question
3. Try to use the filter
4. See the absence of filter options


### Expected behavior

The filter should have a dropdown list of values.

### Logs

The `values` endpoint is never called with a View role, while it is called with a Curator role. 

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""snowflake""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-26"",
      ""tag"": ""v0.51.5"",
      ""hash"": ""d79d949""
    },
    ""settings"": {
      ""report-timezone"": ""UTC""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9-post-Ubuntu-1ubuntu124.04"",
    ""java.vendor"": ""Ubuntu"",
    ""java.vendor.url"": ""https://ubuntu.com/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9-post-Ubuntu-1ubuntu124.04"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.228-219.884.amzn2.aarch64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Blocking some users

### Additional context

_No response_",ChloePont,2024-11-28 15:13:30+00:00,['ranquild'],2024-12-06 14:48:33+00:00,2024-12-06 14:48:32+00:00,https://github.com/metabase/metabase/issues/50645,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2514825250, 'issue_id': 2702482745, 'author': 'ranquild', 'body': ""@ChloePont I couldn't reproduce the issue you described. The only way I managed to get something similar is if the other user doesn't have access to the source question/model used for the dropdown options at all. Is that what you've been experiencing? \n\n![Image](https://github.com/user-attachments/assets/f1133922-10bc-4c45-9911-ce390653ca31)"", 'created_at': datetime.datetime(2024, 12, 3, 15, 5, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2515168425, 'issue_id': 2702482745, 'author': 'ChloePont', 'body': ""Thank you for getting back to me @ranquild  \n\nYes, that's correct, the user wouldn't have access to the underlying model (in our setup, we only want users to access specific prepared questions, but we don't want them to access unfiltered data).\n\nThe screenshot you added is exactly what we're experiencing  (the values endpoint is either not called or returns a 403)"", 'created_at': datetime.datetime(2024, 12, 3, 17, 26, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2523415270, 'issue_id': 2702482745, 'author': 'ranquild', 'body': '@ChloePont dropdown sources for parameters do not overwrite collection permissions. Users need at least ""view"" access to the collection when this question is located. Closing this as it\'s working as expected. The only thing that might be a concern is that we don\'t show an error message in this case and simply default to a plain text input.', 'created_at': datetime.datetime(2024, 12, 6, 14, 48, 32, tzinfo=datetime.timezone.utc)}]","ranquild (Assginee) on (2024-12-03 15:05:27 UTC): @ChloePont I couldn't reproduce the issue you described. The only way I managed to get something similar is if the other user doesn't have access to the source question/model used for the dropdown options at all. Is that what you've been experiencing? 

![Image](https://github.com/user-attachments/assets/f1133922-10bc-4c45-9911-ce390653ca31)

ChloePont (Issue Creator) on (2024-12-03 17:26:36 UTC): Thank you for getting back to me @ranquild  

Yes, that's correct, the user wouldn't have access to the underlying model (in our setup, we only want users to access specific prepared questions, but we don't want them to access unfiltered data).

The screenshot you added is exactly what we're experiencing  (the values endpoint is either not called or returns a 403)

ranquild (Assginee) on (2024-12-06 14:48:32 UTC): @ChloePont dropdown sources for parameters do not overwrite collection permissions. Users need at least ""view"" access to the collection when this question is located. Closing this as it's working as expected. The only thing that might be a concern is that we don't show an error message in this case and simply default to a plain text input.

"
2702308959,issue,closed,not_planned,getting JDBC driver internal error: when setting snowflake connection,"**Describe the bug**
trying to set a connection to snowflake.

**Logs**
JDBC driver internal error: exception creating result java.lang.NoClassDefFoundError: Could not initialize class net.snowflake.client.jdbc.internal.apache.arrow.memory.RootAllocator at net.snowflake.client.jdbc.SnowflakeResultSetSerializableV1.<init>(SnowflakeResultSetSerializableV1.java:368).


**Metabase Diagnostic Info**

{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-26"",
      ""tag"": ""v0.51.5"",
      ""hash"": ""d79d949""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""17.0.10+0"",
    ""java.vendor"": ""Homebrew"",
    ""java.vendor.url"": ""https://github.com/Homebrew/homebrew-core/issues"",
    ""java.version"": ""17.0.10"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""17.0.10+0"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""15.1.1"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Jerusalem""
  }
}
```",udil-brightdata,2024-11-28 14:20:36+00:00,[],2024-11-28 14:23:40+00:00,2024-11-28 14:23:38+00:00,https://github.com/metabase/metabase/issues/50641,[],"[{'comment_id': 2506241383, 'issue_id': 2702308959, 'author': 'paoliniluis', 'body': 'Please use Java 11', 'created_at': datetime.datetime(2024, 11, 28, 14, 23, 38, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-11-28 14:23:38 UTC): Please use Java 11

"
2702069767,issue,closed,completed,Fetching bug report file from Slack,"**Context**
For now bug report files are stored in Slack. We need to pull that file and use it to analyze its content to initialize the bug report context, feeding subsequent tasks in the bug reproduction environment creation process.

**Important note: eventually, the file should be stored on our own secure S3 bucket so that we remain agnostic from where the bug gets reported (Slack, Pylon...). This is considered in this issue: #50683**",thebiglabasky,2024-11-28 12:55:26+00:00,[],2025-01-30 13:36:31+00:00,2025-01-30 13:36:29+00:00,https://github.com/metabase/metabase/issues/50632,[],"[{'comment_id': 2511270256, 'issue_id': 2702069767, 'author': 'filiphric', 'body': 'the title and description of this is confusing to me. fetching a file from Slack is implemented on the debugger already. Fetching files from S3 is indeed something that does not work yet and is blocked by first implementing it', 'created_at': datetime.datetime(2024, 12, 2, 11, 23, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2511305106, 'issue_id': 2702069767, 'author': 'thebiglabasky', 'body': ""Yeah sorry that one is for the backend part once we'll look into creating repro environment (cf. parent issue) I'll clarify"", 'created_at': datetime.datetime(2024, 12, 2, 11, 41, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2624538138, 'issue_id': 2702069767, 'author': 'thebiglabasky', 'body': 'Closing since this is nowhere to be tackled for now', 'created_at': datetime.datetime(2025, 1, 30, 13, 36, 29, tzinfo=datetime.timezone.utc)}]","filiphric on (2024-12-02 11:23:57 UTC): the title and description of this is confusing to me. fetching a file from Slack is implemented on the debugger already. Fetching files from S3 is indeed something that does not work yet and is blocked by first implementing it

thebiglabasky (Issue Creator) on (2024-12-02 11:41:04 UTC): Yeah sorry that one is for the backend part once we'll look into creating repro environment (cf. parent issue) I'll clarify

thebiglabasky (Issue Creator) on (2025-01-30 13:36:29 UTC): Closing since this is nowhere to be tackled for now

"
2701927106,issue,closed,completed,[Bubble] Tooltip Not Working,"### Describe the bug

After v0.50.31 version, the bubble chart has an error on tooltip...

Before, I could see some data in tooltip, when summarize (ex. group of stores and stores)..

The information was the store's sales, even if the series break on the X axis was a more generic grouping (Group of Stores).

### To Reproduce

1. Create a Bubble chart with 2 grouping (Group of Stores and Stores);
2. Put the Group of Stores as extra series in X axis;
3. Analyze the tooltip!

![Image](https://github.com/user-attachments/assets/4e5933e1-2ef2-4597-a043-cb03eb1cf32c)

![Image](https://github.com/user-attachments/assets/368487da-6c08-44a8-b540-b6a0748044ec)

![Image](https://github.com/user-attachments/assets/55a76099-f1f1-4a85-a39f-41bc64d0a63b)



### Expected behavior

When I select tooltip, the information should be a **Store data** in bubble chart (X and Y axis and Bubble Size data) - in v0.50.30 works nice!

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""pt-BR"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-11"",
      ""tag"": ""v0.51.3"",
      ""hash"": ""d757d0b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.10""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9-LTS"",
    ""java.vendor"": ""Red Hat, Inc."",
    ""java.vendor.url"": ""https://www.redhat.com/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-302.167.6.1.el9uek.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Sao_Paulo""
  }
}
```

### Severity

Is this annoying...

### Additional context

_No response_",felipegranado,2024-11-28 11:51:27+00:00,['alxnddr'],2024-12-12 21:11:05+00:00,2024-12-06 01:53:34+00:00,https://github.com/metabase/metabase/issues/50630,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team'), ('Bug:v51', 'bugs or regressions introduced in v51')]","[{'comment_id': 2540020759, 'issue_id': 2701927106, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.2](https://github.com/metabase/metabase/milestone/291)', 'created_at': datetime.datetime(2024, 12, 12, 21, 11, 4, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-12 21:11:04 UTC):  This should also be released by [v0.52.2](https://github.com/metabase/metabase/milestone/291)

"
2701753979,issue,open,,Add script to load bug report context file,"**Context**
We need a Metabase local instance to be able to load a bug report file to create the reproduction environment.

**This script should be locked to only run in DEVELOPMENT, not production. Given its nature (seeding an AppDB more or less from scratch), running that in production could be disastrous.**

The script should roughly do the following:
* Take the bug report ID as an input parameter
* Fetch the bug report file based on that ID (cf. updating bug report storage issue)
* Provision empty datasources of the appropriate types (Milestone Empty-DS)
* Insert mock data according to fingerprinting info (Milestone Mock-data)
* Import AppDB entities (Milestone AppDB)

Each of these tasks will be described in their own individual tasks since we don't need to have all be implemented at once, but can rather do these incrementally.

**Graceful failure: the point here is to go _as far as we can_ in the reproduction vs reaching for a ""perfect reproduction or nothing"" state. This means that if parts of the process fail we should ideally find graceful ways to carry on or abandon while leaving the environment usable albeit partly populated**",thebiglabasky,2024-11-28 10:53:06+00:00,['escherize'],2025-01-23 09:32:33+00:00,,https://github.com/metabase/metabase/issues/50628,"[('.Backend', '')]","[{'comment_id': 2505924276, 'issue_id': 2701753979, 'author': 'thebiglabasky', 'body': 'Depends on #50627 to align on the name of the task to launch', 'created_at': datetime.datetime(2024, 11, 28, 11, 43, 58, tzinfo=datetime.timezone.utc)}]","thebiglabasky (Issue Creator) on (2024-11-28 11:43:58 UTC): Depends on #50627 to align on the name of the task to launch

"
2701663372,issue,open,reopened,Generate script to create a local repro environment,"**Context**
We want to make it dead simple to spin off a reproduction environment from a given bug report. To that end, we should generate a simple shell script which, at a minimum allows to launch the JAR of the appropriate Metabase version, or allows to pull the appropriate source from the Metabase repo.

We can later iterate on the simplest version of this to have this script expecting some bug repro routine being available to launch from within package.json or something, but that's outside the scope of this specific issue.

More in: https://github.com/metabase/metabase/issues/50746)

[Figma Mockup](https://www.figma.com/design/WgDAPAPew3geiQ0HrtHS59/Debugger-milestones?node-id=1-2&node-type=frame&t=ASplZ9iCrgiLc5Su-11)",thebiglabasky,2024-11-28 10:34:44+00:00,[],2025-02-04 20:25:59+00:00,,https://github.com/metabase/metabase/issues/50627,"[('Feature', None)]","[{'comment_id': 2512046956, 'issue_id': 2701663372, 'author': 'filiphric', 'body': 'based on todays meeting, Im considering this task to be blocked until we have the script available. once we have an idea on what that script looks like, we can show it in the debugger', 'created_at': datetime.datetime(2024, 12, 2, 16, 26, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2512191810, 'issue_id': 2701663372, 'author': 'escherize', 'body': ""I think the 4th step should be a new milestone. I'll split it out into its own issue."", 'created_at': datetime.datetime(2024, 12, 2, 17, 10, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2512212860, 'issue_id': 2701663372, 'author': 'escherize', 'body': ""I have the script running locally: \n\n```\nUsage: ./setup.sh <commit-hash> [port]\nExample: ./setup.sh v1.51.5\nExample: ./setup.sh v1.51.5 3333\n```\n\n@filiphric Can you point me to where your template for the shell script lives so I can get it inserted there? I also noticed that the sha on the metabase-version didn't line up with a known sha on the metabase/metabase repo. We should figure out how they fit together."", 'created_at': datetime.datetime(2024, 12, 2, 17, 20, 1, tzinfo=datetime.timezone.utc)}, {'comment_id': 2546069648, 'issue_id': 2701663372, 'author': 'thebiglabasky', 'body': ""@escherize is the `setup.sh` script living in the main Metabase repo? i.e. I'd imagine the script shown on the Debugger being self-sufficient as in: \n* Copy to clipboard from my browser\n* Paste in my terminal\n* Run\n*  \n\nDid you envision something else?"", 'created_at': datetime.datetime(2024, 12, 16, 16, 22, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2607799950, 'issue_id': 2701663372, 'author': 'thebiglabasky', 'body': ""I'm thinking of reworking this issue with the first simplest step: run using JAR or mb-jar or clone the right tag from GH and leave it to the person to build and launch from there.\nThat's something we could easily generate in the debugger's frontend for now and iterate on later.\n\nI'll adjust the description."", 'created_at': datetime.datetime(2025, 1, 22, 17, 7, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2624537506, 'issue_id': 2701663372, 'author': 'thebiglabasky', 'body': ""Closing as we're moving to Linear + this is nowhere to be tackled for now"", 'created_at': datetime.datetime(2025, 1, 30, 13, 36, 12, tzinfo=datetime.timezone.utc)}]","filiphric on (2024-12-02 16:26:16 UTC): based on todays meeting, Im considering this task to be blocked until we have the script available. once we have an idea on what that script looks like, we can show it in the debugger

escherize on (2024-12-02 17:10:32 UTC): I think the 4th step should be a new milestone. I'll split it out into its own issue.

escherize on (2024-12-02 17:20:01 UTC): I have the script running locally: 

```
Usage: ./setup.sh <commit-hash> [port]
Example: ./setup.sh v1.51.5
Example: ./setup.sh v1.51.5 3333
```

@filiphric Can you point me to where your template for the shell script lives so I can get it inserted there? I also noticed that the sha on the metabase-version didn't line up with a known sha on the metabase/metabase repo. We should figure out how they fit together.

thebiglabasky (Issue Creator) on (2024-12-16 16:22:22 UTC): @escherize is the `setup.sh` script living in the main Metabase repo? i.e. I'd imagine the script shown on the Debugger being self-sufficient as in: 
* Copy to clipboard from my browser
* Paste in my terminal
* Run
*  

Did you envision something else?

thebiglabasky (Issue Creator) on (2025-01-22 17:07:59 UTC): I'm thinking of reworking this issue with the first simplest step: run using JAR or mb-jar or clone the right tag from GH and leave it to the person to build and launch from there.
That's something we could easily generate in the debugger's frontend for now and iterate on later.

I'll adjust the description.

thebiglabasky (Issue Creator) on (2025-01-30 13:36:12 UTC): Closing as we're moving to Linear + this is nowhere to be tackled for now

"
2701620458,issue,open,,Adapt bug reporter to use the updated endpoint to submit bug reports,"**Context**
Once the bug report details endpoint is adapted, we should ensure the bug reporter makes use of it to constitute the bug report.

We should discuss the design of the bug report JSON, and could consider putting the whole API response in a different section. There would though be some overlap with data structures we're already taking from the frontend so this is worth checking before detailing the exact plan.

Depends on https://github.com/metabase/metabase/issues/50625 and https://github.com/metabase/metabase/issues/50646",thebiglabasky,2024-11-28 10:17:06+00:00,[],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50626,[],[],
2701611623,issue,open,reopened,Add parameter to `/util/bug_report_details` endpoint to export more bug details,"**Context**
Without introducing a breaking change to the `/util/bug_report_details` endpoint, we want to add ways to gather more information about a dedicated bug.

This should be done by adding:

* `include` which may take a comma-separated list of values:
   - `dsdef`: the data source definition (as exported by the `/database/:id?include=tables.fields` endpoint)
   - `etree`: an export of the entity and its dependencies to allow repopulating the AppDB in the reproduction environment
* `eid`: the entity ID to pull from
* `etype` the entity type being one of `collection`, `model`, `metric`, `dashboard`, `question`

Names can be challenged :)

[Flow chart available in Figjam](https://www.figma.com/board/Mva83hChGa7yqeDNdoVfVF/Reporter-%2B-Debugger-flows?node-id=1-606&node-type=section&t=9MzaxYI453SvRrTp-11)",thebiglabasky,2024-11-28 10:14:10+00:00,[],2025-01-30 13:41:20+00:00,,https://github.com/metabase/metabase/issues/50625,[],"[{'comment_id': 2624538602, 'issue_id': 2701611623, 'author': 'thebiglabasky', 'body': 'Closing since this is nowhere to be tackled for now', 'created_at': datetime.datetime(2025, 1, 30, 13, 36, 41, tzinfo=datetime.timezone.utc)}]","thebiglabasky (Issue Creator) on (2025-01-30 13:36:41 UTC): Closing since this is nowhere to be tackled for now

"
2701588050,issue,open,,Gather extra details to add to the bug report,"**Context**
We need the bug report to contain more information in order to reproduce a more accurate environment.

**Important: exported entities should account for the customer's plan. This means that anything requiring code belonging to the Pro and Enterprise features limits the ""extended"" bug report contents to Pro and Enterprise users. Free and starter users will have a lighter bug report, which will limit the options to create reproduction environments.**

_Note: I'll use ""offending entity"" to designate the element the user was consulting whenever facing a bug. This can be a collection, a metric, a question, a dashboard or a model._

* Nothing extra for milestone [MB-from-source](https://www.notion.so/metabase/Make-it-blazingly-fast-for-us-to-reproduce-and-fix-bugs-11f69354c90180418a27cc39714f3047?pvs=4#12769354c901804babbcfe70ec248dac)
* For milestone [Empty-DS](https://www.notion.so/metabase/Make-it-blazingly-fast-for-us-to-reproduce-and-fix-bugs-11f69354c90180418a27cc39714f3047?pvs=4#13d69354c9018096af4edddae87ae5fa): 
  * The list of datasources and datasource vendor used by the offending entity (note: this is already present in the data gathered by the diagnostics tool today)
* For milestone [Mock-data](https://www.notion.so/metabase/Make-it-blazingly-fast-for-us-to-reproduce-and-fix-bugs-11f69354c90180418a27cc39714f3047?pvs=4#12769354c90180ef9beef9e5cebcd7c8) :
  * The exhaustive definition of datasources as returned by our API `/api/database/:id?include=tables.fields` or export
* For milestone [AppDB](https://www.notion.so/metabase/Make-it-blazingly-fast-for-us-to-reproduce-and-fix-bugs-11f69354c90180418a27cc39714f3047?pvs=4#12769354c90180d9a35ffa663b766de4) 
  * An export of parts of the AppDB entities which define the offending entity

This overall would be best achieved by having a single endpoint dedicated to gathering bug context data, and delegate that gathering to the backend so we keep some flexibility and control over what gets produced.
We already have [`/util/bug_report_details`](https://stats.metabase.com/api/docs/#tag/util/GET/util/bug_report_details) so I suggest we piggyback on this endpoint to add what we need based on what users select to be part of their diagnostics info.
All this is broken down in subtasks 
",thebiglabasky,2024-11-28 10:04:15+00:00,[],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50624,[],[],
2701552761,issue,open,,Generate reproduction environments from bug reports,"### Links

- [product doc](https://www.notion.so/metabase/Make-it-blazingly-fast-for-us-to-reproduce-and-fix-bugs-11f69354c90180418a27cc39714f3047?pvs=4)
- technical design doc: to do
- testing plan: to do
",thebiglabasky,2024-11-28 09:49:29+00:00,[],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50622,[],[],
2701226957,issue,closed,completed,Add queryResults to the viewer,"queryResults were not in the scope of the original debugger, this probably needs to be built with an interface that can help navigate through it easily. We can still show the raw data, but a viewer would remove obstacles towards smooth debugging
",filiphric,2024-11-28 08:03:17+00:00,['filiphric'],2025-01-23 08:58:58+00:00,2024-12-16 14:53:48+00:00,https://github.com/metabase/metabase/issues/50618,[],"[{'comment_id': 2520010958, 'issue_id': 2701226957, 'author': 'filiphric', 'body': '@thebiglabasky I think actually some basic design would help here. Im not sure at this moment what would be the best way to display queryResults data. We always show the raw searchable data, but if theres a UI that could improve the debugging experience I dont know what that would look like', 'created_at': datetime.datetime(2024, 12, 5, 11, 12, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2520033337, 'issue_id': 2701226957, 'author': 'thebiglabasky', 'body': ""True. I think we could start simply showing the raw JSON data. and leave folks navigate it using the editor as that's the simplest to implement.\n\nWe can later imagine if we want more of a table view of sorts since most results are tabular by nature, but I don't think that's a priority until we have had a few people using it.\nI'll clarify this issue and create another in the backlog to have a fancier results view.\n\nEDIT: I realized just now that the issue IS about the fancier view  \nThen the ideal would be to get a raw table view, paginated, using some standard table React component as a first iteration, not worrying about column types etc. Something like [this](https://react-data-table-component.netlify.app/?path=/docs/getting-started-kitchen-sink--docs) maybe?"", 'created_at': datetime.datetime(2024, 12, 5, 11, 23, 3, tzinfo=datetime.timezone.utc)}]","filiphric (Issue Creator) on (2024-12-05 11:12:39 UTC): @thebiglabasky I think actually some basic design would help here. Im not sure at this moment what would be the best way to display queryResults data. We always show the raw searchable data, but if theres a UI that could improve the debugging experience I dont know what that would look like

thebiglabasky on (2024-12-05 11:23:03 UTC): True. I think we could start simply showing the raw JSON data. and leave folks navigate it using the editor as that's the simplest to implement.

We can later imagine if we want more of a table view of sorts since most results are tabular by nature, but I don't think that's a priority until we have had a few people using it.
I'll clarify this issue and create another in the backlog to have a fancier results view.

EDIT: I realized just now that the issue IS about the fancier view  
Then the ideal would be to get a raw table view, paginated, using some standard table React component as a first iteration, not worrying about column types etc. Something like [this](https://react-data-table-component.netlify.app/?path=/docs/getting-started-kitchen-sink--docs) maybe?

"
2701094869,issue,closed,completed,Update admin settings,"Epic: https://github.com/metabase/metabase/issues/50503

[Tech doc](https://www.notion.so/metabase/Streamline-embed-flow-when-embedding-features-are-off-13869354c90180b4bc02ca29ebf61ad2?pvs=4#14269354c901807ebcf8ff557a875aba)

The [links are confirmed here.](https://metaboat.slack.com/archives/C063Q3F1HPF/p1732892823162379)

```[tasklist]
### Tasks
- [x] [Add a quick start link to the Interactive Embedding admin settings page.](https://www.notion.so/metabase/Streamline-embed-flow-when-embedding-features-are-off-13869354c90180b4bc02ca29ebf61ad2?pvs=4#14269354c901807ebcf8ff557a875aba)
- [x] [Make the Interactive Embedding card on admin settings grey when on OSS (unavailable)](https://www.notion.so/metabase/Streamline-embed-flow-when-embedding-features-are-off-13869354c90180b4bc02ca29ebf61ad2?pvs=4#14c69354c90180f3adb8ddbd0886642e)
```",WiNloSt,2024-11-28 07:19:03+00:00,[],2024-12-04 06:07:19+00:00,2024-12-04 06:07:19+00:00,https://github.com/metabase/metabase/issues/50616,[],[],
2701062983,issue,open,,Currency Sign Defaulting to USD in Email Subscriptions,"Describe the Bug
When using the email subscription feature for dashboards, the currency sign defaults to USD ($) in the email, even if the dashboard visualizations are set to a different currency (e.g., INR ). For instance, a trend visualization on the dashboard that uses  appears with $ in the subscription email, causing confusion for users expecting consistent currency formatting.

Logs
Please refer to the attached server logs and JavaScript console logs for more details around the time the bug occurred.

To Reproduce
Steps to reproduce the issue:

Create a dashboard in Metabase with a trend visualization where the currency is set to INR ().
Save the dashboard and ensure the currency format is applied correctly.
Set up an email subscription for the dashboard.
Check the email notification received.
Observe that the trend visualization in the email displays the currency as USD ($) instead of INR ().
Expected Behavior
The email subscription should retain the currency format specified in the dashboard (e.g., INR ) instead of defaulting to USD ($).

Screenshots
Dashboard Visualization (Expected Currency Format):

Email Subscription (Incorrect Currency Format):

Severity
Moderate. This issue is:

Annoying for users who rely on email subscriptions for financial data.
Causes discrepancies in understanding and interpreting the data.
May affect the reliability of the email subscription feature for financial reports.
Additional Context
The issue seems to stem from the email subscription system not inheriting the currency format settings from the dashboard. This could potentially be related to the localization or formatting configuration for the email rendering process.

Metabase Diagnostic Info

json
Copy code
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""bigquery-cloud-sdk"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-26"",
      ""tag"": ""v0.51.5"",
      ""hash"": ""d79d949""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.6 (Debian 16.6-1.pgdg120+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""4.19.0-27-cloud-amd64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Kolkata""
  }
}",HarshClinikally,2024-11-28 06:59:23+00:00,[],2025-02-04 20:25:20+00:00,,https://github.com/metabase/metabase/issues/50615,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Customization/Formatting', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2700276745,issue,open,,Eliminate loki tests flakiness,"**Context**

Some loki specs are flaky including embedding, scatter, and sankey tests so we need to stabilize them. Example PR: https://github.com/metabase/metabase/pull/50607/files

[Another Slack report](https://metaboat.slack.com/archives/C505ZNNH4/p1734392766178629) about popovers.
",alxnddr,2024-11-28 00:09:12+00:00,[],2025-02-04 20:29:49+00:00,,https://github.com/metabase/metabase/issues/50608,"[('Type:Tech Debt', 'or Refactoring'), ('.CI & Tests', ''), ('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2699871951,issue,closed,completed,Entity Picker generates wrong initial path when inital value is in another users personal collection,"### Describe the bug

Collection picker does not properly generate an initial path when the initial value is a collection in another users personal collection

### To Reproduce

1. Sign in as an admin.
2. New -> Dashboard -> Open collection picker
3. Pick a collection in another users personal collection
4. Click select, then re-open the collection picker
5. The path will start from our analytics and be incorrect


### Expected behavior

Path should start from ""All users personal collections""

### Logs

_No response_

### Information about your Metabase installation

```JSON
8c2b6e8945a8a52f1212b5c4ee75d9ee1cddb3d9
```

### Severity

p2. Likely not a very common use case, but should be fixed

### Additional context

_No response_",npfitz,2024-11-27 21:27:49+00:00,['npfitz'],2024-12-10 13:34:10+00:00,2024-12-04 02:43:24+00:00,https://github.com/metabase/metabase/issues/50604,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('Organization/Entity picker', '')]",[],
2699863734,issue,closed,not_planned,Export CSV button on cards does not work,"### Describe the bug

The Export CSV button for cards in dashboards does not work. When attempting to export a card's data using the button, Metabase makes a request to:

```
POST /dashboard/api/4/dashcard/6/card/7/query/csv
```

This results in a 404 Not Found error. The following is logged:
```
WARN middleware.log :: POST /api/4/dashcard/6/card/7/query/csv 404 129,8 s (0 DB calls) {:metabase-user-id 3}
metabase.util.i18n.UserLocalizedString{:format-string ""API endpoint does not exist."", :args [], :pluralization-opts {}}
```

However, manually executing a POST request to:
```
POST /dashboard/api/card/7/query/csv
```
successfully downloads the data in CSV format.

Here is an example of the cURL command that works:
```
curl -X POST \
  -H ""Content-Type: application/json"" \
  -H ""Cookie: JSESSIONID=...; metabase.DEVICE=...; metabase.SESSION=...; metabase.TIMEOUT=..."" \
  -d '{""parameters"": []}' \
  ""https://<my-metabase-url>/dashboard/api/card/7/query/csv""

```

This indicates the Export CSV button is pointing to the wrong endpoint.



### To Reproduce

1. Open a dashboard with cards in Metabase.
2. Click the Export CSV button on a card.
3. Observe the error in the logs

### Expected behavior

The Export CSV button should correctly call the api and download the data in CSV format without requiring a manual POST request.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""es-ES"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-19"",
      ""tag"": ""v0.51.4"",
      ""hash"": ""47f05f3""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.20""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9-LTS"",
    ""java.vendor"": ""Red Hat, Inc."",
    ""java.vendor.url"": ""https://www.redhat.com/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""3.10.0-1160.114.2.el7.x86_64"",
    ""user.language"": ""es"",
    ""user.timezone"": ""Europe/Madrid""
  }
}
```

### Severity

high

### Additional context

_No response_",rodrigoGA,2024-11-27 21:23:20+00:00,['alxnddr'],2024-12-01 00:56:32+00:00,2024-12-01 00:56:31+00:00,https://github.com/metabase/metabase/issues/50603,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Reporting/Export', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2506215385, 'issue_id': 2699863734, 'author': 'rodrigoGA', 'body': 'Just to clarify: it also happens with the other types of downloads on the dashboard cards.', 'created_at': datetime.datetime(2024, 11, 28, 14, 10, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2509060473, 'issue_id': 2699863734, 'author': 'dpsutton', 'body': ""I'm not able to recreate this. On 1.51.5 i can download results from a dashcard:\n![Image](https://github.com/user-attachments/assets/8f6780a4-43bd-4f17-842e-9431010f6a0c)\n\nThe network tab shows that my browser requested `http://localhost:3006/api/dashboard/9/dashcard/68/card/85/query/csv`\n\nOn the backend I have a log that the browser hit\n```shell\n2024-11-27 21:11:31,933 DEBUG middleware.log :: POST /api/dashboard/9/dashcard/68/card/85/query/csv 200 [ASYNC: completed] 85.0 ms (23 DB calls) App DB connections: 0/15 Jetty threads: 4/50 (7 idle, 0 queued) (110 total active threads) Queries in flight: 0 (0 queued); h2 DB 1 connections: 0/9 (0 threads blocked) {:metabase-user-id 1}\n```\n\nBut one thing I want to point out is that i'm hitting \n`api/dashboard/<dash-id>/dashcard/<dashcard-id>/card/<card-id>/query/<format>`\n\nYou have several different formats listed:\n`POST /dashboard/api/4/dashcard/6/card/7/query/csv` (api is after dashboard)\n`POST /api/4/dashcard/6/card/7/query/csv` (missing dashboard)\n`POST /dashboard/api/card/7/query/csv` (missing dashcard, dashcard id, api after dashboard)\n\nI only point this out because these all look like they were copy-pasted from logs and network tabs so it's surprising that there were transcription errors. Can you put the _exact_ routes (omit the domain of course) that are 404'ing and also where exactly in the UI you are initiating the download?\n\nI'm getting the above routes `http://localhost:3006/api/dashboard/9/dashcard/68/card/85/query/csv` and getting these downloads when viewing a dashboard, clicking the three dots on a dashcard and clicking download results:\n\n![Image](https://github.com/user-attachments/assets/060fb8a0-b03c-49c4-840a-77fd1b9e3744)"", 'created_at': datetime.datetime(2024, 11, 30, 16, 58, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2509125133, 'issue_id': 2699863734, 'author': 'rodrigoGA', 'body': '@dpsutton  In my case, Metabase is behind an Apache server, and the URL where Metabase is deployed is: **subdomain.domain.com/dashboard**\n\nIf I try to download data from a card, I see the following in the browser console:\n\n![Image](https://github.com/user-attachments/assets/15f83624-dba1-4fcc-9b6d-c6f3ca045e5e)\n\n![Image](https://github.com/user-attachments/assets/b70c5f06-ed42-45ba-ba54-e86abf235c59)\nThe server log:\n![Image](https://github.com/user-attachments/assets/d43d6e4c-c5ed-4bee-b829-de7819fe1d71)\n\nNow I tried to replicate the behavior from the console by extracting the cookies from the browser, and I got the same result.\n\nIn the list of APIs, I couldnt find the /dashcard API, but I found the card API: https://www.metabase.com/docs/latest/api/card.\n\nSo, I attempted to make a POST request to that API, and the CSV was successfully downloaded.\n```\ncurl -X POST \\\n  -H ""Content-Type: application/json"" \\\n  -H ""Cookie: JSESSIONID=..; metabase.DEVICE=...; metabase.SESSION=...; metabase.TIMEOUT=alive"" \\\n  -d \'{""parameters"": []}\' \\\n  ""https://midominio.com/dashboard/api/card/7/query/csv""\n```\n\nTherefore, the issue might be related to the fact that my Metabase is deployed behind /dashboard, and this is configured on the Metabase site.\n\n![Image](https://github.com/user-attachments/assets/0ea7f3a8-42d5-4e25-8a06-3eb71cd1d370)\n\n\nPerhaps there is an issue with how URLs are handled in the backend. It is strange that the POST is made to the dashboard API, but the backend logs show dashcard.', 'created_at': datetime.datetime(2024, 11, 30, 18, 3, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2509176898, 'issue_id': 2699863734, 'author': 'rodrigoGA', 'body': 'Here is an example of how to reproduce it:\n\n1.Start the following Docker Compose\ndocker-compose.yml\n```\nversion: \'3.8\'\n\nservices:\n  proxy:\n    image: nginx:latest\n    container_name: nginx-proxy-metabase\n    ports:\n      - ""80:80""\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf:ro\n    depends_on:\n      - metabase\n\n  metabase:\n    image: metabase/metabase:v0.51.6.2\n    container_name: metabase\n    environment:\n      - MB_DB_FILE=/metabase-data/metabase.db\n    volumes:\n      - ./metabase-data:/metabase-data\n    ports:\n      - ""3000:3000"" \n``` \nnginx.conf\n```\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    server {\n        listen 80;\n\n        location /dashboard/ {\n            rewrite ^/dashboard(/.*)$ $1 break;\n            proxy_pass http://metabase:3000/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n            proxy_set_header X-Forwarded-Prefix /dashboard;\n\n            # Substituciones para recursos estticos\n            sub_filter \'/app/\' \'/dashboard/app/\';\n            sub_filter \'/api/\' \'/dashboard/api/\';\n            sub_filter_once off;\n            proxy_set_header Accept-Encoding """";\n        }\n\n        location / {\n            return 404;\n        }\n    }\n}\n```\n\n4. Go to localhost:3000 and set up Metabase.\n5. Then go to Settings > General > Site URL and set it to localhost/dashboard\n6. Open localhost/dashboard in your browser.\n7. Go to a sample dashboard and try to download a card.', 'created_at': datetime.datetime(2024, 11, 30, 19, 58, 50, tzinfo=datetime.timezone.utc)}, {'comment_id': 2509503084, 'issue_id': 2699863734, 'author': 'paoliniluis', 'body': ""@rodrigoGA you're seeing https://github.com/metabase/metabase/issues/30895, and also, you're not rewriting correctly every request that goes to the backend"", 'created_at': datetime.datetime(2024, 12, 1, 0, 56, 31, tzinfo=datetime.timezone.utc)}]","rodrigoGA (Issue Creator) on (2024-11-28 14:10:54 UTC): Just to clarify: it also happens with the other types of downloads on the dashboard cards.

dpsutton on (2024-11-30 16:58:47 UTC): I'm not able to recreate this. On 1.51.5 i can download results from a dashcard:
![Image](https://github.com/user-attachments/assets/8f6780a4-43bd-4f17-842e-9431010f6a0c)

The network tab shows that my browser requested `http://localhost:3006/api/dashboard/9/dashcard/68/card/85/query/csv`

On the backend I have a log that the browser hit
```shell
2024-11-27 21:11:31,933 DEBUG middleware.log :: POST /api/dashboard/9/dashcard/68/card/85/query/csv 200 [ASYNC: completed] 85.0 ms (23 DB calls) App DB connections: 0/15 Jetty threads: 4/50 (7 idle, 0 queued) (110 total active threads) Queries in flight: 0 (0 queued); h2 DB 1 connections: 0/9 (0 threads blocked) {:metabase-user-id 1}
```

But one thing I want to point out is that i'm hitting 
`api/dashboard/<dash-id>/dashcard/<dashcard-id>/card/<card-id>/query/<format>`

You have several different formats listed:
`POST /dashboard/api/4/dashcard/6/card/7/query/csv` (api is after dashboard)
`POST /api/4/dashcard/6/card/7/query/csv` (missing dashboard)
`POST /dashboard/api/card/7/query/csv` (missing dashcard, dashcard id, api after dashboard)

I only point this out because these all look like they were copy-pasted from logs and network tabs so it's surprising that there were transcription errors. Can you put the _exact_ routes (omit the domain of course) that are 404'ing and also where exactly in the UI you are initiating the download?

I'm getting the above routes `http://localhost:3006/api/dashboard/9/dashcard/68/card/85/query/csv` and getting these downloads when viewing a dashboard, clicking the three dots on a dashcard and clicking download results:

![Image](https://github.com/user-attachments/assets/060fb8a0-b03c-49c4-840a-77fd1b9e3744)

rodrigoGA (Issue Creator) on (2024-11-30 18:03:36 UTC): @dpsutton  In my case, Metabase is behind an Apache server, and the URL where Metabase is deployed is: **subdomain.domain.com/dashboard**

If I try to download data from a card, I see the following in the browser console:

![Image](https://github.com/user-attachments/assets/15f83624-dba1-4fcc-9b6d-c6f3ca045e5e)

![Image](https://github.com/user-attachments/assets/b70c5f06-ed42-45ba-ba54-e86abf235c59)
The server log:
![Image](https://github.com/user-attachments/assets/d43d6e4c-c5ed-4bee-b829-de7819fe1d71)

Now I tried to replicate the behavior from the console by extracting the cookies from the browser, and I got the same result.

In the list of APIs, I couldnt find the /dashcard API, but I found the card API: https://www.metabase.com/docs/latest/api/card.

So, I attempted to make a POST request to that API, and the CSV was successfully downloaded.
```
curl -X POST \
  -H ""Content-Type: application/json"" \
  -H ""Cookie: JSESSIONID=..; metabase.DEVICE=...; metabase.SESSION=...; metabase.TIMEOUT=alive"" \
  -d '{""parameters"": []}' \
  ""https://midominio.com/dashboard/api/card/7/query/csv""
```

Therefore, the issue might be related to the fact that my Metabase is deployed behind /dashboard, and this is configured on the Metabase site.

![Image](https://github.com/user-attachments/assets/0ea7f3a8-42d5-4e25-8a06-3eb71cd1d370)


Perhaps there is an issue with how URLs are handled in the backend. It is strange that the POST is made to the dashboard API, but the backend logs show dashcard.

rodrigoGA (Issue Creator) on (2024-11-30 19:58:50 UTC): Here is an example of how to reproduce it:

1.Start the following Docker Compose
docker-compose.yml
```
version: '3.8'

services:
  proxy:
    image: nginx:latest
    container_name: nginx-proxy-metabase
    ports:
      - ""80:80""
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - metabase

  metabase:
    image: metabase/metabase:v0.51.6.2
    container_name: metabase
    environment:
      - MB_DB_FILE=/metabase-data/metabase.db
    volumes:
      - ./metabase-data:/metabase-data
    ports:
      - ""3000:3000"" 
``` 
nginx.conf
```
events {
    worker_connections 1024;
}

http {
    server {
        listen 80;

        location /dashboard/ {
            rewrite ^/dashboard(/.*)$ $1 break;
            proxy_pass http://metabase:3000/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Prefix /dashboard;

            # Substituciones para recursos estticos
            sub_filter '/app/' '/dashboard/app/';
            sub_filter '/api/' '/dashboard/api/';
            sub_filter_once off;
            proxy_set_header Accept-Encoding """";
        }

        location / {
            return 404;
        }
    }
}
```

4. Go to localhost:3000 and set up Metabase.
5. Then go to Settings > General > Site URL and set it to localhost/dashboard
6. Open localhost/dashboard in your browser.
7. Go to a sample dashboard and try to download a card.

paoliniluis on (2024-12-01 00:56:31 UTC): @rodrigoGA you're seeing https://github.com/metabase/metabase/issues/30895, and also, you're not rewriting correctly every request that goes to the backend

"
2699838303,issue,closed,completed,Entity picker does not allow selecting questions in read-only collections,"### Describe the bug

The entity picker is used when selecting a question in a dashboard section or replacing a question on a dashboard. It shows questions from read-only collections, but you cannot select any of them. Doing so only highlights the question, but no action is taken and no error is displayed.

It appears this is intentional (see link below), but I'm not sure why. Especially since there's no such restriction when _adding_ a new question to a dashboard since it doesn't use the entity picker.

https://github.com/metabase/metabase/blob/41dca7623257d1b73d4065f7804cb5e370801d36/frontend/src/metabase/common/components/QuestionPicker/components/QuestionPickerModal.tsx#L38

### To Reproduce

1. Create a new dashboard
2. Add a dashboard section
3. For any of the empty questions in the section, try to choose a question in a read-only collection

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""duckdb"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-11-26"",
      ""tag"": ""v51.3.1"",
      ""hash"": ""689a04d""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.6 (Debian 15.6-1.pgdg120+2)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.10.4-linuxkit"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```

### Severity

Blocking an upgrade

### Additional context

_No response_",eskrm,2024-11-27 21:09:41+00:00,['npfitz'],2024-12-03 20:21:33+00:00,2024-12-03 20:21:32+00:00,https://github.com/metabase/metabase/issues/50602,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('Organization/Entity picker', '')]",[],
2699821784,issue,open,,Automatic binning generates incorrect ranges and number of bins,"Auto binning generates incorrect `:binning_info` and incorrect number of bins. I suspected it is happening due to use of negative numbers, but as @ranquild noted [on slack](https://metaboat.slack.com/archives/C0645JP1W81/p1732734611313369), the probable cause is insufficient fingerprinting. More details can be found in the linked slack thread.

To reproduce: Auto bin the Orders, Total. The `:binning_info` contains (1) different number of bins and (2) different ranges to what is present in the returned data.

",lbrdnk,2024-11-27 21:00:34+00:00,[],2025-02-04 20:27:55+00:00,,https://github.com/metabase/metabase/issues/50600,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Querying/Processor', ''), ('Difficulty:Hard', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2504763847, 'issue_id': 2699821784, 'author': 'lbrdnk', 'body': 'Underlying cause _may_ be the same as in https://github.com/metabase/metabase/issues/9321 and https://github.com/metabase/metabase/issues/7782 and https://github.com/metabase/metabase/issues/12004.', 'created_at': datetime.datetime(2024, 11, 27, 21, 2, 6, tzinfo=datetime.timezone.utc)}]","lbrdnk (Issue Creator) on (2024-11-27 21:02:06 UTC): Underlying cause _may_ be the same as in https://github.com/metabase/metabase/issues/9321 and https://github.com/metabase/metabase/issues/7782 and https://github.com/metabase/metabase/issues/12004.

"
2699657524,issue,open,,Collections that are children of collections that you don't have access to show up in all ancestors when looking at collection items,"### Describe the bug

If you have a series of collections that are children of each other (eg: Col A -> Col B -> Col C -> Col D), and limit the access of one of the collections in the middle (Col C), then Col D will show up in calls to `GET /api/collections/:id/items` for the `root` collection, as well as Col A and Col B. In looking at the values returned, it also looks like the collection_id prop of the item is being incorrectly calculated as whatever collection we're currently looking at. For example:

 `GET /api/collections/root/items` would return:
```
[
  {
    model: ""collection"",
    name: ""Col D"",
    collection_id: null
  },
  ...
]
```

and, if 10 was the collection id of Col A, then  `GET /api/collections/root/items` would return:
```
[
  {
    model: ""collection"",
    name: ""Col D"",
    collection_id: 10
  }
  ...
]
```

Interestingly, the `effective_location` and `location` properties are correct

### To Reproduce

1. Create a series of collections that are children of each other,
2. Limit the access of the second to last collection in the chain,
3. sign in as a user without permission to see the restricted collection,
4. Notice that the collection items pages for the parent collections will list the incorrect child collection at the end of the chain


### Expected behavior

The child collection should only show in it's direct parent that you have access to.

### Logs

_No response_

### Information about your Metabase installation

```JSON
8c2b6e8945a8a52f1212b5c4ee75d9ee1cddb3d9
```

### Severity

Doesn't break any functionality, but can cause some weird behavior, and is incorrect

### Additional context

_No response_",npfitz,2024-11-27 19:48:53+00:00,[],2025-02-05 19:32:42+00:00,,https://github.com/metabase/metabase/issues/50598,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Permissions', 'Collection or Data permissions'), ('.Frontend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2699448798,issue,open,,Slow GET /api/database blocks option to select New menu after opening home screen,"### Describe the bug

Hi team,

After the update to v0.51.3.3 from v.0.49, we notice an issue with the the endpoint GET /api/database. When the user logs in or opens the home page, the selections are blocked and are waiting for this endpoint.

![Image](https://uploads.linear.app/a24a1a82-ddc8-4567-aacc-c3804ea2385e/fadeb9f1-336f-4388-96bd-4fe3aa713735/a2497637-3915-4b1d-8b90-de2e114cbe37?signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXRoIjoiL2EyNGExYTgyLWRkYzgtNDU2Ny1hYWNjLWMzODA0ZWEyMzg1ZS9mYWRlYjlmMS0zMzZmLTQzODgtOTZiZC00ZmUzYWE3MTM3MzUvYTI0OTc2MzctMzkxNS00YjFkLThiOTAtZGUyZTExNGNiZTM3IiwiaWF0IjoxNzM4NzgzMzEyLCJleHAiOjMzMzA5MzQzMzEyfQ.99Vnx80JRHA1BQDIKGFUzGeBlNCJ25y3fWdULEtSeTE)

![Image](https://uploads.linear.app/a24a1a82-ddc8-4567-aacc-c3804ea2385e/8471807a-1ce4-47ce-a51c-0a90244ab8a0/66bbe695-7a89-48dc-931d-446b3ee6807e?signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXRoIjoiL2EyNGExYTgyLWRkYzgtNDU2Ny1hYWNjLWMzODA0ZWEyMzg1ZS84NDcxODA3YS0xY2U0LTQ3Y2UtYTUxYy0wYTkwMjQ0YWI4YTAvNjZiYmU2OTUtN2E4OS00OGRjLTkzMWQtNDQ2YjNlZTY4MDdlIiwiaWF0IjoxNzM4NzgzMzEyLCJleHAiOjMzMzA5MzQzMzEyfQ.85MSSkUMx-Wsim4I-jSXUV_b8RUKYTI28PwTHuApREA)

![Image](https://uploads.linear.app/a24a1a82-ddc8-4567-aacc-c3804ea2385e/4d26cd2c-d1f5-47fc-a956-bbd2ecdab080/c6083f5b-5300-431a-ab14-dfaf0555aef0?signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXRoIjoiL2EyNGExYTgyLWRkYzgtNDU2Ny1hYWNjLWMzODA0ZWEyMzg1ZS80ZDI2Y2QyYy1kMWY1LTQ3ZmMtYTk1Ni1iYmQyZWNkYWIwODAvYzYwODNmNWItNTMwMC00MzFhLWFiMTQtZGZhZjA1NTVhZWYwIiwiaWF0IjoxNzM4NzgzMzEyLCJleHAiOjMzMzA5MzQzMzEyfQ.6r6-wUUrq4x3GN3Zr9qmvpTQQGTX6Tm0xFAWgv5ROc8)

### To Reproduce

1. Go to 'home page'
2. Interface elements are not visible until GET /api/database finishes in \~10 seconds

### Expected behavior

Speed the GET /api/database or allow users to select UI elementsp

### Logs

*No response*

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""starburst""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-13"",
      ""tag"": ""v0.51.3.3"",
      ""hash"": ""cd3e26b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.13""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.146+"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

annoying, causes user wait times

### Additional context

*No response*",RomantsovArtur,2024-11-27 18:36:30+00:00,[],2025-02-05 19:21:57+00:00,,https://github.com/metabase/metabase/issues/50595,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Performance', ''), ('Misc/API', ''), ('.Backend', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2504566632, 'issue_id': 2699448798, 'author': 'RomantsovArtur', 'body': 'Sometimes it takes up ~ 20 seconds ![Image](https://github.com/user-attachments/assets/8ea65a2f-84b7-463e-8fdf-76c65df00b3c)', 'created_at': datetime.datetime(2024, 11, 27, 18, 38, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2504586730, 'issue_id': 2699448798, 'author': 'ranquild', 'body': '@RomantsovArtur how many databases do you have?', 'created_at': datetime.datetime(2024, 11, 27, 18, 52, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2504683346, 'issue_id': 2699448798, 'author': 'paoliniluis', 'body': ""@RomantsovArtur also, what's the sizing of your application database"", 'created_at': datetime.datetime(2024, 11, 27, 20, 1, 10, tzinfo=datetime.timezone.utc)}, {'comment_id': 2504941590, 'issue_id': 2699448798, 'author': 'RomantsovArtur', 'body': ""@ranquild \n\n```\nmetabase_clean=> select count(1) from metabase_database;\n count\n-------\n  1187\n(1 row)\n```\n\n@paoliniluis \n```\nmetabase_clean=> SELECT pg_size_pretty( pg_database_size('metabase_clean') );\n pg_size_pretty\n----------------\n 16 GB\n(1 row)\n```"", 'created_at': datetime.datetime(2024, 11, 27, 22, 49, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2504943075, 'issue_id': 2699448798, 'author': 'RomantsovArtur', 'body': '![Image](https://github.com/user-attachments/assets/03dbfe9b-395b-4f3d-9c8f-847f6793f0bd)', 'created_at': datetime.datetime(2024, 11, 27, 22, 51, 7, tzinfo=datetime.timezone.utc)}, {'comment_id': 2504946118, 'issue_id': 2699448798, 'author': 'RomantsovArtur', 'body': '![Image](https://github.com/user-attachments/assets/ecc9b38d-2ce6-40db-92ab-6774064cd5d6)\n![Image](https://github.com/user-attachments/assets/01d88031-7fc8-4d45-b6d3-dc6de79c8658)', 'created_at': datetime.datetime(2024, 11, 27, 22, 53, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2506002559, 'issue_id': 2699448798, 'author': 'paoliniluis', 'body': '@RomantsovArtur do you use the full 1K databases?', 'created_at': datetime.datetime(2024, 11, 28, 12, 26, 37, tzinfo=datetime.timezone.utc)}, {'comment_id': 2506082161, 'issue_id': 2699448798, 'author': 'RomantsovArtur', 'body': '@paoliniluis Yes, they are pretty much all in use. We detect deprecated ones and remove them periodically', 'created_at': datetime.datetime(2024, 11, 28, 13, 6, 9, tzinfo=datetime.timezone.utc)}]","RomantsovArtur (Issue Creator) on (2024-11-27 18:38:53 UTC): Sometimes it takes up ~ 20 seconds ![Image](https://github.com/user-attachments/assets/8ea65a2f-84b7-463e-8fdf-76c65df00b3c)

ranquild on (2024-11-27 18:52:41 UTC): @RomantsovArtur how many databases do you have?

paoliniluis on (2024-11-27 20:01:10 UTC): @RomantsovArtur also, what's the sizing of your application database

RomantsovArtur (Issue Creator) on (2024-11-27 22:49:35 UTC): @ranquild 

```
metabase_clean=> select count(1) from metabase_database;
 count
-------
  1187
(1 row)
```

@paoliniluis 
```
metabase_clean=> SELECT pg_size_pretty( pg_database_size('metabase_clean') );
 pg_size_pretty
----------------
 16 GB
(1 row)
```

RomantsovArtur (Issue Creator) on (2024-11-27 22:51:07 UTC): ![Image](https://github.com/user-attachments/assets/03dbfe9b-395b-4f3d-9c8f-847f6793f0bd)

RomantsovArtur (Issue Creator) on (2024-11-27 22:53:47 UTC): ![Image](https://github.com/user-attachments/assets/ecc9b38d-2ce6-40db-92ab-6774064cd5d6)
![Image](https://github.com/user-attachments/assets/01d88031-7fc8-4d45-b6d3-dc6de79c8658)

paoliniluis on (2024-11-28 12:26:37 UTC): @RomantsovArtur do you use the full 1K databases?

RomantsovArtur (Issue Creator) on (2024-11-28 13:06:09 UTC): @paoliniluis Yes, they are pretty much all in use. We detect deprecated ones and remove them periodically

"
2699413347,issue,open,,`read-only-mode` setting is visible only to admins,"As the title says, the `read-only-mode` setting is shown only to admins. I confirmed with the Product team that this is wrong. This setting should be visible to everyone.

@iethree raised this concern in [this comment](https://github.com/metabase/metabase/pull/49273#discussion_r1859435109).

I've erroneously assumed that the backend is correct, so I've updated the FE logic to match the backend's. Once the backend fixes this and exposes this setting to all users, the FE needs to be updated as well.",nemanjaglumac,2024-11-27 18:15:38+00:00,[],2025-02-04 20:26:30+00:00,,https://github.com/metabase/metabase/issues/50593,"[('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Operation/Database Migrations', 'Issues with application DB migrations when launching Metabase'), ('.Frontend', ''), ('.Backend', ''), ('Administration/Settings', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2699136872,issue,closed,not_planned,Upgrade netty and jetty to patch CVEs,"### Describe the bug

Our vulnerability scanning exposed the following CVEs that require some dependency upgrades:

```
Java (jar)

Total: 3 (UNKNOWN: 0, LOW: 0, MEDIUM: 1, HIGH: 2, CRITICAL: 0)


                   Library                    Vulnerability   Severity  Status  Installed Version  Fixed Version                            Title                            

 io.netty:netty-common (metabase.jar)         CVE-2024-47535  HIGH      fixed   4.1.104.Final      4.1.115        netty: Denial of Service attack on windows app using Netty 
                                                                                                                  https://avd.aquasec.com/nvd/cve-2024-47535                 
                                                                                                                                                          
                                                                                4.1.86.Final                                                                                 
                                                                                                                                                                             
        
 org.eclipse.jetty:jetty-http (metabase.jar)  CVE-2024-6763   MEDIUM            11.0.24            12.0.12        org.eclipse.jetty:jetty-http: jetty: Jetty URI parsing of  
                                                                                                                  invalid authority                                          
                                                                                                                  https://avd.aquasec.com/nvd/cve-2024-6763                  


``` 

### To Reproduce

1. We use trivvy to scan for vulnerabilities:

```
trivy image metabase/metabase:v0.51.5.1 --scanners vuln
``` 

### Expected behavior

A clean scan.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""iPhone"",
    ""userAgent"": ""Mozilla/5.0 (iPhone; CPU iPhone OS 18_0_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/131.0.6778.73 Mobile/15E148 Safari/604.1"",
    ""vendor"": ""Apple Computer, Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-10-23"",
      ""tag"": ""v0.51.1"",
      ""hash"": ""b8178a8""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.1""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.209-198.812.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```

### Severity

High

### Additional context
https://avd.aquasec.com/nvd/cve-2024-47535 
https://avd.aquasec.com/nvd/cve-2024-6763 

_No response_",Kli16,2024-11-27 16:41:18+00:00,[],2025-02-05 20:44:44+00:00,2025-02-05 20:44:44+00:00,https://github.com/metabase/metabase/issues/50586,"[('Type:Bug', 'Product defects'), ('.Security related', ''), ('Priority:P2', 'Average run of the mill bug'), ('Operation/', ''), ('.Backend', ''), ('dependencies', None), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2504337814, 'issue_id': 2699136872, 'author': 'paoliniluis', 'body': 'Please complete the information that we request, otherwise well close the issue', 'created_at': datetime.datetime(2024, 11, 27, 16, 44, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2504445911, 'issue_id': 2699136872, 'author': 'Kli16', 'body': 'I updated the information. Let me know if I can provide any additional context!', 'created_at': datetime.datetime(2024, 11, 27, 17, 40, 35, tzinfo=datetime.timezone.utc)}, {'comment_id': 2511679461, 'issue_id': 2699136872, 'author': 'dpsutton', 'body': 'On master I see we have \n- `io.netty/netty-common 4.1.115.Final`\n- `org.eclipse.jetty/jetty-http 11.0.24`\n\nSeems netty-common is already fixed. I added a top level dep on jetty-http `12.0.12` in the hopes it would just work. I think we have a concern this drops support for java 8. It also breaks the dev environment (some logging statements omitted)\n\n```clojure\n clj -M:""$ALIASES""\nClojure 1.12.0\nuser=> (do (dev) (start!))\nUnexpected error (ClassNotFoundException) macroexpanding proxy at (ring/adapter/jetty.clj:106:3).\norg.eclipse.jetty.util.MultiException\nuser=>\n```', 'created_at': datetime.datetime(2024, 12, 2, 14, 23, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2537680595, 'issue_id': 2699136872, 'author': 'sidpalas', 'body': 'Regarding the Jetty CVE (CVE-2024-6763):\n\nThe Github Advisory (https://github.com/advisories/GHSA-qh8g-58pp-2wxh) states:\n\n> The impact of this vulnerability is limited to developers that use the Jetty HttpURI directly.\n\nSearching the metabase codebase (https://github.com/search?q=repo%3Ametabase%2Fmetabase%20HttpURI&type=code) I dont see any usage of `HttpURI` so it seems like the vulnerability may not actually impact metabase', 'created_at': datetime.datetime(2024, 12, 12, 2, 53, 10, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-11-27 16:44:36 UTC): Please complete the information that we request, otherwise well close the issue

Kli16 (Issue Creator) on (2024-11-27 17:40:35 UTC): I updated the information. Let me know if I can provide any additional context!

dpsutton on (2024-12-02 14:23:17 UTC): On master I see we have 
- `io.netty/netty-common 4.1.115.Final`
- `org.eclipse.jetty/jetty-http 11.0.24`

Seems netty-common is already fixed. I added a top level dep on jetty-http `12.0.12` in the hopes it would just work. I think we have a concern this drops support for java 8. It also breaks the dev environment (some logging statements omitted)

```clojure
 clj -M:""$ALIASES""
Clojure 1.12.0
user=> (do (dev) (start!))
Unexpected error (ClassNotFoundException) macroexpanding proxy at (ring/adapter/jetty.clj:106:3).
org.eclipse.jetty.util.MultiException
user=>
```

sidpalas on (2024-12-12 02:53:10 UTC): Regarding the Jetty CVE (CVE-2024-6763):

The Github Advisory (https://github.com/advisories/GHSA-qh8g-58pp-2wxh) states:


Searching the metabase codebase (https://github.com/search?q=repo%3Ametabase%2Fmetabase%20HttpURI&type=code) I dont see any usage of `HttpURI` so it seems like the vulnerability may not actually impact metabase

"
2699113756,issue,closed,completed,PDF export cuts dashboards in the middle,"**Context**

Sometimes dashboard PDF export cuts off dashboards
[Slack convo](https://metaboat.slack.com/archives/C05NXACAG1G/p1732663781243499?thread_ts=1732642572.165509&cid=C05NXACAG1G)

",alxnddr,2024-11-27 16:30:16+00:00,['alxnddr'],2024-12-13 16:11:11+00:00,2024-12-13 03:53:57+00:00,https://github.com/metabase/metabase/issues/50584,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Export', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2699108746,issue,open,,Vertica Syncs taking hours to complete,"### Describe the bug

Hi,

I noticed that since upgrading to version 0.50.0 +, one of my Vertica dbs takes 10+ hours to fully sync in Metabase. In most cases, the sync doesnt get everything either as users frequently complain of missing data. The database hasnt grown significantly either so wondering what could be the cause or how to fix.



### To Reproduce

- Set up Vertica version v23.4.0-7
- Add roughly 14K tables
- Attach to Metabase and monitor syncs for new data after


### Expected behavior

Metabase should continue to sync changes efficiently and at reasonable speeds

### Logs

`
#033[35mFINISHED: step ''update-field-values'' for vertica Database 3 ''Datamart (Vertica)'' (13.4 hours)#033[0m
#033[35mFINISHED: step ''update-field-values'' for vertica Database 3 ''Datamart (Vertica)'' (13.0 hours)#033[0m
#033[35mFINISHED: step ''update-field-values'' for vertica Database 3 ''Datamart (Vertica)'' (12.3 hours)#033[0m
#033[35mFINISHED: step ''update-field-values'' for vertica Database 3 ''Datamart (Vertica)'' (12.7 hours)#033[0m
`

### Information about your Metabase installation

```JSON
{
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""starburst"",
      ""vertica"",
      ""clickhouse"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-04"",
      ""tag"": ""v0.51.2"",
      ""hash"": ""8bdb22c""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.3""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.22+7"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.22"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.22+7"",
    ""os.name"": ""Linux"",
    ""os.version"": ""4.18.0-372.19.1.el8_6.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Etc/UTC""
  }
}
```

### Severity

Impact noted on performance as sync runs through work period and data is still missing after

### Additional context

_No response_",kweyukevin,2024-11-27 16:27:51+00:00,[],2025-02-07 14:15:11+00:00,,https://github.com/metabase/metabase/issues/50583,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Metadata & Sync', ''), ('.Backend', ''), ('.Team/Drivers', '')]","[{'comment_id': 2505164331, 'issue_id': 2699108746, 'author': 'alxnddr', 'body': 'P1 priority since it is not only slow but also users report missing data', 'created_at': datetime.datetime(2024, 11, 28, 2, 50, 26, tzinfo=datetime.timezone.utc)}, {'comment_id': 2505711364, 'issue_id': 2699108746, 'author': 'lbrdnk', 'body': 'Hey @kweyukevin, thanks for the report. Would you be able to answer following questions? It would make search for solution easier.\n- Which version of Metabase have you upgraded from?\n- Would you be able to tell ~ how long sync used to take on your instance before the upgrade (considering 14k tables)?\n- Would you be able to tell which data is missing?', 'created_at': datetime.datetime(2024, 11, 28, 10, 0, 22, tzinfo=datetime.timezone.utc)}, {'comment_id': 2505766805, 'issue_id': 2699108746, 'author': 'kweyukevin', 'body': 'Hi @lbrdnk sure,\n\n- I upgraded from 0.49.16 to 0.50.28 where this started happening. I then upgraded to the current version hoping to fix the issue but that didnt work\n- Im honestly not sure how long it used to take but data added overnight would be available in the next working day every time before the upgrade\n- Yes, users would probably makes changes to a table adding a new column and either the column would be created but the data in it would be missing or the column would be missing completely. What I use as a workaround is go to the affected table, hide it, wait a few seconds, turn it back to active and in a few seconds all missing data is synced fully.', 'created_at': datetime.datetime(2024, 11, 28, 10, 23, 53, tzinfo=datetime.timezone.utc)}, {'comment_id': 2505786084, 'issue_id': 2699108746, 'author': 'Tony-metabase', 'body': ""@kweyukevin May I ask what's the usecase for having 14K tables? ... Are all those Tables used in Metabase?"", 'created_at': datetime.datetime(2024, 11, 28, 10, 33, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2505849573, 'issue_id': 2699108746, 'author': 'kweyukevin', 'body': '@Tony-metabase we have a number of teams that have different reports to publish from different sources. I can bet a few of the tables are not used anymore based on last activity dates but the number is not even close to 100 which I dont think will make that much of a difference.', 'created_at': datetime.datetime(2024, 11, 28, 11, 4, 39, tzinfo=datetime.timezone.utc)}, {'comment_id': 2505889289, 'issue_id': 2699108746, 'author': 'Tony-metabase', 'body': 'I am not surprised that it takes time to sync that number of tables though. Especially if you have a lot of columns set as category and drop down filters. \n\nSince you seem to have logs there, what was the average sync before the upgrade? if you check the logs before deploying 50? Keep in mind that for a scan here is a query that caches the column values for filter dropdowns by looking at the first 1,000 distinct records from each table, in ascending order:\n\n```\nSELECT\n    ""your_table_or_view"".""column"" AS ""column""\nFROM\n    ""your_schema"".""your_table_or_view""\nGROUP BY\n    ""your_table_or_view"".""column""\nORDER BY\n    ""your_table_or_view"".""column"" ASC\nLIMIT 1000\n```\n\nSo let\'s say you have 1 category per table (which I doubt cause you probably have much more) and it takes around 1 sec to get that its already like 4 hours to do all those tables. How long running a query like that against 1 such columns on your DB take?', 'created_at': datetime.datetime(2024, 11, 28, 11, 24, 59, tzinfo=datetime.timezone.utc)}, {'comment_id': 2505942410, 'issue_id': 2699108746, 'author': 'kweyukevin', 'body': 'So, the amount of data has grown over time but not anything like thousands of new tables. Again, this was fine before the upgrade which is why Im curious about it all despite the number of tables.\n\nLogs from before the upgrade are long gone for now so not much I can reference there. However, I shared earlier that Im honestly not sure how long it used to take but a guarantee was that data added overnight and through the previous work day would be available in the next working day every time before the upgrade.\n\nI ran the query you shared on at lease 5 samples and the run times were between 1.5 to 4s. Not sure if thats the information you needed or I need to perform this in a certain way. Let me know.\nThanks', 'created_at': datetime.datetime(2024, 11, 28, 11, 53, 52, tzinfo=datetime.timezone.utc)}, {'comment_id': 2506005341, 'issue_id': 2699108746, 'author': 'Tony-metabase', 'body': ""I am not sure what to say but if you're saying that such a query i shared is taking around 1.5-4 sec directly when you run it against Vertica ... Then I am not sure there is much one can do from metabase side and the time vs Tables/Columns kind of makes sense.\n\nThat could be for due to many reasons, agree that the upgrade causing this might make it seem like it's the upgrade fault. Probably the sync might have become a little slower but the more data you add and the more tables get added the sync is just gonna take much slower. It could also be you changed the sync schedule? but as I said from the data you're sharing I am not seeing anything especially wrong.\n\nWithout the Logs we aren't really sure what might be going on. I would suggest if possible deploy a local instance running 49 and hit the sync, see how long it takes and do the same on 50 and monitor the time. Then share with us the difference so we can assess the situation"", 'created_at': datetime.datetime(2024, 11, 28, 12, 27, 48, tzinfo=datetime.timezone.utc)}, {'comment_id': 2506052594, 'issue_id': 2699108746, 'author': 'kweyukevin', 'body': 'Thanks @Tony-metabase ,\nIll take the second approach and deploy a separate instance to test. Will also see into the data and see what else can be done to reduce the load.\nRegards,', 'created_at': datetime.datetime(2024, 11, 28, 12, 52, 18, tzinfo=datetime.timezone.utc)}]","alxnddr on (2024-11-28 02:50:26 UTC): P1 priority since it is not only slow but also users report missing data

lbrdnk on (2024-11-28 10:00:22 UTC): Hey @kweyukevin, thanks for the report. Would you be able to answer following questions? It would make search for solution easier.
- Which version of Metabase have you upgraded from?
- Would you be able to tell ~ how long sync used to take on your instance before the upgrade (considering 14k tables)?
- Would you be able to tell which data is missing?

kweyukevin (Issue Creator) on (2024-11-28 10:23:53 UTC): Hi @lbrdnk sure,

- I upgraded from 0.49.16 to 0.50.28 where this started happening. I then upgraded to the current version hoping to fix the issue but that didnt work
- Im honestly not sure how long it used to take but data added overnight would be available in the next working day every time before the upgrade
- Yes, users would probably makes changes to a table adding a new column and either the column would be created but the data in it would be missing or the column would be missing completely. What I use as a workaround is go to the affected table, hide it, wait a few seconds, turn it back to active and in a few seconds all missing data is synced fully.

Tony-metabase on (2024-11-28 10:33:21 UTC): @kweyukevin May I ask what's the usecase for having 14K tables? ... Are all those Tables used in Metabase?

kweyukevin (Issue Creator) on (2024-11-28 11:04:39 UTC): @Tony-metabase we have a number of teams that have different reports to publish from different sources. I can bet a few of the tables are not used anymore based on last activity dates but the number is not even close to 100 which I dont think will make that much of a difference.

Tony-metabase on (2024-11-28 11:24:59 UTC): I am not surprised that it takes time to sync that number of tables though. Especially if you have a lot of columns set as category and drop down filters. 

Since you seem to have logs there, what was the average sync before the upgrade? if you check the logs before deploying 50? Keep in mind that for a scan here is a query that caches the column values for filter dropdowns by looking at the first 1,000 distinct records from each table, in ascending order:

```
SELECT
    ""your_table_or_view"".""column"" AS ""column""
FROM
    ""your_schema"".""your_table_or_view""
GROUP BY
    ""your_table_or_view"".""column""
ORDER BY
    ""your_table_or_view"".""column"" ASC
LIMIT 1000
```

So let's say you have 1 category per table (which I doubt cause you probably have much more) and it takes around 1 sec to get that its already like 4 hours to do all those tables. How long running a query like that against 1 such columns on your DB take?

kweyukevin (Issue Creator) on (2024-11-28 11:53:52 UTC): So, the amount of data has grown over time but not anything like thousands of new tables. Again, this was fine before the upgrade which is why Im curious about it all despite the number of tables.

Logs from before the upgrade are long gone for now so not much I can reference there. However, I shared earlier that Im honestly not sure how long it used to take but a guarantee was that data added overnight and through the previous work day would be available in the next working day every time before the upgrade.

I ran the query you shared on at lease 5 samples and the run times were between 1.5 to 4s. Not sure if thats the information you needed or I need to perform this in a certain way. Let me know.
Thanks

Tony-metabase on (2024-11-28 12:27:48 UTC): I am not sure what to say but if you're saying that such a query i shared is taking around 1.5-4 sec directly when you run it against Vertica ... Then I am not sure there is much one can do from metabase side and the time vs Tables/Columns kind of makes sense.

That could be for due to many reasons, agree that the upgrade causing this might make it seem like it's the upgrade fault. Probably the sync might have become a little slower but the more data you add and the more tables get added the sync is just gonna take much slower. It could also be you changed the sync schedule? but as I said from the data you're sharing I am not seeing anything especially wrong.

Without the Logs we aren't really sure what might be going on. I would suggest if possible deploy a local instance running 49 and hit the sync, see how long it takes and do the same on 50 and monitor the time. Then share with us the difference so we can assess the situation

kweyukevin (Issue Creator) on (2024-11-28 12:52:18 UTC): Thanks @Tony-metabase ,
Ill take the second approach and deploy a separate instance to test. Will also see into the data and see what else can be done to reduce the load.
Regards,

"
2699104486,issue,closed,completed,"Make ""How to use Metabase"" link dismissible from the main sidebar","## Links 
- [Product doc](https://www.notion.so/metabase/Better-Onboarding-pt-3-iterations-13469354c90180bebbdfe315a42552de?pvs=4#13469354c901819bb88cc1e3d95d32d7)
- [Design](https://www.figma.com/design/1QmQUlWK7jACc1oxOfIzxE/Better-onboarding?node-id=7324-27953&m=dev)

```[tasklist]
- [x] Add a new user-level backend setting to control this behavior
- [x] Allow an individual user to dismiss/remove the link from the main sidebar
- [x] Introduce a GUI help telling the user where will the link live in the future
- [x] Once dismissed, move the link to the main app menu in the top right corner 
```",nemanjaglumac,2024-11-27 16:26:02+00:00,['nemanjaglumac'],2024-12-10 19:36:52+00:00,2024-12-10 19:36:51+00:00,https://github.com/metabase/metabase/issues/50582,[],[],
2698700343,issue,open,,"when group by week , localize date format not apply","### Describe the bug

when group by week , localize date format not apply,for example the week column first row should be  2020//9/28 -2020/10/4 , but it still show MMMM/DD/YYYY format.

![Image](https://github.com/user-attachments/assets/527544d0-b701-4e42-b1d8-1180042886de)


### To Reproduce

1 create a question with group date with week 
2 change the week column date format to YYYY/MM/DD or YYYY-MM-DD
3 the week column date format  not changed

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
0.51.x with postgres 12.20
```

### Severity

annoying

### Additional context

_No response_",armgong,2024-11-27 14:19:27+00:00,[],2025-02-04 20:25:20+00:00,,https://github.com/metabase/metabase/issues/50577,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Customization/Formatting', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2505017982, 'issue_id': 2698700343, 'author': 'armgong', 'body': 'more test , for result export.\ndownload format csv the date format is ok .\ndownload format excel  the date format is ok ,but  only show the start day of week , no end day of the week ( eg only show 2020-9-28 ,should be 2020-9-28  -2020-10-4 )', 'created_at': datetime.datetime(2024, 11, 27, 23, 57, 44, tzinfo=datetime.timezone.utc)}]","armgong (Issue Creator) on (2024-11-27 23:57:44 UTC): more test , for result export.
download format csv the date format is ok .
download format excel  the date format is ok ,but  only show the start day of week , no end day of the week ( eg only show 2020-9-28 ,should be 2020-9-28  -2020-10-4 )

"
2698680596,issue,closed,completed,Non-admin Onboarding Checklist,"## Links
- [Product doc](https://www.notion.so/metabase/Better-Onboarding-pt-3-iterations-13469354c90180bebbdfe315a42552de?pvs=4#13469354c90181f695f4fd9bc7757ec2)
- [Figma](https://www.figma.com/design/1QmQUlWK7jACc1oxOfIzxE/Better-onboarding?node-id=6364-30904&t=jkz5hUBlbVM4A8Jw-1)

## The task
Create a non-admin version of the onboarding checklist.

```[tasklist]
- [x] Update the link visibility
- [x] Do not show CTAs for non-admins
- [x] Do not show the ""setup"" section to non-admins
```",nemanjaglumac,2024-11-27 14:11:47+00:00,['nemanjaglumac'],2024-12-05 08:11:22+00:00,2024-12-03 18:23:40+00:00,https://github.com/metabase/metabase/issues/50576,[],[],
2698520088,issue,open,,Customize/brand exported PDFs on a per-tenant basis,"**Is your feature request related to a problem? Please describe.**
Strictly related to https://github.com/metabase/metabase/issues/33876, but the ability for organizations that embed to let tenants customize their own PDFs 

**Describe the solution you'd like**
ability for organizations that embed to let tenants customize their own PDFs 

**Describe alternatives you've considered**
N/A

**How important is this feature to you?**
Requested by a customer, internal ticket [here](https://app.usepylon.com/issues?conversationID=0c7bb9fc-a3b4-4ec7-ab28-1e14db947055)

**Additional context**
N.A
",ignacio-mb,2024-11-27 13:20:25+00:00,[],2025-02-04 20:31:06+00:00,,https://github.com/metabase/metabase/issues/50575,"[('Type:New Feature', ''), ('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('Reporting/Export', ''), ('Customization/Formatting', '')]",[],
2698508428,issue,closed,completed,"[BE, MBQL lib] Support new expressions in `display-name-method` for filters",,metamben,2024-11-27 13:19:18+00:00,['metamben'],2025-01-27 22:14:22+00:00,2024-11-29 13:26:38+00:00,https://github.com/metabase/metabase/issues/50574,[],[],
2698139110,issue,closed,completed,Rename dashboard plugin key to dashboardCardMenu in the sdk,"Rename the `dashboard` field in `SdkPluginsConfig` to `dashboardCardMenu` to be more explicit about what the plugin does.

```
export type SdkPluginsConfig = {
  mapQuestionClickActions?: SdkClickActionPluginsConfig;
  dashboard?: SdkDashCardMenuPluginsConfig;
};
```",heypoom,2024-11-27 11:01:05+00:00,['heypoom'],2024-12-09 19:33:16+00:00,2024-12-09 19:33:16+00:00,https://github.com/metabase/metabase/issues/50567,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2697962646,issue,closed,completed,Use plain string types for entity ids instead of NanoID in question component,"We cant use the NanoID-based types in our public API, as that requires using a function to cast the string to NanoID.

For example, the API for questions uses `questionId: CardId | CardEntityId`, which should be updated to `questionId: CardId` as CardEntityId is impossible to construct for SDK users as it is an internal NanoID-based type.",heypoom,2024-11-27 10:08:28+00:00,['heypoom'],2024-11-29 20:52:17+00:00,2024-11-29 19:48:59+00:00,https://github.com/metabase/metabase/issues/50563,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2697962457,issue,open,,Do not use NanoID types like CardEntityId in public-facing sdk types,,heypoom,2024-11-27 10:08:23+00:00,[],2024-11-27 10:08:23+00:00,,https://github.com/metabase/metabase/issues/50562,[],[],
2697907785,issue,open,,Add initialTab prop to sdk dashboard components,We should expose the [initialTab](https://metaboat.slack.com/archives/C063Q3F1HPF/p1731930037949069) prop on `StaticDashboard` and `InteractiveDashboard` as we expose this parameter to set the initial tab on public and static embeds.,heypoom,2024-11-27 09:48:36+00:00,[],2025-02-04 20:25:55+00:00,,https://github.com/metabase/metabase/issues/50559,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2697247275,issue,closed,completed,Implement new embed modal for admins,"Epic: https://github.com/metabase/metabase/issues/50503

[Tech doc](https://www.notion.so/metabase/Tech-Streamline-embed-flow-when-embedding-features-are-off-14969354c90180d4968de8b71b235f52?pvs=4#14969354c9018038a3fde0aca8bed500)",WiNloSt,2024-11-27 06:06:33+00:00,['WiNloSt'],2024-12-04 06:07:29+00:00,2024-12-04 06:07:29+00:00,https://github.com/metabase/metabase/issues/50552,[],[],
2696892424,issue,closed,completed,Pivoted questions cannot be downloaded,"### Describe the bug

The downloaded excel file actually contains the following json

```json
{
  ""database_id"": 2,
  ""started_at"": ""2024-11-27T03:36:23.948258Z"",
  ""via"": [
    {
      ""status"": ""failed"",
      ""class"": ""class clojure.lang.ExceptionInfo"",
      ""error"": ""Error reducing result rows"",
      ""stacktrace"": [
        ""--> query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581$respond__85583.invoke(pivot.clj:313)"",
        ""driver.sql_jdbc.execute$execute_reducible_query$fn__87316.invoke(execute.clj:725)"",
        ""driver.redshift$fn__138131$fn__138133.invoke(redshift.clj:235)"",
        ""driver.sql_jdbc.execute$do_with_resolved_connection87090__87091.invokeStatic(execute.clj:338)"",
        ""driver.sql_jdbc.execute$do_with_resolved_connection87090__87091.invoke(execute.clj:321)"",
        ""driver.redshift$fn__138131.invokeStatic(redshift.clj:220)"",
        ""driver.redshift$fn__138131.invoke(redshift.clj:218)"",
        ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)"",
        ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)"",
        ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)"",
        ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)"",
        ""driver.sql_jdbc$fn__113502.invokeStatic(sql_jdbc.clj:79)"",
        ""driver.sql_jdbc$fn__113502.invoke(sql_jdbc.clj:77)"",
        ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52)"",
        ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39)"",
        ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581$fn__85587.invoke(pivot.clj:324)"",
        ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581.invoke(pivot.clj:320)"",
        ""query_processor.middleware.cache$run_query_with_cache76929__76931$reduce_SINGLEQUOTE___76937$fn__76938.invoke(cache.clj:213)"",
        ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)"",
        ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)"",
        ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)"",
        ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)"",
        ""query_processor.middleware.cache$run_query_with_cache76929__76931$reduce_SINGLEQUOTE___76937.invoke(cache.clj:209)"",
        ""query_processor.pipeline$_STAR_run_STAR_$respond__58993.invoke(pipeline.clj:100)"",
        ""query_processor.pivot$append_queries_execute_fn85573__85574$multiple_execute__85575.invoke(pivot.clj:291)"",
        ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102)"",
        ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95)"",
        ""query_processor.execute$run.invokeStatic(execute.clj:62)"",
        ""query_processor.execute$run.invoke(execute.clj:56)"",
        ""query_processor.middleware.update_used_cards$update_used_cards_BANG_76978__76979$fn__76980.invoke(update_used_cards.clj:60)"",
        ""query_processor.execute$add_native_form_to_result_metadata$fn__76995.invoke(execute.clj:25)"",
        ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__77001.invoke(execute.clj:36)"",
        ""query_processor.middleware.cache$run_query_with_cache76929__76931.invokeStatic(cache.clj:214)"",
        ""query_processor.middleware.cache$run_query_with_cache76929__76931.invoke(cache.clj:187)"",
        ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___76951.invoke(cache.clj:240)"",
        ""query_processor.middleware.permissions$check_query_permissions$fn__73987.invoke(permissions.clj:148)"",
        ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__74699.invoke(enterprise.clj:51)"",
        ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__74709.invoke(enterprise.clj:64)"",
        ""query_processor.execute$execute77028__77029$fn__77030.invoke(execute.clj:94)"",
        ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:225)"",
        ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)"",
        ""query_processor.execute$execute77028__77029.invokeStatic(execute.clj:93)"",
        ""query_processor.execute$execute77028__77029.invoke(execute.clj:89)"",
        ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)"",
        ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)"",
        ""query_processor.middleware.enterprise$fn__74726$handle_audit_app_internal_queries__74727$fn__74729.invoke(enterprise.clj:96)"",
        ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__74737.invoke(enterprise.clj:103)"",
        ""query_processor.middleware.process_userland_query$process_userland_query_middleware77884__77885$fn__77886.invoke(process_userland_query.clj:204)"",
        ""query_processor.middleware.catch_exceptions$catch_exceptions77949__77950$fn__77951.invoke(catch_exceptions.clj:132)"",
        ""query_processor$process_query77990__77991$fn__77992.invoke(query_processor.clj:80)"",
        ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:225)"",
        ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)"",
        ""query_processor$process_query77990__77991.invokeStatic(query_processor.clj:78)"",
        ""query_processor$process_query77990__77991.invoke(query_processor.clj:71)"",
        ""query_processor.pivot$process_multiple_queries85594__85596.invokeStatic(pivot.clj:350)"",
        ""query_processor.pivot$process_multiple_queries85594__85596.invoke(pivot.clj:340)"",
        ""query_processor.pivot$run_pivot_query85682__85683$fn__85684.invoke(pivot.clj:605)"",
        ""query_processor.setup$do_with_canceled_chan75219__75220$fn__75221.invoke(setup.clj:187)"",
        ""query_processor.setup$do_with_database_local_settings75212__75213$fn__75214.invoke(setup.clj:181)"",
        ""query_processor.setup$do_with_driver75205__75206$fn__75207$fn__75208.invoke(setup.clj:166)"",
        ""driver$do_with_driver.invokeStatic(driver.clj:106)"",
        ""driver$do_with_driver.invoke(driver.clj:101)"",
        ""query_processor.setup$do_with_driver75205__75206$fn__75207.invoke(setup.clj:165)"",
        ""query_processor.setup$do_with_metadata_provider75196__75197$fn__75198$fn__75201.invoke(setup.clj:151)"",
        ""query_processor.store$do_with_metadata_provider58704__58705.invokeStatic(store.clj:170)"",
        ""query_processor.store$do_with_metadata_provider58704__58705.invoke(store.clj:150)"",
        ""query_processor.store$do_with_metadata_provider58704__58705.invokeStatic(store.clj:159)"",
        ""query_processor.store$do_with_metadata_provider58704__58705.invoke(store.clj:150)"",
        ""query_processor.setup$do_with_metadata_provider75196__75197$fn__75198.invoke(setup.clj:150)"",
        ""query_processor.setup$do_with_resolved_database75186__75187$fn__75188.invoke(setup.clj:128)"",
        ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:232)"",
        ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)"",
        ""query_processor.pivot$run_pivot_query85682__85683.invokeStatic(pivot.clj:595)"",
        ""query_processor.pivot$run_pivot_query85682__85683.invoke(pivot.clj:585)"",
        ""query_processor.card$process_query_for_card_default_run_fn$fn__87567$fn__87568.invoke(card.clj:193)"",
        ""query_processor.streaming$_streaming_response$fn__61550$fn__61551$fn__61552.invoke(streaming.clj:175)"",
        ""query_processor.streaming$_streaming_response$fn__61550$fn__61551.invoke(streaming.clj:173)"",
        ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:164)"",
        ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:151)"",
        ""query_processor.streaming$_streaming_response$fn__61550.invoke(streaming.clj:170)"",
        ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)"",
        ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)"",
        ""async.streaming_response$do_f_async$task__53178.invoke(streaming_response.clj:97)""
      ],
      ""error_type"": ""qp"",
      ""ex-data"": {
        ""type"": ""qp""
      }
    }
  ],
  ""action_id"": null,
  ""error_type"": ""qp"",
  ""status"": ""failed"",
  ""class"": ""class java.lang.NullPointerException"",
  ""stacktrace"": [
    ""clojure.lang.Numbers.ops(Numbers.java:1099)"",
    ""clojure.lang.Numbers.gte(Numbers.java:265)"",
    ""--> query_processor.pivot.postprocess$add_pivot_measures59786__59788$fn__59791$fn__59792.invoke(postprocess.clj:74)"",
    ""query_processor.pivot.postprocess$add_pivot_measures59786__59788$fn__59791.invoke(postprocess.clj:73)"",
    ""query_processor.pivot.postprocess$add_pivot_measures59786__59788.invokeStatic(postprocess.clj:72)"",
    ""query_processor.pivot.postprocess$add_pivot_measures59786__59788.invoke(postprocess.clj:64)"",
    ""query_processor.streaming.xlsx$pivot_opts__GT_pivot_spec.invokeStatic(xlsx.clj:568)"",
    ""query_processor.streaming.xlsx$pivot_opts__GT_pivot_spec.invoke(xlsx.clj:560)"",
    ""query_processor.streaming.xlsx$fn$reify__61434.begin_BANG_(xlsx.clj:673)"",
    ""query_processor.streaming$streaming_rff61520__61521$fn__61523$fn__61528.invoke(streaming.clj:122)"",
    ""query_processor.middleware.process_userland_query$add_and_save_execution_metadata_xform_BANG_$execution_info_rf_STAR___77876.invoke(process_userland_query.clj:128)"",
    ""query_processor.middleware.format_rows$format_rows_xform$fn__77217.invoke(format_rows.clj:68)"",
    ""query_processor.middleware.add_rows_truncated$add_rows_truncated_xform$fn__77111.invoke(add_rows_truncated.clj:24)"",
    ""query_processor.middleware.cache$save_results_xform$fn__76886.invoke(cache.clj:98)"",
    ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581$respond__85583.invoke(pivot.clj:311)"",
    ""driver.sql_jdbc.execute$execute_reducible_query$fn__87316.invoke(execute.clj:725)"",
    ""driver.redshift$fn__138131$fn__138133.invoke(redshift.clj:235)"",
    ""driver.sql_jdbc.execute$do_with_resolved_connection87090__87091.invokeStatic(execute.clj:338)"",
    ""driver.sql_jdbc.execute$do_with_resolved_connection87090__87091.invoke(execute.clj:321)"",
    ""driver.redshift$fn__138131.invokeStatic(redshift.clj:220)"",
    ""driver.redshift$fn__138131.invoke(redshift.clj:218)"",
    ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)"",
    ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)"",
    ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)"",
    ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)"",
    ""driver.sql_jdbc$fn__113502.invokeStatic(sql_jdbc.clj:79)"",
    ""driver.sql_jdbc$fn__113502.invoke(sql_jdbc.clj:77)"",
    ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52)"",
    ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39)"",
    ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581$fn__85587.invoke(pivot.clj:324)"",
    ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581.invoke(pivot.clj:320)"",
    ""query_processor.middleware.cache$run_query_with_cache76929__76931$reduce_SINGLEQUOTE___76937$fn__76938.invoke(cache.clj:213)"",
    ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)"",
    ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)"",
    ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)"",
    ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)"",
    ""query_processor.middleware.cache$run_query_with_cache76929__76931$reduce_SINGLEQUOTE___76937.invoke(cache.clj:209)"",
    ""query_processor.pipeline$_STAR_run_STAR_$respond__58993.invoke(pipeline.clj:100)"",
    ""query_processor.pivot$append_queries_execute_fn85573__85574$multiple_execute__85575.invoke(pivot.clj:291)"",
    ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102)"",
    ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95)"",
    ""query_processor.execute$run.invokeStatic(execute.clj:62)"",
    ""query_processor.execute$run.invoke(execute.clj:56)"",
    ""query_processor.middleware.update_used_cards$update_used_cards_BANG_76978__76979$fn__76980.invoke(update_used_cards.clj:60)"",
    ""query_processor.execute$add_native_form_to_result_metadata$fn__76995.invoke(execute.clj:25)"",
    ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__77001.invoke(execute.clj:36)"",
    ""query_processor.middleware.cache$run_query_with_cache76929__76931.invokeStatic(cache.clj:214)"",
    ""query_processor.middleware.cache$run_query_with_cache76929__76931.invoke(cache.clj:187)"",
    ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___76951.invoke(cache.clj:240)"",
    ""query_processor.middleware.permissions$check_query_permissions$fn__73987.invoke(permissions.clj:148)"",
    ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__74699.invoke(enterprise.clj:51)"",
    ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__74709.invoke(enterprise.clj:64)"",
    ""query_processor.execute$execute77028__77029$fn__77030.invoke(execute.clj:94)"",
    ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:225)"",
    ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)"",
    ""query_processor.execute$execute77028__77029.invokeStatic(execute.clj:93)"",
    ""query_processor.execute$execute77028__77029.invoke(execute.clj:89)"",
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)"",
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)"",
    ""query_processor.middleware.enterprise$fn__74726$handle_audit_app_internal_queries__74727$fn__74729.invoke(enterprise.clj:96)"",
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__74737.invoke(enterprise.clj:103)"",
    ""query_processor.middleware.process_userland_query$process_userland_query_middleware77884__77885$fn__77886.invoke(process_userland_query.clj:204)"",
    ""query_processor.middleware.catch_exceptions$catch_exceptions77949__77950$fn__77951.invoke(catch_exceptions.clj:132)"",
    ""query_processor$process_query77990__77991$fn__77992.invoke(query_processor.clj:80)"",
    ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:225)"",
    ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)"",
    ""query_processor$process_query77990__77991.invokeStatic(query_processor.clj:78)"",
    ""query_processor$process_query77990__77991.invoke(query_processor.clj:71)"",
    ""query_processor.pivot$process_multiple_queries85594__85596.invokeStatic(pivot.clj:350)"",
    ""query_processor.pivot$process_multiple_queries85594__85596.invoke(pivot.clj:340)"",
    ""query_processor.pivot$run_pivot_query85682__85683$fn__85684.invoke(pivot.clj:605)"",
    ""query_processor.setup$do_with_canceled_chan75219__75220$fn__75221.invoke(setup.clj:187)"",
    ""query_processor.setup$do_with_database_local_settings75212__75213$fn__75214.invoke(setup.clj:181)"",
    ""query_processor.setup$do_with_driver75205__75206$fn__75207$fn__75208.invoke(setup.clj:166)"",
    ""driver$do_with_driver.invokeStatic(driver.clj:106)"",
    ""driver$do_with_driver.invoke(driver.clj:101)"",
    ""query_processor.setup$do_with_driver75205__75206$fn__75207.invoke(setup.clj:165)"",
    ""query_processor.setup$do_with_metadata_provider75196__75197$fn__75198$fn__75201.invoke(setup.clj:151)"",
    ""query_processor.store$do_with_metadata_provider58704__58705.invokeStatic(store.clj:170)"",
    ""query_processor.store$do_with_metadata_provider58704__58705.invoke(store.clj:150)"",
    ""query_processor.store$do_with_metadata_provider58704__58705.invokeStatic(store.clj:159)"",
    ""query_processor.store$do_with_metadata_provider58704__58705.invoke(store.clj:150)"",
    ""query_processor.setup$do_with_metadata_provider75196__75197$fn__75198.invoke(setup.clj:150)"",
    ""query_processor.setup$do_with_resolved_database75186__75187$fn__75188.invoke(setup.clj:128)"",
    ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:232)"",
    ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)"",
    ""query_processor.pivot$run_pivot_query85682__85683.invokeStatic(pivot.clj:595)"",
    ""query_processor.pivot$run_pivot_query85682__85683.invoke(pivot.clj:585)"",
    ""query_processor.card$process_query_for_card_default_run_fn$fn__87567$fn__87568.invoke(card.clj:193)"",
    ""query_processor.streaming$_streaming_response$fn__61550$fn__61551$fn__61552.invoke(streaming.clj:175)"",
    ""query_processor.streaming$_streaming_response$fn__61550$fn__61551.invoke(streaming.clj:173)"",
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:164)"",
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:151)"",
    ""query_processor.streaming$_streaming_response$fn__61550.invoke(streaming.clj:170)"",
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)"",
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)"",
    ""async.streaming_response$do_f_async$task__53178.invoke(streaming_response.clj:97)""
  ],
  ""card_id"": 2070,
  ""context"": ""xlsx-download"",
  ""error"": ""Error running query"",
  ""row_count"": 0,
  ""running_time"": 0,
  ""data"": {
    ""rows"": [],
    ""cols"": []
  }
}
```

### To Reproduce

Having problems re-producing this other pivot tables so I'm not entirely sure what's causing the issue. 

### Expected behavior

It shouldn't panic with a null pointer exception and the download should have the data visible in the UI

### Logs

```
{:database_id 2,
 :started_at #t ""2024-11-27T03:36:23.948258Z[GMT]"",
 :via
 [{:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error ""Error reducing result rows"",
   :stacktrace
   [""--> query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581$respond__85583.invoke(pivot.clj:313)""
    ""driver.sql_jdbc.execute$execute_reducible_query$fn__87316.invoke(execute.clj:725)""
    ""driver.redshift$fn__138131$fn__138133.invoke(redshift.clj:235)""
    ""driver.sql_jdbc.execute$do_with_resolved_connection87090__87091.invokeStatic(execute.clj:338)""
    ""driver.sql_jdbc.execute$do_with_resolved_connection87090__87091.invoke(execute.clj:321)""
    ""driver.redshift$fn__138131.invokeStatic(redshift.clj:220)""
    ""driver.redshift$fn__138131.invoke(redshift.clj:218)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
    ""driver.sql_jdbc$fn__113502.invokeStatic(sql_jdbc.clj:79)""
    ""driver.sql_jdbc$fn__113502.invoke(sql_jdbc.clj:77)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39)""
    ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581$fn__85587.invoke(pivot.clj:324)""
    ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581.invoke(pivot.clj:320)""
    ""query_processor.middleware.cache$run_query_with_cache76929__76931$reduce_SINGLEQUOTE___76937$fn__76938.invoke(cache.clj:213)""
    ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)""
    ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""
    ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)""
    ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""
    ""query_processor.middleware.cache$run_query_with_cache76929__76931$reduce_SINGLEQUOTE___76937.invoke(cache.clj:209)""
    ""query_processor.pipeline$_STAR_run_STAR_$respond__58993.invoke(pipeline.clj:100)""
    ""query_processor.pivot$append_queries_execute_fn85573__85574$multiple_execute__85575.invoke(pivot.clj:291)""
    ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102)""
    ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95)""
    ""query_processor.execute$run.invokeStatic(execute.clj:62)""
    ""query_processor.execute$run.invoke(execute.clj:56)""
    ""query_processor.middleware.update_used_cards$update_used_cards_BANG_76978__76979$fn__76980.invoke(update_used_cards.clj:60)""
    ""query_processor.execute$add_native_form_to_result_metadata$fn__76995.invoke(execute.clj:25)""
    ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__77001.invoke(execute.clj:36)""
    ""query_processor.middleware.cache$run_query_with_cache76929__76931.invokeStatic(cache.clj:214)""
    ""query_processor.middleware.cache$run_query_with_cache76929__76931.invoke(cache.clj:187)""
    ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___76951.invoke(cache.clj:240)""
    ""query_processor.middleware.permissions$check_query_permissions$fn__73987.invoke(permissions.clj:148)""
    ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__74699.invoke(enterprise.clj:51)""
    ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__74709.invoke(enterprise.clj:64)""
    ""query_processor.execute$execute77028__77029$fn__77030.invoke(execute.clj:94)""
    ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:225)""
    ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)""
    ""query_processor.execute$execute77028__77029.invokeStatic(execute.clj:93)""
    ""query_processor.execute$execute77028__77029.invoke(execute.clj:89)""
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)""
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)""
    ""query_processor.middleware.enterprise$fn__74726$handle_audit_app_internal_queries__74727$fn__74729.invoke(enterprise.clj:96)""
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__74737.invoke(enterprise.clj:103)""
    ""query_processor.middleware.process_userland_query$process_userland_query_middleware77884__77885$fn__77886.invoke(process_userland_query.clj:204)""
    ""query_processor.middleware.catch_exceptions$catch_exceptions77949__77950$fn__77951.invoke(catch_exceptions.clj:132)""
    ""query_processor$process_query77990__77991$fn__77992.invoke(query_processor.clj:80)""
    ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:225)""
    ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)""
    ""query_processor$process_query77990__77991.invokeStatic(query_processor.clj:78)""
    ""query_processor$process_query77990__77991.invoke(query_processor.clj:71)""
    ""query_processor.pivot$process_multiple_queries85594__85596.invokeStatic(pivot.clj:350)""
    ""query_processor.pivot$process_multiple_queries85594__85596.invoke(pivot.clj:340)""
    ""query_processor.pivot$run_pivot_query85682__85683$fn__85684.invoke(pivot.clj:605)""
    ""query_processor.setup$do_with_canceled_chan75219__75220$fn__75221.invoke(setup.clj:187)""
    ""query_processor.setup$do_with_database_local_settings75212__75213$fn__75214.invoke(setup.clj:181)""
    ""query_processor.setup$do_with_driver75205__75206$fn__75207$fn__75208.invoke(setup.clj:166)""
    ""driver$do_with_driver.invokeStatic(driver.clj:106)""
    ""driver$do_with_driver.invoke(driver.clj:101)""
    ""query_processor.setup$do_with_driver75205__75206$fn__75207.invoke(setup.clj:165)""
    ""query_processor.setup$do_with_metadata_provider75196__75197$fn__75198$fn__75201.invoke(setup.clj:151)""
    ""query_processor.store$do_with_metadata_provider58704__58705.invokeStatic(store.clj:170)""
    ""query_processor.store$do_with_metadata_provider58704__58705.invoke(store.clj:150)""
    ""query_processor.store$do_with_metadata_provider58704__58705.invokeStatic(store.clj:159)""
    ""query_processor.store$do_with_metadata_provider58704__58705.invoke(store.clj:150)""
    ""query_processor.setup$do_with_metadata_provider75196__75197$fn__75198.invoke(setup.clj:150)""
    ""query_processor.setup$do_with_resolved_database75186__75187$fn__75188.invoke(setup.clj:128)""
    ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:232)""
    ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)""
    ""query_processor.pivot$run_pivot_query85682__85683.invokeStatic(pivot.clj:595)""
    ""query_processor.pivot$run_pivot_query85682__85683.invoke(pivot.clj:585)""
    ""query_processor.card$process_query_for_card_default_run_fn$fn__87567$fn__87568.invoke(card.clj:193)""
    ""query_processor.streaming$_streaming_response$fn__61550$fn__61551$fn__61552.invoke(streaming.clj:175)""
    ""query_processor.streaming$_streaming_response$fn__61550$fn__61551.invoke(streaming.clj:173)""
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:164)""
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:151)""
    ""query_processor.streaming$_streaming_response$fn__61550.invoke(streaming.clj:170)""
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)""
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)""
    ""async.streaming_response$do_f_async$task__53178.invoke(streaming_response.clj:97)""],
   :error_type :qp,
   :ex-data {:type :qp}}],
 :action_id nil,
 :error_type :qp,
 :json_query
 {:lib/type :mbql/query,
  :qp.pivot/breakout-combination [0],
  :lib/metadata
  (metabase.lib.metadata.invocation-tracker/invocation-tracker-provider (metabase.lib.metadata.cached-provider/cached-metadata-provider (metabase.lib.metadata.jvm/->UncachedApplicationDatabaseMetadataProvider 2))),
  :stages
  [{:lib/type :mbql.stage/mbql,
    :source-table 1903,
    :joins
    [{:fields :none,
      :alias ""User Organisation Groups"",
      :conditions
      [[:=
        {:lib/uuid ""e617d3fb-5c66-4079-b631-7671039dcd22""}
        [:field
         {:base-type :type/Text, :lib/uuid ""868ee0df-eba3-4c02-9ccf-1a6c8af75a0e"", :effective-type :type/Text}
         27240]
        [:field
         {:base-type :type/Text,
          :join-alias ""User Organisation Groups"",
          :lib/uuid ""c7ce9010-8f6d-4e0f-926c-5db4a61f9c55"",
          :effective-type :type/Text}
         23219]]],
      :lib/type :mbql/join,
      :stages [{:lib/type :mbql.stage/mbql, :source-table 1753}],
      :lib/options {:lib/uuid ""663c82f2-8a33-46c2-9b72-f1890277cb9e""}}],
    :breakout
    [[:field
      {:base-type :type/Text, :lib/uuid ""ac1f253b-e612-41b8-b89b-1f6e595ae802"", :effective-type :type/Text}
      27240]
     [:field
      {:base-type :type/Text, :lib/uuid ""b76d6202-b28f-4459-a8c9-3391bae52134"", :effective-type :type/Text}
      27243]
     [:field
      {:base-type :type/Text, :lib/uuid ""2f01ab7d-9a92-4db0-aff4-7cae486406d7"", :effective-type :type/Text}
      27258]
     [:field
      {:base-type :type/Text, :lib/uuid ""2b1cf2a7-70c3-43b0-909c-3821ef99bc79"", :effective-type :type/Text}
      27233]
     [:field
      {:base-type :type/DateTimeWithLocalTZ,
       :temporal-unit :day,
       :lib/uuid ""9c581984-1706-4566-a14f-b73e8900094f"",
       :effective-type :type/DateTimeWithLocalTZ}
      27262]
     [:expression {:base-type :type/Integer, :lib/uuid ""6be8dac7-2288-4a8c-88b5-ecad18f62aee""} ""Logged In ""]
     [:expression {:base-type :type/Integer, :lib/uuid ""04feaf05-f049-4c53-9e13-9d26a4e98350""} ""Not Logged In""]],
    :expressions
    [[:case
      {:lib/uuid ""f9030772-703a-4792-aa3d-bff50acb480b"", :lib/expression-name ""Logged In ""}
      [[[:not-null
         {:lib/uuid ""ad702362-bcf8-4b5c-beec-dc0eecd9b012""}
         [:field
          {:base-type :type/DateTimeWithLocalTZ,
           :lib/uuid ""91106548-c185-4db3-af62-5832f682923c"",
           :effective-type :type/DateTimeWithLocalTZ}
          27262]]
        1]]
      0]
     [:case
      {:lib/uuid ""7674cf89-1017-4c45-8b53-ec1df14964fe"", :lib/expression-name ""Not Logged In""}
      [[[:not-null
         {:lib/uuid ""0851195b-e5db-4da4-a14e-a9f546c7f66e""}
         [:field
          {:base-type :type/DateTimeWithLocalTZ,
           :lib/uuid ""4dc68f57-ab63-4956-8ed2-eecc6cfa9c2d"",
           :effective-type :type/DateTimeWithLocalTZ}
          27262]]
        0]]
      1]],
    :filters
    [[:=
      {:lib/uuid ""c723abb5-dd60-4380-a4ce-7d17a7534006""}
      [:field
       {:base-type :type/Text,
        :join-alias ""User Organisation Groups"",
        :lib/uuid ""4b4babe0-5ea6-45c6-af06-618e5f694ede"",
        :effective-type :type/Text}
       23216]
      ""4838e1ff-a21e-4188-81b0-c67eae8cd995""]
     [:is-null
      {:lib/uuid ""83a4b68a-7ace-45ac-a80a-525861e6260a""}
      [:field
       {:base-type :type/DateTimeWithLocalTZ,
        :lib/uuid ""b0e69387-8553-4860-83f0-c4be1636411c"",
        :effective-type :type/DateTimeWithLocalTZ}
       65341]]]}
   {:lib/type :mbql.stage/mbql,
    :joins
    [{:alias ""Customer 845"",
      :conditions
      [[:=
        {:lib/uuid ""b6debc64-46b3-404f-b022-a3c4a5ec415e""}
        [:field {:base-type :type/Text, :lib/uuid ""a0332b73-f17d-4966-8372-42cba3a82d65""} ""id""]
        [:field
         {:base-type :type/UUID,
          :join-alias ""Customer 845"",
          :lib/uuid ""026fd3b8-9c3c-43a8-9ad7-02f0a06de1b8"",
          :effective-type :type/UUID}
         56098]]],
      :lib/type :mbql/join,
      :stages [{:lib/type :mbql.stage/mbql, :source-table 4092}],
      :lib/options {:lib/uuid ""f2b7f0eb-bd4a-44d6-b8f7-9e89c75ff8b7""}}
     {:fields :all,
      :strategy :left-join,
      :alias ""3.1 Livestream"",
      :conditions
      [[:=
        {:lib/uuid ""5a25daa6-129c-4b64-a4d5-8679eca5b4d0""}
        [:field {:base-type :type/Text, :lib/uuid ""1f964380-028c-4755-b8e8-75d4b6e042e3""} ""id""]
        [:field
         {:base-type :type/Text,
          :join-alias ""3.1 Livestream"",
          :lib/uuid ""49050c7c-67c5-4d3a-b6f7-de0e8f4c5182"",
          :effective-type :type/Text}
         27240]]],
      :lib/type :mbql/join,
      :stages [{:lib/type :mbql.stage/mbql, :source-card 1959}],
      :lib/options {:lib/uuid ""227166c6-88c6-497a-8657-d3ab9f7d70d5""}}
     {:fields :all,
      :strategy :left-join,
      :alias ""4.1 Assignment"",
      :conditions
      [[:=
        {:lib/uuid ""6b250106-1a6f-4724-83df-ee143c26bbcc""}
        [:field {:base-type :type/Text, :lib/uuid ""4fe4ede6-8730-4fab-937f-51766a02c881""} ""id""]
        [:field
         {:base-type :type/Text,
          :join-alias ""4.1 Assignment"",
          :lib/uuid ""410c1247-5f95-4c95-a7df-e7f9067ac3a0"",
          :effective-type :type/Text}
         27240]]],
      :lib/type :mbql/join,
      :stages [{:lib/type :mbql.stage/mbql, :source-card 1960}],
      :lib/options {:lib/uuid ""88a66043-e6fa-4ba0-a88a-ec172a7ccca2""}}],
    :aggregation
    [[:distinct
      {:lib/uuid ""5025ea95-48d1-427f-bc19-9c2f50f1b147""}
      [:field {:base-type :type/Text, :lib/uuid ""84af4d88-3eab-4b92-9bfb-bb5b4f7505b1""} ""id""]]
     [:sum
      {:lib/uuid ""7bd78dce-8378-43bd-8d4f-529087631eb2""}
      [:field {:base-type :type/Integer, :lib/uuid ""2fdb6e9c-1e01-4982-9227-303cc7a3e51b""} ""Logged In ""]]
     [:sum
      {:lib/uuid ""eb92947c-fa14-4282-96c2-852fe4b30550""}
      [:field {:base-type :type/Integer, :lib/uuid ""81ddf42e-afcf-4e9c-b893-460e1d3161d7""} ""Not Logged In""]]
     [:sum
      {:lib/uuid ""67f27b4b-a259-4758-b637-83be964b9de1""}
      [:field
       {:base-type :type/Integer, :join-alias ""3.1 Livestream"", :lib/uuid ""6c56851c-00cb-4466-b920-7ff0df2f363d""}
       ""count""]]
     [:sum
      {:lib/uuid ""fd5f1c49-e59d-4865-a748-f9ac0acf77de""}
      [:field
       {:base-type :type/BigInteger, :join-alias ""4.1 Assignment"", :lib/uuid ""c51d2947-70e1-4fc8-9ec7-a2fcf44740b2""}
       ""sum""]]
     [:sum
      {:lib/uuid ""0d22bab5-9ae2-4ebd-b796-266a26e3a95a""}
      [:field
       {:base-type :type/BigInteger, :join-alias ""4.1 Assignment"", :lib/uuid ""f7e24799-ac88-43cf-82d0-c3f5db5e21bf""}
       ""sum_2""]]],
    :filters
    [[:does-not-contain
      {:case-sensitive false, :lib/uuid ""c25a9b06-b34f-49b3-a4e3-018874534b79""}
      [:field {:base-type :type/Text, :lib/uuid ""5c15ef02-71fc-4ae3-9343-8989a9de702a""} ""email""]
      ""tigerhall""]],
    :breakout
    [[:field
      {:base-type :type/Text,
       :join-alias ""Customer 845"",
       :lib/uuid ""332dd86c-528c-40d8-9569-eb930653f81b"",
       :effective-type :type/Text}
      56090]
     [:expression
      {:lib/uuid ""c80684aa-fdda-43d3-9bd2-a4682901bc3e"", :base-type :type/Integer, :effective-type :type/Integer}
      ""pivot-grouping""]],
    :expressions [[:abs {:lib/uuid ""c2b668fd-e8d3-4c2a-a2a2-3e6a0d64bb9f"", :lib/expression-name ""pivot-grouping""} 0]]}],
  :middleware
  {:process-viz-settings? true,
   :userland-query? true,
   :format-rows? true,
   :ignore-cached-results? true,
   :pivot-options
   {:pivot-rows [0], :pivot-cols nil, :pivot-measures [1 2 3 4 5 6], :column-sort-order {1 nil, 6 nil, nil nil}},
   :pivot? true,
   :js-int-to-string? false,
   :add-default-userland-constraints? true,
   :skip-results-metadata? true},
  :cache-strategy {:multiplier 10, :min-duration-ms 60000, :type :ttl, :avg-execution-ms 0},
  :viz-settings
  {:map.region ""world_countries"",
   :map.type ""region"",
   :pivot_table.column_split
   {:rows [[:field 56090 {:base-type :type/Text, :join-alias ""Customer 845""}]],
    :columns [],
    :values [[:aggregation 0] [:aggregation 1] [:aggregation 2] [:aggregation 3] [:aggregation 4] [:aggregation 5]]},
   :graph.show_values true,
   :pie.slice_threshold 0,
   :pie.percent_visibility ""inside"",
   :table.columns
   [{:name ""sum_4"", :enabled true}
    {:name ""sum_5"", :enabled true}
    {:name ""sum"", :enabled true}
    {:name ""sum_2"", :enabled true}
    {:name ""sum_3"", :enabled true}
    {:name ""count"", :enabled true}
    {:name ""department_name"", :enabled true}],
   :pie.dimension ""department_name"",
   :pivot_table.column_widths
   {:leftHeaderWidths [171],
    :totalLeftHeaderWidths 171,
    :valueHeaderWidths {:0 152, :1 171, :2 179, :3 185, :4 176, :5 186}},
   :table.cell_column ""sum"",
   :graph.y_axis.scale ""linear"",
   :graph.metrics [""sum"" ""sum_2"" ""sum_3"" ""sum_4"" ""sum_5"" ""count""],
   :graph.label_value_formatting ""full"",
   :pie.metric ""count"",
   :pie.show_legend true,
   :table.pivot_column ""Logged In "",
   :pie.show_total true,
   :column_settings
   {""[\""name\"",\""count\""]"" {:column_title ""Total Users""},
    ""[\""name\"",\""sum\""]"" {:column_title ""Total Users Logged In ""},
    ""[\""name\"",\""sum_2\""]"" {:column_title ""Total Users Not Logged In""},
    ""[\""name\"",\""sum_3\""]"" {:column_title ""No. of Livestream Attended""},
    ""[\""name\"",\""sum_4\""]"" {:column_title ""No. of Assignments""},
    ""[\""name\"",\""sum_5\""]"" {:column_title ""No. of Assignment Completed""},
    ""[\""ref\"",[\""field\"",56097,{\""base-type\"":\""type/Text\"",\""join-alias\"":\""Customer 845\""}]]""
    {:column_title ""Region""},
    ""[\""ref\"",[\""field\"",56090,{\""base-type\"":\""type/Text\"",\""join-alias\"":\""Customer 845\""}]]""
    {:column_title ""Department Name""}},
   :series_settings {:sum {:color ""#7172AD""}},
   :graph.dimensions [""region""],
   :stackable.stack_type ""stacked""},
  :lib.convert/converted? true,
  :database 2},
 :status :failed,
 :class java.lang.NullPointerException,
 :stacktrace
 [""clojure.lang.Numbers.ops(Numbers.java:1099)""
  ""clojure.lang.Numbers.gte(Numbers.java:265)""
  ""--> query_processor.pivot.postprocess$add_pivot_measures59786__59788$fn__59791$fn__59792.invoke(postprocess.clj:74)""
  ""query_processor.pivot.postprocess$add_pivot_measures59786__59788$fn__59791.invoke(postprocess.clj:73)""
  ""query_processor.pivot.postprocess$add_pivot_measures59786__59788.invokeStatic(postprocess.clj:72)""
  ""query_processor.pivot.postprocess$add_pivot_measures59786__59788.invoke(postprocess.clj:64)""
  ""query_processor.streaming.xlsx$pivot_opts__GT_pivot_spec.invokeStatic(xlsx.clj:568)""
  ""query_processor.streaming.xlsx$pivot_opts__GT_pivot_spec.invoke(xlsx.clj:560)""
  ""query_processor.streaming.xlsx$fn$reify__61434.begin_BANG_(xlsx.clj:673)""
  ""query_processor.streaming$streaming_rff61520__61521$fn__61523$fn__61528.invoke(streaming.clj:122)""
  ""query_processor.middleware.process_userland_query$add_and_save_execution_metadata_xform_BANG_$execution_info_rf_STAR___77876.invoke(process_userland_query.clj:128)""
  ""query_processor.middleware.format_rows$format_rows_xform$fn__77217.invoke(format_rows.clj:68)""
  ""query_processor.middleware.add_rows_truncated$add_rows_truncated_xform$fn__77111.invoke(add_rows_truncated.clj:24)""
  ""query_processor.middleware.cache$save_results_xform$fn__76886.invoke(cache.clj:98)""
  ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581$respond__85583.invoke(pivot.clj:311)""
  ""driver.sql_jdbc.execute$execute_reducible_query$fn__87316.invoke(execute.clj:725)""
  ""driver.redshift$fn__138131$fn__138133.invoke(redshift.clj:235)""
  ""driver.sql_jdbc.execute$do_with_resolved_connection87090__87091.invokeStatic(execute.clj:338)""
  ""driver.sql_jdbc.execute$do_with_resolved_connection87090__87091.invoke(execute.clj:321)""
  ""driver.redshift$fn__138131.invokeStatic(redshift.clj:220)""
  ""driver.redshift$fn__138131.invoke(redshift.clj:218)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
  ""driver.sql_jdbc$fn__113502.invokeStatic(sql_jdbc.clj:79)""
  ""driver.sql_jdbc$fn__113502.invoke(sql_jdbc.clj:77)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39)""
  ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581$fn__85587.invoke(pivot.clj:324)""
  ""query_processor.pivot$append_queries_reduce_fn85578__85579$multiple_reducing__85581.invoke(pivot.clj:320)""
  ""query_processor.middleware.cache$run_query_with_cache76929__76931$reduce_SINGLEQUOTE___76937$fn__76938.invoke(cache.clj:213)""
  ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:83)""
  ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""
  ""query_processor.middleware.cache.impl$do_with_serialization.invokeStatic(impl.clj:73)""
  ""query_processor.middleware.cache.impl$do_with_serialization.invoke(impl.clj:54)""
  ""query_processor.middleware.cache$run_query_with_cache76929__76931$reduce_SINGLEQUOTE___76937.invoke(cache.clj:209)""
  ""query_processor.pipeline$_STAR_run_STAR_$respond__58993.invoke(pipeline.clj:100)""
  ""query_processor.pivot$append_queries_execute_fn85573__85574$multiple_execute__85575.invoke(pivot.clj:291)""
  ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102)""
  ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95)""
  ""query_processor.execute$run.invokeStatic(execute.clj:62)""
  ""query_processor.execute$run.invoke(execute.clj:56)""
  ""query_processor.middleware.update_used_cards$update_used_cards_BANG_76978__76979$fn__76980.invoke(update_used_cards.clj:60)""
  ""query_processor.execute$add_native_form_to_result_metadata$fn__76995.invoke(execute.clj:25)""
  ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__77001.invoke(execute.clj:36)""
  ""query_processor.middleware.cache$run_query_with_cache76929__76931.invokeStatic(cache.clj:214)""
  ""query_processor.middleware.cache$run_query_with_cache76929__76931.invoke(cache.clj:187)""
  ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___76951.invoke(cache.clj:240)""
  ""query_processor.middleware.permissions$check_query_permissions$fn__73987.invoke(permissions.clj:148)""
  ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__74699.invoke(enterprise.clj:51)""
  ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__74709.invoke(enterprise.clj:64)""
  ""query_processor.execute$execute77028__77029$fn__77030.invoke(execute.clj:94)""
  ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:225)""
  ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)""
  ""query_processor.execute$execute77028__77029.invokeStatic(execute.clj:93)""
  ""query_processor.execute$execute77028__77029.invoke(execute.clj:89)""
  ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)""
  ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)""
  ""query_processor.middleware.enterprise$fn__74726$handle_audit_app_internal_queries__74727$fn__74729.invoke(enterprise.clj:96)""
  ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__74737.invoke(enterprise.clj:103)""
  ""query_processor.middleware.process_userland_query$process_userland_query_middleware77884__77885$fn__77886.invoke(process_userland_query.clj:204)""
  ""query_processor.middleware.catch_exceptions$catch_exceptions77949__77950$fn__77951.invoke(catch_exceptions.clj:132)""
  ""query_processor$process_query77990__77991$fn__77992.invoke(query_processor.clj:80)""
  ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:225)""
  ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)""
  ""query_processor$process_query77990__77991.invokeStatic(query_processor.clj:78)""
  ""query_processor$process_query77990__77991.invoke(query_processor.clj:71)""
  ""query_processor.pivot$process_multiple_queries85594__85596.invokeStatic(pivot.clj:350)""
  ""query_processor.pivot$process_multiple_queries85594__85596.invoke(pivot.clj:340)""
  ""query_processor.pivot$run_pivot_query85682__85683$fn__85684.invoke(pivot.clj:605)""
  ""query_processor.setup$do_with_canceled_chan75219__75220$fn__75221.invoke(setup.clj:187)""
  ""query_processor.setup$do_with_database_local_settings75212__75213$fn__75214.invoke(setup.clj:181)""
  ""query_processor.setup$do_with_driver75205__75206$fn__75207$fn__75208.invoke(setup.clj:166)""
  ""driver$do_with_driver.invokeStatic(driver.clj:106)""
  ""driver$do_with_driver.invoke(driver.clj:101)""
  ""query_processor.setup$do_with_driver75205__75206$fn__75207.invoke(setup.clj:165)""
  ""query_processor.setup$do_with_metadata_provider75196__75197$fn__75198$fn__75201.invoke(setup.clj:151)""
  ""query_processor.store$do_with_metadata_provider58704__58705.invokeStatic(store.clj:170)""
  ""query_processor.store$do_with_metadata_provider58704__58705.invoke(store.clj:150)""
  ""query_processor.store$do_with_metadata_provider58704__58705.invokeStatic(store.clj:159)""
  ""query_processor.store$do_with_metadata_provider58704__58705.invoke(store.clj:150)""
  ""query_processor.setup$do_with_metadata_provider75196__75197$fn__75198.invoke(setup.clj:150)""
  ""query_processor.setup$do_with_resolved_database75186__75187$fn__75188.invoke(setup.clj:128)""
  ""query_processor.setup$do_with_qp_setup75224__75225.invokeStatic(setup.clj:232)""
  ""query_processor.setup$do_with_qp_setup75224__75225.invoke(setup.clj:216)""
  ""query_processor.pivot$run_pivot_query85682__85683.invokeStatic(pivot.clj:595)""
  ""query_processor.pivot$run_pivot_query85682__85683.invoke(pivot.clj:585)""
  ""query_processor.card$process_query_for_card_default_run_fn$fn__87567$fn__87568.invoke(card.clj:193)""
  ""query_processor.streaming$_streaming_response$fn__61550$fn__61551$fn__61552.invoke(streaming.clj:175)""
  ""query_processor.streaming$_streaming_response$fn__61550$fn__61551.invoke(streaming.clj:173)""
  ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:164)""
  ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:151)""
  ""query_processor.streaming$_streaming_response$fn__61550.invoke(streaming.clj:170)""
  ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)""
  ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)""
  ""async.streaming_response$do_f_async$task__53178.invoke(streaming_response.clj:97)""],
 :card_id 2070,
 :context :xlsx-download,
 :error nil,
 :row_count 0,
 :running_time 0,
 :data {:rows [], :cols []}}
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-GB"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""redshift""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-25"",
      ""tag"": ""v0.51.4.5"",
      ""hash"": ""d72706b""
    },
    ""settings"": {
      ""report-timezone"": ""UTC""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.4""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.10.226-214.880.amzn2.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

P2

### Additional context

_No response_",macnibblet,2024-11-27 03:43:57+00:00,['adam-james-v'],2024-12-03 22:46:08+00:00,2024-12-03 14:41:00+00:00,https://github.com/metabase/metabase/issues/50551,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Reporting/Export/Pivot', 'Exporting data as pivoted tables')]","[{'comment_id': 2515705906, 'issue_id': 2696892424, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 12, 3, 22, 46, 7, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-03 22:46:07 UTC):  This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)

"
2696254245,issue,closed,completed,Pivot Viz will not Load Until Sandboxed User Visits Table the Viz is Built On,"### Describe the bug

Can be related to https://github.com/metabase/metabase/issues/50256

If you create a pivot table on TableA, then set up an advanced sandbox group on that table, the sandboxed user cannot view the pivot table results until they visit TableA via ""Browse Data""

### To Reproduce

1. Create a pivot table on the Orders table
2. Create test user with ""attribute1"" = 1
3. Create a native SQL question that contains a parameter for order ID and use it to set up **advanced** sandboxing for Orders (ID = attribute1)
4. Add test user to sandboxed group
5. Assign a value to the attribute for the sandbox
6. Log in as test user and view the pivot table
7. See ""Error running query""
8. Go view the table via the data browser (if the user has access to it)
9. Now go back to the Pivot and it works

### Expected behavior

Sandboxed user should be able to see the pivot table

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:134.0) Gecko/20100101 Firefox/134.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres"",
      ""athena"",
      ""mongo"",
      ""bigquery-cloud-sdk""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-10-15"",
      ""tag"": ""v1.50.30"",
      ""hash"": ""a49cb77""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.1 (Debian 15.1-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Blocker for a customer

### Additional context

{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:134.0) Gecko/20100101 Firefox/134.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres"",
      ""athena"",
      ""mongo"",
      ""bigquery-cloud-sdk""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-10-15"",
      ""tag"": ""v1.50.30"",
      ""hash"": ""a49cb77""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.1 (Debian 15.1-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.24+8"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.24"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.24+8"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.167.4-microsoft-standard-WSL2"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}",ixipixi,2024-11-26 22:19:04+00:00,['metamben'],2024-12-04 19:24:27+00:00,2024-12-04 19:24:25+00:00,https://github.com/metabase/metabase/issues/50545,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('.Team/Querying', ''), ('Querying/Pivot', 'Queries that generate pivot tables')]","[{'comment_id': 2506761151, 'issue_id': 2696254245, 'author': 'metamben', 'body': ""@ixipixi, I was unable to reproduce the issue on `master` at 9cc1a46c8a. Can you? If  you can, could you please record a loom?\nEdit: I've tried to reproduce it with `v1.50.30` at a49cb771f1 and failed."", 'created_at': datetime.datetime(2024, 11, 28, 21, 12, 18, tzinfo=datetime.timezone.utc)}, {'comment_id': 2512172901, 'issue_id': 2696254245, 'author': 'ixipixi', 'body': ""@metamben I can't repro on master. Noah suspected this was probably the same issue that was fixed with this PR: https://github.com/metabase/metabase/pull/50049"", 'created_at': datetime.datetime(2024, 12, 2, 17, 3, 21, tzinfo=datetime.timezone.utc)}, {'comment_id': 2512353136, 'issue_id': 2696254245, 'author': 'metamben', 'body': '@ixipixi should this issue be kept open then? Note that I failed to reproduce it with `v1.50.30` too.', 'created_at': datetime.datetime(2024, 12, 2, 18, 25, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2518376745, 'issue_id': 2696254245, 'author': 'ixipixi', 'body': ""@metamben I can still repro on 50.30 but I just ran through it on 51.6 and can't repro there - so I think we can safely call this fixed."", 'created_at': datetime.datetime(2024, 12, 4, 19, 24, 25, tzinfo=datetime.timezone.utc)}]","metamben (Assginee) on (2024-11-28 21:12:18 UTC): @ixipixi, I was unable to reproduce the issue on `master` at 9cc1a46c8a. Can you? If  you can, could you please record a loom?
Edit: I've tried to reproduce it with `v1.50.30` at a49cb771f1 and failed.

ixipixi (Issue Creator) on (2024-12-02 17:03:21 UTC): @metamben I can't repro on master. Noah suspected this was probably the same issue that was fixed with this PR: https://github.com/metabase/metabase/pull/50049

metamben (Assginee) on (2024-12-02 18:25:16 UTC): @ixipixi should this issue be kept open then? Note that I failed to reproduce it with `v1.50.30` too.

ixipixi (Issue Creator) on (2024-12-04 19:24:25 UTC): @metamben I can still repro on 50.30 but I just ran through it on 51.6 and can't repro there - so I think we can safely call this fixed.

"
2695932947,issue,open,,Ability to remove PDF exports from public links,"**Is your feature request related to a problem? Please describe.**
Currently, when dashboards are shared externally via public links, the ""Export tab as PDF"" option is available by default in the top-right corner. This creates a potential issue for organizations that want to restrict access to exported content.

**Describe the solution you'd like**
A feature that allows admins to disable the ""Export tab as PDF"" functionality for dashboards via public links. Ideally, via a toggle option when creating the public links.

**Describe alternatives you've considered**
Removing the PDF export functionality from the public links

**Additional context**
Asked by a customer
",dahyeik,2024-11-26 20:00:14+00:00,[],2025-02-04 20:31:10+00:00,,https://github.com/metabase/metabase/issues/50533,"[('Type:New Feature', ''), ('Embedding/Public', 'Simple public iframe embeds'), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('.Team/Embedding', ''), ('Sharing/Public', '')]","[{'comment_id': 2539405603, 'issue_id': 2695932947, 'author': 'elyalvarado', 'body': 'Currently for embedded dashboards we can set `downloads=false`, to disable the ""Export to PDF"", but that will also disable all other downloads (specially CSV) we would like the ability to disable PDF exports but keeping CSV downloads', 'created_at': datetime.datetime(2024, 12, 12, 16, 15, 57, tzinfo=datetime.timezone.utc)}]","elyalvarado on (2024-12-12 16:15:57 UTC): Currently for embedded dashboards we can set `downloads=false`, to disable the ""Export to PDF"", but that will also disable all other downloads (specially CSV) we would like the ability to disable PDF exports but keeping CSV downloads

"
2695768083,issue,closed,completed,Entity Picker Improvements,"We want to improve the Entity Picker experience within the notebook editor. This includes a number of small changes:
- Limiting the size of the modal
- moving the search input to be more prominent
- giving databases in the Tables tab their own style
- merging the Metrics, Saved Questions, and Models tabs, while introducing a filter if you're looking for something specific

Figma link [here](https://www.figma.com/design/ff1z9vhHNtgu1LAPhaa5eF/Entity-Picker-Component?node-id=1130-6335&t=svN2P3U6ev3EE3I4-4)

https://www.notion.so/metabase/Design-improvements-to-the-EntityPicker-10d69354c9018020b235cf84928df3ba
",npfitz,2024-11-26 18:53:41+00:00,['npfitz'],2024-12-16 16:30:59+00:00,2024-12-16 16:30:59+00:00,https://github.com/metabase/metabase/issues/50526,"[('Querying/Notebook', 'Items specific to the Custom/Notebook query builder'), ('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/AdminWebapp', 'Admin and Webapp team'), ('Organization/Entity picker', '')]",[],
2695657915,issue,closed,completed,Track upload-replace events in audit_log,"**Context**
We are tracking replaces as appends in the audit_log
We should split these events

v1.51.4

[context](https://metaboat.slack.com/archives/C0641E4PB9B/p1732644897791519)",luizarakaki,2024-11-26 18:19:51+00:00,[],2024-11-27 06:49:58+00:00,2024-11-27 06:07:29+00:00,https://github.com/metabase/metabase/issues/50523,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Usage analytics', 'Pro and Enterprise meta analytics, fka audit')]",[],
2695476741,issue,closed,completed,"[SDK] modals don't use the correct portal on storybook and cypress component tests, this leads to wrong styles being applied","https://metaboat.slack.com/archives/C063Q3F1HPF/p1732639135868419


This is making CI break and therefore blocking https://github.com/metabase/metabase/pull/50466 


Cypress:
start from interactive, drill drown on anything with ""See these records"" -> save, select a destination

![Image](https://github.com/user-attachments/assets/2fc60d74-6f9d-46e7-a040-eb43d5f649e9)



Storybook:

![Image](https://github.com/user-attachments/assets/0d7f9d56-f323-41d2-a3c1-a6c24774b5cb)
",npretto,2024-11-26 17:14:24+00:00,['npretto'],2024-11-27 13:43:15+00:00,2024-11-27 12:32:10+00:00,https://github.com/metabase/metabase/issues/50521,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2503913731, 'issue_id': 2695476741, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 11, 27, 13, 43, 15, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-11-27 13:43:15 UTC):  This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)

"
2695352215,issue,closed,completed,"Non-pivoted Excel downloads do not work with ""Multiply by a number"" (scale)","### Describe the bug

# Non-pivoted Excel downloads do not work with scale

While fixing #50476, I realized that the multiplier (internal name: `scale`) doesn't get applied to excel exports. There is a [passing test for scaled excel downloads](https://github.com/metabase/metabase/blob/master/test/metabase/query_processor/streaming/xlsx_test.clj#L546), but it must not be checking the right thing.

So multipliers now work with Pivoted excel downloads, but not non-pivoted ones.

---

### To Reproduce

1. Go make a plain question on Orders
2. Click on the visualization gear
3. Set ""Multiply by a number"" (the `scale`) to be 0 like so:
![Image](https://github.com/user-attachments/assets/8e51a574-a8e2-4ffa-9fa6-d115ca8086c1)
4. Notice the tax column is now all 0.
5. Do an excel export
![Image](https://github.com/user-attachments/assets/368eea39-1f88-4af2-a8bc-d1ba7a6e039f)
6. check that the tax column is Not 0.
![Image](https://github.com/user-attachments/assets/eed02496-662d-4ead-8f94-bacd7a676a7d)



### Expected behavior

The tax column should be multiplied by the scale on excel exports. (all 0's in this case).

### Logs

nothing out of the ordinary

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""dev"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-11-20"",
      ""tag"": ""v1.52.2-SNAPSHOT"",
      ""hash"": ""5bec697""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.4 (Homebrew)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21+35-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21+35-LTS"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""15.0.1"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```

### Severity

P2

### Additional context

I don't believe this has been reported, but we should still fix it.",escherize,2024-11-26 16:47:19+00:00,[],2025-01-28 22:07:59+00:00,2025-01-22 22:26:21+00:00,https://github.com/metabase/metabase/issues/50518,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Reporting/Export/Pivot', 'Exporting data as pivoted tables')]","[{'comment_id': 2620155192, 'issue_id': 2695352215, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)', 'created_at': datetime.datetime(2025, 1, 28, 22, 7, 58, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2025-01-28 22:07:58 UTC):  This should also be released by [v0.53](https://github.com/metabase/metabase/milestone/287)

"
2695110924,issue,open,,Show the total number of rows of the result set along the limit that we're fetching,"If you're doing a question in Metabase and rendering it on a table, we fetch a subset of the total rows. It would be interesting if we can show the total amount of rows that the result has, along with how many rows we fetched in order to give the user an order of magnitude of what they're seeing",paoliniluis,2024-11-26 15:38:06+00:00,[],2025-02-04 20:31:57+00:00,,https://github.com/metabase/metabase/issues/50514,"[('Type:New Feature', ''), ('Visualization/Tables', 'raw, summarized and tabular visualizations')]",[],
2694959878,issue,closed,completed,Hide group into other feature,"[Product doc](https://www.notion.so/metabase/Allow-for-grouping-large-numbers-of-series-into-other-61660fc5206a48ed8ce12a19c2e6ef96)

**Context**

The [grouping into other feature](https://www.notion.so/metabase/Allow-for-grouping-large-numbers-of-series-into-other-61660fc5206a48ed8ce12a19c2e6ef96) is partially merged, however, we do not have sufficient capacity to provide good UX or discoverability to it so we are temporarily hiding the functionality to ship it in v53 instead of v52.

",alxnddr,2024-11-26 14:47:24+00:00,[],2024-11-27 01:38:04+00:00,2024-11-27 01:38:04+00:00,https://github.com/metabase/metabase/issues/50510,"[('.Team/DashViz', 'Dashboard and Viz team')]",[],
2694690355,issue,closed,completed,Use public-facing question type across the sdk,"Depends on https://github.com/metabase/metabase/issues/50487 to be done first.

Let's replace our usage of the MLv1 `Question` object with the public-facing Question object. 

Also, the `DashCardMenuCustomElement` and `CustomDashCardMenuItem` is using the internal `Card` type from `metabase/api/types`. We should also replace any public-facing use of `Card` with the public-facing `Question` type.",heypoom,2024-11-26 13:32:01+00:00,['heypoom'],2024-12-09 11:21:12+00:00,2024-12-09 11:21:11+00:00,https://github.com/metabase/metabase/issues/50505,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2694682641,issue,closed,completed,Always show the embed sharing option for both questions and dashboards,"Epic: https://github.com/metabase/metabase/issues/50503

[Tech doc](https://www.notion.so/metabase/Tech-Streamline-embed-flow-when-embedding-features-are-off-14969354c90180d4968de8b71b235f52?pvs=4#14969354c9018084bd8ceced57d8cec3)

This issue will implement 1 things:
1. Make the embed option always clickable for admins regardless of the static embedding status. Previously, this was only clickable when the static embedding is enabled.",WiNloSt,2024-11-26 13:28:57+00:00,['WiNloSt'],2024-12-04 06:07:28+00:00,2024-12-04 06:07:28+00:00,https://github.com/metabase/metabase/issues/50504,"[('.Team/Embedding', '')]",[],
2694664674,issue,closed,completed,[Epic] Streamline embed flow when embedding features are off,"### Links

- [Product doc](https://www.notion.so/metabase/Streamline-embed-flow-when-embedding-features-are-off-13869354c90180b4bc02ca29ebf61ad2)
- [Tech plan](https://www.notion.so/metabase/Tech-Streamline-embed-flow-when-embedding-features-are-off-14969354c90180d4968de8b71b235f52)
- [Testing plan](https://www.notion.so/metabase/Testing-plan-Streamline-embed-flow-when-embedding-features-are-off-14969354c90180008377da8d884267ed?pvs=25)
- [Figma file](https://www.figma.com/design/W1TfzdrR8ldzp4vdjP1z36/SDK-Embedding%3A-admin-settings-%2B-embed-flow?node-id=10661-18909&node-type=frame&t=cZqJnLqM3YnqITfR-0)
- feature branch: `50503-streamline-embed-flow-when-embedding-is-off`

### Implementation Plan

```[tasklist]
#### Milestone 1
- [ ] https://github.com/metabase/metabase/issues/50504
- [ ] https://github.com/metabase/metabase/issues/50552
- [ ] https://github.com/metabase/metabase/issues/50616
- [ ] ~Keep the sharing modal state~ harder than expected
- [x] Integration branch PR https://github.com/metabase/metabase/pull/50842
```
",WiNloSt,2024-11-26 13:22:59+00:00,['WiNloSt'],2024-12-06 12:54:00+00:00,2024-12-06 12:53:59+00:00,https://github.com/metabase/metabase/issues/50503,"[('.Frontend', ''), ('.Epic', 'Feature Implementation or Project'), ('.Team/Embedding', '')]",[],
2694609298,issue,open,,Customizable Time Ranges for Email Subscriptions,"Currently, Metabase supports email subscriptions with predefined intervals (e.g., hourly, daily, weekly). However, there is no option to set specific time ranges for email subscriptions, such as ""from 9 AM to 5 PM"". This limitation restricts users who require insights at customized times to align with business hours or specific operational requirements.

Proposed Solution:
Add functionality to define specific time ranges for email subscriptions. Users should be able to configure:

Start Time: The time from which the subscription begins sending emails.
End Time: The time until which the subscription remains active.
This feature would complement the existing intervals and improve flexibility for users managing real-time or business-critical dashboards.

Use Case:

Monitoring metrics during business hours (e.g., 9 AM - 5 PM).
Avoiding unnecessary email updates during non-working hours.
Benefits:

Tailored insights aligned with operational timelines.
Reduced noise from irrelevant updates outside desired hours.
Reference Issue:
This request builds upon the email subscription feature discussed in [Issue #3846](https://github.com/metabase/metabase/issues/3846).
![Image](https://github.com/user-attachments/assets/bb6b3981-c9a2-4a1e-b8bb-eb48e0788518)




",Shreyamitti,2024-11-26 13:11:35+00:00,[],2025-02-04 20:30:38+00:00,,https://github.com/metabase/metabase/issues/50502,"[('Reporting/Pulses', 'Now called Subscriptions'), ('Type:New Feature', ''), ('Reporting/Alerts', ''), ('.Team/Workflows', 'aka BEC')]",[],
2694570827,issue,closed,completed,Uploading CSV no longer works when there is materialized views (postgresql),"### Describe the bug

From version 0.51 (checked v0.51.4 as well, where there was a fixed for probably related issue https://github.com/metabase/metabase/issues/49912), if there is at least one materialized view, uploaded CSV model will have no fields or wrong fields detected.

### To Reproduce

1. Create a materialized view.
2. Upload any CSV
3. Open the model created from CSV
4. See error `no fields found for table <csv_table_name>`


### Expected behavior

_No response_

### Logs

<details>
<summary>ERROR: duplicate key value violates unique constraint ""idx_unique_field""</summary>

```
metabase-1  | clojure.lang.ExceptionInfo: ERROR: duplicate key value violates unique constraint ""idx_unique_field""
metabase-1  |   Detail: Key (name, table_id, unique_field_helper)=(created_at, 21, 0) already exists. {:toucan2/context-trace [[""execute SQL with class com.mchange.v2.c3p0.impl.NewProxyConnection"" {:toucan2.jdbc.query/sql-args [""INSERT INTO \""metabase_field\"" (\""description\"", \""database_type\"", \""semantic_type\"", \""table_id\"", \""coercion_strategy\"", \""name\"", \""updated_at\"", \""effective_type\"", \""nfc_path\"", \""parent_id\"", \""database_partitioned\"", \""database_is_auto_increment\"", \""json_unfolding\"", \""position\"", \""visibility_type\"", \""display_name\"", \""database_position\"", \""database_required\"", \""created_at\"", \""base_type\"") VALUES ...
...
metabase-1  | 	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
...
metabase-1  | Caused by: org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint ""idx_unique_field""
metabase-1  |   Detail: Key (name, table_id, unique_field_helper)=(created_at, 21, 0) already exists.
metabase-1  | 	... 428 more
```

</details>

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64; rv:132.0) Gecko/20100101 Firefox/132.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-19"",
      ""tag"": ""v0.51.4"",
      ""hash"": ""47f05f3""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.7 (Debian 14.7-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.11.7-200.fc40.x86_64"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Blocking upgrade from 0.50 to 0.51

### Additional context

_No response_",lephuongbg,2024-11-26 12:55:43+00:00,[],2024-11-28 07:51:52+00:00,2024-11-27 17:05:58+00:00,https://github.com/metabase/metabase/issues/50501,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('Cloud-Blocker:51', 'Issues blocking the cloud customers to be upgraded to v51'), ('.Team/Drivers', ''), ('Bug:v51', 'bugs or regressions introduced in v51')]","[{'comment_id': 2505461745, 'issue_id': 2694570827, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 11, 28, 7, 51, 51, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-11-28 07:51:51 UTC):  This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)

"
2694553542,issue,open,,Track snippet changes in audit_log,"**Context**
We don't track operations on Snippets: creation, updates, archive.
Should also track changes to Snippet permissions.
As snippets change query definitions, we should track them.

[Thread](https://metaboat.slack.com/archives/C04K1LEUPC5/p1732534791628009)

",luizarakaki,2024-11-26 12:48:41+00:00,[],2025-02-04 20:30:23+00:00,,https://github.com/metabase/metabase/issues/50500,"[('Type:New Feature', ''), ('Administration/Usage analytics', 'Pro and Enterprise meta analytics, fka audit'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2694001977,issue,open,,[Spike] Try Cypress component visual regression tests for embedding sdk,"We should spike setting up Cypress visual regression tests using component testing, so we can verify if SDK components work consistently across the many theme options and color mappings we have.",heypoom,2024-11-26 10:02:11+00:00,['sanex3339'],2025-02-04 20:25:58+00:00,,https://github.com/metabase/metabase/issues/50496,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2693988022,issue,closed,completed,Implement withChartTypeSelector in InteractiveQuestion in sdk,We should implement withChartTypeSelector (formerly showVisualizationSelector) in InteractiveQuestion for API consistency.,heypoom,2024-11-26 09:56:52+00:00,['heypoom'],2024-12-04 16:15:28+00:00,2024-11-29 20:23:03+00:00,https://github.com/metabase/metabase/issues/50495,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2517908453, 'issue_id': 2693988022, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 12, 4, 16, 15, 27, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-04 16:15:27 UTC):  This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)

"
2693875134,issue,closed,completed,Support providing parameter values in InteractiveQuestion in the sdk,"We had a [Slack discussion thread](https://metaboat.slack.com/archives/C063Q3F1HPF/p1721234527748689) about implementing `parameterValues` in interactive questions back in July. Back then, we decided to close https://github.com/metabase/metabase/pull/45664 because of [a lack of drill-down support](https://metaboat.slack.com/archives/C063Q3F1HPF/p1721247361723199?thread_ts=1721234527.748689&cid=C063Q3F1HPF) in SQL questions.

Now that the team has implemented SQL drill-downs into the product, we can implement parameter values in InteractiveQuestion. We should be able to repurpose https://github.com/metabase/metabase/pull/45664 with some small fixes to make it work with the current codebase.",heypoom,2024-11-26 09:30:57+00:00,['heypoom'],2024-12-17 18:14:57+00:00,2024-12-09 16:43:21+00:00,https://github.com/metabase/metabase/issues/50493,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2549244186, 'issue_id': 2693875134, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)', 'created_at': datetime.datetime(2024, 12, 17, 18, 14, 55, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-17 18:14:55 UTC):  This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)

"
2693874976,issue,closed,completed,Rename parameter value props in sdk components to match their use cases,"We should rename both the `parameterValues` and `initialParameterValues` props in SDK components. We should rename them to `initialSqlParameters` for question components, and to `initialParameters` for dashboard components.

initialSqlParameters should only apply to the question components. In dashboards, the parameters could apply to either SQL questions or GUI questions, or text and header cards with parameters. In contrast, the questions only supports parameters in SQL questions.",heypoom,2024-11-26 09:30:53+00:00,['heypoom'],2024-12-03 23:18:42+00:00,2024-12-03 22:19:41+00:00,https://github.com/metabase/metabase/issues/50492,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2693841012,issue,closed,completed,Rename InteractiveDashboard question height props in the sdk,Let's rename `questionHeight` to `drillThroughQuestionHeight` to make it more obvious what this prop does.,heypoom,2024-11-26 09:17:07+00:00,['heypoom'],2024-12-04 12:36:09+00:00,2024-12-04 12:36:09+00:00,https://github.com/metabase/metabase/issues/50491,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2693831146,issue,closed,completed,Add missing props from InteractiveDashboard to StaticDashboard for consistency in the sdk,"There are some props missing from `StaticDashboard` and causing API inconsistency in the SDK, specifically these props:

```
  questionHeight?: number;
  plugins?: SdkPluginsConfig;
  className?: string;
  style?: CSSProperties;
```

Let's implement `className` and `style` in the `StaticDashboard` as well.

Update: we cannot implement `drillThroughQuestionHeight` as we cannot drill through in static dashboards.",heypoom,2024-11-26 09:13:06+00:00,['heypoom'],2024-12-04 17:43:58+00:00,2024-12-04 17:01:39+00:00,https://github.com/metabase/metabase/issues/50490,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2693816861,issue,closed,completed,Combine the customTitle and withTitle prop into a single title prop for interactive questions in sdk,"Removes the `withTitle` and `customTitle` props in the interactive question component, and replaces it with the `title` property:

- `undefined` or `true` shows the default title. note that the title is **now shown by default**.
- `false` hides the title
- `(value: Question) => ReactNode`: custom title
- `ReactNode`: custom title

The resulting type should now be `title: boolean | ReactNode | (question: Question) => ReactNode`",heypoom,2024-11-26 09:07:09+00:00,['heypoom'],2024-12-10 14:28:23+00:00,2024-12-09 18:23:32+00:00,https://github.com/metabase/metabase/issues/50489,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2531792131, 'issue_id': 2693816861, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)', 'created_at': datetime.datetime(2024, 12, 10, 14, 28, 21, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-10 14:28:21 UTC):  This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)

"
2693581100,issue,closed,completed,Expose public-facing question type and transforms for sdk,"Exposes a minimal, public-facing `MetabaseQuestion` type and transforms for use in the sdk.",heypoom,2024-11-26 07:41:33+00:00,['heypoom'],2024-12-11 12:38:10+00:00,2024-12-09 11:21:11+00:00,https://github.com/metabase/metabase/issues/50487,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2535879639, 'issue_id': 2693581100, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)', 'created_at': datetime.datetime(2024, 12, 11, 12, 38, 9, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-11 12:38:09 UTC):  This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)

"
2693565291,issue,closed,completed,Move non-auth sdk config to MetabaseProvider props and rename field to authConfig,"We should rename the current `SDKConfig` type to `MetabaseAuthConfig` and only store authentication-related config there. We should then move the rest of the props (errorComponent, loaderComponent, allowConsoleLog) to `MetabaseProvider`. We should call the configuration prop `authConfig`.",heypoom,2024-11-26 07:35:33+00:00,['heypoom'],2024-12-17 15:09:31+00:00,2024-12-09 17:44:44+00:00,https://github.com/metabase/metabase/issues/50486,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2548706924, 'issue_id': 2693565291, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)', 'created_at': datetime.datetime(2024, 12, 17, 15, 9, 29, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-17 15:09:29 UTC):  This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)

"
2693508866,issue,closed,duplicate,Date Filters not working correctly on Drilldown view of Tables created using SQL query,"### Describe the bug

**Status Quo:**

Table view with/without any filters -> With Filters the table shows correct results... i.e, Nov 2024 data is shown
![Image](https://github.com/user-attachments/assets/fb12d705-df38-49c0-ab29-2e3ecb14e30a)

When in DrillDown, the same table with the filters of Nov 2024 doesn't show Nov 2024 results, instead it shows all the results.  
![Image](https://github.com/user-attachments/assets/c7ea5ea5-fb0c-40c1-be3d-c16d61e682ee)

**To DO:**
Filters should also ideally work in DrillDown view

### To Reproduce

1. Go to 'an exiting table created from an Custom SQL query'
2. Click on 'Any column and use the DrillDown to go into the depth of the table'
3. Drilldown works perfectly fine, and user will see the results that he/she used the DrillDown for
4. Start applying 'Date Filter' in DrillDown view and the UI shows as if the results for the filters are getting loaded
5. Results are shown without applying the 'Date Filters'

### Expected behavior

_No response_

### Logs

  :errors
  ({:path
    [0
     0
     :stages
     0
     0
     0
     0
     1
     :mbql.stage/mbql
     0
     0
     :filters
     0
     0
     0
     0
     0
     true
     0
     :between
     0
     0
     2
     0
     0
     true
     0
     :malli.core/default],
    :in [:stages 1 :filters 1 2],
    :schema
    [:fn {:error/message ""not a known MBQL clause""} #object[clojure.core$constantly$fn__5759 0x18af452e ""clojure.core$constantly$fn__5759@18af452e""]],
    :value [:template-tag {:lib/uuid ""7f944998-c81d-4c44-93fe-461613e95889""} ""Date""]})}}

[96fe93b9-472a-41bd-bf4a-94ddd2db84fd] 2024-11-26T08:18:16+01:00 WARN metabase.lib.convert Clean: Removing bad clause in [:filters 1 2] due to error {:filters [nil [nil nil [""not a known MBQL clause""]]]}:
{:filters
 [nil [nil nil [:template-tag {:lib/uuid ""7f944998-c81d-4c44-93fe-461613e95889""} ""Date""] ""2024-11-01"" ""2024-11-30""]]}

[96fe93b9-472a-41bd-bf4a-94ddd2db84fd] 2024-11-26T08:18:16+01:00 WARN metabase.lib.convert Clean: Removing bad clause in [:filters 1] due to error :malli.core/tuple-size:
{:filters [nil [:between {:lib/uuid ""a6a1d662-be30-4c65-bbce-0f5785cef03b""} ""2024-11-01"" ""2024-11-30""]]}

### Information about your Metabase installation

```JSON
- Browser - Version 130.0.6723.117 (Official Build) (arm64)
- OS - macOS Sonoma 14.6.1
- Databases - Postgres
- Metabase Version 0.51.4
```

### Severity

P1 (Blocking users to analyse data inside DrillDown view

### Additional context

_No response_",Sidhantp12,2024-11-26 07:27:07+00:00,['appleby'],2025-01-21 21:18:14+00:00,2025-01-21 21:18:14+00:00,https://github.com/metabase/metabase/issues/50485,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/MBQL', ''), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2515003739, 'issue_id': 2693508866, 'author': 'ranquild', 'body': 'Based on the screenshot, this is about calling a dashboard card query endpoint with parameters for a saved question when the user doesn\'t have query access. This line in logs seems interesting:\n```\n[96fe93b9-472a-41bd-bf4a-94ddd2db84fd] 2024-11-26T08:18:16+01:00 WARN metabase.lib.convert Clean: Removing bad clause in [:filters 1] due to error :malli.core/tuple-size:\n{:filters [nil [:between {:lib/uuid ""a6a1d662-be30-4c65-bbce-0f5785cef03b""} ""2024-11-01"" ""2024-11-30""]]}\n```\nSomewhere in the QP we create a wrong filter based on the provided parameter.', 'created_at': datetime.datetime(2024, 12, 3, 16, 16, 46, tzinfo=datetime.timezone.utc)}, {'comment_id': 2605756226, 'issue_id': 2693508866, 'author': 'appleby', 'body': 'Closing this as a duplicate of #49051 and upgrading that to a P1.\n\nhttps://metaboat.slack.com/archives/C0645JP1W81/p1737493192537889?thread_ts=1737493000.610949&cid=C0645JP1W81', 'created_at': datetime.datetime(2025, 1, 21, 21, 16, 27, tzinfo=datetime.timezone.utc)}]","ranquild on (2024-12-03 16:16:46 UTC): Based on the screenshot, this is about calling a dashboard card query endpoint with parameters for a saved question when the user doesn't have query access. This line in logs seems interesting:
```
[96fe93b9-472a-41bd-bf4a-94ddd2db84fd] 2024-11-26T08:18:16+01:00 WARN metabase.lib.convert Clean: Removing bad clause in [:filters 1] due to error :malli.core/tuple-size:
{:filters [nil [:between {:lib/uuid ""a6a1d662-be30-4c65-bbce-0f5785cef03b""} ""2024-11-01"" ""2024-11-30""]]}
```
Somewhere in the QP we create a wrong filter based on the provided parameter.

appleby (Assginee) on (2025-01-21 21:16:27 UTC): Closing this as a duplicate of #49051 and upgrading that to a P1.

https://metaboat.slack.com/archives/C0645JP1W81/p1737493192537889?thread_ts=1737493000.610949&cid=C0645JP1W81

"
2692992647,issue,open,,trend visualization can't effect,"### Describe the bug

my sql is:
```
SELECT
  date_trunc (DAY, timestamp) AS create_at,
  count(*) AS COUNT
FROM
  t_rsyslog_v2
WHERE
  type = 'bmc'
  AND timestamp >= date_sub (DAY, 1, to_date (now ()))
GROUP BY
  create_at
ORDER BY
  COUNT DESC
```
it work normal with table visualization:  
![Image](https://github.com/user-attachments/assets/7e83d4fe-db78-4855-ad69-cd5c76a96bfe)

but it always complain  when using trend visualization throw not time fieldhowever  above sql which contains timestamp field alreadyi can't find any problem
![Image](https://github.com/user-attachments/assets/21b6f10d-ae98-4d89-b478-b1956868a6b5)


how can i do to solove it

best wishes


### To Reproduce

no



### Expected behavior

visualize normal with trend

### Logs

_No response_

### Information about your Metabase installation

```JSON
no
```

### Severity

critical

### Additional context

_No response_",lddlww,2024-11-26 03:48:57+00:00,[],2025-01-03 18:05:47+00:00,,https://github.com/metabase/metabase/issues/50482,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2502010284, 'issue_id': 2692992647, 'author': 'alxnddr', 'body': 'Based on formatting, `created_at` column values appear to have ""type/Text"" type instead of `type/DateTime`:\n![Image](https://github.com/user-attachments/assets/61ad37b1-0036-4b9f-a829-cbcdacdd8aaa)\nBecause of that, the trend visualization is not picking up this column as a date column', 'created_at': datetime.datetime(2024, 11, 26, 21, 52, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2569622641, 'issue_id': 2692992647, 'author': 'brunobergher', 'body': '@lddlww can you try casting the timestamp as a date? It should work then.', 'created_at': datetime.datetime(2025, 1, 3, 18, 5, 45, tzinfo=datetime.timezone.utc)}]","alxnddr on (2024-11-26 21:52:54 UTC): Based on formatting, `created_at` column values appear to have ""type/Text"" type instead of `type/DateTime`:
![Image](https://github.com/user-attachments/assets/61ad37b1-0036-4b9f-a829-cbcdacdd8aaa)
Because of that, the trend visualization is not picking up this column as a date column

brunobergher on (2025-01-03 18:05:45 UTC): @lddlww can you try casting the timestamp as a date? It should work then.

"
2692958051,issue,closed,not_planned,SQL Filter Issue: Why is 'Area 1' Missing,"### Describe the bug

I am using a CASE WHEN statement to create a new column as shown below. New column is created with my desired value. However, when I use the new column as a filter, it returns 'No Result' for the value 'Area 1'. I hope you can help me identify the problem.

CASE 
    WHEN C.province = ""H Ni"" then ""Area 1""
    WHEN C.province = ""TP. HCM"" then ""Area 2""
    END AS area_2

### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""vi-VN"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""mysql""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-11"",
      ""tag"": ""v0.51.3"",
      ""hash"": ""d757d0b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""17.0.12+0"",
    ""java.vendor"": ""Homebrew"",
    ""java.vendor.url"": ""https://github.com/Homebrew/homebrew-core/issues"",
    ""java.version"": ""17.0.12"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""17.0.12+0"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""13.4.1"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Asia/Ho_Chi_Minh""
  }
}
```

### Severity

no 

### Additional context

_No response_",beto1810,2024-11-26 03:19:20+00:00,[],2024-11-26 13:12:14+00:00,2024-11-26 13:12:12+00:00,https://github.com/metabase/metabase/issues/50481,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2500768388, 'issue_id': 2692958051, 'author': 'paoliniluis', 'body': 'Please use the forum for questions', 'created_at': datetime.datetime(2024, 11, 26, 13, 12, 12, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-11-26 13:12:12 UTC): Please use the forum for questions

"
2692336267,issue,closed,completed,Replace legacy `DatePicker` in parameter widgets with a modern `DatePicker` used in the QB,The old date picker uses raw MBQL for anything and is hard to follow. We also need to maintain 2 implementations. Let's replace the old component with the newer version.,ranquild,2024-11-25 21:33:39+00:00,['ranquild'],2025-01-08 01:12:50+00:00,2025-01-08 01:12:42+00:00,https://github.com/metabase/metabase/issues/50477,"[('Type:Tech Debt', 'or Refactoring'), ('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2691795374,issue,closed,completed,Native parameter mapping is broken after multi-stage filters in dashboards,"### Describe the bug

Context https://metaboat.slack.com/archives/C064QMXEV9N/p1732553732526949

### To Reproduce

1. Open https://stats.metabase.com/dashboard/2422
2. Find the ""Cohort"" card
3. See that the mapping is broken - the filter is not applied and the FE believes it's a ""Unknown field"" because it cannot match it either

### Expected behavior

It should work as before

### Logs

_No response_

### Information about your Metabase installation

```JSON
stats
```

### Severity

P1

### Additional context

_No response_",ranquild,2024-11-25 18:35:50+00:00,"['kamilmielnik', 'metamben']",2024-11-26 16:48:23+00:00,2024-11-26 16:48:22+00:00,https://github.com/metabase/metabase/issues/50467,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Frontend', ''), ('.Backend', ''), ('.Regression/master', 'Regression that is only present on master, or bug in new upcoming feature'), ('.Team/Querying', '')]","[{'comment_id': 2498828681, 'issue_id': 2691795374, 'author': 'metamben', 'body': 'The DB migration introduced `stage-number` for native query parameters, which resulted in this issue.', 'created_at': datetime.datetime(2024, 11, 25, 19, 10, 43, tzinfo=datetime.timezone.utc)}]","metamben (Assginee) on (2024-11-25 19:10:43 UTC): The DB migration introduced `stage-number` for native query parameters, which resulted in this issue.

"
2691781565,issue,open,,Enable static embedding on mobile apps by allowing schemas other than http(s),"**Is your feature request related to a problem? Please describe.**
Static embedded Metabase dashboards currently refuses to be loaded as an iframe in mobile iOS apps using Ionic Cordova.
The problem comes from the CSP (Content Security Policy) header in the HTTP response.
The directive frame-ancestors: *; allows only http and https schema. It is not compatible with iOS and Ionic because it uses ionic: schema.

* For interactive embedding, the frame-ancestors can be controlled via settings.
* For static embedding, the frame-ancestors is hard coded to `*`

**Describe the solution you'd like**
Introduce a setting to enable other schemas

**Describe alternatives you've considered**
The customer submitted at PR, but this should be a setting and not hard coded: https://github.com/metabase/metabase/pull/50412

**How important is this feature to you?**

**Additional context**
Add any other context or screenshots about the feature request here.
",albertoperdomo,2024-11-25 18:28:16+00:00,[],2025-02-07 10:52:04+00:00,,https://github.com/metabase/metabase/issues/50465,"[('Type:New Feature', ''), ('Embedding/Static', 'Static embedding, previously known as signed embedding'), ('.Team/Embedding', '')]","[{'comment_id': 2525338141, 'issue_id': 2691781565, 'author': 'paoliniluis', 'body': 'duplicate of https://github.com/metabase/metabase/issues/38637?', 'created_at': datetime.datetime(2024, 12, 7, 23, 9, 11, tzinfo=datetime.timezone.utc)}, {'comment_id': 2642579035, 'issue_id': 2691781565, 'author': 'AurelienJoy', 'body': '> duplicate of [#38637](https://github.com/metabase/metabase/issues/38637)?\n\nThis feature request would indeed solve that another issue but in a more secure way than the proposed solution to completely removed the directive. Objective is to be able to control the iframe-ancestor setting on static embedding.', 'created_at': datetime.datetime(2025, 2, 7, 10, 51, 51, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-12-07 23:09:11 UTC): duplicate of https://github.com/metabase/metabase/issues/38637?

AurelienJoy on (2025-02-07 10:51:51 UTC): This feature request would indeed solve that another issue but in a more secure way than the proposed solution to completely removed the directive. Objective is to be able to control the iframe-ancestor setting on static embedding.

"
2691542436,issue,closed,completed,Pivoted Excel downloads don't work when multiplying a measure,"### Describe the bug

When downloading a xlsx file from a pivoted table, adding a multiplication to the measure breaks the downloaded file. 

This was originally posted in https://github.com/metabase/metabase/issues/50207#issuecomment-2498019348, but it is not related to re-ordering pivot column rows.



### To Reproduce

1. Go to New Question -> Orders -> Build this question:
2. Setup this query:
![Image](https://github.com/user-attachments/assets/91f60750-a830-4621-ac02-830787769e53)

3. Set it to pivot, and multiply the measure by 2 like so:
<img src=""https://github.com/user-attachments/assets/c4b8d63d-5b65-4c84-aa40-dd745fe64f21"" width=""300"">


3a. notice the counts are all multiples of 2

4. Download the xlsx file, and try to open it:
<img src=""https://github.com/user-attachments/assets/018ef312-2b93-4a88-a846-be5c2443c85d"" width=""200"">

5. it's invalid:
<img src=""https://github.com/user-attachments/assets/d1178fcd-3fbe-4804-880e-cb3fd9d15aaa"" width=""150"">


----

I also tested this w/ CSVs and they work. (see: everything is a multiple of 2, and the file is valid)
<img src=""https://github.com/user-attachments/assets/159c4171-46ac-449c-84d0-7825a3276151"" width=""200"">





### Expected behavior

The excel file should be valid, with the multiplier applied.

### Logs

```
2024-11-25 17:21:27,878 ERROR middleware.catch-exceptions :: Error processing query: class java.lang.String cannot be cast to class java.lang.Number (java.lang.String and java.lang.Number are in module java.base of loader 'bootstrap')
{:database_id 1,
 :started_at #t ""2024-11-25T17:21:27.787447Z[UTC]"",
 :via
 [{:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error ""Error reducing result rows"",
   :stacktrace
   [""--> query_processor.pivot$fn__127523$append_queries_reduce_fn127522__127524$multiple_reducing__127526$respond__127528.invoke(pivot.clj:313)""
    ""driver.sql_jdbc.execute$execute_reducible_query$fn__135096.invoke(execute.clj:725)""
    ""driver.h2$eval137252$fn__137254$fn__137256.invoke(h2.clj:543)""
    ""driver.sql_jdbc.execute$fn__134759$do_with_resolved_connection134758__134760.invoke(execute.clj:338)""
    ""driver.sql_jdbc.execute$fn__134759$fn__134763.invoke(execute.clj:321)""
    ""driver.h2$eval137252$fn__137254.invoke(h2.clj:534)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
    ""driver.sql_jdbc$eval136748$fn__136749.invoke(sql_jdbc.clj:79)""
    ""driver.h2$eval137008$fn__137009.invoke(h2.clj:271)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39)""
    ""query_processor.pivot$fn__127523$append_queries_reduce_fn127522__127524$multiple_reducing__127526$fn__127532.invoke(pivot.clj:324)""
    ""query_processor.pivot$fn__127523$append_queries_reduce_fn127522__127524$multiple_reducing__127526.invoke(pivot.clj:320)""
    ""query_processor.pipeline$_STAR_run_STAR_$respond__95999.invoke(pipeline.clj:100)""
    ""query_processor.pivot$fn__127514$append_queries_execute_fn127513__127515$multiple_execute__127516.invoke(pivot.clj:291)""
    ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102)""
    ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95)""
    ""query_processor.execute$run.invokeStatic(execute.clj:62)""
    ""query_processor.execute$run.invoke(execute.clj:56)""
    ""query_processor.middleware.update_used_cards$fn__107638$update_used_cards_BANG_107637__107639$_AMPERSAND_f__107640.invoke(update_used_cards.clj:60)""
    ""query_processor.middleware.update_used_cards$fn__107638$update_used_cards_BANG_107637__107639$fn__107650.invoke(update_used_cards.clj:52)""
    ""query_processor.execute$add_native_form_to_result_metadata$fn__107662.invoke(execute.clj:25)""
    ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__107668.invoke(execute.clj:36)""
    ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___107488.invoke(cache.clj:241)""
    ""query_processor.middleware.permissions$check_query_permissions$fn__106333.invoke(permissions.clj:148)""
    ""metabase_enterprise.advanced_permissions.query_processor.middleware.permissions$eval187179$check_download_permissions__187180$fn__187181.invoke(permissions.clj:99)""
    ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__102401.invoke(enterprise.clj:51)""
    ""metabase_enterprise.sandbox.query_processor.middleware.column_level_perms_check$eval187379$maybe_apply_column_level_perms_check__187380$fn__187381.invoke(column_level_perms_check.clj:38)""
    ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__102411.invoke(enterprise.clj:64)""
    ""query_processor.execute$fn__107702$execute107701__107703$fn__107704.invoke(execute.clj:94)""
    ""query_processor.setup$fn__106960$do_with_qp_setup106959__106961.invoke(setup.clj:225)""
    ""query_processor.setup$fn__106960$fn__106965.invoke(setup.clj:216)""
    ""query_processor.execute$fn__107702$execute107701__107703.invoke(execute.clj:93)""
    ""query_processor.execute$fn__107702$fn__107707.invoke(execute.clj:89)""
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)""
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)""
    ""metabase_enterprise.audit_app.query_processor.middleware.handle_audit_queries$eval187338$handle_audit_app_internal_queries__187339$fn__187340.invoke(handle_audit_queries.clj:145)""
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__102439.invoke(enterprise.clj:103)""
    ""query_processor.middleware.process_userland_query$fn__108132$process_userland_query_middleware108131__108133$_AMPERSAND_f__108134.invoke(process_userland_query.clj:204)""
    ""query_processor.middleware.process_userland_query$fn__108132$process_userland_query_middleware108131__108133$fn__108140.invoke(process_userland_query.clj:188)""
    ""query_processor.middleware.catch_exceptions$fn__107801$catch_exceptions107800__107802$_AMPERSAND_f__107803.invoke(catch_exceptions.clj:132)""
    ""query_processor.middleware.catch_exceptions$fn__107801$catch_exceptions107800__107802$fn__107818.invoke(catch_exceptions.clj:122)""
    ""query_processor$fn__108476$process_query108475__108477$fn__108478.invoke(query_processor.clj:80)""
    ""query_processor.setup$fn__106960$do_with_qp_setup106959__106961.invoke(setup.clj:225)""
    ""query_processor.setup$fn__106960$fn__106965.invoke(setup.clj:216)""
    ""query_processor$fn__108476$process_query108475__108477.invoke(query_processor.clj:78)""
    ""query_processor$fn__108476$fn__108482.invoke(query_processor.clj:71)""
    ""query_processor.pivot$fn__127547$process_multiple_queries127546__127549.invoke(pivot.clj:350)""
    ""query_processor.pivot$fn__127547$fn__127559.invoke(pivot.clj:340)""
    ""query_processor.pivot$fn__127669$run_pivot_query127668__127670$fn__127671.invoke(pivot.clj:605)""
    ""query_processor.setup$fn__106951$do_with_canceled_chan106950__106952$fn__106953.invoke(setup.clj:187)""
    ""query_processor.setup$fn__106940$do_with_database_local_settings106939__106941$fn__106942.invoke(setup.clj:181)""
    ""query_processor.setup$fn__106929$do_with_driver106928__106930$fn__106931$fn__106932.invoke(setup.clj:166)""
    ""driver$do_with_driver.invokeStatic(driver.clj:106)""
    ""driver$do_with_driver.invoke(driver.clj:101)""
    ""query_processor.setup$fn__106929$do_with_driver106928__106930$fn__106931.invoke(setup.clj:165)""
    ""query_processor.setup$fn__106916$do_with_metadata_provider106915__106917$fn__106918$fn__106921.invoke(setup.clj:151)""
    ""query_processor.store$fn__88334$do_with_metadata_provider88333__88335.invoke(store.clj:170)""
    ""query_processor.store$fn__88334$fn__88338.invoke(store.clj:150)""
    ""query_processor.store$fn__88334$do_with_metadata_provider88333__88335.invoke(store.clj:159)""
    ""query_processor.store$fn__88334$fn__88338.invoke(store.clj:150)""
    ""query_processor.setup$fn__106916$do_with_metadata_provider106915__106917$fn__106918.invoke(setup.clj:150)""
    ""query_processor.setup$fn__106896$do_with_resolved_database106895__106897$_AMPERSAND_f__106898.invoke(setup.clj:128)""
    ""query_processor.setup$fn__106896$do_with_resolved_database106895__106897$fn__106901.invoke(setup.clj:122)""
    ""query_processor.setup$fn__106960$do_with_qp_setup106959__106961.invoke(setup.clj:232)""
    ""query_processor.setup$fn__106960$fn__106965.invoke(setup.clj:216)""
    ""query_processor.pivot$fn__127669$run_pivot_query127668__127670.invoke(pivot.clj:595)""
    ""query_processor.pivot$fn__127669$fn__127681.invoke(pivot.clj:585)""
    ""api.dataset$fn__140350$run_streaming_query140349__140353$fn__140357.invoke(dataset.clj:80)""
    ""query_processor.streaming$_streaming_response$fn__116940$fn__116941$fn__116942.invoke(streaming.clj:175)""
    ""query_processor.streaming$_streaming_response$fn__116940$fn__116941.invoke(streaming.clj:173)""
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:164)""
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:151)""
    ""query_processor.streaming$_streaming_response$fn__116940.invoke(streaming.clj:170)""
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)""
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)""
    ""async.streaming_response$do_f_async$task__65629.invoke(streaming_response.clj:97)""],
   :error_type :qp,
   :ex-data {:type :qp}}],
 :action_id nil,
 :error_type :qp,
 :json_query
 {:constraints {:max-results 10000, :max-results-bare-rows 2000},
  :lib/type :mbql/query,
  :pivot-rows [1 0],
  :pivot-cols [2],
  :qp.pivot/breakout-combination [0 1 2],
  :lib/metadata
  (metabase.lib.metadata.invocation-tracker/invocation-tracker-provider (metabase.lib.metadata.cached-provider/cached-metadata-provider (metabase.lib.metadata.jvm/->UncachedApplicationDatabaseMetadataProvider 1))),
  :stages
  [{:lib/type :mbql.stage/mbql,
    :source-table 5,
    :aggregation [[:count {:lib/uuid ""d75c65f9-d612-43cd-923f-edc9619e38a3""}]],
    :breakout
    [[:field
      {:base-type :type/DateTime,
       :temporal-unit :month,
       :lib/uuid ""da680aa3-02da-48f1-bad7-4c4a8a9878fc"",
       :effective-type :type/DateTime}
      41]
     [:field
      {:base-type :type/Integer, :lib/uuid ""af6c16b8-68e4-409e-a75a-6a26d7a8ee80"", :effective-type :type/Integer}
      43]
     [:field
      {:base-type :type/Integer, :lib/uuid ""1604be71-4a08-455d-9e3b-400fd740eefc"", :effective-type :type/Integer}
      40]
     [:expression
      {:lib/uuid ""50413d48-7a05-4c5d-a03c-a38477c2c2d1"", :base-type :type/Integer, :effective-type :type/Integer}
      ""pivot-grouping""]],
    :expressions [[:abs {:lib/uuid ""d102dd10-f795-440e-81ce-1fc285502d1a"", :lib/expression-name ""pivot-grouping""} 0]]}],
  :middleware
  {:pivot-options {:pivot-rows [1 0], :pivot-cols [2], :pivot-measures [3], :column-sort-order {3 nil}},
   :format-rows? true,
   :pivot? true,
   :process-viz-settings? true,
   :skip-results-metadata? true,
   :userland-query? true,
   :add-default-userland-constraints? true},
  :viz-settings
  {:column_settings {""[\""name\"",\""count\""]"" {:scale 2}},
   :pivot_table.column_split {:rows [""USER_ID"" ""CREATED_AT""], :columns [""PRODUCT_ID""], :values [""count""]},
   :pivot_table.collapsed_rows {:value [], :rows [""USER_ID"" ""CREATED_AT""]},
   :pivot.show_row_totals true,
   :pivot.show_column_totals true,
   :pivot_table.column_widths {:leftHeaderWidths [81 141], :totalLeftHeaderWidths 222, :valueHeaderWidths {}},
   :table.column_formatting [],
   :table.columns nil},
  :database 1},
 :status :failed,
 :class java.lang.ClassCastException,
 :stacktrace
 [""clojure.lang.Numbers.multiply(Numbers.java:175)""
  ""--> query_processor.streaming.xlsx$eval116719$fn__116720.invoke(xlsx.clj:503)""
  ""query_processor.streaming.xlsx$eval116719$fn__116720.invoke(xlsx.clj:487)""
  ""query_processor.streaming.xlsx$init_native_pivot.invokeStatic(xlsx.clj:603)""
  ""query_processor.streaming.xlsx$init_native_pivot.invoke(xlsx.clj:580)""
  ""query_processor.streaming.xlsx$eval116799$fn$reify__116805.begin_BANG_(xlsx.clj:680)""
  ""query_processor.streaming$fn__116895$streaming_rff116894__116896$fn__116898$fn__116903.invoke(streaming.clj:122)""
  ""query_processor.middleware.process_userland_query$add_and_save_execution_metadata_xform_BANG_$execution_info_rf_STAR___108123.invoke(process_userland_query.clj:128)""
  ""query_processor.middleware.format_rows$format_rows_xform$fn__108267.invoke(format_rows.clj:68)""
  ""query_processor.middleware.add_rows_truncated$add_rows_truncated_xform$fn__108174.invoke(add_rows_truncated.clj:24)""
  ""query_processor.pivot$fn__127523$append_queries_reduce_fn127522__127524$multiple_reducing__127526$respond__127528.invoke(pivot.clj:311)""
  ""driver.sql_jdbc.execute$execute_reducible_query$fn__135096.invoke(execute.clj:725)""
  ""driver.h2$eval137252$fn__137254$fn__137256.invoke(h2.clj:543)""
  ""driver.sql_jdbc.execute$fn__134759$do_with_resolved_connection134758__134760.invoke(execute.clj:338)""
  ""driver.sql_jdbc.execute$fn__134759$fn__134763.invoke(execute.clj:321)""
  ""driver.h2$eval137252$fn__137254.invoke(h2.clj:534)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
  ""driver.sql_jdbc$eval136748$fn__136749.invoke(sql_jdbc.clj:79)""
  ""driver.h2$eval137008$fn__137009.invoke(h2.clj:271)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39)""
  ""query_processor.pivot$fn__127523$append_queries_reduce_fn127522__127524$multiple_reducing__127526$fn__127532.invoke(pivot.clj:324)""
  ""query_processor.pivot$fn__127523$append_queries_reduce_fn127522__127524$multiple_reducing__127526.invoke(pivot.clj:320)""
  ""query_processor.pipeline$_STAR_run_STAR_$respond__95999.invoke(pipeline.clj:100)""
  ""query_processor.pivot$fn__127514$append_queries_execute_fn127513__127515$multiple_execute__127516.invoke(pivot.clj:291)""
  ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102)""
  ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95)""
  ""query_processor.execute$run.invokeStatic(execute.clj:62)""
  ""query_processor.execute$run.invoke(execute.clj:56)""
  ""query_processor.middleware.update_used_cards$fn__107638$update_used_cards_BANG_107637__107639$_AMPERSAND_f__107640.invoke(update_used_cards.clj:60)""
  ""query_processor.middleware.update_used_cards$fn__107638$update_used_cards_BANG_107637__107639$fn__107650.invoke(update_used_cards.clj:52)""
  ""query_processor.execute$add_native_form_to_result_metadata$fn__107662.invoke(execute.clj:25)""
  ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__107668.invoke(execute.clj:36)""
  ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___107488.invoke(cache.clj:241)""
  ""query_processor.middleware.permissions$check_query_permissions$fn__106333.invoke(permissions.clj:148)""
  ""metabase_enterprise.advanced_permissions.query_processor.middleware.permissions$eval187179$check_download_permissions__187180$fn__187181.invoke(permissions.clj:99)""
  ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__102401.invoke(enterprise.clj:51)""
  ""metabase_enterprise.sandbox.query_processor.middleware.column_level_perms_check$eval187379$maybe_apply_column_level_perms_check__187380$fn__187381.invoke(column_level_perms_check.clj:38)""
  ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__102411.invoke(enterprise.clj:64)""
  ""query_processor.execute$fn__107702$execute107701__107703$fn__107704.invoke(execute.clj:94)""
  ""query_processor.setup$fn__106960$do_with_qp_setup106959__106961.invoke(setup.clj:225)""
  ""query_processor.setup$fn__106960$fn__106965.invoke(setup.clj:216)""
  ""query_processor.execute$fn__107702$execute107701__107703.invoke(execute.clj:93)""
  ""query_processor.execute$fn__107702$fn__107707.invoke(execute.clj:89)""
  ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)""
  ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)""
  ""metabase_enterprise.audit_app.query_processor.middleware.handle_audit_queries$eval187338$handle_audit_app_internal_queries__187339$fn__187340.invoke(handle_audit_queries.clj:145)""
  ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__102439.invoke(enterprise.clj:103)""
  ""query_processor.middleware.process_userland_query$fn__108132$process_userland_query_middleware108131__108133$_AMPERSAND_f__108134.invoke(process_userland_query.clj:204)""
  ""query_processor.middleware.process_userland_query$fn__108132$process_userland_query_middleware108131__108133$fn__108140.invoke(process_userland_query.clj:188)""
  ""query_processor.middleware.catch_exceptions$fn__107801$catch_exceptions107800__107802$_AMPERSAND_f__107803.invoke(catch_exceptions.clj:132)""
  ""query_processor.middleware.catch_exceptions$fn__107801$catch_exceptions107800__107802$fn__107818.invoke(catch_exceptions.clj:122)""
  ""query_processor$fn__108476$process_query108475__108477$fn__108478.invoke(query_processor.clj:80)""
  ""query_processor.setup$fn__106960$do_with_qp_setup106959__106961.invoke(setup.clj:225)""
  ""query_processor.setup$fn__106960$fn__106965.invoke(setup.clj:216)""
  ""query_processor$fn__108476$process_query108475__108477.invoke(query_processor.clj:78)""
  ""query_processor$fn__108476$fn__108482.invoke(query_processor.clj:71)""
  ""query_processor.pivot$fn__127547$process_multiple_queries127546__127549.invoke(pivot.clj:350)""
  ""query_processor.pivot$fn__127547$fn__127559.invoke(pivot.clj:340)""
  ""query_processor.pivot$fn__127669$run_pivot_query127668__127670$fn__127671.invoke(pivot.clj:605)""
  ""query_processor.setup$fn__106951$do_with_canceled_chan106950__106952$fn__106953.invoke(setup.clj:187)""
  ""query_processor.setup$fn__106940$do_with_database_local_settings106939__106941$fn__106942.invoke(setup.clj:181)""
  ""query_processor.setup$fn__106929$do_with_driver106928__106930$fn__106931$fn__106932.invoke(setup.clj:166)""
  ""driver$do_with_driver.invokeStatic(driver.clj:106)""
  ""driver$do_with_driver.invoke(driver.clj:101)""
  ""query_processor.setup$fn__106929$do_with_driver106928__106930$fn__106931.invoke(setup.clj:165)""
  ""query_processor.setup$fn__106916$do_with_metadata_provider106915__106917$fn__106918$fn__106921.invoke(setup.clj:151)""
  ""query_processor.store$fn__88334$do_with_metadata_provider88333__88335.invoke(store.clj:170)""
  ""query_processor.store$fn__88334$fn__88338.invoke(store.clj:150)""
  ""query_processor.store$fn__88334$do_with_metadata_provider88333__88335.invoke(store.clj:159)""
  ""query_processor.store$fn__88334$fn__88338.invoke(store.clj:150)""
  ""query_processor.setup$fn__106916$do_with_metadata_provider106915__106917$fn__106918.invoke(setup.clj:150)""
  ""query_processor.setup$fn__106896$do_with_resolved_database106895__106897$_AMPERSAND_f__106898.invoke(setup.clj:128)""
  ""query_processor.setup$fn__106896$do_with_resolved_database106895__106897$fn__106901.invoke(setup.clj:122)""
  ""query_processor.setup$fn__106960$do_with_qp_setup106959__106961.invoke(setup.clj:232)""
  ""query_processor.setup$fn__106960$fn__106965.invoke(setup.clj:216)""
  ""query_processor.pivot$fn__127669$run_pivot_query127668__127670.invoke(pivot.clj:595)""
  ""query_processor.pivot$fn__127669$fn__127681.invoke(pivot.clj:585)""
  ""api.dataset$fn__140350$run_streaming_query140349__140353$fn__140357.invoke(dataset.clj:80)""
  ""query_processor.streaming$_streaming_response$fn__116940$fn__116941$fn__116942.invoke(streaming.clj:175)""
  ""query_processor.streaming$_streaming_response$fn__116940$fn__116941.invoke(streaming.clj:173)""
  ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:164)""
  ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:151)""
  ""query_processor.streaming$_streaming_response$fn__116940.invoke(streaming.clj:170)""
  ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)""
  ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)""
  ""async.streaming_response$do_f_async$task__65629.invoke(streaming_response.clj:97)""],
 :card_id nil,
 :context :xlsx-download,
 :error
 ""class java.lang.String cannot be cast to class java.lang.Number (java.lang.String and java.lang.Number are in module java.base of loader 'bootstrap')"",
 :row_count 0,
 :running_time 0,
 :data {:rows [], :cols []}}
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""dev"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""date"": ""2024-11-20"",
      ""tag"": ""v1.52.2-SNAPSHOT"",
      ""hash"": ""5bec697""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.4 (Homebrew)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21+35-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21+35-LTS"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""15.0.1"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```

### Severity

P1

### Additional context

_No response_",escherize,2024-11-25 17:22:26+00:00,['escherize'],2024-12-02 18:20:29+00:00,2024-12-02 18:20:28+00:00,https://github.com/metabase/metabase/issues/50462,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Bug:v51', 'bugs or regressions introduced in v51'), ('Reporting/Export/Pivot', 'Exporting data as pivoted tables')]","[{'comment_id': 2498980561, 'issue_id': 2691542436, 'author': 'escherize', 'body': 'While looking into this, @adam-james-v and I noticed that this problem occurs whether the data is a pivot column or not .', 'created_at': datetime.datetime(2024, 11, 25, 20, 35, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2512343840, 'issue_id': 2691542436, 'author': 'escherize', 'body': 'Closed by https://github.com/metabase/metabase/pull/50476', 'created_at': datetime.datetime(2024, 12, 2, 18, 20, 28, tzinfo=datetime.timezone.utc)}]","escherize (Issue Creator) on (2024-11-25 20:35:25 UTC): While looking into this, @adam-james-v and I noticed that this problem occurs whether the data is a pivot column or not .

escherize (Issue Creator) on (2024-12-02 18:20:28 UTC): Closed by https://github.com/metabase/metabase/pull/50476

"
2691151853,issue,closed,not_planned,"Update ""Payment Banner"" link","The Payment Banner link currently leads to the _store_ home page. As soon as the new page for managing plans is available, we should update this link to `{{storeUrl}}/manage/plans`",nemanjaglumac,2024-11-25 15:29:49+00:00,['nemanjaglumac'],2025-01-31 19:51:52+00:00,2025-01-31 19:51:51+00:00,https://github.com/metabase/metabase/issues/50459,"[('Administration/', ''), ('.Task', 'Not a part of any Epic, used by the Task Issue Template')]","[{'comment_id': 2628258733, 'issue_id': 2691151853, 'author': 'nemanjaglumac', 'body': 'See: https://github.com/metabase/metabase/pull/53064#issuecomment-2628256411', 'created_at': datetime.datetime(2025, 1, 31, 19, 51, 51, tzinfo=datetime.timezone.utc)}]","nemanjaglumac (Issue Creator) on (2025-01-31 19:51:51 UTC): See: https://github.com/metabase/metabase/pull/53064#issuecomment-2628256411

"
2690923230,issue,closed,completed,"Show ""question not found"" errors on custom layouts by lifting SdkError to InteractiveQuestion's context provider","We should show the ""Question not found"" errors on custom layouts in the InteractiveQuestion component by lifting the `SdkError` to the `InteractiveQuestionProvider`. This has the added benefit of making the `question` types non-nullable, so it is easier to work with.",heypoom,2024-11-25 14:26:08+00:00,[],2025-01-13 17:12:10+00:00,2025-01-13 17:08:03+00:00,https://github.com/metabase/metabase/issues/50456,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2587694880, 'issue_id': 2690923230, 'author': 'heypoom', 'body': 'We are already showing ""Question not found"" on the `<InteractiveQuestion.Visualization />` component, so this is more of a nice-to-have. For reference, `InteractiveQuestionResult` shows `<SdkError message={t`Question not found`} />` that replaces the entire layout with ""Question not found"".\n\nI think we can safely close this, considering that it might not always be desirable to replace the entire layout with the error.', 'created_at': datetime.datetime(2025, 1, 13, 17, 8, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2587695370, 'issue_id': 2690923230, 'author': 'heypoom', 'body': 'cc @oisincoveney @albertoperdomo', 'created_at': datetime.datetime(2025, 1, 13, 17, 8, 16, tzinfo=datetime.timezone.utc)}]","heypoom (Issue Creator) on (2025-01-13 17:08:03 UTC): We are already showing ""Question not found"" on the `<InteractiveQuestion.Visualization />` component, so this is more of a nice-to-have. For reference, `InteractiveQuestionResult` shows `<SdkError message={t`Question not found`} />` that replaces the entire layout with ""Question not found"".

I think we can safely close this, considering that it might not always be desirable to replace the entire layout with the error.

heypoom (Issue Creator) on (2025-01-13 17:08:16 UTC): cc @oisincoveney @albertoperdomo

"
2690812034,issue,open,,Pie chart values rounding is not correct,"### Describe the bug

**STATUS QUO:**

Bug 1 (browser in 100% view)
![Image](https://github.com/user-attachments/assets/47dea032-cc09-43b0-8d7e-ecd5769fa0b9)

Bug 2 (Tooltip showing correct decimal, however the value shown in Piechart has wrong decimals)
![Image](https://github.com/user-attachments/assets/84e8d1f3-80cb-47c9-a253-50c38d5e6488)


**TO DO**

1. In Bug 1, at-least in 100% browser view, the decimals should show up. 
2. Tool Tip and Value shown in Piechart, both should reflect the same decimal, otherwise creates confusion for user




### To Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
- Browser - Version 130.0.6723.117 (Official Build) (arm64)
- OS - macOS Sonoma 14.6.1
- Databases - Postgres
- Metabase Version 0.51.4
```

### Severity

Bug 1 not so severe, Bug 2 could be confusion however not so severe

### Additional context

_No response_",Sidhantp12,2024-11-25 13:45:53+00:00,[],2025-02-04 20:31:46+00:00,,https://github.com/metabase/metabase/issues/50455,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('Visualization/Charts/Pie', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Bug:v51', 'bugs or regressions introduced in v51'), ('Visualization/Tooltips', '')]",[],
2690635610,issue,closed,not_planned,Metabot's SQL query fails during execution,"### Describe the bug

When asking Metabot a question, the SQL query fails during execution with an error
```
Unexpected character ('`' (code 96)): expected a valid value (JSON String, Number, Array, Object or token 'null', 'true' or 'false') at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 1]
```

Whilst the query itself is generated correctly and can be executed manually, the Metabot answer fails when trying to display the result.

### To Reproduce

The issue can be reproduced using the Sample Database.

1. Save the 'Orders' table as a Question and convert it into a model named 'SampleOrders';
2. Select 'Ask Metabot' from the Model's menu;
3. Asked a question 'How many SampleOrders have we had over time?' (the suggested question);
4. Got an error described above, instead of seeing the result.

### Expected behavior

SQL query should execute without failure

### Logs

```
[38639ce8-253b-49ab-8a79-e1f2c1162b4c] 2024-11-25T14:05:47+02:00 INFO metabase.metabot Inferred sql for model '30' with prompt 'How many Orders have we had over time?':
WITH ORDERS AS (SELECT
  ""ID"" AS ID,
  ""USER_ID"" AS USER_ID,
  ""PRODUCT_ID"" AS PRODUCT_ID,
  ""SUBTOTAL"" AS SUBTOTAL,
  ""TAX"" AS TAX,
  ""TOTAL"" AS TOTAL,
  ""DISCOUNT"" AS DISCOUNT,
  ""CREATED_AT"" AS CREATED_AT,
  ""QUANTITY"" AS QUANTITY
FROM
  {{#30}} AS INNER_QUERY) SELECT
  COUNT(ID) AS TOTAL_ORDERS
FROM
  ORDERS;
[38639ce8-253b-49ab-8a79-e1f2c1162b4c] 2024-11-25T14:05:47+02:00 INFO metabase.metabot Metabot is inferring visualization for sql 'SELECT
  COUNT(ID) AS TOTAL_ORDERS
FROM
  ORDERS;'.
[38639ce8-253b-49ab-8a79-e1f2c1162b4c] 2024-11-25T14:05:47+02:00 DEBUG metabase.metabot.util Prompt running with 2066 chars (~516 tokens).
[38639ce8-253b-49ab-8a79-e1f2c1162b4c] 2024-11-25T14:05:50+02:00 ERROR metabase.server.middleware.log POST /api/metabot/model/30 500 22.5 s (6 DB calls) {:metabase-user-id 1} 
{:via
 [{:type com.fasterxml.jackson.core.JsonParseException,
   :message
   ""Unexpected character ('`' (code 96)): expected a valid value (JSON String, Number, Array, Object or token 'null', 'true' or 'false')\n at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 1]"",
   :at [com.fasterxml.jackson.core.JsonParser _constructReadException ""JsonParser.java"" 2643]}],
 :trace
 [[com.fasterxml.jackson.core.JsonParser _constructReadException ""JsonParser.java"" 2643]
  [com.fasterxml.jackson.core.base.ParserMinimalBase _reportUnexpectedChar ""ParserMinimalBase.java"" 685]
  [com.fasterxml.jackson.core.json.ReaderBasedJsonParser _handleOddValue ""ReaderBasedJsonParser.java"" 2055]
  [com.fasterxml.jackson.core.json.ReaderBasedJsonParser nextToken ""ReaderBasedJsonParser.java"" 780]
  [cheshire.parse$parse invokeStatic ""parse.clj"" 90]
  [cheshire.parse$parse invoke ""parse.clj"" 88]
  [cheshire.core$parse_string invokeStatic ""core.clj"" 208]
  [cheshire.core$parse_string invoke ""core.clj"" 194]
  [cheshire.core$parse_string invokeStatic ""core.clj"" 205]
  [cheshire.core$parse_string invoke ""core.clj"" 194]
  [metabase.metabot$infer_viz$fn__102286 invoke ""metabot.clj"" 42]
  [metabase.metabot.util$find_result$fn__98991 invoke ""util.clj"" 467]
  [clojure.core$some invokeStatic ""core.clj"" 2718]
  [clojure.core$some invoke ""core.clj"" 2709]
  [metabase.metabot.util$find_result invokeStatic ""util.clj"" 465]
  [metabase.metabot.util$find_result invoke ""util.clj"" 460]
  [metabase.metabot$infer_viz invokeStatic ""metabot.clj"" 39]
  [metabase.metabot$infer_viz invoke ""metabot.clj"" 28]
  [metabase.api.metabot$add_viz_to_dataset invokeStatic ""metabot.clj"" 44]
  [metabase.api.metabot$add_viz_to_dataset invoke ""metabot.clj"" 40]
  [metabase.api.metabot$fn__102367 invokeStatic ""metabot.clj"" 64]
  [metabase.api.metabot$fn__102367 invoke ""metabot.clj"" 49]
  [compojure.core$wrap_response$fn__53924 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__53908 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__53913 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__53917 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53917 invoke ""core.clj"" 152]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [metabase.server.middleware.auth$enforce_authentication$fn__102397 invoke ""auth.clj"" 18]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53964 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 300]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53917 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [metabase.api.routes$fn__107810$fn__107813 invoke ""routes.clj"" 73]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__108090$fn__108091 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53964 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53968 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53917 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53917 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53917 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53917 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936$f__53937$respond_SINGLEQUOTE___53938 invoke ""core.clj"" 197]
  [metabase.server.routes$fn__108073$fn__108075 invoke ""routes.clj"" 47]
  [compojure.core$routes$fn__53936$f__53937 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53936 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__104522 invoke ""exceptions.clj"" 111]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__104519 invoke ""exceptions.clj"" 100]
  [metabase.server.middleware.log$log_api_call$fn__108423$fn__108424$fn__108425 invoke ""log.clj"" 233]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 17]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__108423$fn__108424 invoke ""log.clj"" 224]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__108423 invoke ""log.clj"" 223]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__111958 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__104478 invoke ""security.clj"" 273]
  [ring.middleware.json$wrap_json_body$fn__112217 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__93553 invoke ""offset_paging.clj"" 49]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__55597 invoke ""json.clj"" 88]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__112306 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__112325 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__71714 invoke ""misc.clj"" 59]
  [metabase.server.middleware.session$reset_session_timeout$fn__73519 invoke ""session.clj"" 565]
  [metabase.server.middleware.session$bind_current_user$fn__73485$fn__73486 invoke ""session.clj"" 459]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 438]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 421]
  [metabase.server.middleware.session$bind_current_user$fn__73485 invoke ""session.clj"" 458]
  [metabase.server.middleware.session$wrap_current_user_info$fn__73462 invoke ""session.clj"" 383]
  [metabase.analytics.sdk$embedding_mw$embedding_mw_fn__77701 invoke ""sdk.clj"" 51]
  [metabase.server.middleware.session$wrap_session_id$fn__73434 invoke ""session.clj"" 261]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__102405 invoke ""auth.clj"" 32]
  [ring.middleware.cookies$wrap_cookies$fn__112145 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__71696 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__71722 invoke ""misc.clj"" 75]
  [ring.middleware.gzip$wrap_gzip$fn__112187 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.request_id$wrap_request_id$fn__108152 invoke ""request_id.clj"" 9]
  [metabase.server.middleware.misc$bind_request$fn__71725 invoke ""misc.clj"" 91]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__111974 invoke ""ssl.clj"" 41]
  [metabase.server$async_proxy_handler$fn__61893 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run nil -1]],
 :cause
 ""Unexpected character ('`' (code 96)): expected a valid value (JSON String, Number, Array, Object or token 'null', 'true' or 'false')\n at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 1]"",
 :message
 ""Unexpected character ('`' (code 96)): expected a valid value (JSON String, Number, Array, Object or token 'null', 'true' or 'false')\n at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 1]""}
```

### Information about your Metabase installation

```JSON
Metabase version: v0.51.4.4 (self-hosted instance on local machine using the Docker image)
Database: PostgreSQL, version 15.1
ChatGTP model: gpt-4-turbo-preview
```

### Severity

Blocking some users

### Additional context

I have also tried using the `gpt-4` model but got a different error saying that the context token limit is exceeded when using my dataset (probably related to issue #29932 which does not seem to be fixed, even though it is closed). So switching to a different model does not resolve the issue.",MartynasKasp,2024-11-25 12:54:56+00:00,[],2024-11-25 13:32:45+00:00,2024-11-25 13:32:43+00:00,https://github.com/metabase/metabase/issues/50454,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2498035295, 'issue_id': 2690635610, 'author': 'ranquild', 'body': 'This was an experimental feature that was never meant to be production ready; thats why it required a flag and was never mentioned in the release notes.', 'created_at': datetime.datetime(2024, 11, 25, 13, 32, 43, tzinfo=datetime.timezone.utc)}]","ranquild on (2024-11-25 13:32:43 UTC): This was an experimental feature that was never meant to be production ready; thats why it required a flag and was never mentioned in the release notes.

"
2690445736,issue,closed,completed,add morph animation for visualize button,,uladzimirdev,2024-11-25 11:38:55+00:00,[],2024-12-30 09:19:39+00:00,2024-12-30 09:19:39+00:00,https://github.com/metabase/metabase/issues/50452,[],[],
2690445552,issue,closed,completed,show a loader after query modification,[context](https://metaboat.slack.com/archives/C0645JP1W81/p1732299237755779?thread_ts=1732285511.302689&cid=C0645JP1W81),uladzimirdev,2024-11-25 11:38:51+00:00,['uladzimirdev'],2024-11-25 20:30:52+00:00,2024-11-25 20:30:51+00:00,https://github.com/metabase/metabase/issues/50451,[],[],
2689913769,issue,open,,An error occurs when using a date-type variable in BigQuery,"**Describe the bug**
Using a date-type variable should have converted it to a timestamp originally, but from version 50 it has been converted to a date. The following query will result in an error.
`select DATE({{date}}, ""Asia/Tokyo"")`
error:
```
{ ""code"": 400, ""errors"": [ { ""domain"": ""global"", ""location"": ""q"", ""locationType"": ""parameter"", ""message"": ""No matching signature for function DATE for argument types: DATE, STRING. Supported signatures: DATE(TIMESTAMP, [STRING]); DATE(DATETIME); DATE(INT64, INT64, INT64); DATE(DATE); DATE(STRING) at [2:8]"", ""reason"": ""invalidQuery"" } ], ""message"": ""No matching signature for function DATE for argument types: DATE, STRING. Supported signatures: DATE(TIMESTAMP, [STRING]); DATE(DATETIME); DATE(INT64, INT64, INT64); DATE(DATE); DATE(STRING) at [2:8]"", ""status"": ""INVALID_ARGUMENT"" }
```
The error is occurring because the date function in bigquery cannot accept a date and time zone.

**Logs**
Please include javascript console and server logs around the time this bug occurred. For information about how to get these, consult our [bug troubleshooting guide](https://metabase.com/docs/latest/troubleshooting-guide/bugs.html)

**To Reproduce**
Create SQL Query with BigQuery connection. And use date type variable with date function. 

**Expected behavior**
A clear and concise description of what you expected to happen.

**Screenshots**
If applicable, add screenshots to help explain your problem.

**Severity**
How severe an issue is this bug to you? Is this annoying, blocking some users, blocking an upgrade or blocking your usage of Metabase entirely?
Note: the more honest and specific you are here the more we will take you seriously.

**Additional context**
Add any other context about the problem here.

**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""ja"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""bigquery-cloud-sdk""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-19"",
      ""tag"": ""v0.51.4"",
      ""hash"": ""47f05f3""
    },
    ""settings"": {
      ""report-timezone"": ""Asia/Tokyo""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""mysql"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""MySQL"",
        ""version"": ""8.0.31-google""
      },
      ""jdbc-driver"": {
        ""name"": ""MariaDB Connector/J"",
        ""version"": ""2.7.10""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.85+"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```",k-saka,2024-11-25 09:17:09+00:00,[],2024-11-25 09:17:09+00:00,,https://github.com/metabase/metabase/issues/50443,[],[],
2689772849,issue,open,,[SDK] ensure the nextjs compatibility layer doesn't break,One possible idea is to run some very basic tests on the sample apps,npretto,2024-11-25 08:41:21+00:00,['sanex3339'],2025-02-04 20:23:54+00:00,,https://github.com/metabase/metabase/issues/50442,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template'), ('.Team/Embedding', '')]",[],
2689771543,issue,closed,completed,[SDK] make the sample apps for nextjs that are using the compatibility layer,,npretto,2024-11-25 08:40:49+00:00,['npretto'],2024-12-11 12:50:09+00:00,2024-12-11 12:50:09+00:00,https://github.com/metabase/metabase/issues/50441,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2689770261,issue,closed,completed,[SDK] nextjs: document the compatibility layer,,npretto,2024-11-25 08:40:16+00:00,['npretto'],2024-12-17 16:12:09+00:00,2024-12-16 14:06:06+00:00,https://github.com/metabase/metabase/issues/50440,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]","[{'comment_id': 2548907423, 'issue_id': 2689770261, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)', 'created_at': datetime.datetime(2024, 12, 17, 16, 12, 8, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-17 16:12:08 UTC):  This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)

"
2689767417,issue,closed,completed,"[SDK] create a ""compatibility layer"" for nextjs","This should allow nextjs user to import the components from a specific subath, without the need of making their own wrapper with dynamic imports `and ssr:false` or 'use client'",npretto,2024-11-25 08:38:57+00:00,['npretto'],2024-12-10 10:54:52+00:00,2024-12-09 16:12:28+00:00,https://github.com/metabase/metabase/issues/50439,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2689761944,issue,closed,completed,[Epic] Make using the sdk easier on nextjs apps,"https://metaboat.slack.com/archives/C063Q3F1HPF/p1732288303213889?thread_ts=1732124302.665899&cid=C063Q3F1HPF

We want to make using the sdk from a nextjs project easier and less error prone, this includes some bug fixes.

",npretto,2024-11-25 08:36:59+00:00,['npretto'],2024-12-17 10:35:14+00:00,2024-12-17 10:35:13+00:00,https://github.com/metabase/metabase/issues/50438,"[('Embedding/', 'Use this label when unsure which flavor of embedding is impacted'), ('.Epic', 'Feature Implementation or Project'), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2548097866, 'issue_id': 2689761944, 'author': 'npretto', 'body': 'Closing this as we extracted https://github.com/metabase/metabase/issues/50442', 'created_at': datetime.datetime(2024, 12, 17, 10, 35, 13, tzinfo=datetime.timezone.utc)}]","npretto (Issue Creator) on (2024-12-17 10:35:13 UTC): Closing this as we extracted https://github.com/metabase/metabase/issues/50442

"
2687972163,issue,closed,not_planned,Metabase Incorrectly Identifies Schema for Database Initialization (Postgres 16),"### Describe the bug

When starting Metabase, there is an issue with the identification of the schema where the database should be initialized. It was expected that all tables would be created in the `metabase` schema, but some of them end up in the `public` schema.


### To Reproduce

Start Metabase using the following script

### First script:
```
docker run -d -p 3000:3000 \
   -e ""MB_DB_TYPE=postgres"" \
   -e ""MB_DB_CONNECTION_URI=jdbc:postgresql://pgb-instance-01t.localhost.ru:5432/metabase?user=metabase&password=metabasePassword&currentSchema=metabase"" \
   --name metabase metabase/metabase:v0.51.4.4
```

### Second script:
```
 docker run -d -p 3000:3000 \
   -e ""MB_DB_CONNECTION_URI=jdbc:postgresql://pgb-instance-01t.localhost.ru:5432/metabase?user=metabase&password=metabasePassword&currentSchema=metabase"" \
   -e ""MB_DB_TYPE=postgres"" \
   -e ""MB_DB_DBNAME=metabase"" \
   -e ""MB_DB_PORT=5432"" \
   -e ""MB_DB_USER=metabase"" \
   -e ""MB_DB_PASS=metabasePassword"" \
   -e ""MB_DB_HOST=pgb-instance-01t.localhost.ru"" \
   -e ""defaultSchemaName=metabase"" \
    --name metabase metabase/metabase:v0.51.4.4

### Expected behavior

### Expected Result:
The database should be initialized with all tables in the `metabase` schema

### Actual Result:
Some tables were created in the `metabase` schema, while others were created in the `public` schema.![Image](https://github.com/user-attachments/assets/dd3b02f5-d4f5-4f01-b6df-07a0400db9a0)


### Logs

### Execution Logs:
```
2024-11-24 19:12:36 Warning: environ value jdk-11.0.25+9 for key :java-version has been overwritten with 11.0.25
2024-11-24 19:12:42 2024-11-24 16:12:42,074 INFO metabase.util :: Maximum memory available to JVM: 1.9 GB
2024-11-24 19:12:45 2024-11-24 16:12:45,246 INFO util.encryption :: Saved credentials encryption is DISABLED for this Metabase instance.  
2024-11-24 19:12:45  For more information, see https://metabase.com/docs/latest/operations-guide/encrypting-database-details-at-rest.html
2024-11-24 19:12:49 WARNING: infinite? already refers to: #'kixi.stats.math/infinite? in namespace: kixi.stats.core, being replaced by: #'clojure.core/infinite?
2024-11-24 19:12:52 2024-11-24 16:12:52,270 INFO driver.impl :: Registered abstract driver :sql  
2024-11-24 19:12:52 2024-11-24 16:12:52,324 INFO driver.impl :: Registered abstract driver :sql-jdbc (parents: [:sql]) 
2024-11-24 19:12:52 2024-11-24 16:12:52,335 INFO metabase.util :: Load driver :sql-jdbc took 26.7 ms
2024-11-24 19:12:52 2024-11-24 16:12:52,336 INFO driver.impl :: Registered driver :h2 (parents: [:sql-jdbc]) 
2024-11-24 19:12:52 2024-11-24 16:12:52,782 INFO driver.impl :: Registered driver :mysql (parents: [:sql-jdbc]) 
2024-11-24 19:12:52 2024-11-24 16:12:52,826 INFO driver.impl :: Registered driver :postgres (parents: [:sql-jdbc]) 
2024-11-24 19:12:55 2024-11-24 16:12:55,132 INFO metabase.core :: 
2024-11-24 19:12:55 Metabase v0.51.4.4 (93a2cdd) 
2024-11-24 19:12:55 
2024-11-24 19:12:55 Copyright  2024 Metabase, Inc. 
2024-11-24 19:12:55 
2024-11-24 19:12:55 Metabase Enterprise Edition extensions are NOT PRESENT.
2024-11-24 19:12:55 2024-11-24 16:12:55,138 INFO metabase.core :: Starting Metabase in STANDALONE mode
2024-11-24 19:12:55 2024-11-24 16:12:55,228 INFO metabase.server :: Launching Embedded Jetty Webserver with config:
2024-11-24 19:12:55  {:port 3000, :host ""0.0.0.0""}
2024-11-24 19:12:55 
2024-11-24 19:12:55 2024-11-24 16:12:55,371 INFO metabase.core :: Starting Metabase version v0.51.4.4 (93a2cdd) ...
2024-11-24 19:12:55 2024-11-24 16:12:55,407 INFO metabase.core :: System info:
2024-11-24 19:12:55  {""file.encoding"" ""UTF-8"",
2024-11-24 19:12:55  ""java.runtime.name"" ""OpenJDK Runtime Environment"",
2024-11-24 19:12:55  ""java.runtime.version"" ""11.0.25+9"",
2024-11-24 19:12:55  ""java.vendor"" ""Eclipse Adoptium"",
2024-11-24 19:12:55  ""java.vendor.url"" ""https://adoptium.net/"",
2024-11-24 19:12:55  ""java.version"" ""11.0.25"",
2024-11-24 19:12:55  ""java.vm.name"" ""OpenJDK 64-Bit Server VM"",
2024-11-24 19:12:55  ""java.vm.version"" ""11.0.25+9"",
2024-11-24 19:12:55  ""os.name"" ""Linux"",
2024-11-24 19:12:55  ""os.version"" ""6.10.4-linuxkit"",
2024-11-24 19:12:55  ""user.language"" ""en"",
2024-11-24 19:12:55  ""user.timezone"" ""GMT""}
2024-11-24 19:12:55 
2024-11-24 19:12:55 2024-11-24 16:12:55,415 INFO metabase.plugins :: Loading plugins in /plugins...
2024-11-24 19:12:55 2024-11-24 16:12:55,673 INFO util.files :: Extract file /modules/sqlserver.metabase-driver.jar -> /plugins/sqlserver.metabase-driver.jar
2024-11-24 19:12:55 2024-11-24 16:12:55,700 INFO util.files :: Extract file /modules/bigquery-cloud-sdk.metabase-driver.jar -> /plugins/bigquery-cloud-sdk.metabase-driver.jar
2024-11-24 19:12:55 2024-11-24 16:12:55,963 INFO util.files :: Extract file /modules/athena.metabase-driver.jar -> /plugins/athena.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,053 INFO util.files :: Extract file /modules/redshift.metabase-driver.jar -> /plugins/redshift.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,061 INFO util.files :: Extract file /modules/snowflake.metabase-driver.jar -> /plugins/snowflake.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,432 INFO util.files :: Extract file /modules/sparksql.metabase-driver.jar -> /plugins/sparksql.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,435 INFO util.files :: Extract file /modules/druid.metabase-driver.jar -> /plugins/druid.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,438 INFO util.files :: Extract file /modules/druid-jdbc.metabase-driver.jar -> /plugins/druid-jdbc.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,481 INFO util.files :: Extract file /modules/vertica.metabase-driver.jar -> /plugins/vertica.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,482 INFO util.files :: Extract file /modules/hive-like.metabase-driver.jar -> /plugins/hive-like.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,543 INFO util.files :: Extract file /modules/oracle.metabase-driver.jar -> /plugins/oracle.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,545 INFO util.files :: Extract file /modules/databricks.metabase-driver.jar -> /plugins/databricks.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,659 INFO util.files :: Extract file /modules/presto-jdbc.metabase-driver.jar -> /plugins/presto-jdbc.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,716 INFO util.files :: Extract file /modules/mongo.metabase-driver.jar -> /plugins/mongo.metabase-driver.jar
2024-11-24 19:12:56 2024-11-24 16:12:56,734 INFO util.files :: Extract file /modules/sqlite.metabase-driver.jar -> /plugins/sqlite.metabase-driver.jar
2024-11-24 19:12:57 2024-11-24 16:12:57,118 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Oracle Driver due to required dependencies. Metabase requires the Oracle JDBC driver in order to connect to Oracle databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/oracle.html for more details.
2024-11-24 19:12:57 
2024-11-24 19:12:57 2024-11-24 16:12:57,123 INFO plugins.dependencies :: Metabase Oracle Driver dependency {:class oracle.jdbc.OracleDriver} satisfied? false
2024-11-24 19:12:57 2024-11-24 16:12:57,143 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Oracle Driver""]
2024-11-24 19:12:57 2024-11-24 16:12:57,190 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :presto-jdbc...
2024-11-24 19:12:57 2024-11-24 16:12:57,195 INFO driver.impl :: Registered driver :presto-jdbc (parents: [:sql-jdbc]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,327 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :snowflake...
2024-11-24 19:12:57 2024-11-24 16:12:57,334 INFO driver.impl :: Registered driver :snowflake (parents: [:sql-jdbc]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,387 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :mongo...
2024-11-24 19:12:57 2024-11-24 16:12:57,388 INFO driver.impl :: Registered driver :mongo  
2024-11-24 19:12:57 2024-11-24 16:12:57,395 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlite...
2024-11-24 19:12:57 2024-11-24 16:12:57,395 INFO driver.impl :: Registered driver :sqlite (parents: [:sql-jdbc]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,399 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sqlserver...
2024-11-24 19:12:57 2024-11-24 16:12:57,400 INFO driver.impl :: Registered driver :sqlserver (parents: [:sql-jdbc]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,419 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :bigquery-cloud-sdk...
2024-11-24 19:12:57 2024-11-24 16:12:57,419 INFO driver.impl :: Registered driver :bigquery-cloud-sdk (parents: [:sql]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,433 INFO plugins.dependencies :: Plugin 'Metabase Databricks Driver' depends on plugin 'Metabase Hive Like Abstract Driver'
2024-11-24 19:12:57 2024-11-24 16:12:57,434 INFO plugins.dependencies :: Metabase Databricks Driver dependency {:plugin Metabase Hive Like Abstract Driver} satisfied? false
2024-11-24 19:12:57 2024-11-24 16:12:57,435 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Databricks Driver"" ""Metabase Oracle Driver""]
2024-11-24 19:12:57 2024-11-24 16:12:57,443 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :redshift...
2024-11-24 19:12:57 2024-11-24 16:12:57,443 INFO driver.impl :: Registered driver :redshift (parents: [:postgres]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,451 INFO plugins.dependencies :: Metabase cannot initialize plugin Metabase Vertica Driver due to required dependencies. Metabase requires the Vertica JDBC driver in order to connect to Vertica databases, but we can't ship it as part of Metabase due to licensing restrictions. See https://metabase.com/docs/latest/administration-guide/databases/vertica.html for more details.
2024-11-24 19:12:57 
2024-11-24 19:12:57 2024-11-24 16:12:57,452 INFO plugins.dependencies :: Metabase Vertica Driver dependency {:class com.vertica.jdbc.Driver} satisfied? false
2024-11-24 19:12:57 2024-11-24 16:12:57,452 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Databricks Driver"" ""Metabase Vertica Driver"" ""Metabase Oracle Driver""]
2024-11-24 19:12:57 2024-11-24 16:12:57,462 INFO plugins.dependencies :: Plugin 'Metabase Spark SQL Driver' depends on plugin 'Metabase Hive Like Abstract Driver'
2024-11-24 19:12:57 2024-11-24 16:12:57,462 INFO plugins.dependencies :: Metabase Spark SQL Driver dependency {:plugin Metabase Hive Like Abstract Driver} satisfied? false
2024-11-24 19:12:57 2024-11-24 16:12:57,463 INFO plugins.dependencies :: Plugins with unsatisfied deps: [""Metabase Spark SQL Driver"" ""Metabase Databricks Driver"" ""Metabase Vertica Driver"" ""Metabase Oracle Driver""]
2024-11-24 19:12:57 2024-11-24 16:12:57,475 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid...
2024-11-24 19:12:57 2024-11-24 16:12:57,477 INFO driver.impl :: Registered driver :druid  
2024-11-24 19:12:57 2024-11-24 16:12:57,485 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :druid-jdbc...
2024-11-24 19:12:57 2024-11-24 16:12:57,486 INFO driver.impl :: Registered driver :druid-jdbc (parents: [:sql-jdbc]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,499 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :athena...
2024-11-24 19:12:57 2024-11-24 16:12:57,500 INFO driver.impl :: Registered driver :athena (parents: [:sql-jdbc]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,511 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :hive-like...
2024-11-24 19:12:57 2024-11-24 16:12:57,512 INFO driver.impl :: Registered abstract driver :hive-like (parents: [:sql-jdbc]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,514 INFO plugins.dependencies :: Metabase Spark SQL Driver dependency {:plugin Metabase Hive Like Abstract Driver} satisfied? true
2024-11-24 19:12:57 2024-11-24 16:12:57,516 INFO plugins.dependencies :: Metabase Databricks Driver dependency {:plugin Metabase Hive Like Abstract Driver} satisfied? true
2024-11-24 19:12:57 2024-11-24 16:12:57,519 DEBUG plugins.initialize :: Dependencies satisfied; these plugins will now be loaded: [""Metabase Databricks Driver"" ""Metabase Spark SQL Driver""]
2024-11-24 19:12:57 2024-11-24 16:12:57,519 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :databricks...
2024-11-24 19:12:57 2024-11-24 16:12:57,519 INFO driver.impl :: Registered driver :databricks (parents: [:hive-like]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,520 DEBUG plugins.lazy-loaded-driver :: Registering lazy loading driver :sparksql...
2024-11-24 19:12:57 2024-11-24 16:12:57,520 INFO driver.impl :: Registered driver :sparksql (parents: [:hive-like]) 
2024-11-24 19:12:57 2024-11-24 16:12:57,541 INFO metabase.core :: Setting up and migrating Metabase DB. Please sit tight, this may take a minute...
2024-11-24 19:12:57 2024-11-24 16:12:57,544 INFO db.setup :: Verifying postgres Database Connection ...
2024-11-24 19:12:58 2024-11-24 16:12:58,717 INFO db.setup :: Successfully verified PostgreSQL 16.3 (Ubuntu 16.3-1.pgdg22.04+1) application database connection. 
2024-11-24 19:12:58 2024-11-24 16:12:58,720 INFO db.setup :: Checking if a database downgrade is required...
2024-11-24 19:12:59 2024-11-24 16:12:59,016 INFO liquibase.database :: Set default schema name to metabase
2024-11-24 19:13:00 2024-11-24 16:13:00,120 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-24 19:13:00 2024-11-24 16:13:00,263 INFO liquibase.changelog :: Creating database history table with name: metabase.databasechangelog
2024-11-24 19:13:00 2024-11-24 16:13:00,758 INFO db.setup :: Running Database Migrations...
2024-11-24 19:13:00 2024-11-24 16:13:00,759 INFO db.setup :: Setting up Liquibase...
2024-11-24 19:13:00 2024-11-24 16:13:00,866 INFO liquibase.database :: Set default schema name to metabase
2024-11-24 19:13:01 2024-11-24 16:13:01,244 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-24 19:13:01 2024-11-24 16:13:01,440 INFO db.liquibase :: Updating liquibase table to reflect consolidated changeset filenames
2024-11-24 19:13:01 2024-11-24 16:13:01,569 INFO liquibase.lockservice :: Successfully acquired change log lock
2024-11-24 19:13:01 2024-11-24 16:13:01,605 INFO db.liquibase :: No migration lock found.
2024-11-24 19:13:01 2024-11-24 16:13:01,605 INFO db.liquibase :: Migration lock acquired.
2024-11-24 19:13:01 2024-11-24 16:13:01,737 INFO liquibase.lockservice :: Successfully released change log lock
2024-11-24 19:13:01 2024-11-24 16:13:01,751 INFO db.setup :: Liquibase is ready.
2024-11-24 19:13:01 2024-11-24 16:13:01,752 INFO db.liquibase :: Checking if Database has unrun migrations...
2024-11-24 19:13:01 2024-11-24 16:13:01,894 INFO liquibase.database :: Set default schema name to metabase
2024-11-24 19:13:02 2024-11-24 16:13:02,130 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-24 19:13:02 2024-11-24 16:13:02,423 INFO liquibase.changelog :: Reading from metabase.databasechangelog
2024-11-24 19:13:03 2024-11-24 16:13:03,093 INFO db.liquibase :: Database has unrun migrations. Checking if migration lock is taken...
2024-11-24 19:13:03 2024-11-24 16:13:03,203 INFO liquibase.lockservice :: Successfully acquired change log lock
2024-11-24 19:13:03 2024-11-24 16:13:03,219 INFO db.liquibase :: No migration lock found.
2024-11-24 19:13:03 2024-11-24 16:13:03,219 INFO db.liquibase :: Migration lock acquired.
2024-11-24 19:13:03 2024-11-24 16:13:03,334 INFO liquibase.database :: Set default schema name to metabase
2024-11-24 19:13:03 2024-11-24 16:13:03,696 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-24 19:13:03 2024-11-24 16:13:03,878 INFO liquibase.changelog :: Reading from metabase.databasechangelog
2024-11-24 19:13:04 2024-11-24 16:13:04,085 INFO db.liquibase :: Running 420 migrations ...
2024-11-24 19:13:04 2024-11-24 16:13:04,368 INFO liquibase.changelog :: Reading from metabase.databasechangelog
2024-11-24 19:13:04 2024-11-24 16:13:04,832 INFO liquibase.command :: Using deploymentId: 2464784825
2024-11-24 19:13:04 2024-11-24 16:13:04,883 INFO liquibase.changelog :: Reading from metabase.databasechangelog
2024-11-24 19:13:05 2024-11-24 16:13:05,275 INFO liquibase.snapshot :: Creating snapshot
2024-11-24 19:13:05 2024-11-24 16:13:05,654 WARN liquibase.executor :: extension ""citext"" already exists, skipping
2024-11-24 19:13:14 2024-11-24 16:13:14,058 INFO liquibase.changelog :: SQL in file initialization/metabase_postgres.sql executed
2024-11-24 19:13:14 2024-11-24 16:13:14,084 INFO liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v00.00-000::qnkhuat ran successfully in 8834ms
2024-11-24 19:13:14 2024-11-24 16:13:14,306 INFO liquibase.changelog :: Table action created
2024-11-24 19:13:14 2024-11-24 16:13:14,317 INFO liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v45.00-001::snoe ran successfully in 154ms
2024-11-24 19:13:14 2024-11-24 16:13:14,419 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v45.00-002::snoe encountered an exception.
2024-11-24 19:13:14 liquibase.exception.DatabaseException: ERROR: relation ""metabase.report_card"" does not exist [Failed SQL: (0) CREATE TABLE ""metabase"".""query_action"" (""action_id"" INTEGER NOT NULL, ""card_id"" INTEGER NOT NULL, CONSTRAINT ""fk_query_action_ref_action_id"" FOREIGN KEY (""action_id"") REFERENCES ""metabase"".""action""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_query_action_ref_card_id"" FOREIGN KEY (""card_id"") REFERENCES ""metabase"".""report_card""(""id"") ON DELETE CASCADE)]
2024-11-24 19:13:14 at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
2024-11-24 19:13:14 at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
2024-11-24 19:13:14 at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
2024-11-24 19:13:14 at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)
2024-11-24 19:13:14 at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)
2024-11-24 19:13:14 at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
2024-11-24 19:13:14 at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
2024-11-24 19:13:14 at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
2024-11-24 19:13:14 at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
2024-11-24 19:13:14 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:14 at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
2024-11-24 19:13:14 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:252)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:256)
2024-11-24 19:13:14 at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
2024-11-24 19:13:14 at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
2024-11-24 19:13:14 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:14 at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
2024-11-24 19:13:14 at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
2024-11-24 19:13:14 at liquibase.command.CommandScope.execute(CommandScope.java:217)
2024-11-24 19:13:14 at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
2024-11-24 19:13:14 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:14 at liquibase.Liquibase.runInScope(Liquibase.java:1419)
2024-11-24 19:13:14 at liquibase.Liquibase.update(Liquibase.java:234)
2024-11-24 19:13:14 at liquibase.Liquibase.update(Liquibase.java:212)
2024-11-24 19:13:14 at liquibase.Liquibase.update(Liquibase.java:194)
2024-11-24 19:13:14 at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__45468.invoke(liquibase.clj:371)
2024-11-24 19:13:14 at metabase.db.liquibase$run_in_scope_locked$reify__45464.run(liquibase.clj:336)
2024-11-24 19:13:14 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:14 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:14 at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:329)
2024-11-24 19:13:14 at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:312)
2024-11-24 19:13:14 at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:360)
2024-11-24 19:13:14 at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:353)
2024-11-24 19:13:14 at metabase.db.setup$migrate_BANG_55483__55484$fn__55485.invoke(setup.clj:84)
2024-11-24 19:13:14 at metabase.db.liquibase$do_with_liquibase45398__45399$f_STAR___45400.invoke(liquibase.clj:135)
2024-11-24 19:13:14 at metabase.db.liquibase$do_with_liquibase45398__45399.invokeStatic(liquibase.clj:138)
2024-11-24 19:13:14 at metabase.db.liquibase$do_with_liquibase45398__45399.invoke(liquibase.clj:126)
2024-11-24 19:13:14 at metabase.db.setup$migrate_BANG_55483__55484.invokeStatic(setup.clj:73)
2024-11-24 19:13:14 at metabase.db.setup$migrate_BANG_55483__55484.doInvoke(setup.clj:55)
2024-11-24 19:13:14 at clojure.lang.RestFn.invoke(RestFn.java:428)
2024-11-24 19:13:14 at metabase.db.setup$run_schema_migrations_BANG_55510__55511.invokeStatic(setup.clj:149)
2024-11-24 19:13:14 at metabase.db.setup$run_schema_migrations_BANG_55510__55511.invoke(setup.clj:144)
2024-11-24 19:13:14 at metabase.db.setup$setup_db_BANG_55517__55518$fn__55521$fn__55522.invoke(setup.clj:167)
2024-11-24 19:13:14 at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:238)
2024-11-24 19:13:14 at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:224)
2024-11-24 19:13:14 at metabase.db.setup$setup_db_BANG_55517__55518$fn__55521.invoke(setup.clj:161)
2024-11-24 19:13:14 at metabase.db.setup$setup_db_BANG_55517__55518.invokeStatic(setup.clj:160)
2024-11-24 19:13:14 at metabase.db.setup$setup_db_BANG_55517__55518.invoke(setup.clj:153)
2024-11-24 19:13:14 at metabase.db$setup_db_BANG_$fn__55546.invoke(db.clj:86)
2024-11-24 19:13:14 at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
2024-11-24 19:13:14 at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
2024-11-24 19:13:14 at clojure.lang.RestFn.invoke(RestFn.java:424)
2024-11-24 19:13:14 at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:121)
2024-11-24 19:13:14 at metabase.core$init_BANG__STAR_.invoke(core.clj:102)
2024-11-24 19:13:14 at metabase.core$init_BANG_.invokeStatic(core.clj:181)
2024-11-24 19:13:14 at metabase.core$init_BANG_.invoke(core.clj:176)
2024-11-24 19:13:14 at metabase.core$start_normally.invokeStatic(core.clj:193)
2024-11-24 19:13:14 at metabase.core$start_normally.invoke(core.clj:187)
2024-11-24 19:13:14 at metabase.core$entrypoint.invokeStatic(core.clj:226)
2024-11-24 19:13:14 at metabase.core$entrypoint.doInvoke(core.clj:220)
2024-11-24 19:13:14 at clojure.lang.RestFn.invoke(RestFn.java:400)
2024-11-24 19:13:14 at clojure.lang.AFn.applyToHelper(AFn.java:152)
2024-11-24 19:13:14 at clojure.lang.RestFn.applyTo(RestFn.java:135)
2024-11-24 19:13:14 at clojure.lang.Var.applyTo(Var.java:707)
2024-11-24 19:13:14 at clojure.core$apply.invokeStatic(core.clj:667)
2024-11-24 19:13:14 at clojure.core$apply.invoke(core.clj:662)
2024-11-24 19:13:14 at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
2024-11-24 19:13:14 at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
2024-11-24 19:13:14 at clojure.lang.RestFn.invoke(RestFn.java:400)
2024-11-24 19:13:14 at clojure.lang.AFn.applyToHelper(AFn.java:152)
2024-11-24 19:13:14 at clojure.lang.RestFn.applyTo(RestFn.java:135)
2024-11-24 19:13:14 at metabase.bootstrap.main(Unknown Source)
2024-11-24 19:13:14 Caused by: org.postgresql.util.PSQLException: ERROR: relation ""metabase.report_card"" does not exist
2024-11-24 19:13:14 at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
2024-11-24 19:13:14 at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
2024-11-24 19:13:14 at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
2024-11-24 19:13:14 at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
2024-11-24 19:13:14 at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
2024-11-24 19:13:14 at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
2024-11-24 19:13:14 at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
2024-11-24 19:13:14 at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
2024-11-24 19:13:14 at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
2024-11-24 19:13:14 at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
2024-11-24 19:13:14 at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
2024-11-24 19:13:14 ... 86 more
2024-11-24 19:13:14 
2024-11-24 19:13:14 UPDATE SUMMARY
2024-11-24 19:13:14 Run:                        420
2024-11-24 19:13:14 Previously run:               0
2024-11-24 19:13:14 Filtered out:                51
2024-11-24 19:13:14 -------------------------------
2024-11-24 19:13:14 Total change sets:          471
2024-11-24 19:13:14 
2024-11-24 19:13:14 
2024-11-24 19:13:14 FILTERED CHANGE SETS SUMMARY
2024-11-24 19:13:14 DBMS mismatch:               51
2024-11-24 19:13:14 
2024-11-24 19:13:14 2024-11-24 16:13:14,483 INFO liquibase.util :: UPDATE SUMMARY
2024-11-24 19:13:14 2024-11-24 16:13:14,483 INFO liquibase.util :: Run:                        420
2024-11-24 19:13:14 2024-11-24 16:13:14,484 INFO liquibase.util :: Previously run:               0
2024-11-24 19:13:14 2024-11-24 16:13:14,485 INFO liquibase.util :: Filtered out:                51
2024-11-24 19:13:14 2024-11-24 16:13:14,486 INFO liquibase.util :: -------------------------------
2024-11-24 19:13:14 2024-11-24 16:13:14,487 INFO liquibase.util :: Total change sets:          471
2024-11-24 19:13:14 2024-11-24 16:13:14,487 INFO liquibase.util :: FILTERED CHANGE SETS SUMMARY
2024-11-24 19:13:14 2024-11-24 16:13:14,487 INFO liquibase.util :: DBMS mismatch:               51
2024-11-24 19:13:14 2024-11-24 16:13:14,498 INFO liquibase.util :: Update summary generated
2024-11-24 19:13:14 2024-11-24 16:13:14,505 INFO liquibase.command :: Update command encountered an exception.
2024-11-24 19:13:14 2024-11-24 16:13:14,573 INFO liquibase.lockservice :: Successfully released change log lock
2024-11-24 19:13:14 2024-11-24 16:13:14,596 INFO liquibase.command :: Logging exception.
2024-11-24 19:13:14 2024-11-24 16:13:14,596 INFO liquibase.command :: Command execution complete
2024-11-24 19:13:14 2024-11-24 16:13:14,651 INFO liquibase.lockservice :: Successfully released change log lock
2024-11-24 19:13:15 2024-11-24 16:13:15,123 ERROR metabase.core :: Metabase Initialization FAILED
2024-11-24 19:13:15 liquibase.exception.CommandExecutionException: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v45.00-002::snoe:
2024-11-24 19:13:15      Reason: liquibase.exception.DatabaseException: ERROR: relation ""metabase.report_card"" does not exist [Failed SQL: (0) CREATE TABLE ""metabase"".""query_action"" (""action_id"" INTEGER NOT NULL, ""card_id"" INTEGER NOT NULL, CONSTRAINT ""fk_query_action_ref_action_id"" FOREIGN KEY (""action_id"") REFERENCES ""metabase"".""action""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_query_action_ref_card_id"" FOREIGN KEY (""card_id"") REFERENCES ""metabase"".""report_card""(""id"") ON DELETE CASCADE)]
2024-11-24 19:13:15 at liquibase.command.CommandScope.execute(CommandScope.java:253)
2024-11-24 19:13:15 at liquibase.Liquibase.lambda$update$0(Liquibase.java:245)
2024-11-24 19:13:15 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:15 at liquibase.Liquibase.runInScope(Liquibase.java:1419)
2024-11-24 19:13:15 at liquibase.Liquibase.update(Liquibase.java:234)
2024-11-24 19:13:15 at liquibase.Liquibase.update(Liquibase.java:212)
2024-11-24 19:13:15 at liquibase.Liquibase.update(Liquibase.java:194)
2024-11-24 19:13:15 at metabase.db.liquibase$migrate_up_if_needed_BANG_$fn__45468.invoke(liquibase.clj:371)
2024-11-24 19:13:15 at metabase.db.liquibase$run_in_scope_locked$reify__45464.run(liquibase.clj:336)
2024-11-24 19:13:15 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:15 at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:329)
2024-11-24 19:13:15 at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:312)
2024-11-24 19:13:15 at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:360)
2024-11-24 19:13:15 at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:353)
2024-11-24 19:13:15 at metabase.db.setup$migrate_BANG_55483__55484$fn__55485.invoke(setup.clj:84)
2024-11-24 19:13:15 at metabase.db.liquibase$do_with_liquibase45398__45399$f_STAR___45400.invoke(liquibase.clj:135)
2024-11-24 19:13:15 at metabase.db.liquibase$do_with_liquibase45398__45399.invokeStatic(liquibase.clj:138)
2024-11-24 19:13:15 at metabase.db.liquibase$do_with_liquibase45398__45399.invoke(liquibase.clj:126)
2024-11-24 19:13:15 at metabase.db.setup$migrate_BANG_55483__55484.invokeStatic(setup.clj:73)
2024-11-24 19:13:15 at metabase.db.setup$migrate_BANG_55483__55484.doInvoke(setup.clj:55)
2024-11-24 19:13:15 at clojure.lang.RestFn.invoke(RestFn.java:428)
2024-11-24 19:13:15 at metabase.db.setup$run_schema_migrations_BANG_55510__55511.invokeStatic(setup.clj:149)
2024-11-24 19:13:15 at metabase.db.setup$run_schema_migrations_BANG_55510__55511.invoke(setup.clj:144)
2024-11-24 19:13:15 at metabase.db.setup$setup_db_BANG_55517__55518$fn__55521$fn__55522.invoke(setup.clj:167)
2024-11-24 19:13:15 at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:238)
2024-11-24 19:13:15 at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:224)
2024-11-24 19:13:15 at metabase.db.setup$setup_db_BANG_55517__55518$fn__55521.invoke(setup.clj:161)
2024-11-24 19:13:15 at metabase.db.setup$setup_db_BANG_55517__55518.invokeStatic(setup.clj:160)
2024-11-24 19:13:15 at metabase.db.setup$setup_db_BANG_55517__55518.invoke(setup.clj:153)
2024-11-24 19:13:15 at metabase.db$setup_db_BANG_$fn__55546.invoke(db.clj:86)
2024-11-24 19:13:15 at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
2024-11-24 19:13:15 at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
2024-11-24 19:13:15 at clojure.lang.RestFn.invoke(RestFn.java:424)
2024-11-24 19:13:15 at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:121)
2024-11-24 19:13:15 at metabase.core$init_BANG__STAR_.invoke(core.clj:102)
2024-11-24 19:13:15 at metabase.core$init_BANG_.invokeStatic(core.clj:181)
2024-11-24 19:13:15 at metabase.core$init_BANG_.invoke(core.clj:176)
2024-11-24 19:13:15 at metabase.core$start_normally.invokeStatic(core.clj:193)
2024-11-24 19:13:15 at metabase.core$start_normally.invoke(core.clj:187)
2024-11-24 19:13:15 at metabase.core$entrypoint.invokeStatic(core.clj:226)
2024-11-24 19:13:15 at metabase.core$entrypoint.doInvoke(core.clj:220)
2024-11-24 19:13:15 at clojure.lang.RestFn.invoke(RestFn.java:400)
2024-11-24 19:13:15 at clojure.lang.AFn.applyToHelper(AFn.java:152)
2024-11-24 19:13:15 at clojure.lang.RestFn.applyTo(RestFn.java:135)
2024-11-24 19:13:15 at clojure.lang.Var.applyTo(Var.java:707)
2024-11-24 19:13:15 at clojure.core$apply.invokeStatic(core.clj:667)
2024-11-24 19:13:15 at clojure.core$apply.invoke(core.clj:662)
2024-11-24 19:13:15 at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
2024-11-24 19:13:15 at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
2024-11-24 19:13:15 at clojure.lang.RestFn.invoke(RestFn.java:400)
2024-11-24 19:13:15 at clojure.lang.AFn.applyToHelper(AFn.java:152)
2024-11-24 19:13:15 at clojure.lang.RestFn.applyTo(RestFn.java:135)
2024-11-24 19:13:15 at metabase.bootstrap.main(Unknown Source)
2024-11-24 19:13:15 Caused by: liquibase.exception.LiquibaseException: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v45.00-002::snoe:
2024-11-24 19:13:15      Reason: liquibase.exception.DatabaseException: ERROR: relation ""metabase.report_card"" does not exist [Failed SQL: (0) CREATE TABLE ""metabase"".""query_action"" (""action_id"" INTEGER NOT NULL, ""card_id"" INTEGER NOT NULL, CONSTRAINT ""fk_query_action_ref_action_id"" FOREIGN KEY (""action_id"") REFERENCES ""metabase"".""action""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_query_action_ref_card_id"" FOREIGN KEY (""card_id"") REFERENCES ""metabase"".""report_card""(""id"") ON DELETE CASCADE)]
2024-11-24 19:13:15 at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:151)
2024-11-24 19:13:15 at liquibase.command.core.AbstractUpdateCommandStep.lambda$run$0(AbstractUpdateCommandStep.java:110)
2024-11-24 19:13:15 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:15 at liquibase.command.core.AbstractUpdateCommandStep.run(AbstractUpdateCommandStep.java:108)
2024-11-24 19:13:15 at liquibase.command.core.UpdateCommandStep.run(UpdateCommandStep.java:105)
2024-11-24 19:13:15 at liquibase.command.CommandScope.execute(CommandScope.java:217)
2024-11-24 19:13:15 ... 58 more
2024-11-24 19:13:15 Caused by: liquibase.exception.MigrationFailedException: Migration failed for changeset migrations/001_update_migrations.yaml::v45.00-002::snoe:
2024-11-24 19:13:15      Reason: liquibase.exception.DatabaseException: ERROR: relation ""metabase.report_card"" does not exist [Failed SQL: (0) CREATE TABLE ""metabase"".""query_action"" (""action_id"" INTEGER NOT NULL, ""card_id"" INTEGER NOT NULL, CONSTRAINT ""fk_query_action_ref_action_id"" FOREIGN KEY (""action_id"") REFERENCES ""metabase"".""action""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_query_action_ref_card_id"" FOREIGN KEY (""card_id"") REFERENCES ""metabase"".""report_card""(""id"") ON DELETE CASCADE)]
2024-11-24 19:13:15 at liquibase.changelog.ChangeSet.execute(ChangeSet.java:797)
2024-11-24 19:13:15 at liquibase.changelog.visitor.UpdateVisitor.executeAcceptedChange(UpdateVisitor.java:119)
2024-11-24 19:13:15 at liquibase.changelog.visitor.UpdateVisitor.visit(UpdateVisitor.java:68)
2024-11-24 19:13:15 at liquibase.changelog.ChangeLogIterator$2.lambda$run$0(ChangeLogIterator.java:133)
2024-11-24 19:13:15 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:15 at liquibase.changelog.ChangeLogIterator$2.run(ChangeLogIterator.java:122)
2024-11-24 19:13:15 at liquibase.Scope.lambda$child$0(Scope.java:186)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:195)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:185)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:164)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:252)
2024-11-24 19:13:15 at liquibase.Scope.child(Scope.java:256)
2024-11-24 19:13:15 at liquibase.changelog.ChangeLogIterator.run(ChangeLogIterator.java:89)
2024-11-24 19:13:15 ... 66 more
2024-11-24 19:13:15 Caused by: liquibase.exception.DatabaseException: ERROR: relation ""metabase.report_card"" does not exist [Failed SQL: (0) CREATE TABLE ""metabase"".""query_action"" (""action_id"" INTEGER NOT NULL, ""card_id"" INTEGER NOT NULL, CONSTRAINT ""fk_query_action_ref_action_id"" FOREIGN KEY (""action_id"") REFERENCES ""metabase"".""action""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_query_action_ref_card_id"" FOREIGN KEY (""card_id"") REFERENCES ""metabase"".""report_card""(""id"") ON DELETE CASCADE)]
2024-11-24 19:13:15 at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:470)
2024-11-24 19:13:15 at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:77)
2024-11-24 19:13:15 at liquibase.executor.jvm.JdbcExecutor.execute(JdbcExecutor.java:179)
2024-11-24 19:13:15 at liquibase.executor.AbstractExecutor.execute(AbstractExecutor.java:141)
2024-11-24 19:13:15 at liquibase.database.AbstractJdbcDatabase.executeStatements(AbstractJdbcDatabase.java:1285)
2024-11-24 19:13:15 at liquibase.changelog.ChangeSet.execute(ChangeSet.java:755)
2024-11-24 19:13:15 ... 81 more
2024-11-24 19:13:15 Caused by: org.postgresql.util.PSQLException: ERROR: relation ""metabase.report_card"" does not exist
2024-11-24 19:13:15 at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)
2024-11-24 19:13:15 at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)
2024-11-24 19:13:15 at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)
2024-11-24 19:13:15 at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)
2024-11-24 19:13:15 at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)
2024-11-24 19:13:15 at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:341)
2024-11-24 19:13:15 at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:326)
2024-11-24 19:13:15 at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:302)
2024-11-24 19:13:15 at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:297)
2024-11-24 19:13:15 at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
2024-11-24 19:13:15 at liquibase.executor.jvm.JdbcExecutor$ExecuteStatementCallback.doInStatement(JdbcExecutor.java:464)
2024-11-24 19:13:15 ... 86 more
2024-11-24 19:13:15 2024-11-24 16:13:15,135 INFO metabase.core :: Metabase Shutting Down ...
2024-11-24 19:13:15 2024-11-24 16:13:15,138 INFO metabase.server :: Shutting Down Embedded Jetty Webserver
2024-11-24 19:13:15 2024-11-24 16:13:15,164 WARN db.liquibase :: ()
2024-11-24 19:13:15 2024-11-24 16:13:15,166 INFO metabase.core :: Metabase Shutdown COMPLETE
```

### Information about your Metabase installation

```JSON
-
```

### Severity

blocking

### Additional context

- PostgreSQL Version: 16
- Docker Version: 27.1.2, build d01f264bcc",e-n-pugachev,2024-11-24 16:34:30+00:00,[],2024-11-25 16:18:44+00:00,2024-11-25 16:18:44+00:00,https://github.com/metabase/metabase/issues/50434,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2496298140, 'issue_id': 2687972163, 'author': 'e-n-pugachev', 'body': 'duplicate of #37836 #46646 #48457', 'created_at': datetime.datetime(2024, 11, 24, 22, 47, 42, tzinfo=datetime.timezone.utc)}]","e-n-pugachev (Issue Creator) on (2024-11-24 22:47:42 UTC): duplicate of #37836 #46646 #48457

"
2684704481,issue,closed,completed,"""keep data pivoted"" on the download menu is not translated at all","### Describe the bug

Seems we missed that specific section 
![Image](https://github.com/user-attachments/assets/e65f66c6-05c8-4e6e-ad08-a0b7b76c182e)


### To Reproduce

Set the instance to another language
try to download a pivot

### Expected behavior

we should translate everything on the FE

### Logs

NA

### Information about your Metabase installation

```JSON
v51
```

### Severity

P2

### Additional context

NA",paoliniluis,2024-11-22 21:49:54+00:00,[],2024-11-22 22:21:53+00:00,2024-11-22 22:21:52+00:00,https://github.com/metabase/metabase/issues/50427,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2494969508, 'issue_id': 2684704481, 'author': 'dpsutton', 'body': 'dupe of https://github.com/metabase/metabase/issues/50196 and already fixed.', 'created_at': datetime.datetime(2024, 11, 22, 22, 21, 52, tzinfo=datetime.timezone.utc)}]","dpsutton on (2024-11-22 22:21:52 UTC): dupe of https://github.com/metabase/metabase/issues/50196 and already fixed.

"
2684697145,issue,closed,completed,Tooltips in 51 lose information from the series vs 50,"### Describe the bug

Although we made this to declutter tooltips, we lost a few things that were useful in the tooltips

We used to render tooltips like this
![Image](https://github.com/user-attachments/assets/84ba7055-e54e-4480-a421-5354e0e9160a)

and now we render this:
![Image](https://github.com/user-attachments/assets/0f468018-b367-4935-9e9f-4f58ecb0e0f2)

### To Reproduce

Check tooltips vs 50

### Expected behavior

We should give the user the possibility of adding/removing the fields they want

### Logs

NA

### Information about your Metabase installation

```JSON
v51
```

### Severity

P2

### Additional context

Might be a regression?",paoliniluis,2024-11-22 21:46:38+00:00,[],2024-12-13 15:36:39+00:00,2024-12-13 15:36:39+00:00,https://github.com/metabase/metabase/issues/50425,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/Charts', 'Line, area, bar, combo, and scatter charts.'), ('.Team/DashViz', 'Dashboard and Viz team'), ('Bug:v51', 'bugs or regressions introduced in v51')]",[],
2684674011,issue,closed,completed,"[BE, QP] Add `get-iso-day-of-week` MBQL sugar function",,metamben,2024-11-22 21:34:43+00:00,['metamben'],2025-01-27 22:14:26+00:00,2024-11-27 13:18:52+00:00,https://github.com/metabase/metabase/issues/50424,[],[],
2684557930,issue,closed,completed,Snowflake - Specifying Schema in Database Setup still requires Schema in Queries,"### Describe the bug

In setting up a Snowflake Database connector, I want it to only read one schema from the database - so our users can simply query `select * from <table>` instead of `select * from <schema_name>.<table>`

In the database set up, I selected `Only these...` and specify the only one as `<schema_name>` . It connects successfully. But when I go to build a query with this connection, it will only succeed when I specify what schema needs to read from. 

Additionally, I've tried a combination of `only these` or `all schemas` while also setting `schema=schema_name` in the ""Additional JDBC connection string options"". The outcomes are the same. Queries work while specifying the schema & table, but will not work with just the table. 

Following the threads from [this closed PR](https://github.com/metabase/metabase/pull/19651) I would expect this action to allow for `select * from <table>` work. 

I am also certain that the snowflake user record is set up with the correct & corresponding `DEFAULT_NAMESPACE` of ""database_name.schema_name""

Is this functionality not possible or is this a bug? 

### To Reproduce

1. Go to Metabase Admin. 
2. Connect to a Snowflake Database and select `only these` in Schema. 
3. Then specify the one schema to connect to in the box below. And save the new settings.
4. Build a query and attempt this on one of the tables. `select * from <table_name> limit 10;`
5. You should get a `object not authorized response`
6. Redo your query with `select * from <schema_name>.<table_name> limit 10;` 
7. It should produce results successfully

Alternatively, we tried the ""Additional JDBC connection string options"" route as well...
1. Go to Metabase Admin. 
2. Connect to a Snowflake Database and select 'All' (we also tried 'Only these`)
3. Set `schema=schema_name` in ""Additional JDBC connection string options"" and hit save.
4. Build a query and attempt this on one of the tables. `select * from <table_name> limit 10;`
5. You should get a `object not authorized response`
6. Redo your query with `select * from <schema_name>.<table_name> limit 10;` 
7. It should produce results successfully

### Expected behavior

This is explained in the steps to reproduce

### Logs

[50235815-1473-48b8-8ae5-b14459847772] 2024-11-22T14:44:46-06:00 ERROR metabase.query-processor.middleware.catch-exceptions Error processing query: SQL compilation error:
Object '<table_name>' does not exist or not authorized.
{:database_id 80,
 :started_at #t ""2024-11-22T20:44:46.243693Z[GMT]"",
 :via
 [{:status :failed,
   :class clojure.lang.ExceptionInfo,
   :error ""Error executing query: SQL compilation error:\nObject '<table_name>' does not exist or not authorized."",
   :stacktrace
   [""--> driver.sql_jdbc.execute$execute_reducible_query$fn__87286$fn__87287.invoke(execute.clj:717)""
    ""driver.sql_jdbc.execute$execute_reducible_query$fn__87286.invoke(execute.clj:714)""
    ""driver.sql_jdbc.execute$fn__87090$fn__87091.invoke(execute.clj:398)""
    ""driver.sql_jdbc.execute$do_with_resolved_connection87060__87061.invokeStatic(execute.clj:338)""
    ""driver.sql_jdbc.execute$do_with_resolved_connection87060__87061.invoke(execute.clj:321)""
    ""driver.sql_jdbc.execute$fn__87090.invokeStatic(execute.clj:392)""
    ""driver.sql_jdbc.execute$fn__87090.invoke(execute.clj:390)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)""
    ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
    ""driver.sql_jdbc$fn__113432.invokeStatic(sql_jdbc.clj:79)""
    ""driver.sql_jdbc$fn__113432.invoke(sql_jdbc.clj:77)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)""
    ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)""
    ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)""
    ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)""
    ""query_processor.execute$run.invokeStatic(execute.clj:62)""
    ""query_processor.execute$run.invoke(execute.clj:56)""
    ""query_processor.middleware.update_used_cards$update_used_cards_BANG_76957__76958$fn__76959.invoke(update_used_cards.clj:60)""
    ""query_processor.execute$add_native_form_to_result_metadata$fn__76974.invoke(execute.clj:25)""
    ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__76980.invoke(execute.clj:36)""
    ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___76930.invoke(cache.clj:241)""
    ""query_processor.middleware.permissions$check_query_permissions$fn__73967.invoke(permissions.clj:147)""
    ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__74678.invoke(enterprise.clj:51)""
    ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__74688.invoke(enterprise.clj:64)""
    ""query_processor.execute$execute77007__77008$fn__77009.invoke(execute.clj:94)""
    ""query_processor.setup$do_with_qp_setup75203__75204.invokeStatic(setup.clj:225)""
    ""query_processor.setup$do_with_qp_setup75203__75204.invoke(setup.clj:216)""
    ""query_processor.execute$execute77007__77008.invokeStatic(execute.clj:93)""
    ""query_processor.execute$execute77007__77008.invoke(execute.clj:89)""
    ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)""
    ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)""
    ""query_processor.middleware.enterprise$fn__74705$handle_audit_app_internal_queries__74706$fn__74708.invoke(enterprise.clj:96)""
    ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__74716.invoke(enterprise.clj:103)""
    ""query_processor.middleware.process_userland_query$process_userland_query_middleware77863__77864$fn__77865.invoke(process_userland_query.clj:204)""
    ""query_processor.middleware.catch_exceptions$catch_exceptions77928__77929$fn__77930.invoke(catch_exceptions.clj:132)""
    ""query_processor$process_query77969__77970$fn__77971.invoke(query_processor.clj:80)""
    ""query_processor.setup$do_with_canceled_chan75198__75199$fn__75200.invoke(setup.clj:187)""
    ""query_processor.setup$do_with_database_local_settings75191__75192$fn__75193.invoke(setup.clj:181)""
    ""query_processor.setup$do_with_driver75184__75185$fn__75186$fn__75187.invoke(setup.clj:166)""
    ""driver$do_with_driver.invokeStatic(driver.clj:106)""
    ""driver$do_with_driver.invoke(driver.clj:101)""
    ""query_processor.setup$do_with_driver75184__75185$fn__75186.invoke(setup.clj:165)""
    ""query_processor.setup$do_with_metadata_provider75175__75176$fn__75177$fn__75180.invoke(setup.clj:151)""
    ""query_processor.store$do_with_metadata_provider58710__58711.invokeStatic(store.clj:170)""
    ""query_processor.store$do_with_metadata_provider58710__58711.invoke(store.clj:150)""
    ""query_processor.store$do_with_metadata_provider58710__58711.invokeStatic(store.clj:159)""
    ""query_processor.store$do_with_metadata_provider58710__58711.invoke(store.clj:150)""
    ""query_processor.setup$do_with_metadata_provider75175__75176$fn__75177.invoke(setup.clj:150)""
    ""query_processor.setup$do_with_resolved_database75165__75166$fn__75167.invoke(setup.clj:128)""
    ""query_processor.setup$do_with_qp_setup75203__75204.invokeStatic(setup.clj:232)""
    ""query_processor.setup$do_with_qp_setup75203__75204.invoke(setup.clj:216)""
    ""query_processor$process_query77969__77970.invokeStatic(query_processor.clj:78)""
    ""query_processor$process_query77969__77970.invoke(query_processor.clj:71)""
    ""api.dataset$run_streaming_query100086__100089$fn__100093.invoke(dataset.clj:84)""
    ""query_processor.streaming$_streaming_response$fn__61541$fn__61542$fn__61543.invoke(streaming.clj:176)""
    ""query_processor.streaming$_streaming_response$fn__61541$fn__61542.invoke(streaming.clj:174)""
    ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
    ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
    ""query_processor.streaming$_streaming_response$fn__61541.invoke(streaming.clj:171)""
    ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)""
    ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)""
    ""async.streaming_response$do_f_async$task__53194.invoke(streaming_response.clj:97)""],
   :error_type :invalid-query,
   :ex-data
   {:driver :snowflake,
    :sql
    [""select""
     ""  *""
     ""from""
     "" <table_name>""
     ""limit""
     ""  10;""
     ""-- {\""pulseId\"":null,\""serverId\"":\""cc9364b2-c536-43d9-b60d-661d54c973bc\"",\""client\"":\""Metabase\"",\""queryHash\"":\""4312c0c7a79a4f9b1f1da8a89e7e69931bc30b375c3da9e4b7f83e389aeb689f\"",\""queryType\"":\""native\"",\""cardId\"":null,\""dashboardId\"":null,\""context\"":\""ad-hoc\"",\""userId\"":8,\""databaseId\"":80}""],
    :params nil,
    :type :invalid-query}}],
 :action_id nil,
 :state ""42S02"",
 :error_type :invalid-query,
 :json_query
 {:database 80,
  :type ""native"",
  :native {:template-tags {}, :query ""select * from <table_name> limit 10;""},
  :parameters [],
  :middleware {:js-int-to-string? true, :userland-query? true, :add-default-userland-constraints? true}},
 :status :failed,
 :class net.snowflake.client.jdbc.SnowflakeSQLException,
 :stacktrace
 [""net.snowflake.client.jdbc.SnowflakeUtil.checkErrorAndThrowExceptionSub(SnowflakeUtil.java:176)""
  ""net.snowflake.client.jdbc.SnowflakeUtil.checkErrorAndThrowException(SnowflakeUtil.java:109)""
  ""net.snowflake.client.core.StmtUtil.pollForOutput(StmtUtil.java:490)""
  ""net.snowflake.client.core.StmtUtil.execute(StmtUtil.java:396)""
  ""net.snowflake.client.core.SFStatement.executeHelper(SFStatement.java:498)""
  ""net.snowflake.client.core.SFStatement.executeQueryInternal(SFStatement.java:215)""
  ""net.snowflake.client.core.SFStatement.executeQuery(SFStatement.java:149)""
  ""net.snowflake.client.core.SFStatement.execute(SFStatement.java:786)""
  ""net.snowflake.client.core.SFStatement.execute(SFStatement.java:693)""
  ""net.snowflake.client.jdbc.SnowflakeStatementV1.executeInternal(SnowflakeStatementV1.java:354)""
  ""net.snowflake.client.jdbc.SnowflakeStatementV1.execute(SnowflakeStatementV1.java:429)""
  ""com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)""
  ""--> driver.sql_jdbc.execute$fn__87216.invokeStatic(execute.clj:570)""
  ""driver.sql_jdbc.execute$fn__87216.invoke(execute.clj:568)""
  ""driver.sql_jdbc.execute$execute_statement_or_prepared_statement_BANG_.invokeStatic(execute.clj:578)""
  ""driver.sql_jdbc.execute$execute_statement_or_prepared_statement_BANG_.invoke(execute.clj:575)""
  ""driver.sql_jdbc.execute$execute_reducible_query$fn__87286$fn__87287.invoke(execute.clj:715)""
  ""driver.sql_jdbc.execute$execute_reducible_query$fn__87286.invoke(execute.clj:714)""
  ""driver.sql_jdbc.execute$fn__87090$fn__87091.invoke(execute.clj:398)""
  ""driver.sql_jdbc.execute$do_with_resolved_connection87060__87061.invokeStatic(execute.clj:338)""
  ""driver.sql_jdbc.execute$do_with_resolved_connection87060__87061.invoke(execute.clj:321)""
  ""driver.sql_jdbc.execute$fn__87090.invokeStatic(execute.clj:392)""
  ""driver.sql_jdbc.execute$fn__87090.invoke(execute.clj:390)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
  ""driver.sql_jdbc$fn__113432.invokeStatic(sql_jdbc.clj:79)""
  ""driver.sql_jdbc$fn__113432.invoke(sql_jdbc.clj:77)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)""
  ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)""
  ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)""
  ""query_processor.execute$run.invokeStatic(execute.clj:62)""
  ""query_processor.execute$run.invoke(execute.clj:56)""
  ""query_processor.middleware.update_used_cards$update_used_cards_BANG_76957__76958$fn__76959.invoke(update_used_cards.clj:60)""
  ""query_processor.execute$add_native_form_to_result_metadata$fn__76974.invoke(execute.clj:25)""
  ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__76980.invoke(execute.clj:36)""
  ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___76930.invoke(cache.clj:241)""
  ""query_processor.middleware.permissions$check_query_permissions$fn__73967.invoke(permissions.clj:147)""
  ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__74678.invoke(enterprise.clj:51)""
  ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__74688.invoke(enterprise.clj:64)""
  ""query_processor.execute$execute77007__77008$fn__77009.invoke(execute.clj:94)""
  ""query_processor.setup$do_with_qp_setup75203__75204.invokeStatic(setup.clj:225)""
  ""query_processor.setup$do_with_qp_setup75203__75204.invoke(setup.clj:216)""
  ""query_processor.execute$execute77007__77008.invokeStatic(execute.clj:93)""
  ""query_processor.execute$execute77007__77008.invoke(execute.clj:89)""
  ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)""
  ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)""
  ""query_processor.middleware.enterprise$fn__74705$handle_audit_app_internal_queries__74706$fn__74708.invoke(enterprise.clj:96)""
  ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__74716.invoke(enterprise.clj:103)""
  ""query_processor.middleware.process_userland_query$process_userland_query_middleware77863__77864$fn__77865.invoke(process_userland_query.clj:204)""
  ""query_processor.middleware.catch_exceptions$catch_exceptions77928__77929$fn__77930.invoke(catch_exceptions.clj:132)""
  ""query_processor$process_query77969__77970$fn__77971.invoke(query_processor.clj:80)""
  ""query_processor.setup$do_with_canceled_chan75198__75199$fn__75200.invoke(setup.clj:187)""
  ""query_processor.setup$do_with_database_local_settings75191__75192$fn__75193.invoke(setup.clj:181)""
  ""query_processor.setup$do_with_driver75184__75185$fn__75186$fn__75187.invoke(setup.clj:166)""
  ""driver$do_with_driver.invokeStatic(driver.clj:106)""
  ""driver$do_with_driver.invoke(driver.clj:101)""
  ""query_processor.setup$do_with_driver75184__75185$fn__75186.invoke(setup.clj:165)""
  ""query_processor.setup$do_with_metadata_provider75175__75176$fn__75177$fn__75180.invoke(setup.clj:151)""
  ""query_processor.store$do_with_metadata_provider58710__58711.invokeStatic(store.clj:170)""
  ""query_processor.store$do_with_metadata_provider58710__58711.invoke(store.clj:150)""
  ""query_processor.store$do_with_metadata_provider58710__58711.invokeStatic(store.clj:159)""
  ""query_processor.store$do_with_metadata_provider58710__58711.invoke(store.clj:150)""
  ""query_processor.setup$do_with_metadata_provider75175__75176$fn__75177.invoke(setup.clj:150)""
  ""query_processor.setup$do_with_resolved_database75165__75166$fn__75167.invoke(setup.clj:128)""
  ""query_processor.setup$do_with_qp_setup75203__75204.invokeStatic(setup.clj:232)""
  ""query_processor.setup$do_with_qp_setup75203__75204.invoke(setup.clj:216)""
  ""query_processor$process_query77969__77970.invokeStatic(query_processor.clj:78)""
  ""query_processor$process_query77969__77970.invoke(query_processor.clj:71)""
  ""api.dataset$run_streaming_query100086__100089$fn__100093.invoke(dataset.clj:84)""
  ""query_processor.streaming$_streaming_response$fn__61541$fn__61542$fn__61543.invoke(streaming.clj:176)""
  ""query_processor.streaming$_streaming_response$fn__61541$fn__61542.invoke(streaming.clj:174)""
  ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:165)""
  ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:152)""
  ""query_processor.streaming$_streaming_response$fn__61541.invoke(streaming.clj:171)""
  ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)""
  ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)""
  ""async.streaming_response$do_f_async$task__53194.invoke(streaming_response.clj:97)""],
 :card_id nil,
 :context :ad-hoc,
 :error ""SQL compilation error:\nObject '<table_name>' does not exist or not authorized."",
 :row_count 0,
 :running_time 0,
 :data {:rows [], :cols []}}

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""bigquery-cloud-sdk"",
      ""snowflake""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-11"",
      ""tag"": ""v0.51.3"",
      ""hash"": ""d757d0b""
    },
    ""settings"": {
      ""report-timezone"": ""US/Central""
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""16.1""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-1066-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Pretty Big, if this isn't resolved, it's going to delay some data migration work

### Additional context

_No response_",swatland610,2024-11-22 20:58:26+00:00,['snoe'],2024-12-03 20:17:23+00:00,2024-11-26 21:46:56+00:00,https://github.com/metabase/metabase/issues/50422,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Database/Snowflake', '')]","[{'comment_id': 2494840769, 'issue_id': 2684557930, 'author': 'luizarakaki', 'body': 'You can specify the default parameter as a JDBC parameter https://docs.snowflake.com/en/developer-guide/jdbc/jdbc-parameters#schema in ""Additional JDBC connection string options""\n\nWe maybe could do it automatically if you choose a single schema, but the workaround is there', 'created_at': datetime.datetime(2024, 11, 22, 21, 22, 57, tzinfo=datetime.timezone.utc)}, {'comment_id': 2494846877, 'issue_id': 2684557930, 'author': 'swatland610', 'body': 'Thank you for the response! @luizarakaki I neglected to mention that I actually tried that too. I have set in the ""Additional JDBC connection string options"" `schema=schema_name` and the problem still persists. I\'ll update my submission above to include that', 'created_at': datetime.datetime(2024, 11, 22, 21, 25, 4, tzinfo=datetime.timezone.utc)}, {'comment_id': 2501330578, 'issue_id': 2684557930, 'author': 'luizarakaki', 'body': '@swatland610 can you add here the name of the database, schema, and tables?\n\nSnowflake JDBC driver automatically changes everything to uppercase. So if you have lowercase db/schema/table, you need to define these with quotes and also enable this toggle\n![Image](https://github.com/user-attachments/assets/e0b9516f-f74e-4eb1-9a11-d3f469dfdfe6)\n\nThis query works in my env:\n```select * from ""orders""``` if I pass `db=v3_sample-dataset&schema=PUBLIC`', 'created_at': datetime.datetime(2024, 11, 26, 16, 27, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2501367892, 'issue_id': 2684557930, 'author': 'swatland610', 'body': 'Sure! I will say those that we don\'t have specific case requirements matching in snowflake for any of database / schema / tables relevant for this. Here\'s a few examples: \n\n1. `select * from users limit 10; ` -> does not work\n2. `select * from USERS limit 10;` -> does not work\n3. `select * from ""users"" limit 10;` -> does not work\n\n4. `select * from PG_DSCOUT.USERS limit 10;` -> this does work\n5. `select * from pg_dscout.users limit 10;` -> this does work\n\nHere\'s a screeshot of our current set up (but know that we\'ve tried all iterations as I described above)\n![Image](https://github.com/user-attachments/assets/a4abd7f7-204d-4ade-9881-728fea0f6fb6)', 'created_at': datetime.datetime(2024, 11, 26, 16, 41, 55, tzinfo=datetime.timezone.utc)}, {'comment_id': 2501408770, 'issue_id': 2684557930, 'author': 'luizarakaki', 'body': 'Did you try:\n`db=RAW_STITCH&schema=PG_DSCOUT`\n\nIn the connection string?', 'created_at': datetime.datetime(2024, 11, 26, 16, 53, 13, tzinfo=datetime.timezone.utc)}, {'comment_id': 2501429515, 'issue_id': 2684557930, 'author': 'swatland610', 'body': ""Just tried it now, and it's producing the same result"", 'created_at': datetime.datetime(2024, 11, 26, 16, 57, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2501434748, 'issue_id': 2684557930, 'author': 'swatland610', 'body': ""It's worth calling out that the user record I'm using default namespace is `RAW_STITCH.PG_DSCOUT` in Snowflake as well"", 'created_at': datetime.datetime(2024, 11, 26, 16, 58, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2501515741, 'issue_id': 2684557930, 'author': 'luizarakaki', 'body': 'Ok, I think I found something here. The schema name is not being applied, it works only if the schema is ""PUBLIC""', 'created_at': datetime.datetime(2024, 11, 26, 17, 19, tzinfo=datetime.timezone.utc)}, {'comment_id': 2504554785, 'issue_id': 2684557930, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 11, 27, 18, 30, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2512664652, 'issue_id': 2684557930, 'author': 'luizarakaki', 'body': '@swatland610 this was released. Can you confirm it works?', 'created_at': datetime.datetime(2024, 12, 2, 20, 2, 55, tzinfo=datetime.timezone.utc)}, {'comment_id': 2515466968, 'issue_id': 2684557930, 'author': 'swatland610', 'body': ""@luizarakaki thanks for your help! It looks like it's working great!"", 'created_at': datetime.datetime(2024, 12, 3, 20, 17, 21, tzinfo=datetime.timezone.utc)}]","luizarakaki on (2024-11-22 21:22:57 UTC): You can specify the default parameter as a JDBC parameter https://docs.snowflake.com/en/developer-guide/jdbc/jdbc-parameters#schema in ""Additional JDBC connection string options""

We maybe could do it automatically if you choose a single schema, but the workaround is there

swatland610 (Issue Creator) on (2024-11-22 21:25:04 UTC): Thank you for the response! @luizarakaki I neglected to mention that I actually tried that too. I have set in the ""Additional JDBC connection string options"" `schema=schema_name` and the problem still persists. I'll update my submission above to include that

luizarakaki on (2024-11-26 16:27:36 UTC): @swatland610 can you add here the name of the database, schema, and tables?

Snowflake JDBC driver automatically changes everything to uppercase. So if you have lowercase db/schema/table, you need to define these with quotes and also enable this toggle
![Image](https://github.com/user-attachments/assets/e0b9516f-f74e-4eb1-9a11-d3f469dfdfe6)

This query works in my env:
```select * from ""orders""``` if I pass `db=v3_sample-dataset&schema=PUBLIC`

swatland610 (Issue Creator) on (2024-11-26 16:41:55 UTC): Sure! I will say those that we don't have specific case requirements matching in snowflake for any of database / schema / tables relevant for this. Here's a few examples: 

1. `select * from users limit 10; ` -> does not work
2. `select * from USERS limit 10;` -> does not work
3. `select * from ""users"" limit 10;` -> does not work

4. `select * from PG_DSCOUT.USERS limit 10;` -> this does work
5. `select * from pg_dscout.users limit 10;` -> this does work

Here's a screeshot of our current set up (but know that we've tried all iterations as I described above)
![Image](https://github.com/user-attachments/assets/a4abd7f7-204d-4ade-9881-728fea0f6fb6)

luizarakaki on (2024-11-26 16:53:13 UTC): Did you try:
`db=RAW_STITCH&schema=PG_DSCOUT`

In the connection string?

swatland610 (Issue Creator) on (2024-11-26 16:57:41 UTC): Just tried it now, and it's producing the same result

swatland610 (Issue Creator) on (2024-11-26 16:58:41 UTC): It's worth calling out that the user record I'm using default namespace is `RAW_STITCH.PG_DSCOUT` in Snowflake as well

luizarakaki on (2024-11-26 17:19:00 UTC): Ok, I think I found something here. The schema name is not being applied, it works only if the schema is ""PUBLIC""

github-actions[bot] on (2024-11-27 18:30:47 UTC):  This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)

luizarakaki on (2024-12-02 20:02:55 UTC): @swatland610 this was released. Can you confirm it works?

swatland610 (Issue Creator) on (2024-12-03 20:17:21 UTC): @luizarakaki thanks for your help! It looks like it's working great!

"
2684269583,issue,open,,Embedding SDK for Svelte,"**Additional context**
Requested by a prospect
",psalinasy,2024-11-22 19:02:25+00:00,[],2025-02-04 20:30:26+00:00,,https://github.com/metabase/metabase/issues/50416,"[('Type:New Feature', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2684140280,issue,closed,completed,Setting a custom loading message prevents questions from loading in Metabase v51,"### Describe the bug

Setting a custom loading message via `MB_LOADING_MESSAGE` on Metabase v51 EE prevents questions from loading. You get a generic ""Somethings gone wrong"" error instead. The `POST /api/card/:cardId/query` request is canceled by the frontend immediately because of a type error when loading the custom message:

```
TypeError: Cannot read properties of undefined (reading 'value')
```

### To Reproduce

1. Run Metabase v51 EE with a custom loading message, e.g., `MB_LOADING_MESSAGE=""Loading...""`.
2. Create or go to a question. When visualizing, it will error our with ""Somethings gone wrong"".


### Expected behavior

Questions should load when a custom loading message is set.

### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""h2"",
      ""postgres""
    ],
    ""run-mode"": ""dev"",
    ""plan-alias"": ""enterprise-self-hosted"",
    ""version"": {
      ""tag"": ""vLOCAL_DEV"",
      ""hash"": ""06d1ba2ae111e66253209c01c244d6379acfc6dcb1911fa9ab6012cec9ce52e5""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""h2"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""H2"",
        ""version"": ""2.1.214 (2022-06-13)""
      },
      ""jdbc-driver"": {
        ""name"": ""H2 JDBC Driver"",
        ""version"": ""2.1.214 (2022-06-13)""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.2+13-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.2"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.2+13-LTS"",
    ""os.name"": ""Mac OS X"",
    ""os.version"": ""15.0.1"",
    ""user.language"": ""en"",
    ""user.timezone"": ""America/Los_Angeles""
  }
}
```

### Severity

Just annoying since it works by unsetting the env var

### Additional context

I'm running Metabase EE from the git repo, on tag `v1.51.4.3` without any modifications.",eskrm,2024-11-22 18:18:45+00:00,[],2024-11-22 23:44:19+00:00,2024-11-22 22:21:25+00:00,https://github.com/metabase/metabase/issues/50414,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2494596733, 'issue_id': 2684140280, 'author': 'dpsutton', 'body': 'repro:\n\n```shell\nMB_PREMIUM_EMBEDDING_TOKEN=$TOKEN MB_LOADING_MESSAGE=""Loading"" MB_JETTY_PORT=3006 java -jar $JARS/1.51.4.3.jar\n```\n\nError in browser console:\n![Image](https://github.com/user-attachments/assets/e577dfb6-e239-4650-8aab-63734b2bd25f)\n\n![Image](https://github.com/user-attachments/assets/eee7d0f1-5a6d-4b7b-98cb-3c2432f7a895)\n\n```shell\n http get http://localhost:3006/api/session/properties x-api-key:$API_KEY -pb | jq \'.""loading-message""\'\n""Loading""\n```', 'created_at': datetime.datetime(2024, 11, 22, 19, 6, 40, tzinfo=datetime.timezone.utc)}, {'comment_id': 2494976735, 'issue_id': 2684140280, 'author': 'sloansparger', 'body': ""@eskrm unfortunately we don't support a completely custom message via `MB_LOADING_MESSAGE`, it must be an enum value of `doing-science`, `running-query`, or `loading-results`. We've just merged a change that will go out in the next release which makes it clearer that this env variable requires an enum input and prevents the UI from breaking if it's not. In your specific case the `loading-results` option would be closest to your desired message."", 'created_at': datetime.datetime(2024, 11, 22, 22, 27, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2495106096, 'issue_id': 2684140280, 'author': 'eskrm', 'body': ""@sloansparger That's fine, thanks!"", 'created_at': datetime.datetime(2024, 11, 22, 23, 44, 19, tzinfo=datetime.timezone.utc)}]","dpsutton on (2024-11-22 19:06:40 UTC): repro:

```shell
MB_PREMIUM_EMBEDDING_TOKEN=$TOKEN MB_LOADING_MESSAGE=""Loading"" MB_JETTY_PORT=3006 java -jar $JARS/1.51.4.3.jar
```

Error in browser console:
![Image](https://github.com/user-attachments/assets/e577dfb6-e239-4650-8aab-63734b2bd25f)

![Image](https://github.com/user-attachments/assets/eee7d0f1-5a6d-4b7b-98cb-3c2432f7a895)

```shell
 http get http://localhost:3006/api/session/properties x-api-key:$API_KEY -pb | jq '.""loading-message""'
""Loading""
```

sloansparger on (2024-11-22 22:27:58 UTC): @eskrm unfortunately we don't support a completely custom message via `MB_LOADING_MESSAGE`, it must be an enum value of `doing-science`, `running-query`, or `loading-results`. We've just merged a change that will go out in the next release which makes it clearer that this env variable requires an enum input and prevents the UI from breaking if it's not. In your specific case the `loading-results` option would be closest to your desired message.

eskrm (Issue Creator) on (2024-11-22 23:44:19 UTC): @sloansparger That's fine, thanks!

"
2683575767,issue,closed,completed,Unable to Edit or Unpublish Dashboard Embedding Settings (Error 500),"### Describe the bug

I am unable to modify the embedding settings of my dashboard or unpublish it. When I attempt to do so, I consistently encounter a 500 Internal Server Error.

Notably, I recently added a filter of type Time grouping to this dashboard, which might be related to the issue.

![Image](https://github.com/user-attachments/assets/3a94ab14-7f8f-4f68-bbf3-fc8baa4b877e)



### To Reproduce

1. Add a filter of type Time grouping to a dashboard.
2. Attempt to modify the embedding settings or unpublish the dashboard.
3. Observe the 500 error.

### Expected behavior

_No response_

### Logs

[50038ec3-28b3-48e6-ad24-8592d01edf24] 2024-11-22T16:21:06+01:00 ERROR metabase.server.middleware.log PUT /api/dashboard/118 500 17.6 ms (4 DB calls) {:metabase-user-id 1} 
{:via
 [{:type clojure.lang.ExceptionInfo,
   :message "":parameters doit tre une squence de cartes avec les cls :id et :type"",
   :data
   {:parameters
    ({:name ""ID"", :slug ""id"", :id ""6f55ef7f"", :type :id, :sectionId ""id""}
     {:name ""Filtre de date"",
      :slug ""filtre_de_date"",
      :id ""31f86173"",
      :type :date/all-options,
      :sectionId ""date"",
      :default ""past12months""}
     {:name ""Regrouper par"",
      :slug ""regrouper_par"",
      :id ""40dadef6"",
      :type :temporal-unit,
      :sectionId ""temporal-unit"",
      :temporal_units [""minute"" ""day"" ""week"" ""month"" ""quarter"" ""year""],
      :default ""month""}),
    :toucan2/context-trace
    [[""execute SQL with class com.mchange.v2.c3p0.impl.NewProxyConnection""
      {:toucan2.jdbc.query/sql-args [""SELECT * FROM \""report_dashboard\"" WHERE \""id\"" = ?"" 118]}]
     [""resolve connection"" {:toucan2.connection/connectable org.postgresql.jdbc.PgConnection}]
     [""resolve connection"" {:toucan2.connection/connectable nil}]
     {:toucan2.pipeline/rf
      #object[clojure.core$map$fn__5950$fn__5951 0x722ea7db ""clojure.core$map$fn__5950$fn__5951@722ea7db""]}
     [""with compiled query""
      {:toucan2.pipeline/compiled-query [""SELECT * FROM \""report_dashboard\"" WHERE \""id\"" = ?"" 118]}]
     [""with built query""
      {:toucan2.pipeline/built-query {:select [:*], :from [[:report_dashboard]], :where [:= :id 118]}}]
     [""apply before-update to matching rows""
      {:toucan2.tools.before-update/model :model/Dashboard,
       :toucan2.tools.before-update/changes {:enable_embedding false}}]
     [""with resolved query"" {:toucan2.pipeline/resolved-query {}}]
     [""with parsed args""
      {:toucan2.pipeline/query-type :toucan.query-type/update.update-count,
       :toucan2.pipeline/parsed-args {:changes {:enable_embedding false}, :queryable {}, :kv-args {:toucan/pk 118}}}]
     [""with model"" {:toucan2.pipeline/model :model/Dashboard}]
     [""with unparsed args""
      {:toucan2.pipeline/query-type :toucan.query-type/update.update-count,
       :toucan2.pipeline/unparsed-args (:model/Dashboard 118 {:enable_embedding false})}]
     [""resolve connection"" {:toucan2.connection/connectable metabase.db.connection.ApplicationDB}]
     [""resolve connection"" {:toucan2.connection/connectable :default}]
     [""resolve connection"" {:toucan2.connection/connectable nil}]]},
   :at [metabase.models.params$assert_valid_parameters invokeStatic ""params.clj"" 43]}],
 :trace
 [[metabase.models.params$assert_valid_parameters invokeStatic ""params.clj"" 43]
  [metabase.models.params$assert_valid_parameters invoke ""params.clj"" 39]
  [metabase.models.dashboard$before_update_primary_method_model_Dashboard invokeStatic ""dashboard.clj"" 101]
  [metabase.models.dashboard$before_update_primary_method_model_Dashboard invoke ""dashboard.clj"" 97]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.tools.before_update$before_update_around_method_default invokeStatic ""before_update.clj"" 34]
  [toucan2.tools.before_update$before_update_around_method_default invoke ""before_update.clj"" 30]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.tools.before_update$changes__GT_affected_pk_maps_rf$fn__26871 invoke ""before_update.clj"" 54]
  [clojure.core$map$fn__5950$fn__5951 invoke ""core.clj"" 2759]
  [clojure.core$map$fn__5950$fn__5951 invoke ""core.clj"" 2759]
  [toucan2.jdbc.result_set$reduce_result_set invokeStatic ""result_set.clj"" 156]
  [toucan2.jdbc.result_set$reduce_result_set invoke ""result_set.clj"" 125]
  [toucan2.jdbc.query$reduce_jdbc_query invokeStatic ""query.clj"" 51]
  [toucan2.jdbc.query$reduce_jdbc_query invoke ""query.clj"" 22]
  [toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default
   invokeStatic
   ""pipeline.clj""
   19]
  [toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default
   invoke
   ""pipeline.clj""
   9]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 15]
  [methodical.impl.combo.threaded$combine_methods_thread_last$fn__19646$combined_method_thread_last__19647
   invoke
   ""threaded.clj""
   64]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 65]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 216]
  [toucan2.pipeline$transduce_execute$with_connection_STAR___22732 invoke ""pipeline.clj"" 78]
  [toucan2.connection$bind_current_connectable_fn$fn__22409 invoke ""connection.clj"" 104]
  [toucan2.connection$bind_current_connectable_fn$fn__22409 invoke ""connection.clj"" 104]
  [toucan2.jdbc.connection$do_with_connection_primary_method_java_sql_Connection invokeStatic ""connection.clj"" 13]
  [toucan2.jdbc.connection$do_with_connection_primary_method_java_sql_Connection invoke ""connection.clj"" 11]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.connection$do_with_connection_primary_method_ invokeStatic ""connection.clj"" 204]
  [toucan2.connection$do_with_connection_primary_method_ invoke ""connection.clj"" 194]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.pipeline$transduce_execute invokeStatic ""pipeline.clj"" 77]
  [toucan2.pipeline$transduce_execute invoke ""pipeline.clj"" 64]
  [clojure.lang.Var invoke ""Var.java"" 401]
  [toucan2.pipeline$transduce_compiled_query invokeStatic ""pipeline.clj"" 244]
  [toucan2.pipeline$transduce_compiled_query invoke ""pipeline.clj"" 240]
  [toucan2.pipeline$transduce_built_query invokeStatic ""pipeline.clj"" 252]
  [toucan2.pipeline$transduce_built_query invoke ""pipeline.clj"" 246]
  [toucan2.pipeline$transduce_query_primary_method_default invokeStatic ""pipeline.clj"" 272]
  [toucan2.pipeline$transduce_query_primary_method_default invoke ""pipeline.clj"" 269]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 15]
  [methodical.impl.combo.threaded$combine_methods_thread_last$fn__19646$combined_method_thread_last__19647
   invoke
   ""threaded.clj""
   64]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 65]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 216]
  [toucan2.tools.before_update$fetch_changes__GT_pk_maps invokeStatic ""before_update.clj"" 69]
  [toucan2.tools.before_update$fetch_changes__GT_pk_maps invoke ""before_update.clj"" 67]
  [toucan2.tools.before_update$apply_before_update_to_matching_rows invokeStatic ""before_update.clj"" 83]
  [toucan2.tools.before_update$apply_before_update_to_matching_rows invoke ""before_update.clj"" 77]
  [toucan2.tools.before_update$transduce_query_primary_method_toucan_query_type_update__STAR__toucan2_tools_before_update_before_update_default
   invokeStatic
   ""before_update.clj""
   108]
  [toucan2.tools.before_update$transduce_query_primary_method_toucan_query_type_update__STAR__toucan2_tools_before_update_before_update_default
   invoke
   ""before_update.clj""
   94]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 15]
  [methodical.impl.combo.threaded$combine_methods_thread_last$fn__19646$combined_method_thread_last__19647
   invoke
   ""threaded.clj""
   64]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 65]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 216]
  [toucan2.pipeline$transduce_query_STAR_ invokeStatic ""pipeline.clj"" 278]
  [toucan2.pipeline$transduce_query_STAR_ invoke ""pipeline.clj"" 274]
  [toucan2.pipeline$transduce_with_model invokeStatic ""pipeline.clj"" 293]
  [toucan2.pipeline$transduce_with_model invoke ""pipeline.clj"" 280]
  [toucan2.pipeline$transduce_parsed invokeStatic ""pipeline.clj"" 309]
  [toucan2.pipeline$transduce_parsed invoke ""pipeline.clj"" 295]
  [toucan2.pipeline$transduce_unparsed invokeStatic ""pipeline.clj"" 317]
  [toucan2.pipeline$transduce_unparsed invoke ""pipeline.clj"" 311]
  [toucan2.pipeline$transduce_unparsed_with_default_rf invokeStatic ""pipeline.clj"" 374]
  [toucan2.pipeline$transduce_unparsed_with_default_rf invoke ""pipeline.clj"" 368]
  [toucan2.update$update_BANG_ invokeStatic ""update.clj"" 53]
  [toucan2.update$update_BANG_ doInvoke ""update.clj"" 50]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [metabase.api.dashboard$update_dashboard$with_connection_STAR___100950$with_transaction_STAR___100951
   invoke
   ""dashboard.clj""
   794]
  [toucan2.connection$bind_current_connectable_fn$fn__22409 invoke ""connection.clj"" 104]
  [metabase.db.connection$do_transaction$thunk__43458 invoke ""connection.clj"" 140]
  [metabase.db.connection$do_transaction invokeStatic ""connection.clj"" 152]
  [metabase.db.connection$do_transaction invoke ""connection.clj"" 136]
  [metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection invokeStatic ""connection.clj"" 189]
  [metabase.db.connection$do_with_transaction_primary_method_java_sql_Connection invoke ""connection.clj"" 162]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 13]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_transaction_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 249]
  [toucan2.connection$do_with_transaction_around_method_toucan2_connection_default invoke ""connection.clj"" 245]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 13]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 58]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 212]
  [metabase.api.dashboard$update_dashboard$with_connection_STAR___100950 invoke ""dashboard.clj"" 784]
  [toucan2.connection$bind_current_connectable_fn$fn__22409 invoke ""connection.clj"" 104]
  [toucan2.connection$bind_current_connectable_fn$fn__22409 invoke ""connection.clj"" 104]
  [toucan2.connection$bind_current_connectable_fn$fn__22409 invoke ""connection.clj"" 104]
  [toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource invokeStatic ""connection.clj"" 18]
  [toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource invoke ""connection.clj"" 15]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [metabase.db.connection$do_with_connection_primary_method_default invokeStatic ""connection.clj"" 132]
  [metabase.db.connection$do_with_connection_primary_method_default invoke ""connection.clj"" 130]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [toucan2.connection$do_with_connection_primary_method_ invokeStatic ""connection.clj"" 204]
  [toucan2.connection$do_with_connection_primary_method_ invoke ""connection.clj"" 194]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invokeStatic ""connection.clj"" 118]
  [toucan2.connection$do_with_connection_around_method_toucan2_connection_default invoke ""connection.clj"" 106]
  [methodical.impl.combo.common$partial_STAR_$fn__19336 invoke ""common.clj"" 12]
  [methodical.util.FnWithMeta invoke ""util.clj"" 46]
  [methodical.impl.standard$invoke_multifn invokeStatic ""standard.clj"" 55]
  [methodical.impl.standard$invoke_multifn invoke ""standard.clj"" 47]
  [methodical.impl.standard.StandardMultiFn invoke ""standard.clj"" 210]
  [metabase.api.dashboard$update_dashboard invokeStatic ""dashboard.clj"" 784]
  [metabase.api.dashboard$update_dashboard invoke ""dashboard.clj"" 761]
  [metabase.api.dashboard$fn__100975 invokeStatic ""dashboard.clj"" 867]
  [metabase.api.dashboard$fn__100975 invoke ""dashboard.clj"" 861]
  [compojure.core$wrap_response$fn__53909 invoke ""core.clj"" 160]
  [compojure.core$wrap_route_middleware$fn__53893 invoke ""core.clj"" 132]
  [compojure.core$wrap_route_info$fn__53898 invoke ""core.clj"" 139]
  [compojure.core$wrap_route_matches$fn__53902 invoke ""core.clj"" 151]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53902 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53902 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53902 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [metabase.server.middleware.auth$enforce_authentication$fn__102363 invoke ""auth.clj"" 18]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53949 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 300]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 301]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.lang.AFunction$1 doInvoke ""AFunction.java"" 33]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53902 invoke ""core.clj"" 153]
  [clojure.lang.Var invoke ""Var.java"" 395]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [metabase.api.routes$fn__107781$fn__107784 invoke ""routes.clj"" 73]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921 invoke ""core.clj"" 200]
  [clojure.lang.AFn applyToHelper ""AFn.java"" 160]
  [clojure.lang.AFn applyTo ""AFn.java"" 144]
  [clojure.core$apply invokeStatic ""core.clj"" 667]
  [clojure.core$apply invoke ""core.clj"" 662]
  [metabase.server.routes$fn__108061$fn__108062 doInvoke ""routes.clj"" 73]
  [clojure.lang.RestFn invoke ""RestFn.java"" 439]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921 invoke ""core.clj"" 200]
  [compojure.core$make_context$handler__53949 invoke ""core.clj"" 290]
  [compojure.core$make_context$fn__53953 invoke ""core.clj"" 300]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53902 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53902 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53902 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [compojure.core$wrap_route_matches$fn__53902 invoke ""core.clj"" 153]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921$f__53922$respond_SINGLEQUOTE___53923 invoke ""core.clj"" 197]
  [metabase.server.routes$fn__108044$fn__108046 invoke ""routes.clj"" 47]
  [compojure.core$routes$fn__53921$f__53922 invoke ""core.clj"" 198]
  [compojure.core$routes$fn__53921 invoke ""core.clj"" 200]
  [metabase.server.middleware.exceptions$catch_uncaught_exceptions$fn__104488 invoke ""exceptions.clj"" 111]
  [metabase.server.middleware.exceptions$catch_api_exceptions$fn__104485 invoke ""exceptions.clj"" 100]
  [metabase.server.middleware.log$log_api_call$fn__108394$fn__108395$fn__108396 invoke ""log.clj"" 233]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invokeStatic ""diagnostic.clj"" 17]
  [metabase.driver.sql_jdbc.execute.diagnostic$do_with_diagnostic_info invoke ""diagnostic.clj"" 12]
  [metabase.server.middleware.log$log_api_call$fn__108394$fn__108395 invoke ""log.clj"" 224]
  [toucan2.execute$do_with_call_counts invokeStatic ""execute.clj"" 112]
  [toucan2.execute$do_with_call_counts invoke ""execute.clj"" 103]
  [metabase.server.middleware.log$log_api_call$fn__108394 invoke ""log.clj"" 223]
  [metabase.server.middleware.browser_cookie$ensure_browser_id_cookie$fn__111929 invoke ""browser_cookie.clj"" 40]
  [metabase.server.middleware.security$add_security_headers$fn__104444 invoke ""security.clj"" 273]
  [ring.middleware.json$wrap_json_body$fn__112188 invoke ""json.clj"" 64]
  [metabase.server.middleware.offset_paging$handle_paging$fn__93519 invoke ""offset_paging.clj"" 49]
  [metabase.server.middleware.json$wrap_streamed_json_response$fn__55580 invoke ""json.clj"" 88]
  [ring.middleware.keyword_params$wrap_keyword_params$fn__112277 invoke ""keyword_params.clj"" 55]
  [ring.middleware.params$wrap_params$fn__112296 invoke ""params.clj"" 77]
  [metabase.server.middleware.misc$maybe_set_site_url$fn__71681 invoke ""misc.clj"" 59]
  [metabase.server.middleware.session$reset_session_timeout$fn__73486 invoke ""session.clj"" 565]
  [metabase.server.middleware.session$bind_current_user$fn__73452$fn__73453 invoke ""session.clj"" 459]
  [metabase.server.middleware.session$do_with_current_user invokeStatic ""session.clj"" 438]
  [metabase.server.middleware.session$do_with_current_user invoke ""session.clj"" 421]
  [metabase.server.middleware.session$bind_current_user$fn__73452 invoke ""session.clj"" 458]
  [metabase.server.middleware.session$wrap_current_user_info$fn__73429 invoke ""session.clj"" 383]
  [metabase.analytics.sdk$embedding_mw$embedding_mw_fn__77667 invoke ""sdk.clj"" 51]
  [metabase.server.middleware.session$wrap_session_id$fn__73401 invoke ""session.clj"" 261]
  [metabase.server.middleware.auth$wrap_static_api_key$fn__102371 invoke ""auth.clj"" 32]
  [ring.middleware.cookies$wrap_cookies$fn__112116 invoke ""cookies.clj"" 200]
  [metabase.server.middleware.misc$add_content_type$fn__71663 invoke ""misc.clj"" 28]
  [metabase.server.middleware.misc$disable_streaming_buffering$fn__71689 invoke ""misc.clj"" 75]
  [ring.middleware.gzip$wrap_gzip$fn__112158 invoke ""gzip.clj"" 86]
  [metabase.server.middleware.request_id$wrap_request_id$fn__108123 invoke ""request_id.clj"" 9]
  [metabase.server.middleware.misc$bind_request$fn__71692 invoke ""misc.clj"" 91]
  [metabase.server.middleware.ssl$redirect_to_https_middleware$fn__111945 invoke ""ssl.clj"" 51]
  [metabase.server$async_proxy_handler$fn__61871 invoke ""server.clj"" 77]
  [metabase.server.proxy$org.eclipse.jetty.server.handler.AbstractHandler$ff19274a handle nil -1]
  [org.eclipse.jetty.server.handler.StatisticsHandler handle ""StatisticsHandler.java"" 173]
  [org.eclipse.jetty.server.handler.HandlerWrapper handle ""HandlerWrapper.java"" 122]
  [org.eclipse.jetty.server.Server handle ""Server.java"" 563]
  [org.eclipse.jetty.server.HttpChannel$RequestDispatchable dispatch ""HttpChannel.java"" 1598]
  [org.eclipse.jetty.server.HttpChannel dispatch ""HttpChannel.java"" 753]
  [org.eclipse.jetty.server.HttpChannel handle ""HttpChannel.java"" 501]
  [org.eclipse.jetty.server.HttpConnection onFillable ""HttpConnection.java"" 287]
  [org.eclipse.jetty.io.AbstractConnection$ReadCallback succeeded ""AbstractConnection.java"" 314]
  [org.eclipse.jetty.io.FillInterest fillable ""FillInterest.java"" 100]
  [org.eclipse.jetty.io.SelectableChannelEndPoint$1 run ""SelectableChannelEndPoint.java"" 53]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy runTask ""AdaptiveExecutionStrategy.java"" 421]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy consumeTask ""AdaptiveExecutionStrategy.java"" 390]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy tryProduce ""AdaptiveExecutionStrategy.java"" 277]
  [org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy run ""AdaptiveExecutionStrategy.java"" 199]
  [org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread run ""ReservedThreadExecutor.java"" 411]
  [org.eclipse.jetty.util.thread.QueuedThreadPool runJob ""QueuedThreadPool.java"" 969]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner doRunJob ""QueuedThreadPool.java"" 1194]
  [org.eclipse.jetty.util.thread.QueuedThreadPool$Runner run ""QueuedThreadPool.java"" 1149]
  [java.lang.Thread run ""Thread.java"" 1583]],
 :cause "":parameters doit tre une squence de cartes avec les cls :id et :type"",
 :data
 {:parameters
  ({:name ""ID"", :slug ""id"", :id ""6f55ef7f"", :type :id, :sectionId ""id""}
   {:name ""Filtre de date"",
    :slug ""filtre_de_date"",
    :id ""31f86173"",
    :type :date/all-options,
    :sectionId ""date"",
    :default ""past12months""}
   {:name ""Regrouper par"",
    :slug ""regrouper_par"",
    :id ""40dadef6"",
    :type :temporal-unit,
    :sectionId ""temporal-unit"",
    :temporal_units [""minute"" ""day"" ""week"" ""month"" ""quarter"" ""year""],
    :default ""month""}),
  :toucan2/context-trace
  [[""execute SQL with class com.mchange.v2.c3p0.impl.NewProxyConnection""
    {:toucan2.jdbc.query/sql-args [""SELECT * FROM \""report_dashboard\"" WHERE \""id\"" = ?"" 118]}]
   [""resolve connection"" {:toucan2.connection/connectable org.postgresql.jdbc.PgConnection}]
   [""resolve connection"" {:toucan2.connection/connectable nil}]
   {:toucan2.pipeline/rf
    #object[clojure.core$map$fn__5950$fn__5951 0x722ea7db ""clojure.core$map$fn__5950$fn__5951@722ea7db""]}
   [""with compiled query""
    {:toucan2.pipeline/compiled-query [""SELECT * FROM \""report_dashboard\"" WHERE \""id\"" = ?"" 118]}]
   [""with built query"" {:toucan2.pipeline/built-query {:select [:*], :from [[:report_dashboard]], :where [:= :id 118]}}]
   [""apply before-update to matching rows""
    {:toucan2.tools.before-update/model :model/Dashboard,
     :toucan2.tools.before-update/changes {:enable_embedding false}}]
   [""with resolved query"" {:toucan2.pipeline/resolved-query {}}]
   [""with parsed args""
    {:toucan2.pipeline/query-type :toucan.query-type/update.update-count,
     :toucan2.pipeline/parsed-args {:changes {:enable_embedding false}, :queryable {}, :kv-args {:toucan/pk 118}}}]
   [""with model"" {:toucan2.pipeline/model :model/Dashboard}]
   [""with unparsed args""
    {:toucan2.pipeline/query-type :toucan.query-type/update.update-count,
     :toucan2.pipeline/unparsed-args (:model/Dashboard 118 {:enable_embedding false})}]
   [""resolve connection"" {:toucan2.connection/connectable metabase.db.connection.ApplicationDB}]
   [""resolve connection"" {:toucan2.connection/connectable :default}]
   [""resolve connection"" {:toucan2.connection/connectable nil}]]},
 :message "":parameters doit tre une squence de cartes avec les cls :id et :type"",
 :parameters
 ({:name ""ID"", :slug ""id"", :id ""6f55ef7f"", :type :id, :sectionId ""id""}
  {:name ""Filtre de date"",
   :slug ""filtre_de_date"",
   :id ""31f86173"",
   :type :date/all-options,
   :sectionId ""date"",
   :default ""past12months""}
  {:name ""Regrouper par"",
   :slug ""regrouper_par"",
   :id ""40dadef6"",
   :type :temporal-unit,
   :sectionId ""temporal-unit"",
   :temporal_units [""minute"" ""day"" ""week"" ""month"" ""quarter"" ""year""],
   :default ""month""})}

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""fr-FR"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-19"",
      ""tag"": ""v0.51.4"",
      ""hash"": ""47f05f3""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""21.0.5+11-LTS"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""21.0.5"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""21.0.5+11-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.11.6-clevercloud-vm-dirty"",
    ""user.language"": ""en"",
    ""user.timezone"": ""UTC""
  }
}
```

### Severity

blocking your usage

### Additional context

_No response_",maximepvrt,2024-11-22 15:32:41+00:00,[],2024-11-22 18:15:10+00:00,2024-11-22 18:15:09+00:00,https://github.com/metabase/metabase/issues/50408,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2494047135, 'issue_id': 2683575767, 'author': 'maximepvrt', 'body': 'same as #50371 ?', 'created_at': datetime.datetime(2024, 11, 22, 15, 38, 34, tzinfo=datetime.timezone.utc)}, {'comment_id': 2494473819, 'issue_id': 2683575767, 'author': 'ixipixi', 'body': ""@maximepvrt yes - that's the same issue! Thank you for reporting. I'll go ahead and close this now since it's a duplicate."", 'created_at': datetime.datetime(2024, 11, 22, 18, 15, 9, tzinfo=datetime.timezone.utc)}]","maximepvrt (Issue Creator) on (2024-11-22 15:38:34 UTC): same as #50371 ?

ixipixi on (2024-11-22 18:15:09 UTC): @maximepvrt yes - that's the same issue! Thank you for reporting. I'll go ahead and close this now since it's a duplicate.

"
2683357496,issue,open,,Charts legend to highlight a series isn't working on row chart,"### Describe the bug

Click on the bubbles in the chart legend to hide series isn't working on row chart.


### To Reproduce

1. Create a row chart with two metrics
2. Click on the bubbles in the chart legend
3. Nothing happens


### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
v1.51.4
Podman localhost
```

### Severity

P3

### Additional context

_No response_",fer-batista,2024-11-22 14:26:09+00:00,[],2025-02-04 20:31:43+00:00,,https://github.com/metabase/metabase/issues/50406,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Visualization/Charts/Row', ''), ('.Team/DashViz', 'Dashboard and Viz team'), ('Bug:v51', 'bugs or regressions introduced in v51'), ('Visualization/Legend', '')]",[],
2683259220,issue,closed,not_planned,Search box filter not working in dashboards,"### Describe the bug

The search box filter when the filter operator is `Is` is not working.

We have this filter in a column with company names and we would like the filter to allow to search for any company. It doesn't. 

What it looks like it's happening is that the optional filter values are preloaded (as would be expected with a dropdown list, not search box) and when we want to search for a value outside of those, search simply doesn't work.

It works though if the literal value that the filter should returned is copied.

### To Reproduce

Create a dashboard with a filter.

The filter has to be:
- text
- search box
- filter rule: is

Preferably linked to a column with a lot of values (say thousands of values)


### Expected behavior

Search works

### Logs

_No response_

### Information about your Metabase installation

```JSON
- Can reproduce in both Firefox and Chrome

Metabase open source version v0.51.4
```

### Severity

blocking some users

### Additional context

_No response_",clanog,2024-11-22 13:42:30+00:00,['romeovs'],2024-12-18 11:46:15+00:00,2024-12-18 11:46:15+00:00,https://github.com/metabase/metabase/issues/50404,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', '')]","[{'comment_id': 2496603674, 'issue_id': 2683259220, 'author': 'romeovs', 'body': ""@clanog if I understand correctly, the issue is that it's not possible to select values outside of the initially loaded list of values, but the filter _does_ actually filter if the value to be selected is inside that list?\n\nIf so I this is a duplicate (or very similar to) of https://github.com/metabase/metabase/issues/49642. If that is the case it will have been fixed by https://github.com/metabase/metabase/pull/49739).\n\nIf not, please share some more information about what exactly is not working."", 'created_at': datetime.datetime(2024, 11, 25, 3, 29, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2497288149, 'issue_id': 2683259220, 'author': 'clanog', 'body': ""Yes it is a duplicate, sorry for duplicating - I couldn't find it.\nI see it's fixed but not yet released, right?"", 'created_at': datetime.datetime(2024, 11, 25, 8, 45, 19, tzinfo=datetime.timezone.utc)}, {'comment_id': 2550248380, 'issue_id': 2683259220, 'author': 'romeovs', 'body': 'This was released in [v52.1](https://github.com/metabase/metabase/releases/tag/v0.52.1).\n\nPlease close the issue if this resolved your issue.', 'created_at': datetime.datetime(2024, 12, 18, 3, 39, 56, tzinfo=datetime.timezone.utc)}]","romeovs (Assginee) on (2024-11-25 03:29:29 UTC): @clanog if I understand correctly, the issue is that it's not possible to select values outside of the initially loaded list of values, but the filter _does_ actually filter if the value to be selected is inside that list?

If so I this is a duplicate (or very similar to) of https://github.com/metabase/metabase/issues/49642. If that is the case it will have been fixed by https://github.com/metabase/metabase/pull/49739).

If not, please share some more information about what exactly is not working.

clanog (Issue Creator) on (2024-11-25 08:45:19 UTC): Yes it is a duplicate, sorry for duplicating - I couldn't find it.
I see it's fixed but not yet released, right?

romeovs (Assginee) on (2024-12-18 03:39:56 UTC): This was released in [v52.1](https://github.com/metabase/metabase/releases/tag/v0.52.1).

Please close the issue if this resolved your issue.

"
2683066965,issue,closed,not_planned,Permissions to access questions data,"### Describe the bug

Why is the ""Data Access"" tab no longer visible in the latest version of Metabase, which used to indicate whether a group/user had access to table data?

I need to filter a group to allow them to view the drill-down of a question only, without being able to edit the original query.

In a previous version, I can still see this option.


![Image](https://github.com/user-attachments/assets/89e12a22-5a20-4a42-bb8c-2bca1ee355b9)


### To Reproduce

1. Go to admin
2. Click on permissions
3. Scroll down to Data -> Groups
4. See error


### Expected behavior

![Image](https://github.com/user-attachments/assets/87b4a0ec-bc6e-40dc-a848-93d375654f6d)


### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""pt-PT"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""clickhouse"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-13"",
      ""tag"": ""v0.51.3.3"",
      ""hash"": ""cd3e26b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.1 (Debian 15.1-1.pgdg110+1)""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-91-generic"",
    ""user.language"": ""en"",
    ""user.timezone"": ""Europe/Lisbon""
  }
}
```

### Severity

High

### Additional context

_No response_",francisco-mooddie,2024-11-22 12:33:46+00:00,[],2024-11-22 15:10:29+00:00,2024-11-22 14:30:25+00:00,https://github.com/metabase/metabase/issues/50402,"[('Type:Bug', 'Product defects'), ('Administration/Permissions', 'Collection or Data permissions'), ('.Needs Triage', ''), ('.Team/AdminWebapp', 'Admin and Webapp team')]","[{'comment_id': 2493894906, 'issue_id': 2683066965, 'author': 'luizarakaki', 'body': '`No self-service` has the exact same behavior as Create queries: `No`. There was no change there.\nThere are more information about the changes in the permission system on our docs.', 'created_at': datetime.datetime(2024, 11, 22, 14, 30, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2493977738, 'issue_id': 2683066965, 'author': 'francisco-mooddie', 'body': '@luizarakaki But when I had unrestricted access, I could view the data behind the query, and now I cant, even if I gave all permissions to all users like administrator.\n\n![Image](https://github.com/user-attachments/assets/c3918598-a29b-4a23-a581-91be7d2b8752)\n\n![Image](https://github.com/user-attachments/assets/cb0853ef-6b86-4ce4-b02c-bc3398ac72b4)', 'created_at': datetime.datetime(2024, 11, 22, 15, 10, 28, tzinfo=datetime.timezone.utc)}]","luizarakaki on (2024-11-22 14:30:25 UTC): `No self-service` has the exact same behavior as Create queries: `No`. There was no change there.
There are more information about the changes in the permission system on our docs.

francisco-mooddie (Issue Creator) on (2024-11-22 15:10:28 UTC): @luizarakaki But when I had unrestricted access, I could view the data behind the query, and now I cant, even if I gave all permissions to all users like administrator.

![Image](https://github.com/user-attachments/assets/c3918598-a29b-4a23-a581-91be7d2b8752)

![Image](https://github.com/user-attachments/assets/cb0853ef-6b86-4ce4-b02c-bc3398ac72b4)

"
2682719021,issue,closed,completed,"SDK crashes with ""Stage 1 does not exist"" when Summarize component is rendered","The `<Summarize />` component is crashing the SDK with ""Stage 1 does not exist"" in the [latest release](https://github.com/metabase/metabase/pull/49901), this seems to be thrown inside the `SummarizeAggregationItemList` component.

## How to reproduce

Go to an interactive question's default view. Click on _Summarize_.

This happens in both Storybook's default `InteractiveQuestionResult` view and in Shoppy (go to https://embedded-analytics-sdk-demo.metabase.com/admin/products/19, click on a chart and click on Summarize).

## Stacktrace

Error is `Uncaught #error {:message ""Stage 1 does not exist"", :data {:num-stages 1}}`

<img src=""https://github.com/user-attachments/assets/b1f2996d-bfca-4aa4-b328-bdff3366a0d1"" width=""300"">
",heypoom,2024-11-22 10:20:05+00:00,['heypoom'],2024-11-22 16:33:54+00:00,2024-11-22 15:15:53+00:00,https://github.com/metabase/metabase/issues/50398,"[('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]",[],
2682642178,issue,closed,completed,Replace public-facing type prefixes in the sdk to Metabase,"We have [3 public-facing prefixes](https://www.notion.so/Tech-Review-SDK-s-API-surface-and-propose-adjustments-13e69354c90180a7974fe78c1afce3a1?d=13e69354c901804a912c001cd7233a3b&pvs=4#13e69354c90180bcbb91c606b625ff9f) in our types now: SDK, Metabase and Sdk.

Let's rename every exported, public-facing type to use the Metabase prefix. For types that are also used internally in the Metabase app, we re-export an alias with the Metabase prefix.",heypoom,2024-11-22 09:44:39+00:00,['heypoom'],2024-12-18 14:55:45+00:00,2024-12-09 19:33:16+00:00,https://github.com/metabase/metabase/issues/50396,"[('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2551538187, 'issue_id': 2682642178, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)', 'created_at': datetime.datetime(2024, 12, 18, 14, 55, 43, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-18 14:55:43 UTC):  This should also be released by [v0.52.4](https://github.com/metabase/metabase/milestone/294)

"
2682638178,issue,closed,completed,[Epic] Adjust Embedding SDK's API surface before GA,"**Links**
- [product doc](https://www.notion.so/metabase/Review-SDK-API-surface-and-adjust-as-needed-13b69354c9018027bba3d58b8db5ff5f?pvs=4)
- [eng doc](https://www.notion.so/metabase/Tech-Review-SDK-s-API-surface-and-propose-adjustments-13e69354c90180a7974fe78c1afce3a1?pvs=4)

**Implementation Plan**

***Milestone 1***
```[tasklist]
### Tasks
- [ ] https://github.com/metabase/metabase/issues/50563
- [ ] https://github.com/metabase/metabase/issues/50495
- [ ] https://github.com/metabase/metabase/issues/50005
- [ ] https://github.com/metabase/metabase/issues/50492
- [ ] https://github.com/metabase/metabase/issues/50491
- [ ] https://github.com/metabase/metabase/issues/50490
- [ ] https://github.com/metabase/metabase/issues/50487
- [ ] https://github.com/metabase/metabase/issues/50505
- [ ] https://github.com/metabase/metabase/issues/50493
- [ ] https://github.com/metabase/metabase/issues/50489
- [ ] https://github.com/metabase/metabase/issues/50486
- [ ] https://github.com/metabase/metabase/issues/50396
- [ ] https://github.com/metabase/metabase/issues/50567
```

",heypoom,2024-11-22 09:42:50+00:00,['heypoom'],2024-12-09 19:35:48+00:00,2024-12-09 19:35:46+00:00,https://github.com/metabase/metabase/issues/50395,"[('.Epic', 'Feature Implementation or Project')]","[{'comment_id': 2529220563, 'issue_id': 2682638178, 'author': 'heypoom', 'body': ""Closing epic as every PR here is merged. Note that we're pending the backports to 51, as all SDK releases uses the 51 branch."", 'created_at': datetime.datetime(2024, 12, 9, 19, 35, 46, tzinfo=datetime.timezone.utc)}]","heypoom (Issue Creator) on (2024-12-09 19:35:46 UTC): Closing epic as every PR here is merged. Note that we're pending the backports to 51, as all SDK releases uses the 51 branch.

"
2682620114,issue,closed,completed,"Make entity picker's placeholder, chevron and search picker color themeable in embedding sdk","Based on https://github.com/metabase/metabase/pull/50299, there are still a couple of visual theming issues:

- Placeholder color is always white on load
- The right chevron icon on the collection picker is always black
- The ""Search Everywhere / Our Analytics"" selector is not yet themed

![CleanShot 2567-11-21 at 03 02 06@2x](https://github.com/user-attachments/assets/cf237ed5-bbb4-4520-add4-53375615211c)

![CleanShot 2567-11-21 at 03 02 18@2x](https://github.com/user-attachments/assets/87e7be0f-bbd2-42e1-9ff4-e79351c2a829)
",heypoom,2024-11-22 09:37:02+00:00,['heypoom'],2024-12-03 10:05:54+00:00,2024-11-27 17:27:14+00:00,https://github.com/metabase/metabase/issues/50394,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2514097168, 'issue_id': 2682620114, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 12, 3, 10, 5, 53, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-03 10:05:53 UTC):  This should also be released by [v0.52](https://github.com/metabase/metabase/milestone/283)

"
2682474010,issue,closed,completed,[Epic] Improve InteractiveQuestion and InteractiveDashboard sdk component (Part 2),"These are non-blocking improvements or features for InteractiveQuestion and InteractiveDashboard that can be done after the GA release. They do not cause breaking changes in the API.

**Links**
- product docs:
- [Improvements to Question and Dashboard SDK components](https://www.notion.so/metabase/Improvements-to-Question-and-Dashboard-SDK-components-12469354c90180acbdbcdb8cfeecc455?pvs=4)
- [Make low-hanging fruit improvements to Shoppy](https://www.notion.so/metabase/Make-low-hanging-fruit-improvements-to-Shoppy-12a69354c9018011be49edf18852c7c0?pvs=4)
- eng doc: [improving the question components querying experience for embedding sdk](https://www.notion.so/metabase/Tech-Improving-the-question-component-s-querying-experience-for-embedding-sdk-13169354c901802582a8ca9389c544bd?pvs=4)

**Milestone 1**
```[tasklist]
### Tasks
- [ ] https://github.com/metabase/metabase/issues/49902
- [ ] https://github.com/metabase/metabase/issues/50456
- [ ] https://github.com/metabase/metabase/issues/50007
```

**Polish Interactive Question**
```[tasklist]
### Tasks
- [ ] https://github.com/metabase/metabase/issues/50999
- [x] Change ChartSettingsDropdown `Nonsensible` label to `Other charts`
- [x] Ensure that only the notebook editor _or_ the toolbar is visible
- [x] Make sure visualization height is 100% when used in InteractiveDashboard
- [x] Provide style props for Filter, Summarize, and Breakout pickers
- [x] Change `Question` to `Exploration` in the Interactive Question save modal
```

Related Epics:
- https://github.com/metabase/metabase/issues/51810",heypoom,2024-11-22 08:59:39+00:00,[],2025-01-16 12:11:30+00:00,2025-01-16 12:11:30+00:00,https://github.com/metabase/metabase/issues/50393,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2587721121, 'issue_id': 2682474010, 'author': 'heypoom', 'body': '@NevRA reviewed and closed 2 issues from this epic, and moved https://github.com/metabase/metabase/issues/49831 to another epic as it is more difficult to tackle and not an immediate issue.', 'created_at': datetime.datetime(2025, 1, 13, 17, 19, 24, tzinfo=datetime.timezone.utc)}]","heypoom (Issue Creator) on (2025-01-13 17:19:24 UTC): @NevRA reviewed and closed 2 issues from this epic, and moved https://github.com/metabase/metabase/issues/49831 to another epic as it is more difficult to tackle and not an immediate issue.

"
2682467208,issue,open,,Metabase dashboard filter - Not working properly when linked to another dashboard filter,"**Describe the bug**
Hi ! I'm having one major issue using Metabase dashboard filter, here is my use case :
Based **on a school ID**, I want to **display a dropdown list of student**, **only students linked to that specific School_ID should be displayed** as a dropdown result.

Metabase setup : I have a School_ID dashboard filter and a student dashboard filter : 
![Image](https://github.com/user-attachments/assets/3307e58d-d39d-487e-b72c-0b5c3b006039)
![Image](https://github.com/user-attachments/assets/21a2aab9-eff0-4ad2-a2b7-ec005870a306)

However when **I link my student dashboard filter as a dropdown or a search box to my School_ID dashboard filter, my dropdown list is empty** : 
![Image](https://github.com/user-attachments/assets/03e0f7af-0150-406e-89e2-70c7e1367ec4)
![Image](https://github.com/user-attachments/assets/c5633eaf-c6b9-4ab8-84da-84bce1a0436a)

Based on that specific School_ID I should retrieve a ""Test"" student (It exists in the database), note that if the Student filter is a input box then it works just fine : 


The dropdown filter itself works fine when I don't link it to my School_ID filter : 
![Image](https://github.com/user-attachments/assets/d76bad72-a078-46d2-af71-023313aa0062)

I raised the issue on Metabase forum but didn't find a solution to it : 
- https://discourse.metabase.com/t/dashboard-filters-linked-filters/158856 

If someone has any lead regarding what cause this to happens, the issue is a major one for our own customers and will probably lead to us not using Metabase.

Thanks !

**To Reproduce**
Steps to reproduce the behavior:
1. Setup two dashboard filters, School_ID and Students
2. Link the Student filter to the School_ID, set the Student filter as either a dropdown or a search box
3. Student fitler should display dropdown results based on the School_ID available students
4. Nothing is displayed

**Expected behavior**
A clear and concise description of what you expected to happen.

**Screenshots**
If applicable, add screenshots to help explain your problem.

**Severity**
Major issue, our customers have long lists of students, being able to quickly find them using the dropdown/search feature is a must-have.

**Additional context**

**Metabase Diagnostic Info**

```json
{
  ""browser-info"": {
    ""language"": ""fr-FR"",
    ""platform"": ""Win32"",
    ""userAgent"": ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": ""starter"",
    ""version"": {
      ""date"": ""2024-11-20"",
      ""tag"": ""v1.51.4.2"",
      ""hash"": ""520c873""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres""
  }
}
```",Sabrasse,2024-11-22 08:57:25+00:00,[],2024-11-22 13:50:24+00:00,,https://github.com/metabase/metabase/issues/50392,[],"[{'comment_id': 2493815141, 'issue_id': 2682467208, 'author': 'Tony-metabase', 'body': ""Closing this since we are looking at it internally. 99.99% it's a user error not a bug but if it is a bug we will open another one specifically"", 'created_at': datetime.datetime(2024, 11, 22, 13, 50, 23, tzinfo=datetime.timezone.utc)}]","Tony-metabase on (2024-11-22 13:50:23 UTC): Closing this since we are looking at it internally. 99.99% it's a user error not a bug but if it is a bug we will open another one specifically

"
2681659593,issue,open,,How to develop and debug the backend of metabase in vscodeor IDEA,"I want to develop a driver for metabase, and I have now set up my development environment in WSL and successfully run metabase by typing commands on the command line.
Now I want to configure vscode (or IDEA) to debug and develop metabase, so that I can check my syntax errors at any time, and debug through a graphical interface (add breakpoints, see the values of variables), which are very convenient and efficient
However, I did not find the configuration method in the official documentation, and there are very few tutorials about vscode(or IDEA) configuring and debugging clojure on the Web
Does anyone know how to configure and use vscode(or IDEA) to debug the backend of metabase? thanks",Mine-Echo,2024-11-22 03:31:57+00:00,[],2024-11-22 03:31:57+00:00,,https://github.com/metabase/metabase/issues/50385,[],[],
2681560395,issue,closed,completed,"an exception occurred while mb syncs table structure everyday , 2 dbs and 2 same table names with different structure","### Describe the bug

![Image](https://github.com/user-attachments/assets/ae728ab8-8189-40c7-9a5c-f46e68750778)
an exception occurred while mb syncs table structure everyday
more details:
1. mb version is 0.51.3
2. source db is mysql 5.7.28 , one instace
3. most important , mysql instance has 2 dbs ,  both have same table 't_nursing_record' ,  and they have 5 same fields , 3 are different , I think this is the reason

I guess adding database filter to where clause will fix the problem

one other suggestion : in general one MySQL instance has more then one db , change database field from required to optional where there will be reduce db connections in adding database page , espically in big data applications there will benefit from this change

### To Reproduce

1. Go to 'database'
2. Click on 'hgs'
3. Scroll down to 't_nursing_record' table, click on it
4. See error
![Image](https://github.com/user-attachments/assets/7436f180-5c0c-4cb5-88c3-8719535e9a04)


### Expected behavior

no exception

### Logs

2024-11-22 10:17:07,233 WARN sync.util :: Error fingerprinting Table 211 ''t_nursing_record''
clojure.lang.ExceptionInfo: (conn=14917287) Unknown column 't_nursing_record.memo' in 'field list' {:driver :mysql, :sql [""-- Metabase"" ""SELECT"" ""  SUBSTRING(`t_nursing_record`.`memo`, 1, 1234) AS `substring107908`"" ""FROM"" ""  `t_nursing_record`"" ""LIMIT"" ""  10000""], :params nil, :type :invalid-query}
	at metabase.driver.sql_jdbc.execute$execute_reducible_query$fn__87286$fn__87287.invoke(execute.clj:717)
	at metabase.driver.sql_jdbc.execute$execute_reducible_query$fn__87286.invoke(execute.clj:714)
	at metabase.driver.sql_jdbc.execute$fn__87090$fn__87091.invoke(execute.clj:398)
	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87060__87061.invokeStatic(execute.clj:338)
	at metabase.driver.sql_jdbc.execute$do_with_resolved_connection87060__87061.invoke(execute.clj:321)
	at metabase.driver.sql_jdbc.execute$fn__87090.invokeStatic(execute.clj:392)
	at metabase.driver.sql_jdbc.execute$fn__87090.invoke(execute.clj:390)
	at clojure.lang.MultiFn.invoke(MultiFn.java:244)
	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)
	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)
	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)
	at metabase.driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)
	at metabase.driver.sql_jdbc$fn__113432.invokeStatic(sql_jdbc.clj:79)
	at metabase.driver.sql_jdbc$fn__113432.invoke(sql_jdbc.clj:77)
	at clojure.lang.MultiFn.invoke(MultiFn.java:244)
	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:47)
	at metabase.query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:34)
	at metabase.query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:97)
	at metabase.query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:90)
	at metabase.query_processor.execute$run.invokeStatic(execute.clj:62)
	at metabase.query_processor.execute$run.invoke(execute.clj:56)
	at metabase.query_processor.middleware.update_used_cards$update_used_cards_BANG_76957__76958$fn__76959.invoke(update_used_cards.clj:60)
	at metabase.query_processor.execute$add_native_form_to_result_metadata$fn__76974.invoke(execute.clj:25)
	at metabase.query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__76980.invoke(execute.clj:36)
	at metabase.query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___76930.invoke(cache.clj:241)
	at metabase.query_processor.middleware.permissions$check_query_permissions$fn__73967.invoke(permissions.clj:147)
	at metabase.query_processor.middleware.enterprise$check_download_permissions_middleware$fn__74678.invoke(enterprise.clj:51)
	at metabase.query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__74688.invoke(enterprise.clj:64)
	at metabase.query_processor.execute$execute77007__77008$fn__77009.invoke(execute.clj:94)
	at metabase.query_processor.setup$do_with_qp_setup75203__75204.invokeStatic(setup.clj:225)
	at metabase.query_processor.setup$do_with_qp_setup75203__75204.invoke(setup.clj:216)
	at metabase.query_processor.execute$execute77007__77008.invokeStatic(execute.clj:93)
	at metabase.query_processor.execute$execute77007__77008.invoke(execute.clj:89)
	at metabase.query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)
	at metabase.query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)
	at metabase.query_processor.middleware.enterprise$fn__74705$handle_audit_app_internal_queries__74706$fn__74708.invoke(enterprise.clj:96)
	at metabase.query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__74716.invoke(enterprise.clj:103)
	at metabase.query_processor.middleware.process_userland_query$process_userland_query_middleware77863__77864$fn__77865.invoke(process_userland_query.clj:191)
	at metabase.query_processor.middleware.catch_exceptions$catch_exceptions77928__77929$fn__77930.invoke(catch_exceptions.clj:125)
	at metabase.query_processor$process_query77969__77970$fn__77971.invoke(query_processor.clj:80)
	at metabase.query_processor.setup$do_with_canceled_chan75198__75199$fn__75200.invoke(setup.clj:189)
	at metabase.query_processor.setup$do_with_database_local_settings75191__75192$fn__75193.invoke(setup.clj:181)
	at metabase.query_processor.setup$do_with_driver75184__75185$fn__75186$fn__75187.invoke(setup.clj:166)
	at metabase.driver$do_with_driver.invokeStatic(driver.clj:106)
	at metabase.driver$do_with_driver.invoke(driver.clj:101)
	at metabase.query_processor.setup$do_with_driver75184__75185$fn__75186.invoke(setup.clj:165)
	at metabase.query_processor.setup$do_with_metadata_provider75175__75176$fn__75177.invoke(setup.clj:140)
	at metabase.query_processor.setup$do_with_resolved_database75165__75166$fn__75167.invoke(setup.clj:128)
	at metabase.query_processor.setup$do_with_qp_setup75203__75204.invokeStatic(setup.clj:232)
	at metabase.query_processor.setup$do_with_qp_setup75203__75204.invoke(setup.clj:216)
	at metabase.query_processor$process_query77969__77970.invokeStatic(query_processor.clj:78)
	at metabase.query_processor$process_query77969__77970.invoke(query_processor.clj:71)
	at metabase.db.metadata_queries$table_rows_sample80859__80860.invokeStatic(metadata_queries.clj:181)
	at metabase.db.metadata_queries$table_rows_sample80859__80860.invoke(metadata_queries.clj:164)
	at metabase.db.metadata_queries$fn__80862.invokeStatic(metadata_queries.clj:185)
	at metabase.db.metadata_queries$fn__80862.invoke(metadata_queries.clj:183)
	at clojure.lang.MultiFn.invoke(MultiFn.java:252)
	at metabase.sync.analyze.fingerprint$fingerprint_table_BANG_90769__90770.invokeStatic(fingerprint.clj:88)
	at metabase.sync.analyze.fingerprint$fingerprint_table_BANG_90769__90770.invoke(fingerprint.clj:65)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_BANG_90818__90819$fn__90820.invoke(fingerprint.clj:206)
	at metabase.sync.util$do_with_error_handling.invokeStatic(util.clj:191)
	at metabase.sync.util$do_with_error_handling.invoke(util.clj:184)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_BANG_90818__90819.invokeStatic(fingerprint.clj:204)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_BANG_90818__90819.invoke(fingerprint.clj:198)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_for_db_BANG__STAR_90826__90827$fn__90828$fn__90829.invoke(fingerprint.clj:230)
	at clojure.core$completing$fn__8558.invoke(core.clj:7010)
	at clojure.core$map$fn__5950$fn__5951.invoke(core.clj:2759)
	at toucan2.pipeline$with_init$fn__22812.invoke(pipeline.clj:327)
	at clojure.core$completing$fn__8558.invoke(core.clj:7010)
	at clojure.core$map$fn__5950$fn__5951.invoke(core.clj:2759)
	at toucan2.jdbc.result_set$reduce_result_set.invokeStatic(result_set.clj:156)
	at toucan2.jdbc.result_set$reduce_result_set.invoke(result_set.clj:125)
	at toucan2.jdbc.query$reduce_jdbc_query.invokeStatic(query.clj:51)
	at toucan2.jdbc.query$reduce_jdbc_query.invoke(query.clj:22)
	at toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default.invokeStatic(pipeline.clj:19)
	at toucan2.jdbc.pipeline$transduce_execute_with_connection_primary_method_java_sql_Connection_default_default.invoke(pipeline.clj:9)
	at methodical.impl.combo.common$partial_STAR_$fn__19336.invoke(common.clj:15)
	at methodical.impl.combo.threaded$combine_methods_thread_last$fn__19646$combined_method_thread_last__19647.invoke(threaded.clj:64)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:65)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:216)
	at toucan2.pipeline$transduce_execute$with_connection_STAR___22732.invoke(pipeline.clj:78)
	at toucan2.connection$bind_current_connectable_fn$fn__22409.invoke(connection.clj:104)
	at toucan2.connection$bind_current_connectable_fn$fn__22409.invoke(connection.clj:104)
	at toucan2.connection$bind_current_connectable_fn$fn__22409.invoke(connection.clj:104)
	at toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource.invokeStatic(connection.clj:18)
	at toucan2.jdbc.connection$do_with_connection_primary_method_javax_sql_DataSource.invoke(connection.clj:15)
	at methodical.impl.combo.common$partial_STAR_$fn__19336.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106)
	at methodical.impl.combo.common$partial_STAR_$fn__19336.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210)
	at metabase.db.connection$do_with_connection_primary_method_default.invokeStatic(connection.clj:132)
	at metabase.db.connection$do_with_connection_primary_method_default.invoke(connection.clj:130)
	at methodical.impl.combo.common$partial_STAR_$fn__19336.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106)
	at methodical.impl.combo.common$partial_STAR_$fn__19336.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210)
	at toucan2.connection$do_with_connection_primary_method_.invokeStatic(connection.clj:204)
	at toucan2.connection$do_with_connection_primary_method_.invoke(connection.clj:194)
	at methodical.impl.combo.common$partial_STAR_$fn__19336.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invokeStatic(connection.clj:118)
	at toucan2.connection$do_with_connection_around_method_toucan2_connection_default.invoke(connection.clj:106)
	at methodical.impl.combo.common$partial_STAR_$fn__19336.invoke(common.clj:12)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:55)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:210)
	at toucan2.pipeline$transduce_execute.invokeStatic(pipeline.clj:77)
	at toucan2.pipeline$transduce_execute.invoke(pipeline.clj:64)
	at clojure.lang.Var.invoke(Var.java:401)
	at toucan2.pipeline$transduce_compiled_query.invokeStatic(pipeline.clj:244)
	at toucan2.pipeline$transduce_compiled_query.invoke(pipeline.clj:240)
	at toucan2.pipeline$transduce_built_query.invokeStatic(pipeline.clj:252)
	at toucan2.pipeline$transduce_built_query.invoke(pipeline.clj:246)
	at toucan2.pipeline$transduce_query_primary_method_default.invokeStatic(pipeline.clj:272)
	at toucan2.pipeline$transduce_query_primary_method_default.invoke(pipeline.clj:269)
	at methodical.impl.combo.common$partial_STAR_$fn__19336.invoke(common.clj:15)
	at methodical.impl.combo.threaded$combine_methods_thread_last$fn__19646$combined_method_thread_last__19647.invoke(threaded.clj:64)
	at methodical.util.FnWithMeta.invoke(util.clj:46)
	at methodical.impl.standard$invoke_multifn.invokeStatic(standard.clj:65)
	at methodical.impl.standard$invoke_multifn.invoke(standard.clj:47)
	at methodical.impl.standard.StandardMultiFn.invoke(standard.clj:216)
	at toucan2.pipeline$transduce_query_STAR_.invokeStatic(pipeline.clj:278)
	at toucan2.pipeline$transduce_query_STAR_.invoke(pipeline.clj:274)
	at toucan2.pipeline$transduce_with_model.invokeStatic(pipeline.clj:293)
	at toucan2.pipeline$transduce_with_model.invoke(pipeline.clj:280)
	at toucan2.pipeline$transduce_parsed.invokeStatic(pipeline.clj:309)
	at toucan2.pipeline$transduce_parsed.invoke(pipeline.clj:295)
	at toucan2.pipeline$transduce_unparsed.invokeStatic(pipeline.clj:317)
	at toucan2.pipeline$transduce_unparsed.invoke(pipeline.clj:311)
	at clojure.lang.AFn.applyToHelper(AFn.java:160)
	at clojure.lang.AFn.applyTo(AFn.java:144)
	at clojure.core$apply.invokeStatic(core.clj:669)
	at clojure.core$apply.invoke(core.clj:662)
	at toucan2.pipeline$reducible_fn$reify__22832.reduce(pipeline.clj:386)
	at clojure.core$transduce.invokeStatic(core.clj:7025)
	at clojure.core.Eduction.reduce(core.clj:7874)
	at clojure.core$reduce.invokeStatic(core.clj:6964)
	at clojure.core$reduce.invoke(core.clj:6947)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_for_db_BANG__STAR_90826__90827$fn__90828.invoke(fingerprint.clj:228)
	at metabase.query_processor.store$do_with_metadata_provider58710__58711.invokeStatic(store.clj:170)
	at metabase.query_processor.store$do_with_metadata_provider58710__58711.invoke(store.clj:150)
	at metabase.query_processor.store$do_with_metadata_provider58710__58711.invokeStatic(store.clj:159)
	at metabase.query_processor.store$do_with_metadata_provider58710__58711.invoke(store.clj:150)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_for_db_BANG__STAR_90826__90827.invokeStatic(fingerprint.clj:224)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_for_db_BANG__STAR_90826__90827.invoke(fingerprint.clj:215)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_for_db_BANG__STAR_90826__90827.invokeStatic(fingerprint.clj:219)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_for_db_BANG__STAR_90826__90827.invoke(fingerprint.clj:215)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_for_db_BANG_90833__90834.invokeStatic(fingerprint.clj:242)
	at metabase.sync.analyze.fingerprint$fingerprint_fields_for_db_BANG_90833__90834.invoke(fingerprint.clj:237)
	at metabase.sync.analyze$make_analyze_steps$fn__90984.invoke(analyze.clj:100)
	at clojure.lang.AFn.applyToHelper(AFn.java:154)
	at clojure.lang.AFn.applyTo(AFn.java:144)
	at clojure.core$apply.invokeStatic(core.clj:669)
	at clojure.core$apply.invoke(core.clj:662)
	at metabase.sync.util$run_step_with_metadata65871__65873$fn__65875$fn__65878.invoke(util.clj:495)
	at metabase.models.task_history$do_with_task_history65708__65709.invokeStatic(task_history.clj:121)
	at metabase.models.task_history$do_with_task_history65708__65709.invoke(task_history.clj:109)
	at metabase.sync.util$run_step_with_metadata65871__65873$fn__65875.doInvoke(util.clj:488)
	at clojure.lang.RestFn.invoke(RestFn.java:400)
	at metabase.sync.util$with_start_and_finish_logging_STAR_.invokeStatic(util.clj:132)
	at metabase.sync.util$with_start_and_finish_logging_STAR_.invoke(util.clj:126)
	at metabase.sync.util$do_with_start_and_finish_debug_logging.invokeStatic(util.clj:150)
	at metabase.sync.util$do_with_start_and_finish_debug_logging.invoke(util.clj:146)
	at metabase.sync.util$run_step_with_metadata65871__65873.invokeStatic(util.clj:482)
	at metabase.sync.util$run_step_with_metadata65871__65873.invoke(util.clj:477)
	at metabase.sync.util$run_sync_operation65921__65922$fn__65923$fn__65931.invoke(util.clj:568)
	at metabase.sync.util$run_sync_operation65921__65922$fn__65923.invoke(util.clj:566)
	at metabase.models.task_history$do_with_task_history65708__65709.invokeStatic(task_history.clj:121)
	at metabase.models.task_history$do_with_task_history65708__65709.invoke(task_history.clj:109)
	at metabase.sync.util$run_sync_operation65921__65922.invokeStatic(util.clj:563)
	at metabase.sync.util$run_sync_operation65921__65922.invoke(util.clj:558)
	at metabase.sync.analyze$analyze_db_BANG_90991__90992$fn__90993.invoke(analyze.clj:116)
	at metabase.sync.util$do_with_error_handling.invokeStatic(util.clj:191)
	at metabase.sync.util$do_with_error_handling.invoke(util.clj:184)
	at clojure.core$partial$fn__5929.invoke(core.clj:2647)
	at metabase.driver$fn__58386.invokeStatic(driver.clj:892)
	at metabase.driver$fn__58386.invoke(driver.clj:892)
	at clojure.lang.MultiFn.invoke(MultiFn.java:239)
	at metabase.sync.util$sync_in_context$fn__65780.invoke(util.clj:167)
	at metabase.sync.util$with_db_logging_disabled$fn__65777.invoke(util.clj:159)
	at metabase.sync.util$with_start_and_finish_logging_STAR_.invokeStatic(util.clj:132)
	at metabase.sync.util$with_start_and_finish_logging_STAR_.invoke(util.clj:126)
	at metabase.sync.util$with_start_and_finish_logging$fn__65764.invoke(util.clj:144)
	at metabase.sync.util$with_sync_events65754__65755$fn__65759.invoke(util.clj:118)
	at metabase.sync.util$with_duplicate_ops_prevented$fn__65744.invoke(util.clj:90)
	at metabase.sync.util$do_sync_operation65795__65796.invokeStatic(util.clj:216)
	at metabase.sync.util$do_sync_operation65795__65796.invoke(util.clj:210)
	at metabase.sync.analyze$analyze_db_BANG_90991__90992.invokeStatic(analyze.clj:114)
	at metabase.sync.analyze$analyze_db_BANG_90991__90992.invoke(analyze.clj:109)
	at metabase.task.sync_databases$sync_and_analyze_database_STAR__BANG_.invokeStatic(sync_databases.clj:91)
	at metabase.task.sync_databases$sync_and_analyze_database_STAR__BANG_.invoke(sync_databases.clj:71)
	at metabase.task.sync_databases$sync_and_analyze_database_BANG_.invokeStatic(sync_databases.clj:107)
	at metabase.task.sync_databases$sync_and_analyze_database_BANG_.invoke(sync_databases.clj:95)
	at metabase.task.sync_databases.SyncAndAnalyzeDatabase.execute(sync_databases.clj:112)
	at org.quartz.core.JobRunShell.run(JobRunShell.java:202)
	at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:573)
Caused by: java.sql.SQLSyntaxErrorException: (conn=14917287) Unknown column 't_nursing_record.memo' in 'field list'
	at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at org.mariadb.jdbc.internal.util.exceptions.ExceptionFactory.create(ExceptionFactory.java:158)
	at org.mariadb.jdbc.MariaDbStatement.executeExceptionEpilogue(MariaDbStatement.java:262)
	at org.mariadb.jdbc.MariaDbStatement.executeInternal(MariaDbStatement.java:362)
	at org.mariadb.jdbc.MariaDbStatement.execute(MariaDbStatement.java:500)
	at com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)
	at metabase.driver.sql_jdbc.execute$fn__87216.invokeStatic(execute.clj:570)
	at metabase.driver.sql_jdbc.execute$fn__87216.invoke(execute.clj:568)
	at clojure.lang.MultiFn.invoke(MultiFn.java:239)
	at metabase.driver.sql_jdbc.execute$execute_statement_or_prepared_statement_BANG_.invokeStatic(execute.clj:578)
	at metabase.driver.sql_jdbc.execute$execute_statement_or_prepared_statement_BANG_.invoke(execute.clj:575)
	at metabase.driver.sql_jdbc.execute$execute_reducible_query$fn__87286$fn__87287.invoke(execute.clj:715)
	... 208 more
Caused by: org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException: Unknown column 't_nursing_record.memo' in 'field list'
	at org.mariadb.jdbc.internal.util.exceptions.MariaDbSqlException.of(MariaDbSqlException.java:34)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.exceptionWithQuery(AbstractQueryProtocol.java:195)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:263)
	at org.mariadb.jdbc.MariaDbStatement.executeInternal(MariaDbStatement.java:356)
	... 216 more
Caused by: java.sql.SQLException: Unknown column 't_nursing_record.memo' in 'field list'
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readErrorPacket(AbstractQueryProtocol.java:1693)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.readPacket(AbstractQueryProtocol.java:1555)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.getResult(AbstractQueryProtocol.java:1518)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executeQuery(AbstractQueryProtocol.java:257)
	... 217 more


### Information about your Metabase installation

```JSON
1.chrome 131.0.6778.69
2.jar file deployed 
3.centos 7.6
```

### Severity

blocking users

### Additional context

_No response_",feng-dreaming,2024-11-22 02:37:27+00:00,[],2024-11-22 03:42:46+00:00,2024-11-22 03:42:44+00:00,https://github.com/metabase/metabase/issues/50382,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Administration/Metadata & Sync', ''), ('.Team/Drivers', '')]","[{'comment_id': 2492816337, 'issue_id': 2681560395, 'author': 'perivamsi', 'body': 'This is fixed in 51.4 by this PR https://github.com/metabase/metabase/pull/50091', 'created_at': datetime.datetime(2024, 11, 22, 3, 42, 44, tzinfo=datetime.timezone.utc)}]","perivamsi on (2024-11-22 03:42:44 UTC): This is fixed in 51.4 by this PR https://github.com/metabase/metabase/pull/50091

"
2681528796,issue,closed,completed,PieChart: Pulse card render error  No row values found for key {some name},"### Describe the bug

When creating an alert in Metabase that sends hourly notifications with a pie chart, the alert becomes unreliable if the underlying query's result set changes. Specifically, the messages (used as categories in the pie chart) seem to be set as fixed properties when the alert is created. If some of these messages are not present in the result set during subsequent runs, Metabase logs the following error:
`Pulse card render error, Error: No row values found for key Invalid Action`.

This issue is exclusive to pie charts and does not occur with other visualisation types like tables or bar charts.

### To Reproduce

### To Reproduce

Steps to reproduce the behaviour:

1. **Create a question**  
   - Use a table (e.g., `logs`) where messages are grouped and their counts are calculated.  
   - Example query:  

     ```sql
     SELECT message, COUNT(*) as count  
     FROM logs  
     GROUP BY message;
     ```  

     The result might look like this:  

     | Message            | Count |  
     |--------------------|-------|  
     | Invalid Action     | 10    |  
     | Successful Action  | 25    |  
     | Failed Attempt     | 5     |  

2. **Visualise the data as a pie chart**  
   - Open the question in Metabase.  
   - Choose ""Visualisation"" and select ""Pie Chart"".  

3. **Set up an hourly alert (pulse)**  
   - Go to the ""Alerts & Actions"" tab.  
   - Set up an hourly notification alert for the pie chart.

4. **Modify the data**  
   - Change the data in the `logs` table so that one or more messages (e.g., ""Invalid Action"") no longer appear in the query results.  

5. **Wait for the alert to trigger**  
   - Observe the next alert notification.  
   - Check the logs for the error: `Pulse card render error, Error: No row values found for key Invalid Action`.


### Expected behavior

The alert should dynamically handle changes in the result set. If a message category is missing from the query results, the pie chart should simply exclude it without logging an error or failing to render.

### Logs

[d0ac352a-ddae-4b8c-8c13-be831988491a] 2024-11-20T13:00:00+11:00 ERROR metabase.pulse.render Pulse card render error,Error: No row values found for key Expired Card,	at <js> :=>(file:/app/metabase.jar!/frontend_client/app/dist/lib-static-viz.bundle.js:315375:13198935-13198984),	at <js> getPieChartModel(file:/app/metabase.jar!/frontend_client/app/dist/lib-static-viz.bundle.js:315372-315381:13198797-13199071),	at <js> PieChart_PieChart(file:/app/metabase.jar!/frontend_client/app/dist/lib-static-viz.bundle.js:373350:16312180-16312238),	at <js> Db(file:/app/metabase.jar!/frontend_client/app/dist/lib-static-viz.bundle.js:83506:2405412-2405417),	at <js> Gb(file:/app/metabase.jar!/frontend_client/app/dist/lib-static-viz.bundle.js:83508:2406164-2406176),	at <js> X(file:/app/metabase.jar!/frontend_client/app/dist/lib-static-viz.bundle.js:83514:2408606-2408633),	at <js> Gb(file:/app/metabase.jar!/frontend_client/app/dist/lib-static-viz.bundle.js:83508:2406392-2406399),	at <js> X(file:/app/metabase.jar!/frontend_client/app/dist/lib-static-viz.bundle.js:83514:2408606-2408633),	at <js> Cb(file:/app/metabase.jar!/frontend_client/app/dist/lib-static-viz.bundle.js:83522:2411675-2411687),	at org.graalvm.polyglot.Value.execute(Value.java:880),	at metabase.pulse.render.js_engine$execute_fn_name.invokeStatic(js_engine.clj:67),	at metabase.pulse.render.js_engine$execute_fn_name.doInvoke(js_engine.clj:55),	at clojure.lang.RestFn.invoke(RestFn.java:493),	at metabase.pulse.render.js_svg$javascript_visualization.invokeStatic(js_svg.clj:151),	at metabase.pulse.render.js_svg$javascript_visualization.invoke(js_svg.clj:148),	at metabase.pulse.render.body$fn__78976$_AMPERSAND_f__78977.invoke(body.clj:454),	at metabase.pulse.render.body$fn__78976$fn__78984.invoke(body.clj:444),	at clojure.lang.MultiFn.invoke(MultiFn.java:261),	at metabase.pulse.render$render_pulse_card_body79344__79346.invokeStatic(render.clj:137),	at metabase.pulse.render$render_pulse_card_body79344__79346.invoke(render.clj:123),	at metabase.pulse.render$render_pulse_card79357__79358.invokeStatic(render.clj:164),	at metabase.pulse.render$render_pulse_card79357__79358.invoke(render.clj:147),	at metabase.channel.slack$payload__GT_attachment_data.invokeStatic(slack.clj:44),	at metabase.channel.slack$payload__GT_attachment_data.invoke(slack.clj:36),	at metabase.channel.slack$fn__112666$_AMPERSAND_f__112668.invoke(slack.clj:104),	at metabase.channel.slack$fn__112666$fn__112685.invoke(slack.clj:98),	at clojure.lang.MultiFn.invoke(MultiFn.java:239),	at metabase.pulse$send_pulse_BANG__STAR_$fn__104963$fn__104964.invoke(pulse.clj:365),	at metabase.pulse$send_pulse_BANG__STAR_$fn__104963.invoke(pulse.clj:363),	at metabase.pulse$send_pulse_BANG__STAR_.invokeStatic(pulse.clj:362),	at metabase.pulse$send_pulse_BANG__STAR_.invoke(pulse.clj:347),	at metabase.pulse$send_pulse_BANG_.invokeStatic(pulse.clj:407),	at metabase.pulse$send_pulse_BANG_.doInvoke(pulse.clj:387),	at clojure.lang.RestFn.invoke(RestFn.java:442),	at metabase.task.send_pulses$send_pulse_BANG_$fn__109988.invoke(send_pulses.clj:57),	at metabase.models.task_history$do_with_task_history65689__65690.invokeStatic(task_history.clj:121),	at metabase.models.task_history$do_with_task_history65689__65690.invoke(task_history.clj:109),	at metabase.task.send_pulses$send_pulse_BANG_.invokeStatic(send_pulses.clj:52),	at metabase.task.send_pulses$send_pulse_BANG_.invoke(send_pulses.clj:49),	at metabase.task.send_pulses$send_pulse_BANG__STAR_.invokeStatic(send_pulses.clj:130),	at metabase.task.send_pulses$send_pulse_BANG__STAR_.invoke(send_pulses.clj:121),	at metabase.task.send_pulses.SendPulse.execute(send_pulses.clj:152),	at org.quartz.core.JobRunShell.run(JobRunShell.java:202),	at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:573)


### Information about your Metabase installation

```JSON
 Metabase version `v0.51.4`
```

### Severity

We cannot reliably use pie chart in alerts

### Additional context

_No response_",ivanb777,2024-11-22 02:08:18+00:00,['alxnddr'],2024-12-14 02:04:11+00:00,2024-12-12 17:37:32+00:00,https://github.com/metabase/metabase/issues/50381,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Reporting/Alerts', ''), ('Visualization/Charts/Pie', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2492810147, 'issue_id': 2681528796, 'author': 'crisptrutski', 'body': 'Just to confirm, the question itself renders fine and its just the alerts that have this problem?', 'created_at': datetime.datetime(2024, 11, 22, 3, 34, 27, tzinfo=datetime.timezone.utc)}, {'comment_id': 2494743020, 'issue_id': 2681528796, 'author': 'ivanb777', 'body': '> Just to confirm, the question itself renders fine and its just the alerts that have this problem?\n\nYes, the question itself renders perfectly, including the pie chart visualisation. The issue occurs only when a notification is sent. For instance, in Slack, we receive an error message in the form of an image instead of the rendered pie chart.', 'created_at': datetime.datetime(2024, 11, 22, 20, 28, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2507850437, 'issue_id': 2681528796, 'author': 'maximepvrt', 'body': 'Hi,\nI\'m experiencing a similar issue with an embedded iframe. The error message displayed in French is:\n""Quelque chose a mal tourn""\n![Image](https://github.com/user-attachments/assets/ddd77502-c87c-4f0a-b727-2ae23593199e)\nAnd in the console, I see the following error:\n""Error: No row values found for key Mentorat / Parrainage""\n![Image](https://github.com/user-attachments/assets/4ce81ee7-1957-4088-b377-5e731e0ff2fc)\n\nInterestingly, the data export works correctly, and the dashboard functions as expected when not embedded. Additionally, the API returns the correct dataset, so it seems specific to the embedding context.\n\n![Image](https://github.com/user-attachments/assets/b2c3df01-3917-488a-acc3-3bdd1ed66b69)', 'created_at': datetime.datetime(2024, 11, 29, 13, 44, 14, tzinfo=datetime.timezone.utc)}, {'comment_id': 2524816827, 'issue_id': 2681528796, 'author': 'alxnddr', 'body': 'Hi @ivanb777 @maximepvrt   I\'ve been looking at the issue but unfortunately I\'m having trouble to reproduce the bug. Could you please share a bit more information that would make it easier to understand the root cause? \n\nI\'d appreciate if you could email the following data to aleksandr@metabase.com\n\n### Question that fails in Alerts\n- Open Browser dev tools -> Network tab\n- Open the question that fails in Alerts\n- Find two requests with paths\n  - `/api/card/:cardId`\n  - `/api/card/:cardId/query`\n- Copy all the content from the ""Response"" tab for every request\n\n### Question that fails in embedding iframe\n- Open Browser dev tools -> Network tab\n- Open the question that fails in Alerts\n- Find two requests with paths\n  - `/api/embed/dashboard/:token` (or `/api/preview_embed/dashboard/:token` when previewing)\n  - `/api/embed/dashboard/:token/dashcard/:id/card/:cardId` (or `/api/preview_embed/dashboard/:token/dashcard/:id/card/:cardId` when previewing)\n- Copy all the content from the ""Response"" tab for every request', 'created_at': datetime.datetime(2024, 12, 7, 2, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2539593307, 'issue_id': 2681528796, 'author': 'paoliniluis', 'body': 'dupe of https://github.com/metabase/metabase/issues/50090', 'created_at': datetime.datetime(2024, 12, 12, 17, 37, 32, tzinfo=datetime.timezone.utc)}, {'comment_id': 2540082988, 'issue_id': 2681528796, 'author': 'ivanb777', 'body': 'hey @paoliniluis #50090 looks related but not duplicate to the issue reported here.\n\n[#50090](https://github.com/metabase/metabase/issues/50090) reports the issue related to \n\n> an embedded dashboard with multiple pie charts ... an inner ring value disappears from the result set of _one_ of the pie chart questions but not the others.\n\nthe issue reported here is for a single pie chart and alert call  if during the subsequent renders the chart is missing a result set that was present when the chart/question was originally created', 'created_at': datetime.datetime(2024, 12, 12, 21, 51, 3, tzinfo=datetime.timezone.utc)}, {'comment_id': 2542661852, 'issue_id': 2681528796, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)', 'created_at': datetime.datetime(2024, 12, 14, 2, 4, 10, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-11-22 03:34:27 UTC): Just to confirm, the question itself renders fine and its just the alerts that have this problem?

ivanb777 (Issue Creator) on (2024-11-22 20:28:58 UTC): Yes, the question itself renders perfectly, including the pie chart visualisation. The issue occurs only when a notification is sent. For instance, in Slack, we receive an error message in the form of an image instead of the rendered pie chart.

maximepvrt on (2024-11-29 13:44:14 UTC): Hi,
I'm experiencing a similar issue with an embedded iframe. The error message displayed in French is:
""Quelque chose a mal tourn""
![Image](https://github.com/user-attachments/assets/ddd77502-c87c-4f0a-b727-2ae23593199e)
And in the console, I see the following error:
""Error: No row values found for key Mentorat / Parrainage""
![Image](https://github.com/user-attachments/assets/4ce81ee7-1957-4088-b377-5e731e0ff2fc)

Interestingly, the data export works correctly, and the dashboard functions as expected when not embedded. Additionally, the API returns the correct dataset, so it seems specific to the embedding context.

![Image](https://github.com/user-attachments/assets/b2c3df01-3917-488a-acc3-3bdd1ed66b69)

alxnddr (Assginee) on (2024-12-07 02:32:00 UTC): Hi @ivanb777 @maximepvrt   I've been looking at the issue but unfortunately I'm having trouble to reproduce the bug. Could you please share a bit more information that would make it easier to understand the root cause? 

I'd appreciate if you could email the following data to aleksandr@metabase.com

### Question that fails in Alerts
- Open Browser dev tools -> Network tab
- Open the question that fails in Alerts
- Find two requests with paths
  - `/api/card/:cardId`
  - `/api/card/:cardId/query`
- Copy all the content from the ""Response"" tab for every request

### Question that fails in embedding iframe
- Open Browser dev tools -> Network tab
- Open the question that fails in Alerts
- Find two requests with paths
  - `/api/embed/dashboard/:token` (or `/api/preview_embed/dashboard/:token` when previewing)
  - `/api/embed/dashboard/:token/dashcard/:id/card/:cardId` (or `/api/preview_embed/dashboard/:token/dashcard/:id/card/:cardId` when previewing)
- Copy all the content from the ""Response"" tab for every request

paoliniluis on (2024-12-12 17:37:32 UTC): dupe of https://github.com/metabase/metabase/issues/50090

ivanb777 (Issue Creator) on (2024-12-12 21:51:03 UTC): hey @paoliniluis #50090 looks related but not duplicate to the issue reported here.

[#50090](https://github.com/metabase/metabase/issues/50090) reports the issue related to 


the issue reported here is for a single pie chart and alert call  if during the subsequent renders the chart is missing a result set that was present when the chart/question was originally created

github-actions[bot] on (2024-12-14 02:04:10 UTC):  This should also be released by [v0.52.3](https://github.com/metabase/metabase/milestone/292)

"
2681065225,issue,closed,completed,We broke the cache headers in v51,"The file app-embed.ab96202c244c98ca.js takes over 5 seconds to load, significantly slowing down the loading of embedded dashboards. This file does not include caching headers (Cache-Control and Expires), forcing browsers to re-download it on every visit.

![Image](https://github.com/user-attachments/assets/19d2a810-68e2-4b9f-a108-2864abfd8d8c)


Impact:

Prolonged loading times: Negatively affects the user experience for embedded dashboards.
Increased bandwidth usage: Causes unnecessary requests to the server.
Request:

Mark the file as cacheable by adding headers such as:

```
Cache-Control: public, max-age=31536000
Expires: [future date]
```
This will allow browsers to store the file locally and improve performance.

",rodrigoGA,2024-11-21 21:39:16+00:00,['heypoom'],2024-12-18 12:32:55+00:00,2024-11-29 20:35:23+00:00,https://github.com/metabase/metabase/issues/50373,"[('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Performance', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('Cloud-Blocker:51', 'Issues blocking the cloud customers to be upgraded to v51'), ('Bug:v51', 'bugs or regressions introduced in v51')]","[{'comment_id': 2492519464, 'issue_id': 2681065225, 'author': 'paoliniluis', 'body': '@rodrigoGA version of Metabase? how are you deploying Metabase and where?', 'created_at': datetime.datetime(2024, 11, 21, 22, 53, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2492547074, 'issue_id': 2681065225, 'author': 'rodrigoGA', 'body': '@paoliniluis  I am deploying it using the jar.\n\nMetabase info:\n```\n{\n  ""browser-info"": {\n    ""language"": ""es-ES"",\n    ""platform"": ""Linux x86_64"",\n    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36"",\n    ""vendor"": ""Google Inc.""\n  },\n  ""metabase-info"": {\n    ""databases"": [\n      ""postgres"",\n      ""h2""\n    ],\n    ""run-mode"": ""prod"",\n    ""plan-alias"": """",\n    ""version"": {\n      ""date"": ""2024-11-19"",\n      ""tag"": ""v0.51.4"",\n      ""hash"": ""47f05f3""\n    },\n    ""settings"": {\n      ""report-timezone"": null\n    },\n    ""hosting-env"": ""unknown"",\n    ""application-database"": ""postgres"",\n    ""application-database-details"": {\n      ""database"": {\n        ""name"": ""PostgreSQL"",\n        ""version"": ""12.20""\n      },\n      ""jdbc-driver"": {\n        ""name"": ""PostgreSQL JDBC Driver"",\n        ""version"": ""42.7.3""\n      }\n    }\n  },\n  ""system-info"": {\n    ""file.encoding"": ""UTF-8"",\n    ""java.runtime.name"": ""OpenJDK Runtime Environment"",\n    ""java.runtime.version"": ""11.0.23+9-LTS"",\n    ""java.vendor"": ""Red Hat, Inc."",\n    ""java.vendor.url"": ""https://www.redhat.com/"",\n    ""java.version"": ""11.0.23"",\n    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",\n    ""java.vm.version"": ""11.0.23+9-LTS"",\n    ""os.name"": ""Linux"",\n    ""os.version"": ""3.10.0-1160.114.2.el7.x86_64"",\n    ""user.language"": ""es"",\n    ""user.timezone"": ""Europe/Madrid""\n  }\n}\n```', 'created_at': datetime.datetime(2024, 11, 21, 23, 16, 49, tzinfo=datetime.timezone.utc)}, {'comment_id': 2493349644, 'issue_id': 2681065225, 'author': 'paoliniluis', 'body': '@rodrigoGA send please the size of the asset as I cant see it on the screenshot, also send us where youre physically located and the configuration of the reverse proxy/load balancer', 'created_at': datetime.datetime(2024, 11, 22, 9, 47, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2493797126, 'issue_id': 2681065225, 'author': 'rodrigoGA', 'body': ""@paoliniluis the size of the asset is 1 MB. It's currently installed in Europe on Metabase. Im accessing it from America, and there is an Apache server acting as the reverse proxy in front. Please note that gzip compression is not yet configured on the reverse proxy.\n\nFor context, I have other deployments on similar infrastructure that dont experience the same level of slowness when loading."", 'created_at': datetime.datetime(2024, 11, 22, 13, 41, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2501217223, 'issue_id': 2681065225, 'author': 'roycai1234', 'body': ""Yes I got the same problem. I deployed on docker, v0.51.4. It took quite a long time to load the first page every time I refreshed the page. I checked the network traffic and found that some static files were reloaded every time, no cache. \nI tried to downgrade to v0.50.31 It also took me  a long time to download from 0.51 to 0.50 on docker, then it's OK."", 'created_at': datetime.datetime(2024, 11, 26, 15, 48, 38, tzinfo=datetime.timezone.utc)}, {'comment_id': 2502181506, 'issue_id': 2681065225, 'author': 'paoliniluis', 'body': '@rodrigoGA so this is on embedding only I would guess\n\n@roycai1234 can you confirm?', 'created_at': datetime.datetime(2024, 11, 26, 23, 32, 56, tzinfo=datetime.timezone.utc)}, {'comment_id': 2502431979, 'issue_id': 2681065225, 'author': 'rodrigoGA', 'body': 'Yes, I also notice the slow load of the application overall, but where it\nimpacts the most is in the embeddings as well.', 'created_at': datetime.datetime(2024, 11, 27, 1, 31, 47, tzinfo=datetime.timezone.utc)}, {'comment_id': 2503528530, 'issue_id': 2681065225, 'author': 'roycai1234', 'body': 'No, I don\'t use embedding.\nI just run dockerdocker run -d -v /home/metabase-db:/metabase.db --name metabase -e MB_DB_FILE=/metabase.db -p 3000:3000 metabase/metabase:latest,\nthen visit the setup page and reload it repeatedly, check the network traffic log.\nIt shows some static files like ""vendor.1d6eb12d1c69bf84.js"" and ""app-main.f996bc0054723f34.js"" etc were fully downloaded every time. It almost took 7 secs to show the setup page every time.\nTheir cache-control like this: max-age=0, no-cache, must-revalidate, proxy-revalidate.\n\nIf I change to :docker run -d -v /home/metabase-db:/metabase.db --name metabase -e MB_DB_FILE=/metabase.db -p 3000:3000 metabase/metabase:v0.50.31the setup page shows quite fast when refresh, Cache-control: public, max-age=31536000', 'created_at': datetime.datetime(2024, 11, 27, 10, 39, 43, tzinfo=datetime.timezone.utc)}, {'comment_id': 2523294503, 'issue_id': 2681065225, 'author': 'rodrigoGA', 'body': '@paoliniluis @heypoom  According to the changelog, they fixed this in v0.52.1, but after updating to that version, none of the static files are returning the cache header.\nThis bug is still active.', 'created_at': datetime.datetime(2024, 12, 6, 13, 48, 36, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-11-21 22:53:24 UTC): @rodrigoGA version of Metabase? how are you deploying Metabase and where?

rodrigoGA (Issue Creator) on (2024-11-21 23:16:49 UTC): @paoliniluis  I am deploying it using the jar.

Metabase info:
```
{
  ""browser-info"": {
    ""language"": ""es-ES"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-19"",
      ""tag"": ""v0.51.4"",
      ""hash"": ""47f05f3""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.20""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9-LTS"",
    ""java.vendor"": ""Red Hat, Inc."",
    ""java.vendor.url"": ""https://www.redhat.com/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""3.10.0-1160.114.2.el7.x86_64"",
    ""user.language"": ""es"",
    ""user.timezone"": ""Europe/Madrid""
  }
}
```

paoliniluis on (2024-11-22 09:47:16 UTC): @rodrigoGA send please the size of the asset as I cant see it on the screenshot, also send us where youre physically located and the configuration of the reverse proxy/load balancer

rodrigoGA (Issue Creator) on (2024-11-22 13:41:29 UTC): @paoliniluis the size of the asset is 1 MB. It's currently installed in Europe on Metabase. Im accessing it from America, and there is an Apache server acting as the reverse proxy in front. Please note that gzip compression is not yet configured on the reverse proxy.

For context, I have other deployments on similar infrastructure that dont experience the same level of slowness when loading.

roycai1234 on (2024-11-26 15:48:38 UTC): Yes I got the same problem. I deployed on docker, v0.51.4. It took quite a long time to load the first page every time I refreshed the page. I checked the network traffic and found that some static files were reloaded every time, no cache. 
I tried to downgrade to v0.50.31 It also took me  a long time to download from 0.51 to 0.50 on docker, then it's OK.

paoliniluis on (2024-11-26 23:32:56 UTC): @rodrigoGA so this is on embedding only I would guess

@roycai1234 can you confirm?

rodrigoGA (Issue Creator) on (2024-11-27 01:31:47 UTC): Yes, I also notice the slow load of the application overall, but where it
impacts the most is in the embeddings as well.

roycai1234 on (2024-11-27 10:39:43 UTC): No, I don't use embedding.
I just run dockerdocker run -d -v /home/metabase-db:/metabase.db --name metabase -e MB_DB_FILE=/metabase.db -p 3000:3000 metabase/metabase:latest,
then visit the setup page and reload it repeatedly, check the network traffic log.
It shows some static files like ""vendor.1d6eb12d1c69bf84.js"" and ""app-main.f996bc0054723f34.js"" etc were fully downloaded every time. It almost took 7 secs to show the setup page every time.
Their cache-control like this: max-age=0, no-cache, must-revalidate, proxy-revalidate.

If I change to :docker run -d -v /home/metabase-db:/metabase.db --name metabase -e MB_DB_FILE=/metabase.db -p 3000:3000 metabase/metabase:v0.50.31the setup page shows quite fast when refresh, Cache-control: public, max-age=31536000

rodrigoGA (Issue Creator) on (2024-12-06 13:48:36 UTC): @paoliniluis @heypoom  According to the changelog, they fixed this in v0.52.1, but after updating to that version, none of the static files are returning the cache header.
This bug is still active.

"
2680998052,issue,closed,completed,Customizing grouping options for time group filter breaks some functionality (Ex: Publishing Static Dashboards),"### Describe the bug

If you add a time group filter to a dashboard and then customize the ""Time Grouping Options"" for the filter you can save it. But you cannot subsequently publish the changes to embedded dashboards, move the dashboard to trash, etc. Seems we're sending malformed requests to '/api/dashboard/id'.

### To Reproduce

1. Set up a dashboard
2. Add time group filter
3. See that you can publish the static dashboard
4. Edit the dashboard and customize the ""time grouping options"" for the filter
5. See that you cannot publish the embedding changes, put the dashboard in the trash, drill into questions, duplicate the dashboard, etc.

https://www.loom.com/share/31b9bad1317b494185c0c093a89ee0de

### Expected behavior

_No response_

### Logs

_No response_

### Information about your Metabase installation

```JSON
v51.3
```

### Severity

Blocking

### Additional context

If you add all options back to the time filter settings the UX is still broken. As a workaround you can remove the filter completely, add it back and save it without customizing granularity.",ixipixi,2024-11-21 21:26:25+00:00,['metamben'],2024-11-26 16:14:17+00:00,2024-11-22 20:56:26+00:00,https://github.com/metabase/metabase/issues/50371,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Backend', ''), ('.Team/Querying', ''), ('Cloud-Blocker:51', 'Issues blocking the cloud customers to be upgraded to v51'), ('Bug:v51', 'bugs or regressions introduced in v51')]","[{'comment_id': 2494272030, 'issue_id': 2680998052, 'author': 'ranquild', 'body': ""It seems that in some cases the BE doesn't convert strings to keywords for `Parameter` ![Image](https://github.com/user-attachments/assets/8f8c9d52-52a2-4982-87aa-05ae77768370)\n![Image](https://github.com/user-attachments/assets/2b3df134-4979-4893-8e2f-5dfbf39b6905)"", 'created_at': datetime.datetime(2024, 11, 22, 16, 56, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2500160421, 'issue_id': 2680998052, 'author': 'JurenaMat', 'body': ""@metamben I discovered this issue when working with static embeds again. We've just upgraded to 1.51.4. I see the task as completed under https://github.com/metabase/metabase/pull/50418, when can we expect the fix on prod?"", 'created_at': datetime.datetime(2024, 11, 26, 9, 54, 16, tzinfo=datetime.timezone.utc)}, {'comment_id': 2501280047, 'issue_id': 2680998052, 'author': 'metamben', 'body': '@JurenaMat, it should be released in 0.51.6.', 'created_at': datetime.datetime(2024, 11, 26, 16, 14, 16, tzinfo=datetime.timezone.utc)}]","ranquild on (2024-11-22 16:56:23 UTC): It seems that in some cases the BE doesn't convert strings to keywords for `Parameter` ![Image](https://github.com/user-attachments/assets/8f8c9d52-52a2-4982-87aa-05ae77768370)
![Image](https://github.com/user-attachments/assets/2b3df134-4979-4893-8e2f-5dfbf39b6905)

JurenaMat on (2024-11-26 09:54:16 UTC): @metamben I discovered this issue when working with static embeds again. We've just upgraded to 1.51.4. I see the task as completed under https://github.com/metabase/metabase/pull/50418, when can we expect the fix on prod?

metamben (Assginee) on (2024-11-26 16:14:16 UTC): @JurenaMat, it should be released in 0.51.6.

"
2680671458,issue,closed,not_planned,Issues migrating from v0.46.5 to v0.51.4,"### Describe the bug

I am encountering issues when attempting to migrate from Metabase version v0.46.5 to v0.51.4. The migration process seems to be blocked due to database locks.

I executed the migrate release-locks command as documented, but the problem persists, and the migration remains blocked.


What should I do to update Metabase? To perform the migration in production, how can I avoid this problem?

### To Reproduce

- Attempted the migration process from v0.46.5 to v0.51.4.
- Ran the migrate release-locks command to release any existing database locks.
- Observed that the command completed successfully but did not resolve the issue.

### Expected behavior

The migrate release-locks command should release the locks on the database, enabling the migration to proceed without issues.

Actual Behavior:
Despite running the command, the locks remain unresolved, and the migration cannot proceed.

### Logs

2024-11-21 15:03:42,220 ERROR metabase.core :: Metabase Initialization FAILED
liquibase.exception.LockException: La base de datos tiene un bloqueo de migracin por lo que no podemos actualizar. Puedes forzar la liberacin de estos bloqueos ejecutando java -jar metabase.jar migrate release-locks.
at metabase.db.liquibase$wait_for_migration_lock$fn__45414.invoke(liquibase.clj:233)
at metabase.util.jvm$do_with_auto_retries.invokeStatic(jvm.clj:174)
at metabase.util.jvm$do_with_auto_retries.invoke(jvm.clj:164)
at metabase.util.jvm$do_with_auto_retries.invokeStatic(jvm.clj:181)
at metabase.util.jvm$do_with_auto_retries.invoke(jvm.clj:164)
at metabase.util.jvm$do_with_auto_retries.invokeStatic(jvm.clj:181)
at metabase.util.jvm$do_with_auto_retries.invoke(jvm.clj:164)
at metabase.util.jvm$do_with_auto_retries.invokeStatic(jvm.clj:181)
at metabase.util.jvm$do_with_auto_retries.invoke(jvm.clj:164)
at metabase.util.jvm$do_with_auto_retries.invokeStatic(jvm.clj:181)
at metabase.util.jvm$do_with_auto_retries.invoke(jvm.clj:164)
at metabase.util.jvm$do_with_auto_retries.invokeStatic(jvm.clj:181)
at metabase.util.jvm$do_with_auto_retries.invoke(jvm.clj:164)
at metabase.db.liquibase$wait_for_migration_lock.invokeStatic(liquibase.clj:227)
at metabase.db.liquibase$wait_for_migration_lock.invoke(liquibase.clj:222)
at metabase.db.liquibase$run_in_scope_locked$reify__45449.run(liquibase.clj:333)
at liquibase.Scope.lambda$child$0(Scope.java:186)
at liquibase.Scope.child(Scope.java:195)
at liquibase.Scope.child(Scope.java:185)
at liquibase.Scope.child(Scope.java:164)
at metabase.db.liquibase$run_in_scope_locked.invokeStatic(liquibase.clj:329)
at metabase.db.liquibase$run_in_scope_locked.invoke(liquibase.clj:312)
at metabase.db.liquibase$migrate_up_if_needed_BANG_.invokeStatic(liquibase.clj:360)
at metabase.db.liquibase$migrate_up_if_needed_BANG_.invoke(liquibase.clj:353)
at metabase.db.setup$migrate_BANG_55466__55467$fn__55468.invoke(setup.clj:84)
at metabase.db.liquibase$do_with_liquibase45383__45384$f_STAR___45385.invoke(liquibase.clj:135)
at metabase.db.liquibase$do_with_liquibase45383__45384.invokeStatic(liquibase.clj:138)
at metabase.db.liquibase$do_with_liquibase45383__45384.invoke(liquibase.clj:126)
at metabase.db.setup$migrate_BANG_55466__55467.invokeStatic(setup.clj:73)
at metabase.db.setup$migrate_BANG_55466__55467.doInvoke(setup.clj:55)
at clojure.lang.RestFn.invoke(RestFn.java:428)
at metabase.db.setup$run_schema_migrations_BANG_55493__55494.invokeStatic(setup.clj:149)
at metabase.db.setup$run_schema_migrations_BANG_55493__55494.invoke(setup.clj:144)
at metabase.db.setup$setup_db_BANG_55500__55501$fn__55504$fn__55505.invoke(setup.clj:167)
at metabase.util.jvm$do_with_us_locale.invokeStatic(jvm.clj:238)
at metabase.util.jvm$do_with_us_locale.invoke(jvm.clj:224)
at metabase.db.setup$setup_db_BANG_55500__55501$fn__55504.invoke(setup.clj:161)
at metabase.db.setup$setup_db_BANG_55500__55501.invokeStatic(setup.clj:160)
at metabase.db.setup$setup_db_BANG_55500__55501.invoke(setup.clj:153)
at metabase.db$setup_db_BANG_$fn__55529.invoke(db.clj:86)
at metabase.db$setup_db_BANG_.invokeStatic(db.clj:81)
at metabase.db$setup_db_BANG_.doInvoke(db.clj:68)
at clojure.lang.RestFn.invoke(RestFn.java:424)
at metabase.core$init_BANG__STAR_.invokeStatic(core.clj:121)
at metabase.core$init_BANG__STAR_.invoke(core.clj:102)
at metabase.core$init_BANG_.invokeStatic(core.clj:181)
at metabase.core$init_BANG_.invoke(core.clj:176)
at metabase.core$start_normally.invokeStatic(core.clj:193)
at metabase.core$start_normally.invoke(core.clj:187)
at metabase.core$entrypoint.invokeStatic(core.clj:226)
at metabase.core$entrypoint.doInvoke(core.clj:220)
at clojure.lang.RestFn.invoke(RestFn.java:400)
at clojure.lang.AFn.applyToHelper(AFn.java:152)
at clojure.lang.RestFn.applyTo(RestFn.java:135)
at clojure.lang.Var.applyTo(Var.java:707)
at clojure.core$apply.invokeStatic(core.clj:667)
at clojure.core$apply.invoke(core.clj:662)
at metabase.bootstrap$_main.invokeStatic(bootstrap.clj:31)
at metabase.bootstrap$_main.doInvoke(bootstrap.clj:28)
at clojure.lang.RestFn.invoke(RestFn.java:400)
at clojure.lang.AFn.applyToHelper(AFn.java:152)
at clojure.lang.RestFn.applyTo(RestFn.java:135)
at metabase.bootstrap.main(Unknown Source)
2024-11-21 15:03:42,230 INFO metabase.core :: Metabase Shutting Down ...
2024-11-21 15:03:42,230 INFO metabase.server :: Shutting Down Embedded Jetty Webserver
2024-11-21 15:03:42,250 WARN db.liquibase :: ()
2024-11-21 15:03:42,251 INFO metabase.core :: Metabase Shutdown COMPLETE.



### Information about your Metabase installation

```JSON
Current Metabase Version: v0.46.5
Target Metabase Version: v0.51.4
Java Version: 11.0.25
Running Metabase in a cluster environment.
Database: MariaDB 10.6.15
```

### Severity

blocking an upgrade

### Additional context

_No response_",digarcia78,2024-11-21 19:35:31+00:00,[],2024-11-21 19:57:57+00:00,2024-11-21 19:57:56+00:00,https://github.com/metabase/metabase/issues/50364,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2492145484, 'issue_id': 2680671458, 'author': 'paoliniluis', 'body': 'handling this in discourse', 'created_at': datetime.datetime(2024, 11, 21, 19, 57, 56, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-11-21 19:57:56 UTC): handling this in discourse

"
2680642082,issue,closed,completed,show loader in the segment control,,uladzimirdev,2024-11-21 19:25:23+00:00,['uladzimirdev'],2024-11-25 11:39:04+00:00,2024-11-22 13:21:28+00:00,https://github.com/metabase/metabase/issues/50362,[],[],
2680585221,issue,closed,completed,show segment control even before we got any query result on the viz page,,uladzimirdev,2024-11-21 19:10:52+00:00,['uladzimirdev'],2024-11-22 13:21:25+00:00,2024-11-22 13:21:25+00:00,https://github.com/metabase/metabase/issues/50358,[],[],
2680248628,issue,closed,duplicate,Dashboard filters unlinking while editing,"### Describe the bug

While browsing through dashboard filters on a dashboard in edit mode, previously linked filters get unexpectedly unlinked.

### To Reproduce

https://github.com/user-attachments/assets/da897bcc-363d-493a-82f2-aa20ea728a5f


### Expected behavior

Linked filters stay linked unless changed otherwise.

### Logs

_No response_

### Information about your Metabase installation

```JSON
v0.51.1.2
```

### Severity

Slows down work, might cause unexpected issues

### Additional context

_No response_",TLazarevic,2024-11-21 17:09:19+00:00,[],2025-01-10 19:18:57+00:00,2025-01-10 19:18:56+00:00,https://github.com/metabase/metabase/issues/50349,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Parameters & Variables', 'Filter widgets, field filters, variables etc.'), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2492811529, 'issue_id': 2680248628, 'author': 'crisptrutski', 'body': ""I'm not clear which team this falls under, apologies if it was routed incorrectly."", 'created_at': datetime.datetime(2024, 11, 22, 3, 36, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2503829483, 'issue_id': 2680248628, 'author': 'LouisMonierSpark', 'body': 'Same here, this is extremely painful and should be fixed asap.', 'created_at': datetime.datetime(2024, 11, 27, 13, 4, 54, tzinfo=datetime.timezone.utc)}, {'comment_id': 2583698278, 'issue_id': 2680248628, 'author': 'Tony-metabase', 'body': 'Closing this one in favor of [this](https://github.com/metabase/metabase/issues/51957) since there are replication steps on what is going on', 'created_at': datetime.datetime(2025, 1, 10, 19, 18, 56, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-11-22 03:36:25 UTC): I'm not clear which team this falls under, apologies if it was routed incorrectly.

LouisMonierSpark on (2024-11-27 13:04:54 UTC): Same here, this is extremely painful and should be fixed asap.

Tony-metabase on (2025-01-10 19:18:56 UTC): Closing this one in favor of [this](https://github.com/metabase/metabase/issues/51957) since there are replication steps on what is going on

"
2680034274,issue,closed,completed,tabs are cut off in focus state in the sidebar,"**Context**

in https://github.com/metabase/metabase/pull/50264 we added tabs from `metabase/ui`, but several parent components have `overflow-y` specified which cuts off outline that shows active focus state

![Image](https://github.com/user-attachments/assets/17748424-6eaf-490c-aad6-4229cf4fe49a)

",uladzimirdev,2024-11-21 16:01:51+00:00,[],2025-01-29 08:59:58+00:00,2025-01-29 08:59:57+00:00,https://github.com/metabase/metabase/issues/50348,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]","[{'comment_id': 2621040087, 'issue_id': 2680034274, 'author': 'uladzimirdev', 'body': 'changes were reverted, so this issue is not actual anymore', 'created_at': datetime.datetime(2025, 1, 29, 8, 59, 57, tzinfo=datetime.timezone.utc)}]","uladzimirdev (Issue Creator) on (2025-01-29 08:59:57 UTC): changes were reverted, so this issue is not actual anymore

"
2679914648,issue,closed,completed,We broke the pivot grouping in 51,"### Describe the bug

We broke the pivot table groupings in v51, users can't collapse and expand the groups anymore

### To Reproduce

1) Make a question like
![Image](https://github.com/user-attachments/assets/3dcfc6e2-e262-4735-b06a-0ad631406fd6)
2) visualize it as a pivot table with these viz settings
![Image](https://github.com/user-attachments/assets/5b2ce37a-2a13-4ef9-9973-23867e317e50)
3) see that theres's no way to minimize and maximize the groupings

50 looked like
![Image](https://github.com/user-attachments/assets/7fc01c90-3b09-4068-8e85-cbb4500869bb)


### Expected behavior

We should have the grouping as we had in v50

### Logs

NA

### Information about your Metabase installation

```JSON
v51
```

### Severity

P1

### Additional context

_No response_",paoliniluis,2024-11-21 15:34:33+00:00,['ranquild'],2024-11-26 01:30:25+00:00,2024-11-26 00:31:37+00:00,https://github.com/metabase/metabase/issues/50346,"[('Type:Bug', 'Product defects'), ('.Frontend', ''), ('.Regression', 'Bugs that were previously fixed and/or bugs unintentionally shipped with new features.'), ('.Team/Querying', ''), ('Cloud-Blocker:51', 'Issues blocking the cloud customers to be upgraded to v51'), ('Bug:v51', 'bugs or regressions introduced in v51'), ('Querying/Pivot', 'Queries that generate pivot tables')]",[],
2679826324,issue,open,,"""field_ref"" in metadata of a model leading to a ""INVALID_ARGUMENT Name xx not found"" error for BigQuery","### Describe the bug

Question Editor throws a ""INVALID_ARGUMENT Name xx not found"" when trying to join on a model with and ""effective_type"" present in the metadata.

I have 2 models with exactly the same information on the Metabase GUI (same SQL shown in the Editor, same metadata shown in the Metadata Edit section):
- Accounts using feedback v1
- Accounts using feedback v2
Both model are basded on another Model named ""Accounts with Customers"" that is joinning Accounts with Billing Organization.

When trying to build a query joining on ""Accounts using feedback v1"" I get an error ""INVALID_ARGUMENT Name xx not found"".
When trying to build the same query joining on ""Accounts using feedback v2"" I do not get any error.

By checking the SQL code there is an issue on the SQL generated:
- For ""Accounts using feedback v1"" we have attributes belonging to the original Billing Organization BUT not in the model ""Accounts with Customers"" => error ""INVALID_ARGUMENT Name xx not found""
- For ""Accounts using feedback v1"" we have attributes belonging to the model ""Accounts with Customers"" => all good
![Image](https://github.com/user-attachments/assets/9203ad1d-9547-4340-9d58-e3118bdd3338)
![Image](https://github.com/user-attachments/assets/5e59a6dd-882a-415b-8f0d-38ea4c04a763)

After comparing ""Accounts using feedback v1"" and ""Accounts using feedback v2"" on the UI and found no differences, I check the API calls (see below). Here I found out that the 2 results for the models are almost exactly the same. The difference relies on 1 attribute of the ""result_metadata"" key. Indded we have 
- for ""Accounts using feedback v1"" => ""field_ref"": [""expression"", ""xx""]
- for ""Accounts using feedback v2"" => ""field_ref"": [""field"", ""xx"", {""base-type"": ""type/Xxxx""}]
![Image](https://github.com/user-attachments/assets/5d322896-15c1-4122-a6b8-2ec391d71424)


And no matter all the test I do, I can not change this ""field_ref"": [""expression"", ""xx""] for ""Accounts using feedback v1"".
Is it possible that lead to the issue of wrongly converting Question into SQL ?
What is ""field_ref"" and can I change it for  ""Accounts using feedback v1"" ?
Or is the issue linked to something else ?

### To Reproduce

I do not know how to rebuild a model not working like ""Accounts using feedback v1"", but with the 2 models I can reproduce easily by:
1. Adding a new question on a Table A
2. Joining the Table A on ""Accounts using feedback v1"" => I get the error
3. Joining the Table A on ""Accounts using feedback v2"" instead => no error (and it is the same story if I start from a fresh start)

### Expected behavior

I would expect the SQL to be correctly translated.

### Logs

Nothing to observe in the logs. 
Here are the logs when I create the query with ""Accounts using feedback v1""
```
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:57:49+01:00 INFO metabase.server.middleware.exceptions Request canceled before finishing.
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:57:49+01:00 INFO metabase.server.middleware.exceptions Request canceled before finishing.
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:57:59+01:00 INFO metabase.server.middleware.exceptions Request canceled before finishing.
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:00+01:00 DEBUG metabase.server.middleware.log POST /api/dataset/native 200 51.0 ms (4 DB calls) App DB connections: 1/15 Jetty threads: 28/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:00+01:00 DEBUG metabase.server.middleware.log POST /api/dataset/query_metadata 200 89.8 ms (6 DB calls) App DB connections: 0/15 Jetty threads: 27/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:02+01:00 DEBUG metabase.server.middleware.log GET /api/activity/recents 200 109.0 ms (26 DB calls) App DB connections: 1/15 Jetty threads: 28/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:04+01:00 DEBUG metabase.server.middleware.log GET /api/search 200 2.4 s (5 DB calls) App DB connections: 0/15 Jetty threads: 27/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:04+01:00 DEBUG metabase.server.middleware.log GET /api/database 200 7.6 ms (1 DB calls) App DB connections: 0/15 Jetty threads: 28/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:04+01:00 DEBUG metabase.server.middleware.log GET /api/database/2/schemas 200 13.7 ms (2 DB calls) App DB connections: 0/15 Jetty threads: 27/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:06+01:00 DEBUG metabase.server.middleware.log GET /api/collection/root 200 21.8 ms (3 DB calls) App DB connections: 1/15 Jetty threads: 30/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:06+01:00 DEBUG metabase.server.middleware.log GET /api/collection/12 200 24.1 ms (5 DB calls) App DB connections: 1/15 Jetty threads: 29/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:06+01:00 DEBUG metabase.server.middleware.log GET /api/collection/12/items 200 27.2 ms (5 DB calls) App DB connections: 1/15 Jetty threads: 28/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:06+01:00 DEBUG metabase.server.middleware.log GET /api/collection/root/items 200 129.5 ms (9 DB calls) App DB connections: 1/15 Jetty threads: 28/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:06+01:00 DEBUG metabase.server.middleware.log GET /api/collection/root/items 200 244.4 ms (9 DB calls) App DB connections: 0/15 Jetty threads: 27/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:08+01:00 DEBUG metabase.server.middleware.log GET /api/collection/330/items 200 74.0 ms (10 DB calls) App DB connections: 0/15 Jetty threads: 28/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:08+01:00 DEBUG metabase.server.middleware.log GET /api/collection/330/items 200 77.3 ms (10 DB calls) App DB connections: 0/15 Jetty threads: 27/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:08+01:00 DEBUG metabase.server.middleware.log GET /api/collection/372/items 200 49.2 ms (10 DB calls) App DB connections: 0/15 Jetty threads: 28/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:08+01:00 DEBUG metabase.server.middleware.log GET /api/collection/372/items 200 69.0 ms (11 DB calls) App DB connections: 0/15 Jetty threads: 27/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:09+01:00 INFO metabase.server.middleware.exceptions Request canceled before finishing.
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:09+01:00 DEBUG metabase.server.middleware.log GET /api/collection/374/items 200 35.1 ms (8 DB calls) App DB connections: 0/15 Jetty threads: 28/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:09+01:00 DEBUG metabase.server.middleware.log GET /api/collection/374/items 200 62.4 ms (8 DB calls) App DB connections: 0/15 Jetty threads: 27/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:13+01:00 DEBUG metabase.server.middleware.log GET /api/table/card__1997/query_metadata 200 31.0 ms (7 DB calls) App DB connections: 1/15 Jetty threads: 28/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:13+01:00 DEBUG metabase.server.middleware.log POST /api/activity/recents 200 62.1 ms (13 DB calls) App DB connections: 0/15 Jetty threads: 27/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
[668a6d51-71c2-4710-a198-56409d24c6c4] 2024-11-21T15:58:16+01:00 DEBUG metabase.server.middleware.log POST /api/dataset/query_metadata 200 55.6 ms (13 DB calls) App DB connections: 0/15 Jetty threads: 27/50 (3 idle, 0 queued) (160 total active threads) Queries in flight: 0 (0 queued) {:metabase-user-id 8}
```

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""bigquery-cloud-sdk"",
      ""postgres""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-19"",
      ""tag"": ""v0.51.4.1"",
      ""hash"": ""3aa4ded""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""14.13""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""6.1.100+"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Medium (blocking basic UI building with some Models)

### Additional context

I have opened another issue that I will probably close because it seems to not be linked to chaining SQL question but to model metadata: https://github.com/metabase/metabase/issues/50160",Simonot,2024-11-21 15:00:57+00:00,[],2025-02-04 20:27:54+00:00,,https://github.com/metabase/metabase/issues/50343,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/Processor', ''), ('.Backend', ''), ('.Team/Querying', '')]","[{'comment_id': 2491667917, 'issue_id': 2679826324, 'author': 'bshepherdson', 'body': 'I haven\'t dug into exactly what\'s happening here yet, but I wanted to chime in with some context.\n\nA ""field ref"" is our term for a reference to a column from another part of the query. There\'s a lot of details but broadly they take one of four forms:\n- `[:field 7 {options...}]` for references directly to fields in your database\n- `[:expression ""name"" {options...}]` for referring to custom columns aka expressions\n- `[:aggregation 0]` for referring to an aggregation column (by its index in the aggregation list)\n- `[:field ""name"" {options...}]` is the hairy one. It\'s used for:\n    - Any column from an earlier stage of the query - *even if it was an expression, aggregation or `[:field 7 ...]` numeric reference in that earlier stage*\n    - Any column from a model (whether it\'s the main source or from a join)\n\nI think it would be illuminating to see the `/api/card/` requests you get on opening each of those models (and probably the underlying `Accounts with Customers` one too). Especially the `dataset_query` and `result_metadata` fields are interesting, since that gives the inner query and the metadata for each one.\n\nMy ""shot in the dark"" theory is that an old bug left the `result_metadata` for the v1 model in a bad state, so it\'s generating a bad query. Since that bug has been fixed since the model was created, you can\'t reproduce the issue with a new model. (Editing the v1 model and saving it again might fix its `result_metadata`. But then we couldn\'t reproduce these issues at all, so maybe don\'t try that just yet!)', 'created_at': datetime.datetime(2024, 11, 21, 16, 12, 58, tzinfo=datetime.timezone.utc)}, {'comment_id': 2493386197, 'issue_id': 2679826324, 'author': 'Simonot', 'body': 'Hello @bshepherdson , thank you a lot for your answer.\n\nI am not sure providing the `/api/card/` will help that much because I did not save the question not working.\nWhat you would want is to have:\n- Feedback V1 with a saved question not working\n- Feedback V2 with a saved question working\nCompare the result of the `/api/card/` ? right ?\n\nIn the mean time let me share some screens of the 2 models:\n- Feedback v1\n![Image](https://github.com/user-attachments/assets/5c992a15-60c1-4e89-9179-22c409d821df)\n![Image](https://github.com/user-attachments/assets/33f370c2-774c-45c4-b2a0-ccd6cd4db2e7)\n- Feedback v2\n![Image](https://github.com/user-attachments/assets/0c926479-6436-46fc-a137-2b3fb7e3a4bf)\n![Image](https://github.com/user-attachments/assets/9df8b7d2-73cb-441e-bc95-e820c930bacb)\n- Account with customers\n![Image](https://github.com/user-attachments/assets/0cb7a160-a672-41c2-833f-e657e10a7ee2)\n![Image](https://github.com/user-attachments/assets/bca542be-4915-469b-b384-c6accc3145b5)\n\n\nIn other words:\n- Both Feedback v1 and Feedback v2 relies on Expressions\n- The Expressions refer to a Column of the model Account with Customers which is a join between Account and Billing Organization. For Account attributes all good, for Billing Organization attributes, it does not work for Feedback V1\n\nWhat is really obscure to me is that:\n- I created Feedback V1 and Feedback V2 roughly at the same time (at that time I had Metabase 50.3 installed)\n- I already tried several changes on Feedback V1 (and therefore saved it) without any success\n- I also tried to create a new Feedback V3 with Metabase 51.4 => same as Feedback V2, I have the ""field_ref"": [""expression"", ""xx""] => all is working correctly\n\n\nWould you like the `/api/card/` API call of ""Account with Customers"" or also ""Feedback V1"" and ""Feedback V2"" ?\nI attached the result of `/api/card` API call for ""Account with Customers"" with only the card of ""Feedback V1"" and ""Feedback V2"" (strangely enough here the field_ref is the same  I just double checked, the issue for ""Feedback V1"" is still present)[card_account_with_customers_feedback_v1.json](https://github.com/user-attachments/files/17868391/card_account_with_customers_feedback_v1.json)\n[card_account_with_customers_feedback_v2.json](https://github.com/user-attachments/files/17868390/card_account_with_customers_feedback_v2.json)', 'created_at': datetime.datetime(2024, 11, 22, 10, 6, 12, tzinfo=datetime.timezone.utc)}]","bshepherdson on (2024-11-21 16:12:58 UTC): I haven't dug into exactly what's happening here yet, but I wanted to chime in with some context.

A ""field ref"" is our term for a reference to a column from another part of the query. There's a lot of details but broadly they take one of four forms:
- `[:field 7 {options...}]` for references directly to fields in your database
- `[:expression ""name"" {options...}]` for referring to custom columns aka expressions
- `[:aggregation 0]` for referring to an aggregation column (by its index in the aggregation list)
- `[:field ""name"" {options...}]` is the hairy one. It's used for:
    - Any column from an earlier stage of the query - *even if it was an expression, aggregation or `[:field 7 ...]` numeric reference in that earlier stage*
    - Any column from a model (whether it's the main source or from a join)

I think it would be illuminating to see the `/api/card/` requests you get on opening each of those models (and probably the underlying `Accounts with Customers` one too). Especially the `dataset_query` and `result_metadata` fields are interesting, since that gives the inner query and the metadata for each one.

My ""shot in the dark"" theory is that an old bug left the `result_metadata` for the v1 model in a bad state, so it's generating a bad query. Since that bug has been fixed since the model was created, you can't reproduce the issue with a new model. (Editing the v1 model and saving it again might fix its `result_metadata`. But then we couldn't reproduce these issues at all, so maybe don't try that just yet!)

Simonot (Issue Creator) on (2024-11-22 10:06:12 UTC): Hello @bshepherdson , thank you a lot for your answer.

I am not sure providing the `/api/card/` will help that much because I did not save the question not working.
What you would want is to have:
- Feedback V1 with a saved question not working
- Feedback V2 with a saved question working
Compare the result of the `/api/card/` ? right ?

In the mean time let me share some screens of the 2 models:
- Feedback v1
![Image](https://github.com/user-attachments/assets/5c992a15-60c1-4e89-9179-22c409d821df)
![Image](https://github.com/user-attachments/assets/33f370c2-774c-45c4-b2a0-ccd6cd4db2e7)
- Feedback v2
![Image](https://github.com/user-attachments/assets/0c926479-6436-46fc-a137-2b3fb7e3a4bf)
![Image](https://github.com/user-attachments/assets/9df8b7d2-73cb-441e-bc95-e820c930bacb)
- Account with customers
![Image](https://github.com/user-attachments/assets/0cb7a160-a672-41c2-833f-e657e10a7ee2)
![Image](https://github.com/user-attachments/assets/bca542be-4915-469b-b384-c6accc3145b5)


In other words:
- Both Feedback v1 and Feedback v2 relies on Expressions
- The Expressions refer to a Column of the model Account with Customers which is a join between Account and Billing Organization. For Account attributes all good, for Billing Organization attributes, it does not work for Feedback V1

What is really obscure to me is that:
- I created Feedback V1 and Feedback V2 roughly at the same time (at that time I had Metabase 50.3 installed)
- I already tried several changes on Feedback V1 (and therefore saved it) without any success
- I also tried to create a new Feedback V3 with Metabase 51.4 => same as Feedback V2, I have the ""field_ref"": [""expression"", ""xx""] => all is working correctly


Would you like the `/api/card/` API call of ""Account with Customers"" or also ""Feedback V1"" and ""Feedback V2"" ?
I attached the result of `/api/card` API call for ""Account with Customers"" with only the card of ""Feedback V1"" and ""Feedback V2"" (strangely enough here the field_ref is the same  I just double checked, the issue for ""Feedback V1"" is still present)[card_account_with_customers_feedback_v1.json](https://github.com/user-attachments/files/17868391/card_account_with_customers_feedback_v1.json)
[card_account_with_customers_feedback_v2.json](https://github.com/user-attachments/files/17868390/card_account_with_customers_feedback_v2.json)

"
2679721371,issue,closed,completed,Visualization settings tabs are part of scrollable content,"### Describe the bug

![Image](https://github.com/user-attachments/assets/b7e19e3b-0b3c-4cbd-b16b-f03e16034c2c)

It'd be great if tabs were not a part of the scrollable area. It causes tabs to get shifted in case we're switching from a scrollable to a non-scrollable tab (and vice versa).

https://github.com/user-attachments/assets/cb10959b-67e5-4630-89f6-3a155e9e60a3


### To Reproduce

1. Open any visualization
2. Open viz settings
3. Change viewport size to low height so that tab content is scrollable vertically

 tab container is scrollable vertically, including the tabs


### Expected behavior

tabs should always stay on top and not be a part of the scrollable element


### Information about your Metabase installation

master, f1e738fc34a635160633cf051589f5ae31b1816a

### Severity

P3

### Additional context

Original report: https://github.com/metabase/metabase/pull/50264/files#r1850337829",kamilmielnik,2024-11-21 14:40:25+00:00,[],2025-02-06 09:38:05+00:00,2025-02-06 08:51:40+00:00,https://github.com/metabase/metabase/issues/50340,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Visualization/Chart Settings', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2679581521,issue,closed,completed,[Epic] Migrate segments to MBQL lib,"```[tasklist]
- [ ] https://github.com/metabase/metabase/pull/50311
- [ ] https://github.com/metabase/metabase/pull/50360
- [ ] https://github.com/metabase/metabase/pull/50363
- [ ] https://github.com/metabase/metabase/pull/50383
```",ranquild,2024-11-21 13:57:00+00:00,['ranquild'],2024-11-22 15:43:01+00:00,2024-11-22 15:43:00+00:00,https://github.com/metabase/metabase/issues/50336,"[('Type:Tech Debt', 'or Refactoring'), ('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]",[],
2679565181,issue,closed,completed,"""Payment banner"" shows on hosted instances","### Describe the bug

The ""payment banner"" is visible in hosted instances but it should be shown only on self-hosted ones instead. Hosted instances have the suspended page when the payment fails.

### To Reproduce

1. Be an admin of a hosted instance
2. Have an unpaid subscription
3. See the payment banner alerting you that the ""pro features will not work"" until the payment is resolved



### Expected behavior

Show this banner only for self-hosted Metabase instances.

### Logs

_No response_

### Information about your Metabase installation

```JSON
N/A
```

### Severity

p2

### Additional context

_No response_",nemanjaglumac,2024-11-21 13:51:56+00:00,['nemanjaglumac'],2024-11-21 16:04:27+00:00,2024-11-21 15:19:00+00:00,https://github.com/metabase/metabase/issues/50335,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Correctness', ''), ('.Frontend', ''), ('Administration/', '')]",[],
2679140501,issue,closed,completed,Add diagnostics information for metrics,"**Context**
Right now we don't gather diagnostics information about metrics while we do for others.
We should fetch the metric entity like we do for questions.",thebiglabasky,2024-11-21 11:28:50+00:00,['thebiglabasky'],2024-11-26 18:50:53+00:00,2024-11-21 16:45:36+00:00,https://github.com/metabase/metabase/issues/50328,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2678950948,issue,closed,completed,Remove the old `EntityListLoader` and clean up,"Depends on #50324


TODO list:
- [x] delete `EntityListLoader`
- [x] rename `EntityListLoaderRtkQuery` to `EntityListLoader`
- [x] delete `EntityType`
- [x] delete `paginationState`
- [x] delete `onLoaded` prop if easy",kamilmielnik,2024-11-21 10:41:28+00:00,['kamilmielnik'],2025-01-27 22:11:55+00:00,2025-01-14 09:02:08+00:00,https://github.com/metabase/metabase/issues/50325,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]",[],
2678950344,issue,closed,completed,Port all entities to use new `EntityListLoaderRtkQuery`,"Depends on #44492.

In #44492 only 1 or 2 types of entities should have been ported.
The goal of this issue is to port all remaining entities to use new `EntityListLoaderRtkQuery`.

### TODO

- [x] verify if `keepListWhileLoading` is needed
  - [x] `CollectionItemsTable` (search)
  - [x] `CollectionContentView` (search)
  - [x] `ModelCacheRefreshJobs` (persisted models)
- [x] refactor pagination
  - [x] `paginationState()`
  - [x] `page` prop
  - [x] `pageSize` prop
  - [x] `onChangeHasMorePages`",kamilmielnik,2024-11-21 10:41:25+00:00,['kamilmielnik'],2025-01-27 22:12:18+00:00,2025-01-09 08:00:15+00:00,https://github.com/metabase/metabase/issues/50324,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]","[{'comment_id': 2579384080, 'issue_id': 2678950344, 'author': 'kamilmielnik', 'body': 'Closed by #51496', 'created_at': datetime.datetime(2025, 1, 9, 8, 0, 15, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2025-01-09 08:00:15 UTC): Closed by #51496

"
2678937340,issue,closed,completed,Port all entities to use new `EntityObjectLoaderRtkQuery`,"Depends on #44491.

In #44491 only 1 or 2 types of entities should have been ported.
The goal of this issue is to port all remaining entities to use new `EntityObjectLoaderRtkQuery`.

  Search for issue URL in code for TODOs.",kamilmielnik,2024-11-21 10:36:59+00:00,['kamilmielnik'],2025-01-27 22:13:43+00:00,2024-12-11 09:50:11+00:00,https://github.com/metabase/metabase/issues/50323,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]",[],
2678935937,issue,closed,completed,Remove the old `EntityObjectLoader` and clean up,"Depends on #51213

The new `EntityObjectLoaderRtkQuery` can now be renamed to `EntityObjectLoader`

TODO list:
- [x] `entityObjectLoader`
- [x] `entity.loadLegacy`
- [x] `entity.Loader`
- [x] delete `EntityObjectLoader`
- [x] rename `EntityObjectLoaderRtkQuery` to `EntityObjectLoader`
- [x] remove unused attributes in `ChildrenProps` in `EntityObjectLoaderRtkQuery.tsx`
- [x] remove unused attributes in `Props` in `EntityObjectLoaderRtkQuery.tsx`
- [x] props destructured in `EntityObjectLoaderRtkQuery.tsx` - reload is commented out
",kamilmielnik,2024-11-21 10:36:19+00:00,['kamilmielnik'],2025-01-27 22:13:16+00:00,2024-12-17 07:48:54+00:00,https://github.com/metabase/metabase/issues/50322,"[('Type:Tech Debt', 'or Refactoring'), ('.Frontend', ''), ('.Team/Querying', '')]",[],
2678525651,issue,closed,completed,[Epic] Migrate entity framework loaders to RTK Query,"### Links
- Eng doc: [[Tech] Migrate entity framework loaders to RTK Query](https://www.notion.so/metabase/Tech-Migrate-entity-framework-loaders-to-RTK-Query-14369354c90180ecadc2d1f1a5dba6e0)
- Feature branches: `master` (early feedback could be invaluable)
- Issue links: 
  - #40788
  - old PR for reference: #50327

### Implementation Plan



```[tasklist]
### Milestone 1 - `EntityObjectLoader`
- [ ] https://github.com/metabase/metabase/issues/44491
- [ ] https://github.com/metabase/metabase/issues/50323
- [ ] https://github.com/metabase/metabase/issues/50873
- [ ] https://github.com/metabase/metabase/issues/51041
- [ ] https://github.com/metabase/metabase/issues/51213
- [ ] https://github.com/metabase/metabase/issues/51050
- [ ] https://github.com/metabase/metabase/issues/50322
- [ ] https://github.com/metabase/metabase/pull/51281
- [ ] https://github.com/metabase/metabase/pull/51333
```

```[tasklist]
### Milestone 2 - `EntityListLoader`
- [ ] https://github.com/metabase/metabase/issues/44492
- [ ] https://github.com/metabase/metabase/issues/50324
- [ ] https://github.com/metabase/metabase/issues/51215
- [ ] https://github.com/metabase/metabase/issues/50325
```",kamilmielnik,2024-11-21 08:37:57+00:00,['kamilmielnik'],2025-01-14 09:09:21+00:00,2025-01-14 09:09:20+00:00,https://github.com/metabase/metabase/issues/50317,"[('.Epic', 'Feature Implementation or Project'), ('.Team/Querying', '')]","[{'comment_id': 2589381689, 'issue_id': 2678525651, 'author': 'kamilmielnik', 'body': 'Done', 'created_at': datetime.datetime(2025, 1, 14, 9, 9, 20, tzinfo=datetime.timezone.utc)}]","kamilmielnik (Issue Creator) on (2025-01-14 09:09:20 UTC): Done

"
2678139328,issue,closed,completed,Remove `?locale` support on static embeds/public links,See this [Slack discussion](https://metaboat.slack.com/archives/C063Q3F1HPF/p1732012198773409?thread_ts=1732004214.023669&cid=C063Q3F1HPF),WiNloSt,2024-11-21 05:55:13+00:00,['WiNloSt'],2024-11-26 18:50:38+00:00,2024-11-26 15:13:39+00:00,https://github.com/metabase/metabase/issues/50313,[],[],
2677671761,issue,open,,Pooling database sync status triggers rerender that hides ECharts tooltips,"**Steps to reproduce**

- Login as an admin
- Connect a large database that it takes time to sync: frontend will pool the database endpoint to check if sync is finished
- While sync is in progress, create a bar chart and hover bars
- The tooltip gets hidden on every pooling request

**Severity**
Annoying",alxnddr,2024-11-21 01:22:14+00:00,[],2025-02-04 20:29:55+00:00,,https://github.com/metabase/metabase/issues/50309,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Visualization/', ''), ('.Frontend', ''), ('.Team/DashViz', 'Dashboard and Viz team')]",[],
2677464496,issue,open,,Columns Sharing the Same Name Different Tables Cannot both be Referenced in Custom Expressions Post Aggregate,"### Describe the bug

If you have two tables in a question and each table contains a column with the same name, you can take a MAX of each field at the summary stage but only one will be available to select in a customer expression post aggregate.

### To Reproduce

https://www.loom.com/share/186dea5516264a9f85b4cf5ac662e653

### Expected behavior

Both aggregated fields should be available in the second level of the query.

### Logs

_No response_

### Information about your Metabase installation

```JSON
v51.3
```

### Severity

annoying

### Additional context

_No response_",ixipixi,2024-11-20 23:04:27+00:00,[],2025-02-05 14:50:47+00:00,,https://github.com/metabase/metabase/issues/50308,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Querying/MBQL', ''), ('.Backend', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', '')]","[{'comment_id': 2490209966, 'issue_id': 2677464496, 'author': 'crisptrutski', 'body': 'Unsure if this is a FE or BE issue', 'created_at': datetime.datetime(2024, 11, 21, 6, 51, 34, tzinfo=datetime.timezone.utc)}]","crisptrutski on (2024-11-21 06:51:34 UTC): Unsure if this is a FE or BE issue

"
2677193213,issue,closed,completed,Users without Full Download Permissions Cannot DL Results of certain Questions,"### Describe the bug

User cannot download the results of a question built from the combo of a table and another question unless they have DL access to every table in the database.

### To Reproduce

1. Set up v51
2.  Go to data permissions and revoke access to any table except Orders
3. Create a Question from the Orders table (note that you can download results)
4. Create another question from the Orders table and join it the first Question
5. Save- note that you cannot download results
7. Go to data permissions and grant DL access to the table you removed it from
8. Refresh your test question and you can now DL again

### Expected behavior

User should be able to download

### Logs

_No response_

### Information about your Metabase installation

```JSON
v51.3
```

### Severity

Annoying

### Additional context

_No response_",ixipixi,2024-11-20 21:08:45+00:00,['noahmoss'],2024-11-25 15:47:13+00:00,2024-11-22 22:27:10+00:00,https://github.com/metabase/metabase/issues/50304,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('Administration/Permissions', 'Collection or Data permissions'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2677044360,issue,open,,New Delta Table Under Trino Shows 'No Fields Found' Until Table is Hidden and Unhidden in metabase,"### Describe the bug

When adding a new Delta table under Trino, the table appears in Metabase with its icon visible. However, clicking on the table results in the error message:
_No fields found for table ""table_name""._

Despite this, executing native queries against the table works correctly. The issue prevents users from viewing data by clicking on the table or using the Metabase UI to build queries. The problem is resolved after hiding and then unhiding the table in the Metabase admin panel.

### To Reproduce

1. Add a new Delta table under Trino that is accessible to Metabase (using hive).
2. Open Metabase and navigate to the connected Trino database.
3. Locate and click on the new table. The table icon is present, indicating it's recognized by Metabase.
4. Observe that an error message appears: No fields found for table ""table_name"".

### Expected behavior

- The table's fields should be displayed upon clicking.
- Data within the table should be viewable.
- Users should be able to build queries using the Metabase UI without encountering errors.

### Logs

_No response_

### Information about your Metabase installation

```JSON
- metabase:v0.50.32
- trino:463
- hive:3.1.3
```

### Severity

P4

### Additional context

_No response_",elham-shojaei,2024-11-20 20:09:21+00:00,[],2025-02-04 20:24:36+00:00,,https://github.com/metabase/metabase/issues/50301,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('Administration/Metadata & Sync', ''), ('.Team/Drivers', '')]","[{'comment_id': 2489474358, 'issue_id': 2677044360, 'author': 'paoliniluis', 'body': 'Have you tried upgrading to latest metabase and latest trino driver?', 'created_at': datetime.datetime(2024, 11, 20, 20, 22, 4, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-11-20 20:22:04 UTC): Have you tried upgrading to latest metabase and latest trino driver?

"
2677024938,issue,closed,not_planned,Tooltips Stop Working When Using iFrameResize with Embedded Metabase Dashboards,"### Describe the bug

When embedding a Metabase dashboard using the iFrameResize library, tooltips within the dashboard stop functioning as expected. This issue does not occur when the dashboard is embedded without the iFrameResize integration.

This issue is highly severe because embedding is the only way to integrate Metabase dashboards into other applications. The lack of functioning tooltips disrupts the user experience, especially for interactive visualizations, impacting the utility of Metabase in external-facing applications.

### To Reproduce

1. Embed a Metabase dashboard into a webpage using the following HTML structure:
html
```
<section class=""dashboard-section"">
    <h2>Dashboard 1</h2>
    <div class=""iframe-wrapper"">
        <iframe
            src=""<%= iframeUrl %>""
            frameborder=""0""
            allowfullscreen
            onload=""iFrameResize({}, this)""
        ></iframe>
    </div>
</section>
```
2. Include the iFrameResize library from Metabase:
```
<script src="".../app/iframeResizer.js""></script>
```
3. View the embedded dashboard and attempt to interact with tooltips (e.g., hover over a chart element).


### Expected behavior

Tooltips should work as intended within the embedded dashboard, regardless of whether iFrameResize is used.


### Logs

_No response_

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""es-ES"",
    ""platform"": ""Linux x86_64"",
    ""userAgent"": ""Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36"",
    ""vendor"": ""Google Inc.""
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-11"",
      ""tag"": ""v0.51.3"",
      ""hash"": ""d757d0b""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""unknown"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""12.20""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.23+9-LTS"",
    ""java.vendor"": ""Red Hat, Inc."",
    ""java.vendor.url"": ""https://www.redhat.com/"",
    ""java.version"": ""11.0.23"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.23+9-LTS"",
    ""os.name"": ""Linux"",
    ""os.version"": ""3.10.0-1160.114.2.el7.x86_64"",
    ""user.language"": ""es"",
    ""user.timezone"": ""Europe/Madrid""
  }
}
```

### Severity

high

### Additional context

_No response_",rodrigoGA,2024-11-20 19:58:07+00:00,[],2024-11-20 20:23:32+00:00,2024-11-20 20:23:32+00:00,https://github.com/metabase/metabase/issues/50300,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2489476429, 'issue_id': 2677024938, 'author': 'paoliniluis', 'body': 'same as https://github.com/metabase/metabase/issues/49219?', 'created_at': datetime.datetime(2024, 11, 20, 20, 23, 28, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-11-20 20:23:28 UTC): same as https://github.com/metabase/metabase/issues/49219?

"
2676895715,issue,open,,"Make columns in Summarize sidebar draggable, the same as in the notebook editor","https://metaboat.slack.com/archives/C01LQQ2UW03/p1731523013633789

[PoC](https://github.com/metabase/metabase/pull/52341)",mngr,2024-11-20 19:11:19+00:00,[],2025-02-04 20:31:01+00:00,,https://github.com/metabase/metabase/issues/50296,"[('Type:New Feature', ''), ('Querying/GUI', 'Query builder catch-all, including simple mode'), ('.Team/Querying', '')]",[],
2676772095,issue,open,,[Epic] Query permission: drill-through,[Product doc](https://www.notion.so/metabase/Query-permission-Drill-through-14469354c901806f9c2fc78c40511805?pvs=4),luizarakaki,2024-11-20 18:27:42+00:00,[],2025-02-04 20:24:36+00:00,,https://github.com/metabase/metabase/issues/50294,"[('Administration/Permissions', 'Collection or Data permissions'), ('.Epic', 'Feature Implementation or Project'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2676766194,issue,open,,[Epic] Make Tenants a first-class citizen,[Product doc](https://www.notion.so/metabase/Tenants-v1-13569354c901806fbd38da8f10080a67?pvs=4),luizarakaki,2024-11-20 18:24:12+00:00,[],2024-11-20 18:24:14+00:00,,https://github.com/metabase/metabase/issues/50292,"[('.Epic', 'Feature Implementation or Project'), ('.Team/AdminWebapp', 'Admin and Webapp team')]",[],
2676479934,issue,open,reopened,"[SDK] ""Back to previous results"" in Interactive question navigates on the host app","https://github.com/user-attachments/assets/38cc2530-7503-4865-9920-a5ddee485456


Reproduced it with
```
 <InteractiveQuestion questionId={1}>
            <div
              style={{
                display: ""flex"",
                flexDirection: ""column"",
                alignItems: ""center"",
                justifyContent: ""center"",
              }}
            >
              <div
                style={{
                  display: ""grid"",
                  placeItems: ""center"",
                  border: ""1px solid red"",
                }}
              >
                <InteractiveQuestion.Title />
                <InteractiveQuestion.ResetButton />
              </div>
              <div
                style={{
                  display: ""flex"",
                  alignItems: ""center"",
                  justifyContent: ""flex-start"",
                  overflow: ""hidden"",
                  border: ""1px solid blue"",
                  minWidth: ""600px"",
                }}
              >
                <div style={{ width: ""100%"" }}>
                  <InteractiveQuestion.FilterBar />
                  <InteractiveQuestion.QuestionVisualization />
                </div>
                <div style={{ display: ""flex"", flex: 1, overflow: ""scroll"" }}>
                  {/* <InteractiveQuestion.Summarize /> */}
                </div>
              </div>
              <div style={{ display: ""flex"", flexDirection: ""column"" }}>
                {/* <InteractiveQuestion.Filter /> */}
              </div>
            </div>
          </InteractiveQuestion>
```",npretto,2024-11-20 16:44:36+00:00,[],2025-02-04 20:25:57+00:00,,https://github.com/metabase/metabase/issues/50286,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2577843141, 'issue_id': 2676479934, 'author': 'WiNloSt', 'body': '@npretto I couldn\'t repro this anymore, so I\'m closing this. Can you confirm this doesn\'t happen anymore?\n\nI used `""@metabase/embedding-sdk-react"": ""^0.52.6""` to test this', 'created_at': datetime.datetime(2025, 1, 8, 14, 42, 36, tzinfo=datetime.timezone.utc)}, {'comment_id': 2577846878, 'issue_id': 2676479934, 'author': 'WiNloSt', 'body': '@npretto ignore my previous comment, I tested it wrong, this is still happening', 'created_at': datetime.datetime(2025, 1, 8, 14, 44, 10, tzinfo=datetime.timezone.utc)}]","WiNloSt on (2025-01-08 14:42:36 UTC): @npretto I couldn't repro this anymore, so I'm closing this. Can you confirm this doesn't happen anymore?

I used `""@metabase/embedding-sdk-react"": ""^0.52.6""` to test this

WiNloSt on (2025-01-08 14:44:10 UTC): @npretto ignore my previous comment, I tested it wrong, this is still happening

"
2676015143,issue,closed,completed,"[SDK] if the sdk is imported after the css of the host app, the body and h1 tags takes the styles from core app","This is mostly an edge case that reproduces https://github.com/metabase/metabase/issues/44802

This will affect anyone using next as they'll need to lazy load the sdk components to disable ssr

![Image](https://github.com/user-attachments/assets/a2d5a827-dd00-40c3-95cc-0225b6bf4fd6)

https://github.com/user-attachments/assets/d43c8267-9a77-42bd-b2e4-347a5e91913d
",npretto,2024-11-20 14:18:41+00:00,['npretto'],2024-12-06 14:23:28+00:00,2024-12-03 17:19:51+00:00,https://github.com/metabase/metabase/issues/50279,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Team/Embedding', ''), ('Embedding/SDK', 'Embedding SDK for React')]","[{'comment_id': 2523360302, 'issue_id': 2676015143, 'author': 'github-actions[bot]', 'body': ' This should also be released by [v0.52.1](https://github.com/metabase/metabase/milestone/283)', 'created_at': datetime.datetime(2024, 12, 6, 14, 23, 26, tzinfo=datetime.timezone.utc)}]","github-actions[bot] on (2024-12-06 14:23:26 UTC):  This should also be released by [v0.52.1](https://github.com/metabase/metabase/milestone/283)

"
2675654357,issue,closed,completed,Track analytics events for bug reporting,"**Context**
We want to keep tabs on usage of the bug reporting feature in a minimalist way.
Details in [this section of the Product Doc](https://www.notion.so/metabase/Make-it-blazingly-fast-for-people-to-report-bugs-11f69354c90180aaa6ffd17c1cd147c6?pvs=4#11f69354c901812a8656c4bd033c45e9)

",thebiglabasky,2024-11-20 12:00:42+00:00,['filiphric'],2024-12-12 14:22:22+00:00,2024-12-12 14:22:22+00:00,https://github.com/metabase/metabase/issues/50273,"[('.Task', 'Not a part of any Epic, used by the Task Issue Template')]",[],
2675575898,issue,open,,"Enable Browser ""Go Back"" Button for Filter Undo in Dashboards","### Summary:
Allow the standard browser ""Go Back"" button to act as an Undo Filter mechanism in Metabase dashboards, enabling users to easily revert their most recent filter changes. This would provide a seamless, intuitive way to restore previous states without requiring additional UI elements or features.

### Description:
When working with filters in Metabase dashboards, users often adjust filters to explore data interactively. However, reverting a filter change currently requires manually resetting or reconfiguring the filters. By enabling the browser's ""Go Back"" functionality to undo the last filter change, users can leverage familiar browser navigation controls to simplify this process.

### Proposed Behavior:

- **Browser Integration**: Ensure that filter changes update the browser history, so the ""Go Back"" button reverts the filter to its previous state.
- **State Restoration**: The dashboard visualizations should reflect the restored filter settings as the user navigates back.
- **Forward Navigation**: The ""Go Forward"" button should allow users to redo filter changes if needed.
- **Seamless Experience**: No additional UI changes needed, leveraging existing browser functionality for intuitive undo/redo actions.

### Benefits:

- **User Familiarity**: Users are already accustomed to using browser navigation controls, reducing the learning curve.
- **Efficient Workflow**: Quickly revert unintended filter changes without additional clicks or steps.
- **Enhanced Flexibility**: Encourages data exploration by making it easy to experiment with filters and revert changes.
- **Low Overhead**: Requires minimal changes to the UI and relies on standard browser functionality.

### Example Use Case:
A user applies a category filter to view ""Electronics"" but then switches to ""Clothing"" to compare. To go back to the previous view of ""Electronics,"" the user can simply press the browser's ""Go Back"" button instead of reapplying the filter manually.

",alekhed,2024-11-20 11:29:40+00:00,[],2025-02-04 20:29:45+00:00,,https://github.com/metabase/metabase/issues/50272,"[('Reporting/Dashboards/Filters & Parameters', 'Related to the setup and use of filters and parameters in dashboards only')]","[{'comment_id': 2503768794, 'issue_id': 2675575898, 'author': 'alekhed', 'body': 'Is any chance to get feedback? ', 'created_at': datetime.datetime(2024, 11, 27, 12, 36, 24, tzinfo=datetime.timezone.utc)}, {'comment_id': 2569161267, 'issue_id': 2675575898, 'author': 'brunobergher', 'body': '@alekhed, I understand the upside of what you\'re describing. But on the flip side this means that if a user, say, searches for a dashboard, clicks on a result and changes a couple of values, they\'d have to hit ""back"" in their browser many times until they\'re able to go back to the search results, which I think is more burdensome than the current behavior for filters.', 'created_at': datetime.datetime(2025, 1, 3, 12, 38, 3, tzinfo=datetime.timezone.utc)}]","alekhed (Issue Creator) on (2024-11-27 12:36:24 UTC): Is any chance to get feedback? 

brunobergher on (2025-01-03 12:38:03 UTC): @alekhed, I understand the upside of what you're describing. But on the flip side this means that if a user, say, searches for a dashboard, clicks on a result and changes a couple of values, they'd have to hit ""back"" in their browser many times until they're able to go back to the search results, which I think is more burdensome than the current behavior for filters.

"
2675434958,issue,closed,not_planned,Migrating Metabase Application DB from MySQL to Postgres,"I am migrating my Metabase server from one AWS region to another. The Metabase application is running using Docker Compose, and the application database is hosted on an AWS RDS MySQL Community DB (version 8.0.35). I have attempted multiple methods for migrating both the Metabase application database and the server itself but am encountering issues related to table migration. 

**Steps I Have Tried:**
*AWS DMS Migration:* I have tried migrating the Metabase application database using the AWS DMS service but encountered errors. I also, I have read somewhere that AWS DMS won't migrate Foreign Key constraints and other things, so stopped this.

*Metabase CLI Command (migrate print)*: I used the Metabase CLI command `migrate print` which provided me with the script and used that script to run on the target database server to apply migrations and pointed the metabase application database to this new db endpoint but running the SQL scripts skips SQL queries since some of the `relations` are not in place. 

*Dump and Load Method*: I used the dump-to-h2 (for MySQL) method to dump the database. Then, I used the load-from-h2 (for PostgreSQL) to load it onto the target server, but I received errors related to tables during the load process.

Logs for Dump and Load Method -> 
`Metabase Enterprise Edition extensions are NOT PRESENT.
2024-11-20 11:18:40,289 INFO driver.impl :: Registered abstract driver :metabase.driver.sql-jdbc.execute.legacy-impl/use-legacy-classes-for-read-and-set  
2024-11-20 11:18:40,298 INFO driver.impl :: Registered abstract driver :metabase.driver.sql.query-processor.empty-string-is-null/empty-string-is-null  
2024-11-20 11:18:40,715 INFO cmd.copy :: Set up h2 source database and run migrations... 
2024-11-20 11:18:40,717 INFO db.setup :: Verifying h2 Database Connection ...
2024-11-20 11:18:42,020 INFO db.setup :: Successfully verified H2 2.1.214 (2022-06-13) application database connection. 
2024-11-20 11:18:42,490 INFO db.setup :: Checking if a database downgrade is required...
2024-11-20 11:18:42,645 INFO liquibase.database :: Set default schema name to PUBLIC
2024-11-20 11:18:43,486 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-20 11:18:44,072 INFO db.setup :: Running Database Migrations...
2024-11-20 11:18:44,182 INFO db.setup :: Setting up Liquibase...
2024-11-20 11:18:44,190 INFO liquibase.database :: Set default schema name to PUBLIC
2024-11-20 11:18:44,459 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-20 11:18:44,482 INFO db.liquibase :: Updating liquibase table to reflect consolidated changeset filenames
2024-11-20 11:18:44,528 INFO liquibase.lockservice :: Successfully acquired change log lock
2024-11-20 11:18:44,530 INFO db.liquibase :: No migration lock found.
2024-11-20 11:18:44,531 INFO db.liquibase :: Migration lock acquired.
2024-11-20 11:18:44,592 INFO liquibase.lockservice :: Successfully released change log lock
2024-11-20 11:18:44,593 INFO db.setup :: Liquibase is ready.
2024-11-20 11:18:44,594 INFO db.liquibase :: Checking if Database has unrun migrations...
2024-11-20 11:18:44,632 INFO liquibase.database :: Set default schema name to PUBLIC
2024-11-20 11:18:44,976 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-20 11:18:45,002 INFO liquibase.changelog :: Reading from ""PUBLIC"".""DATABASECHANGELOG""
2024-11-20 11:18:45,325 INFO db.liquibase :: No unrun migrations found.
2024-11-20 11:18:45,906 INFO db.setup :: Database Migrations Current ... 
2024-11-20 11:18:45,909 INFO metabase.util :: Database setup took 5.2 s
2024-11-20 11:18:45,910 INFO cmd.copy :: [OK]
2024-11-20 11:18:45,912 INFO cmd.copy :: Set up postgres target database and run migrations... 
2024-11-20 11:18:45,912 INFO db.setup :: Verifying postgres Database Connection ...
2024-11-20 11:18:46,345 INFO db.setup :: Successfully verified PostgreSQL 14.12 application database connection. 
2024-11-20 11:18:46,346 INFO db.setup :: Checking if a database downgrade is required...
2024-11-20 11:18:46,385 INFO liquibase.database :: Set default schema name to metabase
2024-11-20 11:18:46,610 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-20 11:18:46,620 INFO liquibase.changelog :: Creating database history table with name: metabase.databasechangelog
2024-11-20 11:18:46,687 INFO db.setup :: Running Database Migrations...
2024-11-20 11:18:46,688 INFO db.setup :: Setting up Liquibase...
2024-11-20 11:18:46,698 INFO liquibase.database :: Set default schema name to metabase
2024-11-20 11:18:46,859 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-20 11:18:46,894 INFO db.liquibase :: Updating liquibase table to reflect consolidated changeset filenames
2024-11-20 11:18:46,907 INFO liquibase.lockservice :: Successfully acquired change log lock
2024-11-20 11:18:46,909 INFO db.liquibase :: No migration lock found.
2024-11-20 11:18:46,909 INFO db.liquibase :: Migration lock acquired.
2024-11-20 11:18:46,917 INFO liquibase.lockservice :: Successfully released change log lock
2024-11-20 11:18:46,919 INFO db.setup :: Liquibase is ready.
2024-11-20 11:18:46,919 INFO db.liquibase :: Checking if Database has unrun migrations...
2024-11-20 11:18:46,937 INFO liquibase.database :: Set default schema name to metabase
2024-11-20 11:18:47,098 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-20 11:18:47,134 INFO liquibase.changelog :: Reading from metabase.databasechangelog
2024-11-20 11:18:47,531 INFO db.liquibase :: Database has unrun migrations. Checking if migration lock is taken...
2024-11-20 11:18:47,544 INFO liquibase.lockservice :: Successfully acquired change log lock
2024-11-20 11:18:47,546 INFO db.liquibase :: No migration lock found.
2024-11-20 11:18:47,546 INFO db.liquibase :: Migration lock acquired.
2024-11-20 11:18:47,553 INFO liquibase.database :: Set default schema name to metabase
2024-11-20 11:18:47,688 INFO liquibase :: Parsed changelog file 'liquibase.yaml'
2024-11-20 11:18:47,708 INFO liquibase.changelog :: Reading from metabase.databasechangelog
2024-11-20 11:18:47,789 INFO db.liquibase :: Running 420 migrations ...
2024-11-20 11:18:47,903 INFO liquibase.changelog :: Reading from metabase.databasechangelog
2024-11-20 11:18:48,038 INFO liquibase.command :: Using deploymentId: 2101528038
2024-11-20 11:18:48,042 INFO liquibase.changelog :: Reading from metabase.databasechangelog
2024-11-20 11:18:48,181 INFO liquibase.snapshot :: Creating snapshot
2024-11-20 11:18:48,527 WARN liquibase.executor :: extension ""citext"" already exists, skipping
2024-11-20 11:18:50,127 INFO liquibase.changelog :: SQL in file initialization/metabase_postgres.sql executed
2024-11-20 11:18:50,133 INFO liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v00.00-000::qnkhuat ran successfully in 1954ms
2024-11-20 11:18:50,166 INFO liquibase.changelog :: Table action created
2024-11-20 11:18:50,169 INFO liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v45.00-001::snoe ran successfully in 26ms
2024-11-20 11:18:50,190 ERROR liquibase.changelog :: ChangeSet migrations/001_update_migrations.yaml::v45.00-002::snoe encountered an exception.
liquibase.exception.DatabaseException: ERROR: relation ""metabase.report_card"" does not exist [Failed SQL: (0) CREATE TABLE ""metabase"".""query_action"" (""action_id"" INTEGER NOT NULL, ""card_id"" INTEGER NOT NULL, CONSTRAINT ""fk_query_action_ref_card_id"" FOREIGN KEY (""card_id"") REFERENCES ""metabase"".""report_card""(""id"") ON DELETE CASCADE, CONSTRAINT ""fk_query_action_ref_action_id"" FOREIGN KEY (""action_id"") REFERENCES ""metabase"".""action""(""id"") ON DELETE CASCADE)]
`

**Current Setup:**
Docker Compose: I am launching the Metabase server using Docker Compose.
Metabase Version: v0.51.3 (released on 2024-11-11)
Application Database: MySQL (version 8.0.35) on AWS RDS Community Edition

**Target Setup:**
Docker Compose
Metabase Version: v0.51.3 
Application Database: PostgreSQL on AWS RDS 

**Current Metabase Server Info:** 
""metabase-info"": {
  ""databases"": [
    ""h2"",
    ""mongo"",
    ""postgres"",
    ""clickhouse""
  ],
  ""run-mode"": ""prod"",
  ""plan-alias"": """",
  ""version"": {
    ""date"": ""2024-11-11"",
    ""tag"": ""v0.51.3"",
    ""hash"": ""d757d0b""
  },
  ""settings"": {
    ""report-timezone"": ""UTC""
  },
  ""hosting-env"": ""unknown"",
  ""application-database"": ""mysql"",
  ""application-database-details"": {
    ""database"": {
      ""name"": ""MySQL"",
      ""version"": ""8.0.35""
    },
    ""jdbc-driver"": {
      ""name"": ""MariaDB Connector/J"",
      ""version"": ""2.7.10""
    }
  }
}

**Request:**
Can you provide guidance or best practices for migrating the Metabase database from MySQL to PostgreSQL in a different region without encountering table issues?
Are there any known issues with the migration process, particularly when using AWS DMS or Metabase CLI tools?
Suggestions for troubleshooting the table errors encountered during the migration process.",wasimb-atica,2024-11-20 10:48:06+00:00,[],2024-11-20 11:29:11+00:00,2024-11-20 11:28:56+00:00,https://github.com/metabase/metabase/issues/50270,[],"[{'comment_id': 2488331473, 'issue_id': 2675434958, 'author': 'paoliniluis', 'body': 'Please post questions on the forum', 'created_at': datetime.datetime(2024, 11, 20, 11, 29, 10, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-11-20 11:29:10 UTC): Please post questions on the forum

"
2675429445,issue,open,,Adjust the admin option to report bug to use the same bug reporter window,"**Context**
Right now, on this page http://localhost:3000/admin/troubleshooting/help we offer admins to file a bug report to GitHub, we should make that button do exactly what the ""Report bug"" feature will do to streamline it.
 - [ ] Remove the preview of the diagnostics (since we'll lean on the modal)
 - [ ] Make the ""File a bug report"" button open the ""new report a bug modal""

Capture:
![Image](https://github.com/user-attachments/assets/596e04a1-0bb7-4b6a-8d7e-dc29deb7bba2)
",thebiglabasky,2024-11-20 10:46:32+00:00,[],2025-01-23 08:58:58+00:00,,https://github.com/metabase/metabase/issues/50269,[],"[{'comment_id': 2542235749, 'issue_id': 2675429445, 'author': 'thebiglabasky', 'body': ""I'll extract this one as its own issue since I'm not convinced this is a priority just yet"", 'created_at': datetime.datetime(2024, 12, 13, 20, 17, 35, tzinfo=datetime.timezone.utc)}]","thebiglabasky (Issue Creator) on (2024-12-13 20:17:35 UTC): I'll extract this one as its own issue since I'm not convinced this is a priority just yet

"
2675251941,issue,closed,not_planned,metabase with clickhouse: No method in multimethod 'connection-details->spec' for dispatch value: :clickhouse,"### Describe the bug

after upgrade to latest metabase and metabase clickhouse driver, it fails to work with clickhouse.

metabase: v0.51.4.1
clickhouse driver: 1.5.1


error on clickhouse query:

ERROR middleware.catch-exceptions :: Error processing query: No method in multimethod 'connection-details->spec' for dispatch value: :clickhouse


### To Reproduce

1. metabase: v0.51.4.1
2. clickhouse driver: 1.5.1
3. deploy with docker image
4. when loading a clickhouse query page, error: No method in multimethod 'connection-details->spec' for dispatch value: :clickhouse


### Expected behavior

_No response_

### Logs

```
2024-11-20 13:11:08,501 ERROR middleware.catch-exceptions :: Error processing query: No method in multimethod 'connection-details->spec' for dispatch value: :clickhouse
{:database_id 16,
 :started_at #t ""2024-11-20T13:11:08.479414Z[GMT]"",
 :action_id nil,
 :json_query
 {:type ""native"",
  :database 16,
  :native {:query ""select 1"", :template-tags {}},
  :parameters [],
  :middleware {:js-int-to-string? true, :userland-query? true, :add-default-userland-constraints? true}},
 :status :failed,
 :class java.lang.IllegalArgumentException,
 :stacktrace
 [""clojure.lang.MultiFn.getFn(MultiFn.java:156)""
  ""clojure.lang.MultiFn.invoke(MultiFn.java:233)""
  ""--> driver.sql_jdbc.connection$create_pool_BANG_.invokeStatic(connection.clj:218)""
  ""driver.sql_jdbc.connection$create_pool_BANG_.invoke(connection.clj:206)""
  ""driver.sql_jdbc.connection$db__GT_pooled_connection_spec.invokeStatic(connection.clj:348)""
  ""driver.sql_jdbc.connection$db__GT_pooled_connection_spec.invoke(connection.clj:282)""
  ""driver.sql_jdbc.execute$datasource.invokeStatic(execute.clj:198)""
  ""driver.sql_jdbc.execute$datasource.invoke(execute.clj:194)""
  ""driver.sql_jdbc.execute$datasource_with_diagnostic_info_BANG_.invokeStatic(execute.clj:205)""
  ""driver.sql_jdbc.execute$datasource_with_diagnostic_info_BANG_.invoke(execute.clj:200)""
  ""driver.sql_jdbc.execute$do_with_resolved_connection_data_source87031__87033.invokeStatic(execute.clj:300)""
  ""driver.sql_jdbc.execute$do_with_resolved_connection_data_source87031__87033.invoke(execute.clj:266)""
  ""driver.sql_jdbc.execute$do_with_resolved_connection87046__87047.invokeStatic(execute.clj:337)""
  ""driver.sql_jdbc.execute$do_with_resolved_connection87046__87047.invoke(execute.clj:321)""
  ""driver.sql_jdbc.execute$fn__87076.invokeStatic(execute.clj:392)""
  ""driver.sql_jdbc.execute$fn__87076.invoke(execute.clj:390)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:708)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:705)""
  ""driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:694)""
  ""driver.sql_jdbc$fn__113463.invokeStatic(sql_jdbc.clj:79)""
  ""driver.sql_jdbc$fn__113463.invoke(sql_jdbc.clj:77)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invokeStatic(pipeline.clj:52)""
  ""query_processor.pipeline$_STAR_execute_STAR_.invoke(pipeline.clj:39)""
  ""query_processor.pipeline$_STAR_run_STAR_.invokeStatic(pipeline.clj:102)""
  ""query_processor.pipeline$_STAR_run_STAR_.invoke(pipeline.clj:95)""
  ""query_processor.execute$run.invokeStatic(execute.clj:62)""
  ""query_processor.execute$run.invoke(execute.clj:56)""
  ""query_processor.middleware.update_used_cards$update_used_cards_BANG_76934__76935$fn__76936.invoke(update_used_cards.clj:60)""
  ""query_processor.execute$add_native_form_to_result_metadata$fn__76951.invoke(execute.clj:25)""
  ""query_processor.execute$add_preprocessed_query_to_result_metadata_for_userland_query$fn__76957.invoke(execute.clj:36)""
  ""query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___76907.invoke(cache.clj:241)""
  ""query_processor.middleware.permissions$check_query_permissions$fn__73944.invoke(permissions.clj:148)""
  ""query_processor.middleware.enterprise$check_download_permissions_middleware$fn__74655.invoke(enterprise.clj:51)""
  ""query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__74665.invoke(enterprise.clj:64)""
  ""query_processor.execute$execute76984__76985$fn__76986.invoke(execute.clj:94)""
  ""query_processor.setup$do_with_qp_setup75180__75181.invokeStatic(setup.clj:225)""
  ""query_processor.setup$do_with_qp_setup75180__75181.invoke(setup.clj:216)""
  ""query_processor.execute$execute76984__76985.invokeStatic(execute.clj:93)""
  ""query_processor.execute$execute76984__76985.invoke(execute.clj:89)""
  ""query_processor$process_query_STAR__STAR_.invokeStatic(query_processor.clj:49)""
  ""query_processor$process_query_STAR__STAR_.invoke(query_processor.clj:44)""
  ""query_processor.middleware.enterprise$fn__74682$handle_audit_app_internal_queries__74683$fn__74685.invoke(enterprise.clj:96)""
  ""query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__74693.invoke(enterprise.clj:103)""
  ""query_processor.middleware.process_userland_query$process_userland_query_middleware77840__77841$fn__77842.invoke(process_userland_query.clj:204)""
  ""query_processor.middleware.catch_exceptions$catch_exceptions77905__77906$fn__77907.invoke(catch_exceptions.clj:132)""
  ""query_processor$process_query77946__77947$fn__77948.invoke(query_processor.clj:80)""
  ""query_processor.setup$do_with_canceled_chan75175__75176$fn__75177.invoke(setup.clj:187)""
  ""query_processor.setup$do_with_database_local_settings75168__75169$fn__75170.invoke(setup.clj:181)""
  ""query_processor.setup$do_with_driver75161__75162$fn__75163$fn__75164.invoke(setup.clj:166)""
  ""driver$do_with_driver.invokeStatic(driver.clj:106)""
  ""driver$do_with_driver.invoke(driver.clj:101)""
  ""query_processor.setup$do_with_driver75161__75162$fn__75163.invoke(setup.clj:165)""
  ""query_processor.setup$do_with_metadata_provider75152__75153$fn__75154$fn__75157.invoke(setup.clj:151)""
  ""query_processor.store$do_with_metadata_provider58675__58676.invokeStatic(store.clj:170)""
  ""query_processor.store$do_with_metadata_provider58675__58676.invoke(store.clj:150)""
  ""query_processor.store$do_with_metadata_provider58675__58676.invokeStatic(store.clj:159)""
  ""query_processor.store$do_with_metadata_provider58675__58676.invoke(store.clj:150)""
  ""query_processor.setup$do_with_metadata_provider75152__75153$fn__75154.invoke(setup.clj:150)""
  ""query_processor.setup$do_with_resolved_database75142__75143$fn__75144.invoke(setup.clj:128)""
  ""query_processor.setup$do_with_qp_setup75180__75181.invokeStatic(setup.clj:232)""
  ""query_processor.setup$do_with_qp_setup75180__75181.invoke(setup.clj:216)""
  ""query_processor$process_query77946__77947.invokeStatic(query_processor.clj:78)""
  ""query_processor$process_query77946__77947.invoke(query_processor.clj:71)""
  ""api.dataset$run_streaming_query100098__100101$fn__100105.invoke(dataset.clj:84)""
  ""query_processor.streaming$_streaming_response$fn__61518$fn__61519$fn__61520.invoke(streaming.clj:175)""
  ""query_processor.streaming$_streaming_response$fn__61518$fn__61519.invoke(streaming.clj:173)""
  ""query_processor.streaming$do_with_streaming_rff.invokeStatic(streaming.clj:164)""
  ""query_processor.streaming$do_with_streaming_rff.invoke(streaming.clj:151)""
  ""query_processor.streaming$_streaming_response$fn__61518.invoke(streaming.clj:170)""
  ""async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:78)""
  ""async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:76)""
  ""async.streaming_response$do_f_async$task__53163.invoke(streaming_response.clj:97)""],
 :card_id nil,
 :context :ad-hoc,
 :error ""No method in multimethod 'connection-details->spec' for dispatch value: :clickhouse"",
 :row_count 0,
 :running_time 0,
 :data {:rows [], :cols []}}

2024-11-20 13:11:08,504 DEBUG middleware.log :: POST /api/dataset 202 [ASYNC: completed] 36.5 ms (2 DB calls) App DB connections: 2/13 Jetty threads: 3/254 (6 idle, 0 queued) (73 total active threads) Queries
```


### Information about your Metabase installation

```JSON
1. metabase: v0.51.4.1
2. clickhouse driver: 1.5.1
3. deploy with docker image
```

### Severity

blocking usage of Metabase with clickhouse

### Additional context

_No response_",code1704,2024-11-20 09:53:20+00:00,[],2024-11-20 14:12:09+00:00,2024-11-20 14:09:17+00:00,https://github.com/metabase/metabase/issues/50267,"[('Type:Bug', 'Product defects'), ('.Needs Triage', '')]","[{'comment_id': 2488683679, 'issue_id': 2675251941, 'author': 'paoliniluis', 'body': 'can you please open this issue on the clickhouse repository?', 'created_at': datetime.datetime(2024, 11, 20, 14, 9, 17, tzinfo=datetime.timezone.utc)}, {'comment_id': 2488690692, 'issue_id': 2675251941, 'author': 'code1704', 'body': '> can you please open this issue on the clickhouse repository?\n\nOK. It works with latest clickhouse. I will upgrade clickhouse.', 'created_at': datetime.datetime(2024, 11, 20, 14, 12, 7, tzinfo=datetime.timezone.utc)}]","paoliniluis on (2024-11-20 14:09:17 UTC): can you please open this issue on the clickhouse repository?

code1704 (Issue Creator) on (2024-11-20 14:12:07 UTC): OK. It works with latest clickhouse. I will upgrade clickhouse.

"
2675129817,issue,open,,Redundant GET `/api/action` request when viewing non-model object details,"### Describe the bug

![Image](https://github.com/user-attachments/assets/6b878adc-b418-4b2c-b3e5-54bb1cea5e9b)


### To Reproduce

1. Browse databases > Sample database > Orders
2. Click on ""Product ID"" cell in the first data row
3. Click ""View details""

Observe network tab and see GET `/api/action` triggered even though it's not a model

### Expected behavior

GET `/api/action` should not be triggered


### Information about your Metabase installation

master, 9ed2c3a26fef60537e84e23168916249eec820df

### Severity

P3
",kamilmielnik,2024-11-20 09:26:27+00:00,[],2025-02-06 10:07:52+00:00,,https://github.com/metabase/metabase/issues/50266,"[('Type:Bug', 'Product defects'), ('Priority:P3', 'Cosmetic bugs, minor bugs with a clear workaround'), ('.Frontend', ''), ('Querying/Actions', ''), ('Visualization/Detail', 'ObjectDetail'), ('.Team/Workflows', 'aka BEC')]",[],
2674971921,issue,closed,completed,align tabs in the sidebar to the left,,uladzimirdev,2024-11-20 08:44:19+00:00,['uladzimirdev'],2024-11-21 17:54:11+00:00,2024-11-21 17:54:11+00:00,https://github.com/metabase/metabase/issues/50265,[],[],
2674815425,issue,closed,completed,show all 3 buttons in the Segment Control for both Table and Pivot Table,,uladzimirdev,2024-11-20 07:39:50+00:00,['uladzimirdev'],2024-12-30 09:20:09+00:00,2024-12-30 09:20:08+00:00,https://github.com/metabase/metabase/issues/50263,[],"[{'comment_id': 2565225992, 'issue_id': 2674815425, 'author': 'uladzimirdev', 'body': 'abandoned', 'created_at': datetime.datetime(2024, 12, 30, 9, 20, 8, tzinfo=datetime.timezone.utc)}]","uladzimirdev (Issue Creator) on (2024-12-30 09:20:08 UTC): abandoned

"
2674813417,issue,closed,completed,render Segment Control when we switch back from viz to notebook editor and only replace it when we edit query,,uladzimirdev,2024-11-20 07:39:03+00:00,['uladzimirdev'],2024-11-22 10:43:41+00:00,2024-11-22 10:43:41+00:00,https://github.com/metabase/metabase/issues/50262,[],[],
2674735226,issue,closed,completed,Search Index testing,"```[tasklist]
### Tasks
- [x] 1 per ranker showing it overpowering a draw on others
- [x] Testing that given rankers and filters are enabled (only) for related premium features.
- [x] Test populating the index for all the models and all the cases of their columns
- [x] Test reindex worker
- [x] Test realtime update worker
- [x] Get API tests running against New Search
- [x] Get e2e tests running against New Search
```

```[tasklist]
### Anecdotal scenarios
- [x] [Accounts](https://metaboat.slack.com/archives/C072YM78NGK/p1731616354121189) - verified works, text ranking, and views
- [x] Gather anecdotes from stats complaints
```",crisptrutski,2024-11-20 07:24:49+00:00,['qnkhuat'],2025-01-27 10:17:57+00:00,2025-01-27 10:17:57+00:00,https://github.com/metabase/metabase/issues/50261,"[('.Team/Workflows', 'aka BEC')]",[],
2674471398,issue,closed,completed,Split `ace`-specific editor into separate file,,romeovs,2024-11-20 05:37:57+00:00,[],2025-01-27 22:14:09+00:00,2024-12-04 01:59:11+00:00,https://github.com/metabase/metabase/issues/50257,[],[],
2674243447,issue,closed,not_planned,Sandboxed User Sometimes Unable to View Pivot Tables,"### Describe the bug

One question (a pivot table) is throwing an occasional error for sandboxed users but not for admin users. It sounds like this occurs the 1st time they log in but recurs if they clear the browser cache for the sandboxed user.

![Image](https://github.com/user-attachments/assets/5e3d7411-fc1b-4b41-9223-156a3c6b1e12)


### To Reproduce

Don't have repro steps yet.



### Expected behavior

The pivot table should load.

### Logs

- [Grafana Logs](https://grafana.monitoring.metabase.com/d/Zjw_nJX7k/metabase-logs?orgId=1&var-cluster=prod-prod-ap-southeast-1&var-filter=2620&var-namespace=hosting-61a1419089604290&var-dns_host=recruitcrm.metabaseapp.com&var-pod=All&from=1732054260000&to=1732054264000)

### Information about your Metabase installation

```JSON
v50.30
```

### Severity

Blocking this customer

### Additional context

https://metaboat.slack.com/archives/C0645JP1W81/p1732058602855949",ixipixi,2024-11-20 03:47:36+00:00,['wzimrin'],2025-01-03 17:30:01+00:00,2025-01-03 17:29:16+00:00,https://github.com/metabase/metabase/issues/50256,"[('Type:Bug', 'Product defects'), ('Priority:P1', 'Security holes w/o exploit, crashing, setup/upgrade, login, broken common features, correctness'), ('.Backend', ''), ('.Team/Querying', ''), ('Querying/Pivot', 'Queries that generate pivot tables')]","[{'comment_id': 2488947785, 'issue_id': 2674243447, 'author': 'ranquild', 'body': ""I initially thought that the error can be caused by empty `pivot_cols` and `pivot_rows` but that's not it. We need to investigate the error in the QP."", 'created_at': datetime.datetime(2024, 11, 20, 15, 50, 28, tzinfo=datetime.timezone.utc)}, {'comment_id': 2495128292, 'issue_id': 2674243447, 'author': 'ixipixi', 'body': ""@ranquild @metamben I met with the customer again to try to get to a more explicitly set of reproduction steps. They cannot reproduce it *at all* anymore even though they were previously able to repro on a test account. We haven't upgraded so I doubt it was fixed.\n\nEven more notably - an important detail I didn't not initially have is that the user experiencing the issue was also interacting with the product through Interactive embedding. They couldn't repro this within Metabase outside the scope of the embedded dashboard. I haven't reproduced yet but the steps they were taking were:\n\n- Set up user with advanced Sandboxing\n- Create a pivot table on the sandboxed table\n- Log in as sandboxed user via interactive embed\n- View pivot as sandboxed user\n- It would fail to render with the above error\n\nI haven't had a chance to set up a test yet but wanted to go ahead share these additional details."", 'created_at': datetime.datetime(2024, 11, 23, 0, 10, 23, tzinfo=datetime.timezone.utc)}, {'comment_id': 2502047437, 'issue_id': 2674243447, 'author': 'ixipixi', 'body': 'Potentially related but the error is different so I created a separate issue:\nhttps://github.com/metabase/metabase/issues/50545', 'created_at': datetime.datetime(2024, 11, 26, 22, 19, 29, tzinfo=datetime.timezone.utc)}, {'comment_id': 2569579134, 'issue_id': 2674243447, 'author': 'wzimrin', 'body': ""[This issue](https://github.com/metabase/metabase/pull/50049) may have fixed this, and this specific customer doesn't seem to be running into this problem anymore, so I'm closing it unless/until we get more info."", 'created_at': datetime.datetime(2025, 1, 3, 17, 29, 16, tzinfo=datetime.timezone.utc)}]","ranquild on (2024-11-20 15:50:28 UTC): I initially thought that the error can be caused by empty `pivot_cols` and `pivot_rows` but that's not it. We need to investigate the error in the QP.

ixipixi (Issue Creator) on (2024-11-23 00:10:23 UTC): @ranquild @metamben I met with the customer again to try to get to a more explicitly set of reproduction steps. They cannot reproduce it *at all* anymore even though they were previously able to repro on a test account. We haven't upgraded so I doubt it was fixed.

Even more notably - an important detail I didn't not initially have is that the user experiencing the issue was also interacting with the product through Interactive embedding. They couldn't repro this within Metabase outside the scope of the embedded dashboard. I haven't reproduced yet but the steps they were taking were:

- Set up user with advanced Sandboxing
- Create a pivot table on the sandboxed table
- Log in as sandboxed user via interactive embed
- View pivot as sandboxed user
- It would fail to render with the above error

I haven't had a chance to set up a test yet but wanted to go ahead share these additional details.

ixipixi (Issue Creator) on (2024-11-26 22:19:29 UTC): Potentially related but the error is different so I created a separate issue:
https://github.com/metabase/metabase/issues/50545

wzimrin (Assginee) on (2025-01-03 17:29:16 UTC): [This issue](https://github.com/metabase/metabase/pull/50049) may have fixed this, and this specific customer doesn't seem to be running into this problem anymore, so I'm closing it unless/until we get more info.

"
2674221285,issue,open,,403 error on /api/dataset/[:format] when filter parameter exists in query,"### Describe the bug

When attempting to download a filtered table, a 403 error is returned from /api/dataset/[:format] - the format of CSV, XLSX or JSON doesn't matter here. If the table is unfiltered, no error occurs. The type of field being filtered on doesn't seem to matter, and it happens on multiple tables across multiple Postgres databases on this Metabase instance.

The following query in a request fails:

```
""query"": ""{\""database\"":4,\""type\"":\""query\"",\""query\"":{\""source-table\"":75,\""filter\"":[\""=\"",[\""field\"",1156,{\""base-type\"":\""type/Boolean\""}],true]},\""middleware\"":{\""js-int-to-string?\"":true,\""userland-query?\"":true,\""add-default-userland-constraints?\"":true}}"",
```

While clearing the filter produces this and it succeeds:

```
""query"": ""{\""database\"":4,\""type\"":\""query\"",\""query\"":{\""source-table\"":75},\""middleware\"":{\""js-int-to-string?\"":true,\""userland-query?\"":true,\""add-default-userland-constraints?\"":true}}"",
```

### To Reproduce

1. Go to 'Databases'
2. Click on a database
3. Click on a table
4. Add a filter on any column (type of filter or column do not seem to matter)
5. Click the Download button
6. Choose any format of .csv, .xlsx or .json - doesn't matter
7. Click Download
8. See ""Download error - Results for Could not download the file""

### Expected behavior

File should download.

### Logs

Nothing shows up during this request in Metabase logs, Heroku logs or in browser console logs (except the failed request to /api/dataset/csv for example with a 403 error)

### Information about your Metabase installation

```JSON
{
  ""browser-info"": {
    ""language"": ""en-US"",
    ""platform"": ""MacIntel"",
    ""userAgent"": ""Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:132.0) Gecko/20100101 Firefox/132.0"",
    ""vendor"": """"
  },
  ""metabase-info"": {
    ""databases"": [
      ""postgres"",
      ""h2""
    ],
    ""run-mode"": ""prod"",
    ""plan-alias"": """",
    ""version"": {
      ""date"": ""2024-11-19"",
      ""tag"": ""v0.51.4"",
      ""hash"": ""47f05f3""
    },
    ""settings"": {
      ""report-timezone"": null
    },
    ""hosting-env"": ""heroku"",
    ""application-database"": ""postgres"",
    ""application-database-details"": {
      ""database"": {
        ""name"": ""PostgreSQL"",
        ""version"": ""15.7""
      },
      ""jdbc-driver"": {
        ""name"": ""PostgreSQL JDBC Driver"",
        ""version"": ""42.7.3""
      }
    }
  },
  ""system-info"": {
    ""file.encoding"": ""UTF-8"",
    ""java.runtime.name"": ""OpenJDK Runtime Environment"",
    ""java.runtime.version"": ""11.0.25+9"",
    ""java.vendor"": ""Eclipse Adoptium"",
    ""java.vendor.url"": ""https://adoptium.net/"",
    ""java.version"": ""11.0.25"",
    ""java.vm.name"": ""OpenJDK 64-Bit Server VM"",
    ""java.vm.version"": ""11.0.25+9"",
    ""os.name"": ""Linux"",
    ""os.version"": ""5.15.0-1072-aws"",
    ""user.language"": ""en"",
    ""user.timezone"": ""GMT""
  }
}
```

### Severity

Annoying

### Additional context

_No response_",chrisgaraffa,2024-11-20 03:30:33+00:00,[],2025-02-08 20:14:06+00:00,,https://github.com/metabase/metabase/issues/50255,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Backend', ''), ('Visualization/Download', ''), ('.Team/DashViz', 'Dashboard and Viz team')]","[{'comment_id': 2488472753, 'issue_id': 2674221285, 'author': 'dpsutton', 'body': 'I\'m trying to recreate this and am not having any luck. I\'m running `0.51.4`, click on browse databases, grab a table and add a filter and the csv downloads just fine.\n\nI\'m hitting `http://localhost:3006/api/dataset/csv` with the payload:\n\n```json\n{""database"":1,""type"":""query"",""query"":{""source-table"":7,""filter"":[""="",[""field"",35,{""base-type"":""type/Boolean""}],true]},""middleware"":{""js-int-to-string?"":true,""userland-query?"":true,""add-default-userland-constraints?"":true}}\n```\n\nAnd it\'s working just fine\n\n```\nID,Account ID,Payment,Expected Invoice,Plan,Date Received\n1,36,295,true,Basic,""September 30, 2020, 12:00 AM""\n2,28,295,true,Basic,""September 30, 2020, 12:00 AM""\n...\n```\n\n![Image](https://github.com/user-attachments/assets/c4bbc9ce-f192-45a3-9cd9-27c1f664e4dd)', 'created_at': datetime.datetime(2024, 11, 20, 12, 35, 41, tzinfo=datetime.timezone.utc)}, {'comment_id': 2489765221, 'issue_id': 2674221285, 'author': 'chrisgaraffa', 'body': ""Very strange, thanks for trying to reproduce.\n\nFor us, Metabase itself is on Heroku via Docker with a Postgres database, and it's connected to a couple other Heroku Postgres databases on other apps. Tables from all of these apps exhibit the same behavior.\n\nI'm unable to reproduce this myself with a fresh local Docker image (though on H2 for app data and not Postgres).\n\nSomething interesting is that I don't see the request that results in a 403 error in the Heroku dyno logs. I've tried in Firefox and Chrome, and have another person in an entirely different location who's reported the same behavior."", 'created_at': datetime.datetime(2024, 11, 20, 23, 42, 25, tzinfo=datetime.timezone.utc)}, {'comment_id': 2645926069, 'issue_id': 2674221285, 'author': 'aaronoliver', 'body': 'I\'ve found this happens when a WAF is in place. In our case, it was in AWS, and I ended up needing to add an exception for a few paths to avoid/bypass checks that are sensitive to SQL injection. https://github.com/metabase/metabase/issues/30864 is related to this, or at least requests that the activity not be so suspicious-looking to WAFs.\n\nI suspect you\'d be able to reproduce this behavior if you set up an AWS WAF and used their ruleset `AWS-AWSManagedRulesCommonRuleSet`.\n\nHere\'s the rule we used in AWS WAF to avoid the problems. Seems to work ok so far. \n\n```\n{\n  ""Name"": ""AllowMetabase-API"",\n  ""Priority"": 2,\n  ""Statement"": {\n    ""OrStatement"": {\n      ""Statements"": [\n        {\n          ""ByteMatchStatement"": {\n            ""SearchString"": ""/api/dataset"",\n            ""FieldToMatch"": {\n              ""UriPath"": {}\n            },\n            ""TextTransformations"": [\n              {\n                ""Priority"": 0,\n                ""Type"": ""NONE""\n              }\n            ],\n            ""PositionalConstraint"": ""STARTS_WITH""\n          }\n        },\n        {\n          ""ByteMatchStatement"": {\n            ""SearchString"": ""/api/card"",\n            ""FieldToMatch"": {\n              ""UriPath"": {}\n            },\n            ""TextTransformations"": [\n              {\n                ""Priority"": 0,\n                ""Type"": ""NONE""\n              }\n            ],\n            ""PositionalConstraint"": ""STARTS_WITH""\n          }\n        },\n        {\n          ""ByteMatchStatement"": {\n            ""SearchString"": ""/api/dashboard"",\n            ""FieldToMatch"": {\n              ""UriPath"": {}\n            },\n            ""TextTransformations"": [\n              {\n                ""Priority"": 0,\n                ""Type"": ""NONE""\n              }\n            ],\n            ""PositionalConstraint"": ""STARTS_WITH""\n          }\n        }\n      ]\n    }\n  },\n  ""Action"": {\n    ""Allow"": {}\n  },\n  ""VisibilityConfig"": {\n    ""SampledRequestsEnabled"": true,\n    ""CloudWatchMetricsEnabled"": true,\n    ""MetricName"": ""AllowMetabase-API""\n  }\n}\n```', 'created_at': datetime.datetime(2025, 2, 8, 20, 14, 6, tzinfo=datetime.timezone.utc)}]","dpsutton on (2024-11-20 12:35:41 UTC): I'm trying to recreate this and am not having any luck. I'm running `0.51.4`, click on browse databases, grab a table and add a filter and the csv downloads just fine.

I'm hitting `http://localhost:3006/api/dataset/csv` with the payload:

```json
{""database"":1,""type"":""query"",""query"":{""source-table"":7,""filter"":[""="",[""field"",35,{""base-type"":""type/Boolean""}],true]},""middleware"":{""js-int-to-string?"":true,""userland-query?"":true,""add-default-userland-constraints?"":true}}
```

And it's working just fine

```
ID,Account ID,Payment,Expected Invoice,Plan,Date Received
1,36,295,true,Basic,""September 30, 2020, 12:00 AM""
2,28,295,true,Basic,""September 30, 2020, 12:00 AM""
...
```

![Image](https://github.com/user-attachments/assets/c4bbc9ce-f192-45a3-9cd9-27c1f664e4dd)

chrisgaraffa (Issue Creator) on (2024-11-20 23:42:25 UTC): Very strange, thanks for trying to reproduce.

For us, Metabase itself is on Heroku via Docker with a Postgres database, and it's connected to a couple other Heroku Postgres databases on other apps. Tables from all of these apps exhibit the same behavior.

I'm unable to reproduce this myself with a fresh local Docker image (though on H2 for app data and not Postgres).

Something interesting is that I don't see the request that results in a 403 error in the Heroku dyno logs. I've tried in Firefox and Chrome, and have another person in an entirely different location who's reported the same behavior.

aaronoliver on (2025-02-08 20:14:06 UTC): I've found this happens when a WAF is in place. In our case, it was in AWS, and I ended up needing to add an exception for a few paths to avoid/bypass checks that are sensitive to SQL injection. https://github.com/metabase/metabase/issues/30864 is related to this, or at least requests that the activity not be so suspicious-looking to WAFs.

I suspect you'd be able to reproduce this behavior if you set up an AWS WAF and used their ruleset `AWS-AWSManagedRulesCommonRuleSet`.

Here's the rule we used in AWS WAF to avoid the problems. Seems to work ok so far. 

```
{
  ""Name"": ""AllowMetabase-API"",
  ""Priority"": 2,
  ""Statement"": {
    ""OrStatement"": {
      ""Statements"": [
        {
          ""ByteMatchStatement"": {
            ""SearchString"": ""/api/dataset"",
            ""FieldToMatch"": {
              ""UriPath"": {}
            },
            ""TextTransformations"": [
              {
                ""Priority"": 0,
                ""Type"": ""NONE""
              }
            ],
            ""PositionalConstraint"": ""STARTS_WITH""
          }
        },
        {
          ""ByteMatchStatement"": {
            ""SearchString"": ""/api/card"",
            ""FieldToMatch"": {
              ""UriPath"": {}
            },
            ""TextTransformations"": [
              {
                ""Priority"": 0,
                ""Type"": ""NONE""
              }
            ],
            ""PositionalConstraint"": ""STARTS_WITH""
          }
        },
        {
          ""ByteMatchStatement"": {
            ""SearchString"": ""/api/dashboard"",
            ""FieldToMatch"": {
              ""UriPath"": {}
            },
            ""TextTransformations"": [
              {
                ""Priority"": 0,
                ""Type"": ""NONE""
              }
            ],
            ""PositionalConstraint"": ""STARTS_WITH""
          }
        }
      ]
    }
  },
  ""Action"": {
    ""Allow"": {}
  },
  ""VisibilityConfig"": {
    ""SampledRequestsEnabled"": true,
    ""CloudWatchMetricsEnabled"": true,
    ""MetricName"": ""AllowMetabase-API""
  }
}
```

"
2673967554,issue,closed,not_planned,"Field filters do not work on persisted models, reducing the functionality of Metabase models","When creating a model and enabling persistence, field filters do not work on the persisted model. This behavior significantly reduces the utility of both the model itself and the persistence feature.

Since a persisted model effectively behaves like a table, there seems to be no justification for field filters not functioning in this scenario. The lack of field filter support on persisted models makes it cumbersome to work with models and diminishes the overall functionality of Metabase.

Having fully functional field filters for models, including persisted ones, is essential for maintaining the usability and value of this feature within Metabase.",rodrigoGA,2024-11-20 00:22:53+00:00,[],2025-01-09 11:43:19+00:00,2025-01-09 11:43:19+00:00,https://github.com/metabase/metabase/issues/50251,"[('Type:Bug', 'Product defects'), ('Priority:P2', 'Average run of the mill bug'), ('.Frontend', ''), ('.Backend', ''), ('Querying/Cache', ''), ('.Team/Querying', ''), ('.Needs Clarification', 'Issue is incomplete or missing actionable information.')]","[{'comment_id': 2569299278, 'issue_id': 2673967554, 'author': 'NevRA', 'body': '@rodrigoGA Hi. Could you please clarify the reproduction scenario for this issue? Is this about a native question (SQL) or not? If its a SQL question, we dont support parameterization for models. For regular questions, this should work.', 'created_at': datetime.datetime(2025, 1, 3, 14, 27, 31, tzinfo=datetime.timezone.utc)}, {'comment_id': 2579947251, 'issue_id': 2673967554, 'author': 'NevRA', 'body': 'Please reopen this issue if there are any new details.', 'created_at': datetime.datetime(2025, 1, 9, 11, 43, 8, tzinfo=datetime.timezone.utc)}]","NevRA on (2025-01-03 14:27:31 UTC): @rodrigoGA Hi. Could you please clarify the reproduction scenario for this issue? Is this about a native question (SQL) or not? If its a SQL question, we dont support parameterization for models. For regular questions, this should work.

NevRA on (2025-01-09 11:43:08 UTC): Please reopen this issue if there are any new details.

"
2673964370,issue,open,,Replace `ace` with CodeMirror 6 (`@uiw/react-codemirror`),,romeovs,2024-11-20 00:19:51+00:00,[],2024-11-20 00:19:51+00:00,,https://github.com/metabase/metabase/issues/50250,[],[],
